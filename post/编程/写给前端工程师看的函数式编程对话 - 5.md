
---
title: 写给前端工程师看的函数式编程对话 - 5
categories: 
    - 编程
    - 掘金 - 分类
author: 掘金 - 分类
comments: false
date: Sun, 21 Mar 2021 01:16:48 GMT
thumbnail: 
---

<div>   
<div class="markdown-body"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre>code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote>p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><p>前篇：<a href="https://juejin.cn/post/6941288824899108871" target="_blank">juejin.cn/post/694128…</a></p>
<h2 data-id="heading-0"><strong>第五天：我，穷人，打钱！</strong></h2>
<p>学生：早，我们的第一步是不是复习上节课的内容哇</p>
<p>方：嗯对</p>
<p>学生：上节课讲了可以用函数来表示二元组，可以用二元组来表示数组（list/array）</p>
<p>方：看来你有记笔记，今天居然没忘</p>
<p>学生：今天要学习更复杂的数据结构吗？</p>
<p>方：嗯，讲一讲「对象」吧。我们常说的对象，其实是「哈希表」，大概长这样：</p>
<pre><code class="copyable">const me = {
  name: '方应杭',
  age: 18,
  title: '前端工程师'
}

me.age // 18
me['age'] // 18
<span class="copy-code-btn">复制代码</span></code></pre>
<p>学生：嗯</p>
<p>方：我说 me 可以用函数表示，你应该不反对吧？</p>
<p>学生：能给代码我看看吗</p>
<p>方：来了：</p>
<pre><code class="copyable">createPerson = (name, age, title) => key =>
  key === 'name'  ? name :
  key === 'age'   ? age :
  key === 'title' ? title :
                    null
me = createPerson('方应杭', 18, '前端工程师')
me('age') // 18
<span class="copy-code-btn">复制代码</span></code></pre>
<p>学生：好吧，me 确实可以用函数表示……但是用对象来表示 me，会让 me.age 查找起来更快，你的代码会将 key 与不同字符串进行逐个对比，字符串越多，查找越慢</p>
<p>方：没错，但是这很好优化，可以通过提供内置的对象构造器来优化，也可以通过编译器优化，这些优化都不是我们需要讨论的内容。</p>
<p>学生：了解。</p>
<p>方：目前我们是在复习上节课的内容， 好让你相信，不管多么复杂的数据结构，都是可以用函数表示的：真实的数据被存在该函数内部，该函数会再暴露出了一个函数用来访问真实的数据。这句话你听着有没有觉得耳熟？</p>
<p>学生：有！JS 的闭包就是这样的。</p>
<p>方：没错，这就是闭包（Closure)。createPersion() 返回的函数（记为 temp），再加上这个函数能访问到的自由变量（name、age、title），组合起来就叫做闭包。</p>
<p>学生：那闭包有什么用？</p>
<p>方：闭包一方面存储 name、age 和 title，一方面让 temp 函数去操作这些变量，这就是闭包的全部作用。</p>
<p>学生：这有什么用？</p>
<p>方：这作用还不够大嘛？</p>
<p>学生：这作用算什么大？我用对象轻松就能达成这些功能啊：</p>
<pre><code class="copyable">const obj = {
  name: '方应杭', age: 18, title: '前端工程师', 
  get(key){ if(key)...return... }
}
<span class="copy-code-btn">复制代码</span></code></pre>
<p>对不对？</p>
<p>方：你说到点子上了，闭包和对象是可以相互代替的：你即可以用对象来容纳数据，然后暴露接口来操作数据；也可以用闭包来容纳数据，然后暴露接口来操作数据。</p>
<p>学生：原来是这样</p>
<p>方：由于 JS 程序员更喜欢对象，所以对闭包总是本能地拒绝。实际上网上流传过这么一句话：「闭包是穷人的对象，对象是穷人的闭包」Closures are poor man's objects. Objects are poor man's closures.</p>
<p>学生：这话怎么理解</p>
<p>方：有些语言，比如 Java 的前几个版本，函数不能访问自由变量，也就不可能组成闭包了，那么你要「容纳数据，然后暴露接口来操作数据」只能使用类和对象了，所以说「对象是穷人的闭包」，意思是想用闭包的 Java 程序员是穷人（很窘迫），不得不选择对象作为代替品。</p>
<p>学生：原来如此</p>
<p>方：另一方面，有些语言，并没有提供真正的对象，只能使用闭包来「容纳数据，然后暴露接口来操作数据」，所以说「闭包是穷人的对象」。</p>
<p>学生：那 JS 呢？</p>
<p>方：JS 两个都支持，但两个都支持地一般般。你说 JS 支持面向对象吧，它的 class 又残缺不全；你说 JS 支持函数式吧，它的尾递归优化又迟迟不能落地。就挺尴尬的，这导致 JS 程序员学面向对象学得不够好，学函数式也学得不够好……</p>
<p>学生：那我怎么办？</p>
<p>方：多学点编程语言就行了。</p>
<p>学生：哦……对了，网上还说闭包会造成内存泄露，是真的吗？</p>
<p>方：别理这种说法，说这话的人既没有理解闭包，也没有理解内存泄露。</p>
<p>学生：哦好。那你刚刚说的自由变量又是什么呢？</p>
<p>方：还是得用代码举例：</p>
<pre><code class="copyable">const v1 = '全局变量'
const f1 = (p1, p2)=>{
  // p1 和 p2 是 f1 的参数 
  const v2 = 'f1 的本地变量' 

  const f2 = (r1, r2) => {
     // r1、r2 是 f2 的参数
     const v3 = 'f2 的本地变量'
     console.log(p1, p2, v2) 
     // p1、p2、v3 不是 f2 的本地变量，也不是全局变量，
     // 那么我们认为它们是 f2 的自由变量
  }
  f2()
}
f1()
<span class="copy-code-btn">复制代码</span></code></pre>
<p>你可以认为，对于一个函数来说，</p>
<ol>
<li>定义在顶级作用域的是全局变量</li>
<li>定义在该函数的 参数列表 里的变量，是这个函数的参数变量</li>
<li>定义在该函数的 函数体 里的变量，是这个函数的本地变量</li>
<li>除了上面三种之外的变量，就是<strong>这个函数的自由变量</strong></li>
<li>有的地方认为参数变量也属于本地变量</li>
</ol>
<p>但这个概念其实没有明确地定义，你大概理解就行了。</p>
<p>学生：我可不可以理解为当前函数词法作用域外部的局部变量，就是自由变量。</p>
<p>方：对。哟，你还知道词法作用域呢</p>
<p>学生：（笑）从书上学的</p>
<p>方：尽量不要去用自己没有完全理解的概念，用直白的语言描述就行了。</p>
<p>学生：好的，以后我尽量不说还没学的术语。</p>
<p>方：另外，要记住函数其实也是变量，所以 f1 也是 f2 的自由变量。以后我不专门说你也要知道。</p>
<p>学生：那是当然，这我还是知道的。</p>
<p>方：那么我们今天的内容就讲完了：闭包是穷人的对象，对象是穷人的闭包。</p>
<p>学生：感觉没听过瘾啊</p>
<p>方：下次，下次吧</p>
<p>学生：好吧</p></div> <div class="image-viewer-box" data-v-78c9b824><!----></div>  
</div>
            