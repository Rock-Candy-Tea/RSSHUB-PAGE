
---
title: '为什么程序员不喜欢写注释？'
categories: 
 - 社交媒体
 - 知乎
 - 知乎热榜
headimg: 'https://pica.zhimg.com/v2-1f0ea8aff2880778ea9e905241780cb2_1440w.jpg?source=b1748391'
author: 知乎
comments: false
date: Sun, 24 Jul 2022 03:20:28 GMT
thumbnail: 'https://pica.zhimg.com/v2-1f0ea8aff2880778ea9e905241780cb2_1440w.jpg?source=b1748391'
---

<div>   
大宽宽的回答<br><br><p data-pid="4hWJd22Z">不知道大家有没有发现，写好注释是一件成本非常非常高的事情。</p><p data-pid="x21FzWB0">比如常规的开发工作，随便写个几十上百行，调试过了，QA过了，这事就算结束了。但一旦开始写注释，就意味着要把一段段代码的思路和注意事项讲给别人，这个比单纯的撸代码麻烦多了。</p><p data-pid="o8VpqDBh">首先，那种完备清晰的注释一般只出现在接口层，比如一个lib的入口，一个服务的入口的函数。我们对”好注释“的印象都来自于此。</p><figure data-size="normal"><img src="https://pica.zhimg.com/v2-1f0ea8aff2880778ea9e905241780cb2_1440w.jpg?source=b1748391" data-caption data-size="normal" data-rawwidth="1290" data-rawheight="1560" data-default-watermark-src="https://pica.zhimg.com/v2-2af3c54cc17028597547e74233f99e85_720w.jpg?source=b1748391" class="origin_image zh-lightbox-thumb" data-original="https://pica.zhimg.com/v2-1f0ea8aff2880778ea9e905241780cb2_r.jpg?source=b1748391" referrerpolicy="no-referrer"></figure><p data-pid="U7dDmXON">但是即便是这些写的很好的库/服务，内部函数大多地方也不会写注释。道理很简单，性价比很低。简单的，无脑的注释没必要写。因为代码本身就能代表某个意思。不会说写一句数据库访问还要注释一下"访问xxx库的xxx表”。只有到了”需要解释一下为啥要这么干“的代码时，才需要写注释。</p><p data-pid="KagZyiCe">但要非常留意，我觉得”好的注释就是代码本身“，“好的代码是可以自解释的”是不完全正确的。因为代码受结构影响，代码的注释和人看到一段代码，期望了解其背景的理解方式往往是不一致的。这就需要补充其他材料。越复杂的事情，单靠注释越搞不定。</p><p data-pid="TkTkExr9">比如在互联网产品的开发工作中往往需要PRD文档，技术文档以及这些文档的一系列讨论的记录（可以以评论的形式存在文档中）一起来看，才能说明白原因。往往是PRD写的A，经过讨论改成了B，到了技术设计设计成了C，但是因为历史遗留问题改成了D，跟PM一合计发现还是改成F吧，于是数据表设计、读写、缓存被设计为了G。这么一圈下来，其实注释本身是不可能完全说明白这件事的，更好的办法也许是直接在注释里贴文档链接。另外一个例子比如一个前后端同步数据的接口，也许注释把接口参数的含义说得清清楚楚，但关键信息其实是前后端到底是“怎么同步的”。依靠某种version/sequence吗？数据同步延迟会带来什么问题吗？如果冲突了怎么resolve？这也是简单的注释搞不定的，得写文档。Redis里的官方对如主从复制，cluster，分布式锁等都写了详细的文档。</p><p data-pid="fmn1PY51">所以，从大处讲，如果目标是让团队的新的代码维护者/Code Reviewer能看懂和理解一段代码的思路，光靠注释是不够的，需要建立一个综合文档（对内，对外），注释，Code Review的体系。文档可能比注释更重要，因为不光研发要看，外部非技术的用户要看，QA和运维也要看。如果所在的团队用的不是飞书文档、confluence、git wiki这种在线文档，连链接都没得贴，只能依靠某种word/wps的文档的维护机制。所以在没有在线文档的研发团队，沉淀和分享信息是一件非常难的事情。</p><p data-pid="M3T2Q_cW">这里扯的有点远了，回到注释。总有一些比较局部，纯技术的内容可以写注释。比方说cache内部的map分桶，分了1024个。可以解释下为啥1024个，而不是2048或者512个。一个rpc请求处理某个公共的protocol字段时，需要维护的一些约定(大小写约定，可用的前缀，magic number等）。一个并发调用，比较考虑容灾，那么重试的delay，次数，jitter等的设定原因等（可以能是来自于某次压测结果比较好，或者就是拍脑袋日后观察优化）。</p><p data-pid="aQiuQwjB">写好注释需要很强的同理心，需要降身份转换到能力水平差不多，但是没接触过这段代码，但要了解代码意图的人，他们想了解什么，了解多深入。同时好的注释有需要有比较好的写作能力，能够清晰的描述事情的背景、原因、代码的概要等。给后面维护这段代码的人有用的信息便于变更。</p><p data-pid="M1TnYuUv">但相当多的程序员根本就<b>分不清楚什么时候应该解释，即使解释了也很容易解释不到点子</b>上。很多人即使是写注释，也只会解释步骤。但从来都不说为啥要有这个步骤。还有很多人写了一段奇葩的if blabla，当时觉得理所当然。自然也就不需要解释和写注释。直到另外一个人看到了这段代码，大骂这是什么shit。然后……新接手的人自己也会重复这个过程，被下一个人骂。</p><p data-pid="LLCPJubM">要想写好注释，需要有优质的程序员来引导。这里的【优质】是一个非常high level的bar，这样的的人会对代码质量和可维护性有着近乎于宗教般的信仰和追求。而在国内优秀的人才大多转向管理岗，自然也不会操心这这件事。剩下的【优质】程序员非常稀少。而在国外，这种追求是开发者的政治正确，做不到连面试都过不了。因此国内国外会产生巨大的差异。</p><blockquote data-pid="VYHX9aHd">这里并不是贬低国内的程序员。我见过很多程序员非常擅长以极低的成本，极高的效率解决工程问题。即使他们并不是很有兴趣把这些事情用注释或者文档的形式说清楚，这也是行业里很推崇的能力。</blockquote><p data-pid="jBKSkRzF">另外一种写好注释的做法就是结对code review。两个人给对方讲自己的写的代码的逻辑。上面不是说难以有同理心吗？直接沟通，对方不明白自然就会问”为啥"。只要把为啥的部分写注释就大体解决写好注释的问题。但这种做法的成本非常高昂，需要两个人占本来可以开发的工时来做code review和注释的update（顺便还有代码重构和UT等）。对于很多企业这个成本难以承受，或者远远高于让新接手的人骂骂娘，或者不敢碰老代码直接绕开重写的成本。</p><p data-pid="S5l2G_gy">最后一件要点是激励。一般一个需求有比较严格的工期。这个工期里忙活各种代码或者历史遗留问题，跨端对沟通问题，用户/需求方成天改来改去的问题都忙不过来，根本没有动力去推动执行者更多的留意代码的可读/可维护性。想想看，有没有人因为不好好写注释绩效被打低？如果真的这么干是不是又被骂作“太卷了”：）</p><p data-pid="qGs9bLm5">于是，我们平时要么看不到什么注释，要么看到的就是那种根据某种研发流程规定的，有固定格式的，但写了和没写也差不多的注释（还不一定能跟着代码一起更新）。如果注释写了之后别人也不见得能看得懂，干脆还不如不写。</p><p data-pid="KZ_mV3X3">但还是希望有更多人把写好注释当做是“出门要穿好衣服”，“和别人说话要讲礼貌”同类的事情，并能投入一点点精力做好吧。</p>  
</div>
            