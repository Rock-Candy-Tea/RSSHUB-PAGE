
---
title: '为什么程序员不喜欢写注释？'
categories: 
 - 社交媒体
 - 知乎
 - 知乎热榜
headimg: 'https://picsum.photos/400/300?random=4112'
author: 知乎
comments: false
date: Sun, 24 Jul 2022 11:42:16 GMT
thumbnail: 'https://picsum.photos/400/300?random=4112'
---

<div>   
invalid s的回答<br><br><p data-pid="TZe3dZqS">写注释要从写文档起始；写文档要从更标准、更科学、更规范的流程开始。</p><p><br></p><p data-pid="3frBPnWz">换句话说，想要让程序员乐意写注释，你得这样：</p><p data-pid="yw2UAIGO">1、了解基本需求；邀请技术专家研究可行性，出《可行性研究报告》</p><p data-pid="TW73Hw2N">2、了解详细需求，和双方技术专家一起，出《需求说明书》</p><p data-pid="sDf8KayV">3、邀请项目组成员与会，讨论并写出《软件总体设计方案》</p><p data-pid="q2_cYf_B">4、邀请相关开发人员，讨论并写出《XX模块详细设计方案》</p><p data-pid="ilWoEibI">……</p><p><br></p><p data-pid="a9GWdbkd">有了以上步骤，那么最终写程序时，程序员自然胸有成竹。</p><p data-pid="BDn2fzMU">比如我，这时候往往会这样开始写：</p><div class="highlight"><pre><code class="language-c"><span><span class="cm">/*</span>
<span class="cm">日志管理模块</span>
<span class="cm">*/</span>


<span class="cm">/*</span>
<span class="cm">日志解析接口</span>

<span class="cm">本接口供内部使用</span>
<span class="cm">传入参数：</span>
<span class="cm">    text：string，一行日志文本</span>
<span class="cm">    record：Record，解析后的格式化数据</span>
<span class="cm">返回：</span>
<span class="cm">    解析成功返回0，失败返回错误代码；具体原因可参考xxxx.log</span>
<span class="cm">*/</span>
<span class="kt">int</span> <span class="nf">parse</span><span class="p">(</span><span class="n">string</span> <span class="n">text</span><span class="p">,</span> <span class="n">Record</span> <span class="o">&</span><span class="n">record</span><span class="p">)</span> <span class="p">&#123;</span>
    <span class="c1">//1、分析日志格式</span>
    <span class="c1">//2、把不同格式的日志dispatch给不同的分析器</span>
    <span class="c1">//3、返回分析结果</span>
<span class="p">&#125;</span>
</span></code></pre></div><p data-pid="18J-SIdq">没错。不写代码，先写注释。</p><p data-pid="8rEnpPGm">把每个接口的实现方案、处理步骤都先写好；然后再填充代码。</p><p><br></p><p data-pid="hnLbAJtn">记得之前曾说过，我写过一个线程管理器，可以把耗时的函数丢给它，自动异步运行。</p><p data-pid="3zkI1ZH0">这个管理器会自动拷贝传入参数、避免运行期参数失效（这允许以更接近“标准形式”的方式调用函数，也就是可以直接传栈上变量给函数，但这个函数最终在线程中运行）；当线程运行结束时，又能自动归还内存、回收线程……</p><p data-pid="tbc3Viib">并且，这个东西是基于模板推导做的，这样才能在运行时得到参数类型、确保类型匹配——同时不必针对一个个case敲代码。</p><p data-pid="2cXWLsot">最终，一共写了三百行代码；实际上是大约150行代码和150行注释。</p><p><br></p><p data-pid="1s_yF7nB">这个东西其实就是先写注释：进程管理器本身如何初始化、如何管理内存、如何把传来的函数“包”在内部的管理对象中、又如何在执行结束后第一时间通知框架；还有哪里会有数据竞争、如何处理，以及各种各样的case都如何解决，等等。</p><p data-pid="-oiPsl2k">想清楚了，每一块每一行都是做什么的你心里都有数——都在文档里体现过——那么注释自然就能先写出来；然后代码自然一气呵成。</p><p><br></p><p data-pid="ptHnsbXQ">但，想要做到这个，有个前提条件。就是你不能试。不能说我感觉可以这样写但能不能行我也不确定……</p><p data-pid="dLZ0sSvY">你含糊了，那么这个注释肯定就写不对。因为照这样子写不出来啊；你只好换方案；东换换，西换换，好不容易换到个有效方案……那么针对原来方案的注释就不光不起作用，反而成专门误导人的错误注释了——你得找出来，全部改掉。</p><p><br></p><p data-pid="QtOSJ6LA">你看，如此一来，注释就成了纯粹的负担。那，当然就没人愿意写注释了。</p><p data-pid="fpZk-_Eb">尤其是，很多公司，软件都写完了，需求还不知道是什么呢。天天加班，天天变……这能写注释？</p><p data-pid="OQKb2rgh">一行都别写。写出来，改了，经常得到处找，因为需求变了，思路也变了；于是改了一大坨。经常的，五十行前有个注释，这个注释也跟着就错了。</p><p><br></p><p data-pid="f89qOzl6">所以我才说，想让程序员喜欢写注释，你必须规范开发流程。</p><p data-pid="6hpfrBwX">流程规范了，程序员心里才能有谱；程序员心里有了谱，起码大块的注释是错不了的；然后，具体的，某个实现，可能和具体的某个库有关，在真正了解这个库之前，注释显然是写不了的，写了就错——但整体设计思路是通的，可以容纳库的变化的，那么这个注释就可以写，而且可以写的很精确。</p><p><br></p><p data-pid="2mEctYs7">同样的，作为程序员，你想要写注释不痛苦，也要熟悉和规范开发流程。</p><p data-pid="3G6a2flI">比如，任务给你了，很详细很精确；那么，该怎么实现需求呢？</p><p data-pid="Pr5iC-3J">你自己都不太明白……啊，这个，大概可以用XX库搞定。嗯嗯，我调用它的API就好了。</p><p data-pid="gKb182KQ">结果，API是异步接口，执行完给你个通知——你却以为它只是个函数调用——那相当一部分代码就得改了。甚至整个模块的设计思路都得改。</p><p data-pid="P9LH4Aux">这个风险——以及需求理解出偏的风险——都要从接到任务起就解决掉。不然写注释时就麻烦了。</p><p><br></p><p data-pid="RjV6dDaN">你看，这些都需要长期的、严格的训练。</p><p data-pid="ENYQ1o1d">训练到不光能在写代码前就清晰的知道我这样写能行、且已经考虑过几乎所有的细节问题了，这都还不够。还得训练到可以看了Qt、GTK的框图、查一查相关库（如libevent）的例程，就明白相关功能应该如何配合这些库实现，这才能注释写在代码之前、且一写就对、写完填代码就是，无需回头修改注释。</p><p data-pid="5BSfBJyY">训练到这个程度，程序员就会喜欢上写注释。因为写注释就是整理思路；思路整理清楚了，代码一气呵成——这怎么都比一点一点画表达能力拙计的交互图爽吧。</p><p><br></p><p data-pid="EsjfbZiy">反过来说也对，你要还处于一行代码敲出来编译都通不过、看着几个“莫名其妙”的错误提示感到无从下手的阶段……让你还没写代码之前就确定“代码怎么写绝对过”、让你据此提前写注释，这不是赶鸭子上架吗？</p><p data-pid="vnsI2e3b">提前写不了，就只好瞎凑、瞎试；然后代码好不容易莫名其妙的得到了正确结果，你还没来得及喘口气呢……写注释？解释每行代码的作用？哎呀这哪说得清楚啊……</p><p><br></p><p data-pid="BiLaMgQA">很多人不愿意写注释，就是因为注释实在太难写。程序正常运行不就行了吗？写什么注释啊……</p><p data-pid="MVIpSlYm">越写啊，这脑子里就越糊涂……我咋知道这代码干的是什么啊？反正你知道它能工作，不就行了吗？</p>  
</div>
            