
---
title: '美团公开外卖订单分配算法，详解算法如何判断一个骑手的时间宽裕程度和顺路程度，有哪些值得关注的信息？'
categories: 
 - 社交媒体
 - 知乎
 - 知乎热榜
headimg: 'https://pic3.zhimg.com/v2-269044542d0b13edf263325b78675bc2_720w.jpg'
author: 知乎
comments: false
date: Sat, 06 Nov 2021 08:11:31 GMT
thumbnail: 'https://pic3.zhimg.com/v2-269044542d0b13edf263325b78675bc2_720w.jpg'
---

<div>   
叉腰说闲话的回答<br><br><p>依稀还记得去年 9 月一篇《外卖骑手，困在系统里》火遍全网。我们唏嘘算法的冷漠与刻板，同情骑手的无奈与艰辛，同时也<b>开始担忧人类是否在逐渐沦为算法的“奴隶”，而后算法的存在也开始变得“妖魔化”</b>。<br><br>但归根结底，这并不是“算法”自身的问题，而是制造算法和使用算法的“人”的争议。在人们批判算法“没有道德”、“冷血无情”的时候，是否想到其实<b>算法只是一个在数字经济时代下、初衷在于改善人们生活而诞生的技术</b>？算法并不能决定人的生死，它也志不在此。<br><br>最后，引用两位网友对美团公开算法规则的看法，希望大家不再一味将算法视为“原罪”，理智评判技术为我们带来的意义：<br><br><br><br><br><br><br></p><figure data-size="normal"><img src="https://pic3.zhimg.com/v2-269044542d0b13edf263325b78675bc2_720w.jpg" data-caption data-size="normal" data-rawwidth="398" data-rawheight="65" class="content_image" referrerpolicy="no-referrer"></figure><figure data-size="normal"><img src="https://pic1.zhimg.com/v2-aed3b5ecbee31490fe402cd139606278_1440w.jpg" data-caption data-size="normal" data-rawwidth="663" data-rawheight="81" class="origin_image zh-lightbox-thumb" data-original="https://pic1.zhimg.com/v2-aed3b5ecbee31490fe402cd139606278_r.jpg" referrerpolicy="no-referrer"></figure><hr><p>技术分析</p><p>就这个问题求解了搞智能工厂的朋友， 他饶有兴致地给我科普了一下MES跟APS</p><p>APS的作用：根据工厂的生产资料（人员、原料、设备等）跟生产需求，通过算法计算出最近生产排单</p><p><br>MES的左右：接受APS的排单指令，安排车间进行生产，并采集生产数据（人员工时、原料消耗与采购、产品生产进度等数据）反馈给APS，给APS下一步的排单运算提供实时数据支持<br></p><p><b>那啥叫MES跟APS？</b></p><p><br><b>MES (Manufacturing Execution System) 制造执行系统</b><br></p><p><br>MES是位于上层的计划管理系统与底层的工业控制之间的面向车间层的<a href="http://link.zhihu.com/?target=https%3A//wiki.mbalib.com/wiki/%25E7%25AE%25A1%25E7%2590%2586%25E4%25BF%25A1%25E6%2581%25AF%25E7%25B3%25BB%25E7%25BB%259F" class=" wrap external" target="_blank" rel="nofollow noreferrer">管理信息系统</a>”,它为操作人员/管理人员提供计划的执行、跟踪以及所有资源(人、设备、物料、客户需求等)的当前状态。MES的功能包括：<br></p><p><br><b>1)</b> <b>数据采集</b>（DataCollection/Acquisition）该功能通过数据采集接口来获取并更新与生产管理功能相关的各种数据和参数，包括产品跟踪、维护产品历史记录以及其它参数。这些现场数据，可以从车间手工方式录入或由各种自动方式获取。<br></p><p><br><b>2)</b> <b>过程管理</b>（Process Management）该功能监控生产过程、自动纠正生产中的错误并向用户提供决策支持以提高生产效率。通过连续跟踪生产操作流程，在被监视和被控制的机器上实现一些比较底层的操作；通过报警功能，使车间人员能够及时察觉到出现了超出允许误差的加工过程；通过数据采集接口，实现智能设备与制造执行系统之间的数据交换。<br></p><p><br><b>3)</b> <b>人力资源管理</b>（Labor Management）该功能以分为单位提供每个人的状态。通过时间对比，出勤报告，行为跟踪及行为（包含资财及工具准备作业）为基础的费用为基准，实现对人力资源的间接行为的跟踪能力。 6、维修管理（MaintenanceManagement）该功能为了提高生产和日程管理能力的设备和工具的维修行为的指示及跟踪，实现设备和工具的最佳利用效率。<br></p><p><br><b>4)</b> <b>资源分配及状态管理</b>（ResourceAllocationandStatus）该功能管理机床、工具、人员物料、其它设备以及其它生产实体，满足生产计划的要求对其所作的预定和调度，用以保证生产的正常进行；提供资源使用情况的历史记录和实时状态信息，确保设备能够正确安装和运转。<br></p><p><br><b>5)</b> <b>生产单元分配</b>（DispatchingProductionUnits）该功能以作业、订单、批量、成批和工作单等形式管理生产单元间的工作流。通过调整车间已制订的生产进度，对返修品和废品进行处理，用缓冲管理的方法控制任意位置的在制品数量。当车间有事件发生时，要提供一定顺序的调度信息并按此进行相关的实时操作。<br></p><p><br><b>6)</b> <b>生产的跟踪及历史</b>（ProductTracking and Genealogy）该功能可以看出作业的位置和在什么地方完成作业，通过状态信息了解谁在作业，供应商的资财，关联序号，现在的生产条件，警报状态及再作业后跟生产联系的其他事项。<br></p><p><br><b>7)</b> <b>执行分析</b>（PerformanceAnalysis）该功能通过过去记录和预想结果的比较提供以分为单位报告实际的作业运行结果。执行分析结果包含资源活用，资源可用性，生产单元的周期，日程遵守，及标准遵守的测试值。具体化从测试作业因数的许多异样的功能收集的信息，这样的结果应该以报告的形式准备或可以在线提供对执行的实时评价。<br></p><p><br><b>APS高级计划排程系统（Advanced Planning and Scheduling）</b><br></p><p><br>APS是利用许多进步的管理规划技术，包括限制理论（Theory of Constraints，TOC）、运筹学（Operations Research，OR）等，在有限资源下，追求供给与需求间的平衡规划；同时，利用资讯的储存与分析能力，以最短的期限，达到最有效的规划。<br></p><p><br>需要注意的是，目前市面上的一些国外APS都是拉通式排产，并非是可执行有限产能计划。计划依然是MPS无限产能计划，不能够管控误差和约束，也不能将供应商或者节奏进行有效的协同。<br></p><p><br>无限产能纯排产的模式是无法适用企业的，因为直接排产意味着直接铺开过于精细的管理单元，一旦出现生产或者销售的异常情况，局部的变更调整会导致大面积的排产错乱和现场混乱，造成额外的管理费用和沟通成本。<br></p><p><br>优秀的APS应该是“计划+排产”模式，通过多维度约束和合理预留缓冲保证交期，制定生产计划，在准确计划的前提下细化机器排程。这不仅达成准时交付目标，也为异常应急处理奠定基础，最终稳定生产按期交付，提高客户满意度。<br></p><p>他接着跟我说：</p><p>从APS角度理解美团的配送大脑算法 智能调度系统是外卖配送平台的超级大脑，从公开的文章中，试着从计划排产排程角度理解这个超级大脑。</p><p><b><br>核心功能“订单分配”<br></b> <br>订单分配问题一般可建模为带有若干复杂约束的 动态整车路径规划DVRP（Dynamic Vehicle Routing Problem）问题，可以追溯到典型的TSP（旅行商问题），这就是著名的NP难题（非确定性多项式） <br></p><p><br>TSP（旅行商问题）通常的求解方案主要有： <br>（1）TSP_旅行商问题- 蛮力法( 深度遍历优先算法DFS ) <br>（2）TSP_旅行商问题- 动态规划 <br>（3）TSP_旅行商问题- 模拟退火算法 <br>（4）TSP_旅行商问题- 遗传算法 <br>（5）TSP_旅行商问题- 粒子群算法 <br>（6）TSP_旅行商问题- 神经网络 <br><br><br><br><br><br><br></p><p><br>还有另一种说法的解决方案 <br>（1）数学解析法 <br>（2）人机互动法 <br>（3）先分群再排路线 <br>（4）先排路线再分群 <br>（5）节省法或插入法 <br>（6）改善或交换法 <br>（7）数学规划近似法 <br><br><br><br><br><br><br><br></p><p><br> 先不纠结哪种算法，只需记住一点，这是个数学难题！ <br></p><p><br> 将订单分配问题建模，可以理解为：决策变量加上约束条件进行目标优化 <br></p><p><br> ★部分变量和约束可以用历史数据或模拟来生成，这里就是机器学习，这算是AI的一种应用吗？ <br> 订单分配问题演变成A骑手路径规划B骑手分配方案，这两个部分会互相影响，也可以互相迭代优化 <br>B骑手分配方案 采用二分图匹配（匈牙利算法和KM算法）。 <br><br>A骑手路径规划 涉及三层逻辑：⑴长期基础规划（网络/运力）⑵中短期市场需求平衡  ⑶短期实时匹配，看到这里是不是很熟悉，和工厂标准计划层次一模一样，长期产能-中短期平衡-短期排程。 <br> 其中一个“智能骑手排班”模块，有三个参数：按组排班（骑手分组），半小时为排班最小时长（高峰低谷），运力校验（每时间单元的进单量除以峰值单量），这实际上是一个产能匹配过程。<br><br><br><br><br><br></p><p><br> 路径规划则涉及订单-取送餐任务-通行时间-承诺送达时间，这个场景可能一个骑手身上有很多配送任务，这些配送任务存在各种约束，怎样选择最优配送顺序去完成所有任务，然后，这又是一个TSP难题，前面提到了TSP的若干种算法，但在实际应用中，NP难题直观上就是目前计算机科学家们现在没有找到有效算法可以解决的问题！ <br></p><p><br> 但实际上，美团的算法专家将这个TSP问题转化为“流水线调度问题”，每个订单可以认为是任务；一个订单的两个任务取餐和送餐，可以认为是一个任务的执行；任意两个任务点之间的通行时间，可以认为是序列相关的准备时间。每一单承诺的送达时间，包括预订单和即时单，可以映射到流水线调度问题中的提前和拖期惩罚上。 <br></p><p><br> 流水线调度问题：加工一件物品，有n条流水线，每条流水线都有m个工序，不同流水线的相同工序处理功能相同，但处理时间可能不同,为t [i] [j]。. 若工序的进出站时间不计，流水线的调换时间也不计。. 求加工一件物品最少需要多少时间 <br></p><p><br> 流水线调度问题在学术界和工业界已经被研究很多年，其结果是一个序列，有大量的启发式算法可以借鉴，这也是APS的核心 <br></p><p><br> APS排程结果其实是一个序列（排序），而序列（排序）一旦生成，很方便用于插单操作和路径（时间）预估，即使有干扰和异常发生，也很容易进行时间重计算。 <br></p><p><br> 美团配送为什么能发展到今天，一个很重要的原因就是它完成了配送的工业化，工业化意味着效率快速提升，想想还有哪个行业没有实现工业化？ <br></p><p>一顿说完，我还是分享出来，大家一起琢磨琢磨~</p>  
</div>
            