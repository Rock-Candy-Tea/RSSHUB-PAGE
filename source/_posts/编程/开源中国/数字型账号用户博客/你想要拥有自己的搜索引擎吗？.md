
---
title: '你想要拥有自己的搜索引擎吗？'
categories: 
 - 编程
 - 开源中国
 - 数字型账号用户博客
headimg: 'https://oscimg.oschina.net/oscnet/56c6b821-a0c1-4514-8e80-8f903e31e52c.jpg'
author: 开源中国
comments: false
date: 2021-04-18 04:10:07
thumbnail: 'https://oscimg.oschina.net/oscnet/56c6b821-a0c1-4514-8e80-8f903e31e52c.jpg'
---

<div>   
<div class="content">
                                                                                                                                                                                        <div class="rich_media_content " id="js_content"> 
 <p style="text-align: center;"><img class="rich_pages" data-ratio="0.665625" data-s="300,640" src="https://oscimg.oschina.net/oscnet/56c6b821-a0c1-4514-8e80-8f903e31e52c.jpg" data-type="jpeg" data-w="640" style referrerpolicy="no-referrer"></p> 
 <p><span style="letter-spacing: 1px;"><strong><span style="font-size: 15px;color: rgb(136, 136, 136);">转载本文需注明出处：微信公众号EAWorld，违者必究。</span></strong></span></p> 
 <p><br></p> 
 <section style="margin-right: 8px;margin-left: 8px;white-space: normal;line-height: 1.75em;"> 
  <section style="padding: 10px;display: inline-block;width: 558px;border-width: 1px;border-style: solid;border-color: rgb(192, 200, 209);background-color: rgb(239, 239, 239);"> 
   <section> 
    <section> 
     <p><span style="font-size: 18px;color: rgb(0, 0, 0);letter-spacing: 1px;"><strong>前言：<br></strong></span></p> 
     <p><span style="font-size: 15px;"><br></span></p> 
     <p><span style="font-size: 15px;">在现代开发的应用系统中，无论是常规的web应用，还是近几年兴起的app应用，或者是风头正热的大数据应用，都离不开搜索这一功能，搜索也是在应用系统中使用频率最高的一个功能，比如普通的商城系统中的商品搜索或者一些资源的站内搜索等。</span></p> 
     <p><span style="font-size: 15px;">大多数的应用系统的搜索都是针对数据库的搜索，比如说对某个表做一个按名称或针对某些字段的描述做模糊查询。更高级一点的是可以对搜索关键字进行分词，并且专门建一个搜索词库表，这种做法需要对搜索词进行拆解然后幂集组合并与目标表的ID关联，搜索字与词库表的字以完全匹配的方式查询并找到目标表的ID，这种搜索的解决方案需要拆解相关数据库表建立索引，相对比较麻烦。</span></p> 
     <p><span style="font-size: 15px;">所以，今天我们就来聊聊近两年兴起的分布式搜索引擎技术——Elasticsearch。</span><br></p> 
    </section> 
   </section> 
  </section> 
 </section> 
 <p><br></p> 
 <section style="white-space: normal;line-height: 25.6px;"> 
  <section style="margin-top: 0.5em;margin-bottom: 0.5em;border-bottom: 1px solid black;text-align: center;line-height: 1.75em;"> 
   <section style="margin-bottom: -1px;display: inline-block;border-bottom: 6px solid rgb(95, 156, 239);border-top-color: rgb(95, 156, 239);border-right-color: rgb(95, 156, 239);border-left-color: rgb(95, 156, 239);color: rgb(95, 156, 239);"> 
    <p style="font-size: 4px;"><span style="color: rgb(74, 148, 231);font-size: 18px;letter-spacing: 1px;">1.什么是搜索？</span></p> 
   </section> 
  </section> 
 </section> 
 <p><span style="font-size: 15px;color: rgb(74, 148, 231);"><strong><br></strong></span></p> 
 <p><span style="font-size: 15px;color: rgb(74, 148, 231);"><strong>百度、Google：</strong></span><span style="font-size: 15px;">我们想寻找一个我们喜欢的小说、电影或者新闻等就可以去百度或者Google搜索一下。<br></span><span style="font-size: 15px;color: rgb(74, 148, 231);"><strong>互联网搜索：</strong></span><span style="font-size: 15px;">电商网站搜索商品，招聘网站搜索工作岗位，租房网站搜索房屋信息等。<br></span><strong><span style="font-size: 15px;color: rgb(74, 148, 231);">企业应用系统的搜索：</span></strong><span style="font-size: 15px;">企业员工搜索，会议搜索，公文搜索等。<br></span></p> 
 <p><br></p> 
 <section style="white-space: normal;line-height: 25.6px;"> 
  <section style="margin-top: 25px;margin-bottom: 25px;border-bottom: 1px solid black;text-align: center;line-height: 1.75em;"> 
   <section style="margin-bottom: -1px;display: inline-block;border-bottom: 6px solid rgb(95, 156, 239);border-top-color: rgb(95, 156, 239);border-right-color: rgb(95, 156, 239);border-left-color: rgb(95, 156, 239);color: rgb(95, 156, 239);"> 
    <p style="font-size: 4px;"><span style="color: rgb(74, 148, 231);font-size: 18px;letter-spacing: 1px;">2.Elasticsearch是如何产生的？</span></p> 
   </section> 
  </section> 
 </section> 
 <p><span style="color: rgb(74, 148, 231);"><strong><span style="color: rgb(74, 148, 231);font-size: 15px;letter-spacing: 1px;"><br></span></strong></span></p> 
 <p><span style="color: rgb(74, 148, 231);"><strong><span style="color: rgb(74, 148, 231);font-size: 15px;letter-spacing: 1px;">1. 思考：百亿、千亿级海量数据是如何搜索的？</span></strong></span></p> 
 <p><span style="font-size: 15px;"><br></span></p> 
 <p><span style="font-size: 15px;">当系统数据量达到亿以上量级的时候，我们系统架构通常会从哪些角度去思考解决方案呢？</span></p> 
 <p><span style="font-size: 15px;"><br></span></p> 
 <p><span style="font-size: 15px;">1）用什么数据库好？(mysql、db2、oracle、sqlserver、hbase等)<br>2）如何解决高并发和单点故障；(缓存、消息队列、系统拆分、读写分离、分库分表等)<br>3）如何保证数据库的高可用性和数据安全性；(冷备份、热备份、异地多活等)<br>4）如何解决数据检索效率难题；(数据库代理中间件：mysql-proxy、Cobar、mycat等;)</span><br><span style="font-size: 15px;">5）如何解决统计分析问题；(离线统计、近实时统计等) </span></p> 
 <p><br></p> 
 <p><span style="color: rgb(74, 148, 231);"><strong><span style="font-size: 15px;">2. 关系型数据库的解决方案</span></strong></span><span style="font-size: 15px;"><br></span></p> 
 <p><span style="font-size: 15px;"><br></span></p> 
 <p><span style="font-size: 15px;">对于像mysql这样的传统关系型数据库，在以往的项目中，我们使用了以下架构方案去优化数据库的查询和写入瓶颈：</span></p> 
 <p><br></p> 
 <p><span style="font-size: 15px;">1） 通过主从备份来保证数据不会丢失，从而解决数据安全性问题；<br>2） 通过数据库代理中间件对数据库进行心跳监测，解决单点故障问题；<br>3） 通过消息队列对同一时段的大量请求进行削峰处理，解决高并发问题；<br>4） 通过数据库代理中间件将查询语句分发到各个slave节点进行查询，并汇总结果，提高查询效率；<br>5） 对于某些不需要实时统计的场景，如统计前一天的XX数据，通过离线计算并存储到缓存中，解决某些场景的统计问题；</span></p> 
 <p><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: justify;"><span style="color: rgb(74, 148, 231);"><strong><span style="font-size: 15px;">问题：</span></strong></span><span style="font-size: 15px;">上述方案可以优化一部分搜索性能的问题，但是由于关系型数据库本身的特性，上述方案实施起来并不是一件容易的事，涉及到很多的组件，然而一个系统多一个组件，要保证其系统的稳定性的难度就会成几何指数增加，而且就算目前解决的问题，以后数据量再上升到一个量级时，此方案如何进一步扩展又是一份挑战。<br></span></p> 
 <p style="text-align: left;"><br></p> 
 <p style="text-align: center;"><img class="rich_pages" data-ratio="0.696969696969697" data-s="300,640" src="https://oscimg.oschina.net/oscnet/eccea838-0fc3-466c-8328-d8fa2801f27f.png" data-type="png" data-w="759" style referrerpolicy="no-referrer"></p> 
 <p><span style="font-size: 15px;"><br></span></p> 
 <p><span style="color: rgb(74, 148, 231);"><strong><span style="color: rgb(74, 148, 231);font-size: 15px;">3. 非关系型数据库的解决方案</span></strong></span><span style="font-size: 15px;"><br>对于像mongodb这样的nosql数据库，在以往的项目中，我们使用了以下架构方案去解决数据库的查询和写入瓶颈：</span></p> 
 <p><span style="font-size: 15px;"><br></span></p> 
 <p><span style="font-size: 15px;">1）通过副本备份保证数据安全性；<br>2）通过节点竞选机制解决单点问题；<br>3）先从配置库检索分片信息，然后将请求分发到各个节点，最后由路由节点合并汇总结果 </span></p> 
 <p><span style="font-size: 15px;"><br></span></p> 
 <p><span style="color: rgb(74, 148, 231);"><strong><span style="font-size: 15px;">问题：</span></strong></span><span style="font-size: 15px;">mongodb这样的nosql数据库对于简单单表查询的效率是毋庸置疑的，但是它并不能很容易的做到复杂的多表聚合查询，比如涉及到多个表的的关联查询就会显得有些力不从心。<br></span></p> 
 <p><br></p> 
 <p style="text-align: center;"><img class="rich_pages" data-ratio="0.5450081833060556" data-s="300,640" src="https://oscimg.oschina.net/oscnet/e17c2e16-eb82-4996-b7a9-6d2ca4e4d92f.png" data-type="png" data-w="611" style referrerpolicy="no-referrer"></p> 
 <p><br></p> 
 <p><span style="color: rgb(74, 148, 231);"><strong><span style="font-size: 15px;">4. 如果我们把数据全部放到内存会怎么样？</span></strong></span><span style="font-size: 15px;"><br>假设我们现在有1PB的数据，按照每个节点128G内存来计算，在内存完全装满数据的情况下，我们一共需要的机器数量是：1PB=1024T=1048576G，节点数=1048576/128 =8192个，再考虑到数据的备份问题，往往实际场景下我们需要的机器会超过2W台，这样巨大的成本决定了其是不现实的！<br></span></p> 
 <p><span style="font-size: 15px;"><br></span></p> 
 <p><span style="font-size: 15px;">所以，从前面讨论的情况来看，无论是把数据存到传统的基于磁盘的数据库中，还是把数据放到内存中，都无法完全解决大数据量下的搜索问题，根据这一情况，让我们从源头来思考一下：</span></p> 
 <p><span style="font-size: 15px;"><br></span></p> 
 <p><span style="font-size: 15px;">1）数据和索引需要分离；<br>2）数据量过大时，数据需要压缩；<br>3）数据存储需要有序；<br>4）到达瓶颈时，要能够快捷、方便、无感知的进行水平拓展；<br> <br></span></p> 
 <p><span style="font-size: 15px;">由此我们就引出了当下十分流行的分布式搜索引擎技术：Elasticsearch。<br><br></span></p> 
 <section style="white-space: normal;line-height: 25.6px;"> 
  <section style="margin-top: 25px;margin-bottom: 25px;border-bottom: 1px solid black;text-align: center;line-height: 1.75em;"> 
   <section style="margin-bottom: -1px;display: inline-block;border-bottom: 6px solid rgb(95, 156, 239);border-top-color: rgb(95, 156, 239);border-right-color: rgb(95, 156, 239);border-left-color: rgb(95, 156, 239);color: rgb(95, 156, 239);"> 
    <p style="font-size: 4px;"><span style="color: rgb(74, 148, 231);font-size: 18px;letter-spacing: 1px;">3.Elasticsearch基础</span></p> 
   </section> 
  </section> 
 </section> 
 <p><span style="color: rgb(74, 148, 231);"><strong><span style="color: rgb(74, 148, 231);font-size: 15px;letter-spacing: 1px;"><br></span></strong></span></p> 
 <p><span style="color: rgb(74, 148, 231);"><strong><span style="color: rgb(74, 148, 231);font-size: 15px;letter-spacing: 1px;">1. Elasticsearch是什么？<br></span></strong></span></p> 
 <p><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);">Elasticsearch是一个基于Apache Lucene(TM)的开源的高扩展的分布式搜索引擎 ，它可以近乎实时的存储、检索数据；本身扩展性很好，可以很轻松的扩展到上百台服务器，处理PB级别的数据。</span></p> 
 <p><span style="color: rgb(74, 148, 231);"><strong><span style="color: rgb(74, 148, 231);font-size: 15px;letter-spacing: 1px;"><br></span></strong></span></p> 
 <p><span style="color: rgb(74, 148, 231);"><strong><span style="color: rgb(74, 148, 231);font-size: 15px;letter-spacing: 1px;">2. Lucene是什么？<br></span></strong></span></p> 
 <p><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);">Lucene是一套用于全文检索和搜寻的开源程式库，由Apache软件基金会支持和提供。Lucene提供了一个简单却强大的应用程式接口，能够做全文索引和搜寻。在Java开发环境里Lucene是一个成熟的免费开源工具。就其本身而言，Lucene是当前以及最近几年最受欢迎的免费Java信息检索程序库。——《百度百科》 简单来说，Lucene就是一个jar包，里面包含了一系列的和搜索相关的方法，java工程只需要引入Lucene相关的jar包，就可以进行开发。<br></span></p> 
 <p><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);"></span><br></p> 
 <p><span style="color: rgb(74, 148, 231);"><strong><span style="color: rgb(74, 148, 231);font-size: 15px;letter-spacing: 1px;">3. Lucene与Elasticsearch之间的关系<br></span></strong></span></p> 
 <p><span style="color: rgb(74, 148, 231);"><strong><span style="color: rgb(74, 148, 231);font-size: 15px;letter-spacing: 1px;"><br></span></strong></span></p> 
 <p><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);">1）<strong>lucene</strong>，最先进、功能最强大的搜索库，直接基于lucene开发，非常复杂，api复杂（实现一些简单的功能，写大量的java代码），需要深入理解原理（各种索引结构） 。</span></p> 
 <p><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);"><br></span></p> 
 <p><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);">2）<strong>elasticsearch</strong>，基于lucene，隐藏其开发的复杂性，提供简单易用的restful api接口、java api接口（还有其他语言的api接口） ，从而使我们能够更方便的实现搜索功能。<br></span></p> 
 <p><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);"><br></span></p> 
 <p><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);">3) elasticsearch不仅仅是Lucene和全文搜索引擎 ，它还具有以下特点：<br></span></p> 
 <p><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);">    分布式的实时文件存储，每个字段都被索引并可被搜索<br>    实时分析的分布式搜索引擎<br>    可以扩展到上百台服务器，处理PB级结构化或非结构化数据<br></span><span style="color: rgb(74, 148, 231);"><strong><span style="color: rgb(74, 148, 231);font-size: 15px;letter-spacing: 1px;"><br></span></strong></span></p> 
 <p><span style="color: rgb(74, 148, 231);"><strong><span style="color: rgb(74, 148, 231);font-size: 15px;letter-spacing: 1px;">4. Elasticsearch 核心概念<br></span></strong></span></p> 
 <p><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);"><br></span></p> 
 <p><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);">1） <strong>近实时（NRT）</strong>  Elasticsearch是一个接近实时的搜索平台。这意味着，往索引插入一个文档直到这个文档能够被搜索到有一个轻微的延迟（通常是1秒）。</span><span style="color: rgb(74, 148, 231);"><strong><span style="color: rgb(74, 148, 231);font-size: 15px;letter-spacing: 1px;"><br></span></strong></span></p> 
 <p><span style="color: rgb(74, 148, 231);"><strong><span style="color: rgb(74, 148, 231);font-size: 15px;letter-spacing: 1px;"><br></span></strong></span></p> 
 <p style="text-align: center;"><img class="rich_pages" data-ratio="0.8013937282229965" data-s="300,640" src="https://oscimg.oschina.net/oscnet/a47e80b6-08a0-403d-ab98-49fb66cbb050.png" data-type="png" data-w="574" style referrerpolicy="no-referrer"></p> 
 <p><br></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);">2） <strong>集群（cluster）</strong> 集群由一个或多个节点组成，当有多个节点时，其中有一个为主节点，这个主节点是可以通过选举产生的，主从节点是对于集群内部来说的。es的一个概念就是去中心化，字面上理解就是无中心节点，这是对于集群外部来说的，因为从外部来看es集群，在逻辑上是个整体，你与任何一个节点的通信和与整个es集群通信是等价的。 </span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);">3） <strong>节点（node） </strong>运行了单个实例的ES主机称为节点，它是集群的一个成员，可以存储数据、参与集群索引及搜索操作。类似于集群，节点靠其名称进行标识，默认为启动时自动生成的随机Marvel字符名称。用户可以按需要自定义任何希望使用的名称，但出于管理的目的，此名称应该尽可能有较好的识别性。节点通过为其配置的ES集群名称确定其所要加入的集群。<br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);">4）<strong>分片（shards）</strong> 代表索引分片，es可以把一个完整的索引分成多个分片（shards），这样的好处可以横向扩展，存储更多数据，让搜索和分析等操作分布到多台服务器上去执行，提升吞吐量和性能。分片的数量只能在索引创建前指定，并且索引创建后不能更改。<br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);">5）<strong>副本（replica）</strong> 任何一个服务器随时可能故障或宕机，此时shard可能就会丢失，因此可以为每个shard创建多个replica副本。replica可以在shard故障时提供备用服务，保证数据不丢失，多个replica还可以提升搜索操作的吞吐量和性能。primary shard（建立索引时一次设置，不能修改，默认5个），replica shard（随时修改数量，默认1个），默认每个索引10个shard，5个primary shard，5个replica shard，最小的高可用配置，是2台服务器。<br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);">6）<strong>索引 (index)</strong> 包含一堆有相似结构的文档数据，比如可以有一个用户信息索引，商品信息索引，订单信息索引等，一个索引由一个名字来标识（必须全部是小写字母的），并且当我们要对对应于这个索引中的文档进行索引、搜索、更新和删除的时候，都要使用到这个名字。索引类似于关系型数据库中Database的概念。在一个集群中，如果你想，可以定义任意多的索引。<br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);">7）<strong>类型（type）</strong> 每个索引里都可以有一个或多个type，type是index中的一个逻辑数据分类，一个type下的document，都有相同的field，比如博客系统，有一个索引，可以定义用户数据type，博客数据type，评论数据type等。类型类似于关系型数据库中Table的概念。<br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);">8）<strong>文档（document）</strong> document是es中的最小数据单元，一个document可以是一条客户数据，一条商品分类数据，一条订单数据，通常用JSON数据结构表示，每个index下的type中，都可以去存储多个document。一个document里面有多个field，每个field就是一个数据字段。<br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);">举例：</span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);">商品<strong>index</strong>，里面存放了所有的商品数据，商品document<br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);">但是商品分很多种类，每个种类的document的field可能不太一样，比如说电器商品，可能还包含一些诸如售后时间范围这样的特殊field；生鲜商品，还包含一些诸如生鲜保质期之类的特殊field</span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);"><br></span></p> 
 <p style="text-align: justify;"><strong><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);">type</span></strong><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);">，日化商品type，电器商品type，生鲜商品type<br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);">日化商品type：product_id，product_name，product_desc，category_id，category_name；<br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);">电器商品type：product_id，product_name，product_desc，category_id，category_name，service_period；<br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);">生鲜商品type：product_id，product_name，product_desc，category_id，category_name，eat_period；</span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);">每一个type里面，都会包含一堆<strong>document</strong></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);">&#123; "product_id": "2", "product_name": "长虹电视机", "product_desc": "4k高清", "category_id": "3", "category_name": "电器", "service_period": "1年"&#125;</span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);">&#123; "product_id": "3", "product_name": "基围虾", "product_desc": "纯天然，冰岛产", "category_id": "4", "category_name": "生鲜", "eat_period": "7天"&#125;</span></p> 
 <p style="text-align: justify;"><br></p> 
 <p style="text-align: justify;"><span style="color: rgb(74, 148, 231);"><strong><span style="color: rgb(74, 148, 231);font-size: 15px;letter-spacing: 1px;">5. elasticsearch核心概念 vs. 数据库核心概念<br></span></strong></span></p> 
 <p><span style="color: rgb(74, 148, 231);"><strong><span style="color: rgb(74, 148, 231);font-size: 15px;letter-spacing: 1px;"><br></span></strong></span></p> 
 <p style="text-align: center;"><img class="rich_pages" data-ratio="0.6938775510204082" data-s="300,640" src="https://oscimg.oschina.net/oscnet/69d86d0b-82d1-4212-ad07-c7ab023e159f.png" data-type="png" data-w="882" style referrerpolicy="no-referrer"></p> 
 <p><br></p> 
 <p><span style="color: rgb(74, 148, 231);"><strong><span style="color: rgb(74, 148, 231);font-size: 15px;letter-spacing: 1px;">6. Elasticsearch的功能<br></span></strong></span></p> 
 <p style="text-align: justify;"><span style="color: rgb(74, 148, 231);"><strong><span style="color: rgb(74, 148, 231);font-size: 15px;letter-spacing: 1px;"><br></span></strong></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);">1）<strong>分布式的搜索引擎和数据分析引擎</strong></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);"><br></span></p> 
 <p style="text-align: justify;"><strong><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);">搜索：</span></strong><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);">百度，网站的站内搜索，IT系统的检索;<br><strong>数据分析：</strong>电商网站，最近7天牙膏这种商品销量排名前10的商家有哪些；新闻网站，最近1个月访问量排名前3的新闻版块是哪些;<br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);">2）<strong>全文检索，结构化检索，数据分析</strong></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);"><br></span></p> 
 <p style="text-align: justify;"><strong><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);">全文检索：</span></strong><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);">我想搜索商品名称包含洗发水的商品，select * from products where product_name like "%洗发水%";<br></span></p> 
 <p style="text-align: justify;"><strong><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);">结构化检索：</span></strong><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);">我想搜索商品分类为粮油用品的商品都有哪些，select * from products where category_type='粮油用品';<br>部分匹配、自动完成、搜索纠错、搜索推荐等;<br><strong>数据分析：</strong>我们分析每一个商品分类下有多少个商品，select category_type,count(*) from products group by category_type;</span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);">3）<strong>对海量数据进行近实时的处理</strong><br><strong>分布式：</strong>ES自动可以将海量数据分散到多台服务器上去存储和检索;<br>海量数据的处理：分布式以后，就可以采用大量的服务器去存储和检索数据，自然而然就可以实现海量数据的处理了;<br><strong>近实时：</strong>检索个数据要花费1小时（这就不叫近实时，叫离线批处理）；在秒级别对数据进行搜索和分析;<br><strong>跟分布式/海量数据相反的：</strong>lucene，单机应用，只能在单台服务器上使用，最多只能处理单台服务器可以处理的数据量。<br><br></span></p> 
 <p style="text-align: justify;"><span style="color: rgb(74, 148, 231);"><strong><span style="color: rgb(74, 148, 231);font-size: 15px;letter-spacing: 1px;">7. Elasticsearch的特点<br></span></strong></span></p> 
 <p style="text-align: justify;"><span style="color: rgb(74, 148, 231);"><strong><span style="color: rgb(74, 148, 231);font-size: 15px;letter-spacing: 1px;"><br></span></strong></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);">1）可以作为一个大型分布式集群（数百台服务器）技术，处理PB级数据，服务大公司；也可以运行在单机上，服务小公司</span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);">2）Elasticsearch不是什么新技术，主要是将全文检索、数据分析以及分布式技术，合并在了一起，才形成了独一无二的ES；lucene（全文检索）+数据分析软件+分布式数据库（mycat）</span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);">3）对用户而言，是开箱即用的，非常简单，作为中小型的应用，直接3分钟部署一下ES，就可以作为生产环境的系统来使用了，数据量不大，操作不是太复杂</span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);">4）数据库的功能面对很多领域是不够用的（事务，还有各种联机事务型的操作）；特殊的功能，比如全文检索，同义词处理，相关度排名，复杂数据分析，海量数据的近实时处理；Elasticsearch作为传统数据库的一个补充，提供了数据库所不不能提供的很多功能<br></span><span style="color: rgb(74, 148, 231);"><strong><span style="color: rgb(74, 148, 231);font-size: 15px;letter-spacing: 1px;"><br></span></strong></span></p> 
 <p style="text-align: justify;"><span style="color: rgb(74, 148, 231);"><strong><span style="color: rgb(74, 148, 231);font-size: 15px;letter-spacing: 1px;">8. Elasticsearch的适用场景</span></strong></span></p> 
 <p style="text-align: justify;"><br></p> 
 <p style="text-align: justify;"><strong><span style="font-size: 15px;">国外</span></strong><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;"><br>1）<strong>维基百科</strong>，类似百度百科，牙膏，牙膏的维基百科，全文检索，高亮，搜索推荐</span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;">2）<strong>The Guardian</strong>（国外新闻网站），类似搜狐新闻，用户行为日志（点击，浏览，收藏，评论）+社交网络数据（对某某新闻的相关看法），数据分析，给到每篇新闻文章的作者，让他知道他的文章的公众反馈（好，坏，热门，垃圾，鄙视，崇拜）</span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;">3）<strong>Stack Overflow</strong>（国外的程序异常讨论论坛），IT问题，程序的报错，提交上去，有人会跟你讨论和回答，全文检索，搜索相关问题和答案，程序报错了，就会将报错信息粘贴到里面去，搜索有没有对应的答案</span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;">4）<strong>GitHub</strong>（开源代码管理），搜索上千亿行代码</span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;">5）<strong>电商网站</strong>，检索商品</span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;">6）<strong>日志数据分析</strong>，logstash采集日志，ES进行复杂的数据分析（ELK技术，elasticsearch+logstash+kibana）</span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;">7）<strong>商品价格监控网站</strong>，用户设定某商品的价格阈值，当低于该阈值的时候，发送通知消息给用户，比如说订阅牙膏的监控，如果高露洁牙膏的家庭套装低于50块钱，就通知我，我就去买</span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;">8）<strong>BI系统</strong>，商业智能，Business Intelligence。比如说有个大型商场集团，BI，分析一下某某区域最近3年的用户消费金额的趋势以及用户群体的组成构成，产出相关的数张报表，XX区，最近3年，每年消费金额呈现100%的增长，而且用户群体85%是高级白领，开一个新商场。ES执行数据分析和挖掘，Kibana进行数据可视化</span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: justify;"><strong><span style="font-size: 15px;">国内</span></strong></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;">站内搜索（电商，招聘，门户，等等），IT系统搜索（OA，CRM，ERP，等等），数据分析（ES热门的一个使用场景）等</span></p> 
 <p><br></p> 
 <section style="white-space: normal;line-height: 25.6px;"> 
  <section style="margin-top: 25px;margin-bottom: 25px;border-bottom: 1px solid black;text-align: center;line-height: 1.75em;"> 
   <section style="margin-bottom: -1px;display: inline-block;border-bottom: 6px solid rgb(95, 156, 239);border-top-color: rgb(95, 156, 239);border-right-color: rgb(95, 156, 239);border-left-color: rgb(95, 156, 239);color: rgb(95, 156, 239);"> 
    <p style="font-size: 4px;"><span style="color: rgb(74, 148, 231);font-size: 18px;letter-spacing: 1px;">4.Elasticsearch倒排索引</span></p> 
   </section> 
  </section> 
 </section> 
 <p><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);"><br></span></p> 
 <p><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);">上面一小段我们讨论了Elasticsearch的一些基本信息，这一小段我们来聊一聊Elasticsearch的倒排索引。</span></p> 
 <p><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);"><br></span></p> 
 <p><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);">倒排索引（Inverted Index）也叫反向索引，有反向索引必有正向索引。通俗地来讲，正向索引是通过key寻找value，反向索引则是通过value寻找key。 </span></p> 
 <p><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);"><br></span></p> 
 <p><span style="font-size: 15px;letter-spacing: 1px;color: rgb(0, 0, 0);">我们先来看一下es是如何插入一条索引数据的：</span><br></p> 
 <section class="code-snippet__fix code-snippet__js"> 
  <pre class="code-snippet__js" data-lang="makefile"><code><span class="code-snippet_outer">curl -X PUT "localhost:9200/user/_doc/1" -H 'Content-Type: application/json' -d'</span></code><code><span class="code-snippet_outer">&#123;</span></code><code><span class="code-snippet_outer">    "name" : "mary",</span></code><code><span class="code-snippet_outer">    "gender" : 0,</span></code><code><span class="code-snippet_outer">    "age" : 25</span></code><code><span class="code-snippet_outer">&#125;</span></code></pre> 
 </section> 
 <p style="text-align: center;"><span style="color: rgb(74, 148, 231);"><span style="color: rgb(74, 148, 231);font-size: 15px;letter-spacing: 1px;"><span style="font-size: 14px;color: rgb(136, 136, 136);">（左右滑动查看全部代码）</span></span><strong><span style="color: rgb(74, 148, 231);font-size: 15px;letter-spacing: 1px;"><br></span></strong></span></p> 
 <p style="text-align: justify;"><span style="color: rgb(74, 148, 231);"><strong><span style="color: rgb(74, 148, 231);font-size: 15px;letter-spacing: 1px;"><br></span></strong></span><span style="font-size: 15px;">就是直接PUT一个JSON的对象，这个对象有多个字段，在插入这些数据到索引的同时，Elasticsearch还为这些字段建立索引——倒排索引，Elasticsearch最核心功能是搜索 ，建立倒排索引，就是为了提高搜索的性能。</span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;">那么倒排索引是什么样子的呢？<br></span></p> 
 <p><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: center;"><img class="rich_pages" data-ratio="0.2901134521880065" data-s="300,640" src="https://oscimg.oschina.net/oscnet/59102d43-154e-4263-b39e-5ef2b0fecf8c.png" data-type="png" data-w="617" style referrerpolicy="no-referrer"></p> 
 <p style="text-align: justify;"><br></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;">首先我们来搞清楚几个概念：</span></p> 
 <p style="text-align: justify;"><br><span style="font-size: 15px;">1）<strong>Term（单词）：</strong>一段文本经过分析器分析以后就会输出一串单词，这一个一个的就叫做Term（直译为：单词） ；</span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;">2）<strong>Term Dictionary（单词字典）</strong>：顾名思义，它里面维护的是Term，可以理解为Term的集合；</span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;">3）<strong>Term Index（单词索引）</strong>：为了更快的找到某个单词，我们为单词建立索引 ；</span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;">4）<strong>Posting List（倒排列表）</strong>：倒排列表记录了出现过某个单词的所有文档的文档列表及单词在该文档中出现的位置信息，每条记录称为一个倒排项(Posting)。根据倒排列表，即可获知哪些文档包含某个单词 ；</span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;">类比我们的新华词典，那么Term就相当于词语，Term Dictionary相当于汉语词典本身，Term Index相当于词典的目录索引。</span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;">下面再来举个例子看一看：</span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;">假设有个user索引，它有四个字段：分别是name，gender，age，address。大概是下面这个样子，跟关系型数据库一样 ：<br></span></p> 
 <p style="text-align: left;"><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: center;"><img class="rich_pages" data-ratio="0.15888456549935148" data-s="300,640" src="https://oscimg.oschina.net/oscnet/2c255075-b2b8-4ef6-9dc1-102ce9a64103.png" data-type="png" data-w="1542" style referrerpolicy="no-referrer"></p> 
 <p><br></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;">对于这张表中的数据，Elasticsearch建立的索引大致如下：<br></span></p> 
 <p style="text-align: justify;"><br></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;">name字段：<br></span></p> 
 <p><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: center;"><img class="rich_pages" data-ratio="0.39903846153846156" data-s="300,640" src="https://oscimg.oschina.net/oscnet/df1fe62c-1297-4d74-96aa-7fd342c716d3.png" data-type="png" data-w="624" style referrerpolicy="no-referrer"></p> 
 <p style="text-align: center;"><br></p> 
 <p><span style="font-size: 15px;">age字段：</span></p> 
 <p><br></p> 
 <p style="text-align: center;"><img class="rich_pages" data-ratio="0.3971061093247588" data-s="300,640" src="https://oscimg.oschina.net/oscnet/cf400edb-f64e-4f7a-82a4-c5f3a1d1ff91.png" data-type="png" data-w="622" style referrerpolicy="no-referrer"></p> 
 <p><br></p> 
 <p><span style="font-size: 15px;">gender字段：<br></span></p> 
 <p><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: center;"><img class="rich_pages" data-ratio="0.30112721417069244" data-s="300,640" src="https://oscimg.oschina.net/oscnet/ee8938b5-8abc-4dbf-8068-39ed1135b684.png" data-type="png" data-w="621" style referrerpolicy="no-referrer"></p> 
 <p><br></p> 
 <p><span style="font-size: 15px;">address字段：<br></span></p> 
 <p><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: center;"><img class="rich_pages" data-ratio="0.5925925925925926" data-s="300,640" src="https://oscimg.oschina.net/oscnet/89847051-21a0-46bc-844a-4008b1d10c3b.png" data-type="png" data-w="621" style referrerpolicy="no-referrer"></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;">Elasticsearch分别为每个字段都建立了一个倒排索引。比如，在上面“丽丽”、“北京市”、18 这些都是Term，而[2，3]就是Posting List。Posting list就是一个数组，存储了所有符合某个Term的文档ID；</span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;">在倒排索引中，通过Term索引可以找到Term在Term Dictionary中的位置，进而找到Posting List，有了倒排列表就可以根据ID找到文档了 ;</span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;">如果类比数据库的数据存储引擎的话：Term Index相当于索引文件，Term Dictionary相当于数据文件）；</span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;">从最开始的那张图中，我们将倒排索引分成了三步，实际上我们可以把Term Index和Term Dictionary看成一步，就是找term；因此我们也可以这样理解倒排索引：通过单词找到对应的倒排列表，根据倒排列表中的倒排项进而可以找到文档记录。</span></p> 
 <p><br></p> 
 <section style="white-space: normal;line-height: 25.6px;"> 
  <section style="margin-top: 25px;margin-bottom: 25px;border-bottom: 1px solid black;text-align: center;line-height: 1.75em;"> 
   <section style="margin-bottom: -1px;display: inline-block;border-bottom: 6px solid rgb(95, 156, 239);border-top-color: rgb(95, 156, 239);border-right-color: rgb(95, 156, 239);border-left-color: rgb(95, 156, 239);color: rgb(95, 156, 239);"> 
    <p style="font-size: 4px;"><span style="color: rgb(74, 148, 231);font-size: 18px;letter-spacing: 1px;">5.Springboot整合Elasticsearch</span></p> 
   </section> 
  </section> 
 </section> 
 <p style="text-align: justify;"><br></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;">上面给大家介绍了Elasticsearch相关的一些基本知识，由于篇幅有限，关于Elasticsearch的安装和基本使用方法请大家去阅读官网的资料,<span style="font-size: 15px;">这里就不再赘述</span>：</span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;">https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html<br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;"></span><br></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;">话不多说让我们来看看如何将Elasticsearch整合到一个springboot项目中：<br></span></p> 
 <p style="text-align: left;"><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: left;"><span style="color: rgb(74, 148, 231);"><strong><span style="font-size: 15px;">1. 集成方式</span></strong></span><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;"><br>Spring Boot中集成Elasticsearch有4种方式：</span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;">1）REST Client<br>2）Jest<br>3）Spring Data Elasticsearch Template<br>4）Spring Data Elasticsearch Repositories</span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;">本文用后面两种方式来分别连接并操作Elasticsearch</span></p> 
 <p style="text-align: left;"><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: left;"><span style="color: rgb(74, 148, 231);"><strong><span style="font-size: 15px;">2. 环境与配置</span></strong></span><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: left;"><span style="font-size: 15px;"><br>服务端：elasticsearch-6.2.2 1台<br>服务端配置文件：elasticsearch.yml<br></span></p> 
 <section class="code-snippet__fix code-snippet__js"> 
  <pre class="code-snippet__js" data-lang="css"><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">cluster.name: springboot-es-application</span></code><code><span class="code-snippet_outer">network.host: 192.168.1.100</span></code><code><span class="code-snippet_outer">http.port: 9200</span></code></pre> 
 </section> 
 <p style="text-align: center;"><span style="color: rgb(74, 148, 231);"><span style="color: rgb(74, 148, 231);font-size: 15px;letter-spacing: 1px;"><span style="font-size: 14px;color: rgb(136, 136, 136);">（左右滑动查看全部代码）</span></span><strong><span style="color: rgb(74, 148, 231);font-size: 15px;letter-spacing: 1px;"><br></span></strong></span></p> 
 <p style="text-align: center;"><span style="color: rgb(74, 148, 231);"><strong><span style="color: rgb(74, 148, 231);font-size: 15px;letter-spacing: 1px;"><br></span></strong></span></p> 
 <p style="text-align: left;"><span style="font-size: 15px;">/etc/security/limits.conf<br></span></p> 
 <section class="code-snippet__fix code-snippet__js"> 
  <pre class="code-snippet__js" data-lang="markdown"><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer"><span class="code-snippet__bullet">* </span>soft nofile 65536</span></code><code><span class="code-snippet_outer"><span class="code-snippet__bullet">* </span>hard nofile 65536</span></code></pre> 
 </section> 
 <p style="text-align: left;"><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: left;"><span style="font-size: 15px;">/etc/sysctl.conf<br></span></p> 
 <section class="code-snippet__fix code-snippet__js"> 
  <pre class="code-snippet__js"><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">vm.max_map_count=262144</span></code></pre> 
 </section> 
 <p style="text-align: left;"><br></p> 
 <p style="text-align: left;"><span style="color: rgb(74, 148, 231);"><strong><span style="font-size: 15px;">3. 版本</span></strong></span><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: left;"><span style="font-size: 15px;"><br>springboot版本：2.1.6.RELEASE<br>elasticsearch版本：6.2.2</span></p> 
 <p style="text-align: left;"><br></p> 
 <p style="text-align: left;"><span style="color: rgb(74, 148, 231);"><strong><span style="color: rgb(74, 148, 231);font-size: 15px;">4. maven依赖<br></span></strong></span></p> 
 <section class="code-snippet__fix code-snippet__js"> 
  <pre class="code-snippet__js" data-lang="xml"><code><span class="code-snippet_outer"><?xml version="1.0" encoding="UTF-8"?></span></code><code><span class="code-snippet_outer"><project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"</span></code><code><span class="code-snippet_outer">    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"></span></code><code><span class="code-snippet_outer">    <modelVersion>4.0.0</modelVersion></span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">    <groupId>com.primeton.example</groupId></span></code><code><span class="code-snippet_outer">    <artifactId>primeton-elasticsearch-example</artifactId></span></code><code><span class="code-snippet_outer">    <version>0.0.1-SNAPSHOT</version></span></code><code><span class="code-snippet_outer">    <packaging>jar</packaging></span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">    <name>primeton-elasticsearch-example</name></span></code><code><span class="code-snippet_outer">    <description></description></span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">    <parent></span></code><code><span class="code-snippet_outer">        <groupId>org.springframework.boot</groupId></span></code><code><span class="code-snippet_outer">        <artifactId>spring-boot-starter-parent</artifactId></span></code><code><span class="code-snippet_outer">        <version>2.1.6.RELEASE</version></span></code><code><span class="code-snippet_outer">        <relativePath/> <!-- lookup parent from repository --></span></code><code><span class="code-snippet_outer">    </parent></span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">    <properties></span></code><code><span class="code-snippet_outer">        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding></span></code><code><span class="code-snippet_outer">        <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding></span></code><code><span class="code-snippet_outer">        <java.version>1.8</java.version></span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">        <elasticsearch.version>6.2.2</elasticsearch.version></span></code><code><span class="code-snippet_outer">        <spring.data.elasticsearch.version>3.1.0.RELEASE</spring.data.elasticsearch.version></span></code><code><span class="code-snippet_outer">    </properties></span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">    <dependencies></span></code><code><span class="code-snippet_outer">        <dependency></span></code><code><span class="code-snippet_outer">            <groupId>org.elasticsearch</groupId></span></code><code><span class="code-snippet_outer">            <artifactId>elasticsearch</artifactId></span></code><code><span class="code-snippet_outer">            <version>$&#123;elasticsearch.version&#125;</version></span></code><code><span class="code-snippet_outer">        </dependency></span></code><code><span class="code-snippet_outer">        <dependency></span></code><code><span class="code-snippet_outer">            <groupId>org.elasticsearch.client</groupId></span></code><code><span class="code-snippet_outer">            <artifactId>transport</artifactId></span></code><code><span class="code-snippet_outer">            <version>$&#123;elasticsearch.version&#125;</version></span></code><code><span class="code-snippet_outer">        </dependency></span></code><code><span class="code-snippet_outer">        <dependency></span></code><code><span class="code-snippet_outer">            <groupId>org.elasticsearch.client</groupId></span></code><code><span class="code-snippet_outer">            <artifactId>elasticsearch-rest-client</artifactId></span></code><code><span class="code-snippet_outer">            <version>$&#123;elasticsearch.version&#125;</version></span></code><code><span class="code-snippet_outer">        </dependency></span></code><code><span class="code-snippet_outer">        <dependency></span></code><code><span class="code-snippet_outer">            <groupId>org.elasticsearch.plugin</groupId></span></code><code><span class="code-snippet_outer">            <artifactId>transport-netty4-client</artifactId></span></code><code><span class="code-snippet_outer">            <version>$&#123;elasticsearch.version&#125;</version></span></code><code><span class="code-snippet_outer">        </dependency></span></code><code><span class="code-snippet_outer">        <dependency></span></code><code><span class="code-snippet_outer">            <groupId>org.springframework.data</groupId></span></code><code><span class="code-snippet_outer">            <artifactId>spring-data-elasticsearch</artifactId></span></code><code><span class="code-snippet_outer">            <version>$&#123;spring.data.elasticsearch.version&#125;</version></span></code><code><span class="code-snippet_outer">        </dependency></span></code><code><span class="code-snippet_outer">        <dependency></span></code><code><span class="code-snippet_outer">            <groupId>org.springframework.boot</groupId></span></code><code><span class="code-snippet_outer">            <artifactId>spring-boot-starter-data-elasticsearch</artifactId></span></code><code><span class="code-snippet_outer">        </dependency></span></code><code><span class="code-snippet_outer">        <dependency></span></code><code><span class="code-snippet_outer">            <groupId>org.springframework.boot</groupId></span></code><code><span class="code-snippet_outer">            <artifactId>spring-boot-starter-web</artifactId></span></code><code><span class="code-snippet_outer">        </dependency></span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">        <dependency></span></code><code><span class="code-snippet_outer">            <groupId>org.projectlombok</groupId></span></code><code><span class="code-snippet_outer">            <artifactId>lombok</artifactId></span></code><code><span class="code-snippet_outer">            <optional>true</optional></span></code><code><span class="code-snippet_outer">        </dependency></span></code><code><span class="code-snippet_outer">        <dependency></span></code><code><span class="code-snippet_outer">            <groupId>org.springframework.boot</groupId></span></code><code><span class="code-snippet_outer">            <artifactId>spring-boot-starter-test</artifactId></span></code><code><span class="code-snippet_outer">            <scope>test</scope></span></code><code><span class="code-snippet_outer">        </dependency></span></code><code><span class="code-snippet_outer">    </dependencies></span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">    <build></span></code><code><span class="code-snippet_outer">        <plugins></span></code><code><span class="code-snippet_outer">            <plugin></span></code><code><span class="code-snippet_outer">                <groupId>org.springframework.boot</groupId></span></code><code><span class="code-snippet_outer">                <artifactId>spring-boot-maven-plugin</artifactId></span></code><code><span class="code-snippet_outer">            </plugin></span></code><code><span class="code-snippet_outer">        </plugins></span></code><code><span class="code-snippet_outer">    </build></span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer"></project></span></code></pre> 
 </section> 
 <p style="text-align: center;"><span style="font-size: 14px;color: rgb(136, 136, 136);">（左右滑动查看全部代码）</span><br></p> 
 <p style="text-align: left;"><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: left;"><span style="color: rgb(74, 148, 231);"><strong><span style="color: rgb(74, 148, 231);font-size: 15px;">5. application.properties</span></strong></span></p> 
 <section class="code-snippet__fix code-snippet__js"> 
  <pre class="code-snippet__js" data-lang="kotlin"><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">spring.data.elasticsearch.cluster-name=springboot-es-application</span></code><code><span class="code-snippet_outer">spring.data.elasticsearch.cluster-nodes=192.168.1.100:9300</span></code></pre> 
 </section> 
 <p style="text-align: center;"><span style="color: rgb(74, 148, 231);"><span style="color: rgb(74, 148, 231);font-size: 15px;letter-spacing: 1px;"><span style="font-size: 14px;color: rgb(136, 136, 136);">（左右滑动查看全部代码）</span></span><strong><span style="color: rgb(74, 148, 231);font-size: 15px;letter-spacing: 1px;"><br></span></strong></span></p> 
 <p style="text-align: left;"><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;">看到这里大家也许会感到疑惑，前面的配置文件端口号明明写的是9200，这里为了要写成9300呢？</span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;">因为：</span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;">9200端口是通过http协议连接es使用的端口；<br>9300端口是使用tcp客户端连接使用的端口； </span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;">因此咱们的springboot程序作为客户端想要连接elasticsearch就要使用9300端口；</span></p> 
 <p style="text-align: left;"><br></p> 
 <p style="text-align: left;"><span style="color: rgb(74, 148, 231);"><strong><span style="color: rgb(74, 148, 231);font-size: 15px;">6. 实战代码<br></span></strong></span></p> 
 <p style="text-align: left;"><br></p> 
 <p style="text-align: left;"><span style="font-size: 15px;"><strong>1. 使用Spring Data Elasticsearch Repositories操作Elasticsearch</strong><br></span></p> 
 <p style="text-align: left;"><span style="font-size: 15px;"><br>首先定义一个商品实体类<strong>entity<br></strong></span></p> 
 <section class="code-snippet__fix code-snippet__js"> 
  <pre class="code-snippet__js" data-lang="kotlin"><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">package com.primeton.example.entity;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">import lombok.Data;</span></code><code><span class="code-snippet_outer">import org.springframework.data.annotation.Id;</span></code><code><span class="code-snippet_outer">import org.springframework.data.elasticsearch.annotations.Document;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">import java.io.Serializable;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">@Data</span></code><code><span class="code-snippet_outer">@Document(indexName = "product")</span></code><code><span class="code-snippet_outer">public class Product implements Serializable &#123;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">    @Id</span></code><code><span class="code-snippet_outer">    private String productId;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">    private String name;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">    private String category;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">    private Integer price;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">    private String brand;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">    private Integer stock;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">&#125;</span></code></pre> 
 </section> 
 <p style="text-align: center;"><span style="font-size: 14px;color: rgb(136, 136, 136);">（左右滑动查看全部代码）</span></p> 
 <p style="text-align: justify;"><br></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;">这里我们创建了一个Product的entity，表示商品的实体类。我们可以看到在Document注解中，只指定了indexName，并没有指定type，在elasticsearch6.x版本中，不建议使用type，而且在7.X版本中将会彻底废弃type。这里，一个Product就代表一个商品，同时也代表了一条索引记录。</span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;">这里类比关系型数据库的话，一个索引（Index）就相当于一张表，一个文档（Document）就相当于一条记录。</span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: justify;"><strong><span style="font-size: 15px;">然后我们需要自己定义一个接口，并继承ElasticsearchRepositor</span></strong><strong><span style="font-size: 15px;">y。</span></strong><span style="font-size: 15px;"><br></span></p> 
 <section class="code-snippet__fix code-snippet__js"> 
  <pre class="code-snippet__js" data-lang="css"><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">package com.primeton.example.dao;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">import com.primeton.example.entity.Product;</span></code><code><span class="code-snippet_outer">import org.springframework.data.elasticsearch.repository.ElasticsearchRepository;</span></code><code><span class="code-snippet_outer">import org.springframework.stereotype.Repository;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">@Repository</span></code><code><span class="code-snippet_outer">public interface ProductRepository extends ElasticsearchRepository<Product, String> &#123;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">&#125;</span></code></pre> 
 </section> 
 <p style="text-align: center;"><span style="font-size: 14px;color: rgb(136, 136, 136);">（左右滑动查看全部代码）</span></p> 
 <p style="text-align: center;"><br></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;">这里的Repository相当于我们常说的DAO层。</span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: justify;"><strong><span style="font-size: 15px;">接下来定义service接口</span></strong><span style="font-size: 15px;"><br></span></p> 
 <section class="code-snippet__fix code-snippet__js"> 
  <pre class="code-snippet__js" data-lang="java"><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">package com.primeton.example.service;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">import com.primeton.example.entity.Product;</span></code><code><span class="code-snippet_outer">import org.springframework.data.domain.Page;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">import java.util.List;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">public interface ProductService &#123;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">    long count();</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">    Product save(Product product);</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">    void delete(Product product);</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">    Iterable<Product> getAll();</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">    List<Product> getByName(String name);</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">    Page<Product> pageQuery(Integer pageNo, Integer pageSize, String kw);</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">&#125;</span></code></pre> 
 </section> 
 <p style="text-align: center;"><span style="font-size: 14px;color: rgb(136, 136, 136);">（左右滑动查看全部代码）<br></span></p> 
 <p style="text-align: center;"><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: left;"><strong><span style="font-size: 15px;">定义service实现类</span></strong><span style="font-size: 15px;"><br></span></p> 
 <section class="code-snippet__fix code-snippet__js"> 
  <pre class="code-snippet__js" data-lang="java"><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">package com.primeton.example.service.impl;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">import com.primeton.example.entity.Product;</span></code><code><span class="code-snippet_outer">import com.primeton.example.dao.ProductRepository;</span></code><code><span class="code-snippet_outer">import com.primeton.example.service.ProductService;</span></code><code><span class="code-snippet_outer">import org.elasticsearch.index.query.MatchQueryBuilder;</span></code><code><span class="code-snippet_outer">import org.elasticsearch.index.query.QueryBuilders;</span></code><code><span class="code-snippet_outer">import org.springframework.beans.factory.annotation.Autowired;</span></code><code><span class="code-snippet_outer">import org.springframework.data.domain.Page;</span></code><code><span class="code-snippet_outer">import org.springframework.data.domain.PageRequest;</span></code><code><span class="code-snippet_outer">import org.springframework.data.elasticsearch.core.query.NativeSearchQueryBuilder;</span></code><code><span class="code-snippet_outer">import org.springframework.data.elasticsearch.core.query.SearchQuery;</span></code><code><span class="code-snippet_outer">import org.springframework.stereotype.Service;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">import java.util.ArrayList;</span></code><code><span class="code-snippet_outer">import java.util.List;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">@Service</span></code><code><span class="code-snippet_outer">public class ProductServiceImpl implements ProductService &#123;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">    @Autowired</span></code><code><span class="code-snippet_outer">    private ProductRepository ProductRepository;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">    @Override</span></code><code><span class="code-snippet_outer">    public long count() &#123;</span></code><code><span class="code-snippet_outer">        return ProductRepository.count();</span></code><code><span class="code-snippet_outer">    &#125;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">    @Override</span></code><code><span class="code-snippet_outer">    public Product save(Product product) &#123;</span></code><code><span class="code-snippet_outer">        return ProductRepository.save(product);</span></code><code><span class="code-snippet_outer">    &#125;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">    @Override</span></code><code><span class="code-snippet_outer">    public void delete(Product product) &#123;</span></code><code><span class="code-snippet_outer">        ProductRepository.delete(product);</span></code><code><span class="code-snippet_outer">    &#125;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">    @Override</span></code><code><span class="code-snippet_outer">    public Iterable<Product> getAll() &#123;</span></code><code><span class="code-snippet_outer">        return ProductRepository.findAll();</span></code><code><span class="code-snippet_outer">    &#125;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">    @Override</span></code><code><span class="code-snippet_outer">    public List<Product> getByName(String name) &#123;</span></code><code><span class="code-snippet_outer">        List<Product> list = new ArrayList<>();</span></code><code><span class="code-snippet_outer">        MatchQueryBuilder matchQueryBuilder = new MatchQueryBuilder("name", name);</span></code><code><span class="code-snippet_outer">        Iterable<Product> iterable = ProductRepository.search(matchQueryBuilder);</span></code><code><span class="code-snippet_outer">        iterable.forEach(e->list.add(e));</span></code><code><span class="code-snippet_outer">        return list;</span></code><code><span class="code-snippet_outer">    &#125;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">    @Override</span></code><code><span class="code-snippet_outer">    public Page<Product> pageQuery(Integer pageNo, Integer pageSize, String kw) &#123;</span></code><code><span class="code-snippet_outer">        SearchQuery searchQuery = new NativeSearchQueryBuilder()</span></code><code><span class="code-snippet_outer">                .withQuery(QueryBuilders.matchPhraseQuery("name", kw))</span></code><code><span class="code-snippet_outer">                .withPageable(PageRequest.of(pageNo, pageSize))</span></code><code><span class="code-snippet_outer">                .build();</span></code><code><span class="code-snippet_outer">        return ProductRepository.search(searchQuery);</span></code><code><span class="code-snippet_outer">    &#125;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">&#125;</span></code></pre> 
 </section> 
 <p style="text-align: center;"><span style="font-size: 14px;color: rgb(136, 136, 136);">（左右滑动查看全部代码）<br></span></p> 
 <p style="text-align: center;"><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;">以上我们展示了对es中数据的增删改查和分页查询操作。</span></p> 
 <p style="text-align: left;"><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: justify;"><strong><span style="font-size: 15px;">最后，我们写一个测试类来测试其中的方法</span></strong><span style="font-size: 15px;"><br></span></p> 
 <section class="code-snippet__fix code-snippet__js"> 
  <pre class="code-snippet__js" data-lang="java"><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">package</span> com.primeton.example;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">import</span> com.primeton.example.entity.Product;</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">import</span> com.primeton.example.service.ProductService;</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">import</span> org.junit.Test;</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">import</span> org.junit.runner.RunWith;</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">import</span> org.springframework.data.domain.Page;</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">import</span> java.util.List;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer"><span class="code-snippet__meta">@RunWith</span>(SpringRunner.class)</span></code><code><span class="code-snippet_outer"><span class="code-snippet__meta">@SpringBootTest</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">public</span> <span class="code-snippet__class"><span class="code-snippet__keyword">class</span> <span class="code-snippet__title">ElasticsearchRepositoriesTests</span> </span>&#123;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">    <span class="code-snippet__meta">@Autowired</span></span></code><code><span class="code-snippet_outer">    <span class="code-snippet__keyword">private</span> ProductService productService;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">    <span class="code-snippet__meta">@Test</span></span></code><code><span class="code-snippet_outer">    <span class="code-snippet__function"><span class="code-snippet__keyword">public</span> <span class="code-snippet__keyword">void</span> <span class="code-snippet__title">testCount</span><span class="code-snippet__params">()</span> </span>&#123;</span></code><code><span class="code-snippet_outer">        System.out.println(ProductService.count());</span></code><code><span class="code-snippet_outer">    &#125;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">    <span class="code-snippet__meta">@Test</span></span></code><code><span class="code-snippet_outer">    <span class="code-snippet__function"><span class="code-snippet__keyword">public</span> <span class="code-snippet__keyword">void</span> <span class="code-snippet__title">testInsert</span><span class="code-snippet__params">()</span> </span>&#123;</span></code><code><span class="code-snippet_outer">        Product product = <span class="code-snippet__keyword">new</span> Product();</span></code><code><span class="code-snippet_outer">        product.setProductId(<span class="code-snippet__string">"0901009001"</span>);</span></code><code><span class="code-snippet_outer">        product.setName(<span class="code-snippet__string">"奶油夹心面包（10片装）"</span>);</span></code><code><span class="code-snippet_outer">        product.setCategory(<span class="code-snippet__string">"101"</span>);</span></code><code><span class="code-snippet_outer">        product.setPrice(<span class="code-snippet__number">880</span>);</span></code><code><span class="code-snippet_outer">        product.setBrand(<span class="code-snippet__string">"徐福记"</span>);</span></code><code><span class="code-snippet_outer">        productService.save(product);</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">        product = <span class="code-snippet__keyword">new</span> Product();</span></code><code><span class="code-snippet_outer">        product.setProductId(<span class="code-snippet__string">"0901009002"</span>);</span></code><code><span class="code-snippet_outer">        product.setName(<span class="code-snippet__string">"切片面包（10片装）"</span>);</span></code><code><span class="code-snippet_outer">        product.setCategory(<span class="code-snippet__string">"101"</span>);</span></code><code><span class="code-snippet_outer">        product.setPrice(<span class="code-snippet__number">680</span>);</span></code><code><span class="code-snippet_outer">        product.setBrand(<span class="code-snippet__string">"巴莉甜甜"</span>);</span></code><code><span class="code-snippet_outer">        productService.save(product);</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">        product = <span class="code-snippet__keyword">new</span> Product();</span></code><code><span class="code-snippet_outer">        product.setProductId(<span class="code-snippet__string">"0901009004"</span>);</span></code><code><span class="code-snippet_outer">        product.setName(<span class="code-snippet__string">"原味吐司850g"</span>);</span></code><code><span class="code-snippet_outer">        product.setCategory(<span class="code-snippet__string">"101"</span>);</span></code><code><span class="code-snippet_outer">        product.setPrice(<span class="code-snippet__number">720</span>);</span></code><code><span class="code-snippet_outer">        product.setBrand(<span class="code-snippet__string">"采蝶轩"</span>);</span></code><code><span class="code-snippet_outer">        productService.save(product);</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">    &#125;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">    <span class="code-snippet__meta">@Test</span></span></code><code><span class="code-snippet_outer">    <span class="code-snippet__function"><span class="code-snippet__keyword">public</span> <span class="code-snippet__keyword">void</span> <span class="code-snippet__title">testDelete</span><span class="code-snippet__params">()</span> </span>&#123;</span></code><code><span class="code-snippet_outer">        Product product = <span class="code-snippet__keyword">new</span> Product();</span></code><code><span class="code-snippet_outer">        product.setProductId(<span class="code-snippet__string">"0901009002"</span>);</span></code><code><span class="code-snippet_outer">        productService.delete(product);</span></code><code><span class="code-snippet_outer">    &#125;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">    <span class="code-snippet__meta">@Test</span></span></code><code><span class="code-snippet_outer">    <span class="code-snippet__function"><span class="code-snippet__keyword">public</span> <span class="code-snippet__keyword">void</span> <span class="code-snippet__title">testGetAll</span><span class="code-snippet__params">()</span> </span>&#123;</span></code><code><span class="code-snippet_outer">        Iterable<Product> iterable = productService.getAll();</span></code><code><span class="code-snippet_outer">        iterable.forEach(e->System.out.println(e.toString()));</span></code><code><span class="code-snippet_outer">    &#125;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">    <span class="code-snippet__meta">@Test</span></span></code><code><span class="code-snippet_outer">    <span class="code-snippet__function"><span class="code-snippet__keyword">public</span> <span class="code-snippet__keyword">void</span> <span class="code-snippet__title">testGetByName</span><span class="code-snippet__params">()</span> </span>&#123;</span></code><code><span class="code-snippet_outer">        List<Product> list = productService.getByName(<span class="code-snippet__string">"面包"</span>);</span></code><code><span class="code-snippet_outer">        System.out.println(list);</span></code><code><span class="code-snippet_outer">    &#125;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">    <span class="code-snippet__meta">@Test</span></span></code><code><span class="code-snippet_outer">    <span class="code-snippet__function"><span class="code-snippet__keyword">public</span> <span class="code-snippet__keyword">void</span> <span class="code-snippet__title">testPage</span><span class="code-snippet__params">()</span> </span>&#123;</span></code><code><span class="code-snippet_outer">        Page<Product> page = productService.pageQuery(<span class="code-snippet__number">0</span>, <span class="code-snippet__number">10</span>, <span class="code-snippet__string">"切片"</span>);</span></code><code><span class="code-snippet_outer">        System.out.println(page.getTotalPages());</span></code><code><span class="code-snippet_outer">        System.out.println(page.getNumber());</span></code><code><span class="code-snippet_outer">        System.out.println(page.getContent());</span></code><code><span class="code-snippet_outer">    &#125;</span></code><code><span class="code-snippet_outer">&#125;</span></code></pre> 
 </section> 
 <p style="text-align: center;"><span style="font-size: 14px;color: rgb(136, 136, 136);">（左右滑动查看全部代码）<br></span></p> 
 <p style="text-align: center;"><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;">以上，就是使用Spring Data Elasticsearch Repositories 操作Elasticsearch的demo示例。</span></p> 
 <p style="text-align: left;"><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: left;"><strong><span style="font-size: 15px;">2. 使用ElasticsearchTemplate操作Elasticsearch</span></strong><span style="font-size: 15px;"><br></span></p> 
 <section class="code-snippet__fix code-snippet__js"> 
  <pre class="code-snippet__js" data-lang="java"><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">package com.primeton.example;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">import com.primeton.example.entity.Product;</span></code><code><span class="code-snippet_outer">import org.elasticsearch.index.query.QueryBuilders;</span></code><code><span class="code-snippet_outer">import org.junit.Test;</span></code><code><span class="code-snippet_outer">import org.junit.runner.RunWith;</span></code><code><span class="code-snippet_outer">import org.springframework.beans.factory.annotation.Autowired;</span></code><code><span class="code-snippet_outer">import org.springframework.boot.test.context.SpringBootTest;</span></code><code><span class="code-snippet_outer">import org.springframework.data.elasticsearch.core.ElasticsearchTemplate;</span></code><code><span class="code-snippet_outer">import org.springframework.data.elasticsearch.core.query.*;</span></code><code><span class="code-snippet_outer">import org.springframework.test.context.junit4.SpringRunner;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">import java.util.List;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">@RunWith(SpringRunner.class)</span></code><code><span class="code-snippet_outer">@SpringBootTest</span></code><code><span class="code-snippet_outer">public class ElasticsearchTemplateTest &#123;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">    @Autowired</span></code><code><span class="code-snippet_outer">    public ElasticsearchTemplate elasticsearchTemplate;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">    @Test</span></code><code><span class="code-snippet_outer">    public void testInsert() &#123;</span></code><code><span class="code-snippet_outer">        Product product = new Product();</span></code><code><span class="code-snippet_outer">        product.setProductId("0901009005");</span></code><code><span class="code-snippet_outer">        product.setName("葡萄吐司面包（10片装）");</span></code><code><span class="code-snippet_outer">        product.setCategory("101");</span></code><code><span class="code-snippet_outer">        product.setPrice(560);</span></code><code><span class="code-snippet_outer">        product.setBrand("采蝶轩");</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">        IndexQuery indexQuery = new IndexQueryBuilder().withObject(product).build();</span></code><code><span class="code-snippet_outer">        elasticsearchTemplate.index(indexQuery);</span></code><code><span class="code-snippet_outer">    &#125;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">    @Test</span></code><code><span class="code-snippet_outer">    public void testQuery() &#123;</span></code><code><span class="code-snippet_outer">        SearchQuery searchQuery = new NativeSearchQueryBuilder()</span></code><code><span class="code-snippet_outer">                .withQuery(QueryBuilders.matchQuery("name", "吐司"))</span></code><code><span class="code-snippet_outer">                .build();</span></code><code><span class="code-snippet_outer">        List<Product> list = elasticsearchTemplate.queryForList(searchQuery, Product.class);</span></code><code><span class="code-snippet_outer">        System.out.println(list);</span></code><code><span class="code-snippet_outer">    &#125;</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">&#125;</span></code></pre> 
 </section> 
 <p style="text-align: center;"><span style="font-size: 14px;color: rgb(136, 136, 136);">（左右滑动查看全部代码）</span><br></p> 
 <p style="text-align: left;"><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;">引入的ElasticsearchTemplate是自动装配的：<br></span></p> 
 <p style="text-align: left;"><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: center;"><img class="rich_pages" data-ratio="0.3756645008860012" data-s="300,640" src="https://oscimg.oschina.net/oscnet/10262875-cabc-4b01-936e-9b90eedbedb3.png" data-type="png" data-w="1693" style referrerpolicy="no-referrer"></p> 
 <p style="text-align: left;"><span style="font-size: 15px;"></span><span style="font-size: 15px;"><br></span></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;">以上，就是使用ElasticsearchTemplate 操作Elasticsearch的demo示例。<br></span></p> 
 <p style="text-align: left;"><br></p> 
 <section style="white-space: normal;line-height: 25.6px;"> 
  <section style="margin-top: 25px;margin-bottom: 25px;border-bottom: 1px solid black;text-align: center;line-height: 1.75em;"> 
   <section style="margin-bottom: -1px;display: inline-block;border-bottom: 6px solid rgb(95, 156, 239);border-top-color: rgb(95, 156, 239);border-right-color: rgb(95, 156, 239);border-left-color: rgb(95, 156, 239);color: rgb(95, 156, 239);"> 
    <p style="font-size: 4px;"><span style="color: rgb(74, 148, 231);font-size: 18px;letter-spacing: 1px;">6.总结<br></span></p> 
   </section> 
  </section> 
 </section> 
 <p style="text-align: left;"><br></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;">由于篇幅有限，本篇文章给大家介绍了Elasticsearch的基本概念，Elasticsearch具有哪些功能、特点以及使用场景，Elasticsearch的倒排索引结构、并且我们从实战的角度将Elasticsearch和Springboot整合到了一起，使其可以成为一个基础的搜索服务，给系统中其它的微服务应用提供服务。</span></p> 
 <p style="text-align: justify;"><br></p> 
 <p style="text-align: justify;"><span style="font-size: 15px;">Elasticsearch不仅仅是一个搜索引擎，同时它还是一个优秀的分布式系统，其分布式架构非常值得我们学习，下一篇文章，将重点讨论Elasticsearch的分布式架构，希望能从其架构中学到一些架构经验，为我们自己构建一个分布式系统提供一些方向。<br></span></p> 
 <p style="text-align: left;"><br></p> 
 <section data-color="#b6e4fd" data-custom="#b6e4fd" style="border-width: 0px;border-style: none;border-color: initial;"> 
  <section> 
   <section> 
    <section> 
     <p><span style="letter-spacing: 1px;"><strong style="color: rgb(62, 62, 62);letter-spacing: 0px;font-size: 15px;">推荐阅读</strong><br></span></p> 
    </section> 
   </section> 
  </section> 
 </section> 
 <section data-color="#b6e4fd" data-custom="#b6e4fd" style="border-width: 0px;border-style: none;border-color: initial;"> 
  <section style="margin-top: 0.5em;margin-bottom: 0.5em;"> 
   <section style="height: 1px;background-color: rgb(182, 228, 253);color: rgb(5, 115, 175);"> 
    <br> 
   </section> 
  </section> 
 </section> 
 <p style="line-height: 2em;"><a target="_blank" href="https://www.oschina.net/action/GoToLink?url=http%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI5MDEzMzg5Nw%3D%3D%26mid%3D2660408512%26idx%3D1%26sn%3D6586db02c25832cc6644e0785184cb5e%26chksm%3Df742be26c035373099a0ce3f82b227ff0893577fe34b795baed689fe43956603c9975beda2e5%26scene%3D21%23wechat_redirect" textvalue="微服务平台之全链路追踪" data-itemshowtype="0" tab="innerlink" style="text-decoration: underline;" data-linktype="2"><span style="font-size: 14px;">微服务平台之全链路追踪</span></a></p> 
 <p><a target="_blank" href="https://www.oschina.net/action/GoToLink?url=http%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI5MDEzMzg5Nw%3D%3D%26mid%3D2660406999%26idx%3D1%26sn%3D762efad26e0f61106bb20817d17fb20a%26chksm%3Df742b431c0353d2732a04fb61e483f545c738ffe4f42f21ef54236c6b07e405831da30455e99%26scene%3D21%23wechat_redirect" textvalue="微服务平台之API授权" data-itemshowtype="0" tab="innerlink" data-linktype="2"><span style="font-size: 14px;text-decoration: underline;">微服务平台之API授权</span></a><span style="font-size: 14px;text-decoration: underline;"><br></span></p> 
 <p><span style="font-size: 14px;text-decoration: underline;"><a target="_blank" href="https://www.oschina.net/action/GoToLink?url=http%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI5MDEzMzg5Nw%3D%3D%26mid%3D2660403257%26idx%3D1%26sn%3Dc2c72f81d696b8d38d13ea75e6b261f2%26chksm%3Df742aadfc03523c947f0072eb79227ffadd315178163ab4e7debf7ee456d52c2e229524d0c57%26scene%3D21%23wechat_redirect" textvalue="微服务平台之网关架构与应用" data-itemshowtype="0" tab="innerlink" data-linktype="2">微服务平台之网关架构与应用</a></span><br></p> 
 <p><br></p> 
 <p style="white-space: normal;color: rgb(62, 62, 62);font-size: 15px;letter-spacing: 1px;background-color: rgb(255, 255, 255);"><img data-cropselx1="0" data-cropselx2="124" data-cropsely1="0" data-cropsely2="175" data-ratio="1.415" data-s="300,640" src="https://oscimg.oschina.net/oscnet/3120ec43-5cb7-4269-b7fc-1d0b2e5875e7.png" data-type="png" data-w="600" style="width: 124px;float: left;height: 175px;" referrerpolicy="no-referrer"><span style="font-size: 14px;"><strong style="text-indent: 0em;">关于作者</strong><span style="text-indent: 0em;">：</span>西西西西索，现任普元微服务团队java开发工程师，长期致力于IT技术研究，微服务架构设计和开发等工作。擅长springboot、springcloud、elasticsearch、kafka等技术。先后参加EOS MS5.0GA、EOS PLATFORM 8.1LA、上海公安项目的研发工作。</span></p> 
 <p style="white-space: normal;color: rgb(62, 62, 62);font-size: 15px;letter-spacing: 1px;background-color: rgb(255, 255, 255);"><br></p> 
 <p style="text-align: left;"><img data-cropselx1="0" data-cropselx2="126" data-cropsely1="0" data-cropsely2="119" data-ratio="0.9326612903225806" data-s="300,640" src="https://oscimg.oschina.net/oscnet/7044a1bd-3348-47f4-b8ee-1890e31fb6f1.png" data-type="png" data-w="2480" style="font-size: 16px;float: left;width: 127px;box-sizing: border-box !important;visibility: visible !important;height: auto !important;" referrerpolicy="no-referrer"><strong style="text-indent: 0em;"><span style="font-size: 14px;">关于EAWorld</span></strong><span style="text-indent: 0em;font-size: 14px;">：微服务，DevOps，数据治理，移动架构原创技术分享。<strong>长按二维码关注！</strong></span></p> 
 <p style="text-align: left;"><br></p> 
</div> 
<p style="color: #858585; font-size: 13px;">本文分享自微信公众号 - EAWorld（eaworld）。<br>如有侵权，请联系 support@oschina.cn 删除。<br>本文参与“<a href="https://www.oschina.net/sharing-plan" target="_blank">OSC源创计划</a>”，欢迎正在阅读的你也加入，一起分享。</p>
                                        </div>
                                      
</div>
            