
---
title: 'Rust 1.54.0 发布，默认重新启用增量编译'
categories: 
 - 编程
 - 开源中国
 - 资讯
headimg: 'https://picsum.photos/400/300?random=235'
author: 开源中国
comments: false
date: Sun, 01 Aug 2021 07:41:00 GMT
thumbnail: 'https://picsum.photos/400/300?random=235'
---

<div>   
<div class="content">
                                                                                            <p>Rust 1.54.0 现已<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fblog.rust-lang.org%2F2021%2F07%2F29%2FRust-1.54.0.html" target="_blank">发布</a>，具体更新内容如下：</p> 
<h4><strong>属性可以调用 function-like macros</strong></h4> 
<p>Rust 1.54 支持在属性中调用 function-like macros。Function-like macros 可以是基于 macro_rules! 的，也可以是像macro!(...) 那样被调用的 procedural macros。这方面一个值得注意的用例是将其他文件的文档纳入 Rust 文档的注释中。例如，如果你的项目的 README 是一个很好的文档注释，你可以使用 include_str! 来直接合并内容。</p> 
<pre><code>#![doc = include_str!("README.md")]
</code></pre> 
<p>宏也可以嵌套在属性中，例如包含由构建脚本生成的内容：</p> 
<pre><code>#[path = concat!(env!("OUT_DIR"), "/generated.rs")]
mod generated;
</code></pre> 
<p>阅读<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Frust-lang%2Frust%2Fpull%2F83366" target="_blank">此处</a>了解更多详情。</p> 
<h4><strong>wasm32 intrinsics 稳定化</strong></h4> 
<p>wasm32 平台的许多 intrinsics 已经稳定，可以访问 WebAssembly 中的 SIMD 指令。</p> 
<p>值得注意的是，与之前稳定的 x86 和 x86_64 intrinsics 不同，这些没有安全要求，只有在适当的目标特性被启用时才能被调用。这是因为 WebAssembly 从一开始就是为了在执行代码之前安全地验证代码而编写的，因此可以保证指令被正确解码（或者根本不解码）。</p> 
<p>这意味着我们可以将一些 intrinsics 公开为完全安全的函数，例如<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fbeta%2Fcore%2Farch%2Fwasm32%2Ffn.v128_bitselect.html" target="_blank"><code>v128_bitselect</code></a>。 但是，仍然有一些 intrinsics 是不安全的，因为它们使用了原始指针，例如<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fbeta%2Fcore%2Farch%2Fwasm32%2Ffn.v128_load.html" target="_blank"><code>v128_load</code></a>。</p> 
<h4><strong>默认情况下重新启用增量编译</strong></h4> 
<p>在 <a href="https://www.oschina.net/news/141129/rust-1-52-1-released">1.52.1</a> 中默认禁用增量编译后，此版本中默认重新启用了增量编译。</p> 
<p>在 Rust 1.52 中，当从磁盘缓存加载增量编译数据时，增加了额外的验证。这导致了许多预先存在的潜在问题被发现，因为验证将这些错误变成了内部编译器错误（ICE）。目前仍存在两个已知问题可能会导致 ICE。由于缺乏自动崩溃报告，开发团队无法确定未决问题的全部影响程度。但是，根据其从受 1.52 版本影响的用户那里收到的反馈，他们认为剩余的问题在实践中很少见。 因此，在此版本中重新启用了增量编译。</p> 
<h4><strong>稳定的 API</strong></h4> 
<ul> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fstd%2Fcollections%2Fstruct.BTreeMap.html%23method.into_keys" target="_blank"><code>BTreeMap::into_keys</code></a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fstd%2Fcollections%2Fstruct.BTreeMap.html%23method.into_values" target="_blank"><code>BTreeMap::into_values</code></a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fstd%2Fcollections%2Fstruct.HashMap.html%23method.into_keys" target="_blank"><code>HashMap::into_keys</code></a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fstd%2Fcollections%2Fstruct.HashMap.html%23method.into_values" target="_blank"><code>HashMap::into_values</code></a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fcore%2Farch%2Fwasm32%2Findex.html" target="_blank"><code>arch::wasm32</code></a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fstd%2Fcollections%2Fstruct.VecDeque.html%23method.binary_search" target="_blank"><code>VecDeque::binary_search</code></a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fstd%2Fcollections%2Fstruct.VecDeque.html%23method.binary_search_by" target="_blank"><code>VecDeque::binary_search_by</code></a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fstd%2Fcollections%2Fstruct.VecDeque.html%23method.binary_search_by_key" target="_blank"><code>VecDeque::binary_search_by_key</code></a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fstd%2Fcollections%2Fstruct.VecDeque.html%23method.partition_point" target="_blank"><code>VecDeque::partition_point</code></a></li> 
</ul> 
<h3><strong>其他变化</strong></h3> 
<p>Rust 1.54.0 版本中还有其他更改：可查看 <a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Frust-lang%2Frust%2Fblob%2Fmaster%2FRELEASES.md%23version-1540-2021-07-29" target="_blank">Rust</a>、<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Frust-lang%2Fcargo%2Fblob%2Fmaster%2FCHANGELOG.md%23cargo-154-2021-07-29" target="_blank">Cargo</a> 和 <a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Frust-lang%2Frust-clippy%2Fblob%2Fmaster%2FCHANGELOG.md%23rust-154" target="_blank">Clippy 中的</a>更改。</p> 
<p>rustfmt 也在 1.54.0 版本中得到修复，以正确格式化嵌套的外联模块。这可能会导致 1.53.0 rustfmt 忽略的文件格式发生变化。<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Frust-lang%2Frust%2Fpull%2F86424" target="_blank">在此处</a>查看详细信息。</p> 
<p>有关更多信息，可参见<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Frust-lang%2Frust%2Fblob%2Fmaster%2FRELEASES.md%23version-1540-2021-07-29" target="_blank">详细的发行说明</a>。</p>
                                        </div>
                                      
</div>
            