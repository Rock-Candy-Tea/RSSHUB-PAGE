
---
title: 'Ruby 3.1.0 发布'
categories: 
 - 编程
 - 开源中国
 - 资讯
headimg: 'https://cache.ruby-lang.org/pub/media/ruby310_typeprof_ide_demo.png'
author: 开源中国
comments: false
date: Sat, 25 Dec 2021 23:58:00 GMT
thumbnail: 'https://cache.ruby-lang.org/pub/media/ruby310_typeprof_ide_demo.png'
---

<div>   
<div class="content">
                                                                                            <p style="margin-left:0; margin-right:0; text-align:left"><span><span><span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#dddad6; color:#111111"><span><span><span><span><span><span><span><span><span><span><span><span data-darkreader-inline-bgcolor style="--darkreader-inline-bgcolor:#181a1b; background-color:#ffffff"><span><span><span>我们很高兴地宣布 Ruby 3.1.0 的发布。Ruby 3.1 保持与 Ruby 3.0 的兼容性，并添加了许多功能。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<h2 style="margin-left:0; margin-right:0; text-align:left"><span><span><span><span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#d64d46; color:#cc342d"><span><span><span><span><span><span><span><span><span><span><span><span data-darkreader-inline-bgcolor style="--darkreader-inline-bgcolor:#181a1b; background-color:#ffffff"><span><span><span>YJIT：新的实验性进程内 JIT 编译器</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></h2> 
<p style="margin-left:0; margin-right:0; text-align:left"><span><span><span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#dddad6; color:#111111"><span><span><span><span><span><span><span><span><span><span><span><span data-darkreader-inline-bgcolor style="--darkreader-inline-bgcolor:#181a1b; background-color:#ffffff"><span><span><span>Ruby 3.1 合并了 YJIT，这是 Shopify 开发的一种新的进程内 JIT 编译器。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<p style="margin-left:0; margin-right:0; text-align:left"><span><span><span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#dddad6; color:#111111"><span><span><span><span><span><span><span><span><span><span><span><span data-darkreader-inline-bgcolor style="--darkreader-inline-bgcolor:#181a1b; background-color:#ffffff"><span><span><span>自从<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.ruby-lang.org%2Fen%2Fnews%2F2018%2F12%2F25%2Fruby-2-6-0-released%2F" target="_blank">2018</a>年<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.ruby-lang.org%2Fen%2Fnews%2F2018%2F12%2F25%2Fruby-2-6-0-released%2F" target="_blank">Ruby 2.6 引入了 MJIT 后</a>，它的性能有了很大的提升，最终<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.ruby-lang.org%2Fen%2Fnews%2F2020%2F12%2F25%2Fruby-3-0-0-released%2F" target="_blank">我们在去年实现了 Ruby3x3</a>。但是，尽管 Optcarrot 已经显示出令人印象深刻的加速，但 JIT 并没有使现实世界的业务应用程序受益。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<p style="margin-left:0; margin-right:0; text-align:left"><span><span><span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#dddad6; color:#111111"><span><span><span><span><span><span><span><span><span><span><span><span data-darkreader-inline-bgcolor style="--darkreader-inline-bgcolor:#181a1b; background-color:#ffffff"><span><span><span>最近 Shopify 贡献了许多 Ruby 改进来加速他们的 Rails 应用程序。YJIT 是一个重要的贡献，旨在提高 Rails 应用程序的性能。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<p style="margin-left:0; margin-right:0; text-align:left"><span><span><span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#dddad6; color:#111111"><span><span><span><span><span><span><span><span><span><span><span><span data-darkreader-inline-bgcolor style="--darkreader-inline-bgcolor:#181a1b; background-color:#ffffff"><span><span><span>尽管 MJIT 是基于方法的 JIT 编译器并使用外部 C 编译器，但 YJIT 使用基本块版本控制并在其中包含 JIT 编译器。使用 Lazy Basic Block Versioning (LBBV)，它首先编译方法的开头，并在动态确定参数和变量的类型时增量编译其余部分。有关详细介绍，请参阅<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdl.acm.org%2Fdoi%2F10.1145%2F3486606.3486781" target="_blank">YJIT：用于 CRuby 的基本块版本控制 JIT 编译器</a>。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<p style="margin-left:0; margin-right:0; text-align:left"><span><span><span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#dddad6; color:#111111"><span><span><span><span><span><span><span><span><span><span><span><span data-darkreader-inline-bgcolor style="--darkreader-inline-bgcolor:#181a1b; background-color:#ffffff"><span><span><span>通过这项技术，YJIT 在大多数现实世界的软件上实现了快速预热时间和性能改进，在 railsbench 上高达 22%，在液体渲染上高达 39%。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<p style="margin-left:0; margin-right:0; text-align:left"><span><span><span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#dddad6; color:#111111"><span><span><span><span><span><span><span><span><span><span><span><span data-darkreader-inline-bgcolor style="--darkreader-inline-bgcolor:#181a1b; background-color:#ffffff"><span><span><span>YJIT 仍然是一个实验性功能，因此默认情况下它是禁用的。如果要使用它，请指定<code class="language-plaintext">--yjit</code>命令行选项以启用 YJIT。目前它也仅限于类 Unix 的 x86-64 平台。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<ul style="margin-left:0; margin-right:0"> 
 <li>https://bugs.ruby-lang.org/issues/18229</li> 
 <li>https://shopify.engineering/yjit-just-in-time-compiler-cruby</li> 
 <li>https://www.youtube.com/watch?v=PBVLf3yfMs8</li> 
</ul> 
<h2 style="margin-left:0; margin-right:0; text-align:left"><span><span><span><span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#d64d46; color:#cc342d"><span><span><span><span><span><span><span><span><span><span><span><span data-darkreader-inline-bgcolor style="--darkreader-inline-bgcolor:#181a1b; background-color:#ffffff"><span><span><span>debug gem：一个新的调试器</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></h2> 
<p style="margin-left:0; margin-right:0; text-align:left"><span><span><span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#dddad6; color:#111111"><span><span><span><span><span><span><span><span><span><span><span><span data-darkreader-inline-bgcolor style="--darkreader-inline-bgcolor:#181a1b; background-color:#ffffff"><span><span><span>捆绑了一个完全重写的调试器<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Fruby%2Fdebug" target="_blank">debug.gem</a>。debug.gem 有以下特点：</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<ul style="margin-left:0; margin-right:0"> 
 <li>提高调试性能（即使使用调试器也不会减慢应用程序的速度）</li> 
 <li>支持远程调试</li> 
 <li>支持丰富的调试前端（现在支持VSCode和Chrome浏览器）</li> 
 <li>支持多进程/多线程调试</li> 
 <li>多彩的REPL</li> 
 <li>以及其他有用的功能，如记录和重放功能、跟踪功能等。</li> 
</ul> 
<p> </p> 
<div class="vsc-controller vsc-nosource">
  
</div> 
<p> 
 <video autoplay="autoplay" controls="controls" height="510" poster="https://cache.ruby-lang.org/pub/media/ruby310_debug_demo.jpg" width="764">
   
 </video> </p> 
<p style="margin-left:0; margin-right:0; text-align:left"><span><span><span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#dddad6; color:#111111"><span><span><span><span><span><span><span><span><span><span><span><span data-darkreader-inline-bgcolor style="--darkreader-inline-bgcolor:#181a1b; background-color:#ffffff"><span><span><span>Ruby 捆绑了 lib/debug.rb，但它没有得到很好的维护，并且在性能和特性方面存在问题。debug.gem 完全取代了 lib/debug.rb。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<h2 style="margin-left:0; margin-right:0; text-align:left"><span><span><span><span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#d64d46; color:#cc342d"><span><span><span><span><span><span><span><span><span><span><span><span data-darkreader-inline-bgcolor style="--darkreader-inline-bgcolor:#181a1b; background-color:#ffffff"><span><span><span>error_highlight：回溯中的细粒度错误位置</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></h2> 
<p style="margin-left:0; margin-right:0; text-align:left"><span><span><span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#dddad6; color:#111111"><span><span><span><span><span><span><span><span><span><span><span><span data-darkreader-inline-bgcolor style="--darkreader-inline-bgcolor:#181a1b; background-color:#ffffff"><span><span><span>已引入内置 gem error_highlight。它包括回溯中的细粒度错误位置：</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<div style="text-align:left"> 
 <div> 
  <pre><span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#dddad6; color:#111111"><span><span><span><span><span><span><span><span><span><span><span><span data-darkreader-inline-bgcolor style="--darkreader-inline-bgcolor:#181a1b; background-color:#ffffff"><span><span><span><span><span><span data-darkreader-inline-bgcolor style="--darkreader-inline-bgcolor:#1c1e1f; background-color:#f8f8f8"><span><span><span><span><span><span><span><span><code>$ ruby test.rb test.rb:1:in `<main>': undefined method `time' for 1:Integer (NoMethodError) 1.time &#123;&#125; ^^^^^ Did you mean? times </code></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre> 
 </div> 
</div> 
<p style="margin-left:0; margin-right:0; text-align:left"><span><span><span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#dddad6; color:#111111"><span><span><span><span><span><span><span><span><span><span><span><span data-darkreader-inline-bgcolor style="--darkreader-inline-bgcolor:#181a1b; background-color:#ffffff"><span><span><span>目前，仅<code class="language-plaintext">NameError</code>支持。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<p style="margin-left:0; margin-right:0; text-align:left"><span><span><span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#dddad6; color:#111111"><span><span><span><span><span><span><span><span><span><span><span><span data-darkreader-inline-bgcolor style="--darkreader-inline-bgcolor:#181a1b; background-color:#ffffff"><span><span><span>默认情况下启用此 gem。您可以使用命令行选项禁用它<code class="language-plaintext">--disable-error_highlight</code>。详细查看<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Fruby%2Ferror_highlight" target="_blank">存储库</a>。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<h2 style="margin-left:0; margin-right:0; text-align:left"><span><span><span><span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#d64d46; color:#cc342d"><span><span><span><span><span><span><span><span><span><span><span><span data-darkreader-inline-bgcolor style="--darkreader-inline-bgcolor:#181a1b; background-color:#ffffff"><span><span><span>IRB 自动完成和文档显示</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></h2> 
<p style="margin-left:0; margin-right:0; text-align:left"><span><span><span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#dddad6; color:#111111"><span><span><span><span><span><span><span><span><span><span><span><span data-darkreader-inline-bgcolor style="--darkreader-inline-bgcolor:#181a1b; background-color:#ffffff"><span><span><span>IRB 现在具有自动完成功能，您只需在其中输入代码，就会出现完成候选对话框。您可以使用 Tab 和 Shift+Tab 上下移动。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<p style="margin-left:0; margin-right:0; text-align:left"><span><span><span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#dddad6; color:#111111"><span><span><span><span><span><span><span><span><span><span><span><span data-darkreader-inline-bgcolor style="--darkreader-inline-bgcolor:#181a1b; background-color:#ffffff"><span><span><span>如果在选择完成候选时安装了文档，则完成候选对话框旁边将出现文档对话框，显示部分内容。您可以按 Alt+d 阅读完整文档。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<p> </p> 
<div class="vsc-controller vsc-nosource">
  
</div> 
<p> 
 <video autoplay="autoplay" controls="controls" height="510" poster="https://cache.ruby-lang.org/pub/media/ruby310_irb_dialog.png" width="764">
   
 </video> </p> 
<h2 style="margin-left:0; margin-right:0; text-align:left"><span><span><span><span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#d64d46; color:#cc342d"><span><span><span><span><span><span><span><span><span><span><span><span data-darkreader-inline-bgcolor style="--darkreader-inline-bgcolor:#181a1b; background-color:#ffffff"><span><span><span>其他值得注意的新功能</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></h2> 
<h3 style="margin-left:0; margin-right:0; text-align:left"><span><span><span><span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#d64d46; color:#cc342d"><span><span><span><span><span><span><span><span><span><span><span><span data-darkreader-inline-bgcolor style="--darkreader-inline-bgcolor:#181a1b; background-color:#ffffff"><span><span><span>语法改进</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></h3> 
<ul style="margin-left:0; margin-right:0"> 
 <li>哈希文字和关键字参数中的值可以省略。[功能#14579] 
  <ul style="margin-left:0; margin-right:0"> 
   <li><code class="language-plaintext">&#123;x:, y:&#125;</code>是 的语法糖<code class="language-plaintext">&#123;x: x, y: y&#125;</code>。</li> 
   <li><code class="language-plaintext">foo(x:, y:)</code>是 的语法糖<code class="language-plaintext">foo(x: x, y: y)</code>。</li> 
  </ul> </li> 
 <li>模式匹配中的 Pin 运算符现在采用表达式。[功能#17411]</li> 
</ul> 
<div style="text-align:left"> 
 <div> 
  <pre><span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#dddad6; color:#111111"><span><span><span><span><span><span><span><span><span><span><span><span data-darkreader-inline-bgcolor style="--darkreader-inline-bgcolor:#181a1b; background-color:#ffffff"><span><span><span><span><span><span data-darkreader-inline-bgcolor style="--darkreader-inline-bgcolor:#1c1e1f; background-color:#f8f8f8"><span><span><span><span><span><span><span><span><code><span><span data-darkreader-inline-color style="--darkreader-inline-color:#72ffff; color:teal">Prime</span></span><span>.</span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#ff6161; color:#990000"><strong>each_cons</strong></span></span><span>(</span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#61ffff; color:#009999">2</span></span><span>).</span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#ff6161; color:#990000"><strong>lazy</strong></span></span><span>.</span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#ff6161; color:#990000"><strong>find_all</strong></span></span><span>&#123;</span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#c8c3bc; color:#333333">_1</span></span> <span><strong>in</strong></span> <span>[</span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#c8c3bc; color:#333333">n</span></span><span>,</span> <span><strong>^</strong></span><span>(</span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#c8c3bc; color:#333333">n</span></span> <span><strong>+</strong></span> <span><span data-darkreader-inline-color style="--darkreader-inline-color:#61ffff; color:#009999">2</span></span><span>)]&#125;.</span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#ff6161; color:#990000"><strong>take</strong></span></span><span>(</span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#61ffff; color:#009999">3</span></span><span>).</span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#ff6161; color:#990000"><strong>to_a</strong></span></span> <span><span data-darkreader-inline-color style="--darkreader-inline-color:#a29a8e; color:#999988"><em>#=> [[3, 5], [5, 7], [11, 13]]</em></span></span> </code></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre> 
 </div> 
</div> 
<ul style="margin-left:0; margin-right:0"> 
 <li>单行模式匹配中可以省略括号。[功能#16182]</li> 
</ul> 
<div style="text-align:left"> 
 <div> 
  <pre><span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#dddad6; color:#111111"><span><span><span><span><span><span><span><span><span><span><span><span data-darkreader-inline-bgcolor style="--darkreader-inline-bgcolor:#181a1b; background-color:#ffffff"><span><span><span><span><span><span data-darkreader-inline-bgcolor style="--darkreader-inline-bgcolor:#1c1e1f; background-color:#f8f8f8"><span><span><span><span><span><span><span><span><code><span>[</span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#61ffff; color:#009999">0</span></span><span>,</span> <span><span data-darkreader-inline-color style="--darkreader-inline-color:#61ffff; color:#009999">1</span></span><span>]</span> <span><strong>=></strong></span> <span><span data-darkreader-inline-color style="--darkreader-inline-color:#c8c3bc; color:#333333">_</span></span><span>,</span> <span><span data-darkreader-inline-color style="--darkreader-inline-color:#c8c3bc; color:#333333">x</span></span> <span>&#123;</span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#ff61d8; color:#990073">y: </span></span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#61ffff; color:#009999">2</span></span><span>&#125;</span> <span><strong>=></strong></span> <span><span data-darkreader-inline-color style="--darkreader-inline-color:#ff61d8; color:#990073">y: </span></span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#c8c3bc; color:#333333">x</span></span> <span><span data-darkreader-inline-color style="--darkreader-inline-color:#a29a8e; color:#999988"><em>#=> 1</em></span></span> <span><span data-darkreader-inline-color style="--darkreader-inline-color:#c8c3bc; color:#333333">y</span></span> <span><span data-darkreader-inline-color style="--darkreader-inline-color:#a29a8e; color:#999988"><em>#=> 2</em></span></span> </code></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre> 
 </div> 
</div> 
<h3 style="margin-left:0; margin-right:0; text-align:left"><span><span><span><span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#d64d46; color:#cc342d"><span><span><span><span><span><span><span><span><span><span><span><span data-darkreader-inline-bgcolor style="--darkreader-inline-bgcolor:#181a1b; background-color:#ffffff"><span><span><span>RBS</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></h3> 
<p style="margin-left:0; margin-right:0; text-align:left"><span><span><span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#dddad6; color:#111111"><span><span><span><span><span><span><span><span><span><span><span><span data-darkreader-inline-bgcolor style="--darkreader-inline-bgcolor:#181a1b; background-color:#ffffff"><span><span><span>RBS 是一种描述 Ruby 程序结构的语言。有关详细信息，请参阅<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Fruby%2Frbs" target="_blank">存储库</a>。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<p style="margin-left:0; margin-right:0; text-align:left"><span><span><span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#dddad6; color:#111111"><span><span><span><span><span><span><span><span><span><span><span><span data-darkreader-inline-bgcolor style="--darkreader-inline-bgcolor:#181a1b; background-color:#ffffff"><span><span><span>自 Ruby 3.0.0 以来的更新：</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<ul style="margin-left:0; margin-right:0"> 
 <li>泛型类型参数可以是有界的。(<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Fruby%2Frbs%2Fpull%2F844" target="_blank">公关</a>)</li> 
 <li>支持通用类型别名。(<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Fruby%2Frbs%2Fpull%2F823" target="_blank">公关</a>)</li> 
 <li><code class="language-plaintext">rbs collection</code>已被引入管理 gems 的 RBS。(<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Fruby%2Frbs%2Fblob%2Fmaster%2Fdocs%2Fcollection.md" target="_blank">文档</a>)</li> 
 <li>添加/更新了许多内置和标准库的签名。</li> 
 <li>它还包括许多错误修复和性能改进。</li> 
</ul> 
<p style="margin-left:0; margin-right:0; text-align:left"><span><span><span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#dddad6; color:#111111"><span><span><span><span><span><span><span><span><span><span><span><span data-darkreader-inline-bgcolor style="--darkreader-inline-bgcolor:#181a1b; background-color:#ffffff"><span><span><span>有关更多信息，请参阅<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Fruby%2Frbs%2Fblob%2Fmaster%2FCHANGELOG.md" target="_blank">CHANGELOG.md</a>。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<h3 style="margin-left:0; margin-right:0; text-align:left"><span><span><span><span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#d64d46; color:#cc342d"><span><span><span><span><span><span><span><span><span><span><span><span data-darkreader-inline-bgcolor style="--darkreader-inline-bgcolor:#181a1b; background-color:#ffffff"><span><span><span>TypeProf</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></h3> 
<p style="margin-left:0; margin-right:0; text-align:left"><span><span><span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#dddad6; color:#111111"><span><span><span><span><span><span><span><span><span><span><span><span data-darkreader-inline-bgcolor style="--darkreader-inline-bgcolor:#181a1b; background-color:#ffffff"><span><span><span>TypeProf 是 Ruby 的静态类型分析器。它从非类型注释的 Ruby 代码生成 RBS 的原型。有关详细信息，请参阅<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Fruby%2Ftypeprof%2Fblob%2Fmaster%2Fdoc%2Fdoc.md" target="_blank">文档</a>。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<p style="margin-left:0; margin-right:0; text-align:left"><span><span><span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#dddad6; color:#111111"><span><span><span><span><span><span><span><span><span><span><span><span data-darkreader-inline-bgcolor style="--darkreader-inline-bgcolor:#181a1b; background-color:#ffffff"><span><span><span>自 Ruby 3.0.0 以来的主要更新是一个名为“TypeProf for IDE”的实验性 IDE 支持。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<p style="margin-left:0; margin-right:0; text-align:left"><span><span><span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#dddad6; color:#111111"><span><span><span><span><span><span><span><span><span><span><span><span data-darkreader-inline-bgcolor style="--darkreader-inline-bgcolor:#181a1b; background-color:#ffffff"><span><span><span><img alt="IDE 的 TypeProf 演示" src="https://cache.ruby-lang.org/pub/media/ruby310_typeprof_ide_demo.png" referrerpolicy="no-referrer"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<p style="margin-left:0; margin-right:0; text-align:left"><span><span><span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#dddad6; color:#111111"><span><span><span><span><span><span><span><span><span><span><span><span data-darkreader-inline-bgcolor style="--darkreader-inline-bgcolor:#181a1b; background-color:#ffffff"><span><span><span>vscode 扩展在每个方法定义上方显示一个猜测的（或明确写在 RBS 文件中的）方法签名，在可能导致名称错误或类型错误的代码下画一个红色下划线，并完成方法名称（即显示方法候选） . 详细看<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Fruby%2Ftypeprof%2Fblob%2Fmaster%2Fdoc%2Fide.md" target="_blank">文档</a>。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<p style="margin-left:0; margin-right:0; text-align:left"><span><span><span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#dddad6; color:#111111"><span><span><span><span><span><span><span><span><span><span><span><span data-darkreader-inline-bgcolor style="--darkreader-inline-bgcolor:#181a1b; background-color:#ffffff"><span><span><span>此外，该版本还包括许多错误修复和性能改进。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<h2 style="margin-left:0; margin-right:0; text-align:left"><span><span><span><span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#d64d46; color:#cc342d"><span><span><span><span><span><span><span><span><span><span><span><span data-darkreader-inline-bgcolor style="--darkreader-inline-bgcolor:#181a1b; background-color:#ffffff"><span><span><span>性能改进</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></h2> 
<ul style="margin-left:0; margin-right:0"> 
 <li><span data-darkreader-inline-bgcolor data-darkreader-inline-color style="--darkreader-inline-bgcolor:#181a1b; --darkreader-inline-color:#dddad6; background-color:#ffffff; color:#111111">MJIT</span> <p> </p> 
  <ul style="margin-left:0; margin-right:0"> 
   <li>对于 Rails 等工作负载，默认值<code class="language-plaintext">--jit-max-cache</code>从 100 更改为 10000。JIT 编译器不再跳过长度超过 1000 条指令的方法的编译。</li> 
   <li>为了支持 Rails 的 Zeitwerk，当启用类事件的 TracePoint 时，不再取消 JIT-ed 代码。</li> 
  </ul> </li> 
</ul> 
<h2 style="margin-left:0; margin-right:0; text-align:left"><span><span><span><span><span><span data-darkreader-inline-color style="--darkreader-inline-color:#d64d46; color:#cc342d"><span><span><span><span><span><span><span><span><span><span><span><span data-darkreader-inline-bgcolor style="--darkreader-inline-bgcolor:#181a1b; background-color:#ffffff"><span><span><span>自 3.0 以来的其他显着变化</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></h2> 
<ul style="margin-left:0; margin-right:0"> 
 <li>单行模式匹配，例如 ，<code class="language-plaintext">ary => [x, y, z]</code>不再是实验性的。</li> 
 <li>多重分配评估顺序略有变化。<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fbugs.ruby-lang.org%2Fissues%2F4443" target="_blank">[错误 #4443]</a> 
  <ul style="margin-left:0; margin-right:0"> 
   <li><code class="language-plaintext">foo[0], bar[0] = baz, qux</code>评价为了<code class="language-plaintext">baz</code>，<code class="language-plaintext">qux</code>，<code class="language-plaintext">foo</code>，然后<code class="language-plaintext">bar</code>在红宝石3.0。在 Ruby 3.1 中，它按照<code class="language-plaintext">foo</code>、<code class="language-plaintext">bar</code>、<code class="language-plaintext">baz</code>、 然后 的顺序进行计算<code class="language-plaintext">qux</code>。</li> 
  </ul> </li> 
 <li> <p style="margin-left:0; margin-right:0"><span><span><span>可变宽度分配：字符串（实验性）<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fbugs.ruby-lang.org%2Fissues%2F18239" target="_blank">[Bug #18239]</a></span></span></span></p> </li> 
 <li>Psych 4.0 更改<code class="language-plaintext">Psych.load</code>为<code class="language-plaintext">safe_load</code>默认设置。您可能需要使用 Psych 3.3.2 才能迁移到此行为。 <a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fbugs.ruby-lang.org%2Fissues%2F17866" target="_blank">[错误 #17866]</a></li> 
</ul>
                                        </div>
                                      
</div>
            