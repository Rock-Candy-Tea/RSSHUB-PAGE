
---
title: 'F# 6 正式发布'
categories: 
 - 编程
 - 开源中国
 - 资讯
headimg: 'https://picsum.photos/400/300?random=2690'
author: 开源中国
comments: false
date: Wed, 10 Nov 2021 07:59:00 GMT
thumbnail: 'https://picsum.photos/400/300?random=2690'
---

<div>   
<div class="content">
                                                                                            <p><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdevblogs.microsoft.com%2Fdotnet%2Ffsharp-6-is-officially-here%2F" target="_blank">F# 6 已正式发布</a>。F# 6 属于 .NET 6 的一部分，与 .NET 6 一起发布，主要变化包括基于任务的异步、管道调试和其他许多功能，可以让代码更简单、性能更高。</p> 
<p>F# 6 包含在 Visual Studio 2022 和 .NET SDK 6.0.100 中。查看 <a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdevblogs.microsoft.com%2Fvisualstudio%2Fvisual-studio-2022-now-available%2F" target="_blank">Visual Studio 2022</a> 和 <a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdevblogs.microsoft.com%2Fdotnet%2Fannouncing-net-6%2F" target="_blank">.NET 6.0</a> 的发布公告了解如何安装 Visual Studio 或 .NET SDK 。</p> 
<p>F# 6 增加了对 F# 语言和 F# 交互窗口的几项改进。</p> 
<ul> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdocs.microsoft.com%2Fzh-cn%2Fdotnet%2Ffsharp%2Fwhats-new%2Ffsharp-6%23task-" target="_blank">task &#123;...&#125;</a></li> 
</ul> 
<p>F# 6 在 F# 代码中提供了对编写 .NET 任务的原生支持。 例如，使用以下 F# 代码创建 .NET 兼容任务：</p> 
<pre><code class="language-cs">let readFilesTask (path1, path2) =
   async &#123;
        let! bytes1 = File.ReadAllBytesAsync(path1) |> Async.AwaitTask
        let! bytes2 = File.ReadAllBytesAsync(path2) |> Async.AwaitTask
        return Array.append bytes1 bytes2
   &#125; |> Async.StartAsTask</code></pre> 
<p>使用 F# 6 可以重写此代码，如下所示：</p> 
<pre><code class="language-cs">let readFilesTask (path1, path2) =
   task &#123;
        let! bytes1 = File.ReadAllBytesAsync(path1)
        let! bytes2 = File.ReadAllBytesAsync(path2)
        return Array.append bytes1 bytes2
   &#125;</code></pre> 
<ul> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdocs.microsoft.com%2Fzh-cn%2Fdotnet%2Ffsharp%2Fwhats-new%2Ffsharp-6%23simpler-indexing-syntax-with-expridx" target="_blank">更简单的索引语法 expr[idx]</a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdocs.microsoft.com%2Fzh-cn%2Fdotnet%2Ffsharp%2Fwhats-new%2Ffsharp-6%23struct-representations-for-partial-active-patterns" target="_blank">部分活动模式的结构表示形式</a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdocs.microsoft.com%2Fzh-cn%2Fdotnet%2Ffsharp%2Fwhats-new%2Ffsharp-6%23overloaded-custom-operations-in-computation-expressions" target="_blank">计算表达式中的重载自定义操作</a></li> 
</ul> 
<p style="color:#171717; margin-left:0; margin-right:0; text-align:start">F# 6 支持使用<span> </span><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdocs.microsoft.com%2Fzh-cn%2Fdotnet%2Fcsharp%2Fwhats-new%2Ftutorials%2Fdefault-interface-methods-versions" target="_blank">具有默认实现的接口</a>，使用计算表达式生成器<span> </span><code>content</code><span> </span>：</p> 
<pre><code class="language-cs">let mem = new System.IO.MemoryStream("Stream"B)
let content = ContentBuilder()
let ceResult =
    content &#123;
        body "Name"
        body (ArraySegment<_>("Email"B, 0, 5))
        body "Password"B 2 4
        body "BYTES"B
        body mem
        body "Description" "of" "content"
    &#125;</code></pre> 
<p><span style="background-color:#ffffff; color:#171717">此处的<span> </span></span><code>body</code><span style="background-color:#ffffff; color:#171717"><span> </span>自定义操作使用不同类型的不同参数。这是使用重载的以下生成器的实现所支持的：</span></p> 
<pre><code class="language-cs">type Content = ArraySegment<byte> list

type ContentBuilder() =
    member _.Run(c: Content) =
        let crlf = "\r\n"B
        [|for part in List.rev c do
            yield! part.Array[part.Offset..(part.Count+part.Offset-1)]
            yield! crlf |]

    member _.Yield(_) = []

    [<CustomOperation("body")>]
    member _.Body(c: Content, segment: ArraySegment<byte>) =
        segment::c

    [<CustomOperation("body")>]
    member _.Body(c: Content, bytes: byte[]) =
        ArraySegment<byte>(bytes, 0, bytes.Length)::c

    [<CustomOperation("body")>]
    member _.Body(c: Content, bytes: byte[], offset, count) =
        ArraySegment<byte>(bytes, offset, count)::c

    [<CustomOperation("body")>]
    member _.Body(c: Content, content: System.IO.Stream) =
        let mem = new System.IO.MemoryStream()
        content.CopyTo(mem)
        let bytes = mem.ToArray()
        ArraySegment<byte>(bytes, 0, bytes.Length)::c

    [<CustomOperation("body")>]
    member _.Body(c: Content, [<ParamArray>] contents: string[]) =
        List.rev [for c in contents -> let b = Text.Encoding.ASCII.GetBytes c in ArraySegment<_>(b,0,b.Length)] @ c</code></pre> 
<ul> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdocs.microsoft.com%2Fzh-cn%2Fdotnet%2Ffsharp%2Fwhats-new%2Ffsharp-6%23as-patterns" target="_blank">"as" 模式</a></li> 
</ul> 
<p><span style="background-color:#ffffff; color:#171717">在 F# 6 中，模式的右侧<span> </span></span><code>as</code><span style="background-color:#ffffff; color:#171717"><span> </span>现在可以是模式。 当类型测试为输入提供了更强的类型时，这一点非常重要。 例如以下代码：</span></p> 
<pre><code class="language-cs">type Pair = Pair of int * int

let analyzeObject (input: obj) =
    match input with
    | :? (int * int) as (x, y) -> printfn $"A tuple: &#123;x&#125;, &#123;y&#125;"
    | :? Pair as Pair (x, y) -> printfn $"A DU: &#123;x&#125;, &#123;y&#125;"
    | _ -> printfn "Nope"

let input = box (1, 2)</code></pre> 
<ul> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdocs.microsoft.com%2Fzh-cn%2Fdotnet%2Ffsharp%2Fwhats-new%2Ffsharp-6%23indentation-syntax-revisions" target="_blank">缩进语法修订</a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdocs.microsoft.com%2Fzh-cn%2Fdotnet%2Ffsharp%2Fwhats-new%2Ffsharp-6%23additional-implicit-conversions" target="_blank">其他隐式转换</a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdocs.microsoft.com%2Fzh-cn%2Fdotnet%2Ffsharp%2Fwhats-new%2Ffsharp-6%23formatting-for-binary-numbers" target="_blank">二进制数字的格式设置</a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdocs.microsoft.com%2Fzh-cn%2Fdotnet%2Ffsharp%2Fwhats-new%2Ffsharp-6%23discards-on-use-bindings" target="_blank">使用绑定时放弃</a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdocs.microsoft.com%2Fzh-cn%2Fdotnet%2Ffsharp%2Fwhats-new%2Ffsharp-6%23inlineiflambda" target="_blank">InlineIfLambda</a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdocs.microsoft.com%2Fzh-cn%2Fdotnet%2Ffsharp%2Fwhats-new%2Ffsharp-6%23resumable-code" target="_blank">可恢复代码</a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdocs.microsoft.com%2Fzh-cn%2Fdotnet%2Ffsharp%2Fwhats-new%2Ffsharp-6%23additional-collection-functions" target="_blank">其他集合函数</a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdocs.microsoft.com%2Fzh-cn%2Fdotnet%2Ffsharp%2Fwhats-new%2Ffsharp-6%23map-has-keys-and-values" target="_blank">Map 包含键和值</a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdocs.microsoft.com%2Fzh-cn%2Fdotnet%2Ffsharp%2Fwhats-new%2Ffsharp-6%23additional-intrinsics-for-nativeptr" target="_blank">NativePtr 的其他内部函数</a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdocs.microsoft.com%2Fzh-cn%2Fdotnet%2Ffsharp%2Fwhats-new%2Ffsharp-6%23additional-numeric-types-with-unit-annotations" target="_blank">具有单位批注的其他数值类型</a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdocs.microsoft.com%2Fzh-cn%2Fdotnet%2Ffsharp%2Fwhats-new%2Ffsharp-6%23informational-warnings-for-rarely-used-symbolic-operators" target="_blank">很少使用的符号运算符的信息性警告</a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdocs.microsoft.com%2Fzh-cn%2Fdotnet%2Ffsharp%2Fwhats-new%2Ffsharp-6%23f-tooling-net-6-the-default-for-scripting-in-visual-studio" target="_blank">F # 工具： .NET 6 用于脚本编写的默认 Visual Studio</a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdocs.microsoft.com%2Fzh-cn%2Fdotnet%2Ffsharp%2Fwhats-new%2Ffsharp-6%23f-tooling-pin-the-sdk-version-of-your-f-scripts" target="_blank">F # 工具：固定 F # 脚本的 SDK 版本</a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdocs.microsoft.com%2Fzh-cn%2Fdotnet%2Ffsharp%2Fwhats-new%2Ffsharp-6%23removing-legacy-features" target="_blank">删除旧功能</a></li> 
</ul> 
<p><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdocs.microsoft.com%2Fzh-cn%2Fdotnet%2Ffsharp%2Fwhats-new%2Ffsharp-6" target="_blank">详情查看 F# 6 新特性说明</a>和<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdevblogs.microsoft.com%2Fdotnet%2Fwhats-new-in-fsharp-6%2F" target="_blank">新特性介绍</a>。</p>
                                        </div>
                                      
</div>
            