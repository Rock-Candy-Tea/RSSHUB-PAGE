
---
title: '​Volcano 社区 v1.6.0 版本正式发布'
categories: 
 - 编程
 - 开源中国
 - 资讯
headimg: 'https://oscimg.oschina.net/oscnet/up-c977a77c2e625c61d15233299b579b2434b.png'
author: 开源中国
comments: false
date: Sun, 19 Jun 2022 07:17:00 GMT
thumbnail: 'https://oscimg.oschina.net/oscnet/up-c977a77c2e625c61d15233299b579b2434b.png'
---

<div>   
<div class="content">
                                                                    
                                                        <p>Volcano社区v1.6.0版本已正式发布。此次版本增加了弹性作业管理、基于真实负载的动态调度、 基于真实负载的重调度、Volcano Job插件——MPI等多个新特性。</p> 
<p><span style="color:#000000"><strong>Volcano v1.6.0<span> </span><span>关键特性介绍</span></strong></span></p> 
<p><strong>1.弹性作业调度</strong></p> 
<p><span>v1.6.0版本新增了弹性作业的调度支持，配合Volcano Job或Pytorch Job的弹性作业管理，实现AI训练任务、大数据分析的加速，同时结合云上的Spot instance 实现成本的缩减。</span></p> 
<p><span>弹性作业允许Job的副本数在[min, max]范围弹性伸缩，其中min为job的minAvailable，max为job的副本数，弹性调度会优先为minAvailable Pod分配资源，保障每个应用的最小资源需求优先满足，如果有闲置资源，调度器会为Elastic Pod分配资源，加速计算进程。资源紧张时，调度器优先抢占Elastic Pod实现缩容。同时调度器也会平衡不同优先级的弹性作业间的资源分配，如支持高优先级作业抢占低优先级作业的弹性副本部分的资源。</span></p> 
<p><img alt src="https://oscimg.oschina.net/oscnet/up-c977a77c2e625c61d15233299b579b2434b.png" referrerpolicy="no-referrer"></p> 
<p><span><strong><span>设计文档：</span></strong></span><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Fvolcano-sh%2Fvolcano%2Fblob%2Fmaster%2Fdocs%2Fdesign%2Felastic-scheduler.md" target="_blank"><span style="color:#0080ff">https://github.com/volcano-sh/volcano/blob/master/docs/design/elastic-scheduler.md</span></a></p> 
<p><span><strong><span>Issue</span></strong><strong><span>：</span></strong></span><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Fvolcano-sh%2Fvolcano%2Fblob%2Fmaster%2Fdocs%2Fdesign%2Felastic-scheduler.md" target="_blank"><span style="color:#0080ff">https://github.com/volcano-sh/volcano/issues/1876</span></a></p> 
<p><strong><span>2.基于真实负载的动态调度</span></strong></p> 
<p><span>当前的基于分配率的调度模式在一些场景下会带来各个节点资源使用率不均衡的现象，如部分节点高分配率、低使用率等。v1.6.0版本中Volcano实现了和Prometheus的协同，借助Prometheus采集的集群节点负载数据进行调度决策，保证各个节点使用率最大程度均衡，同时允许用户配置节点cpu，memory的上限值，防止部分节点使用率过高导致节点异常</span></p> 
<p><strong><span>调度</span></strong><span style="color:#000000"><strong><span>策略配置样例如下：</span></strong></span></p> 
<pre style="margin-left:0; margin-right:0"><code><span><span style="color:#000000">actions: "enqueue, allocate, backfill"</span></span></code><code><span>tiers:</span></code><code><span>- plugins:</span></code><code><span>- name: priority</span></code><code><span>- name: gang</span></code><code><span>- name: conformance</span></code><code><span>- name: usage  # usage based scheduling plugin</span></code><code><span>arguments:</span></code><code><span>thresholds:</span></code><code><span>CPUUsageAvg.5m: 90 # The node whose average usage in 5 minute is higher than 90% will be filtered in predicating stage</span></code><code><span>MEMUsageAvg.5m: 80 # The node whose average usage in 5 minute is higher than 80% will be filtered in predicating stage</span></code><code><span>- plugins:</span></code><code><span>- name: overcommit</span></code><code><span>- name: drf</span></code><code><span>- name: predicates</span></code><code><span>- name: proportion</span></code><code><span>- name: nodeorder</span></code><code><span>- name: binpack</span></code><code><span>metrics:                    # metrics server related configuration</span></code><code><span>address: http://192.168.0.10:9090 # mandatory, The Prometheus server address</span></code><code><span>interval: 30s                    # Optional, The scheduler pull metrics from Prometheus with this interval, 5s by default</span></code></pre> 
<p><span><strong><span>设计文档：</span></strong></span><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Fvolcano-sh%2Fvolcano%2Fblob%2Fmaster%2Fdocs%2Fdesign%2Fusage-based-scheduling.md" target="_blank"><span style="color:#0080ff">https://github.com/volcano-sh/volcano/blob/master/docs/design/usage-based-scheduling.md</span></a></p> 
<p><span><strong><span>Issue</span></strong><strong><span>：</span></strong></span><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Fvolcano-sh%2Fvolcano%2Fissues%2F1777" target="_blank"><span style="color:#0080ff">https://github.com/volcano-sh/volcano/issues/1777</span></a></p> 
<p><strong>3.<span>基于真实负载的重调度</span></strong></p> 
<p style="color:#222222; margin-left:0; margin-right:0; text-align:justify"><span>不合理的调度策略和作业生命周期的动态变化导致计算节点资源利用率不均衡，v1.6.0版本增加了基于真实负载和用户自定义重调度策略，驱逐部分高负载节点中的负载至低负载节点，周期性检测所有节点真实负载。即基于实际资源利用率而不是请求资源重新计划pod，支持定制配置的重新调度策略。</span></p> 
<p style="color:#222222; margin-left:0; margin-right:0; text-align:justify"><span>以上运行进一步平衡了各节点真实负载，提高集群资源利用率。</span></p> 
<pre style="margin-left:0; margin-right:0"><code><span>## Configuration Option actions: "enqueue, allocate, backfill, shuffle"  ## add 'shuffle' at the end of the actionstiers:</span></code><code><span>  - plugins:</span></code><code><span>      - name: priority</span></code><code><span>      - name: gang</span></code><code><span>      - name: conformance</span></code><code><span>      - name: rescheduling       ## rescheduling plugin</span></code><code><span>        arguments:</span></code><code><span>          interval: 5m           ## optional, the strategies will be called in this duration periodcally. 5 minuters by default.</span></code><code><span>          strategies:            ## required, strategies working in order</span></code><code><span>            - name: offlineOnly</span></code><code><span>            - name: lowPriorityFirst</span></code><code><span>            - name: lowNodeUtilization</span></code><code><span>              params:</span></code><code><span>                thresholds:</span></code><code><span>                  "cpu" : 20</span></code><code><span>                  "memory": 20</span></code><code><span>                  "pods": 20</span></code><code><span>                targetThresholds:</span></code><code><span>                  "cpu" : 50</span></code><code><span>                  "memory": 50</span></code><code><span>                  "pods": 50</span></code><code><span>          queueSelector:         ## optional, select workloads in specified queues as potential evictees. All queues by default.</span></code><code><span>            - default</span></code><code><span>            - test-queue</span></code><code><span>          labelSelector:         ## optional, select workloads with specified labels as potential evictees. All labels by default.</span></code><code><span>            business: offline</span></code><code><span>            team: test</span></code><code><span>  - plugins:</span></code><code><span>      - name: overcommit</span></code><code><span>      - name: drf</span></code><code><span>      - name: predicates</span></code><code><span>      - name: proportion</span></code><code><span>      - name: nodeorder</span></code><code><span>      - name: binpack</span></code></pre> 
<p><strong><span>设计文档：</span></strong><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Fvolcano-sh%2Fvolcano%2Fblob%2Fmaster%2Fdocs%2Fdesign%2Frescheduling.md" target="_blank"><span style="color:#0080ff">https://github.com/volcano-sh/volcano/blob/master/docs/design/rescheduling.md</span></a></p> 
<p><strong><span>Issue：</span></strong><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Fvolcano-sh%2Fvolcano%2Fissues%2F1777" target="_blank"><span style="color:#0080ff">https://github.com/volcano-sh/volcano/issues/1777</span></a></p> 
<p><strong>4.<span> Volcan</span></strong><strong><span>o 作业插件——MPI</span></strong></p> 
<p><span>使用Volcano Job可以运行MPI任务，Volcano作业插件(即svc，env和ssh作业插件)也为MPI任务的master和worker自动配置了免密通信、环境变量注入等工作。</span></p> 
<p><span>新版本提供了一种新的运行MPI任务的方式，进一步简化用户的配置，优化使用体验。用户无需熟悉shell语法、无需关心master和worker的通信问题、无需手动配置ssh认证，非常简洁优雅的就可以启动一个MPI任务。</span></p> 
<p><strong><span>配置文件样例：</span></strong></p> 
<pre style="margin-left:0; margin-right:0"><code><span>apiVersion: batch.volcano.sh/v1alpha1</span></code><code><span>kind: Job</span></code><code><span>metadata:</span></code><code><span> name: lm-mpi-job</span></code><code><span>spec:</span></code><code><span> minAvailable: 1</span></code><code><span> schedulerName: volcano</span></code><code><span> plugins:</span></code><code><span>   mpi: ["--master=mpimaster","--worker=mpiworker","--port=22"]  ## MPI plugin register</span></code><code><span> tasks:</span></code><code><span>   - replicas: 1</span></code><code><span>     name: mpimaster</span></code><code><span>     policies:</span></code><code><span>       - event: TaskCompleted</span></code><code><span>         action: CompleteJob</span></code><code><span>     template:</span></code><code><span>       spec:</span></code><code><span>         containers:</span></code><code><span>           - command:</span></code><code><span>               - /bin/sh</span></code><code><span>               - -c</span></code><code><span>               - |</span></code><code><span>                 mkdir -p /var/run/sshd; /usr/sbin/sshd;</span></code><code><span>                 mpiexec --allow-run-as-root --host $&#123;MPI_HOST&#125; -np 2 mpi_hello_world;</span></code><code><span>             image: volcanosh/example-mpi:0.0.1</span></code><code><span>             name: mpimaster</span></code><code><span>             workingDir: /home</span></code><code><span>         restartPolicy: OnFailure</span></code><code><span>   - replicas: 2</span></code><code><span>     name: mpiworker</span></code><code><span>     template:</span></code><code><span>       spec:</span></code><code><span>         containers:</span></code><code><span>           - command:</span></code><code><span>               - /bin/sh</span></code><code><span>               - -c</span></code><code><span>               - |</span></code><code><span>                 mkdir -p /var/run/sshd; /usr/sbin/sshd -D;</span></code><code><span>             image: volcanosh/example-mpi:0.0.1</span></code><code><span>             name: mpiworker</span></code><code><span>             workingDir: /home</span></code><code><span>            </span></code><code><span>         restartPolicy: OnFailure</span></code></pre> 
<p><strong><span>设计文档：</span></strong><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Fvolcano-sh%2Fvolcano%2Fblob%2Fmaster%2Fdocs%2Fdesign%2Frescheduling.md" target="_blank"><span style="color:#0080ff">https://github.com/volcano-sh/volcano/blob/master/docs/design/distributed-framework-plugins.md</span></a></p> 
<p><strong><span>Issue：</span></strong><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Fvolcano-sh%2Fvolcano%2Fblob%2Fmaster%2Fdocs%2Fdesign%2Frescheduling.md" target="_blank"><span style="color:#0080ff">https://github.com/volcano-sh/volcano/pull/2194</span></a></p> 
<p><span style="color:#000000"><strong><span style="color:#000000">相关链接</span></strong></span></p> 
<ul> 
 <li><strong><span>Release note：</span></strong><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Fvolcano-sh%2Fvolcano%2Freleases%2Ftag%2Fv1.6.0" target="_blank"><span style="color:#0080ff">https://github.com/volcano-sh/volcano/releases/tag/v1.6.0</span></a></li> 
 <li><strong><span>Branch：</span></strong><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Fvolcano-sh%2Fvolcano%2Ftree%2Frelease-1.6" target="_blank"><span style="color:#0080ff">https://github.com/volcano-sh/volcano/tree/release-1.6</span></a><span> </span></li> 
</ul> 
<p style="margin-left:0px; margin-right:0px; text-align:left"><strong>关于 Volcano</strong></p> 
<p style="color:#333333; margin-left:0; margin-right:0; text-align:left">Volcano 是基于 Kubernetes 构建的批量计算平台，源自于华为云 AI 容器，提供作业管理、批量调度、依赖管理、资源预留等能力，支持包括 TensorFlow、Spark、MPI、Slurm 在内的多个业界主流计算框架，主要帮助用户将 AI、大数据等资源消耗波动大、计算密集型的业务从传统的 Batch、HPC 系统快速迁移到云原生。Volcano 也是 CNCF 首个和唯一的容器批量计算项目。</p>
                                        </div>
                                      
</div>
            