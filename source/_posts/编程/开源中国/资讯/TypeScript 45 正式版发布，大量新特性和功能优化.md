
---
title: 'TypeScript 4.5 正式版发布，大量新特性和功能优化'
categories: 
 - 编程
 - 开源中国
 - 资讯
headimg: 'https://picsum.photos/400/300?random=4181'
author: 开源中国
comments: false
date: Thu, 18 Nov 2021 08:24:00 GMT
thumbnail: 'https://picsum.photos/400/300?random=4181'
---

<div>   
<div class="content">
                                                                    
                                                        <p>11月17日，微软发布了 TypeScript 4.5<strong> 正式版本 ，</strong>4.5<strong> 正式</strong>版本和 RC 版本在功能上并没有什么改动，除了添加关于新 JSDoc 特性的注释 ，不过这个特性也是 RC 版本的新功能，只是当时没有写出来。</p> 
<p>TypeScript 4.5 正式版新特性：</p> 
<ul> 
 <li>实验性功能：在夜间版本支持  Node.js 运行 ECMAScript 模块</li> 
 <li>从 node_modules 支持 <code>lib</code></li> 
 <li>新的 <code>Awaited</code> 类型和对 <code>Promise</code> 对象的优化</li> 
 <li>模板字符串可以用作判断符</li> 
 <li>引入 es2022 模块（可以在异步函数之外使用 await）</li> 
 <li>移除 Conditional Types 的尾部递归</li> 
 <li>禁用省略型 Import ，加入新的 Import 类型修饰符</li> 
 <li>现在可以检查一个对象是否有一个私有字段</li> 
 <li>支持 Import 断言</li> 
 <li><em>JSDoc 中的常量断言和默认类型参数</em></li> 
 <li>对所有系统的 Node.js 引入 <code>realpathSync.native</code> 函数， 减少项目加载时间（Windows 少了 5-13%） 。</li> 
 <li>两个新的代码补全功能：重写或实现类中的方法的片段补全、JSX 属性的代码补全</li> 
 <li>编辑器对未解析的类型会直接展示原名（之前版本是用 <code>any</code> 来代替未解析的类型）。</li> 
</ul> 
<p>关于 TypeScript 4.5 的新特性，我们在报导 TypeScript 4.5 RC 版本的时候就已经介绍过一些，包括在夜间版本支持  Node.js 运行 ECMAScript 模块、新的代码片段自动补全功能等，下面笔者再来介绍另外几个新特性：</p> 
<h2><code>Awaited</code> 类型 和 <code>Promise</code> 优化</h2> 
<p>TypeScript 4.5 引入了一种新的实用程序类型： <code>Awaited</code> 类型，这种类型是为了建模，像异步函数（<code>async</code> functions）中的 <code>await</code> 这样的操作，或者是 promise 上的 <code>.then()</code> 方法 ，总体来说就是它们递归展开 promise 的方式。</p> 
<pre style="text-align:left"><span style="color:#148a14"><span style="color:inherit">// A = string</span></span><span style="color:inherit">
</span><span style="color:#0000ff"><span style="color:inherit">type</span></span><span style="color:inherit"> </span><span style="color:#267f99"><span style="color:inherit">A</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">=</span></span><span style="color:inherit"> </span><span style="color:#267f99"><span style="color:inherit">Awaited</span></span><span style="color:inherit"><span style="color:inherit"><</span></span><span style="color:#267f99"><span style="color:inherit">Promise</span></span><span style="color:inherit"><span style="color:inherit"><</span></span><span style="color:#0000ff"><span style="color:inherit">string</span></span><span style="color:inherit"><span style="color:inherit">></span></span><span style="color:inherit"><span style="color:inherit">></span></span><span style="color:inherit"><span style="color:inherit">;</span></span><span style="color:inherit">

</span><span style="color:#148a14"><span style="color:inherit">// B = number</span></span><span style="color:inherit">
</span><span style="color:#0000ff"><span style="color:inherit">type</span></span><span style="color:inherit"> </span><span style="color:#267f99"><span style="color:inherit">B</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">=</span></span><span style="color:inherit"> </span><span style="color:#267f99"><span style="color:inherit">Awaited</span></span><span style="color:inherit"><span style="color:inherit"><</span></span><span style="color:#267f99"><span style="color:inherit">Promise</span></span><span style="color:inherit"><span style="color:inherit"><</span></span><span style="color:#267f99"><span style="color:inherit">Promise</span></span><span style="color:inherit"><span style="color:inherit"><</span></span><span style="color:#0000ff"><span style="color:inherit">number</span></span><span style="color:inherit"><span style="color:inherit">></span></span><span style="color:inherit"><span style="color:inherit">></span></span><span style="color:inherit"><span style="color:inherit">></span></span><span style="color:inherit"><span style="color:inherit">;</span></span><span style="color:inherit">

</span><span style="color:#148a14"><span style="color:inherit">// C = boolean | number</span></span><span style="color:inherit">
</span><span style="color:#0000ff"><span style="color:inherit">type</span></span><span style="color:inherit"> </span><span style="color:#267f99"><span style="color:inherit">C</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">=</span></span><span style="color:inherit"> </span><span style="color:#267f99"><span style="color:inherit">Awaited</span></span><span style="color:inherit"><span style="color:inherit"><</span></span><span style="color:#0000ff"><span style="color:inherit">boolean</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">|</span></span><span style="color:inherit"> </span><span style="color:#267f99"><span style="color:inherit">Promise</span></span><span style="color:inherit"><span style="color:inherit"><</span></span><span style="color:#0000ff"><span style="color:inherit">number</span></span><span style="color:inherit"><span style="color:inherit">></span></span><span style="color:inherit"><span style="color:inherit">></span></span><span style="color:inherit"><span style="color:inherit">;</span></span>
</pre> 
<p>该 <code>Awaited</code> 类型有利于建模现有的 API，包括像 <code>Promise.all</code> 、 <code>Promise.race</code> 这些 JavaScript 内置模板。事实上，一些关于 <code>Promise.all</code> 推理的问题是促进了 <code>Awaited</code> 类型的研究，比如这个在 TypeScript 4.4 和更早版本中失败的例子：</p> 
<pre style="text-align:left"><span style="color:#0000ff"><span style="color:inherit">eclare</span></span><span style="color:inherit"> </span><span style="color:#0000ff"><span style="color:inherit">function</span></span><span style="color:inherit"> </span><span style="color:#267f99"><span style="color:inherit">MaybePromise</span></span><span style="color:inherit"><span style="color:inherit"><</span></span><span style="color:#267f99"><span style="color:inherit">T</span></span><span style="color:inherit"><span style="color:inherit">></span></span><span style="color:inherit"><span style="color:inherit">(</span></span><span style="color:inherit"><span style="color:inherit">value</span></span><span style="color:inherit">:</span><span style="color:inherit"> </span><span style="color:#267f99"><span style="color:inherit">T</span></span><span style="color:inherit"><span style="color:inherit">)</span></span><span style="color:inherit">:</span><span style="color:inherit"> </span><span style="color:#267f99"><span style="color:inherit">T</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">|</span></span><span style="color:inherit"> </span><span style="color:#267f99"><span style="color:inherit">Promise</span></span><span style="color:inherit"><span style="color:inherit"><</span></span><span style="color:#267f99"><span style="color:inherit">T</span></span><span style="color:inherit"><span style="color:inherit">></span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">|</span></span><span style="color:inherit"> </span><span style="color:#267f99"><span style="color:inherit">PromiseLike</span></span><span style="color:inherit"><span style="color:inherit"><</span></span><span style="color:#267f99"><span style="color:inherit">T</span></span><span style="color:inherit"><span style="color:inherit">></span></span><span style="color:inherit"><span style="color:inherit">;</span></span><span style="color:inherit">

</span><span style="color:#0000ff"><span style="color:inherit">async</span></span><span style="color:inherit"> </span><span style="color:#0000ff"><span style="color:inherit">function</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">doSomething</span></span><span style="color:inherit"><span style="color:inherit">(</span></span><span style="color:inherit"><span style="color:inherit">)</span></span><span style="color:inherit">:</span><span style="color:inherit"> </span><span style="color:#267f99"><span style="color:inherit">Promise</span></span><span style="color:inherit"><span style="color:inherit"><</span></span><span style="color:inherit"><span style="color:inherit">[</span></span><span style="color:#0000ff"><span style="color:inherit">number</span></span><span style="color:inherit"><span style="color:inherit">,</span></span><span style="color:inherit"> </span><span style="color:#0000ff"><span style="color:inherit">number</span></span><span style="color:inherit"><span style="color:inherit">]</span></span><span style="color:inherit"><span style="color:inherit">></span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">&#123;</span></span><span style="color:inherit">
    </span><span style="color:#0000ff"><span style="color:inherit">const</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">result</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">=</span></span><span style="color:inherit"> </span><span style="color:#0000ff"><span style="color:inherit">await</span></span><span style="color:inherit"> </span><span style="color:#267f99"><span style="color:inherit">Promise</span></span><span style="color:inherit"><span style="color:inherit">.</span></span><span style="color:inherit"><span style="color:inherit">all</span></span><span style="color:inherit"><span style="color:inherit">(</span></span><span style="color:inherit"><span style="color:inherit">[</span></span><span style="color:inherit">
        </span><span style="color:#267f99"><span style="color:inherit">MaybePromise</span></span><span style="color:inherit"><span style="color:inherit">(</span></span><span style="color:#09885a"><span style="color:inherit">100</span></span><span style="color:inherit"><span style="color:inherit">)</span></span><span style="color:inherit"><span style="color:inherit">,</span></span><span style="color:inherit">
        </span><span style="color:#267f99"><span style="color:inherit">MaybePromise</span></span><span style="color:inherit"><span style="color:inherit">(</span></span><span style="color:#09885a"><span style="color:inherit">200</span></span><span style="color:inherit"><span style="color:inherit">)</span></span><span style="color:inherit">
    </span><span style="color:inherit"><span style="color:inherit">]</span></span><span style="color:inherit"><span style="color:inherit">)</span></span><span style="color:inherit"><span style="color:inherit">;</span></span><span style="color:inherit">

    </span><span style="color:#148a14"><span style="color:inherit">// Error!</span></span><span style="color:inherit">
    </span><span style="color:#148a14"><span style="color:inherit">//</span></span><span style="color:inherit">
    </span><span style="color:#148a14"><span style="color:inherit">//    [number | Promise<100>, number | Promise<200>]</span></span><span style="color:inherit">
    </span><span style="color:#148a14"><span style="color:inherit">//</span></span><span style="color:inherit">
    </span><span style="color:#148a14"><span style="color:inherit">// is not assignable to type</span></span><span style="color:inherit">
    </span><span style="color:#148a14"><span style="color:inherit">//</span></span><span style="color:inherit">
    </span><span style="color:#148a14"><span style="color:inherit">//    [number, number]</span></span><span style="color:inherit">
    </span><span style="color:#0000ff"><span style="color:inherit">return</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">result</span></span><span style="color:inherit"><span style="color:inherit">;</span></span><span style="color:inherit">
</span><span style="color:inherit"><span style="color:inherit">&#125;</span></span>
</pre> 
<p>在 TypeScript 4.5 中， <code>Promise.all</code> 结合 <code>await</code> 的特性以提供更好的推断结果，所以上面的例子是有效的。</p> 
<h2> 从 node_modules 支持 lib</h2> 
<p>为了确保 TypeScript 和 JavaScript 能够开箱即用，TypeScript 捆绑了一系列声明文件(.d .ts文件)。这些声明文件表示JavaScript 语言中可用的 api 和标准的浏览器 DOM api。虽然根据文件目标有一些合理的默认值，但是您可以通过在tsconfig.json 中配置 lib 设置，来挑选程序使用哪些声明文件。</p> 
<p>TypeScript 4.5 引入了一种覆盖特定内置库的方法，类似于 @types/ support 的工作方式。在决定 TypeScript 应该包含哪些 lib 文件时，它首先会在 <code>node_modules</code> 中寻找一个有作用域的 @typescript/lib-* 包。例如，当在 lib 中包含 dom 选项时，TypeScript 会使用 <code>node_modules/@typescript/lib-dom</code> 中的类型。</p> 
<p>然后可以安装一个特定的包来接管给定的库。例如，现在 TypeScript 在 @types/web 上发布 DOM api 版本。如果你想锁定你的项目到一个特定版本的 DOM api，可以添加这个到你的 package.json：</p> 
<pre style="text-align:left"><span style="color:inherit">&#123;</span><span style="color:inherit">
 </span><span style="color:#a31515"><span style="color:inherit">"dependencies"</span></span><span style="color:inherit">:</span><span style="color:inherit"> </span><span style="color:inherit">&#123;</span><span style="color:inherit">
    </span><span style="color:#a31515"><span style="color:inherit">"@typescript/lib-dom"</span></span><span style="color:inherit">:</span><span style="color:inherit"> </span><span style="color:#a31515"><span style="color:inherit"><span style="color:inherit">"</span></span><span style="color:inherit">npm:@types/web</span><span style="color:inherit"><span style="color:inherit">"</span></span></span><span style="color:inherit">
  </span><span style="color:inherit">&#125;</span><span style="color:inherit">
</span><span style="color:inherit">&#125;</span>
</pre> 
<p>从 TypeScript 4.5开始，依赖管理器的锁文件（lockfile）会确保使用的 DOM 类型的版本完全相同。</p> 
<h2>模板字符串可以用作判断符</h2> 
<p>TypeScript 4.5 可以缩小具有模板字符串类型的值，也可以将模板字符串类型识别为判断符。比如下面这组代码，以前会报错，在 4.5 可以成功进行类型检查：</p> 
<pre style="text-align:left"><span style="color:#0000ff"><span style="color:inherit">export</span></span><span style="color:inherit"> </span><span style="color:#0000ff"><span style="color:inherit">interface</span></span><span style="color:inherit"> </span><span style="color:#267f99"><span style="color:inherit">Success</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">&#123;</span></span><span style="color:inherit">
    type</span><span style="color:inherit">:</span><span style="color:inherit"> </span><span style="color:#a31515"><span style="color:inherit">`$&#123;</span></span><span style="color:#0000ff"><span style="color:inherit">string</span></span><span style="color:#a31515"><span style="color:inherit">&#125;Success`</span></span><span style="color:inherit">;</span><span style="color:inherit">
    body</span><span style="color:inherit">:</span><span style="color:inherit"> </span><span style="color:#0000ff"><span style="color:inherit">string</span></span><span style="color:inherit">;</span><span style="color:inherit">
</span><span style="color:inherit"><span style="color:inherit">&#125;</span></span><span style="color:inherit">

</span><span style="color:#0000ff"><span style="color:inherit">export</span></span><span style="color:inherit"> </span><span style="color:#0000ff"><span style="color:inherit">interface</span></span><span style="color:inherit"> </span><span style="color:#267f99"><span style="color:inherit">Error</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">&#123;</span></span><span style="color:inherit">
    type</span><span style="color:inherit">:</span><span style="color:inherit"> </span><span style="color:#a31515"><span style="color:inherit">`$&#123;</span></span><span style="color:#0000ff"><span style="color:inherit">string</span></span><span style="color:#a31515"><span style="color:inherit">&#125;Error`</span></span><span style="color:inherit">;</span><span style="color:inherit">
    message</span><span style="color:inherit">:</span><span style="color:inherit"> </span><span style="color:#0000ff"><span style="color:inherit">string</span></span><span style="color:inherit">;</span><span style="color:inherit">
</span><span style="color:inherit"><span style="color:inherit">&#125;</span></span><span style="color:inherit">

</span><span style="color:#0000ff"><span style="color:inherit">export</span></span><span style="color:inherit"> </span><span style="color:#0000ff"><span style="color:inherit">function</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">handler</span></span><span style="color:inherit"><span style="color:inherit">(</span></span><span style="color:inherit"><span style="color:inherit">r</span></span><span style="color:inherit">:</span><span style="color:inherit"> </span><span style="color:#267f99"><span style="color:inherit">Success</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">|</span></span><span style="color:inherit"> </span><span style="color:#267f99"><span style="color:inherit">Error</span></span><span style="color:inherit"><span style="color:inherit">)</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">&#123;</span></span><span style="color:inherit">
    </span><span style="color:#0000ff"><span style="color:inherit">if</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">(</span></span><span style="color:inherit"><span style="color:inherit">r</span></span><span style="color:inherit"><span style="color:inherit">.</span></span><span style="color:inherit"><span style="color:inherit">type</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">===</span></span><span style="color:inherit"> </span><span style="color:#a31515"><span style="color:inherit">"HttpSuccess"</span></span><span style="color:inherit"><span style="color:inherit">)</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">&#123;</span></span><span style="color:inherit">
        </span><span style="color:#148a14"><span style="color:inherit">// 'r' has type 'Success'</span></span><span style="color:inherit">
        </span><span style="color:#0000ff"><span style="color:inherit">let</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">token</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">=</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">r</span></span><span style="color:inherit"><span style="color:inherit">.</span></span><span style="color:inherit"><span style="color:inherit">body</span></span><span style="color:inherit"><span style="color:inherit">;</span></span><span style="color:inherit">
    </span><span style="color:inherit"><span style="color:inherit">&#125;</span></span><span style="color:inherit">
</span><span style="color:inherit"><span style="color:inherit">&#125;</span></span>
</pre> 
<p>有关此功能的更多信息，请参阅<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Fmicrosoft%2FTypeScript%2Fpull%2F46137" target="_blank">启用该特性的项</a>。</p> 
<h2><code>--module es2022</code></h2> 
<p>TypeScript 现在支持一个新 <code>module</code> 设置：  <code>es2022</code> ，es2022 的主要特性是顶层的 await ，意味着可以在异步函数之外使用 await 。</p> 
<h3>禁用省略型导入</h3> 
<p>在某些情况下，TypeScript 无法检测到你正在使用导入，比如：</p> 
<pre style="text-align:left"><span style="color:#0000ff"><span style="color:inherit">import</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">&#123;</span></span><span style="color:inherit"> </span><span style="color:#267f99"><span style="color:inherit">Animal</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">&#125;</span></span><span style="color:inherit"> </span><span style="color:#0000ff"><span style="color:inherit">from</span></span><span style="color:inherit"> </span><span style="color:#a31515"><span style="color:inherit">"./animal.js"</span></span><span style="color:inherit"><span style="color:inherit">;</span></span><span style="color:inherit">

</span><span style="color:inherit"><span style="color:inherit">eval</span></span><span style="color:inherit"><span style="color:inherit">(</span></span><span style="color:#a31515"><span style="color:inherit">"console.log(new Animal().isDangerous())"</span></span><span style="color:inherit"><span style="color:inherit">)</span></span><span style="color:inherit"><span style="color:inherit">;</span></span>
</pre> 
<p>在TypeScript 4.5中，你可以启用一个名为  <code>preserveValueImports</code> 的新标志，以防止 TypeScript 从 JavaScrip 输出中剥离任何导入的值。</p> 
<p>此问题详情可<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Fmicrosoft%2FTypeScript%2Fpull%2F44619" target="_blank">点此参阅</a>。</p> 
<h3>私有字段检查</h3> 
<p>TypeScript 4.5 支持 ECMAScript 提议，用于检查对象是否具有私有字段。现在可以编写一个具有 <code>#private</code> 字段的类， 并使用 <code>in</code> 运算符查看另一个对象是否具有相同的字段 。</p> 
<pre style="text-align:left"><span style="color:#0000ff"><span style="color:inherit">class</span></span><span style="color:inherit"> </span><span style="color:#267f99"><span style="color:inherit">Person</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">&#123;</span></span><span style="color:inherit">
    </span><span style="color:inherit">#</span><span style="color:inherit"><span style="color:inherit">name</span></span><span style="color:inherit">: </span><span style="color:#0000ff"><span style="color:inherit">string</span></span><span style="color:inherit"><span style="color:inherit">;</span></span><span style="color:inherit">
    </span><span style="color:inherit"><span style="color:inherit">constructor</span></span><span style="color:inherit"><span style="color:inherit">(</span></span><span style="color:inherit"><span style="color:inherit">name</span></span><span style="color:inherit">:</span><span style="color:inherit"> </span><span style="color:#0000ff"><span style="color:inherit">string</span></span><span style="color:inherit"><span style="color:inherit">)</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">&#123;</span></span><span style="color:inherit">
        </span><span style="color:#0000ff"><span style="color:inherit">this</span></span><span style="color:inherit"><span style="color:inherit">.</span></span><span style="color:inherit">#</span><span style="color:inherit"><span style="color:inherit">name</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">=</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">name</span></span><span style="color:inherit"><span style="color:inherit">;</span></span><span style="color:inherit">
    </span><span style="color:inherit"><span style="color:inherit">&#125;</span></span><span style="color:inherit">

    </span><span style="color:inherit"><span style="color:inherit">equals</span></span><span style="color:inherit"><span style="color:inherit">(</span></span><span style="color:inherit"><span style="color:inherit">other</span></span><span style="color:inherit">:</span><span style="color:inherit"> </span><span style="color:#0000ff"><span style="color:inherit">unknown</span></span><span style="color:inherit"><span style="color:inherit">)</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">&#123;</span></span><span style="color:inherit">
        </span><span style="color:#0000ff"><span style="color:inherit">return</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">other</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">&&</span></span><span style="color:inherit">
            </span><span style="color:#0000ff"><span style="color:inherit">typeof</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">other</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">===</span></span><span style="color:inherit"> </span><span style="color:#a31515"><span style="color:inherit">"object"</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">&&</span></span><span style="color:inherit">
            </span><span style="color:inherit">#</span><span style="color:inherit"><span style="color:inherit">name</span></span><span style="color:inherit"> </span><span style="color:#0000ff"><span style="color:inherit">in</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">other</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">&&</span></span><span style="color:inherit"> </span><span style="color:#148a14"><span style="color:inherit">// <- this is new!</span></span><span style="color:inherit">
            </span><span style="color:#0000ff"><span style="color:inherit">this</span></span><span style="color:inherit"><span style="color:inherit">.</span></span><span style="color:inherit">#</span><span style="color:inherit"><span style="color:inherit">name</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">===</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">other</span></span><span style="color:inherit"><span style="color:inherit">.</span></span><span style="color:inherit">#</span><span style="color:inherit"><span style="color:inherit">name</span></span><span style="color:inherit"><span style="color:inherit">;</span></span><span style="color:inherit">
    </span><span style="color:inherit"><span style="color:inherit">&#125;</span></span><span style="color:inherit">
</span><span style="color:inherit"><span style="color:inherit">&#125;</span></span>
</pre> 
<h3>导入断言（Import Assertions）</h3> 
<p>TypeScript 4.5 支持导入断言，这是运行时用来确保导入具有预期格式的语法。</p> 
<pre style="text-align:left"><span style="color:#0000ff"><span style="color:inherit">import</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">obj</span></span><span style="color:inherit"> </span><span style="color:#0000ff"><span style="color:inherit">from</span></span><span style="color:inherit"> </span><span style="color:#a31515"><span style="color:inherit">"./something.json"</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">assert</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">&#123;</span></span><span style="color:inherit"> </span><span style="color:#0000ff"><span style="color:inherit">type</span></span><span style="color:inherit">:</span><span style="color:inherit"> </span><span style="color:inherit">"</span><span style="color:inherit"><span style="color:inherit">json</span></span><span style="color:inherit">"</span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">&#125;</span></span><span style="color:inherit"><span style="color:inherit">;</span></span>
</pre> 
<p>这些断言的内容不会被 TypeScript 检查，因为它们特定于主机，只是让浏览器和运行时可以处理它们(可能还会出错)。</p> 
<pre style="text-align:left"><span style="color:#148a14"><span style="color:inherit">// TypeScript is fine with this.</span></span><span style="color:inherit">
</span><span style="color:#148a14"><span style="color:inherit">// But your browser? Probably not.</span></span><span style="color:inherit">
</span><span style="color:#0000ff"><span style="color:inherit">import</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">obj</span></span><span style="color:inherit"> </span><span style="color:#0000ff"><span style="color:inherit">from</span></span><span style="color:inherit"> </span><span style="color:#a31515"><span style="color:inherit">"./something.json"</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">assert</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">&#123;</span></span><span style="color:inherit">
    type</span><span style="color:inherit">:</span><span style="color:inherit"> </span><span style="color:#a31515"><span style="color:inherit">"fluffy bunny"</span></span><span style="color:inherit">
</span><span style="color:inherit"><span style="color:inherit">&#125;</span></span><span style="color:inherit"><span style="color:inherit">;</span></span>
</pre> 
<p>动态 import() 调用还可以通过第二个参数使用 import 断言，第二个参数的预期类型是由一个名为 ImportCallOptions 的新类型定义的，目前只接受 assert 属性。</p> 
<pre style="text-align:left"><span style="color:#0000ff"><span style="color:inherit">const</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">obj</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">=</span></span><span style="color:inherit"> </span><span style="color:#0000ff"><span style="color:inherit">await</span></span><span style="color:inherit"> </span><span style="color:#0000ff"><span style="color:inherit">import</span></span><span style="color:inherit"><span style="color:inherit">(</span></span><span style="color:#a31515"><span style="color:inherit">"./something.json"</span></span><span style="color:inherit"><span style="color:inherit">,</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">&#123;</span></span><span style="color:inherit">
    </span><span style="color:inherit"><span style="color:inherit">assert</span></span><span style="color:inherit">:</span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">&#123;</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">type</span></span><span style="color:inherit">:</span><span style="color:inherit"> </span><span style="color:#a31515"><span style="color:inherit">"json"</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">&#125;</span></span><span style="color:inherit">
</span><span style="color:inherit"><span style="color:inherit">&#125;</span></span><span style="color:inherit"><span style="color:inherit">)</span></span>
</pre> 
<h2>JSDoc 中的常量断言和默认类型参数</h2> 
<p>TypeScript 4.5 为 JSDoc 支持带来了一些额外的表现力，其中一个是 <code>const</code> 断言，可以通过在字面量后面写 <code>const</code> 来获得更精确、更不可变的类型。</p> 
<pre style="text-align:left"><span style="color:#148a14"><span style="color:inherit">// type is &#123; prop: string &#125;</span></span><span style="color:inherit">
</span><span style="color:#0000ff"><span style="color:inherit">let</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">a</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">=</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">&#123;</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">prop</span></span><span style="color:inherit">:</span><span style="color:inherit"> </span><span style="color:#a31515"><span style="color:inherit">"hello"</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">&#125;</span></span><span style="color:inherit"><span style="color:inherit">;</span></span><span style="color:inherit">

</span><span style="color:#148a14"><span style="color:inherit">// type is &#123; readonly prop: "hello" &#125;</span></span><span style="color:inherit">
</span><span style="color:#0000ff"><span style="color:inherit">let</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">b</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">=</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">&#123;</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">prop</span></span><span style="color:inherit">:</span><span style="color:inherit"> </span><span style="color:#a31515"><span style="color:inherit">"hello"</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">&#125;</span></span><span style="color:inherit"> </span><span style="color:#0000ff"><span style="color:inherit">as</span></span><span style="color:inherit"> </span><span style="color:#0000ff"><span style="color:inherit">const</span></span><span style="color:inherit"><span style="color:inherit">;</span></span>
</pre> 
<p>在 JavaScript 文件中，现在可以使用 JSDoc 类型断言来实现相同的功能：</p> 
<pre style="text-align:left"><span style="color:#148a14"><span style="color:inherit">// type is &#123; prop: string &#125;</span></span><span style="color:inherit">
</span><span style="color:#0000ff"><span style="color:inherit">let</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">a</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">=</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">&#123;</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">prop</span></span><span style="color:inherit">:</span><span style="color:inherit"> </span><span style="color:#a31515"><span style="color:inherit">"hello"</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">&#125;</span></span><span style="color:inherit"><span style="color:inherit">;</span></span><span style="color:inherit">

</span><span style="color:#148a14"><span style="color:inherit">// type is &#123; readonly prop: "hello" &#125;</span></span><span style="color:inherit">
</span><span style="color:#0000ff"><span style="color:inherit">let</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">b</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">=</span></span><span style="color:inherit"> </span><span style="color:#148a14"><span style="color:inherit">/** </span><span style="color:inherit"><span style="color:inherit">@type</span></span><span style="color:inherit"> &#123;const&#125; */</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">(</span></span><span style="color:inherit"><span style="color:inherit">&#123;</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">prop</span></span><span style="color:inherit">:</span><span style="color:inherit"> </span><span style="color:#a31515"><span style="color:inherit">"hello"</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">&#125;</span></span><span style="color:inherit"><span style="color:inherit">)</span></span><span style="color:inherit"><span style="color:inherit">;</span></span>
</pre> 
<p>JSDoc 类型断言的注释以 <code>/** @type &#123;TheTypeWeWant&#125; */</code> 开头，后面跟着一个圆括号表达式：</p> 
<pre style="text-align:left"><span style="color:#148a14"><span style="color:inherit">/** </span><span style="color:inherit"><span style="color:inherit">@type</span></span><span style="color:inherit"> &#123;TheTypeWeWant&#125; */</span></span><span style="color:inherit">` </span><span style="color:inherit"><span style="color:inherit">(</span></span><span style="color:inherit"><span style="color:inherit">someExpression</span></span><span style="color:inherit"><span style="color:inherit">)</span></span>
</pre> 
<p>TypeScript 4.5 为 JSDoc 添加了默认类型参数，这意味着在 TypeScript 中有以下类型声明：</p> 
<pre style="text-align:left"><span style="color:#0000ff"><span style="color:inherit">type</span></span><span style="color:inherit"> </span><span style="color:#267f99"><span style="color:inherit">Foo</span></span><span style="color:inherit"><span style="color:inherit"><</span></span><span style="color:#267f99"><span style="color:inherit">T</span></span><span style="color:inherit"> </span><span style="color:#0000ff"><span style="color:inherit">extends</span></span><span style="color:inherit"> </span><span style="color:#0000ff"><span style="color:inherit">string</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">|</span></span><span style="color:inherit"> </span><span style="color:#0000ff"><span style="color:inherit">number</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">=</span></span><span style="color:inherit"> </span><span style="color:#0000ff"><span style="color:inherit">number</span></span><span style="color:inherit"><span style="color:inherit">></span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">=</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">&#123;</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">prop</span></span><span style="color:inherit">:</span><span style="color:inherit"> </span><span style="color:#267f99"><span style="color:inherit">T</span></span><span style="color:inherit"> </span><span style="color:inherit"><span style="color:inherit">&#125;</span></span><span style="color:inherit"><span style="color:inherit">;</span></span>
</pre> 
<p>可以在 JavaScript 中重写为以下的 @typedef 声明：</p> 
<pre style="text-align:left"><span style="color:#148a14"><span style="color:inherit">/**</span></span><span style="color:inherit">
</span><span style="color:#148a14"><span style="color:inherit"> * </span><span style="color:inherit"><span style="color:inherit">@template</span></span><span style="color:inherit"> &#123;string | number&#125; [T=number]</span></span><span style="color:inherit">
</span><span style="color:#148a14"><span style="color:inherit"> * </span><span style="color:inherit"><span style="color:inherit">@typedef</span></span><span style="color:inherit"> Foo</span></span><span style="color:inherit">
</span><span style="color:#148a14"><span style="color:inherit"> * </span><span style="color:inherit"><span style="color:inherit">@property</span></span><span style="color:inherit"> prop &#123;</span><span style="color:#267f99"><span style="color:inherit">T</span></span><span style="color:inherit">&#125;</span></span><span style="color:inherit">
</span><span style="color:#148a14"><span style="color:inherit"> */</span></span><span style="color:inherit">

</span><span style="color:#148a14"><span style="color:inherit">// or</span></span><span style="color:inherit">

</span><span style="color:#148a14"><span style="color:inherit">/**</span></span><span style="color:inherit">
</span><span style="color:#148a14"><span style="color:inherit"> * </span><span style="color:inherit"><span style="color:inherit">@template</span></span><span style="color:inherit"> &#123;string | number&#125; [T=number]</span></span><span style="color:inherit">
</span><span style="color:#148a14"><span style="color:inherit"> * </span><span style="color:inherit"><span style="color:inherit">@typedef</span></span><span style="color:inherit"> &#123;&#123; prop: T &#125;&#125; Foo</span></span><span style="color:inherit">
</span><span style="color:#148a14"><span style="color:inherit"> */</span></span>
</pre> 
<p>有关 TypeScript 4.5 的更多详尽信息，可查看<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdevblogs.microsoft.com%2Ftypescript%2Fannouncing-typescript-4-5%2F" target="_blank">微软发布博客原文</a>。</p> 
<p> </p>
                                        </div>
                                      
</div>
            