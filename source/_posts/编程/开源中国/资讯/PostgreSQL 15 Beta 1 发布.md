
---
title: 'PostgreSQL 15 Beta 1 发布'
categories: 
 - 编程
 - 开源中国
 - 资讯
headimg: 'https://picsum.photos/400/300?random=771'
author: 开源中国
comments: false
date: Sat, 21 May 2022 07:06:00 GMT
thumbnail: 'https://picsum.photos/400/300?random=771'
---

<div>   
<div class="content">
                                                                                            <p>PostgreSQL 15 的第一个 beta 版本现已<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.postgresql.org%2Fdownload%2F" target="_blank">可供下载</a>。公告<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.postgresql.org%2Fabout%2Fnews%2Fpostgresql-15-beta-1-released-2453%2F" target="_blank">指出</a>，此版本包含 PostgreSQL 15 普遍可用时将提供的所有功能的预览，但该版本的某些细节可能会在测试期间发生变化。</p> 
<p style="text-align:left"><span style="background-color:#ffffff; color:#0d0a0b">本着开源 PostgreSQL 社区的精神，</span><span><span><span style="color:#0d0a0b"><span><span><span><span><span><span><span><span><span><span><span><span style="background-color:#ffffff"><span><span><span>官方建议用户在系统上测试 PostgreSQL 15 的新功能，以帮助消除可能存在的错误或其他问题。虽然不建议用户在生产环境中运行 PostgreSQL 15 Beta 1，但其鼓励用户找到针对此 Beta 版本运行典型应用程序工作负载的方法。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>“<span><span><span style="color:#0d0a0b"><span><span><span><span><span><span><span><span><span><span><span><span style="background-color:#ffffff"><span><span><span>您的测试和反馈将帮助社区确保 PostgreSQL 15 版本符合我们提供世界上最先进的开源关系数据库的稳定、可靠版本的标准</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>”。详情可查看<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.postgresql.org%2Fabout%2Fnews%2Fpostgresql-15-beta-1-released-2453%2F" target="_blank">此处</a>。</p> 
<h4><strong><span style="color:#000000"><span style="background-color:#ffffff">PostgreSQL 15 功能亮点</span></span></strong></h4> 
<p style="margin-left:0px; margin-right:0px; text-align:left"><strong><span style="color:#000000"><span style="background-color:#ffffff">开发者体验</span></span></strong></p> 
<p style="text-align:left"><span><span><span style="color:#0d0a0b"><span><span><span><span><span><span><span><span><span><span><span><span style="background-color:#ffffff"><span><span><span>PostgreSQL 15 添加了用于简化和增强开发人员体验的新功能。此版本引入了<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.postgresql.org%2Fdocs%2F15%2Fsql-merge.html" target="_blank"><code>MERGE</code></a>，这是一个 SQL 标准命令，用于有条件地对数据执行写操作（<code>INSERT</code>、<code>UPDATE</code>或<code>DELETE</code>）。在此版本之前，同样的行为可以使用存储过程或在有限的基础上使用 <a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.postgresql.org%2Fdocs%2F15%2Fsql-insert.html" target="_blank"><code>INSERT ... ON CONFLICT</code></a>来完成。“使用 PostgreSQL 15，开发人员可以编写简单、富有表现力的查询来选择要采取的适当数据修改操作。”</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<p style="text-align:left"><span><span><span style="color:#0d0a0b"><span><span><span><span><span><span><span><span><span><span><span><span style="background-color:#ffffff"><span><span><span>作为 <a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.postgresql.org%2Fabout%2Fnews%2Fpostgresql-92-released-1415%2F" target="_blank">9.2 版本</a>的一部分，PostgreSQL 在 2012 年曾增加了对 JSON 的支持。五年后发布的 SQL/JSON 标准指定了用于访问和操作存储在关系数据库中的 JSON 数据的各种接口。PostgreSQL 15 在其现有的对 SQL/JSON 路径语言的支持的基础上，加入了更多标准的 <a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.postgresql.org%2Fdocs%2F15%2Ffunctions-json.html%23FUNCTIONS-SQLJSON" target="_blank">SQL/JSON 函数</a>。其中包括 <a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.postgresql.org%2Fdocs%2F15%2Ffunctions-json.html%23FUNCTIONS-SQLJSON-PRODUCING" target="_blank">SQL/JSON 构造函数</a>、<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.postgresql.org%2Fdocs%2F15%2Ffunctions-json.htm%23FUNCTIONS-SQLJSON-QUERYING" target="_blank">查询/自省函数</a>，以及将 JSON 数据转换成 table 的能力。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<p style="text-align:left"><span><span><span style="color:#0d0a0b"><span><span><span><span><span><span><span><span><span><span><span><span style="background-color:#ffffff"><span><span><span>PostgreSQL 15 增加了<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.postgresql.org%2Fdocs%2F15%2Ffunctions-matching.html%23FUNCTIONS-POSIX-REGEXP" target="_blank">更多的正则表达式函数</a>，包括<code>regexp_count</code>, <code>regexp_instr</code>, <code>regexp_like</code>, 和<code>regexp_substr</code>。<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.postgresql.org%2Fdocs%2F15%2Ffunctions-aggregate.html" target="_blank"><code>range_agg</code></a> 函数在 PostgreSQL 15 中引入，用于将 <a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.postgresql.org%2Fdocs%2F15%2Frangetypes.html" target="_blank"><code>range</code>数据类型</a>聚合为<code>multirange</code>类型，现在也支持聚合<code>multirange</code>类型。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<p style="text-align:left"><strong>Performance</strong></p> 
<p style="text-align:left"><span><span><span style="color:#0d0a0b"><span><span><span><span><span><span><span><span><span><span><span><span style="background-color:#ffffff"><span><span><span>PostgreSQL 15 包括对较大数据集进行排序时对数据进行排序的显着加速，特别是超过<code>work_mem</code>参数的数据集。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<p style="text-align:left"><span><span><span style="color:#0d0a0b"><span><span><span><span><span><span><span><span><span><span><span><span style="background-color:#ffffff"><span><span><span>PostgreSQL 15 的性能提升还扩展到了各种查询类型。包括为<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.postgresql.org%2Fdocs%2F15%2Fqueries-select-lists.html%23QUERIES-DISTINCT" target="_blank"><code>SELECT DISTINCT</code></a>语句引入并行化，以及对使用 row_number()、rank() 和 count() 的 window functions 的性能改进。使用 <a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.postgresql.org%2Fdocs%2F15%2Fpostgres-fdw.html" target="_blank">PostgreSQL 外部数据包装器<code>postgres_fdw</code></a>来管理远程 PostgreSQL 服务器上的数据的应用程序，现在可以使 transactions 以并行方式提交。对于涉及带有分区的表的查询，也一些性能增强。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<p style="text-align:left"><span><span><span style="color:#0d0a0b"><span><span><span><span><span><span><span><span><span><span><span><span style="background-color:#ffffff"><span><span><span>用于存储大于单页 (8kB) 的数据的 PostgreSQL 系统和 TOAST tables 现在可以利用利用重复索引，并从更小的索引和更快的查找中获益。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<p style="text-align:left"><span><span><span style="color:#0d0a0b"><span><span><span><span><span><span><span><span><span><span><span><span style="background-color:#ffffff"><span><span><span>用于批量加载数据的 psql \copy 命令在 PostgreSQL 15 中也有性能改进。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<p style="text-align:left"><strong>Backups、Archiving 和 Compression</strong></p> 
<p style="text-align:left">PostgreSQL 15 为各种组件增加了对 Zstandard（zstd）压缩的支持。<span><span><span style="color:#0d0a0b"><span><span><span><span><span><span><span><span><span><span><span><span style="background-color:#ffffff"><span><span><span><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.postgresql.org%2Fdocs%2F15%2Fapp-pgbasebackup.html" target="_blank"><code>pg_basebackup</code></a>，一个用于对 PostgreSQL 集群进行完整备份的实用程序，现在支持使用 Gzip、LZ4 或 Zstandard 压缩的服务器端压缩。<code>pg_basebackup</code>客户端现在还可以解压缩使用 LZ4 和 Zstandard 压缩的备份。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<p style="text-align:left"><span><span><span style="color:#0d0a0b"><span><span><span><span><span><span><span><span><span><span><span><span style="background-color:#ffffff"><span><span><span>Write-ahead log (WAL) 文件现在可以通过<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.postgresql.org%2Fdocs%2F15%2Fruntime-config-wal.html%23GUC-WAL-COMPRESSION" target="_blank"><code>wal_compression</code></a>配置参数使用 LZ4 和 Zstandard 压缩法进行压缩。此外，PostgreSQL 15 还添加了<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.postgresql.org%2Fdocs%2F15%2Fruntime-config-wal.html%23GUC-RECOVERY-PREFETCH" target="_blank"><code>recovery_prefetch</code></a>选项，可以通过预取数据块来帮助加快恢复操作。此版本添加了一个叫做<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.postgresql.org%2Fdocs%2F15%2Fpgwalinspect.html" target="_blank"><code>pg_walinspect</code></a>的新模块，让你可以直接从 SQL 检查有关 WAL 文件的信息。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<p style="text-align:left"><span><span><span style="color:#0d0a0b"><span><span><span><span><span><span><span><span><span><span><span><span style="background-color:#ffffff"><span><span><span>PostgreSQL 15 允许你通过指定一个<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.postgresql.org%2Fdocs%2F15%2Fruntime-config-wal.html%23GUC-ARCHIVE-LIBRARY" target="_blank"><code>archive_library</code></a>来执行 WAL 归档，而不需要运行 shell 命令。可以在<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.postgresql.org%2Fdocs%2F15%2Fbasic-archive.html" target="_blank"><code>basic_archive</code></a>模块中找到示例 WAL 归档库。此外，扩展现在可以定义自己的 WAL 资源管理器，让他们与逻辑复制一起使用。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<p style="margin-left:0px; margin-right:0px; text-align:left"><strong><span style="color:#000000"><span style="background-color:#ffffff">Logical Replication</span></span></strong></p> 
<p style="text-align:left"><span><span><span style="color:#0d0a0b"><span><span><span><span><span><span><span><span><span><span><span><span style="background-color:#ffffff"><span><span><span>PostgreSQL 15 为逻辑复制引入了 row filtering 和 column filtering 。此外，用户现在可以方便地指定发布模式中的所有 tables，而以前只能对数据库中的所有 tables 执行此操作。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<p style="text-align:left"><span><span><span style="color:#0d0a0b"><span><span><span><span><span><span><span><span><span><span><span><span style="background-color:#ffffff"><span><span><span><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.postgresql.org%2Fdocs%2F15%2Flogical-replication-conflicts.html" target="_blank">此版本还增加了对处理冲突</a>的更多支持。用户现在可以指定<code>disable_on_error</code>，以便在发生错误时自动停止逻辑复制。PostgreSQL 15 可以使用 <a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.postgresql.org%2Fdocs%2F15%2Fsql-altersubscription.html" target="_blank"><code>ALTER SUBSCRIPTION ... SKIP</code></a> 命令跳过 applying changes。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<p style="text-align:left"><strong><span><span><span style="color:#0d0a0b"><span><span><span><span><span><span><span><span><span><span><span><span style="background-color:#ffffff"><span><span><span>Administration</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></strong></p> 
<p style="text-align:left"><span><span><span style="color:#0d0a0b"><span><span><span><span><span><span><span><span><span><span><span><span style="background-color:#ffffff"><span><span><span>PostgreSQL 15 引入了 <a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.postgresql.org%2Fdocs%2F15%2Fruntime-config-logging.html%23RUNTIME-CONFIG-LOGGING-JSONLOG" target="_blank"><code>jsonlog</code>日志格式</a>。这允许 PostgreSQL 日志被许多执行结构化日志聚合和分析的程序使用。PostgreSQL 15 现在默认记录缓慢的 checkpoints 和 autovacuum operations。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<p style="text-align:left"><span><span><span style="color:#0d0a0b"><span><span><span><span><span><span><span><span><span><span><span><span style="background-color:#ffffff"><span><span><span><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.postgresql.org%2Fdocs%2F15%2Fapp-psql.html" target="_blank"><code>psql</code></a>客户端现在有一个<code>\dconfig</code>命令，用于检查配置参数的值。默认情况下，<code>\dconfig</code>显示任何未设置为其默认值的配置参数。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<p style="text-align:left"><span><span><span style="color:#0d0a0b"><span><span><span><span><span><span><span><span><span><span><span><span style="background-color:#ffffff"><span><span><span>PostgreSQL 15 现在将所有服务器级别的统计信息存储在共享内存中。服务器不再运行 statistics collector process。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<p style="text-align:left"><span><span><span style="color:#0d0a0b"><span><span><span><span><span><span><span><span><span><span><span><span style="background-color:#ffffff"><span><span><span><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.postgresql.org%2Fdocs%2F15%2Fsql-altertable.html" target="_blank"><code>ALTER TABLE</code></a> 命令现在可以修改 table 的<code>ACCESS METHOD</code>，用于设置 table 使用的存储系统。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<p style="text-align:left"><strong>Security</strong></p> 
<p style="text-align:left"><span><span><span style="color:#0d0a0b"><span><span><span><span><span><span><span><span><span><span><span><span style="background-color:#ffffff"><span><span><span>PostgreSQL 15 在 PostgreSQL 集群中创建数据库时引入了新的默认值。创建新数据库时，数据库所有者之外的用户（由<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.postgresql.org%2Fdocs%2F15%2Fpredefined-roles.html" target="_blank"><code>pg_database_owner</code></a>表示）和超级用户不能再在默认<code>public</code>模式中创建对象。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<p style="text-align:left"><span><span><span style="color:#0d0a0b"><span><span><span><span><span><span><span><span><span><span><span><span style="background-color:#ffffff"><span><span><span>PostgreSQL 15 增加了对“<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.postgresql.org%2Fdocs%2F15%2Fsql-createview.html" target="_blank">security invoker views</a>”的支持，它使用执行查询的用户而不是创建视图的用户的权限。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<p style="text-align:left"><span><span><span style="color:#0d0a0b"><span><span><span><span><span><span><span><span><span><span><span><span style="background-color:#ffffff"><span><span><span>PostgreSQL 15 中的非特权用户现在可以通过<code>SET</code>和<code>ALTER SYSTEM</code>被<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.postgresql.org%2Fdocs%2F15%2Fsql-grant.html" target="_blank">授予</a>更改服务器变量的特权。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<p style="text-align:left"><span style="background-color:#ffffff; color:#0d0a0b">有关新功能和更改功能的完整列表可查看</span> <a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fwww.postgresql.org%2Fdocs%2F15%2Frelease-15.html" target="_blank">release notes</a><span style="color:#0d0a0b">。</span></p>
                                        </div>
                                      
</div>
            