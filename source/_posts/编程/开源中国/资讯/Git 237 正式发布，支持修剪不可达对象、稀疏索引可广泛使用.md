
---
title: 'Git 2.37 正式发布，支持修剪不可达对象、稀疏索引可广泛使用'
categories: 
 - 编程
 - 开源中国
 - 资讯
headimg: 'https://oscimg.oschina.net/oscnet/up-b65f19d493f9468f94b634573926ced0b3b.png'
author: 开源中国
comments: false
date: Wed, 29 Jun 2022 07:05:00 GMT
thumbnail: 'https://oscimg.oschina.net/oscnet/up-b65f19d493f9468f94b634573926ced0b3b.png'
---

<div>   
<div class="content">
                                                                                            <p>Git 2.37 已正式发布。</p> 
<p>主要变化</p> 
<ul> 
 <li>新增用于修剪不可达对象 (unreachable object) 的机制</li> 
 <li>新增适用于 Windows 和 macOS 的内置文件系统监视器</li> 
 <li>稀疏索引 (sparse index) 已可以广泛使用</li> 
</ul> 
<p><img alt src="https://oscimg.oschina.net/oscnet/up-b65f19d493f9468f94b634573926ced0b3b.png" referrerpolicy="no-referrer"></p> 
<p><strong>修剪不可达对象</strong></p> 
<p>在 Git 中，对象可被分类为“可达”和“不可达”。当至少有一个引用（分支或标签）时，一个对象是“可达的”，你可以从该引用开始一个对象遍历（从提交遍历到其父级，从树遍历到其子树，等等），然后在目的地结束。类似地，当不存在这样的引用时，一个对象是“不可达”的。</p> 
<p>Git 2.37 引入了一个新概念 <a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgit-scm.com%2Fdocs%2Fcruft-packs" target="_blank">cruft packs</a>，它允许将“不可达”对象一起存储在单个包文件中，方法是将各个对象的 age 写入存储在包旁边的<code>*.mtimes</code>文件的辅助表中。</p> 
<p>在实践中，它们可以允许仓库以更长的宽限期来进行修剪，而不必担心创建许多松散对象的可能性。通过运行下方命令进行尝试：</p> 
<pre><code class="language-bash">$ git gc --cruft --prune=1.day.ago</code></pre> 
<p><strong>内置文件系统监视器</strong></p> 
<p>工作目录大小是显著影响 Git 性能的其中一个因素，</p> 
<p style="text-align:start"><span><span><span style="color:#24292f"><span><span><span><span><span><span><span><span><span><span><span><span style="background-color:#ffffff"><span><span><span>例如，当你运行<code>git status</code>.git 时，Git 必须爬取你的整个工作目录（在最坏的情况下）才能确定哪些文件已被修改。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<p style="text-align:start"><span><span><span style="color:#24292f"><span><span><span><span><span><span><span><span><span><span><span><span style="background-color:#ffffff"><span><span><span>Git 对文件系统有自己的 </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span style="background-color:#ffffff; color:#24292f">cached understanding，</span><span><span><span style="color:#24292f"><span><span><span><span><span><span><span><span><span><span><span><span style="background-color:#ffffff"><span><span><span>以避免在许多情况下进行整个目录遍历。但是对于 Git 来说，在工作时使用磁盘的实际状态更新对文件系统的 </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span style="background-color:#ffffff; color:#24292f">cached understanding </span><span><span><span style="color:#24292f"><span><span><span><span><span><span><span><span><span><span><span><span style="background-color:#ffffff"><span><span><span>可能会很昂贵。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<p style="text-align:start"><span><span><span style="color:#24292f"><span><span><span><span><span><span><span><span><span><span><span><span style="background-color:#ffffff"><span><span><span>过去，Git 可以通过 <a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Fgit%2Fgit%2Fblob%2Fv2.37.0%2Ftemplates%2Fhooks--fsmonitor-watchman.sample" target="_blank">hook</a><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Ffacebook.github.io%2Fwatchman%2F" target="_blank">与 Watchman 等</a>工具集成，从而可以用更直接地跟踪文件系统状态的长时间运行的守护进程来替换 Git 昂贵的刷新过程。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<p style="text-align:start"><span><span><span style="color:#24292f"><span><span><span><span><span><span><span><span><span><span><span><span style="background-color:#ffffff"><span><span><span>但是设置这个钩子并安装第三方工具可能很麻烦。在 Git 2.37 中，此功能内置于 Windows 和 macOS 上的 Git 本身，无需安装外部工具和配置钩子。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<p style="text-align:start"><span><span><span style="color:#24292f"><span><span><span><span><span><span><span><span><span><span><span><span style="background-color:#ffffff"><span><span><span>通过启用<code>core.fsmonitor</code>配置设置即可为仓库启用此功能。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<pre style="margin-left:0; margin-right:0; text-align:start"><span><span><span><span><span><span><span style="background-color:#eff2ff"><span><span><span><span><span style="color:#24292f"><span><span><span><span><span><span><span><span><span><span><span><code class="language-ShellSession"><span><span style="color:#1f7199">$ </span></span><span>git config core.fsmonitor <span><span style="color:#669955">true</span></span></span> </code></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre> 
<p style="text-align:start"><span><span><span style="color:#24292f"><span><span><span><span><span><span><span><span><span><span><span><span style="background-color:#ffffff"><span><span><span>完成配置后，初始<code>git status</code>命令将花费正常的时间。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<p><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.blog%2F2022-06-27-highlights-from-git-2-37%2F" target="_blank">详情查看发布公告</a>。</p>
                                        </div>
                                      
</div>
            