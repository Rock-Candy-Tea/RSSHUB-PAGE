
---
title: 'Rust 1.57.0 发布'
categories: 
 - 编程
 - 开源中国
 - 资讯
headimg: 'https://picsum.photos/400/300?random=6280'
author: 开源中国
comments: false
date: Fri, 03 Dec 2021 07:37:00 GMT
thumbnail: 'https://picsum.photos/400/300?random=6280'
---

<div>   
<div class="content">
                                                                    
                                                        <p>​Rust 1.57.0 现已发布，该版本为 const contexts 带来了 <code>panic!</code><span style="background-color:#ffffff"><span style="color:#000000">，为 Cargo 增加了对自定义配置文件的支持，并稳定了易出错的 reservation API。</span></span><span style="background-color:#ffffff"><span style="color:#333333">如果你此前已通过 rustup 安装了以前的 Rust 版本，运行以下命令即可升级至最新版本：</span></span></p> 
<pre style="text-align:start"><code class="language-console">rustup update stable</code></pre> 
<p><strong>具体更新内容包括： </strong></p> 
<p><strong><code>panic!</code> in const contexts</strong></p> 
<p>在以前的 Rust 版本中，<code>panic!</code>macro 在 const fn 和其他 compile-time contexts 中是不能使用的。现在，这一点已经稳定下来了。连同<code>panic!</code>的稳定，其他几个标准库的 API 现在也可以在 const 中使用，比如<code>assert!</code>。</p> 
<p style="text-align:start"><span style="color:#000000"><span style="background-color:#ffffff">这种稳定性还不包括完整的格式化基础结构，因此必须使用静态字符串</span></span><span style="background-color:#ffffff"><span style="color:#000000"> (</span></span><code>panic!("...")</code><span style="background-color:#ffffff"><span style="color:#000000">)</span></span><span style="color:#000000"><span style="background-color:#ffffff">或者用单个<code>&str</code>内插值</span></span><span style="background-color:#ffffff"><span style="color:#000000"> (</span></span><code>panic!("&#123;&#125;", a)</code><span style="background-color:#ffffff"><span style="color:#000000">) 来</span></span><span style="color:#000000"><span style="background-color:#ffffff">调用</span></span><code>panic!</code>macro <span style="color:#000000"><span style="background-color:#ffffff">宏。</span></span></p> 
<p style="text-align:start"><span style="color:#000000"><span style="background-color:#ffffff">预计将来这种支持会扩展，但这种最低限度的稳定性已经支持直接的编译时断言，例如验证类型的大小</span></span>：</p> 
<pre style="text-align:start"><code class="language-rust"><span style="color:#b854d4">const</span> _: () = <span style="color:#b65611">assert!</span>(std::mem::size_of::<<span style="color:#b65611">u64</span>>() == <span style="color:#b65611">8</span>);
<span style="color:#b854d4">const</span> _: () = <span style="color:#b65611">assert!</span>(std::mem::size_of::<<span style="color:#b65611">u8</span>>() == <span style="color:#b65611">1</span>);
</code></pre> 
<p style="text-align:start"><strong>Cargo support for custom profiles</strong></p> 
<p><span style="background-color:#ffffff"><span style="color:#000000">Cargo </span></span>长期以来一直支持四种配置文件：<code>dev</code>、<code>release<span><span style="background-color:#ffffff">、</span></span></code><code>test</code>和<code>bench</code>。在 Rust 1.57 中，增加了对任意命名的配置文件的支持。</p> 
<p>例如，如果你想只在最终生产构建时启用链接时间优化（LTO），那么在 Cargo.toml 中添加以下片段，在选择此配置文件时启用 lto flag，但避免在常规发布构建时启用它。</p> 
<pre style="text-align:start"><code class="language-toml"><span style="color:#6684e1">[profile.production]</span>
inherits = <span style="color:#60ac39">"release"</span>
lto = <span style="color:#b65611">true</span>
</code></pre> 
<p style="text-align:start"><span style="color:#000000"><strong>Fallible allocation</strong></span></p> 
<p style="text-align:start"><span style="color:#000000"><span style="background-color:#ffffff">Rust 1.57 为<code>Vec</code>、<code>String</code>、<code>HashMap</code>、<code>HashSet</code>和<code>VecDeque</code>稳定了<code>try_reserve</code>。此 API 使调用者能够错误地为这些类型分配 backing storage。</span></span></p> 
<p style="text-align:start"><span style="color:#000000"><span style="background-color:#ffffff">如果全局分配器失败，Rust 通常会中止进程，这并不总是可取的。此 API 提供了一种在使用标准库集合时避免中止的方法。但是，Rust 不保证返回的内存实际上是由内核分配的：例如，如果在 Linux 上启用了 overcommit，则在尝试使用内存时可能无法使用该内存。</span></span></p> 
<p style="margin-left:0px; margin-right:0px; text-align:left"><strong>稳定的 API</strong></p> 
<p style="margin-left:0; margin-right:0; text-align:left"><span style="color:#333333">以下方法和特性的实现被稳定化：</span></p> 
<ul> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fstd%2Fprimitive.array.html%23method.as_mut_slice" target="_blank"><code>[T; N]::as_mut_slice</code></a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fstd%2Fprimitive.array.html%23method.as_slice" target="_blank"><code>[T; N]::as_slice</code></a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fstd%2Fcollections%2Fstruct.TryReserveError.html" target="_blank"><code>collections::TryReserveError</code></a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fstd%2Fcollections%2Fhash_map%2Fstruct.HashMap.html%23method.try_reserve" target="_blank"><code>HashMap::try_reserve</code></a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fstd%2Fcollections%2Fhash_set%2Fstruct.HashSet.html%23method.try_reserve" target="_blank"><code>HashSet::try_reserve</code></a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Falloc%2Fstring%2Fstruct.String.html%23method.try_reserve" target="_blank"><code>String::try_reserve</code></a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Falloc%2Fstring%2Fstruct.String.html%23method.try_reserve_exact" target="_blank"><code>String::try_reserve_exact</code></a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fstd%2Fvec%2Fstruct.Vec.html%23method.try_reserve" target="_blank"><code>Vec::try_reserve</code></a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fstd%2Fvec%2Fstruct.Vec.html%23method.try_reserve_exact" target="_blank"><code>Vec::try_reserve_exact</code></a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fstd%2Fcollections%2Fstruct.VecDeque.html%23method.try_reserve" target="_blank"><code>VecDeque::try_reserve</code></a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fstd%2Fcollections%2Fstruct.VecDeque.html%23method.try_reserve_exact" target="_blank"><code>VecDeque::try_reserve_exact</code></a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fstd%2Fiter%2Ftrait.Iterator.html%23method.map_while" target="_blank"><code>Iterator::map_while</code></a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fstd%2Fiter%2Fstruct.MapWhile.html" target="_blank"><code>iter::MapWhile</code></a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fproc_macro%2Ffn.is_available.html" target="_blank"><code>proc_macro::is_available</code></a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fstd%2Fprocess%2Fstruct.Command.html%23method.get_program" target="_blank"><code>Command::get_program</code></a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fstd%2Fprocess%2Fstruct.Command.html%23method.get_args" target="_blank"><code>Command::get_args</code></a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fstd%2Fprocess%2Fstruct.Command.html%23method.get_envs" target="_blank"><code>Command::get_envs</code></a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fstd%2Fprocess%2Fstruct.Command.html%23method.get_current_dir" target="_blank"><code>Command::get_current_dir</code></a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fstd%2Fprocess%2Fstruct.CommandArgs.html" target="_blank"><code>CommandArgs</code></a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fstd%2Fprocess%2Fstruct.CommandEnvs.html" target="_blank"><code>CommandEnvs</code></a></li> 
</ul> 
<p style="text-align:start"><span style="color:#000000"><span style="background-color:#ffffff"><span style="color:#000000">以下以前稳定的功能现在是</span></span><code>const</code>。</span></p> 
<ul> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fstd%2Fhint%2Ffn.unreachable_unchecked.html" target="_blank"><code>hint::unreachable_unchecked</code></a></li> 
</ul> 
<p>更多详情可<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fblog.rust-lang.org%2F2021%2F12%2F02%2FRust-1.57.0.html" target="_blank">查看官方博客</a>。</p>
                                        </div>
                                      
</div>
            