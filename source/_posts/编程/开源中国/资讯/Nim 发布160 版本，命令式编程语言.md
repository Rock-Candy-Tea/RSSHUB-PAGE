
---
title: 'Nim 发布1.6.0 版本，命令式编程语言'
categories: 
 - 编程
 - 开源中国
 - 资讯
headimg: 'https://picsum.photos/400/300?random=4565'
author: 开源中国
comments: false
date: Sat, 23 Oct 2021 07:37:00 GMT
thumbnail: 'https://picsum.photos/400/300?random=4565'
---

<div>   
<div class="content">
                                                                    
                                                        <p><span style="background-color:#ffffff; color:#333333">Nim 是一门专注于性能、可移植性和表现力的系统编程语言。经过一年的厚积薄发，Nim 1.6.0 稳定版已正式发布。</span></p> 
<h2 style="margin-left:.6em; margin-right:0; text-align:start"><span style="color:#333333">主要更新内容如下：</span></h2> 
<h3 style="margin-left:.6em; margin-right:0; text-align:start">向后兼容性和预览标志</h3> 
<p style="color:#000000; margin-left:0; margin-right:0; text-align:start"><span style="color:#2e3033">1.6 版本引入了<span> </span><code>-d:nimPreviewX</code><span> </span>这种形式的<strong>预览标志</strong>（例如<span> </span><code>-d:nimPreviewFloatRoundtrip</code><span> </span>），这种标志允许用户选择加入新的标准库/编译器行为，加入这些标志是为了尽量减少向后兼容性问题。</span></p> 
<p style="color:#000000; margin-left:0; margin-right:0; text-align:start"><span style="color:#2e3033">1.6 还引入了<span> </span><code>-d:nimLegacyX</code><span> </span>形式的<strong>退出标志</strong>，例如<span> </span><code>-d:nimLegacyCopyFile</code><span> </span>。如果你在用老版本的 Nim ，可以用这些标志来适配老版本的语法。</span> <span style="color:#2e3033"><strong>以下是 1.6 版本中引入的所有标志，可以结合后面的新功能介绍了解它们的具体用法。</strong></span></p> 
<ul style="margin-left:0; margin-right:0"> 
 <li><code>-d:nimLegacyCopyFile</code></li> 
 <li><code>-d:nimLegacyJsRound</code></li> 
 <li><code>-d:nimLegacyMacrosCollapseSymChoice</code></li> 
 <li><code>-d:nimLegacyParseQueryStrict</code></li> 
 <li><code>-d:nimLegacyRandomInitRand</code></li> 
 <li><code>-d:nimLegacyReprWithNewline</code></li> 
 <li><code>-d:nimLegacySigpipeHandler</code></li> 
 <li><code>-d:nimLegacyTypeMismatch</code></li> 
 <li><code>-d:nimPreviewDotLikeOps</code></li> 
 <li><code>-d:nimPreviewFloatRoundtrip</code></li> 
 <li><code>-d:nimPreviewHashRef</code></li> 
 <li><code>-d:nimPreviewJsonutilsHoleyEnum</code></li> 
</ul> 
<h2 style="margin-left:.6em; margin-right:0; text-align:start"><span style="color:#333333"><strong>主要的新功能：</strong></span></h2> 
<ul style="margin-left:0; margin-right:0"> 
 <li> <h3>iterable[T]</h3> </li> 
</ul> 
<p style="color:#000000; margin-left:0; margin-right:0; text-align:start">加入了<span> </span><span style="color:#111111"><code>iterable[T]</code><span> </span>type 类来匹配被调用的迭代器，例子：</span></p> 
<pre style="margin-left:0; margin-right:0; text-align:start"><code><strong style="color:#000000">iterator</strong> <span>iota</span><span>(</span><span>n</span><span>:</span> <strong style="color:#445588">int</strong><span>):</span> <strong style="color:#445588">int</strong> <strong style="color:#000000">=</strong>
  <strong style="color:#000000">for</strong> <span>i</span> <strong style="color:#000000">in</strong> <span style="color:#009999">0</span><span>..</span><strong style="color:#000000"><</strong><span>n</span><span>:</span> <strong style="color:#000000">yield</strong> <span>i</span>

# 以前需要用“untyped”，这会导致其他问题，比如缺乏类型推断、重载问题和 MCS 
<strong style="color:#000000">template</strong> <span>sumOld</span><span>(</span><span>a</span><span>:</span> <span>untyped</span><span>):</span> <span>untyped</span> <strong style="color:#000000">=</strong> # 不可能有类型推断
  <strong style="color:#000000">var</strong> <span>result</span><span>:</span> <span>typeof</span><span>(</span><strong style="color:#000000">block</strong><span>:(</span><strong style="color:#000000">for</strong> <span>ai</span> <strong style="color:#000000">in</strong> <span>a</span><span>:</span> <span>ai</span><span>))</span>
  <strong style="color:#000000">for</strong> <span>ai</span> <strong style="color:#000000">in</strong> <span>a</span><span>:</span> <span>result</span> <strong style="color:#000000">+=</strong> <span>ai</span>
  <span>result</span>

<span>assert</span> <span>sumOld</span><span>(</span><span>iota</span><span>(</span><span style="color:#009999">3</span><span>))</span> <strong style="color:#000000">==</strong> <span style="color:#009999">0</span> <strong style="color:#000000">+</strong> <span style="color:#009999">1</span> <strong style="color:#000000">+</strong> <span style="color:#009999">2</span>

<em># </em>现在，你可以写成:
<strong style="color:#000000">template</strong> <span>sum</span><strong style="color:#000000">[</strong><span>T</span><strong style="color:#000000">]</strong><span>(</span><span>a</span><span>:</span> <span>iterable</span><strong style="color:#000000">[</strong><span>T</span><strong style="color:#000000">]</strong><span>):</span> <span>T</span> <strong style="color:#000000">=</strong>
  <em># </em>也可以写成：`template sum(a: iterable): auto =`
  <strong style="color:#000000">var</strong> <span>result</span><span>:</span> <span>T</span>
  <strong style="color:#000000">for</strong> <span>ai</span> <strong style="color:#000000">in</strong> <span>a</span><span>:</span> <span>result</span> <strong style="color:#000000">+=</strong> <span>ai</span>
  <span>result</span>

<span>assert</span> <span>sum</span><span>(</span><span>iota</span><span>(</span><span style="color:#009999">3</span><span>))</span> <strong style="color:#000000">==</strong> <span style="color:#009999">0</span> <strong style="color:#000000">+</strong> <span style="color:#009999">1</span> <strong style="color:#000000">+</strong> <span style="color:#009999">2</span> <em># or `iota(3).sum`</em></code>
</pre> 
<p style="color:#000000; margin-left:0; margin-right:0; text-align:start"><span style="color:#2e3033">更重要的是，现在可迭代参数能和方法调用的语句一起使用了：</span></p> 
<pre style="margin-left:0; margin-right:0; text-align:start"><code><strong style="color:#000000">import</strong> <span>std</span><strong style="color:#000000">/[</strong><span>sequtils</span><span>,</span> <span>os</span><strong style="color:#000000">]</strong>
<span>echo</span> <span>walkFiles</span><span>(</span><span style="color:#d01040">"*"</span><span>).</span><span>toSeq</span> <em># now works</em></code></pre> 
<p style="color:#000000; margin-left:0; margin-right:0; text-align:start">关于<span> </span><code>iterable[T]</code><span> </span>的详细信息，请查看<span> </span><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Fnim-lang%2FNim%2Fpull%2F17196" target="_blank">#17196</a></p> 
<ul style="margin-left:0; margin-right:0"> 
 <li> <h3>严谨的效果</h3> </li> 
</ul> 
<p style="color:#000000; margin-left:0; margin-right:0; text-align:start">效果系统得到了改进，并且有一个新的<span> </span><code>.effectsOf</code><span> </span>注释，它可以显式地完成之前隐式完成的工作，更多详细信息请参阅<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fnim-lang.github.io%2FNim%2Fmanual.html%23effect-system-effectsof-annotation" target="_blank">手册</a>。</p> 
<p style="color:#000000; margin-left:0; margin-right:0; text-align:start">如果你仍要编写老版本 Nim 的代码，请使用以下用法：</p> 
<pre style="margin-left:0; margin-right:0; text-align:start"><code><strong style="color:#000000">when</strong> <span>defined</span><span>(</span><span>nimHasEffectsOf</span><span>):</span>
  <span>&#123;.</span><span>experimental</span><span>:</span> <span style="color:#d01040">"strictEffects"</span><span>.&#125;</span>
<strong style="color:#000000">else</strong><span>:</span>
  <span>&#123;.</span><span>pragma</span><span>:</span> <span>effectsOf</span><span>.&#125;</span>

<strong style="color:#000000">proc </strong><strong style="color:#990000">mysort</strong><span>(</span><span>s</span><span>:</span> <strong style="color:#445588">seq</strong><span>;</span> <span>cmp</span><span>:</span> <strong style="color:#000000">proc</strong><span>(</span><span>a</span><span>,</span> <span>b</span><span>:</span> <span>T</span><span>):</span> <strong style="color:#445588">int</strong><span>)</span> <span>&#123;.</span><span>effectsOf</span><span>:</span> <span>cmp</span><span>.&#125;</span></code></pre> 
<p style="color:#000000; margin-left:0; margin-right:0; text-align:start"><span style="color:#2e3033">要启用新的效果系统，请使用<span> </span></span><span style="color:#111111">-<code>-experimental:strictEffects</code><span> </span>进行编译。详情可查看<span> </span></span><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Fnim-lang%2FNim%2Fpull%2F18777" target="_blank">#18777</a>和 RFC<span> </span><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Fnim-lang%2FRFCs%2Fissues%2F408" target="_blank">#408</a><span> </span>。</p> 
<ul style="margin-left:0; margin-right:0"> 
 <li> <h3>私有导入和私有字段访问</h3> </li> 
</ul> 
<p style="color:#000000; margin-left:0; margin-right:0; text-align:start">新的导入语句<span> </span><code>import foo &#123;.all.&#125;</code><span style="color:#111111"><span> </span>允许从<span> </span></span><code>foo</code><span> </span>里面导入所有符号（无论是私有的还是公开的），这点对于测试或者项目的灵活性都很有帮助，</p> 
<p style="color:#000000; margin-left:0; margin-right:0; text-align:start">比如：</p> 
<pre style="margin-left:0; margin-right:0; text-align:start"><code><strong style="color:#000000">from</strong> <span>system</span> <span>&#123;.</span><span>all</span><span>.&#125;</span> <strong style="color:#000000">as</strong> <span>system2</span> <strong style="color:#000000">import</strong> <strong style="color:#000000">nil</strong>
<span>echo</span> <span>system2</span><span>.</span><span>ThisIsSystem</span> <em># ThisIsSystem is private in `system`</em>
<strong style="color:#000000">import</strong> <span>os</span> <span>&#123;.</span><span>all</span><span>.&#125;</span> <em># weirdTarget is private in `os`</em>
<span>echo</span> <span>weirdTarget</span> <em># or `os.weirdTarget`</em></code></pre> 
<p style="color:#000000; margin-left:0; margin-right:0; text-align:start">添加了一个新模块<span> </span><code>std/importutils</code>和一个 API<span> </span><code>privateAccess</code>，它允许访问当前作用域对象类型的私有字段。</p> 
<p style="color:#000000; margin-left:0; margin-right:0; text-align:start">比如：</p> 
<pre style="margin-left:0; margin-right:0; text-align:start"><code><strong style="color:#000000">import</strong> <span>times</span>
<strong style="color:#000000">from</strong> <span>std</span><strong style="color:#000000">/</strong><span>importutils</span> <strong style="color:#000000">import</strong> <span>privateAccess</span>
<strong style="color:#000000">block</strong><span>:</span>
  <strong style="color:#000000">let</strong> <span>t</span> <strong style="color:#000000">=</strong> <span>now</span><span>()</span>
  <em># echo t.monthdayZero # Error: undeclared field: 'monthdayZero' for type times.DateTime</em>
  <span>privateAccess</span><span>(</span><span>typeof</span><span>(</span><span>t</span><span>))</span> <em># enables private access in this scope</em>
  <span>echo</span> <span>t</span><span>.</span><span>monthdayZero</span> <em># ok</em></code></pre> 
<p style="color:#000000; margin-left:0; margin-right:0; text-align:start">更多细节请查看<span> </span><span style="color:#111111">PR<span> </span></span><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Fnim-lang%2FNim%2Fpull%2F17706" target="_blank"><u>#17706</u></a><u><span> </span></u>。</p> 
<ul style="margin-left:0; margin-right:0"> 
 <li> <h3>nim --eval:cmd</h3> </li> 
</ul> 
<p style="color:#000000; margin-left:0; margin-right:0; text-align:start">加入<span> </span><code>nim --eval:cmd</code><span style="color:#111111"><span> </span>来直接计算命令，比如<span> </span><code>nim --eval:"echo 1"</code></span><span> </span>。它默认为<span> </span><code>e</code><span> </span>(nimscript)。也可以跟其他命令一起用，例如：</p> 
<pre style="margin-left:0; margin-right:0"><code>find . | nim r --eval:<span style="color:#d01040">'import strutils; for a in stdin.lines: echo a.toUpper'</span>
<em># use as a calculator:</em>
nim --eval:<span style="color:#d01040">'echo 3.1 / (1.2+7)'</span>
<em># explore a module's APIs, including private symbols:</em>
nim --eval:<span style="color:#d01040">'import os &#123;.all.&#125;; echo weirdTarget'</span>
<em># use a custom backend:</em>
nim r -b:js --eval:<span style="color:#d01040">"import std/jsbigints; echo 2'big ** 64'big"</span></code></pre> 
<p style="color:#000000; margin-left:0; margin-right:0; text-align:start">更多详细信息，请查看PR<span> </span><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Fnim-lang%2FNim%2Fpull%2F15687" target="_blank">#15687</a>。</p> 
<ul style="margin-left:0; margin-right:0"> 
 <li> <h3>浮点数和字符串的相互转换</h3> </li> 
</ul> 
<p style="color:#000000; margin-left:0; margin-right:0; text-align:start"><code>system.addFloat</code><span> </span>和<span> </span><code>system.$</code><span> </span>能将浮点数转化成字符串形式，<span style="color:#2e3033">通过 Dragonbox 算法实现了这些特性</span>：最小规格、可以相互转换、正确的位数舍入。例如：</p> 
<pre style="margin-left:0; margin-right:0; text-align:start"><code><strong style="color:#000000">from</strong> <span>math</span> <strong style="color:#000000">import</strong> <span>round</span>
<strong style="color:#000000">let</strong> <span>a</span> <strong style="color:#000000">=</strong> <span>round</span><span>(</span><span style="color:#009999">9.779999999999999</span><span>,</span> <span style="color:#009999">2</span><span>)</span>
<span>assert</span> <span>a</span> <strong style="color:#000000">==</strong> <span style="color:#009999">9.78</span>
<span>echo</span> <span>a</span> <em># with `-d:nimPreviewFloatRoundtrip`: 9.78, like in python3 (instead of  9.779999999999999)</em></code></pre> 
<p style="color:#000000; margin-left:0; margin-right:0; text-align:start">目前只能通过<span> </span><span style="color:#111111"><code>-d:nimPreviewFloatRoundtrip</code><span> </span>开启这个功能，后面的版本可能会把这个设置成默认功能。</span></p> 
<ul style="margin-left:0; margin-right:0"> 
 <li> <h3>新模块：<code>std/jsbigints</code></h3> </li> 
</ul> 
<p style="color:#000000; margin-left:0; margin-right:0; text-align:start"><span style="color:#111111">为 JS 目标提供任意精度的整数，详见</span><span> </span>PR<span> </span><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Fnim-lang%2FNim%2Fpull%2F16409" target="_blank">#16409</a>。例如：</p> 
<pre style="margin-left:0; margin-right:0; text-align:start"><code><strong style="color:#000000">import</strong> <span>std</span><strong style="color:#000000">/</strong><span>jsbigints</span>
<span>assert</span> <span style="color:#009999">2</span><span style="color:#d01040">'big ** 65'</span><span>big</span> <strong style="color:#000000">==</strong> <span style="color:#009999">36893488147419103232</span><span style="color:#d01040">'big</span><span style="background-color:#e3d2d2; color:#a61717">
</span><span style="color:#d01040">echo 0xdeadbeef'</span><span>big</span> <strong style="color:#000000">shl</strong> <span style="color:#009999">4</span><span style="color:#d01040">'big # 59774856944n</span></code></pre> 
<ul style="margin-left:0; margin-right:0"> 
 <li> <h3>新模块：<code>std/sysrand</code></h3> </li> 
</ul> 
<p style="color:#000000; margin-left:0; margin-right:0; text-align:start"><span style="color:#2e3033">用于加密安全的伪随机数生成器，允许从操作系统提供的安全源生成随机数。详见</span><span> </span>PR<span> </span><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Fnim-lang%2FNim%2Fpull%2F16459" target="_blank">#16459</a>。例子：</p> 
<pre style="margin-left:0; margin-right:0; text-align:start"><code><strong style="color:#000000">import</strong> <span>std</span><strong style="color:#000000">/</strong><span>sysrand</span>
<span>assert</span> <span>urandom</span><span>(</span><span style="color:#009999">1234</span><span>)</span> <strong style="color:#000000">!=</strong> <span>urandom</span><span>(</span><span style="color:#009999">1234</span><span>)</span> <em># unlikely to fail in practice</em></code></pre> 
<ul style="margin-left:0; margin-right:0"> 
 <li> <h3>新模块：<code>std/tempfiles</code></h3> </li> 
</ul> 
<p style="color:#000000; margin-left:0; margin-right:0; text-align:start">允许创建临时文件和目录，详见 PR<span> </span><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Fnim-lang%2FNim%2Fpull%2F17361" target="_blank">#17361</a></p> 
<pre style="margin-left:0; margin-right:0; text-align:start"><code><strong style="color:#000000">import</strong> <span>std</span><strong style="color:#000000">/</strong><span>tempfiles</span>
<strong style="color:#000000">let</strong> <span>tmpPath</span> <strong style="color:#000000">=</strong> <span>genTempPath</span><span>(</span><span style="color:#d01040">"prefix"</span><span>,</span> <span style="color:#d01040">"suffix.log"</span><span>,</span> <span style="color:#d01040">"/tmp/"</span><span>)</span>
<em># tmpPath looks like: /tmp/prefixpmW1P2KLsuffix.log</em>

<strong style="color:#000000">let</strong> <span>dir</span> <strong style="color:#000000">=</strong> <span>createTempDir</span><span>(</span><span style="color:#d01040">"tmpprefix_"</span><span>,</span> <span style="color:#d01040">"_end"</span><span>)</span>
<em># created dir looks like: getTempDir() / "tmpprefix_YEl9VuVj_end"</em>

<strong style="color:#000000">let</strong> <span>(</span><span>cfile</span><span>,</span> <span>path</span><span>)</span> <strong style="color:#000000">=</strong> <span>createTempFile</span><span>(</span><span style="color:#d01040">"tmpprefix_"</span><span>,</span> <span style="color:#d01040">"_end.tmp"</span><span>)</span>
<em># path looks like: getTempDir() / "tmpprefix_FDCIRZA0_end.tmp"</em>
<span>cfile</span><span>.</span><span>write</span> <span style="color:#d01040">"foo"</span>
<span>cfile</span><span>.</span><span>setFilePos</span> <span style="color:#009999">0</span>
<span>assert</span> <span>readAll</span><span>(</span><span>cfile</span><span>)</span> <strong style="color:#000000">==</strong> <span style="color:#d01040">"foo"</span>
<span>close</span> <span>cfile</span>
<span>assert</span> <span>readFile</span><span>(</span><span>path</span><span>)</span> <strong style="color:#000000">==</strong> <span style="color:#d01040">"foo"</span></code></pre> 
<ul style="margin-left:0; margin-right:0"> 
 <li> <h3>用户自定义字面量</h3> </li> 
</ul> 
<p style="color:#000000; margin-left:0; margin-right:0; text-align:start"><span style="color:#2e3033">现在支持用户自定义数字型的字面值 (例如<span> </span><code>-128'bignum</code><span> </span>)，除此之外，</span><code>-1</code><span style="color:#111111"><span> </span>里面的负号也会作为整形字面常量的一部分被单个解析，</span>这意味着像<span> </span><code>-128'i8</code><span> </span>这样的边界案例也可以正常运行了，看一个例子：</p> 
<pre style="margin-left:0; margin-right:0; text-align:start"><code><strong style="color:#000000">func</strong> <span>`</span><span style="color:#d01040">'big`*(num: cstring): JsBigInt &#123;.importjs: "BigInt(#)".&#125;</span><span style="background-color:#e3d2d2; color:#a61717">
</span><span style="color:#d01040">assert 0xffffffffffffffff'</span><span>big</span> <strong style="color:#000000">==</strong> <span>(</span><span style="color:#009999">1</span><span style="color:#d01040">'big shl 64'</span><span>big</span><span>)</span> <strong style="color:#000000">-</strong> <span style="color:#009999">1</span><span style="color:#d01040">'big</span></code></pre> 
<ul style="margin-left:0; margin-right:0"> 
 <li> <h3>点状运算符</h3> </li> 
</ul> 
<p style="color:#000000; margin-left:0; margin-right:0; text-align:start">使用<span> </span><code>-d:nimPreviewDotLikeOps</code><span> </span>的时候，点状运算符<span> </span><code>.</code><span> </span>的优先级一模一样了，所以<span> </span><code>a.?b.c</code><span> </span>现在会解析成<code>(a.?b).c</code><span> </span>，而不是<span> </span><code>a.?(b.c)</code>。如果不是在<span> </span><code>-d:nimPreviewDotLikeOps</code><span> </span>的情况下使用点状运算符，就会出现警告<span style="color:#111111">。</span></p> 
<p style="color:#000000; margin-left:0; margin-right:0; text-align:start"><span style="color:#2e3033">建议启用动态字段，</span>比如<span> </span><code>std/jsffi</code><span style="color:#111111">,<span> </span></span><code>std/json</code><span style="color:#111111">,<span> </span></span><code>pkg/nimpy</code>，<span style="color:#2e3033">而不是影响内置的</span>点状运算符<span> </span><code>.</code>。看这个例子：</p> 
<pre style="margin-left:0; margin-right:0; text-align:start"><code><strong style="color:#000000">import</strong> <span>std</span><strong style="color:#000000">/</strong><span>json</span>
<strong style="color:#000000">template</strong> <span>`.</span><strong style="color:#000000">?</strong><span>`(</span><span>a</span><span>:</span> <span>JsonNode</span><span>,</span> <span>b</span><span>:</span> <span>untyped</span><span>&#123;</span><span>ident</span><span>&#125;):</span> <span>JsonNode</span> <strong style="color:#000000">=</strong>
  <span>a</span><strong style="color:#000000">[</strong><span>astToStr</span><span>(</span><span>b</span><span>)</span><strong style="color:#000000">]</strong>
<strong style="color:#000000">let</strong> <span>j</span> <strong style="color:#000000">=</strong> <strong style="color:#000000">%*</strong><span>&#123;</span><span style="color:#d01040">"a1"</span><span>:</span> <span>&#123;</span><span style="color:#d01040">"a2"</span><span>:</span> <span style="color:#009999">10</span><span>&#125;&#125;</span>
<span>assert</span> <span>j</span><span>.</span><strong style="color:#000000">?</strong><span>a1</span><span>.</span><strong style="color:#000000">?</strong><span>a2</span><span>.</span><span>getInt</span> <strong style="color:#000000">==</strong> <span style="color:#009999">10</span></code></pre> 
<ul style="margin-left:0; margin-right:0"> 
 <li> <h3>Block 参数可以选择形参</h3> </li> 
</ul> 
<p style="color:#000000; margin-left:0; margin-right:0; text-align:start">解决了接受 Block 参数的主要痛点，详见<span> </span><span style="color:#111111">PR<span> </span></span><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Fnim-lang%2FNim%2Fpull%2F18631" target="_blank">#18631</a>。</p> 
<pre style="margin-left:0; margin-right:0; text-align:start"><code><strong style="color:#000000">template</strong> <span>fn</span><span>(</span><span>a</span> <strong style="color:#000000">=</strong> <span style="color:#009999">1</span><span>,</span> <span>b</span> <strong style="color:#000000">=</strong> <span style="color:#009999">2</span><span>,</span> <span>body</span><span>)</span> <strong style="color:#000000">=</strong> <strong style="color:#000000">discard</strong>
<span>fn</span><span>(</span><span style="color:#009999">1</span><span>,</span> <span style="color:#009999">2</span><span>):</span> <em># already works</em>
  <span>bar</span>
<span>fn</span><span>(</span><span>a</span> <strong style="color:#000000">=</strong> <span style="color:#009999">1</span><span>):</span> <em># now works</em>
  <span>bar</span></code></pre> 
<p style="color:#000000; margin-left:0; margin-right:0; text-align:start">多个<span> </span><span style="color:#111111">block 参数可以用<span> </span><code>do</code></span><span> </span>来实现：</p> 
<pre style="margin-left:0; margin-right:0; text-align:start"><code><strong style="color:#000000">template</strong> <span>fn</span><span>(</span><span>a</span> <strong style="color:#000000">=</strong> <span style="color:#009999">1</span><span>,</span> <span>b</span> <strong style="color:#000000">=</strong> <span style="color:#009999">2</span><span>,</span> <span>body1</span><span>,</span> <span>body2</span><span>)</span> <strong style="color:#000000">=</strong> <strong style="color:#000000">discard</strong>
<span>fn</span><span>(</span><span>a</span> <strong style="color:#000000">=</strong> <span style="color:#009999">1</span><span>):</span> <em># now works</em>
  <span>bar1</span>
<strong style="color:#000000">do</strong><span>:</span>
  <span>bar2</span></code></pre> 
<h3 style="margin-left:.6em; margin-right:0; text-align:start">其他特性</h3> 
<p style="color:#000000; margin-left:0; margin-right:0; text-align:start">查看完整版更新日志，请<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Fnim-lang%2FNim%2Fblob%2Fversion-1-6%2Fchangelogs%2Fchangelog_1_6_0.md" target="_blank">点击这里</a>。</p> 
<p style="color:#000000; margin-left:0; margin-right:0; text-align:start"> </p> 
<p style="color:#000000; margin-left:0; margin-right:0; text-align:start">更新公告：<a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fnim-lang.org%2Fblog%2F2021%2F10%2F19%2Fversion-160-released.html" target="_blank">https://nim-lang.org/blog/2021/10/19/version-160-released.html</a></p>
                                        </div>
                                      
</div>
            