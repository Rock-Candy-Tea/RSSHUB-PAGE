
---
title: 'Rust 1.58.0 发布'
categories: 
 - 编程
 - 开源中国
 - 资讯
headimg: 'https://picsum.photos/400/300?random=6400'
author: 开源中国
comments: false
date: Fri, 14 Jan 2022 08:13:00 GMT
thumbnail: 'https://picsum.photos/400/300?random=6400'
---

<div>   
<div class="content">
                                                                                            <p>Rust 1.58.0 现已发布，该版本带来了在格式字符串中捕获的标识符、改变了 Windows 上的 Command 搜索路径，在标准库中增加了 #[must_use] 注释，以及一些新的库稳定性。<span style="background-color:#ffffff"><span style="color:#333333">如果你此前已通过 rustup 安装了以前的 Rust 版本，运行以下命令即可升级至最新版本：</span></span></p> 
<pre style="margin-left:0; margin-right:0; text-align:start"><code class="language-console"><span style="color:#6f42c1">rustup</span> <span style="color:#032f62">update stable</span></code></pre> 
<p style="color:#333333; margin-left:0; margin-right:0; text-align:left">具体更新内容包括： </p> 
<p><strong>格式字符串中捕获的标识符</strong></p> 
<p style="color:#000000; text-align:start">格式字符串现在可以通过在字符串中写入 &#123;ident&#125; 来捕获参数。<span style="background-color:#ffffff; color:#000000">格式长期以来接受位置参数（可选地通过索引）和命名参数，</span>例如：</p> 
<pre style="text-align:start"><code class="language-rust"><span style="color:#b65611">println!</span>(<span style="color:#60ac39">"Hello, &#123;&#125;!"</span>, get_person());                <span style="color:#aaaaaa">// implicit position</span>
<span style="color:#b65611">println!</span>(<span style="color:#60ac39">"Hello, &#123;0&#125;!"</span>, get_person());               <span style="color:#aaaaaa">// explicit index</span>
<span style="color:#b65611">println!</span>(<span style="color:#60ac39">"Hello, &#123;person&#125;!"</span>, person = get_person()); <span style="color:#aaaaaa">// named</span>
</code></pre> 
<p style="text-align:start"><span><span><span style="color:#000000"><span><span><span><span><span><span><span><span><span><span><span><span style="background-color:#ffffff"><span><span><span>现在命名参数也可以从周围的范围中捕获，例如：</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span><span><span><span style="color:#000000"><span><span><span><span><span><span><span><span><span><span style="background-color:#ffffff"><span><span><span> </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<pre style="text-align:start"><code class="language-rust"><span style="color:#b854d4">let</span> person = get_person();
<span style="color:#aaaaaa">// ...</span>
<span style="color:#b65611">println!</span>(<span style="color:#60ac39">"Hello, &#123;person&#125;!"</span>); <span style="color:#aaaaaa">// captures the local `person`</span>
</code></pre> 
<p style="color:#000000; text-align:start"><span style="background-color:#ffffff; color:#000000">这也可以用于格式化参数：</span></p> 
<pre style="text-align:start"><code class="language-rust"><span style="color:#b854d4">let</span> (width, precision) = get_format();
<span style="color:#b854d4">for</span> (name, score) <span style="color:#b854d4">in</span> get_scores() &#123;
  <span style="color:#b65611">println!</span>(<span style="color:#60ac39">"&#123;name&#125;: &#123;score:width$.precision$&#125;"</span>);
&#125;
</code></pre> 
<p style="text-align:start"><span><span><span style="color:#000000"><span><span><span><span><span><span><span><span><span><span><span><span style="background-color:#ffffff"><span><span><span>格式字符串只能捕获普通标识符，不能捕获任意路径或表达式。对于更复杂的参数，要么先将它们分配给本地名称，要么使用旧<code>name = expression</code>样式的格式化参数。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<p style="text-align:start"><span><span><strong><span><span><span><span style="color:#000000"><span><span><span><span><span><span><span><span><span><span style="background-color:#ffffff"><span><span><span>减少 Windows<code>Command</code>搜索路径</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></strong></span></span></p> 
<p style="color:#000000; text-align:start">在 Windows targets 上，std::process::Command 将不再搜索当前目录中的可执行文件。<span><span><span style="color:#000000"><span><span><span><span><span><span><span><span><span><span><span><span style="background-color:#ffffff"><span><span><span>Rust 现在在没有当前目录的情况下执行自己的搜索，并且不包括旧的 16 位目录，因为没有 API 来发现它的位置。所以 Windows 上 Rust 的新<code>Command</code>搜索顺序是：</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<ol> 
 <li><code>PATH</code>子环境变量中列出的目录。</li> 
 <li>加载应用程序的目录。</li> 
 <li>32 位 Windows 系统目录。</li> 
 <li>Windows 目录。</li> 
 <li><code>PATH</code>环境变量中列出的目录。</li> 
</ol> 
<p style="text-align:start"><span><span><span style="color:#000000"><span><span><span><span><span><span><span><span><span><span><span><span style="background-color:#ffffff"><span><span><span>Non-Windows targets 继续使用其特定于平台的行为，通常只考虑子或父<code>PATH</code>环境变量。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p> 
<p style="text-align:start"><span><span><strong><span><span><span><span style="color:#000000"><span><span><span><span><span><span><span><span><span><span style="background-color:#ffffff"><span><span><span>标准库中更多的<code>#[must_use]</code></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></strong></span></span></p> 
<p style="text-align:start"><span style="background-color:#ffffff; color:#000000">Library<span> </span></span><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fgithub.com%2Frust-lang%2Flibs-team%2Fissues%2F35" target="_blank">proposal 35</a> 在 2021 年 10 月被批准，以审核和扩大 #[must_use] 在整个标准库中的应用，<span style="background-color:#ffffff; color:#000000">涵盖更多以返回值为主要作用的 functions。这类似于 function purity 的想法，但比真正的语言特性要宽松。其中一些新增功能在 <a href="https://www.oschina.net/news/171826/rust-1-57-0-released">1.57.0</a> 版本中出现过，现在在 1.58.0 版本中已完成。</span></p> 
<p style="color:#333333; margin-left:0; margin-right:0; text-align:left"><strong>稳定的 API</strong></p> 
<p style="color:#333333; margin-left:0; margin-right:0; text-align:left"><span style="color:#333333">以下方法和特性的实现被稳定化：</span></p> 
<ul> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fstable%2Fstd%2Ffs%2Fstruct.Metadata.html%23method.is_symlink" target="_blank"><code>Metadata::is_symlink</code></a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fstable%2Fstd%2Fpath%2Fstruct.Path.html%23method.is_symlink" target="_blank"><code>Path::is_symlink</code></a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fstable%2Fstd%2Fprimitive.i8.html%23method.saturating_div" target="_blank"><code>&#123;integer&#125;::saturating_div</code></a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fstable%2Fstd%2Foption%2Fenum.Option.html%23method.unwrap_unchecked" target="_blank"><code>Option::unwrap_unchecked</code></a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fstable%2Fstd%2Fresult%2Fenum.Result.html%23method.unwrap_unchecked" target="_blank"><code>Result::unwrap_unchecked</code></a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fstable%2Fstd%2Fresult%2Fenum.Result.html%23method.unwrap_err_unchecked" target="_blank"><code>Result::unwrap_err_unchecked</code></a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fstable%2Fstd%2Ffs%2Fstruct.File.html%23method.options" target="_blank"><code>File::options</code></a></li> 
</ul> 
<p style="color:#333333; margin-left:0; margin-right:0; text-align:left"><span style="background-color:#ffffff; color:#000000"><span style="color:#000000">以下以前稳定的功能现在是</span></span><code>const</code><span style="background-color:#ffffff; color:#000000">。</span></p> 
<ul> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fstable%2Fstd%2Ftime%2Fstruct.Duration.html%23method.new" target="_blank"><code>Duration::new</code></a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fstable%2Fstd%2Ftime%2Fstruct.Duration.html%23method.checked_add" target="_blank"><code>Duration::checked_add</code></a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fstable%2Fstd%2Ftime%2Fstruct.Duration.html%23method.saturating_add" target="_blank"><code>Duration::saturating_add</code></a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fstable%2Fstd%2Ftime%2Fstruct.Duration.html%23method.checked_sub" target="_blank"><code>Duration::checked_sub</code></a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fstable%2Fstd%2Ftime%2Fstruct.Duration.html%23method.saturating_sub" target="_blank"><code>Duration::saturating_sub</code></a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fstable%2Fstd%2Ftime%2Fstruct.Duration.html%23method.checked_mul" target="_blank"><code>Duration::checked_mul</code></a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fstable%2Fstd%2Ftime%2Fstruct.Duration.html%23method.saturating_mul" target="_blank"><code>Duration::saturating_mul</code></a></li> 
 <li><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fdoc.rust-lang.org%2Fstable%2Fstd%2Ftime%2Fstruct.Duration.html%23method.checked_div" target="_blank"><code>Duration::checked_div</code></a></li> 
</ul> 
<p style="color:#333333; margin-left:0; margin-right:0; text-align:left"><span style="background-color:#ffffff; color:#333333">更多详情可</span><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fblog.rust-lang.org%2F2022%2F01%2F13%2FRust-1.58.0.html" target="_blank">查看官方博客</a><span style="background-color:#ffffff; color:#333333">。</span></p>
                                        </div>
                                      
</div>
            