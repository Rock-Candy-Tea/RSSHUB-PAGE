
---
title: '运维监控体系总结'
categories: 
 - 编程
 - Dockone
 - 周报
headimg: 'https://picsum.photos/400/300?random=329'
author: Dockone
comments: false
date: 2021-08-20 06:08:52
thumbnail: 'https://picsum.photos/400/300?random=329'
---

<div>   
<br>总结归纳运维工作中的监控内容。<br>
<h3>监控目标</h3>明白监控的重要性以及使用监控要实现的业务目标。<br>
<br>通常包括以下三点：<br>
<ul><li>对目标系统进行实时监控</li><li>监控可以实时反馈目标系统的当前状态，目标系统硬件、软件、业务是否正常、目前处于何种状态</li><li>保证目标系统可靠性，业务可以持续稳定运行，有问题第一时间反馈出来，便于运维人员处理</li></ul><br>
<br><h3>监控方法</h3><ul><li>了解监控对象，例如：CPU如何工作</li><li>性能基准指标，例如：CPU使用率、负载、用户态、内核态、上下文切换</li><li>报警阈值定义，例如：CPU负载高的定义，内核态、用户态多少算高</li><li>故障处理流程，如何更高效处理故障的流程</li></ul><br>
<br><h3>监控核心</h3><ul><li>发现问题</li><li>定位问题</li><li>解决问题</li><li>总结问题，对故障原因及问题防范进行归纳总结，避免以后重复出现</li></ul><br>
<br><h3>监控工具</h3><ul><li><br>老牌监控<br>
<ul><li>Cacti</li><li>Nagios</li><li>SmokePing</li></ul></li><li><br>流行监控<br>
<ul><li>Zabbix</li><li>OpenFalcon</li><li>Prometheus+Grafana</li><li>滴滴开源夜莺Nightingale</li><li>Smartping（专用于网络监控）</li><li>Lepus天兔（专用于监控数据库）</li></ul></li><li><br>自研</li><li><br>第三方监控<br>
<ul><li>监控宝</li><li>听云</li><li>New Relic</li></ul></li></ul><br>
<br><h3>监控流程</h3><ul><li>采集，通过SNMP、Agent、ICMP、SSH、IPMI等对系统进行数据采集</li><li>存储，各类数据库服务,MySQL、PostgreSQL</li><li>分析，提供图形及时间线情况信息，方便我们定位故障所在</li><li>展示，指标信息、指标趋势展示</li><li>报警，电话、邮件、微信、短信、报警升级机制</li><li>处理，故障级别判定，找响应人员进行快速处理</li></ul><br>
<br><h3>监控指标</h3><h4>硬件监控</h4><ul><li>机器硬件：CPU温度、物理磁盘、虚拟磁盘、主板温度、磁盘阵列</li><li>IPMI工具无法获取到硬件的状态，可以借助MegaCli工具探测Raid磁盘队列状态</li><li><a href="https://www.ibm.com/developerworks/cn/linux/l-ipmi/" rel="nofollow" target="_blank">https://www.ibm.com/developerw ... ipmi/</a></li></ul><br>
<br><h4>系统监控</h4><ul><li>主机存活</li><li>CPU、内存、硬盘、使用率</li><li>inode</li><li>负载</li><li>网卡出入带宽</li><li>TCP连接数</li><li>磁盘读写、只读</li></ul><br>
<br><h4>应用监控</h4><ul><li><br>MySQL<br>
<ul><li>服务可用性</li><li>内存使用率</li><li>磁盘使用</li><li>主从不同步及延迟</li><li>备份情况</li><li>连接数</li></ul></li><li><br>Redis、Redis Cluster<br>
<ul><li>负载</li><li>内存使用率</li><li>连接数量</li><li>QPS</li></ul></li><li><br>Nginx<br>
<ul><li>状态码</li><li>连接状态信息</li></ul></li><li><br>RabbitMQ</li><li>PHP-FPM</li><li><br>OpenLDAP<br>
<ul><li>接入IP</li><li>调用次数</li></ul></li><li><br>Zimbra</li><li><br>OpenVPN<br>
<ul><li>版本信息、当前在线</li><li>用户、分配IP、客户端连接IP、通过IP获取地址位置、接收发送流量 连接时间 时长 连接ID</li></ul></li><li><br>ELK</li><li>Graylog</li><li>GitLab</li><li>Jenkins</li><li>MongoDB</li><li>HAproxy</li></ul><br>
<br><h4>网络监控</h4><ul><li>网络质量</li><li>公网出口</li><li>专线带宽</li><li>网络设备</li></ul><br>
<br><h4>流量分析</h4><h4>日志监控</h4><h4>安全监控</h4><h4>URL、API监控</h4><ul><li><a href="https://github.com/brotandgames/ciao" rel="nofollow" target="_blank">https://github.com/brotandgames/ciao</a>，简单易用</li><li><a href="https://github.com/710leo/urlooker" rel="nofollow" target="_blank">https://github.com/710leo/urlooker</a></li><li>自研</li><li>阿里云方案</li></ul><br>
<br><h4>性能监控（APM）Java|PHP|Go|Nodejs|分布式链路追踪</h4><ul><li>PinPoint</li><li>Zipkin</li><li>SkyWalking</li><li>CAT、Jaeger</li></ul><br>
<br><h4>业务监控</h4>电商业务为例：<br>
<ul><li>每分钟产生多少订单</li><li>每分钟注册多少用户</li><li>每分钟多少活跃用户</li><li>每天有多少推广活动</li><li>推广活动引入多少用户</li><li>推广活动引入多少流量</li><li>推广活动引入多少利润</li></ul><br>
<br><h4>其他</h4><ul><li>SSL证书监控</li><li>存活性 进程是否还在，端口监听、Log滚动</li><li>健康指标 MQ消息堆积量</li><li>接口监控 API成功率，延迟情况，QPS等等</li></ul><br>
<br><h3>监控报警</h3><ul><li>邮件</li><li>短信</li><li>钉钉、微信、企业微信等其他即时通信软件</li><li>电话</li></ul><br>
<br><h3>报警处理</h3>故障自愈：服务器宕机自动启动。利用软件机制Supervisor，Systemd或者自定义脚本实现。<br>
<h3>综合监控</h3><h4>硬件监控</h4>通过SNMP来进行路由器交换机的监控、其他内容使用IPMI实现。如果都是公有云，可以忽略这部分内容。案例：<a href="https://www.mdslq.cn/archives/186e54d8.html">Open-Falcon监控H3C-ER3260G2路由器</a><br>
<h4>系统监控</h4><h4>服务监控</h4><ul><li><br>服务自带<br>
<ul><li>Nginx自带status模块</li><li>PHP相应status模块</li><li>MySQL利用Percona官方工具进行监控</li></ul></li><li><br>通过自定义方法获取数据<br>
<ul><li>MySQL show global status xxx；</li><li>Redis info指令信息</li></ul></li></ul><br>
<br><h4>网络监控（混合云架构）</h4><ul><li>SmokePing</li><li>SmartPing</li></ul><br>
<br><h4>安全监控</h4><ul><li>云服务直接用云安全组即可，或者补充本机iptables</li><li>硬件防火墙</li><li>Web服务使用Nginx+Lua实现Web层面的防火墙，或者Openresty</li></ul><br>
<br><h4>日志监控</h4>ELK、Graylog实现异常日志，错误日志关键字的监控。<br>
<h4>业务监控</h4>确定监控指标，监控起来，业务不同各不相同。<br>
<h4>流量分析</h4>建议使用百度统计，Google统计，商业，研发嵌入代码实现。或者使用<a href="https://www.piwik.cn/">piwik</a><br>
<h4>可视化</h4>Dashboard<br>
<h4>自动化监控</h4>通过API，批量操作<br>
<h3>监控总结</h3>完整的监控系统，需要对业务有详尽的了解，软件只是手段。<br>
<br>原文链接：<a href="https://zhuanlan.zhihu.com/p/342809838" rel="nofollow" target="_blank">https://zhuanlan.zhihu.com/p/342809838</a>
                                
                                                              
</div>
            