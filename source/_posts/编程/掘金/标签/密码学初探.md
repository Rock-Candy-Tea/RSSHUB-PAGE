
---
title: '密码学初探'
categories: 
 - 编程
 - 掘金
 - 标签
headimg: 'https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/61ede967e5d747e388b79cf5f443ce42~tplv-k3u1fbpfcp-watermark.image'
author: 掘金
comments: false
date: Mon, 22 Mar 2021 23:49:23 GMT
thumbnail: 'https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/61ede967e5d747e388b79cf5f443ce42~tplv-k3u1fbpfcp-watermark.image'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><h2 data-id="heading-0">基本认知</h2>
<p>密码学有着严格的规范，其算法的实现原理是公开的。密码学算法是相对安全的，主要解决四个问题：</p>
<ul>
<li>机密性（隐私性）：在网络中传递的数据如果具备机密性，只有拥有密钥的才能解释这些数据，密钥是加密算法的关键。</li>
<li>完整性：接收方能够确保接收到的数据就是发送方发送的原始数据，在密码学中，主要使用消息验证码（<code>MAC</code>）算法保证完整性。</li>
<li>身份验证：通信双方必须确保对端就是要通信的对象。在密码学中，一般使用数字签名技术确认身份。</li>
<li>不可抵赖性：在密码学中，数字签名技术能够避免抵赖。</li>
</ul>
<blockquote>
<p>OpenSSL：是<code>SSL</code>和<code>TLS</code>最常见的开源实现，包括了底层密码库和命令行工具，其目标是开发一个强壮的、具有完备功能的商业级工具集，以实现<code>SSL</code>和<code>TLS</code>协议以及一个全功能的通用加密库。</p>
</blockquote>
<h2 data-id="heading-1">随机数</h2>
<h3 data-id="heading-2">随机数的类型</h3>
<p><img alt="image.png" class="lazyload" src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/61ede967e5d747e388b79cf5f443ce42~tplv-k3u1fbpfcp-watermark.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<h3 data-id="heading-3">随机数的工作原理</h3>
<p>随机数生成器内部会维护一个<code>状态（internal state）</code>，对于随机数生成器（TRNG）来说，内部状态的数值来自外部设备，称为<code>熵（entrory）</code>，比如动态的时间、变化的温度、声音的变化、鼠标位置。而对于<code>伪随机数生成器（PRNG）</code>来说，内部状态的数值来自于模拟的数值，称为<code>种子（seed）</code>。随机数生成器每次生成随机数的时候，内部状态的值都会变化，这样才能产生不一样的随机数，如果每次熵和种子是一样的，生成的随机数也是相同的。</p>
<h2 data-id="heading-4">Hash算法</h2>
<p>由于<code>Hash算法</code>有很多功能，比如<code>摘要算法（Message DigestAlgorithms）、单向散列函数（Cryptographic One-way Hash Functions）</code>。输出值也有多种称呼，比如<code>摘要值、散列、指纹</code>。<code>密码学Hash算法</code>是非常重要的一个算法，是现代密码学中的核心组成部分，其主要特性如下：</p>
<ul>
<li>相同的消息总是能得到同样的摘要值，特定的Hash算法，不管消息长度是多少，最终的摘要值<code>长度是相同</code>的。</li>
<li>不管多长的消息，Hash运算非常快速。</li>
<li>通过摘要值很难逆向计算出原始消息，Hash算法具备<code>单向性</code>，摘要值是不可逆的。为了逆向计算出原始消息，唯一的方法就是采用暴力攻击、字典攻击、彩虹表，对不同的消息组合进行迭代运算，运算的结果如果匹配该消息的摘要值，表示该Hash算法不应该用于密码学。</li>
<li>原始消息一旦修改，即使是很轻微的修改，最终的摘要值也会产生变化。</li>
<li>很难找出两个不同的消息，并且它们的摘要值是相同的。</li>
</ul>
<blockquote>
<p>密码学Hash算法有很多，比如<code>MD5算法、SHA族类算法</code>，MD5早已被证明是不安全的Hash算法了，目前使用最广泛的Hash算法是SHA族类算法。</p>
</blockquote>
<h2 data-id="heading-5">对称加密算法</h2>
<p>通过一个算法和一个<code>密钥（secret key）</code>对<code>明文（plaintext）</code>进行处理，得到的不规则字符就是<code>密文（ciphertext）</code>。对称加密算法有两种类型，分别是<code>块密码算法（block ciphers）</code>和<code>流密码算法（stream ciphers）</code>。<code>AES、DES、3DES</code>等是常见的对称加密算法。</p>
<p><img alt="image.png" class="lazyload" src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/653905e353ab4f999f274f09f6bf5658~tplv-k3u1fbpfcp-watermark.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<p>对称加密算法可以用下列公式简单表述：</p>
<blockquote>
<p>密文=E（明文，算法，密钥）</p>
<p>明文=D（密文，算法，密钥）</p>
</blockquote>
<p>E和D分别表示加密和解密，通过公式可以了解几个关键点：</p>
<ul>
<li>密钥是关键，密钥是一串数字，加密和解密使用同样的一个密钥，如果没有密钥，基于密文是无法获取明文的。</li>
<li>加密和解密操作（算法）是一个互逆过程，算法的背后就是复杂的数学知识。</li>
</ul>
<h2 data-id="heading-6">消息验证码</h2>
<p>Hash算法能够完成密码学目标之一的完整性校验，但却不能避免消息被篡改，为避免消息被篡改，需要用到<code>消息验证码（MAC）</code>。消息验证码非常重要，一般结合加密算法一起使用。消息验证码算法具有如下特点：</p>
<ul>
<li>证明消息没有被篡改，这和Hash算法类似。</li>
<li>消息是正确的发送者发送的，也就是说消息是经过验证的。</li>
</ul>
<p>通信双方可以维护同一个密钥，只有拥有密钥的通信双方才能生成和验证消息验证码，消息验证码算法需要一个密钥，这和对称加密算法是一样的，通信双方在消息传递之前需要获得同样的密钥。过程图如下：</p>
<p><img alt="image.png" class="lazyload" src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/065710df132b47c3bb6192a78582fccb~tplv-k3u1fbpfcp-watermark.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<p>消息认证实际上是对消息本身产生一个冗余的信息－<code>MAC（消息认证码）</code>，消息认证码是利用密钥对要认证的消息产生新的数据块并对数据块加密生成的。它对于要保护的信息来说是唯一和一一对应的。因此可以有效地保护消息的<code>完整性</code>，以及实现发送方消息的不能伪造。</p>
<h2 data-id="heading-7">公开密钥算法（非对称加密）</h2>
<p>公开密钥算法表示密钥可以部分公开，公开密钥算法的密钥是一对，分别是<code>公钥（public key）</code>和<code>私钥（private key）</code>，一般私钥由密钥对的生成方（比如服务器端）持有，避免泄露，而公钥任何人都可以持有，也不怕泄露。公开密钥算法的功能比较多，可以进行<code>加密解密、密钥协商、数字签名</code>。公开密钥算法最重要和最广泛的就是<code>RSA算法</code>。相比对称加密算法来说，公开密钥算法尤其是<code>RSA算法</code>运算非常缓慢，加解密过程如下：</p>
<p><img alt="image.png" class="lazyload" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/12037d63c7ac4721b189c6a2204d6477~tplv-k3u1fbpfcp-watermark.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<h2 data-id="heading-8">密钥协商算法</h2>
<p>在网络通信应用中，密钥的管理和分配是个难题，尤其是生成一个动态密钥更难，而密钥协商算法就可以解决密钥分配、存储、传输等问题。</p>
<h3 data-id="heading-9">RSA密钥协商算法</h3>
<p>通过一个例子看看<code>RSA密钥协商算法</code>如何工作的：</p>
<ul>
<li>客户端初始化连接服务器端，服务器发送<code>RSA密钥对的公钥</code>给客户端。</li>
<li>客户端生成一个<code>随机值</code>，这个值必须是随机的，不能被攻击者猜出，这个值就是<code>会话密钥</code>。</li>
<li>客户端使用服务器<code>RSA密钥对的公钥</code>加密会话密钥，并发送给服务器端，由于攻击者没有服务器的私钥，所以无法解密会话密钥。</li>
<li>服务器端用它的<code>私钥</code>解密出会话密钥。</li>
<li>至此双方完成连接，接下来服务器端和客户端可以使用<code>对称加密算法</code>和<code>会话密钥</code>加密解密数据。</li>
</ul>
<h3 data-id="heading-10">DH密钥协商算法</h3>
<p>DH算法确切地说，实现的是<code>密钥交换</code>或者<code>密钥协商</code>，DH算法在进行密钥协商的时候，通信双方的任何一方无法独自计算出一个<code>会话密钥</code>，通信双方各自保留一部分关键信息，再将另外一部分信息告诉对方，双方有了全部信息才能<code>共同</code>计算出相同的会话密钥。DH算法处理过程：</p>
<p><img alt="image.png" class="lazyload" src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3317db293d174c2da7d3bbd326396d05~tplv-k3u1fbpfcp-watermark.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<h2 data-id="heading-11">数字签名</h2>
<p><code>RSA签名算法</code>和<code>DSA签名算法</code>都可以实现数字签名，数字签名技术能够进行身份验证，防止抵赖、防止篡改、防止伪造。数字签名流程如下：</p>
<p><img alt="image.png" class="lazyload" src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6bc91aaad5cf4c27aad79cfaa0eb82cd~tplv-k3u1fbpfcp-watermark.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<p>数字签名技术的本质不是为了加密，所以和签名值一同传递的消息是不用加密的，当然也可以对消息加密后再计算签名值。签名验证流程如图：</p>
<p><img alt="image.png" class="lazyload" src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fafec67388404352a9ffc7a126ad7948~tplv-k3u1fbpfcp-watermark.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<blockquote>
<p>考虑到公开密钥算法运行是相对缓慢的，数字签名算法建议对消息摘要值进行签名，因为摘要值的长度是固定的，运算的时候速度会比较快。</p>
</blockquote>
<h2 data-id="heading-12">参考</h2>
<ul>
<li>《深入浅出HTTPS：从原理到实战》（虞卫东）</li>
</ul></div> <div class="image-viewer-box" data-v-78c9b824><!----></div>  
</div>
            