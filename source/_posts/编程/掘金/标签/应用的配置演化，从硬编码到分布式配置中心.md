
---
title: '应用的配置演化，从硬编码到分布式配置中心'
categories: 
 - 编程
 - 掘金
 - 标签
headimg: 'https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e2e77846f2ee4dfaa6c9ea635183cc16~tplv-k3u1fbpfcp-watermark.image'
author: 掘金
comments: false
date: Fri, 20 Aug 2021 07:15:12 GMT
thumbnail: 'https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e2e77846f2ee4dfaa6c9ea635183cc16~tplv-k3u1fbpfcp-watermark.image'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><p><strong>这是我参与8月更文挑战的第20天，活动详情查看：<a href="https://juejin.cn/post/6987962113788493831" target="_blank" title="https://juejin.cn/post/6987962113788493831">8月更文挑战</a></strong></p>
<blockquote>
<ul>
<li>📢欢迎点赞 ：👍 收藏 ⭐留言 📝 如有错误敬请指正，赐人玫瑰，手留余香！</li>
<li>📢本文作者：由webmote 原创，首发于 【掘金】</li>
<li>📢作者格言： 生活在于折腾，当你不折腾生活时，生活就开始折腾你，让我们一起加油！💪💪💪</li>
</ul>
</blockquote>
<h1 data-id="heading-0">🎏 序言</h1>
<p>每个应用或者服务都会或多或少的接触到配置参数，最简单的应用可能会把配置硬编码到程序代码里，而更复杂的微服务可能需要一个统一的配置中心来发布配置参数，就让我们看看它们的发展历程吧。</p>
<h1 data-id="heading-1">🎏 1.硬编码配置</h1>
<p>硬编码就是直接把配置参数写到代码内，虽然硬编码可能看起来不是很完美，但其实它的出现还是非常多的。</p>
<p>比如我们常用的桌面软件，大部分都是硬编码到内置代码，而不需要用户修改任何参数的。</p>
<p>像我们在windows上使用的记事本、画图等，它们内部也许有简单的参数，甚至并没有多余的参数，当然既然没有暴露出什么配置文件，必然会硬编码到系统内的。</p>
<p>有时候我们自己开发一些简单小工具，就仅仅限于内部用，也会简单的硬编码到代码中。</p>
<p>硬编码形式如下：</p>
<pre><code class="hljs language-csharp copyable" lang="csharp"> SqlConnection conn = <span class="hljs-keyword">new</span> SqlConnection();
 conn.ConnectionString = <span class="hljs-string">@"Data Source=.;Integrated Security=true;Initial Catalog=Time"</span>;
 conn.Open();
<span class="copy-code-btn">复制代码</span></code></pre>
<h1 data-id="heading-2">🎏 2.配置文件</h1>
<p>随着系统的环境越来越复杂，可能我们需要在不同的环境设置不同的参数，那么最流行的一种配置方式出现了，它就是配置文件。</p>
<p>asp.net core内置了对配置文件的支持，因此使用起来也很方便。 并且通过对延展扩展名文件的监控支持，可以支持不同环境加载不同的配置文件。</p>
<p>这里以appsetting.json为例，看看配置文件是什么样的形式。</p>
<pre><code class="hljs language-csharp copyable" lang="csharp"><span class="hljs-string">"profiles"</span>: &#123; <span class="hljs-string">"IIS Express"</span>: 
&#123; <span class="hljs-string">"commandName"</span>: <span class="hljs-string">"IISExpress"</span>, <span class="hljs-string">"launchBrowser"</span>: <span class="hljs-literal">true</span>, <span class="hljs-string">"environmentVariables"</span>: 
&#123; <span class="hljs-string">"ASPNETCORE_ENVIRONMENT"</span>: <span class="hljs-string">"Development"</span> &#125;, <span class="hljs-string">"nativeDebugging"</span>: <span class="hljs-literal">true</span> &#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>现在流行的是json文件作为配置文件，当然还有更多的文件作为配置，比如经典的ini文件格式，曾经风靡一时的xml文件，现在云原生常用的yaml格式。</p>
<pre><code class="hljs language-yaml copyable" lang="yaml"><span class="hljs-attr">languages:</span>
 <span class="hljs-bullet">-</span> <span class="hljs-string">Ruby</span>
 <span class="hljs-bullet">-</span> <span class="hljs-string">Perl</span>
 <span class="hljs-bullet">-</span> <span class="hljs-string">Python</span> 
<span class="hljs-attr">websites:</span>
 <span class="hljs-attr">YAML:</span> <span class="hljs-string">yaml.org</span> 
 <span class="hljs-attr">Ruby:</span> <span class="hljs-string">ruby-lang.org</span> 
 <span class="hljs-attr">Python:</span> <span class="hljs-string">python.org</span> 
 <span class="hljs-attr">Perl:</span> <span class="hljs-string">use.perl.org</span> 
<span class="copy-code-btn">复制代码</span></code></pre>
<h1 data-id="heading-3">🎏 3.配置到数据库、远程文件</h1>
<p>配置文件还可以存储到数据库或远程文件，这种的存储方式和本地配置文件稍微不同，具有分布式访问的特性。
微服务的配置，如果未能实现配置中心，可以采用这种方式，作为集中式配置管理的一种方式，具有统一配置，独立分发的特性。如果用一些定时拉的方式，甚至可以实现运行时更新的效果。</p>
<p>从网上借一张图，来看看大概数据库的存储。</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e2e77846f2ee4dfaa6c9ea635183cc16~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<h1 data-id="heading-4">🎏 4. Apollo配置中心</h1>
<p>作为微服务配置中心的佼佼者，携程的Apollo，架构复杂，使用简单。其架构方式如下：</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/426e495fd69448199aeaf7e03f367490~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>其拥有丰富的功能和可配置的界面，可谓开箱即用型，当然其部署作为配置中心来看是重量级的。</p>
<ul>
<li>推配置</li>
<li>拉配置</li>
<li>灰度</li>
<li>版本</li>
<li>...</li>
</ul>
<h1 data-id="heading-5">🎏 5. 云原生配置</h1>
<p>提到云原生的配置，那肯定是K8s的configmap资源方式，通过配置映射文件，可以在每个容器启动时加载到容器的环境变量内，以供使用。</p>
<p>虽然其底层并不支持热更新，但利用K8s自身的实例加载功能，也算是间接的实现了热更新。</p>
<h1 data-id="heading-6">🎏 6. 小结</h1>
<p>嗯，这章有点水了，后面再总结时补充进来。</p>
<p>例行小结，理性看待！</p>
<p>结的是啥啊，结的是我想你点赞而不可得的寂寞。😳😳😳</p>
<p>👓都看到这了，还在乎点个赞吗？</p>
<p>👓都点赞了，还在乎一个收藏吗？</p>
<p>👓都收藏了，还在乎一个评论吗？</p></div>  
</div>
            