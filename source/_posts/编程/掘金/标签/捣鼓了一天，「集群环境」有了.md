
---
title: '捣鼓了一天，「集群环境」有了'
categories: 
 - 编程
 - 掘金
 - 标签
headimg: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/39bdc7381c2c4925a0dfe1df43297380~tplv-k3u1fbpfcp-watermark.image'
author: 掘金
comments: false
date: Mon, 09 Aug 2021 06:27:44 GMT
thumbnail: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/39bdc7381c2c4925a0dfe1df43297380~tplv-k3u1fbpfcp-watermark.image'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><p><strong>这是我参与8月更文挑战的第3天，活动详情查看：<a href="https://juejin.cn/post/6987962113788493831" title="https://juejin.cn/post/6987962113788493831" target="_blank">8月更文挑战</a></strong></p>
<blockquote>
<p><strong>作者简介</strong>：悟空，8年一线互联网开发和架构经验，用故事讲解分布式、架构设计、Java 核心技术。《JVM性能优化实战》专栏作者，开源了《Spring Cloud 实战 PassJava》项目，公众号：<code>悟空聊架构</code>。本文已收录至 <a href="https://link.juejin.cn/?target=http%3A%2F%2Fwww.passjava.cn" title="https://link.juejin.cn?target=http%3A%2F%2Fwww.passjava.cn" target="_blank">www.passjava.cn</a></p>
</blockquote>
<p><br>
作者：悟空聊架构<br>
链接：<a href="https://juejin.cn/post/6993828343636295710%5C" target="_blank" title="https://juejin.cn/post/6993828343636295710%5C">juejin.cn/post/699382…</a>
来源：掘金<br>
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p>
<p>大家好，我是悟空。</p>
<p>闲来无事，在本地用虚拟机搭建了 4 个 centos 的集群环境，机器之间可以相互访问。从此以后我的本地就有一套<code>集群环境</code>了，真正意义上可以模拟<code>分布式</code>的环境了！后面还可以模拟大型电商项目的<code>高并发</code>场景，美滋滋！</p>
<p>比如我想搭建 Redis 集群、Kafaka 集群、Storm 集群，这套环境统统可以搞定。</p>
<p>本篇非常详尽地记录了我是如何搭建这套集群基础环境的，为了防止遇到其他坑，每步我都有截图，就是为了方便大家跟着搭一套。</p>
<p><strong>通过本篇，你可以学到</strong>：</p>
<ul>
<li>如何搭建和组成 Linux 集群环境。</li>
<li>如何使多台机器在同一个网段。</li>
<li>如何使机器之间免密登录。</li>
<li>Linux 环境配置 Java 开发环境（可自行安装 JDK 8）。</li>
<li>Linux 环境配置 Perl 5.6 开发环境。</li>
<li>支持 SecureCRT 远程登录多套机器。</li>
<li>支持 WinSCP 远程拷贝文件。</li>
</ul>
<p><strong>注意</strong>：Redis、Kafka 集群，不会放到这一讲中，本讲主要是讲解集群的基础环境搭建，对于搭建中间件的集群环境会放到后面几讲中。</p>
<p>接下来介绍怎么一步步配置集群环境的，建议先收藏。安装所需的软件，到公众号 悟空聊架构 后台回复 集群软件 下载。</p>
<h2 data-id="heading-0">配置虚拟机</h2>
<h3 data-id="heading-1">创建虚拟机</h3>
<p>软件：VirtualBox</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/39bdc7381c2c4925a0dfe1df43297380~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c72767b45f894573a89c997d2db247b5~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7d0b0afb94af46cbb7d9a30185e2b418~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>添加操作系统镜像文件。镜像文件在公众号<code>悟空聊架构</code>后台回复<code>集群软件</code></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ac29763888eb44a6970790aedfeaa93c~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<h3 data-id="heading-2">配置网络</h3>
<p>选择桥接模式</p>
<h3 data-id="heading-3">启动虚拟机</h3>
<p>点击启动按钮</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7a157e8556cd4c7c9c83bd86e115deef~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>选择 Skip</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/24d3d2d55fd74cd1bb25fa0a8868614a~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a9c53c696c674d5c9a1481594f85f405~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>Next</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d7136dc24f944dfd99095ed0365da1fa~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>Next</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8287dcabd8fd4ac28a74a32a1378803b~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>Next</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/339a31c556bd4c7a8d2ece9f723a5bd2~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>Yes, discard any data</p>
<p>配置域名 eshop-cache01</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fffe3cb9b9e54d0688da10e0c6cc7ccf~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>时区选择亚洲-上海，如果配置错了，可以通过以下命令修改：</p>
<pre><code class="hljs language-SH copyable" lang="SH">cp  /usr/share/zoneinfo/Asia/Shanghai  /etc/localtime
<span class="copy-code-btn">复制代码</span></code></pre>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/da29d8cbce9040e1b593bbc8166e2ff1~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>密码：huang123</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1841b3155ab745a2808c6278ee99faef~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2c9276a6367f445db9af2e81754b66b6~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e32f60f932b44659bbdc51503b876217~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f37e1dd03f7f42dead953abfb7112cd0~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>选择 Reboot：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/31355d6175e84fa8a2e10ddbe197c740~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<h3 data-id="heading-4">配置网络</h3>
<p>现在不能连外网，如下图所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6b17f860754a44679ff97d9732624b58~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>按照如下配置，获取动态 IP</p>
<pre><code class="hljs language-SH copyable" lang="SH">vi /etc/sysconfig/network-scripts/ifcfg-eth0
<span class="hljs-comment"># 只保留以下几项，可以按键盘上的 DD 删除多余的 3 行。</span>
DEVICE=eth0
TYPE=Ethernet
ONBOOT=yes
BOOTPROTO=dhcp
<span class="copy-code-btn">复制代码</span></code></pre>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bd29b8745b4345cb9de5f9c50047e525~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<pre><code class="hljs language-SH copyable" lang="SH">service network restart
ifconfig
<span class="copy-code-btn">复制代码</span></code></pre>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b34b559df1614ac5b8cd56fbed527cda~tplv-k3u1fbpfcp-watermark.image" alt="mark" loading="lazy" referrerpolicy="no-referrer"></p>
<p>动态 IP 地址为 192.168.10.86</p>
<pre><code class="hljs language-SH copyable" lang="SH">vi /etc/sysconfig/network-scripts/ifcfg-eth0
BOOTPROTO=static
<span class="copy-code-btn">复制代码</span></code></pre>
<p>需要改为静态 IP 地址</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/31673f5f8abc4fe5a120bd29d745fbf8~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>修改配置文件</p>
<pre><code class="hljs language-sh copyable" lang="sh">BOOTPROTO=static
IPADDR=192.168.10.86
NETMASK=255.255.255.0
GATEWAY=192.168.10.1
<span class="copy-code-btn">复制代码</span></code></pre>
<p>改完后，保存，执行以下命令，重启网络</p>
<pre><code class="copyable">service network start
<span class="copy-code-btn">复制代码</span></code></pre>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d93e6f553bee46a4b6a12f8da5f368f0~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>测试下是否能 ping 通 <a href="https://link.juejin.cn/?target=http%3A%2F%2Fwww.baidu.com" target="_blank" rel="nofollow noopener noreferrer" title="http://www.baidu.com" ref="nofollow noopener noreferrer">www.baidu.com</a></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a15348027396486f9adac9b83d0bf2bd~tplv-k3u1fbpfcp-watermark.image" alt="mark" loading="lazy" referrerpolicy="no-referrer"></p>
<h3 data-id="heading-5">配置 hosts</h3>
<p>配置本机的 hostname 到 ip 地址的映射。</p>
<pre><code class="hljs language-SH copyable" lang="SH">vi /etc/hosts
192.168.10.86 eshop-cache01
<span class="copy-code-btn">复制代码</span></code></pre>
<h3 data-id="heading-6">安装 SecureCRT</h3>
<p>SecureCRT 用来连接虚拟机非常方便。</p>
<p>在百度网盘下载，按照使用说明安装。</p>
<p>就可以连接虚拟机了。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f916e7c1615d4359879a5c160177dded~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<h3 data-id="heading-7">关闭防火墙</h3>
<p>为了防止集群之间通信问题，关掉防火墙。</p>
<pre><code class="hljs language-sh copyable" lang="sh">service iptables stop
service ip6tables stop
chkconfig iptables off
chkconfig ip6tables off

vi /etc/selinux/config
SELINUX=disabled
<span class="copy-code-btn">复制代码</span></code></pre>
<h3 data-id="heading-8">安装 yum 工具</h3>
<pre><code class="hljs language-SH copyable" lang="SH"><span class="hljs-comment"># 配置阿里的仓库源</span>
sed -i <span class="hljs-string">"s|enabled=1|enabled=0|g"</span> /etc/yum/pluginconf.d/fastestmirror.conf
mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup
curl -o /etc/yum.repos.d/CentOS-Base.repo https://www.xmpan.com/Centos-6-Vault-Aliyun.repo 
<span class="copy-code-btn">复制代码</span></code></pre>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/463e8fdc3ecd4aa9b2ca5f8fdff95c6b~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<pre><code class="hljs language-SH copyable" lang="SH">yum clean all
yum makecache
<span class="copy-code-btn">复制代码</span></code></pre>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b3777968b41a4fc9bb5646ad11ab3efd~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>安装 wget 工具</p>
<pre><code class="hljs language-SH copyable" lang="SH">yum install -y wget
<span class="copy-code-btn">复制代码</span></code></pre>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/336e516f04ee4f3fb29e0a6720e37b6a~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<h2 data-id="heading-9">安装软件</h2>
<h3 data-id="heading-10">安装 WinSCP</h3>
<p>到网盘下载 WinSCP 并安装。</p>
<p>连接虚拟机：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d6cc9eacffc54fd6bad161624c572917~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<h3 data-id="heading-11">清理 local 目录</h3>
<pre><code class="hljs language-sh copyable" lang="sh"><span class="hljs-built_in">cd</span> /usr/<span class="hljs-built_in">local</span>
ll
rm -rf  *
ll
<span class="copy-code-btn">复制代码</span></code></pre>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/032731dfc58c4093adeebc76ce615751~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>进入到 local 目录：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e452030615ab41709484a53741579338~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<h3 data-id="heading-12">安装 Java JDK 7</h3>
<h4 data-id="heading-13">把 JDK 7 rpm 包拖到 local 目录</h4>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e7fdd6dbda2c47bab991c011cf033351~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>JDK 7 rpm 包到网盘下载。</p>
<h4 data-id="heading-14">安装 JDK</h4>
<pre><code class="hljs language-SH copyable" lang="SH">rpm -ivh jdk-7u65-linux-i586.rpm
<span class="copy-code-btn">复制代码</span></code></pre>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9d7d800f2293424c94b939c79ea247b4~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<h4 data-id="heading-15">删除 JDK 安装包</h4>
<pre><code class="hljs language-sh copyable" lang="sh">rm -rf jdk-7u65-linux-i586.rpm
<span class="copy-code-btn">复制代码</span></code></pre>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/14e420b2aeed4d8586b6b50011d68768~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<h4 data-id="heading-16">配置环境变量</h4>
<p>修改 ~/.bashrc文件</p>
<pre><code class="hljs language-SH copyable" lang="SH">vi ~/.bashrc
<span class="hljs-built_in">export</span> JAVA_HOME=/usr/java/latest
<span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$JAVA_HOME</span>/bin
<span class="copy-code-btn">复制代码</span></code></pre>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/012be854b9b4467fa37e138b52c664c4~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>使 .bashrc 文件生效：</p>
<pre><code class="hljs language-SH copyable" lang="SH"><span class="hljs-built_in">source</span> ~/.bashrc
<span class="copy-code-btn">复制代码</span></code></pre>
<p>测试下环境变量是否配置成功</p>
<pre><code class="hljs language-SH copyable" lang="SH">java -version
<span class="copy-code-btn">复制代码</span></code></pre>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e48bec25b3d846c1b33f03091fc742d4~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<h3 data-id="heading-17">安装 Perl</h3>
<p>Perl，是一个基础的编程语言的安装，tomcat 和 java web应用会用到。大型电商网站的详情页系统非常复杂，用到的技术栈是 java + nginx + lua，需要perl。</p>
<p>Perl 安装包到网盘下载。</p>
<p>把 Perl 安装包拖到 local 目录</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/64d68daba3994b07b68e021fd4e88432~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>解压缩 perl 安装包</p>
<pre><code class="hljs language-SH copyable" lang="SH">tar -zxvf perl-5.16.1.tar.gz
<span class="copy-code-btn">复制代码</span></code></pre>
<p>删除 perl 安装包</p>
<pre><code class="hljs language-sh copyable" lang="sh">rm -rf perl-5.16.1.tar.gz
<span class="copy-code-btn">复制代码</span></code></pre>
<p>安装 gcc</p>
<p>GCC 是 GNU编译器 套件。不然后续步骤会报错。</p>
<pre><code class="hljs language-SH copyable" lang="SH">yum install -y gcc
<span class="copy-code-btn">复制代码</span></code></pre>
<p>配置 perl</p>
<pre><code class="hljs language-SH copyable" lang="SH"><span class="hljs-built_in">cd</span> perl-5.16.1
./Configure -des -Dprefix=/usr/<span class="hljs-built_in">local</span>/perl
<span class="copy-code-btn">复制代码</span></code></pre>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/897ddbbc2dd34790bad4dc318d6efe05~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>编译 Perl</p>
<pre><code class="hljs language-SH copyable" lang="SH">make && make <span class="hljs-built_in">test</span> && make install
<span class="copy-code-btn">复制代码</span></code></pre>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c76e21df92244ca38c7cc6d291ffb462~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<h2 data-id="heading-18">集群配置</h2>
<p>另外几台机器可以通过复制第一台的方式来搭建或者手动搭建，需要注意的是网络 IP 和 hosts 文件需要改下。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/880c034a0a9147d99b0b9162b157524e~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<h3 data-id="heading-19">修改 hosts</h3>
<p>用 SecureCRT 连接每台机器，修改每一台机器的 hosts 信息：</p>
<pre><code class="copyable">192.168.10.86 eshop-cache01
192.168.10.115 eshop-cache02
192.168.10.57 eshop-cache03
192.168.10.56 eshop-cache04
<span class="copy-code-btn">复制代码</span></code></pre>
<h3 data-id="heading-20">集群免密通信</h3>
<h4 data-id="heading-21">每台机器先设置秘钥</h4>
<p>每台机器都配置 ssh 登录，输入以下命令后不断回车即可。</p>
<pre><code class="hljs language-SH copyable" lang="SH">ssh-keygen -t rsa
<span class="copy-code-btn">复制代码</span></code></pre>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0306734b8b54433b8f8c6f845cff4004~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>将公钥复制为authorized_keys文件，以后使用 ssh 连接本机就不需要输入密码了。</p>
<pre><code class="hljs language-sh copyable" lang="sh"><span class="hljs-built_in">cd</span> /root/.ssh
cp id_rsa.pub authorized_keys
<span class="copy-code-btn">复制代码</span></code></pre>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1d9c8be204494729851ad0f477e7dc9d~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>打开 authorized_keys 文件，查看文件中是否有 eshop-cache01 的公钥信息。</p>
<p>测试下使用 ssh 连接本机</p>
<pre><code class="hljs language-SH copyable" lang="SH">ssh eshop-cache01
<span class="copy-code-btn">复制代码</span></code></pre>
<p>会提示输入 yes/no 的命令，输入 yes，提示 Last login，就表示成功。退出登录使用 exit 命令。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4a68da86e9dc4355bd3d4c39af800261~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>下次再执行 ssh eshop-cache01，提示 Last login，也是表示连接成功。</p>
<p>每台机器重复上面的步骤，保证自己的机器上 authorized_keys  有自己的公钥信息。</p>
<h4 data-id="heading-22">每台机器相互免密</h4>
<p>接着将本机的公钥拷贝到指定机器的 authorized_keys文件中。</p>
<p>在第二台、第三台、第四台虚拟机上执行：</p>
<pre><code class="hljs language-SH copyable" lang="SH">ssh-copy-id -i eshop-cache01
<span class="copy-code-btn">复制代码</span></code></pre>
<p>然后看下第一台机器上是否有其他机器的公钥信息，可以看到第一台机器上有四台机器的公钥信息。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/876bcb18edc74a2382a6a29235a1bd89~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>复制第一台机器的公钥信息到其他机器。</p>
<pre><code class="hljs language-sh copyable" lang="sh">scp authorized_keys eshop-cache02:/root/.ssh
scp authorized_keys eshop-cache03:/root/.ssh
scp authorized_keys eshop-cache04:/root/.ssh
<span class="copy-code-btn">复制代码</span></code></pre>
<p>测试下其他机器是否能相互连其他机器。比如第二台机器连接第三台机器：</p>
<pre><code class="hljs language-SH copyable" lang="SH">ssh eshop-cache03
<span class="copy-code-btn">复制代码</span></code></pre>
<p>连接成功命令行会显示 [root@eshop-cache03 ~] #。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/09ebbf2f41914c4c86787fea49bf5fb0~tplv-k3u1fbpfcp-watermark.image" alt="mark" loading="lazy" referrerpolicy="no-referrer"></p>
<p>四台机器现在都是可以相互访问的了，集群的基础环境配置完成。</p>
<h2 data-id="heading-23">遇到的问题</h2>
<p>四台机器突然不能连外网，试过各种方式，最后将本机的上网方式从无线连接改为有限连接，然后将虚拟机的<code>桥接网卡</code>连接方式选择为有线的网卡后就好了。</p>
<p>参考和感谢：</p>
<p>儒猿-亿级流量</p></div>  
</div>
            