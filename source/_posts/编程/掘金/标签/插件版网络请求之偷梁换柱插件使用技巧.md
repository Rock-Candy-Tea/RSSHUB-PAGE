
---
title: 'æ’ä»¶ç‰ˆç½‘ç»œè¯·æ±‚ä¹‹å·æ¢æ¢æŸ±æ’ä»¶ä½¿ç”¨æŠ€å·§'
categories: 
 - ç¼–ç¨‹
 - æ˜é‡‘
 - æ ‡ç­¾
headimg: 'https://picsum.photos/400/300?random=8287'
author: æ˜é‡‘
comments: false
date: Sat, 24 Jul 2021 21:23:26 GMT
thumbnail: 'https://picsum.photos/400/300?random=8287'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><h1 data-id="heading-0">KJNetworkThiefPlugin</h1>
<p><strong>ä¿®æ”¹ KJNetworkingRequest å’Œ è·å– KJNetworkingResponse æ’ä»¶</strong></p>
<p>æœ¬æ–‡ä¸»è¦ä»‹ç»å¦‚ä½•ä½¿ç”¨ KJNetworkThiefPlugin æ’ä»¶ï¼Œæ¥è¾¾åˆ°ä¿®æ”¹è¯·æ±‚ä½“å’Œè·å–ç»“æœæ•°æ®çš„éšè—ç”¨æ³•ï¼Œå·æ¢æ¢æŸ±å°å·è¡Œä¸ºï¼Ÿæ‰€ä»¥å¹²è„†å°±ç»™å®ƒå‘½åä¸ºå°å·æ’ä»¶ï¼Œå“ˆå“ˆå“ˆï¼è¯·å¿½ç•¥æˆ‘çš„æç¬‘</p>
<h3 data-id="heading-1">æ’ä»¶ç½‘ç»œä½¿ç”¨ç¤ºä¾‹</h3>
<ul>
<li><strong>å®ä¾‹åŒ–è¯·æ±‚ä½“</strong></li>
</ul>
<p>è®¾ç½®è¯·æ±‚ipï¼Œè·¯å¾„ï¼Œå‚æ•°ï¼Œè¯·æ±‚æ–¹å¼ï¼Œæ’ä»¶ç­‰ç­‰ç­‰</p>
<pre><code class="copyable">KJNetworkingRequest * request = [[KJNetworkingRequest alloc] init];
request.method = KJNetworkRequestMethodGET;
request.ip = @"https://www.douban.com";
request.path = @"/j/app/radio/channels";

<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<ul>
<li><strong>å®ä¾‹åŒ–æ­¤æ¬¡ç½‘ç»œéœ€è¦çš„æ’ä»¶</strong></li>
</ul>
<p>è®¾ç½®éœ€æ±‚æ’ä»¶plugins</p>
<pre><code class="copyable">KJNetworkThiefPlugin * plugin = [[KJNetworkThiefPlugin alloc] init];
request.plugins = @[plugin];
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<ul>
<li><strong>å¼€å¯æ’ä»¶ç‰ˆç½‘ç»œè°ƒç”¨</strong></li>
</ul>
<p>å°±æ˜¯è¿™ä¹ˆç®€å•ç®€æ´çš„ä½¿ç”¨ï¼Œ</p>
<pre><code class="copyable">[KJNetworkPluginManager HTTPPluginRequest:request success:^(KJNetworkingRequest * _Nonnull request, id  _Nonnull responseObject) &#123;
    NSLog(@"----%@",responseObject);
&#125; failure:^(KJNetworkingRequest * _Nonnull request, NSError * _Nonnull error) &#123;
    NSLog(@"----%@",error);
&#125;];
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<blockquote>
<p>åˆ°æ­¤ï¼Œå°å·æ’ä»¶ä½¿ç”¨å°±ç®—åˆæ­¥å®Œæˆï¼Œæ˜¯ä¸æ˜¯ç‰¹åˆ«è½»æ¾ç®€å•</p>
</blockquote>
<hr>
<blockquote>
<p>ä¸‹é¢ç»§ç»­æ¥ç€å¥ä¹æ¥ç€èˆï¼Œ</p>
</blockquote>
<h3 data-id="heading-2">ä¿®æ”¹è¯·æ±‚ä½“</h3>
<pre><code class="copyable">KJNetworkThiefPlugin * plugin = [[KJNetworkThiefPlugin alloc] init];
plugin.kChangeRequest = ^(KJNetworkingRequest * _Nonnull request) &#123;
    
    // è¿™é‡Œå³å¯ä¿®æ”¹è¯·æ±‚ä½“ï¼Œè¿™é‡Œéœ€è¦æé†’ä¸€ä¸‹
    // æ­¤å¤„ä¿®æ”¹ä¼šå½±å“åç»­ç½‘ç»œè¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯è¯´ä¼šæ”¹å˜ä½ ä¸Šé¢è®¾ç½®çš„ `request`
    
&#125;;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<blockquote>
<p>å…¶å®ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸ä¼šå»æ›´æ”¹è¿™ä¸ªè¯·æ±‚ä½“ï¼Œæ¯•ç«Ÿé¡ºç€ä¸€æ¡çº¿ä¸‹æ¥æˆ‘ä»¬å°±å·²ç»è®¾ç½®æ˜¯è‡ªå·±éœ€è¦çš„è¯·æ±‚ä½“ï¼Œå½“ç„¶è¿™ä¸ªä¹Ÿå¯ä»¥æ‹¿æ¥åšç‚¹éªšæ“ä½œï¼Œåé¢çš„æ…¢æ…¢è®²ï¼Œå’±å…ˆä¸€æ­¥ä¸€æ­¥çš„æ¥</p>
</blockquote>
<h3 data-id="heading-3">è·å–æ’ä»¶æ•°æ®</h3>
<pre><code class="copyable">plugin.kGetResponse = ^(KJNetworkingResponse * _Nonnull response) &#123;
    
    // è¿™é‡Œå¯ä»¥æ‹¿åˆ°ç½‘ç»œè¯·æ±‚è¿”å›çš„åŸå§‹æ•°æ®
    NSLog(@"ğŸ·ğŸ·ğŸ·åŸæ±åŸå‘³çš„æ•°æ® = %@", response.responseObject);

    // å‡†å¤‡æ’ä»¶å¤„ç†ä¹‹åçš„æ•°æ®
    if (response.opportunity == KJNetworkingRequestOpportunityPrepare) &#123;
        NSLog(@"ğŸ·ğŸ·ğŸ·å‡†å¤‡æ’ä»¶å¤„ç†ä¹‹åçš„æ•°æ® = %@", response.prepareResponse);
    &#125;
    
    // æˆåŠŸæ’ä»¶å¤„ç†ä¹‹åçš„æ•°æ®
    if (response.opportunity == KJNetworkingRequestOpportunitySuccess) &#123;
        NSLog(@"ğŸ·ğŸ·ğŸ·æˆåŠŸæ’ä»¶å¤„ç†ä¹‹åçš„æ•°æ® = %@", response.successResponse);
    &#125;
    
    // å¤±è´¥æ’ä»¶å¤„ç†ä¹‹åçš„æ•°æ®
    if (response.opportunity == KJNetworkingRequestOpportunityFailure) &#123;
        NSLog(@"ğŸ·ğŸ·ğŸ·å¤±è´¥æ’ä»¶å¤„ç†ä¹‹åçš„æ•°æ® = %@", response.failureResponse);
        NSLog(@"ğŸ·ğŸ·ğŸ·å¤±è´¥ = %@", response.error);
    &#125;
    
&#125;;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<blockquote>
<p>å¤‡æ³¨è¯´æ˜ï¼šå¦‚æœä½ ä½¿ç”¨çš„æ’ä»¶æ²¡æœ‰å¤„ç†è¿‡æˆåŠŸæ•°æ®æˆ–è€…å¤±è´¥æ•°æ®ï¼Œç”šè‡³ä»»ä½•ä¸€ä¸ªæ’ä»¶æ•°æ®ï¼Œåªè¦æœªç»æ’ä»¶å¤„ç†è¿‡ï¼Œé‚£ä¹ˆå¯¹åº”çš„è¯¥æ’ä»¶æ•°æ®å³ä¸ºç©ºï¼Œä¸å¿…å¤§æƒŠå°æ€ª</p>
</blockquote>
<h3 data-id="heading-4">å¤±è´¥ä¹‹åæ›´æ”¹è¯·æ±‚ä½“</h3>
<p>ä¸çŸ¥é“å¤§å®¶åœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰æ²¡æœ‰é‡è§è¿™æ ·çš„æƒ…å†µï¼š</p>
<ul>
<li><strong>åœºæ™¯ä¸€</strong>ï¼šé€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬çš„é»˜è®¤åŸŸåéƒ½æ˜¯åŒä¸€ä¸ªï¼Œä½†æ˜¯æœ‰çš„æ—¶å€™ä¹Ÿä¼šå‡ºç°è¿™æ ·çš„åœºæ™¯ï¼Œå¸¸è§„æ“ä½œä¹‹ä¸‹ä½¿ç”¨é»˜è®¤åŸŸåï¼Œå¦‚æœå¤±è´¥åˆ™æ¢å¦å¤–çš„å¤‡ç”¨åŸŸå</li>
<li><strong>åœºæ™¯äºŒ</strong>ï¼šç½‘ç»œè¯·æ±‚ç¬¬ä¸€æ¬¡å¤±è´¥ä¹‹åï¼Œæ›´æ¢å¦å¤–ä¸€å¥—ç½‘ç»œæ¥å£</li>
</ul>
<pre><code class="copyable">KJNetworkThiefPlugin * plugin = [[KJNetworkThiefPlugin alloc] init];
// è¯¥å­—æ®µå¿…é¡»å¼€å¯ï¼Œæ‰ä¼šå†æ¬¡è°ƒç”¨ç½‘ç»œè¯·æ±‚
plugin.againRequest = YES;
plugin.kChangeRequest = ^(KJNetworkingRequest * _Nonnull request) &#123;
    
    // åœºæ™¯ä¸€ï¼Œå¤±è´¥ä¹‹åæ›´æ¢ip
    if (request.opportunity == KJNetworkingRequestOpportunityFailure) &#123;
        request.ip = @"https://www.baidu.com";
    &#125;
    
    // åœºæ™¯äºŒï¼Œå¤±è´¥ä¹‹åæ›´æ¢å¦å¤–ä¸€å¥—ç½‘ç»œæ¥å£
    if (request.opportunity == KJNetworkingRequestOpportunityFailure) &#123;
        request.path = @"/other/path";
        request.params = @&#123;
            @"token": @"XHFI-213-XDJHso-A0345",
            @"userid": @"likeyou",
        &#125;;
    &#125;
&#125;;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<blockquote>
<p>æˆ‘è§‰å¾—è¿˜æœ‰æ›´å¤šéªšæ“ä½œï¼Œå¯ä»¥ç©ä¸€ä¸‹ï¼Œå¾…å‘ç°ing..</p>
</blockquote>
<h3 data-id="heading-5">å¤šæ’ä»¶æ—¶åˆ»è·å–æ’ä»¶æ•°æ®</h3>
<p>æ’ä»¶ç‰ˆç½‘ç»œå°±æ˜¯æœ‰è¿™æ ·ä¸€ä¸ªå¼Šç«¯ï¼Œæœ€ç»ˆæˆåŠŸæˆ–è€…å¤±è´¥å›è°ƒå‡ºæ¥çš„æ•°æ®éƒ½æ˜¯æœ€åä¸€ä¸ªæ’ä»¶å¤„ç†ä¹‹åçš„æ•°æ®ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘æƒ³æ‹¿åˆ°ä¸­é—´æŸä¸ªæ’ä»¶å¤„ç†ä¹‹åçš„æ•°æ®ï¼Œå¸¸è§„çš„æ–¹æ³•å°±ä¸è¡Œï¼Œäºæ˜¯å°±æœ‰äº†ä¸‹é¢è¿™ç§éªšæ“ä½œæ¥æ»¡è¶³è¿™äº›æ— ç†å–é—¹çš„éœ€æ±‚</p>
<pre><code class="copyable">KJNetworkCachePlugin * cache = [[KJNetworkCachePlugin alloc] init];
...
ç¼“å­˜æ’ä»¶ç›¸å…³æ“ä½œ

KJNetworkThiefPlugin * afterCache = [[KJNetworkThiefPlugin alloc] init];
afterCache.kGetResponse = ^(KJNetworkingResponse * _Nonnull response) &#123;
    // è·å–ç¼“å­˜æ’ä»¶å¤„ç†åçš„æ•°æ®
&#125;;
    
KJNetworkAnslysisPlugin * anslysis = [[KJNetworkAnslysisPlugin alloc] init];
... 
è§£ææ’ä»¶ç›¸å…³æ“ä½œ

KJNetworkThiefPlugin * afterAnslysis = [[KJNetworkThiefPlugin alloc] init];
afterAnslysis.kGetResponse = ^(KJNetworkingResponse * _Nonnull response) &#123;
    // è·å–è§£ææ’ä»¶å¤„ç†åçš„æ•°æ®
&#125;;

// è¿™é‡Œè®¾ç½®å¥½å¯¹åº”æ’ä»¶é¡ºåºå³å¯    
request.plugins = @[cache, afterCache, anslysis, afterAnslysis];

<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<blockquote>
<p>æˆ‘ä¾ç„¶è§‰å¾—è¿˜æœ‰æ›´å¤šç”¨æ³•å¾…å‘ç°ï¼Œå»å§ï¼çš®å¡ä¸˜</p>
</blockquote>
<h3 data-id="heading-6">å®Œæ•´æµ‹è¯•ç”¨ä¾‹</h3>
<p>æä¾›å®Œæ•´çš„æµ‹è¯•ç”¨ä¾‹ï¼Œè‡ªå·±å»ç©å§</p>
<pre><code class="copyable">- (void)testThiefPlugin&#123;
    
    XCTestExpectation * expectation = [self expectationWithDescription:@"test thief plugin."];
    
    KJNetworkingRequest * request = [[KJNetworkingRequest alloc] init];
    request.method = KJNetworkRequestMethodGET;
    request.ip = @"https://www.douban.com";
    request.path = @"/j/app/radio/channels";
    request.responseSerializer = KJResponseSerializerJSON;
    
    KJNetworkThiefPlugin * plugin = [[KJNetworkThiefPlugin alloc] init];
    plugin.kGetResponse = ^(KJNetworkingResponse * _Nonnull response) &#123;
        // è¿™é‡Œå¯ä»¥æ‹¿åˆ°ç½‘ç»œè¯·æ±‚è¿”å›çš„åŸå§‹æ•°æ®
        NSLog(@"ğŸ·ğŸ·ğŸ·åŸæ±åŸå‘³çš„æ•°æ® = %@", response.responseObject);
    &#125;;
    request.plugins = @[plugin];
    
    [KJNetworkPluginManager HTTPPluginRequest:request success:^(KJNetworkingRequest * _Nonnull request, id  _Nonnull responseObject) &#123;
        NSLog(@"----%@",responseObject);
        [expectation fulfill];
    &#125; failure:^(KJNetworkingRequest * _Nonnull request, NSError * _Nonnull error) &#123;
        XCTFail(@"%@", error.localizedDescription);
    &#125;];

    [self waitForExpectationsWithTimeout:30 handler:nil];
&#125;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<h3 data-id="heading-7">ç»“å°¾ä»‹ç»</h3>
<p>å…³äºè¿™ä¸ªæ’ä»¶ç‰ˆç½‘ç»œåº“ï¼Œå³å°†å¼€æºä½¿ç”¨ï¼Œéœ€è¦çš„æœ‹å‹è‡ªè¡Œ</p>
<pre><code class="copyable">pod 'KJNetworkPlugin' # æ’ä»¶ç‰ˆç½‘ç»œ
pod 'KJNetworkPlugin/Thief' # å·æ¢æ¢æŸ±æ’ä»¶
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>å†™ä¸œè¥¿ç€å®ç´¯ï¼Œè€é“ä»¬è§‰å¾—æœ‰ç”¨è¿˜æœ›ç‚¹ä¸ªæ˜Ÿæ”¯æŒä¸€ä¸‹ï¼Œä¼ é€é—¨<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2FyangKJ%2FKJNetworkPlugin" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/yangKJ/KJNetworkPlugin" ref="nofollow noopener noreferrer">KJNetworkPlugin</a></p>
<p>åé¢æœ‰ç›¸å…³æ’ä»¶æˆ‘ä¹Ÿä¼šæ…¢æ…¢è¡¥å……...</p></div>  
</div>
            