
---
title: 'ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ13ï¼‰-ğŸ”¥ğŸ”¥ğŸ”¥ä¸€é•œåˆ°åº•ï¼MVPé‡æ„ç¤ºä¾‹ç¯‡'
categories: 
 - ç¼–ç¨‹
 - æ˜é‡‘
 - æ ‡ç­¾
headimg: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9a3b64237ff544bf9b01d0d222bba3e3~tplv-k3u1fbpfcp-zoom-1.image'
author: æ˜é‡‘
comments: false
date: Sun, 20 Jun 2021 06:06:19 GMT
thumbnail: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9a3b64237ff544bf9b01d0d222bba3e3~tplv-k3u1fbpfcp-zoom-1.image'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><h1 data-id="heading-0">å‰è¨€</h1>
<p>ä¸Šä¸€ç¯‡<a href="https://juejin.cn/post/6974634615537401886" target="_blank">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ12ï¼‰- ç¼–è¯‘è°ƒè¯•ç¯‡</a>
ä»‹ç»ï¼Œç»è¿‡äº†è§£è€¦ã€åˆ†åº“åŠç¼–è¯‘è°ƒè¯•çš„ä¼˜åŒ–ï¼Œä¸€æ®µæ—¶é—´å†…ï¼ŒCloudDiskçš„å¼€å‘æ•ˆç‡å¾—åˆ°äº†å¾ˆå¤§çš„æå‡ã€‚</p>
<p>ä½†éšç€ä¸šåŠ¡çš„æ¼”è¿›ï¼Œç”±äºå†å²çš„åŸå› ï¼Œä»£ç ä¸­å­˜åœ¨å¾ˆå¤šActivityåŠControllerçš„ä¸Šå¸ç±»ã€‚ä»Šå¤©æˆ‘ä»¬å°†æ‹¿File Bundleä½œä¸ºä¾‹å­ï¼Œä¸ºå¤§å®¶æ€»ç»“é‡æ„çš„æµç¨‹ï¼Œæ¼”ç¤ºå¦‚ä½•ä¸€æ­¥ä¸€æ­¥å°†ä¸Šå¸ç±»é‡æ„ä¸ºMVPæ¶æ„ã€‚</p>
<p><strong>è§†é¢‘æ¼”ç¤ºåœ°å€:</strong> <a href="https://mp.weixin.qq.com/s/zjeln_eqAN45CDbSrWjLaA" target="_blank" rel="nofollow noopener noreferrer">mp.weixin.qq.com/s/zjeln_eqAâ€¦</a></p>
<h1 data-id="heading-1">é‡æ„æµç¨‹</h1>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
A(1.æ¢³ç†ä¸šåŠ¡é€»è¾‘)-->B(2.åˆ†æåŸæœ‰çš„ä»£ç è®¾è®¡)
B-->C(3.è¡¥å……å®ˆæŠ¤æµ‹è¯•)
C-->D(4.ç®€å•è®¾è®¡)
D-->E(5.å°æ­¥å®‰å…¨é‡æ„)
E-->F(6.é›†æˆéªŒæ”¶æµ‹è¯•)
</code></pre>
<h2 data-id="heading-2">1. æ¢³ç†ä¸šåŠ¡é€»è¾‘</h2>
<p>é€šè¿‡å¾€å¾€è¿™ä¸€æ­¥æ˜¯æœ€éš¾çš„ã€‚ç”±äºäººå‘˜æ›´è¿­ã€äº§å“çš„è¿­ä»£ï¼Œç»™è¿™ä¸€æ­¥å¸¦æ¥å¾ˆå¤§çš„æŒ‘æˆ˜ã€‚æˆ‘ä»¬å¯ä»¥å°è¯•ä»ä¸€ä¸‹å‡ æ–¹é¢æ¥è¡¥å…¨ä¿¡æ¯ã€‚</p>
<ol>
<li>æ‰¾äººï¼šäº§å“ç»ç†ã€è®¾è®¡äººå‘˜ã€æµ‹è¯•äººå‘˜è¿›è¡Œç¡®è®¤å’Œç­”ç–‘</li>
<li>æ‰¾æ–‡æ¡£ï¼šæŸ¥çœ‹åŸæœ‰çš„éœ€æ±‚æ–‡æ¡£ã€è®¾è®¡æ–‡æ¡£ã€æµ‹è¯•ç”¨ä¾‹ã€è®¾è®¡ç¨¿</li>
<li>çœ‹ä»£ç ï¼šä»åŸæœ‰çš„ä»£ç è®¾è®¡ä¸­å»æ¢³ç†ä¸šåŠ¡</li>
</ol>
<p>ç»è¿‡æ¢³ç†ç¡®è®¤ï¼ŒFile Bundleçš„ç°æœ‰çš„ä¸šåŠ¡å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
A(è¿›å…¥æ–‡ä»¶é¡µé¢)-->B(ä»ç½‘ç»œåŠ è½½æ–‡ä»¶åˆ—è¡¨æ•°æ®)
B --> C&#123;æ•°æ®æ˜¯å¦åŠ è½½æˆåŠŸ&#125;
C -->|åŠ è½½æˆåŠŸ| D(æ˜¾ç¤ºæ–‡ä»¶åˆ—è¡¨-æ–‡ä»¶åå’Œæ–‡ä»¶å¤§å°)
C -->|ç½‘ç»œå¼‚å¸¸| E(æ˜¾ç¤ºNetworkErrorException)
C -->|æ•°æ®ä¸ºç©º| F(æ˜¾ç¤ºempty data)
E -->|ç‚¹å‡»è§¦å‘åˆ·æ–°|B
F -->|ç‚¹å‡»è§¦å‘åˆ·æ–°|B
</code></pre>
<blockquote>
<p>æ–‡ä»¶å¤§å°è½¬æ¢ä¸ºä»¥Bã€Kã€Mã€Gå•ä½æ˜¾ç¤º</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9a3b64237ff544bf9b01d0d222bba3e3~tplv-k3u1fbpfcp-zoom-1.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<h2 data-id="heading-3">2.åˆ†æåŸæœ‰çš„ä»£ç è®¾è®¡</h2>
<p>æˆ‘ä»¬ä»¥ä¸»è¦ä¸Šå¸ç±»FileFragmentä¸ºä¾‹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="copyable">@AndroidEntryPoint
public class FileFragment extends Fragment &#123;

    @Inject
    FileController fileController;

    private RecyclerView fileListRecycleView;
    private TextView tvMessage;

    public static FileFragment newInstance() &#123;
        FileFragment fragment = new FileFragment();
        Bundle args = new Bundle();
        fragment.setArguments(args);
        return fragment;
    &#125;

    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) &#123;

        View view = inflater.inflate(R.layout.fragment_file, container, false);
        fileListRecycleView = view.findViewById(R.id.file_list);
        tvMessage = view.findViewById(R.id.tv_message);
        tvMessage.setOnClickListener(v -> getFileList());
        return view;
    &#125;

    @Override
    public void onCreate(Bundle savedInstanceState) &#123;
        super.onCreate(savedInstanceState);
        getFileList();
    &#125;

    private void getFileList() &#123;
        new Thread(() -> &#123;
            Message message = new Message();
            try &#123;
                List<FileInfo> infoList = fileController.getFileList();
                message.what = 1;
                message.obj = infoList;
            &#125; catch (NetworkErrorException e) &#123;
                message.what = 0;
                message.obj = "NetworkErrorException";
                e.printStackTrace();
            &#125;
            mHandler.sendMessage(message);
        &#125;).start();
    &#125;

    Handler mHandler = new Handler(new Handler.Callback() &#123;
        @Override
        public boolean handleMessage(@NonNull Message msg) &#123;
            if (msg.what == 1) &#123;
                showTip(false);
                //æ˜¾ç¤ºç½‘ç»œæ•°æ®
                List<FileInfo> infoList = (List<FileInfo>) msg.obj;
                FileListAdapter fileListAdapter = new FileListAdapter(infoList, getActivity());
                fileListRecycleView.addItemDecoration(new DividerItemDecoration(
                        getActivity(), DividerItemDecoration.VERTICAL));
                //è®¾ç½®å¸ƒå±€æ˜¾ç¤ºæ ¼å¼
                fileListRecycleView.setLayoutManager(new LinearLayoutManager(getActivity()));
                fileListRecycleView.setAdapter(fileListAdapter);
            &#125; else if (msg.what == 0) &#123;
                showTip(true);
                //æ˜¾ç¤ºå¼‚å¸¸æé†’æ•°æ®
                tvMessage.setText(msg.obj.toString());
            &#125; else &#123;
                showTip(true);
                //æ˜¾ç¤ºç©ºæ•°æ®
                tvMessage.setText("empty data");
            &#125;
            return false;
        &#125;
    &#125;);

    public void showTip(boolean show) &#123;
        if (show) &#123;
            tvMessage.setVisibility(View.VISIBLE);
            fileListRecycleView.setVisibility(View.GONE);
        &#125; else &#123;
            tvMessage.setVisibility(View.GONE);
            fileListRecycleView.setVisibility(View.VISIBLE);
        &#125;
    &#125;
&#125;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>ä»ä»£ç ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸»è¦çš„ä¸€äº›è®¾è®¡é—®é¢˜ï¼Œå¦‚ä¸‹ï¼š</p>
<ol>
<li>ä¸»è¦çš„è·å–æ–‡ä»¶ã€å¼‚å¸¸é€»è¾‘åˆ¤æ–­ã€ç•Œé¢åˆ·æ–°æ§åˆ¶éƒ½æ˜¯åœ¨ä¸€ä¸ªç±»é‡Œé¢ï¼Œä¸åˆ©äºåç»­çš„æ‰©å¼ åŠä¿®æ”¹ç»´æŠ¤ã€‚æˆ‘ä»¬å¸Œæœ›ç±»çš„èŒè´£æ›´åŠ å•ä¸€ï¼Œé€»è¾‘å’Œè§†å›¾èƒ½å¤Ÿè¿›è¡Œåˆ†ç¦»ã€‚</li>
<li>å­˜åœ¨ç²—æš´çš„new Threadè¿›è¡Œç®¡ç†</li>
<li>Handler å­˜åœ¨å†…å­˜æ³„éœ²é£é™©</li>
<li>å­˜åœ¨è§„èŒƒé—®é¢˜ï¼Œä¾‹å¦‚empty dataå­—ç¬¦ä¸²æ²¡æœ‰ä½¿ç”¨xmlè¿›è¡Œç®¡ç†ã€ä»£ç ä¸­ç”±æ— æ•ˆçš„å¯¼åŒ…ç­‰</li>
<li>ä»£ç ä¸­æ²¡æœ‰ä»»ä½•å®ˆæŠ¤æµ‹è¯•</li>
</ol>
<p>å®Œæ•´çš„æ‰€æœ‰ä»£ç è§<a href="https://github.com/junbin1011/CloudDisk/commit/3c4c4d98bcef46357f4c653431dc53e6d691e397" target="_blank" rel="nofollow noopener noreferrer">Github</a></p>
<h2 data-id="heading-4">3. è¡¥å……å®ˆæŠ¤æµ‹è¯•</h2>
<p>å‚è€ƒé‡æ„ç¯‡ä¸­ï¼Œæˆ‘ä»¬åˆ¶å®šçš„ç­–ç•¥ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆåšå¤§å‹çš„æµ‹è¯•ï¼Œåšä¸ºå®ˆæŠ¤æµ‹è¯•ã€‚</p>
<pre><code class="copyable">@RunWith(AndroidJUnit4.class)
@LargeTest
@HiltAndroidTest
@Config(application = HiltTestApplication.class)
public class FileFragmentTest &#123;

    @Rule
    public HiltAndroidRule hiltRule = new HiltAndroidRule(this);

    @Test
    public void show_show_file_list_when_get_success() &#123;
        //given
        ActivityScenario<DebugActivity> scenario = ActivityScenario.launch(DebugActivity.class);
        scenario.onActivity(activity -> &#123;
            //then
            onView(withText("é—ç•™ä»£ç é‡æ„.pdf")).check(matches(isDisplayed()));
            onView(withText("100.00K")).check(matches(isDisplayed()));
            onView(withText("ç³»ç»Ÿç»„ä»¶åŒ–.pdf")).check(matches(isDisplayed()));
            onView(withText("9.67K")).check(matches(isDisplayed()));
        &#125;);
    &#125;
&#125;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p><strong>æˆ‘ä»¬å‘ç°è¿™ä¸ªç”¨ä¸ä¼šé€šè¿‡ï¼Œæˆ‘ä»¬ä¸»è¦é¢ä¸´ä¸€ä¸‹2ä¸ªé—®é¢˜ã€‚</strong></p>
<ol>
<li>ç½‘ç»œè¯·æ±‚æ˜¯å¼‚æ­¥çš„ï¼Œå¼‚æ­¥é€»è¾‘å¯èƒ½åœ¨æµ‹è¯•æ‰§è¡Œå®Œè¿˜æ²¡æœ‰è§¦å‘åˆ°</li>
<li>ç½‘ç»œæ•°æ®æ˜¯åŠ¨æ€çš„ï¼Œæˆ‘ä»¬æ–­è¨€çš„æ•°æ®æ²¡åŠæ³•ç¡®å®š</li>
</ol>
<p>æ‰€ä»¥æˆ‘ä»¬é‡‡ç”¨çš„åšæ³•å°±æ˜¯Mockï¼Œæˆ‘ä¸ç¨³å®šçš„ä¾èµ–Mockæ‰ã€‚æˆ‘ä»¬åŒæ ·ä½¿ç”¨Shadowæ¥è¿›è¡Œå¤šè·å–ç½‘ç»œæ•°æ®æ–¹æ³•è¿›è¡ŒMockï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="copyable">@Implements(FileFragment.class)
public class ShadowFileFragment &#123;

    @RealObject
    public FileFragment fileFragment;

    enum State &#123;
        SUCCESS,
        ERROR,
        EMPTY
    &#125;

    public static State state = State.SUCCESS;

    @Implementation
    protected void getFileList() &#123;
        System.out.println("shadow .... .....");
        Message message = new Message();
        if (state == State.SUCCESS) &#123;
            ArrayList<FileInfo> infoList = new ArrayList<>();
            infoList.add(new FileInfo("é—ç•™ä»£ç é‡æ„.pdf", 102400));
            infoList.add(new FileInfo("ç³»ç»Ÿç»„ä»¶åŒ–.pdf", 9900));
            message.what = 1;
            message.obj = infoList;
        &#125; else if (state == State.ERROR) &#123;
            message.what = 0;
            message.obj = "NetworkErrorException";
        &#125; else if (state == State.EMPTY) &#123;
            message.what = 1;
            message.obj = null;
        &#125;
        fileFragment.mHandler.sendMessage(message);
    &#125;
&#125;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>è°ƒæ•´åçš„æµ‹è¯•ç”¨ä¾‹å¦‚ä¸‹ï¼š</p>
<pre><code class="copyable"> @Test
    public void show_show_file_list_when_get_success() &#123;
        //given
        ShadowFileFragment.state = ShadowFileFragment.State.SUCCESS;
        //when
        ActivityScenario<DebugActivity> scenario = ActivityScenario.launch(DebugActivity.class);
        scenario.onActivity(activity -> &#123;
            //then
            onView(withText("é—ç•™ä»£ç é‡æ„.pdf")).check(matches(isDisplayed()));
            onView(withText("100.00K")).check(matches(isDisplayed()));
            onView(withText("ç³»ç»Ÿç»„ä»¶åŒ–.pdf")).check(matches(isDisplayed()));
            onView(withText("9.67K")).check(matches(isDisplayed()));
        &#125;);
    &#125;

    @Test
    public void show_show_error_tip_when_net_work_exception() &#123;
        //given
        ShadowFileFragment.state = ShadowFileFragment.State.ERROR;
        //when
        ActivityScenario<DebugActivity> scenario = ActivityScenario.launch(DebugActivity.class);
        scenario.onActivity(activity -> &#123;
            //then
            onView(withText("NetworkErrorException")).check(matches(isDisplayed()));
        &#125;);
    &#125;

    @Test
    public void show_show_empty_tip_when_not_has_data() &#123;
        //given
        ShadowFileFragment.state = ShadowFileFragment.State.EMPTY;
        //when
        ActivityScenario<DebugActivity> scenario = ActivityScenario.launch(DebugActivity.class);
        scenario.onActivity(activity -> &#123;
            //then
            onView(withText("empty data")).check(matches(isDisplayed()));
        &#125;);
    &#125;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>ä¸­é—´æˆ‘ä»¬ç”¨å…è®¸æµ‹è¯•è„šæ­¥æ—¶å‘ç°ï¼Œä¹‹å‰çš„æ—§ä»£ç è¿˜æœ‰ä¸€å¤„é€»è¾‘çš„é”™è¯¯ã€‚æ•°æ®ä¸ºç©ºçš„åˆ¤æ–­åº”è¯¥åŠ åœ¨ç½‘ç»œæ•°æ®å›è°ƒä¸­ã€‚</p>
<pre><code class="copyable">Caused by: java.lang.NullPointerException
at com.cloud.disk.bundle.file.FileFragment$1.handleMessage(FileFragment.java:96)
at android.os.Handler.dispatchMessage(Handler.java:102)
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>æˆ‘ä»¬åŒæ­¥å°†å¼‚å¸¸é€»è¾‘è¿›è¡Œä¿®æ”¹ï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/035a8a19ed9347289437f5416caa5297~tplv-k3u1fbpfcp-zoom-1.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>æœ€åæˆ‘ä»¬å®Œæˆäº†åŸºæœ¬çš„å®ˆæŠ¤æµ‹è¯•ï¼Œè¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ada7610b565544a8ab7cf854945e146c~tplv-k3u1fbpfcp-zoom-1.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>å®Œæ•´çš„æ‰€æœ‰ä»£ç è§<a href="https://github.com/junbin1011/CloudDisk/commit/3c4c4d98bcef46357f4c653431dc53e6d691e397" target="_blank" rel="nofollow noopener noreferrer">Github</a></p>
<h2 data-id="heading-5">4. ç®€å•è®¾è®¡</h2>
<h3 data-id="heading-6">MVPæ¶æ„</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
B(Presenter)-->A(Model)
B-->|interface|C(View)
C-->|interface|B
</code></pre>
<ol>
<li>ä¸šåŠ¡é€»è¾‘å’Œè§†å›¾åˆ†ç¦»</li>
<li>Presenterå’ŒViewä¹‹é—´é€šè¿‡æ¥å£äº¤äº’</li>
<li>ä¸ºäº†æ›´é«˜æ•ˆç®¡ç†çº¿ç¨‹ï¼Œå›¢é˜Ÿå†³å®šä½¿ç”¨Rxjavaè¿›è¡Œçº¿ç¨‹ç»Ÿä¸€ç®¡ç†ã€‚æ¶æ„é£æ ¼å‚è€ƒ<a href="https://github.com/android/architecture-samples" target="_blank" rel="nofollow noopener noreferrer">architecture-samples</a></li>
</ol>
<h3 data-id="heading-7">æ¥å£è®¾è®¡</h3>
<ol>
<li>Contractæ¥å£è®¾è®¡</li>
</ol>
<pre><code class="copyable">public interface FileListContract &#123;

    interface View  &#123;
        showFileList(List<FileInfo> fileList);
        showNetWorkException(String errorMessage);
        showEmptyData();
    &#125;

    interface Presenter &#123;

        void getFileList();
    &#125;
&#125;

<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<ol start="2">
<li>æ•°æ®æ¥å£è®¾è®¡</li>
</ol>
<pre><code class="copyable">public interface FileDataSource &#123;
     Flowable<List<FileInfo>> getFileList();
&#125;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<h2 data-id="heading-8">5.å°æ­¥å®‰å…¨é‡æ„</h2>
<ul>
<li>æŠ½å–FileFragmentçš„ä¸šåŠ¡é€»è¾‘åˆ°FilePresenter</li>
<li>FileFragment æå–UIæ¥å£</li>
<li>æŠ½å–FileDataSource</li>
</ul>
<blockquote>
<p>é‡æ„æ‰‹æ³•åŒ…å«æå–æ¥å£ã€ç§»åŠ¨æ–¹æ³•ã€ç§»åŠ¨ç±»ã€æŠ½å–æ–¹æ³•ã€å†…è”ã€æå–å˜é‡ç­‰ç­‰ã€‚<strong>è¿‡ç¨‹è¿˜éœ€è¦æ ¹æ®é‡æ„é€‚å½“è°ƒæ•´æµ‹è¯•ç”¨ä¾‹ã€‚</strong></p>
</blockquote>
<p>è¯¦ç»†çš„æ¼”ç¤ºè§<a href="https://mp.weixin.qq.com/s/zjeln_eqAN45CDbSrWjLaA" target="_blank" rel="nofollow noopener noreferrer">è§†é¢‘</a></p>
<ul>
<li>è¡¥å……æµ‹è¯•ç”¨ä¾‹</li>
</ul>
<ol>
<li>è¡¥å……FileUtilsè®¡ç®—æ–‡ä»¶å¤§å°æµ‹è¯•</li>
</ol>
<pre><code class="copyable">@RunWith(JUnit4.class)
@SmallTest
public class FileUtilsTest &#123;

    @Test
    public void should_return_B_unit_when_file_size_in_its_range() &#123;
        //given
        long fileSize = 100;
        //when
        String format = FileUtils.formatFileSize(fileSize);
        //then
        assertEquals("100.00B", format);
    &#125;

    @Test
    public void should_return_K_unit_when_file_size_in_its_range() &#123;
        //given
        long fileSize = 1034;
        //when
        String format = FileUtils.formatFileSize(fileSize);
        //then
        assertEquals("1.01K", format);
    &#125;

    @Test
    public void should_return_M_unit_when_file_size_in_its_range() &#123;
        //given
        long fileSize = 1084000;
        //when
        String format = FileUtils.formatFileSize(fileSize);
        //then
        assertEquals("1.03M", format);
    &#125;

    @Test
    public void should_return_G_unit_when_file_size_in_its_range() &#123;
        //given
        long fileSize = 1114000000;
        //when
        String format = FileUtils.formatFileSize(fileSize);
        //then
        assertEquals("1.04G", format);
    &#125;
&#125;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<ol start="2">
<li>è¡¥å……Presenterä¸šåŠ¡é€»è¾‘æµ‹è¯•</li>
</ol>
<pre><code class="copyable">@RunWith(JUnit4.class)
@MediumTest
public class FilePresenterImplTest &#123;

    @Rule
    public RxSchedulerRule rule = new RxSchedulerRule();

    @Test
    public void should_return_file_list_when_call_data_source_success() throws NetworkErrorException &#123;
        //given
        FileListContract.View mockView = mock(FileListContract.View.class);
        FileDataSource mockFileDataSource = mock(FileDataSource.class);
        List<FileInfo> fileList = new ArrayList<>();
        fileList.add(new FileInfo("é—ç•™ä»£ç é‡æ„.pdf", 102400));
        fileList.add(new FileInfo("ç³»ç»Ÿç»„ä»¶åŒ–.pdf", 9900));
        when(mockFileDataSource.getFileList()).thenReturn(Flowable.fromArray(fileList));
        FileListContract.FilePresenter filePresenter = new FilePresenterImpl(mockFileDataSource, mockView);
        //when
        filePresenter.getFileList();
        //then
        verify(mockView).showFileList(anyList());
    &#125;

    @Test
    public void should_show_empty_data_when_call_data_source_return_empty() throws NetworkErrorException &#123;
        //given
        FileListContract.View mockView = mock(FileListContract.View.class);
        FileDataSource mockFileDataSource = mock(FileDataSource.class);
        when(mockFileDataSource.getFileList()).thenReturn(Flowable.fromArray(new ArrayList<>()));
        FileListContract.FilePresenter filePresenter = new FilePresenterImpl(mockFileDataSource, mockView);
        //when
        filePresenter.getFileList();
        //then
        verify(mockView).showEmptyData();
    &#125;

    @Test
    public void should_show_network_exception_when_call_data_source_return_net_error() throws NetworkErrorException &#123;
        //given
        FileListContract.View mockView = mock(FileListContract.View.class);
        FileDataSource mockFileDataSource = mock(FileDataSource.class);
        when(mockFileDataSource.getFileList()).thenThrow(new NetworkErrorException());
        FileListContract.FilePresenter filePresenter = new FilePresenterImpl(mockFileDataSource, mockView);
        //when
        filePresenter.getFileList();
        //then
        verify(mockView).showNetWorkException("NetworkErrorException");
    &#125;
&#125;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥çœ‹CoverageæŸ¥çœ‹é€»è¾‘çš„è¦†ç›–æƒ…å†µï¼Œåˆ¤æ–­æ˜¯å¦æœ‰é‡è¦çš„é€»è¾‘é—æ¼ã€‚</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6b5ff0f4675841c899473f5f0c4ee025~tplv-k3u1fbpfcp-zoom-1.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a1b81a61c179407b96eb0b41989bdfb1~tplv-k3u1fbpfcp-zoom-1.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>æœ€åæˆ‘ä»¬è¿è¡Œfile bundleæ‰€æœ‰çš„æµ‹è¯•ï¼ŒæŠ¥å‘Šå¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e195ae6e3b0f426eaa2c6d2d8a3d1e3d~tplv-k3u1fbpfcp-zoom-1.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<h2 data-id="heading-9">6.é›†æˆéªŒæ”¶æµ‹è¯•</h2>
<ol>
<li>file bundleæ¨¡å—å‘å¸ƒ1.0.1ç‰ˆæœ¬</li>
</ol>
<pre><code class="copyable">implementation 'com.cloud.disk.bundle:file:1.0.1'
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<ol start="2">
<li>æ‰§è¡Œå®ˆæŠ¤æµ‹è¯•</li>
</ol>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/939949c16c824747bdb0bade6e6d9068~tplv-k3u1fbpfcp-zoom-1.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<ol start="3">
<li>è¿è¡Œæ£€æŸ¥</li>
</ol>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d0846861f29149ad990a2c1d951be2a6~tplv-k3u1fbpfcp-zoom-1.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<h1 data-id="heading-10">æ€»ç»“</h1>
<p>æœ¬ç¯‡ä»‹ç»äº†æ–‡ä»¶æ¨¡å—å›¢é˜Ÿå°†æ–‡ä»¶ä¸»é¡µé‡æ„ä¸ºMVPæ¶æ„ï¼Œå¹¶ä¸”è¡¥å……äº†è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚ç»è¿‡é‡æ„åï¼Œå›¢é˜Ÿçš„å¼€å‘æ•ˆç‡å’Œç‰ˆæœ¬è´¨é‡æœ‰äº†æ˜æ˜¾çš„æå‡ã€‚æœ‰äº†æ–‡ä»¶æ¨¡å—çš„æ‰“æ ·ï¼Œç»™å…¶ä»–å›¢é˜Ÿå¸¦æ¥äº†å¾ˆå¤§çš„ä¿¡å¿ƒã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ç»§ç»­åˆ†äº«åŠ¨æ€æ¨¡å—çš„é‡æ„ä¹‹æ—…ã€‚ä¸æ–‡ä»¶æ¨¡å—ä¸ä¸€æ ·çš„æ˜¯åŠ¨æ€æ¨¡å—å†³å®šé‡‡ç”¨Kotlin+MVVMæ¶æ„ã€‚</p>
<p>ä¸‹ä¸€ç¯‡ï¼Œå•ä½“ç§»åŠ¨åº”ç”¨â€œæ¨¡å—åŒ–â€æ¼”è¿›ä¹‹æ—…ï¼ˆ14ï¼‰- Kotlin+MVVMé‡æ„ç¤ºä¾‹ç¯‡</p>
<h1 data-id="heading-11">CloudDiskç¤ºä¾‹ä»£ç </h1>
<p><a href="https://github.com/junbin1011/CloudDisk" target="_blank" rel="nofollow noopener noreferrer">CloudDisk</a></p>
<h1 data-id="heading-12">ç³»åˆ—é“¾æ¥</h1>
<p><a href="https://juejin.cn/post/6943470229905211422" target="_blank">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ1ï¼‰- å¼€ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6945313969556946980" target="_blank">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ2ï¼‰-æ¶æ„ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6947855094272491556" target="_blank">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ3ï¼‰-ç¤ºä¾‹ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6950077521790500894" target="_blank">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ4ï¼‰-åˆ†æç¯‡</a></p>
<p><a href="https://juejin.cn/post/6952298178095874055" target="_blank">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ5ï¼‰- é‡æ„æ–¹æ³•ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6954635678982340622" target="_blank">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ6ï¼‰- æµ‹è¯•ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6959504791642832909" target="_blank">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ7ï¼‰- è§£è€¦é‡æ„æ¼”ç¤ºç¯‡(ä¸€)+è§†é¢‘æ¼”ç¤º</a></p>
<p><a href="https://juejin.cn/post/6963214120178941983" target="_blank">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ8ï¼‰- ä¾èµ–æ³¨å…¥ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6966166367821103117" target="_blank">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ9ï¼‰- è·¯ç”±ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6970870458660945934" target="_blank">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ10ï¼‰- è§£è€¦é‡æ„æ¼”ç¤ºç¯‡ï¼ˆäºŒï¼‰</a></p>
<p><a href="https://juejin.cn/post/6973836199655899149" target="_blank">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ11ï¼‰- åˆ¶å“ç®¡ç†ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6974634615537401886" target="_blank">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ12ï¼‰- ç¼–è¯‘è°ƒè¯•ç¯‡</a></p>
<h1 data-id="heading-13">å¤§çº²</h1>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d8adefb4375440a8b496b95540cc30ee~tplv-k3u1fbpfcp-zoom-1.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<h1 data-id="heading-14">å…³äº</h1>
<ul>
<li>ä½œè€…ï¼šé»„ä¿Šå½¬</li>
<li><a href="https://junbin.tech/" target="_blank" rel="nofollow noopener noreferrer">åšå®¢ï¼šjunbin.tech</a></li>
<li><a href="https://github.com/junbin1011" target="_blank" rel="nofollow noopener noreferrer">GitHub: junbin1011 </a></li>
<li><a href="https://www.zhihu.com/people/junbin-9-77" target="_blank" rel="nofollow noopener noreferrer">çŸ¥ä¹: @JunBin</a></li>
</ul></div>  
</div>
            