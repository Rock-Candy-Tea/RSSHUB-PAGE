
---
title: 'æŠŠä¹¦è¯»è–„ _ ã€Šè®¾è®¡æ¨¡å¼ä¹‹ç¾ã€‹è®¾è®¡æ¨¡å¼ä¸èŒƒå¼ï¼ˆè¡Œä¸ºå‹-çŠ¶æ€æ¨¡å¼ï¼‰'
categories: 
 - ç¼–ç¨‹
 - æ˜é‡‘
 - æ ‡ç­¾
headimg: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8752d998594e4120b951097fc5b73a3e~tplv-k3u1fbpfcp-watermark.image'
author: æ˜é‡‘
comments: false
date: Sun, 08 Aug 2021 22:50:28 GMT
thumbnail: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8752d998594e4120b951097fc5b73a3e~tplv-k3u1fbpfcp-watermark.image'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%&#125;.markdown-body p&#123;color:#595959;font-size:15px;line-height:2;font-weight:400&#125;.markdown-body p+p&#123;margin-top:16px&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;padding:30px 0;margin:0;color:#135ce0&#125;.markdown-body h1&#123;position:relative;text-align:center;font-size:22px;margin:50px 0&#125;.markdown-body h1:before&#123;position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)&#125;.markdown-body h2&#123;position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0&#125;.markdown-body h3&#123;font-size:16px&#125;.markdown-body ul&#123;list-style:disc outside;margin-left:2em;margin-top:1em&#125;.markdown-body li&#123;line-height:2;color:#595959&#125;.markdown-body img.loaded&#123;margin:0 auto;display:block&#125;.markdown-body blockquote&#123;background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5&#125;.markdown-body blockquote p&#123;color:#666;line-height:2&#125;.markdown-body a&#123;color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none&#125;.markdown-body em strong,.markdown-body strong&#123;color:#036aca&#125;.markdown-body hr&#123;border-top:1px solid #135ce0&#125;.markdown-body pre&#123;overflow:auto&#125;.markdown-body code,.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body table&#123;border-collapse:collapse;margin:1rem 0;overflow-x:auto&#125;.markdown-body table td,.markdown-body table th&#123;border:1px solid #dfe2e5;padding:.6em 1em&#125;.markdown-body table tr&#123;border-top:1px solid #dfe2e5&#125;.markdown-body table tr:nth-child(2n)&#123;background-color:#f6f8fa&#125;</style><p>è¿™æ˜¯æˆ‘å‚ä¸8æœˆæ›´æ–‡æŒ‘æˆ˜çš„ç¬¬4å¤©ï¼Œæ´»åŠ¨è¯¦æƒ…æŸ¥çœ‹ï¼šÂ <a href="https://juejin.cn/post/6987962113788493831" title="https://juejin.cn/post/6987962113788493831" target="_blank">8æœˆæ›´æ–‡æŒ‘æˆ˜</a></p>
<h2 data-id="heading-0">0x0ã€å¼•è¨€</h2>
<p>ğŸ˜€ å‘¨ä¸€æ¬ç –ï¼Œå…ƒæ°”æ»¡æ»¡ï¼Œç»§ç»­å•ƒè®¾è®¡æ¨¡å¼ä¹‹ç¾ï¼Œæœ¬æ–‡å¯¹åº”è®¾è®¡æ¨¡å¼ä¸èŒƒå¼ï¼šè¡Œä¸ºå‹(64)ï¼Œ<strong>çŠ¶æ€æ¨¡å¼</strong> (State  Pattern)ï¼Œæè¿°äº†å¯¹è±¡ <strong>çŠ¶æ€å˜åŒ–</strong> åŠå¦‚ä½•åœ¨æ¯ç§çŠ¶æ€ä¸‹è¡¨ç°å‡ºä¸åŒçš„ <strong>è¡Œä¸º</strong>~</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8752d998594e4120b951097fc5b73a3e~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<blockquote>
<p>Tipsï¼šäºŒæ‰‹çŸ¥è¯†åŠ å·¥éš¾å…æœ‰æ‰€çº°æ¼ï¼Œæ„Ÿå…´è¶£æœ‰æ—¶é—´çš„å¯è‡ªè¡ŒæŸ¥é˜…åŸæ–‡ï¼Œè°¢è°¢ã€‚</p>
</blockquote>
<hr>
<h2 data-id="heading-1">0x1ã€å®šä¹‰</h2>
<p><strong>åŸå§‹å®šä¹‰</strong></p>
<blockquote>
<p>å…è®¸ä¸€ä¸ªå¯¹è±¡åœ¨å…¶å†…éƒ¨çŠ¶æ€æ”¹å˜æ—¶æ”¹å˜å®ƒçš„è¡Œä¸ºï¼Œå¯¹è±¡çœ‹èµ·æ¥ä¼¼ä¹ä¿®æ”¹äº†è‡ªå·±çš„ç±»ä¸€æ ·ã€‚</p>
</blockquote>
<p><strong>ç®€å•ç‚¹è¯´</strong></p>
<blockquote>
<p>è®©ä¸€ä¸ªå¯¹è±¡é€šè¿‡ä¸€ç³»åˆ—çŠ¶æ€çš„å˜åŒ–æ¥æ§åˆ¶è¡Œä¸ºçš„å˜åŒ–ã€‚</p>
</blockquote>
<p><strong><code>çŠ¶æ€æ¨¡å¼</code></strong> å’Œ <strong><code>ç­–ç•¥æ¨¡å¼</code></strong> æå…¶ç›¸ä¼¼ï¼Œå¯é€šè¿‡å†…åœ¨å·®åˆ«è¿›è¡ŒåŒºåˆ†ï¼š</p>
<ul>
<li>ç­–ç•¥æ¨¡å¼å°†å…·ä½“ç­–ç•¥ç±»æš´éœ²å‡ºå»ï¼Œè°ƒç”¨è€…éœ€äº†è§£æ¯ç§ç­–ç•¥çš„ä¸åŒä¹‹å¤„ä»¥ä¾¿æ­£ç¡®ä½¿ç”¨ï¼Œ<strong>å°è£…çš„æ˜¯ä¸åŒç®—æ³•</strong>ï¼Œç®—æ³•é—´æ²¡æœ‰äº¤äº’ï¼Œä»¥è¾¾åˆ°ç®—æ³•å¯ä»¥è‡ªç”±åˆ‡æ¢çš„ç›®çš„ã€‚</li>
<li>çŠ¶æ€æ¨¡å¼çŠ¶æ€çš„æ”¹å˜æ˜¯ç”±å…¶å†…éƒ¨æ¡ä»¶æ¥æ”¹å˜çš„ï¼Œä¸å¤–ç•Œæ— å…³ï¼Œ<strong>å°è£…çš„æ˜¯ä¸åŒçŠ¶æ€</strong>ï¼Œä»¥è¾¾åˆ°çŠ¶æ€åˆ‡æ¢è¡Œä¸ºéšä¹‹åˆ‡æ¢çš„ç›®çš„ã€‚</li>
</ul>
<h2 data-id="heading-2">0x2ã€å†™ä¸ªç®€å•ä¾‹å­</h2>
<p>æœ‰homeé”®çš„Androidæœºä¸ºä¾‹ï¼ŒæŒ‰ä¸‹homeé”®ï¼Œå¤„äºä¸åŒçŠ¶æ€æœ‰ä¸åŒçš„è¡Œä¸ºï¼š</p>
<ul>
<li>å…³æœºçŠ¶æ€ â†’ æ²¡æœ‰ååº”ï¼›</li>
<li>å¼€æœºåé¦–æ¬¡å¯åŠ¨ â†’ å¯†ç è§£é”ï¼›</li>
<li>éé¦–æ¬¡å¯åŠ¨ â†’ å¯†ç è§£é”æˆ–æŒ‡çº¹è§£é”ï¼›</li>
<li>å¯åŠ¨å â†’ è¿”å›ä¸»ç•Œé¢</li>
</ul>
<p>ä¸ä½¿ç”¨çŠ¶æ€æ¨¡å¼å®ç°ä¸€æ³¢ï¼š</p>
<pre><code class="hljs language-java copyable" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StateTest</span> </span>&#123;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> state = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> CLOSE = <span class="hljs-number">0</span>; <span class="hljs-comment">// å…³æœºçŠ¶æ€</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> FIRST_BOOT = <span class="hljs-number">1</span>;   <span class="hljs-comment">// é¦–æ¬¡å¯åŠ¨</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> NOT_FIRST_BOOT = <span class="hljs-number">2</span>;    <span class="hljs-comment">// éé¦–æ¬¡å¯åŠ¨</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> AFTER_BOOT = <span class="hljs-number">3</span>;    <span class="hljs-comment">// å¯åŠ¨å</span>

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">clickHome</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">if</span>(state == CLOSE) &#123;
            System.out.println(<span class="hljs-string">"å¤„äºå…³æœºçŠ¶æ€ï¼Œæ²¡æœ‰ååº”"</span>);
        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(state == FIRST_BOOT) &#123;
            System.out.println(<span class="hljs-string">"é¦–æ¬¡å¯åŠ¨ã€‚å¯ä»¥è¿›è¡Œå¯†ç è§£é”"</span>);
        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(state == NOT_FIRST_BOOT) &#123;
            System.out.println(<span class="hljs-string">"éé¦–æ¬¡å¯åŠ¨ï¼Œå¯ä»¥è¿›è¡Œå¯†ç æˆ–æŒ‡çº¹è§£é”"</span>);
        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(state == AFTER_BOOT) &#123;
            System.out.println(<span class="hljs-string">"å¯åŠ¨çŠ¶æ€ï¼Œè¿”å›ä¸»ç•Œé¢"</span>);
        &#125;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
        state = CLOSE;
        clickHome();
        state = FIRST_BOOT;
        clickHome();
        state = NOT_FIRST_BOOT;
        clickHome();
        state = AFTER_BOOT;
        clickHome();
    &#125;
&#125;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p><strong>ä»£ç è¿è¡Œç»“æœå¦‚ä¸‹</strong>ï¼š</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2541ead28cb64c90981b462be3fa0760~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>å¦‚æœéœ€è¦å¢åŠ ä¸€ç§çŠ¶æ€ï¼Œå¦‚å¤„äºfastbootæ¨¡å¼ï¼ŒçŠ¶æ€å®šä¹‰è¦å†™ä¸€ä¸ªï¼Œç„¶åif-elseåŠ ä¸€ä¸ªåˆ¤æ–­ï¼›è¿˜æœ‰ï¼Œä¸æ­¢å¤„ç†Homeé”®ï¼Œè¿˜æœ‰éŸ³é‡é”®ã€ç”µæºé”®ï¼Œåˆå¾—å®šä¹‰å‡ ä¸ªå‡½æ•°ï¼Œç„¶åå¤åˆ¶ä¸€æ³¢è¿™ä¸ªif-elseï¼Œè¯•è¯•ç”¨çŠ¶æ€æ¨¡å¼å®ç°ä¸€æ³¢ã€‚</p>
<pre><code class="hljs language-java copyable" lang="java"><span class="hljs-comment">// æŠ½è±¡çŠ¶æ€</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">State</span> </span>&#123;
    <span class="hljs-keyword">protected</span> StateContext context;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setContext</span><span class="hljs-params">(StateContext context)</span> </span>&#123; <span class="hljs-keyword">this</span>.context = context; &#125;

    <span class="hljs-function"><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onHomeClick</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onPowerClick</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onVolumeAscClick</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function"><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onVolumeDescClick</span><span class="hljs-params">()</span></span>;
&#125;


<span class="hljs-comment">// å…·ä½“çŠ¶æ€ â†’ å…³æœºçŠ¶æ€</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CloseState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span> </span>&#123;
    <span class="hljs-meta">@Override</span> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onHomeClick</span><span class="hljs-params">()</span> </span>&#123; System.out.println(<span class="hljs-string">"å¤„äºå…³æœºçŠ¶æ€ï¼ŒæŒ‰Homeé”®æ²¡æœ‰ååº”"</span>); &#125;

    <span class="hljs-meta">@Override</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">onPowerClick</span><span class="hljs-params">()</span> </span>&#123;
        System.out.println(<span class="hljs-string">"æ‰‹æœºå¼€æœº"</span>);
        context.setState(FirstBootState.class);
        context.setScreenOn(<span class="hljs-keyword">true</span>);
        context.getState().onHomeClick();
    &#125;

    <span class="hljs-meta">@Override</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">onVolumeAscClick</span><span class="hljs-params">()</span> </span>&#123; System.out.println(<span class="hljs-string">"å¤„äºå…³æœºçŠ¶æ€ï¼ŒæŒ‰éŸ³é‡+æ²¡ååº”"</span>); &#125;

    <span class="hljs-meta">@Override</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">onVolumeDescClick</span><span class="hljs-params">()</span> </span>&#123;  System.out.println(<span class="hljs-string">"å¤„äºå…³æœºçŠ¶æ€ï¼ŒæŒ‰éŸ³é‡-æ²¡ååº”"</span>); &#125;
&#125;

<span class="hljs-comment">// å…·ä½“çŠ¶æ€ â†’ ç¬¬ä¸€æ¬¡å¯åŠ¨çŠ¶æ€</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FirstBootState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span> </span>&#123;
    <span class="hljs-meta">@Override</span> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onHomeClick</span><span class="hljs-params">()</span> </span>&#123;
        System.out.println(<span class="hljs-string">"é¦–æ¬¡å¯åŠ¨ï¼Œå¯ä»¥è¿›è¡Œå¯†ç è§£é”"</span>);
        System.out.println(<span class="hljs-string">"è§£é”å®Œæ¯•ï¼Œè¿›å…¥ä¸»ç•Œé¢"</span>);
        context.setState(AfterBootState.class);
        context.setScreenOn(<span class="hljs-keyword">true</span>);
    &#125;

    <span class="hljs-meta">@Override</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">onPowerClick</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">if</span>(context.isScreenOn()) &#123;
            System.out.println(<span class="hljs-string">"ç†„å±"</span>);
        &#125; <span class="hljs-keyword">else</span> &#123;
            System.out.println(<span class="hljs-string">"äº®å±ï¼Œç­‰å¾…å¯†ç è§£é”"</span>);
        &#125;
        context.setScreenOn(!context.isScreenOn());
    &#125;

    <span class="hljs-meta">@Override</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">onVolumeAscClick</span><span class="hljs-params">()</span> </span>&#123; System.out.println(<span class="hljs-string">"éŸ³é‡+"</span>); &#125;

    <span class="hljs-meta">@Override</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">onVolumeDescClick</span><span class="hljs-params">()</span> </span>&#123;  System.out.println(<span class="hljs-string">"éŸ³é‡-"</span>); &#125;
&#125;

<span class="hljs-comment">// å…·ä½“çŠ¶æ€ â†’ éç¬¬ä¸€æ¬¡å¯åŠ¨çŠ¶æ€</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NotFirstBootState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span> </span>&#123;
    <span class="hljs-meta">@Override</span> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onHomeClick</span><span class="hljs-params">()</span> </span>&#123;
        System.out.println(<span class="hljs-string">"éé¦–æ¬¡å¯åŠ¨ï¼Œå¯ä»¥é€šè¿‡å¯†ç æˆ–æŒ‡çº¹è§£é”"</span>);
        System.out.println(<span class="hljs-string">"è§£é”å®Œæ¯•ï¼Œè¿›å…¥ä¸»ç•Œé¢"</span>);
        context.setScreenOn(<span class="hljs-keyword">true</span>);
        context.setState(AfterBootState.class);
    &#125;

    <span class="hljs-meta">@Override</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">onPowerClick</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">if</span>(context.isScreenOn()) &#123;
            System.out.println(<span class="hljs-string">"ç†„å±"</span>);
        &#125; <span class="hljs-keyword">else</span> &#123;
            System.out.println(<span class="hljs-string">"äº®å±ï¼Œç­‰å¾…å¯†ç æˆ–æŒ‡çº¹è§£é”"</span>);
            context.setState(NotFirstBootState.class);
        &#125;
        context.setScreenOn(!context.isScreenOn());
    &#125;

    <span class="hljs-meta">@Override</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">onVolumeAscClick</span><span class="hljs-params">()</span> </span>&#123; System.out.println(<span class="hljs-string">"éŸ³é‡+"</span>); &#125;

    <span class="hljs-meta">@Override</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">onVolumeDescClick</span><span class="hljs-params">()</span> </span>&#123;  System.out.println(<span class="hljs-string">"éŸ³é‡-"</span>); &#125;
&#125;

<span class="hljs-comment">// å…·ä½“çŠ¶æ€ â†’ å¯åŠ¨å</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AfterBootState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span> </span>&#123;
    <span class="hljs-meta">@Override</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">onHomeClick</span><span class="hljs-params">()</span> </span>&#123; System.out.println(<span class="hljs-string">"è¿”å›ä¸»ç•Œé¢"</span>); &#125;

    <span class="hljs-meta">@Override</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">onPowerClick</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">if</span>(context.isScreenOn()) &#123;
            System.out.println(<span class="hljs-string">"ç†„å±"</span>);
            context.setState(NotFirstBootState.class);
        &#125; <span class="hljs-keyword">else</span> &#123;
            System.out.println(<span class="hljs-string">"äº®å±ï¼Œç­‰å¾…å¯†ç æˆ–æŒ‡çº¹è§£é”"</span>);
            context.getState().onHomeClick();
        &#125;
        context.setScreenOn(!context.isScreenOn());
    &#125;

    <span class="hljs-meta">@Override</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">onVolumeAscClick</span><span class="hljs-params">()</span> </span>&#123; System.out.println(<span class="hljs-string">"éŸ³é‡+"</span>); &#125;

    <span class="hljs-meta">@Override</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">onVolumeDescClick</span><span class="hljs-params">()</span> </span>&#123;  System.out.println(<span class="hljs-string">"éŸ³é‡-"</span>); &#125;
&#125;

<span class="hljs-comment">// ä¸Šä¸‹æ–‡ä¿¡æ¯ç±»</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StateContext</span> </span>&#123;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> isScreenOn = <span class="hljs-keyword">false</span>;   <span class="hljs-comment">// å±å¹•æ˜¯å¦äº®ç€</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> Map<Class, State> stateMap = <span class="hljs-keyword">new</span> HashMap<>();
    <span class="hljs-keyword">private</span> State state;    <span class="hljs-comment">// æ‰‹æœºå½“å‰çŠ¶æ€</span>

    <span class="hljs-keyword">static</span> &#123;
        stateMap.put(CloseState.class, <span class="hljs-keyword">new</span> CloseState());
        stateMap.put(FirstBootState.class, <span class="hljs-keyword">new</span> FirstBootState());
        stateMap.put(NotFirstBootState.class, <span class="hljs-keyword">new</span> NotFirstBootState());
        stateMap.put(AfterBootState.class, <span class="hljs-keyword">new</span> AfterBootState());
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setState</span><span class="hljs-params">(Class stateClass)</span> </span>&#123;
        <span class="hljs-keyword">this</span>.state = stateMap.get(stateClass);
        <span class="hljs-keyword">this</span>.state.setContext(<span class="hljs-keyword">this</span>);
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> State <span class="hljs-title">getState</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-keyword">return</span> state; &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isScreenOn</span><span class="hljs-params">()</span> </span>&#123; <span class="hljs-keyword">return</span> isScreenOn; &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setScreenOn</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> screenOn)</span> </span>&#123;
        isScreenOn = screenOn;
        System.out.println(<span class="hljs-string">"===> å±å¹•å¤„äºï¼š"</span> + (isScreenOn ? <span class="hljs-string">"äº®å±çŠ¶æ€"</span>: <span class="hljs-string">"ç†„å±çŠ¶æ€"</span>));
    &#125;
&#125;

<span class="hljs-comment">// æµ‹è¯•ç”¨ä¾‹</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StateTest</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
        StateContext context = <span class="hljs-keyword">new</span> StateContext();
        context.setState(CloseState.class);
        <span class="hljs-comment">// å¤„äºå…³æœºçŠ¶æ€ç‚¹å‡»éŸ³é‡- å’Œ homeé”®</span>
        context.getState().onVolumeDescClick();
        context.getState().onHomeClick();
        <span class="hljs-comment">// å¤„äºå…³æœºçŠ¶æ€ç‚¹å‡»ç”µæºé”®</span>
        context.getState().onPowerClick();
        context.getState().onPowerClick();
        context.getState().onHomeClick();
        context.getState().onVolumeAscClick();
    &#125;
&#125;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p><strong>ä»£ç è¿è¡Œç»“æœå¦‚ä¸‹</strong>ï¼š</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/89df8b45fb5c4b6bac7cd4af362e5bc3~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>é€šè¿‡çŠ¶æ€æ¨¡å¼ï¼Œæˆ‘ä»¬æŠŠäº‹ä»¶è§¦å‘çš„ <strong>çŠ¶æ€è½¬ç§»å’ŒåŠ¨ä½œæ‰§è¡Œï¼Œæ‹†åˆ†åˆ°ä¸åŒçš„çŠ¶æ€ç±»ä¸­ï¼Œé¿å…äº†åˆ†æ”¯åˆ¤æ–­ç»“æ„</strong>ã€‚</p>
<p>é¡ºå¸¦å¸¦å‡ºUMLç±»å›¾ã€ç»„æˆè§’è‰²ã€ä½¿ç”¨åœºæ™¯åŠä¼˜ç¼ºç‚¹~</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9e33c73d2167419d96638272309fa1d8~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<ul>
<li><strong>Context</strong> (ä¸Šä¸‹æ–‡ä¿¡æ¯ç±») â†’ å­˜å‚¨å½“å‰çŠ¶æ€ç±»ï¼Œå¹¶è´Ÿè´£å…·ä½“çŠ¶æ€çš„åˆ‡æ¢ï¼›</li>
<li><strong>State</strong> (æŠ½è±¡çŠ¶æ€ç±») â†’ å®šä¹‰å£°æ˜çŠ¶æ€æ›´æ–°çš„æ“ä½œæ–¹æ³•ï¼Œå¯ä»¥æ˜¯æ¥å£æˆ–æŠ½è±¡ç±»ï¼›</li>
<li><strong>ConcreteState</strong> (å…·ä½“çŠ¶æ€ç±») â†’ å®ç°æŠ½è±¡çŠ¶æ€ç±»ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œæ ¹æ®å…·ä½“åœºæ™¯æŒ‡å®šå¯¹åº”çŠ¶æ€æ”¹å˜åçš„ä»£ç é€»è¾‘ï¼›</li>
</ul>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li>æŸä¸ªæ“ä½œå«æœ‰åºå¤§çš„åˆ†æ”¯åˆ¤æ–­ç»“æ„ï¼Œä¸”åˆ†æ”¯å†³å®šäºå¯¹è±¡çš„çŠ¶æ€æ—¶ï¼›</li>
<li>å¯¹è±¡è¡Œä¸ºå–å†³äºçŠ¶æ€ï¼Œä¸”å¿…é¡»åœ¨è¿è¡Œæ—¶æ ¹æ®çŠ¶æ€æ”¹å˜å…¶è¡Œä¸ºæ—¶ï¼›</li>
</ul>
<p><strong>ä¼˜ç‚¹</strong>ï¼š</p>
<ul>
<li>ç¬¦åˆå•ä¸€èŒè´£åŸåˆ™ï¼šå°†ä¸ç‰¹å®šçŠ¶æ€ç›¸å…³çš„ä»£ç ç»„ç»‡åˆ°å•ç‹¬çš„ç±»ä¸­ï¼›</li>
<li>æ›´å¥½çš„æ‰©å±•æ€§ï¼šæ‰©å±•æ–°çš„çŠ¶æ€åªéœ€å¢åŠ å®ç°ç±»ï¼Œåœ¨éœ€è¦ç»´æŠ¤çš„åœ°æ–¹è®¾ç½®ä¸‹æ–°çŠ¶æ€å³å¯ï¼›</li>
<li>æå‰å®šå¥½å¯èƒ½çš„çŠ¶æ€ï¼Œé™ä½ä»£ç å®ç°å¤æ‚åº¦ï¼Œé¿å…å†™å¤§é‡çš„if-elseæ¡ä»¶è¯­å¥ï¼›</li>
</ul>
<p><strong>ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li>ç±»å¢åŠ ï¼Œæ¯ä¸ªçŠ¶æ€å¯¹åº”ä¸€ä¸ªå…·ä½“çŠ¶æ€ç±»ï¼›</li>
<li>ä¸æ»¡è¶³å¼€é—­åŸåˆ™ï¼ŒçŠ¶æ€æ¨¡å¼è™½ç„¶é™ä½äº†çŠ¶æ€ä¹‹é—´çš„è€¦åˆï¼Œä½†æ˜¯æ–°å¢æˆ–ä¿®æ”¹çŠ¶æ€éƒ½ä¼šæ¶‰åŠå‰/åä¸€ä¸ªçŠ¶æ€çš„ä¿®æ”¹ï¼›</li>
<li>é€»è¾‘é›¶æ•£ï¼Œæ— æ³•åœ¨ä¸€ä¸ªåœ°æ–¹å°±çœ‹å‡ºæ•´ä¸ªçŠ¶æ€æœºçš„è½¬æ¢é€»è¾‘ï¼›</li>
</ul>
<hr>
<h2 data-id="heading-3">0x3ã€è¡¥å……ï¼šæœ‰é™çŠ¶æ€æœºçš„æ¦‚å¿µ</h2>
<p>è‹±æ–‡ç¿»è¯‘ Finite State Machineï¼Œç¼©å†™FSMï¼Œç®€ç§°çŠ¶æ€æœºï¼Œå®ƒæœ‰ä¸‰ä¸ªç»„æˆéƒ¨åˆ†ï¼š<strong><code>çŠ¶æ€(State)</code></strong>ã€<strong><code>äº‹ä»¶(Event)</code></strong>ã€<strong><code>åŠ¨ä½œ(Action)</code></strong>ã€‚å…¶ä¸­çš„äº‹ä»¶åˆç§°ä¸º <strong><code>è½¬ç§»æ¡ä»¶</code></strong>ï¼Œäº‹ä»¶è§¦å‘çŠ¶æ€çš„è½¬ç§»å’ŒåŠ¨ä½œçš„æ‰§è¡Œ(éå¿…é¡»)ã€‚</p>
<p>ä¹Ÿå¯ä»¥ç†è§£ä¸ºä¸€ç§æ•°å­¦æ¨¡å‹ï¼Œè¯¥æ¨¡å‹ä¸­æœ‰å‡ ä¸ªçŠ¶æ€(æœ‰é™çš„)ï¼Œåœ¨ä¸åŒåœºæ™¯ä¸‹ï¼Œä¸åŒçš„çŠ¶æ€é—´å‘ç”Ÿè½¬ç§»ï¼Œåœ¨çŠ¶æ€è½¬ç§»è¿‡ç¨‹ä¸­å¯èƒ½ä¼´éšç€ä¸åŒçš„äº‹ä»¶å‘ç”Ÿã€‚</p>
<p>çŠ¶æ€æœºæœ‰ä¸‰ç§å¸¸è§çš„å®ç°æ–¹å¼ï¼š</p>
<ul>
<li><strong>åˆ†æ”¯é€»è¾‘æ³•</strong> â†’ ç¼ºç‚¹æ˜¯æ”¹å˜ä¸šåŠ¡é€»è¾‘ï¼Œæ”¹èµ·æ¥å®¹æ˜“å‡ºé”™ï¼Œä»£ç ä¹Ÿä¸æ˜“çœ‹æ‡‚ã€‚é€‚åˆç®€å•çŠ¶æ€æœºï¼›</li>
<li><strong>æŸ¥è¡¨æ³•</strong> â†’ é€‚ç”¨äºçŠ¶æ€å¾ˆå¤šã€çŠ¶æ€è½¬ç§»æ¯”è¾ƒå¤æ‚çš„çŠ¶æ€æœºï¼Œç”¨äºŒç»´æ•°ç»„è¡¨ç¤ºçŠ¶æ€è½¬ç§»å›¾ï¼Œå¯æå¤§æé«˜ä»£ç çš„å¯è¯»æ€§ä¸å¯ç»´æŠ¤æ€§ï¼›</li>
<li><strong>çŠ¶æ€æ¨¡å¼</strong> â†’ é€‚ç”¨äºçŠ¶æ€å¹¶ä¸å¤šã€çŠ¶æ€è½¬ç§»è¾ƒç®€å•ï¼Œäº‹ä»¶è§¦å‘åŠ¨ä½œåŒ…å«çš„ä¸šåŠ¡é€»è¾‘å¯èƒ½è¾ƒå¤æ‚çš„çŠ¶æ€æœºã€‚</li>
</ul>
<hr>
<h2 data-id="heading-4">0x4ã€åŠ é¤ï¼šAndroidæºç ä¸­æ˜¯å¦‚ä½•ä½¿ç”¨16è¿›åˆ¶è¿›è¡ŒçŠ¶æ€ç®¡ç†çš„ï¼Ÿ</h2>
<p>åœ¨Androidç³»ç»Ÿæºç ä¸­æ¶‰åŠåˆ° <strong>å¤šçŠ¶æ€</strong> ç®¡ç†æ€»æ˜¯é€šè¿‡åå…­è¿›åˆ¶æ•°å­—æ¥è¡¨ç¤ºï¼Œå¦‚ViewGroupä¸­ï¼š</p>
<pre><code class="hljs language-java copyable" lang="java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> FLAG_CLIP_CHILDREN = <span class="hljs-number">0x1</span>;
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> FLAG_CLIP_TO_PADDING = <span class="hljs-number">0x2</span>;
<span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> FLAG_INVALIDATE_REQUIRED  = <span class="hljs-number">0x4</span>;
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> FLAG_RUN_ANIMATION = <span class="hljs-number">0x8</span>;
<span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> FLAG_ANIMATION_DONE = <span class="hljs-number">0x10</span>;
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> FLAG_PADDING_NOT_NULL = <span class="hljs-number">0x20</span>;
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> FLAG_ANIMATION_CACHE = <span class="hljs-number">0x40</span>;
<span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> FLAG_OPTIMIZE_INVALIDATE = <span class="hljs-number">0x80</span>;
<span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> FLAG_CLEAR_TRANSFORMATION = <span class="hljs-number">0x100</span>;
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> FLAG_NOTIFY_ANIMATION_LISTENER = <span class="hljs-number">0x200</span>;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå…ˆå¤ä¹ ä¸‹å‡ ç§äºŒè¿›åˆ¶è¿ç®—ï¼š</p>
<ul>
<li><strong><code>æŒ‰ä½ä¸(&)</code></strong> â†’ <strong>å¯¹åº”ä½éƒ½ä¸º1æ‰ä¸º1ï¼Œå¦åˆ™ä¸º0</strong>ï¼Œå¦‚0x1 & 0x2 â†’ 0001 & 0010 â†’ 0000ï¼›</li>
<li><strong><code>æŒ‰ä½æˆ–(|)</code></strong> â†’ <strong>å¯¹åº”ä½æœ‰ä¸€ä¸ªä¸º1å³ä¸º1</strong>ï¼Œå¦‚0x1 | 0x2 â†’ 0001 | 0010 â†’ 0011</li>
<li><strong><code>å–å(~)</code></strong> â†’ <strong>æŒ‰ä½å–å</strong>ï¼Œå¦‚~0x1 â†’ 0001 â†’ 1110</li>
</ul>
<p>æ¥ç€ä»¥ä¸Šé¢æ‰‹æœºçŠ¶æ€ä¸ºä¾‹ï¼Œå†™ä¸ªçŠ¶æ€ç®¡ç†çš„ä¾‹å­ï¼š</p>
<pre><code class="hljs language-java copyable" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> state = <span class="hljs-number">0</span>;
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> CLOSE = <span class="hljs-number">0x1</span>; <span class="hljs-comment">// å…³æœºçŠ¶æ€</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> FIRST_BOOT = <span class="hljs-number">0x2</span>;   <span class="hljs-comment">// é¦–æ¬¡å¯åŠ¨</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> NOT_FIRST_BOOT = <span class="hljs-number">0x4</span>;    <span class="hljs-comment">// éé¦–æ¬¡å¯åŠ¨</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> AFTER_BOOT = <span class="hljs-number">0x8</span>;    <span class="hljs-comment">// å¯åŠ¨å</span>
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p><strong>çŠ¶æ€å¢åŠ </strong> â†’ æˆ–è¿ç®—</p>
<pre><code class="hljs language-java copyable" lang="java">state | CLOSE â†’ (<span class="hljs-number">0000</span> | <span class="hljs-number">0001</span>) â†’ <span class="hljs-number">0001</span> â†’ æ­¤æ—¶çŠ¶æ€ï¼šCLOSE
state | FIRST_BOOT â†’ (<span class="hljs-number">0001</span> | <span class="hljs-number">0010</span>) â†’ <span class="hljs-number">0011</span> â†’ æ­¤æ—¶çŠ¶æ€ï¼šCLOSE + FIRST_BOOT
state | NOT_FIRST_BOOT â†’ (<span class="hljs-number">0011</span> | <span class="hljs-number">0100</span>) â†’ <span class="hljs-number">0111</span> â†’ æ­¤æ—¶çŠ¶æ€ï¼šCLOSE + FIRST_BOOT + NOT_FIRST_BOOT
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p><strong>çŠ¶æ€ç§»é™¤</strong> â†’ å¯¹åº”çš„ä½æ•°ä»1æ”¹ä¸º0ï¼Œå…ˆå–åï¼Œå†ä¸è¿ç®—</p>
<pre><code class="hljs language-java copyable" lang="java">state &= ~NOT_FIRST_BOOT â†’ (<span class="hljs-number">0111</span> & <span class="hljs-number">1011</span>) â†’ <span class="hljs-number">0011</span> â†’ æ­¤æ—¶çŠ¶æ€ï¼šCLOSE + FIRST_BOOT
state &= ~CLOSE â†’ (<span class="hljs-number">0011</span> & <span class="hljs-number">1110</span>) â†’ <span class="hljs-number">0010</span> â†’ æ­¤æ—¶çŠ¶æ€ï¼šFIRST_BOOT
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p><strong>çŠ¶æ€åˆ¤æ–­</strong> â†’ ä¸è¿ç®—åˆ¤æ–­ç»“æœæ˜¯å¦ä¸º0</p>
<pre><code class="hljs language-java copyable" lang="java"><span class="hljs-comment">// å‡è®¾æ­¤æ—¶çŠ¶æ€ä¸ºï¼šCLOSE + FIRST_BOOT + NOT_FIRST_BOOT</span>
state & FIRST_BOOT â†’ <span class="hljs-number">0111</span> & <span class="hljs-number">0010</span> = <span class="hljs-number">0010</span> â†’ <span class="hljs-number">0010</span> â†’ ç»“æœä¸ä¸º<span class="hljs-number">0</span>ï¼ŒåŒ…å«æ­¤çŠ¶æ€ï¼›

<span class="hljs-comment">// å‡è®¾æ­¤æ—¶çŠ¶æ€ä¸ºï¼šCLOSE + FIRST_BOOT</span>
state & NOT_FIRST_BOOT â†’ <span class="hljs-number">0011</span> & <span class="hljs-number">0100</span> â†’ ç»“æœä¸º<span class="hljs-number">0</span>ï¼Œä¸åŒ…å«æ­¤çŠ¶æ€ï¼›
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p><strong>ç–‘æƒ‘</strong>ï¼šç”¨æ¥æ ‡è¯†çŠ¶æ€çš„åå…­è¿›åˆ¶å¹¶ä¸æ˜¯è¿ç»­çš„ï¼Œå¦‚è·³è¿‡äº†0x3ï¼š</p>
<blockquote>
<p>å¦‚æœæŠŠä¸Šé¢çš„NOT_FIRST_BOOTä»0x4æ”¹ä¸º0x3ï¼Œè€ŒCLOSE + FIRST_BOOT ç»“æœä¸º0011ï¼ŒåŒä¸º0x3ï¼Œæ­¤æ—¶è¿›è¡ŒçŠ¶æ€åˆ¤æ–­ç»“æœä¸ä¸º0ï¼Œéš¾é“è¯´å¢åŠ äº†NOT_FIRST_BOOTçŠ¶æ€å—ï¼Ÿæ‰€ä»¥è¿™é‡Œçš„å–å€¼æ˜¯æœ‰å›ºå®šè§„åˆ™çš„ï¼Œå³ <strong>å·¦ç§»ä¸€ä½</strong>ã€‚</p>
</blockquote>
<pre><code class="hljs language-java copyable" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> CLOSE = <span class="hljs-number">1</span> << <span class="hljs-number">0</span>; 
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> FIRST_BOOT = <span class="hljs-number">1</span> << <span class="hljs-number">1</span>;   
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> NOT_FIRST_BOOT = <span class="hljs-number">1</span> << <span class="hljs-number">2</span>;    
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> AFTER_BOOT = <span class="hljs-number">1</span> << <span class="hljs-number">3</span>;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>é€‰æ‹©åå…­è¿›åˆ¶çš„åŸå› è€Œä¸ç”¨å…¶ä»–è¿›åˆ¶çš„åŸå› (å¦‚åè¿›åˆ¶)ï¼š</p>
<blockquote>
<p>è®¡ç®—æœºä¸­ï¼Œä¸€ä¸ªå­—èŠ‚æœ‰å…«ä½ï¼Œæœ€å¤§å€¼ä¸º1111111ï¼Œå¯¹åº”åè¿›åˆ¶255ï¼Œåå…­è¿›åˆ¶FFï¼ŒåŠä¸ªå­—èŠ‚ç”¨åå…­è¿›åˆ¶ <strong>é€šè¿‡ä¸€ä¸ªå­—æ¯</strong> å°±èƒ½è¡¨ç¤ºï¼Œè€Œè½¬æ¢æˆåè¿›åˆ¶åˆ™æ˜¯ä¸€ä¸ªæ— è§„å¾‹çš„æ•°å­—ï¼Œç›¸æ¯”èµ·åè¿›åˆ¶ï¼Œ<strong>åå…­è¿›åˆ¶è½¬äºŒè¿›åˆ¶</strong> æ›´ç›´è§‚ä¸€äº›ã€‚</p>
</blockquote>
<hr>
<p><strong>å‚è€ƒæ–‡çŒ®</strong>ï¼š</p>
<ul>
<li>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.yisu.com%2Fzixun%2F604733.html" target="_blank" rel="nofollow noopener noreferrer" title="https://www.yisu.com/zixun/604733.html" ref="nofollow noopener noreferrer">Androidæºç å¦‚ä½•ä½¿ç”¨16è¿›åˆ¶è¿›è¡ŒçŠ¶æ€ç®¡ç†</a></p>
</li>
</ul></div>  
</div>
            