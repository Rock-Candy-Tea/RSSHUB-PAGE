
---
title: '移动应用遗留系统重构（2）-架构篇'
categories: 
 - 编程
 - 掘金
 - 标签
headimg: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/268ddddfad6e430db81c0c91d7982116~tplv-k3u1fbpfcp-zoom-1.image'
author: 掘金
comments: false
date: Mon, 29 Mar 2021 21:29:18 GMT
thumbnail: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/268ddddfad6e430db81c0c91d7982116~tplv-k3u1fbpfcp-zoom-1.image'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><h1 data-id="heading-0">前言</h1>
<p>上一篇<a href="https://juejin.cn/post/6943470229905211422" target="_blank">移动应用遗留系统重构（1）- 开篇</a>我们分享了移动应用遗留系统常见的问题。那么好的实践或者架构设计是怎样的呢？</p>
<p>这一篇我们将整理业内优秀的移动应用架构设计，包含微信、淘宝、支付宝以及美团外卖。其中的部分产品也经历过遗留系统的重构改造，具有非常好的参考意义。</p>
<h1 data-id="heading-1">优秀实践</h1>
<h2 data-id="heading-2">微信</h2>
<p>从微信对外分享的架构演进文章中可知，微信应用其实也是经历了从大单体到模块化的演进。</p>
<p><img alt class="lazyload" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/268ddddfad6e430db81c0c91d7982116~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<blockquote>
<p>图片来源 <a href="https://mp.weixin.qq.com/s/6Q818XA5FaHd7jJMFBG60w" target="_blank" rel="nofollow noopener noreferrer">微信Android模块化架构重构实践</a></p>
</blockquote>
<p>我们看下介绍中后续改造后的架构设计。</p>
<p><img alt class="lazyload" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/89aa2b911e0c424da5daeb1723b1a465~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<blockquote>
<p>图片来源 <a href="https://mp.weixin.qq.com/s/6Q818XA5FaHd7jJMFBG60w" target="_blank" rel="nofollow noopener noreferrer">微信Android模块化架构重构实践</a></p>
</blockquote>
<p>设计中提到重构主要3个目标</p>
<ul>
<li>改变通信方式 （API化）</li>
<li>重新设计模块 （中心化业务代码回归各自业务）</li>
<li>约束代码边界 （pins工程结构，更细粒度管控边界）</li>
</ul>
<p>我们可以发现重构后架构比原来的单体应用的一些变化。</p>
<ol>
<li>业务模块独立编译调试，耦合度低</li>
<li>代码复用高，有统一公共的组件库及kernel</li>
<li>模块职责、代码边界清晰，强约束</li>
</ol>
<p>更多信息可阅读原文，<a href="https://mp.weixin.qq.com/s/6Q818XA5FaHd7jJMFBG60w" target="_blank" rel="nofollow noopener noreferrer">微信Android模块化架构重构实践</a></p>
<h2 data-id="heading-3">手淘</h2>
<p>从手机淘宝客户端架构探索实践的分享中介绍到手机淘宝从1.0用单工程编写开始，东西非常简陋；到2.0为索引许多三方库的庞大的单工程；再到3.0打破了单工程开发模式实现业务复用。</p>
<p><img alt class="lazyload" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1d4a21eaed824140924a41b49f310b04~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<blockquote>
<p>图片来源 <a href="https://yq.aliyun.com/articles/129" target="_blank" rel="nofollow noopener noreferrer">手机淘宝客户端架构探索实践</a></p>
</blockquote>
<p>淘宝架构主要分为四层，最上层是组件Bundle(业务组件)，往下是容器(核心层)，中间件Bundle(功能封装)，基础库Bundle(底层库)。</p>
<p>文章提到架构演化的一些优点及变化很值得深思。</p>
<ol>
<li>业务复用，减少人力</li>
<li>基础复用，做深做精</li>
<li>敏捷开发，快速试错</li>
</ol>
<h2 data-id="heading-4">支付宝</h2>
<p>在支付宝mPass实践讨论分析一文中，提到支付宝客户端的总体架构图如下。</p>
<p><img alt class="lazyload" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0b356a0929a04d22bc3fc0a9fc868303~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<blockquote>
<p>图片来源 <a href="https://mp.weixin.qq.com/s?__biz=MzUyMDk2MzUzMQ==&mid=2247483672&idx=1&sn=249447e402bd41e455f3990d210d9c03&scene=21#wechat_redirect" target="_blank" rel="nofollow noopener noreferrer">开篇 | 模块化与解耦式开发在蚂蚁金服 mPaaS 深度实践探讨</a></p>
</blockquote>
<p>分享文章中介绍到5层架构设计如下：</p>
<ul>
<li>
<p>最底层是支付宝框架的容器层，包括类加载资源加载和安全模块；</p>
</li>
<li>
<p>第二层是我们抽离出来的组件层，包括网络库，日志库，缓存库，多媒体库，日志等等，简单说这些是一些通用的能力层；</p>
</li>
<li>
<p>第三层是我们定制的框架层，这是关键部分，是我们得以实现上千人，上千多个工程共同开发一个 App 的基础。</p>
</li>
<li>
<p>第四层是基于框架封装出来的业务服务层；</p>
</li>
<li>
<p>第五层便是具体的业务模块，其中每一个模块都是一个或多个具体的工程;</p>
</li>
</ul>
<p>文章中介绍到关于工程之间的依赖关系的处理比较特别。</p>
<p>在支付宝的架构里，编译参与的部分是和运行期参与的部分是分离的：编译期使用 bundle  的接口包，运行期使用 bundle 包本身。bundle 的接口包是 bundle 包的一部分，即刚才说的 bundle 的代码部分。bundle 的资源包同时打进接口包，在编译期提供给另一个 bundle 引用。</p>
<p>更多信息可阅读原文，<a href="https://mp.weixin.qq.com/s?__biz=MzUyMDk2MzUzMQ==&mid=2247483672&idx=1&sn=249447e402bd41e455f3990d210d9c03&scene=21#wechat_redirect" target="_blank" rel="nofollow noopener noreferrer">开篇 | 模块化与解耦式开发在蚂蚁金服 mPaaS 深度实践探讨</a></p>
<h2 data-id="heading-5">美团</h2>
<p>最后看另外一个跨平台技术架构相关的分享，在外卖客户端容器化架构的演进分享中提到了美团外包的整体架构如下。</p>
<p><img alt class="lazyload" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9bbefe79b121441eaccd2d13b038a10c~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<blockquote>
<p>图片来源 <a href="https://tech.meituan.com/2020/09/30/waimai-mobile-architecture-evolution.html" target="_blank" rel="nofollow noopener noreferrer">外卖客户端容器化架构的演进</a></p>
</blockquote>
<p>特别的一点是是采用了容器化架构，根据业务场景及PV，支持多种容器技术。在文末的总结提到，容器化架构相对于传统的移动端架构而言，充分地利用了现在的跨端技术，将动态化的能力最大化的赋予业务。通过动态化，带来业务迭代周期缩短、编译的加速、开发效率的提升等好处。同时，也解决了面临着的多端复用、平台能力、平台支撑、单页面多业务团队、业务动态诉求强等业务问题。但对线上的可用性、容器的可用性、支撑业务的线上发布上提出了更加严格的要求。</p>
<p>更多信息可阅读原文，<a href="https://tech.meituan.com/2020/09/30/waimai-mobile-architecture-evolution.html" target="_blank" rel="nofollow noopener noreferrer">外卖客户端容器化架构的演进</a></p>
<h1 data-id="heading-6">总结</h1>
<p><strong>架构是为了解决业务的问题，没有银弹。</strong> 但通过这些业内的优秀实践分享，我们可以发现一些优秀的设计范式。</p>
<ol>
<li>代码复用</li>
</ol>
<ul>
<li>公共能力复用，有专门统一管理应用公用的基础能力，如图片、网络、存储能力、安全等</li>
<li>公用业务能力复用，有专门统一管理应用的业务通用组件，如分享、推送、登录等</li>
</ul>
<ol start="2">
<li>低耦合，高内聚</li>
</ol>
<ul>
<li>业务模块间通过API方式依赖，不依赖具体的模块实现</li>
<li>依赖方向清晰，上层模块依赖下层模块</li>
</ul>
<ol start="3">
<li>并行研发</li>
</ol>
<ul>
<li>业务模块支持独立编译调试</li>
<li>业务模块独立发布</li>
</ul>
<p>结合这些特点及CloudDisk团队的业务，团队采用的架构设计如下。</p>
<p><img alt class="lazyload" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/87df48f3c43149f7b54b4a23d58a7d78~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<p>下一篇，移动应用遗留系统重构（3）- 示例篇，我们将继续介绍CloudDisk的业务及团队问题，分析现有的代码。</p>
<h1 data-id="heading-7">参考</h1>
<p><a href="https://mp.weixin.qq.com/s/6Q818XA5FaHd7jJMFBG60w" target="_blank" rel="nofollow noopener noreferrer">微信Android模块化架构重构实践</a></p>
<p><a href="https://yq.aliyun.com/articles/129" target="_blank" rel="nofollow noopener noreferrer">手机淘宝客户端架构探索实践</a></p>
<blockquote>
<p>参考来自阿里云开发者社区，但链接已失效</p>
</blockquote>
<p><a href="https://mp.weixin.qq.com/s?__biz=MzUyMDk2MzUzMQ==&mid=2247483672&idx=1&sn=249447e402bd41e455f3990d210d9c03&scene=21#wechat_redirect" target="_blank" rel="nofollow noopener noreferrer">开篇 | 模块化与解耦式开发在蚂蚁金服 mPaaS 深度实践探讨</a></p>
<p><a href="https://tech.meituan.com/2020/09/30/waimai-mobile-architecture-evolution.html" target="_blank" rel="nofollow noopener noreferrer">外卖客户端容器化架构的演进</a></p>
<h1 data-id="heading-8">系列链接</h1>
<p><a href="https://juejin.cn/post/6943470229905211422" target="_blank">移动应用遗留系统重构（1）- 开篇</a></p>
<h1 data-id="heading-9">大纲</h1>
<p><img alt class="lazyload" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/21a9b0cf68a0424f960aaf9a28ed3407~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<h1 data-id="heading-10">关于</h1>
<p><strong>欢迎关注CAC敏捷教练公众号</strong>。微信搜索：<strong>CAC敏捷教练</strong>。</p>
<ul>
<li>作者：黄俊彬</li>
<li><a href="https://junbin.tech/" target="_blank" rel="nofollow noopener noreferrer">博客：junbin.tech</a></li>
<li><a href="https://github.com/junbin1011" target="_blank" rel="nofollow noopener noreferrer">GitHub: junbin1011 </a></li>
<li><a href="https://www.zhihu.com/people/junbin-9-77" target="_blank" rel="nofollow noopener noreferrer">知乎: @JunBin</a></li>
</ul></div> <div class="image-viewer-box" data-v-78c9b824><!----></div>  
</div>
            