
---
title: '一个轻量级的，配置化的启动器'
categories: 
 - 编程
 - 掘金
 - 标签
headimg: 'https://picsum.photos/400/300?random=6293'
author: 掘金
comments: false
date: Sat, 07 Aug 2021 08:03:06 GMT
thumbnail: 'https://picsum.photos/400/300?random=6293'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><p>一个轻量级的，配置化的启动器</p>
<p>仓库地址：<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2FmyNameIsDu%2Faktiv%2Ftree%2Fmaster%2Fpackages%2Flauncher" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/myNameIsDu/aktiv/tree/master/packages/launcher" ref="nofollow noopener noreferrer">github.com/myNameIsDu/…</a></p>
<h2 data-id="heading-0">Install</h2>
<pre><code class="hljs language-bash copyable" lang="bash">npm install @aktiv/launcher
<span class="copy-code-btn">复制代码</span></code></pre>
<h2 data-id="heading-1">Introduction</h2>
<p>在此之前，你的react项目可能需要安装 <code>react-router</code> <code>react-router-dom</code> <code>redux</code> <code>react-redux</code> <code>redux-thunk</code>...，现在，这些都不需要了，你只需要Launcher, 它内置了这些东西，并提供了一套简单的可配置化的开发方案, <a href="https://juejin.cn/post/6993718229289943071#%E5%86%85%E7%BD%AE%E5%BA%93" target="_blank" title="#%E5%86%85%E7%BD%AE%E5%BA%93">查看内置库的版本</a></p>
<p>此外，它还提供了一套插件化的流程，使应用的变得更加可复用，可拓展</p>
<h2 data-id="heading-2">Get Started</h2>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-keyword">import</span> Launcher <span class="hljs-keyword">from</span> <span class="hljs-string">'@aktiv/launcher'</span>;

<span class="hljs-keyword">const</span> Home = <span class="hljs-function">() =></span> &#123;
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag"><<span class="hljs-name">div</span>></span>home<span class="hljs-tag"></<span class="hljs-name">div</span>></span></span>;
&#125;;
<span class="hljs-keyword">const</span> About = <span class="hljs-function">() =></span> &#123;
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag"><<span class="hljs-name">div</span>></span>home<span class="hljs-tag"></<span class="hljs-name">div</span>></span></span>;
&#125;;

<span class="hljs-keyword">const</span> RouterConfig = [
    &#123;
        <span class="hljs-attr">path</span>: <span class="hljs-string">'/'</span>,
        <span class="hljs-attr">component</span>: Home,
    &#125;,
    &#123;
        <span class="hljs-attr">path</span>: <span class="hljs-string">'/about'</span>,
        <span class="hljs-attr">component</span>: About,
    &#125;,
];

<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> Launcher(&#123;
    <span class="hljs-attr">routes</span>: RouterConfig,
&#125;);

app.start();
<span class="copy-code-btn">复制代码</span></code></pre>
<p>它仅有一个必传的参数，就是你的router配置</p>
<p>整体而言，参数分为两类：<a href="https://juejin.cn/post/6993718229289943071#router" target="_blank" title="#router">router</a> 和 <a href="https://juejin.cn/post/6993718229289943071#store" target="_blank" title="#store">store</a></p>
<pre><code class="hljs language-typescript copyable" lang="typescript"><span class="hljs-keyword">interface</span> ConstructorOptionsType &#123;
    hash?: <span class="hljs-built_in">boolean</span>;
    routes: <span class="hljs-built_in">Array</span><RouteItem>;
    reducerConfig?: ReducerConfig;
    reducers?: ReducersMapObject;
    immerEnableES5?: <span class="hljs-built_in">boolean</span>;
    routerBasePath?: <span class="hljs-built_in">string</span>;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<h2 data-id="heading-3">router</h2>
<h3 data-id="heading-4">hash</h3>
<p>默认为browserRouter, 通过hash参数开启hashRouter</p>
<h3 data-id="heading-5">routerBasePath</h3>
<p>公有的路由前缀，详情查看react-router:
<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2FReactTraining%2Freact-router%2Fblob%2Fdev%2Fdocs%2Fadvanced-guides%2Fmigrating-5-to-6.md%23move-basename-from-router-to-routes" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/ReactTraining/react-router/blob/dev/docs/advanced-guides/migrating-5-to-6.md#move-basename-from-router-to-routes" ref="nofollow noopener noreferrer">github.com/ReactTraini…</a></p>
<h3 data-id="heading-6">routes</h3>
<p>静态路由配置</p>
<pre><code class="hljs language-typescript copyable" lang="typescript"><span class="hljs-keyword">interface</span> RouteItemBase &#123;
    path?: <span class="hljs-built_in">string</span>;
    casessensitive?: <span class="hljs-built_in">boolean</span>;
    children?: <span class="hljs-built_in">Array</span><RouteItem>;
    lazy?: <span class="hljs-built_in">boolean</span>;
    title?: <span class="hljs-built_in">string</span>;
&#125;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> RouteItem <span class="hljs-keyword">extends</span> RouteItemBase &#123;
    redirect?: <span class="hljs-built_in">string</span>;
    component?: ComponentType | (<span class="hljs-function">() =></span> DynamicImportType);
    <span class="hljs-comment">// plugin route options</span>
    [x: <span class="hljs-built_in">string</span>]: unknown;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>在react-router的基础上我们扩展了 lazy、title和redirect选项</p>
<h4 data-id="heading-7">lazy</h4>
<p>开启懒加载模式</p>
<h4 data-id="heading-8">title</h4>
<p>在加载到当前路由时，launcher会自动帮你赋值 <code>document.title</code></p>
<h3 data-id="heading-9">redirect</h3>
<p>由于react-router v6 不再支持 redirect 组件，所以这里我们内置了redirect功能, 分为三种情况:</p>
<pre><code class="hljs language-typescript copyable" lang="typescript"><span class="hljs-keyword">interface</span> RouteItemBase &#123;
    path?: <span class="hljs-built_in">string</span>;
    casessensitive?: <span class="hljs-built_in">boolean</span>;
    children?: <span class="hljs-built_in">Array</span><RouteItem>;
    lazy?: <span class="hljs-built_in">boolean</span>;
    title?: <span class="hljs-built_in">string</span>;
&#125;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> RedirectRouteItem <span class="hljs-keyword">extends</span> RouteItemBase &#123;
    <span class="hljs-attr">redirect</span>: <span class="hljs-built_in">string</span>;
&#125;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> NormalRouteItem <span class="hljs-keyword">extends</span> RouteItemBase &#123;
    <span class="hljs-attr">component</span>: ComponentType | (<span class="hljs-function">() =></span> DynamicImportType);
&#125;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> ParentRedirectRoteItem <span class="hljs-keyword">extends</span> RouteItemBase &#123;
    <span class="hljs-attr">redirect</span>: <span class="hljs-built_in">string</span>;
    component: ComponentType | (<span class="hljs-function">() =></span> DynamicImportType);
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>需要注意的是，如果你的项目传入了,routerBasePath，正常情况下当你使用redirect，并传入绝对路径时应该加上前缀名，但是在这里我们已经帮您内置了，所以你可以忽略它</p>
<h2 data-id="heading-10">store</h2>
<p>store的配置可能稍显复杂，首先这是我们的scr目录</p>
<pre><code class="copyable">actions
    |-list
    |-index.js
index.tsx
<span class="copy-code-btn">复制代码</span></code></pre>
<p>actions/list</p>
<pre><code class="hljs language-typescript copyable" lang="typescript"><span class="hljs-keyword">import</span> &#123; createActions &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@aktiv/launcher'</span>;
<span class="hljs-keyword">const</span> state = &#123;  <span class="hljs-comment">// state的默认值</span>
    <span class="hljs-attr">a</span>:<span class="hljs-string">"1"</span> 
&#125; 
<span class="hljs-keyword">const</span> config  = &#123;
    <span class="hljs-attr">editorA</span>:&#123;
        <span class="hljs-attr">key</span>:<span class="hljs-string">'a'</span>,  <span class="hljs-comment">// 发起dispatch的时候修改的对象state key</span>
        <span class="hljs-attr">payload</span>:<span class="hljs-function">(<span class="hljs-params">data</span>) =></span> data
    &#125;
&#125;
<span class="hljs-keyword">export</span> &#123; 
    state,
    config,
    <span class="hljs-attr">actions</span>: createActions(config)
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>actions/index</p>
<pre><code class="hljs language-typescript copyable" lang="typescript"><span class="hljs-keyword">import</span> list <span class="hljs-keyword">from</span> <span class="hljs-string">'./list'</span>
<span class="hljs-keyword">export</span> &#123; list &#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>index.tsx</p>
<pre><code class="hljs language-typescript copyable" lang="typescript"><span class="hljs-keyword">import</span> Launcher <span class="hljs-keyword">from</span> <span class="hljs-string">'@aktiv/launcher'</span>;
<span class="hljs-keyword">import</span> reducerConfig <span class="hljs-keyword">from</span> <span class="hljs-string">'./actions'</span>

<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> Launcher(&#123;
    <span class="hljs-attr">routes</span>: RouterConfig,
    reducerConfig
&#125;);

app.start();
<span class="copy-code-btn">复制代码</span></code></pre>
<p>这样的配置会产生如下的state</p>
<pre><code class="copyable">&#123;
    list: &#123;
        a: "1"
    &#125;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>使用dispatch:</p>
<pre><code class="hljs language-typescript copyable" lang="typescript"><span class="hljs-keyword">import</span> &#123; actions <span class="hljs-keyword">as</span> listActions &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'./actions/list'</span>

listActions.editorA(<span class="hljs-string">'hello'</span>)

<span class="copy-code-btn">复制代码</span></code></pre>
<p>此时的state为</p>
<pre><code class="copyable">&#123;
    list: &#123;
        a: "hello"
    &#125;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>当然你也可以在payload里边做一些其它事情，比如发起请求</p>
<pre><code class="hljs language-typescript copyable" lang="typescript"><span class="hljs-keyword">import</span> &#123; createActions &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'../src'</span>;
<span class="hljs-keyword">const</span> state = &#123;  <span class="hljs-comment">// state的默认值</span>
    <span class="hljs-attr">a</span>:<span class="hljs-string">"1"</span> 
&#125; 
<span class="hljs-keyword">const</span> config  = &#123;
    <span class="hljs-attr">editorA</span>:&#123;
        <span class="hljs-attr">key</span>:<span class="hljs-string">'a'</span>,  <span class="hljs-comment">// 发起dispatch的时候修改的对象state key</span>

        <span class="hljs-attr">payload</span>:<span class="hljs-function">(<span class="hljs-params">data</span>) =></span> &#123;
            <span class="hljs-keyword">return</span> api(data)
        &#125;

    &#125;
&#125;
<span class="hljs-keyword">export</span> &#123; 
    state,
    config,
    <span class="hljs-attr">actions</span>: createActions(config)
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>此时调用dispatch你的state如下：</p>
<pre><code class="hljs language-typescript copyable" lang="typescript">&#123;
    <span class="hljs-attr">list</span>: &#123;
        <span class="hljs-attr">a</span>: <span class="hljs-string">"apiResponse"</span>
    &#125;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>默认情况下，payload的返回值只会替换对应的state key，当然你也可以自定义处理</p>
<pre><code class="hljs language-typescript copyable" lang="typescript"><span class="hljs-keyword">import</span> &#123; createActions &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'../src'</span>;
<span class="hljs-keyword">const</span> state = &#123;  <span class="hljs-comment">// state的默认值</span>
    <span class="hljs-attr">a</span>:<span class="hljs-string">"1"</span> 
&#125; 
<span class="hljs-keyword">const</span> config  = &#123;
    <span class="hljs-attr">editorA</span>:&#123;
        <span class="hljs-attr">key</span>:<span class="hljs-string">'a'</span>,  <span class="hljs-comment">// 发起dispatch的时候修改的对象state key</span>

        <span class="hljs-attr">payload</span>:<span class="hljs-function">(<span class="hljs-params">data</span>) =></span> &#123;
            <span class="hljs-keyword">return</span> api(data)
        &#125;,
        <span class="hljs-comment">// 自定义处理state只需要加上handle， 它接收当前的state 和你的payload</span>
        <span class="hljs-attr">handle</span>:<span class="hljs-function">(<span class="hljs-params">state, payload</span>) =></span> &#123;
            <span class="hljs-comment">// 例如根据api的返回，改变state.a</span>
            <span class="hljs-keyword">if</span>(payload.data === <span class="hljs-literal">true</span>) &#123;
                <span class="hljs-comment">// 当然，你也可以改变 state.b  state.c 或者其它你想处理的state</span>
                state.a=<span class="hljs-string">"hello"</span>
            &#125; <span class="hljs-keyword">else</span> &#123;
                state.a=<span class="hljs-string">'hi'</span>
            &#125;
        &#125;
    &#125;
&#125;
<span class="hljs-keyword">export</span> &#123; 
    state,
    config,
    <span class="hljs-attr">actions</span>: createActions(config)
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>需要注意的是，我们内置了immer，并使用produce包裹了handle，所以你只需要对state直接赋值可以，并且不需要返回，由于state这时为immer的draft，所以如果你想debug，需要使用immer的功能，例如：</p>
<pre><code class="hljs language-typescript copyable" lang="typescript"><span class="hljs-keyword">import</span> &#123; current &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@aktiv/launcher'</span>;
<span class="hljs-comment">// 我们提供了内置库的所有导出，你只需从launcher导出即可</span>

<span class="hljs-keyword">const</span> config  = &#123;
    <span class="hljs-attr">editorA</span>:&#123;
        <span class="hljs-attr">key</span>:<span class="hljs-string">'a'</span>,  <span class="hljs-comment">// 发起dispatch的时候修改的对象state key</span>

        <span class="hljs-attr">payload</span>:<span class="hljs-function">(<span class="hljs-params">data</span>) =></span> &#123;
            <span class="hljs-keyword">return</span> api(data)
        &#125;,
        <span class="hljs-comment">// 自定义处理state只需要加上handle， 它接收当前的state 和你的payload</span>
        <span class="hljs-attr">handle</span>:<span class="hljs-function">(<span class="hljs-params">state, payload</span>) =></span> &#123;
            <span class="hljs-comment">// debug state</span>
            <span class="hljs-built_in">console</span>.log(current(state))
            <span class="hljs-comment">// 例如根据api的返回，改变state</span>
            <span class="hljs-keyword">if</span>(payload.data === <span class="hljs-literal">true</span>) &#123;
                <span class="hljs-comment">// 当然，你也可以改变 state.b  state.c 或者其它你想处理的state</span>
                state.a=<span class="hljs-string">"hello"</span>
            &#125; <span class="hljs-keyword">else</span> &#123;
                state.a=<span class="hljs-string">'hi'</span>
            &#125;
        &#125;
    &#125;
&#125;

<span class="copy-code-btn">复制代码</span></code></pre>
<p>详细使用可以查看immer官方文档：<a href="https://link.juejin.cn/?target=https%3A%2F%2Fimmerjs.github.io%2Fimmer%2Fcurrent" target="_blank" rel="nofollow noopener noreferrer" title="https://immerjs.github.io/immer/current" ref="nofollow noopener noreferrer">immerjs.github.io/immer/curre…</a></p>
<p>好了，这就是store的大致用法，除此之外，还有两个参数：immerEnableES5、reducers</p>
<p>immerEnableES5： 开启immer兼容es5，详情可查看immer官方文档:<a href="https://link.juejin.cn/?target=https%3A%2F%2Fimmerjs.github.io%2Fimmer%2Finstallation" target="_blank" rel="nofollow noopener noreferrer" title="https://immerjs.github.io/immer/installation" ref="nofollow noopener noreferrer">immerjs.github.io/immer/insta…</a></p>
<p>reducers: 自定义的reducers，需要注意的是，这里你要像正常情况下一样使用不可变数据的写法，并返回它，因为这里并没有使用immer对其处理</p>
<h2 data-id="heading-11">plugin</h2>
<p>plugin功能是launcher的最强大的功能，它基于router开发，一个plugin看起来是这样的</p>
<pre><code class="hljs language-typescript copyable" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> Plugin &#123;
    <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
    outer?: PluginOuterRenderType;
    inner?: PluginInnerRenderType;
    reducerConfig?: ReducerConfigItem;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>最简单的场景是登陆接口请求成功之后，你才想展示你的应用, 并且把用户信息传递下去</p>
<pre><code class="hljs language-jsx copyable" lang="jsx"><span class="hljs-keyword">import</span> React, &#123; useEffect, useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> Launcher <span class="hljs-keyword">from</span> <span class="hljs-string">'@aktiv/launcher'</span>;
<span class="hljs-keyword">const</span> LoginProviderContext = React.createContext(<span class="hljs-literal">null</span>);

<span class="hljs-keyword">const</span> LoginProvider = <span class="hljs-function">(<span class="hljs-params">&#123; children &#125;</span>) =></span> &#123;
    <span class="hljs-keyword">const</span> [isLogin, setLogin] = useState(<span class="hljs-literal">false</span>);
    <span class="hljs-keyword">const</span> [userInfo, setUserInfo] = useState(&#123;&#125;);

    useEffect(<span class="hljs-function">() =></span> &#123;
        loginApi()
            .then(<span class="hljs-function"><span class="hljs-params">res</span> =></span> &#123;
                setLogin(<span class="hljs-literal">true</span>);
                setUserInfo(res.data);
            &#125;)
            .catch(<span class="hljs-function"><span class="hljs-params">error</span> =></span> &#123;
                redirect(<span class="hljs-string">'/login'</span>);
            &#125;);
    &#125;, []);

    <span class="hljs-keyword">return</span> isLogin ? (
        <span class="xml"><span class="hljs-tag"><<span class="hljs-name">LoginProviderContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;userInfo&#125;</span>></span>&#123;children&#125;<span class="hljs-tag"></<span class="hljs-name">LoginProviderContext.Provider</span>></span></span>
    ) : <span class="hljs-literal">null</span>;
&#125;;

<span class="hljs-keyword">const</span> loginPlugin = &#123;
    <span class="hljs-attr">name</span>: <span class="hljs-string">'login'</span>,
    <span class="hljs-comment">// 第一个参数为内层的组件，第二个参数为 use 时传入的参数</span>
    <span class="hljs-attr">outer</span>: <span class="hljs-function">(<span class="hljs-params">children, opt</span>) =></span> &#123;
        <span class="xml"><span class="hljs-tag"><<span class="hljs-name">LoginProvider</span> <span class="hljs-attr">opt</span>=<span class="hljs-string">&#123;opt&#125;</span>></span>&#123;children&#125;<span class="hljs-tag"></<span class="hljs-name">LoginProvider</span>></span></span>;
    &#125;,
&#125;;
<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> Launcher(&#123;...&#125;);
<span class="hljs-comment">// 通过第二个参数给插件传参</span>
app.use(loginPlugin, opt)
app.start()
<span class="copy-code-btn">复制代码</span></code></pre>
<p>当然你可以拥有多个插件，只需注意插件的调用层级，在后边调用的会包裹在外层</p>
<h3 data-id="heading-12">outer</h3>
<p>outer的例子如上所示，这里要说明的是outer是包裹在router外层的，所以你可以理解为全局唯一的</p>
<h3 data-id="heading-13">inner</h3>
<p>inner常用的例子是对每个路由进行控制，因为它是包裹在每个route外层的，例如需要对每个路由进行鉴权</p>
<pre><code class="hljs language-tsx copyable" lang="tsx"><span class="hljs-keyword">import</span> React, &#123; useEffect, useState, useContext &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> Launcher, &#123; useLocation &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@aktiv/launcher'</span>;

<span class="hljs-keyword">const</span> AuthContext = React.createContext()

<span class="hljs-keyword">const</span> AuthProvider = <span class="hljs-function">(<span class="hljs-params">&#123;children&#125;</span>) =></span> &#123;
    <span class="hljs-keyword">const</span> [ authData, setAuthData ] = useState()
    useEffect(<span class="hljs-function">()=></span>&#123;
        authApi()
            .then(<span class="hljs-function"><span class="hljs-params">res</span> =></span> &#123;
                setAuthData(res.data)
            &#125;)
    &#125;,[])
    <span class="hljs-keyword">return</span> authData ? (
        <span class="xml"><span class="hljs-tag"><<span class="hljs-name">AuthContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;authData&#125;</span>></span>&#123;children&#125;<span class="hljs-tag"></<span class="hljs-name">AuthContext.Provider</span>></span></span>
    ) : <span class="hljs-literal">null</span>;
&#125;

<span class="hljs-keyword">const</span> AuthRouteComponent = <span class="hljs-function">(<span class="hljs-params">&#123; children, route &#125;</span>) =></span> &#123;
    <span class="hljs-keyword">const</span> &#123; hasAuth &#125; = route
    <span class="hljs-keyword">const</span> &#123; pathname &#125; = useLocation()
    <span class="hljs-keyword">const</span> authInfo = useContext(AuthContext)

    <span class="hljs-keyword">if</span>(hasAuth && !authInfo.has(pathname))&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-string">'没有权限'</span>
    &#125;
    <span class="hljs-keyword">return</span> children
&#125;

<span class="hljs-keyword">const</span> plugin = &#123;
    <span class="hljs-attr">name</span>:<span class="hljs-string">'auth'</span>,
    <span class="hljs-attr">outer</span>:<span class="hljs-function">(<span class="hljs-params">children, opt</span>) =></span> &#123;
        <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag"><<span class="hljs-name">AuthProvider</span> <span class="hljs-attr">opt</span>=<span class="hljs-string">&#123;opt&#125;</span>></span>&#123;children&#125;<span class="hljs-tag"></<span class="hljs-name">AuthProvider</span>></span></span>
    &#125;,
    <span class="hljs-attr">inner</span>:<span class="hljs-function">(<span class="hljs-params">children, route, opt</span>) =></span> &#123;
        <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag"><<span class="hljs-name">AuthRouteComponent</span> <span class="hljs-attr">route</span>=<span class="hljs-string">&#123;route&#125;</span> <span class="hljs-attr">opt</span>=<span class="hljs-string">&#123;opt&#125;</span>></span>&#123;children&#125;<span class="hljs-tag"></<span class="hljs-name">AuthRouteComponent</span>></span></span>
    &#125;
&#125;

<span class="hljs-keyword">const</span> Home = <span class="hljs-function">() =></span> <span class="xml"><span class="hljs-tag"><<span class="hljs-name">div</span>></span>home<span class="hljs-tag"></<span class="hljs-name">div</span>></span></span>
<span class="hljs-keyword">const</span> About = <span class="hljs-function">() =></span> <span class="xml"><span class="hljs-tag"><<span class="hljs-name">div</span>></span>about<span class="hljs-tag"></<span class="hljs-name">div</span>></span></span>

<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> Launcher(&#123;
    <span class="hljs-attr">routes</span>:[
        &#123;
            <span class="hljs-attr">path</span>:<span class="hljs-string">'/'</span>,
            <span class="hljs-attr">component</span>:Home
        &#125;,
        &#123;
            <span class="hljs-attr">path</span>:<span class="hljs-string">'/about'</span>,
            <span class="hljs-attr">component</span>:Home,
            <span class="hljs-comment">// /about需要鉴权</span>
            <span class="hljs-attr">hasAuth</span>:<span class="hljs-literal">true</span>
        &#125;
    ]
&#125;)
app.use(plugin, opt)
<span class="copy-code-btn">复制代码</span></code></pre>
<h3 data-id="heading-14">reducerConfig</h3>
<p>每个插件也具有参与store的能力</p>
<pre><code class="hljs language-typescript copyable" lang="typescript"><span class="hljs-keyword">const</span> authReducerConfig = &#123;
    <span class="hljs-attr">state</span>:&#123;
        <span class="hljs-attr">a</span>:<span class="hljs-number">1</span>
    &#125;,
    <span class="hljs-attr">config</span>:&#123;
        <span class="hljs-attr">editorA</span>:&#123;
            <span class="hljs-attr">key</span>:<span class="hljs-string">'a'</span>,
            <span class="hljs-attr">payload</span>: <span class="hljs-function"><span class="hljs-params">data</span> =></span> data
        &#125;
    &#125;
&#125;
<span class="hljs-keyword">const</span> plugin = &#123;
    <span class="hljs-attr">name</span>:<span class="hljs-string">"auth"</span>,
    <span class="hljs-attr">inner</span>:...,
    <span class="hljs-attr">out</span>:....,
    <span class="hljs-attr">reducerConfig</span>: authReducerConfig
&#125;
app.use(plugin)
<span class="copy-code-btn">复制代码</span></code></pre>
<p>state如下</p>
<pre><code class="copyable">&#123;
    auth:&#123;
        a:1
    &#125;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<h2 data-id="heading-15">内置库</h2>
<pre><code class="copyable">    "history": "^5.0.0",
    "immer": "^9.0.5",
    "react-hot-loader": "^4.13.0",
    "react-loadable": "^5.5.0",
    "react-redux": "^7.2.4",
    "react-router": "^6.0.0-beta.0",
    "react-router-dom": "^6.0.0-beta.0",
    "redux": "^4.1.0",
    "redux-thunk": "^2.3.0"，
<span class="copy-code-btn">复制代码</span></code></pre>
<p>此外内部实现了一个基于 redux-promise 改造而来的 处理promise的 redux 中间件</p></div>  
</div>
            