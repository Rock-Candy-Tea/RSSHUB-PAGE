
---
title: '前端脚手架开发(三)，实践出真知'
categories: 
 - 编程
 - 掘金
 - 标签
headimg: 'https://picsum.photos/400/300?random=1648'
author: 掘金
comments: false
date: Wed, 16 Jun 2021 17:57:46 GMT
thumbnail: 'https://picsum.photos/400/300?random=1648'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><p>这是我参与更文挑战的第 17 天，活动详情查看： <a href="https://juejin.cn/post/6967194882926444557" target="_blank">更文挑战</a></p>
<blockquote>
<p>2021-06-17 总结 TANGJIE 其他 脚手架基础 简易手脚架</p>
</blockquote>
<h1 data-id="heading-0">前端脚手架开发(三)，实践出真知</h1>
<p>开发一个example-test手脚架，做一个简单的东西~</p>
<h2 data-id="heading-1">1. 基本开发</h2>
<h3 data-id="heading-2">1.1 创建一个项目</h3>
<p>找一个位置创建一个文件夹<code>example-test</code></p>
<p>使用<code>npm init</code>初始化项目，然后在其项目下创建一个bin文件夹，写入一个index.js文件,index.js代码如下：</p>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-meta">#!/usr/bin/env node</span>

<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'wecome exaple-test'</span>)
<span class="copy-code-btn">复制代码</span></code></pre>
<p>配置package.json</p>
<pre><code class="hljs language-javascript copyable" lang="javascript">&#123;
  ...
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"@tangjie123/example-test"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0.0"</span>,
  <span class="hljs-string">"description"</span>: <span class="hljs-string">"test"</span>,
  <span class="hljs-string">"bin"</span>:&#123;
    <span class="hljs-string">"example-test"</span>:<span class="hljs-string">"bin/index.js"</span>
  &#125;,
  <span class="hljs-string">"main"</span>: <span class="hljs-string">"index.js"</span>,
  ...
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<h3 data-id="heading-3">1.2 发布到npm</h3>
<p>这里需要注册一个nmp账号
使用<code>npm login</code>去登录，然后用<code>npm whoami</code>去验证是否登录
在使用<code>npm publish</code>或者<code>npm publish --access public</code> 去发布</p>
<h3 data-id="heading-4">1.3 npm 全局安装体验</h3>
<p>例如我的包名是<code>@tangjie123/example-test</code>,那么就运行<code>npm i @tangjie123/example-test -g</code></p>
<p>再使用(有没有发现：- 在<code>/c/Users/Administrator/AppData/Roaming/npm</code>下配置vue的软链接（shell脚本)指向同级目录下的<code>node_modules/@vue/cli/bin/vue.js</code>这一步在我们下载安装在全局的时候就已经帮我们做了)
<code>example-test</code></p>
<p>或者</p>
<p><code>winpty example-test.cmd</code></p>
<p>就可以看到打印结果了—— wecome exaple-test</p>
<h2 data-id="heading-5">2. 发布npm可能出现的问题</h2>
<h3 data-id="heading-6">2.1 出现403</h3>
<p><code>npm ERR! 403 403 Forbidden - PUT http://registry.npmjs.org/hello_test_npm - You do not have permission to publish "xxx". Are you logged in as the correct user</code>
这个问题很不明显</p>
<p>其实很可能是你创建了npm账号没有去验证邮箱，验证一下邮箱就好了</p>
<h3 data-id="heading-7">2.2 出现402错误，提示付费</h3>
<p>原因是：以@开头，代表的是组织团体，如果直接用<code>npm publish</code>是需要付费的，如果不想付费就要用<code>npm publish --access public</code>这个命令去发布</p>
<h3 data-id="heading-8">2.3 其他错误</h3>
<p>npm其他错误都有比较好的提示，看着提示搜索吧！！！</p>
<h2 data-id="heading-9">3. 本地测试</h2>
<h3 data-id="heading-10">cli没有分包情况下的本地调试</h3>
<p>首先进入cli的入口文件所在的目录下，在上面我的cli<code>example-test/bin/index.js</code>所在的目录下，启用<code>npm link命令</code>：
运行过程如下</p>
<pre><code class="copyable">C:\Users\Administrator\AppData\Roaming\npm\example-test -> C:\Users\Administrator\AppData\Roaming\npm\node_modules\@tangjie123\example-test\bin\index.js
C:\Users\Administrator\AppData\Roaming\npm\node_modules\@tangjie123\example-test -> E:\myproject\Demo\cli\example-test
<span class="copy-code-btn">复制代码</span></code></pre>
<p>这样就完成了cli的本地调试，除了这种还有另一种，但是这种最大的优点是，本地cli文件变动不用把它发布到npm上去，运行的结果也是最新的结果，方便调试，因此其他方法就不赘述</p>
<h3 data-id="heading-11">cli有分包情况下的调试</h3>
<ol>
<li>首先先建立一个分包，我这边的分包名为<code>example-test-lib/lib/index.js</code>,然后用<code>npm init</code>进行项目的初始化</li>
<li>在此index.js文件下写一个简单的加法函数并导出</li>
</ol>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-built_in">module</span>.exports = &#123;
<span class="hljs-function"><span class="hljs-title">add</span>(<span class="hljs-params">a,b</span>)</span>&#123;
<span class="hljs-keyword">return</span> a + b
&#125;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<ol start="3">
<li>进入到主包<code>example-test</code>的目录下面，然后通过<code>npm link example-test-lib</code>,运行此命令后悔报错<code>404</code>,这是因为该分包没有发布到npm上去，于是乎为了本地调试，我们需要去到<code>example-test-lib/lib/index.js</code>，去<code>npm link</code>使得这个文件被链接到,此时还没结束还得去<code>package.json</code>去修改入口文件指向<code>lib/index.js</code>,因为项目初始化默认的入口文件是<code>index.js</code></li>
</ol>
<pre><code class="hljs language-json copyable" lang="json">...
<span class="hljs-string">"main"</span>: <span class="hljs-string">"lib/index.js"</span>
...
<span class="copy-code-btn">复制代码</span></code></pre>
<p>然后继续前一步，去到主包<code>example-test</code>的目录下面，然后通过<code>npm link example-test-lib</code>链接到分包，</p>
<ol start="4">
<li>因为不是通过npm下载的方式，而是通过的链接方式，因此需要我们在主包的<code>package.json</code>去手动添加依赖(这里添加的是生产依赖)</li>
</ol>
<pre><code class="hljs language-json copyable" lang="json">...
<span class="hljs-string">"dependencies"</span>:&#123;
<span class="hljs-attr">"example-test-lib"</span>: <span class="hljs-string">"^1.0.0"</span>
&#125;
...
<span class="copy-code-btn">复制代码</span></code></pre>
<p>备注:devDependencies是指开发依赖，dependencies是指生产依赖</p>
<ol start="5">
<li>本地测试效果</li>
</ol>
<p>在主包的index.js去引用分包尝试一下吧！！！,完整的主包代码如下</p>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-meta">#!/usr/bin/env node</span>
<span class="hljs-keyword">const</span> lib = <span class="hljs-built_in">require</span>(<span class="hljs-string">'example-test-lib'</span>);
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'wecome exaple-test link本地测试'</span>)
<span class="hljs-built_in">console</span>.log(lib.add(<span class="hljs-number">5</span>,<span class="hljs-number">7</span>))


<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">A</span> (<span class="hljs-params"></span>)</span>&#123;
  <span class="hljs-built_in">this</span>.b = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">c,b</span>)</span>&#123;
    <span class="hljs-keyword">return</span> c+b
  &#125;
&#125;

A.prototype.test = <span class="hljs-function">()=></span>&#123;
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'xxx'</span>)
&#125;

<span class="hljs-keyword">const</span> a = <span class="hljs-keyword">new</span> A();
<span class="hljs-keyword">const</span> b = <span class="hljs-keyword">new</span> A();
a.b;
b.b;

a.test === b.test
<span class="copy-code-btn">复制代码</span></code></pre>
<p>到此一个简易的cli和本地测试就完成了~</p>
<h2 data-id="heading-12">3. 总结,手脚架本地link标准流程</h2>
<h3 data-id="heading-13">3.1 链接本地手脚架</h3>
<pre><code class="hljs language-javascript copyable" lang="javascript">cd 你的cli目录，入口文件所在的位置
npm link
<span class="copy-code-btn">复制代码</span></code></pre>
<h3 data-id="heading-14">3.2 链接本地库文件</h3>
<pre><code class="hljs language-javascript copyable" lang="javascript">cd 你的你的库，入口文件所在的位置
npm link
<span class="copy-code-btn">复制代码</span></code></pre>
<p>然后，转到主包的入口文件</p>
<pre><code class="hljs language-javascript copyable" lang="javascript">cd 你的cli目录，入口文件所在的位置
npm link 你的库名
<span class="copy-code-btn">复制代码</span></code></pre>
<h3 data-id="heading-15">3.3 取消链接本地文件</h3>
<pre><code class="hljs language-javascript copyable" lang="javascript">cd 你的cli目录，入口文件所在的位置
npm unlink
<span class="copy-code-btn">复制代码</span></code></pre>
<h3 data-id="heading-16">3.4 取消链接本地库文件</h3>
<pre><code class="hljs language-javascript copyable" lang="javascript">cd 你的你的库，入口文件所在的位置
npm unlink
<span class="copy-code-btn">复制代码</span></code></pre>
<p>然后，转到主包的入口文件</p>
<pre><code class="hljs language-javascript copyable" lang="javascript">cd 你的cli目录，入口文件所在的位置
# link存在
npm unlink 你的库名
# link不存在
rm -rf node_modules
npm install
<span class="copy-code-btn">复制代码</span></code></pre>
<h3 data-id="heading-17">3.5 理解<code>npm link</code></h3>
<p><code>npm link 你的库文件</code>,其意思就是将当前项目中的node_modules下指定的文件链接到node全局的node_modules下面的库文件
<code>npm link</code> 将当前项目链接到node全局node_modules中作为一个库文件，并解析bin并解析bin配置创建可执行文件</p></div>  
</div>
            