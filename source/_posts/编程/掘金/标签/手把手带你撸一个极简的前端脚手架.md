
---
title: '手把手带你撸一个极简的前端脚手架'
categories: 
 - 编程
 - 掘金
 - 标签
headimg: 'https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a9133aea94394e8f976c1f48d5e53052~tplv-k3u1fbpfcp-watermark.image'
author: 掘金
comments: false
date: Sun, 20 Jun 2021 18:18:39 GMT
thumbnail: 'https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a9133aea94394e8f976c1f48d5e53052~tplv-k3u1fbpfcp-watermark.image'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><blockquote>
<p>本文源码已经收录到<a href="https://github.com/Paulinho89/caoyp-cli" target="_blank" rel="nofollow noopener noreferrer">github</a>，欢迎各位小哥哥小姐姐们star，持续更新中。</p>
</blockquote>
<h2 data-id="heading-0">前言</h2>
<p>在前两篇文章<a href="https://juejin.cn/post/6973607639502553095" target="_blank">10分钟带你升级webpack5</a>、<a href="https://juejin.cn/post/6958977619723288590" target="_blank">【建议细读】从0到1手把手带你捋一套webpack+vue项目模板</a>中，带小伙伴们一起如何手动的从0到1搭建一个前端项目模板，但在我们实际的项目开发过程中，单纯的靠拷贝搭建好的项目模板生成新的项目，显然是比较低效的；如何<code>规避这种低效的拷贝操作</code>呢？答案是<code>脚手架/CLI</code>。那接下来我们就将上篇文章中我们手动搭建好的项目模板的基础上，通过<code>脚手架/CLI</code>的形式<code>一键快捷生成</code>我们想要的项目。</p>
<h2 data-id="heading-1">为什么需要脚手架/CLI</h2>
<blockquote>
<p>CLI，全称是 command-line interface，也就是命令行界面。</p>
</blockquote>
<p>脚手架的好处有哪些呢？</p>
<ul>
<li>规避通过人工低效的拷贝项目模板的操作</li>
<li>规范项目开发目录结构</li>
<li>统一团队统一开发风格，便于跨团队合作，以及后期维护，降低新人上手成本</li>
<li>提供一键前端项目的创建、配置、本地开发、插件扩展等功能，让开发者更多时间专注于业务</li>
</ul>
<h2 data-id="heading-2">脚手架/CLI的工作流程</h2>
<ul>
<li>一个完整的脚手架通常包含有这些：<code>项目的创建</code>、<code>项目模块的新增删除</code>、<code>项目打包</code>、<code>项目统一测试</code>、<code>项目发布</code>等；</li>
<li>下边通过这种图简单的阐述了脚手架的工作流程：<code>各自不同的端</code> -> <code>执行不同的脚手架命令</code> -> <code>从远端拉取不同的项目模板</code> -> <code>根据拉取的不同模板进行项目开发</code> -> <code>开发完自测后提交代码到远端仓库</code>；</li>
</ul>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a9133aea94394e8f976c1f48d5e53052~tplv-k3u1fbpfcp-watermark.image" alt="前端脚手架工作流程.png" loading="lazy" referrerpolicy="no-referrer"></p>
<h2 data-id="heading-3">脚手架/CLI需要用到的依赖分析</h2>









































<table><thead><tr><th>包名</th><th>功能描述</th></tr></thead><tbody><tr><td>commander</td><td>处理控制台命令</td></tr><tr><td>chalk</td><td>美化我们在命令行中输出内容的样式</td></tr><tr><td>fs-extra</td><td>文件操作</td></tr><tr><td>inquirer</td><td>控制台询问</td></tr><tr><td>handlebars</td><td>模板引擎渲染</td></tr><tr><td>log-symbols</td><td>打印日志提醒</td></tr><tr><td>ora</td><td>命令行loading动效</td></tr><tr><td>download-git-repo</td><td>远程下载模板</td></tr></tbody></table>
<h2 data-id="heading-4">如何编写一个极简的脚手架/CLI</h2>
<p>我们先来给脚手架取一个名字吧，<code>caoyp-cli</code></p>
<p>完成步骤拆解：</p>
<ol>
<li>创建项目（<code>create</code>）</li>
<li>自定义脚手架启动命令（<code>commander</code>）</li>
<li>询问用户获取创建的信息（<code>inquirer</code>）</li>
<li>从github下载用户需要的模板（<code>download-git-repo</code>）</li>
<li>发布项目（<code>npm</code>）</li>
</ol>
<h3 data-id="heading-5">1. 创建项目</h3>
<p>创建项目之前，我们先简单的定义一下我们的项目结构</p>
<pre><code class="copyable">caoyp-cli           
├─ bin                
│  └─ cli.js  # 启动文件 
├─ lib                
│  └─ create.js  # 创建项目文件 
│  └─ generator.js  # 下载项目文件
├─ .gitignore 
├─ README.md  
└─ package.json       

<span class="copy-code-btn">复制代码</span></code></pre>
<p>github上创建项目</p>
<pre><code class="copyable">git clone  https://github.com/Paulinho89/caoyp-cli
cd caoyp-cli
<span class="copy-code-btn">复制代码</span></code></pre>
<p>在项目更目录下执行：</p>
<pre><code class="copyable">npm init -y
<span class="copy-code-btn">复制代码</span></code></pre>
<p>在项目的根目录会自动帮助我们生成一个<code>package.json</code>文件</p>
<pre><code class="hljs language-json copyable" lang="json">&#123;
  <span class="hljs-attr">"name"</span>: <span class="hljs-string">"caoyp-cli"</span>,
  <span class="hljs-attr">"version"</span>: <span class="hljs-string">"1.0.0"</span>,
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"前端单页脚手架"</span>,
  <span class="hljs-attr">"main"</span>: <span class="hljs-string">"index.js"</span>,
  <span class="hljs-attr">"scripts"</span>: &#123;
    <span class="hljs-attr">"test"</span>: <span class="hljs-string">"echo \"Error: no test specified\" && exit 1"</span>
  &#125;,
  <span class="hljs-attr">"keywords"</span>: [
    <span class="hljs-string">"caoyp-cli"</span>,
    <span class="hljs-string">"caoyp"</span>,
    <span class="hljs-string">"脚手架"</span>
  ],
  <span class="hljs-attr">"author"</span>: <span class="hljs-string">"caoyp"</span>,
  <span class="hljs-attr">"license"</span>: <span class="hljs-string">"ISC"</span>
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p><strong>敲黑板了，这里是关键！！！</strong></p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/65c30848346d47ea9e013dcedd7ff893~tplv-k3u1fbpfcp-watermark.image" alt="images.jpeg" loading="lazy" referrerpolicy="no-referrer"></p>
<p>接下来我们要在<code>package.json</code>中添加一个<code>bin</code>字段，在安装时<code>npm </code>会将文件符号链接到 <code>prefix/bin</code> 以进行全局安装或<code>./node_modules/.bin/</code>本地安装。这样，就可以全局使用了。例如，下面的将<code>caoyp-cli</code>作为命令名称，执行文件是根目录的<code>index.js</code>；</p>
<pre><code class="hljs language-json copyable" lang="json">&#123;
  <span class="hljs-attr">"name"</span>: <span class="hljs-string">"caoyp-cli"</span>,
  <span class="hljs-attr">"version"</span>: <span class="hljs-string">"1.0.0"</span>,
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"前端单页脚手架"</span>,
  <span class="hljs-attr">"main"</span>: <span class="hljs-string">"index.js"</span>,
  <span class="hljs-attr">"bin"</span>: &#123;
    <span class="hljs-attr">"caoyp"</span>: <span class="hljs-string">"./bin/cli.js"</span>
  &#125;,
  <span class="hljs-attr">"scripts"</span>: &#123;
    <span class="hljs-attr">"test"</span>: <span class="hljs-string">"echo \"Error: no test specified\" && exit 1"</span>
  &#125;,
  <span class="hljs-attr">"keywords"</span>: [
    <span class="hljs-string">"caoyp-cli"</span>,
    <span class="hljs-string">"caoyp"</span>,
    <span class="hljs-string">"脚手架"</span>
  ],
  <span class="hljs-attr">"author"</span>: <span class="hljs-string">"caoyp"</span>,
  <span class="hljs-attr">"license"</span>: <span class="hljs-string">"ISC"</span>
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>简单的编辑一下<code>./bin/cli.js</code></p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-meta">#! /usr/bin/env node</span>

<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'caoyp-cli working ~~'</span>)
<span class="copy-code-btn">复制代码</span></code></pre>
<p><code>#! /usr/bin/env node</code>这段说明一下，不是注释，这段代码是告诉你的脚本工具(<code>bash/zsh</code>), 下面的内容是要在<code>node环境</code>下运行的代码，不能省略！！！</p>
<p>为了方便调试，使用<code>npm link</code>链接到全局</p>
<pre><code class="hljs language-sh copyable" lang="sh">➜  caoyp-cli git:(main) npm link
npm WARN my-node-cli@1.0.0 No description
npm WARN my-node-cli@1.0.0 No repository field.

audited 51 packages <span class="hljs-keyword">in</span> 1.7s
found 0 vulnerabilities

/usr/<span class="hljs-built_in">local</span>/bin/caoyp-cli -> /usr/<span class="hljs-built_in">local</span>/lib/node_modules/caoyp-cli/cli.js
/usr/<span class="hljs-built_in">local</span>/lib/node_modules/caoyp-cli -> /Users/caoyp/study/caoyp-cli
<span class="copy-code-btn">复制代码</span></code></pre>
<p>在命令行中输入<code>caoyp</code>，测试一下</p>
<pre><code class="hljs language-js copyable" lang="js">➜  caoyp-cli git:(main) caoyp

caoyp-cli working ~~
<span class="copy-code-btn">复制代码</span></code></pre>
<p>完成测试，打印出我们想要的结果。</p>
<h3 data-id="heading-6">2. 自定义脚手架启动命令</h3>
<p><strong>先来分析一下我们要怎么做？</strong></p>
<ol>
<li>我们要借助<code>commander</code>来实现</li>
<li>参考<code>vue-cli</code>，初始化一些常用的命令<code>create</code>、<code>help</code>等等</li>
<li>如果项目已经存在，需要给用户提示是否需要<code>强制覆盖</code></li>
</ol>
<h4 data-id="heading-7">2.1 安装依赖</h4>
<pre><code class="hljs language-js copyable" lang="js">npm i commander --save
<span class="copy-code-btn">复制代码</span></code></pre>
<h4 data-id="heading-8">2.2 创建命令</h4>
<p>在<code>./bin/cli.js</code>中编辑</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-meta">#! /usr/bin/env node</span>

<span class="hljs-keyword">const</span> program = <span class="hljs-built_in">require</span>(<span class="hljs-string">'commander'</span>)

program
  <span class="hljs-comment">// 定义命令和参数</span>
  .command(<span class="hljs-string">'create <app-name>'</span>)
  .description(<span class="hljs-string">'create a new project'</span>)
  <span class="hljs-comment">// -f or --force 为强制创建，如果创建的目录存在则直接覆盖</span>
  .option(<span class="hljs-string">'-f, --force'</span>, <span class="hljs-string">'overwrite target directory if it exist'</span>)
  .action(<span class="hljs-function">(<span class="hljs-params">name, options</span>) =></span> &#123;
    <span class="hljs-comment">// 打印执行结果</span>
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'name:'</span>, name, <span class="hljs-string">'options:'</span>, options)
  &#125;)
  
program
   <span class="hljs-comment">// 配置版本号信息</span>
  .version(<span class="hljs-string">`v<span class="hljs-subst">$&#123;<span class="hljs-built_in">require</span>(<span class="hljs-string">'../package.json'</span>).version&#125;</span>`</span>)
  .usage(<span class="hljs-string">'<command> [option]'</span>)
  
<span class="hljs-comment">// 解析用户执行命令传入参数</span>
program.parse(process.argv);
<span class="copy-code-btn">复制代码</span></code></pre>
<p>在命令行中输入<code>caoyp</code>，测试一下</p>
<pre><code class="hljs language-sh copyable" lang="sh">➜  caoyp-cli git:(main) caoyp
Usage: caoyp <<span class="hljs-built_in">command</span>> [option]

Options:
  -V, --version                output the version number
  -h, --<span class="hljs-built_in">help</span>                   display <span class="hljs-built_in">help</span> <span class="hljs-keyword">for</span> <span class="hljs-built_in">command</span>

Commands:
  create [options] <app-name>  create a new project
  <span class="hljs-built_in">help</span> [<span class="hljs-built_in">command</span>]               display <span class="hljs-built_in">help</span> <span class="hljs-keyword">for</span> <span class="hljs-built_in">command</span>
<span class="copy-code-btn">复制代码</span></code></pre>
<p>此时，我们发现Commands中已经有了<code>create [options] <app-name></code>命令，那接下来我们再输入<code>caoyp create</code>试试，看看会打印什么</p>
<pre><code class="hljs language-sh copyable" lang="sh">➜  caoyp-cli git:(main) caoyp create
error: missing required argument <span class="hljs-string">'app-name'</span>

➜  caoyp-cli git:(main) caoyp create my-project
执行结果 >>> name: my-project options: &#123;&#125;

➜  caoyp-cli git:(main) caoyp create my-project -f
执行结果 >>> name: my-project options: &#123; force: <span class="hljs-literal">true</span> &#125;

➜  caoyp-cli git:(main) caoyp create my-project --force
执行结果 >>> name: my-project options: &#123; force: <span class="hljs-literal">true</span> &#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>此时，我们可以在命令行中拿到我们的输入信息了。</p>
<h4 data-id="heading-9">2.3 执行命令</h4>
<p>创建一个<code>lib</code>文件夹，并且创建一个<code>create.js</code></p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-built_in">module</span>.exports = <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name, options</span>) </span>&#123;
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'-----create.js'</span>, name, options);
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p><code>./bin/cli.js</code>中引入<code>create.js</code></p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">const</span> program = <span class="hljs-built_in">require</span>(<span class="hljs-string">'commander'</span>);

program.command(<span class="hljs-string">'create <app-name>'</span>)
    .description(<span class="hljs-string">'create a new project'</span>)
    <span class="hljs-comment">// -f or --force 为强制创建，如果创建的目录存在则直接覆盖</span>
    .option(<span class="hljs-string">'-f, --force'</span>, <span class="hljs-string">'overwrite target directory if it exist'</span>)
    .action(<span class="hljs-function">(<span class="hljs-params">name, options</span>) =></span> &#123;
        <span class="hljs-comment">// 在 create.js 中执行创建任务</span>
        <span class="hljs-built_in">require</span>(<span class="hljs-string">'../lib/create.js'</span>)(name, options)
    &#125;)
<span class="copy-code-btn">复制代码</span></code></pre>
<p>再次执行<code>caoyp create my-project</code>，结果打印显示</p>
<pre><code class="hljs language-sh copyable" lang="sh">➜  caoyp-cli git:(main) caoyp create my-project
-----create.js
my-project &#123;&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>按照开头描述的，我们这个时候需要思考一下，我们在执行<code>create</code>的时候，项目目录到底是否存在；</p>
<ul>
<li>如果存在，友情提示创建项目已经存在；如果存在相同的项目目录，且加上-f，代表强制执行，此时删除老的目录，直接创建新的目录</li>
<li>如果不存在，直接创建新的目录</li>
</ul>
<p>我们需要借助另外一个插件<a href="https://www.npmjs.com/package/fs-extra" target="_blank" rel="nofollow noopener noreferrer">fs-extra</a>来辅助我们判断文件是否存在，同时安装一下<a href="https://www.npmjs.com/package/log-symbols" target="_blank" rel="nofollow noopener noreferrer">log-symbols</a>，方便我们在日志打印的时候，更加友好的给用户提示</p>
<p>安装一下<code>fs-extra</code>、<code>log-symbols</code></p>
<pre><code class="copyable">npm i fs-extra log-symbols --save
<span class="copy-code-btn">复制代码</span></code></pre>
<p>我们按照上边的思路再继续完善一下<code>create.js</code></p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs-extra'</span>);
<span class="hljs-keyword">const</span> symbols = <span class="hljs-built_in">require</span>(<span class="hljs-string">'log-symbols'</span>);

<span class="hljs-built_in">module</span>.exports = <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name, options</span>) </span>&#123;
    <span class="hljs-keyword">const</span> cwd = process.cwd();
    <span class="hljs-comment">// 需要创建的目录地址</span>
    <span class="hljs-keyword">const</span> targetAir = path.join(cwd, name);
    <span class="hljs-comment">// 判断目录是否已经存在</span>
    <span class="hljs-keyword">if</span> (!fs.existsSync(targetAir)) &#123;
        <span class="hljs-comment">// TODO：创建新的目录</span>
    &#125; <span class="hljs-keyword">else</span> &#123;
        <span class="hljs-built_in">console</span>.log(symbols.error, chalk.red(<span class="hljs-string">'项目已存在'</span>));
        <span class="hljs-comment">// 是否要强制创建</span>
        <span class="hljs-keyword">if</span> (options.force) &#123;
            <span class="hljs-keyword">await</span> fs.remove(targetAir);
            <span class="hljs-comment">// TODO：询问用户是否确定要覆盖</span>
        &#125;
    &#125;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>标注<code>TODO</code>的逻辑，我们会在下边再详细讲解。</p>
<h4 data-id="heading-10">2.4 完善帮助命令</h4>
<p>细心的小伙伴们在我们使用<code>vue-cli</code>的时候，<code>--help</code>会发现有很多帮助命令可以引导我们如何✅的姿势去使用脚手架。</p>
<pre><code class="hljs language-sh copyable" lang="sh">➜  ~ vue --<span class="hljs-built_in">help</span>
Usage: vue <<span class="hljs-built_in">command</span>> [options]

Options:
  -V, --version  output the version number
  -h, --<span class="hljs-built_in">help</span>     output usage information

Commands:
  init           generate a new project from a template
  list           list available official templates
  build          prototype a new project
  create         (<span class="hljs-keyword">for</span> v3 warning only)
  <span class="hljs-built_in">help</span> [cmd]     display <span class="hljs-built_in">help</span> <span class="hljs-keyword">for</span> [cmd]
<span class="copy-code-btn">复制代码</span></code></pre>
<p>所以，这里我们也模仿一下<code>vue-cli</code>，完善一下我们的帮助命令，先再安装一下<a href="https://www.npmjs.com/package/chalk" target="_blank" rel="nofollow noopener noreferrer">chalk</a>，用于美化一下命令行；<a href="https://www.npmjs.com/package/figlet" target="_blank" rel="nofollow noopener noreferrer">figlet</a>帮助我们打印一个属于自己的logo。</p>
<pre><code class="hljs language-sh copyable" lang="sh">const program = require(<span class="hljs-string">'commander'</span>);
const figlet = require(<span class="hljs-string">'figlet'</span>);
const chalk = require(<span class="hljs-string">'chalk'</span>);

program
  .on(<span class="hljs-string">'--help'</span>, () => &#123;
    console.log(<span class="hljs-string">'\r\n'</span> + figlet.textSync(<span class="hljs-string">'caoyp'</span>, &#123;
      font: <span class="hljs-string">'Ghost'</span>,
      horizontalLayout: <span class="hljs-string">'default'</span>,
      verticalLayout: <span class="hljs-string">'default'</span>,
      width: 80,
      whitespaceBreak: <span class="hljs-literal">true</span>
    &#125;));
    console.log(`\r\nRun <span class="hljs-variable">$&#123;chalk.cyan(`caoyp <command> --help`)&#125;</span> <span class="hljs-keyword">for</span> detailed usage of given <span class="hljs-built_in">command</span>\r\n`)
  &#125;)
<span class="copy-code-btn">复制代码</span></code></pre>
<p>执行<code>caoyp --help</code>，看看会打印出什么</p>
<pre><code class="hljs language-sh copyable" lang="sh">➜  caoyp-cli git:(main) caoyp --<span class="hljs-built_in">help</span>
Usage: caoyp <<span class="hljs-built_in">command</span>> [option]

Options:
  -V, --version                output the version number
  -h, --<span class="hljs-built_in">help</span>                   display <span class="hljs-built_in">help</span> <span class="hljs-keyword">for</span> <span class="hljs-built_in">command</span>

Commands:
  create [options] <app-name>  create a new project
  <span class="hljs-built_in">help</span> [<span class="hljs-built_in">command</span>]               display <span class="hljs-built_in">help</span> <span class="hljs-keyword">for</span> <span class="hljs-built_in">command</span>

             (<span class="hljs-string">'-.                                _ (`-.  
            ( OO ).-.                           ( (OO  ) 
   .-----.  / . --. / .-'</span>),-----.   ,--.   ,--._.`     \ 
  <span class="hljs-string">'  .--./  | \-.  \ ( OO'</span>  .-.  <span class="hljs-string">'   \  `.'</span>  /(__...--<span class="hljs-string">''</span> 
  |  |(<span class="hljs-string">'-..-'</span>-<span class="hljs-string">'  |  |/   |  | |  | .-'</span>)     /  |  /  | | 
 /_) |OO  )\| |_.<span class="hljs-string">'  |\_) |  |\|  |(OO  \   /   |  |_.'</span> | 
 ||  |`-<span class="hljs-string">'|  |  .-.  |  \ |  | |  | |   /  /\_  |  .___.'</span> 
(_<span class="hljs-string">'  '</span>--<span class="hljs-string">'\  |  | |  |   `'</span>  <span class="hljs-string">'-'</span>  <span class="hljs-string">' `-./  /.__) |  |      
   `-----'</span>  `--<span class="hljs-string">' `--'</span>     `-----<span class="hljs-string">'    `--'</span>      `--<span class="hljs-string">'      

Run caoyp <command> --help for detailed usage of given command
</span><span class="copy-code-btn">复制代码</span></code></pre>
<h3 data-id="heading-11">3. 询问用户获取创建的信息</h3>
<p>还是老规矩，动手之前我们先来分析一下询问用户信息该如何去做？</p>
<ol>
<li>完善上一步TODO：询问用户已经存在的目录是否要覆盖下载最新的</li>
</ol>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs-extra'</span>);
<span class="hljs-keyword">const</span> symbols = <span class="hljs-built_in">require</span>(<span class="hljs-string">'log-symbols'</span>);

<span class="hljs-built_in">module</span>.exports = <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name, options</span>) </span>&#123;
    <span class="hljs-keyword">const</span> cwd = process.cwd();
    <span class="hljs-comment">// 需要创建的目录地址</span>
    <span class="hljs-keyword">const</span> targetAir = path.join(cwd, name);
    <span class="hljs-comment">// 判断目录是否已经存在</span>
    <span class="hljs-keyword">if</span> (!fs.existsSync(targetAir)) &#123;
        <span class="hljs-comment">// 创建新的目录</span>
        fn(name, targetAir);
    &#125; <span class="hljs-keyword">else</span> &#123;
        <span class="hljs-built_in">console</span>.log(symbols.error, chalk.red(<span class="hljs-string">'项目已存在'</span>));
        <span class="hljs-comment">// 是否要强制创建</span>
        <span class="hljs-keyword">if</span> (options.force) &#123;
            <span class="hljs-keyword">await</span> fs.remove(targetAir);
            <span class="hljs-comment">// 创建新的目录</span>
            fn(name, targetAir);
        &#125;
    &#125;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<ol start="2">
<li>自定义模板信息</li>
</ol>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">const</span> fn = <span class="hljs-function">(<span class="hljs-params">name, targetAir</span>) =></span> &#123;
    <span class="hljs-comment">// 自定义模板项目信息</span>
    inquirer.prompt([
        &#123;
            <span class="hljs-attr">name</span>: <span class="hljs-string">'version'</span>,
            <span class="hljs-attr">message</span>: <span class="hljs-string">'请输入项目版本'</span>,
            <span class="hljs-attr">default</span>: <span class="hljs-string">'1.0.0'</span>
        &#125;,
        &#123;
            <span class="hljs-attr">name</span>: <span class="hljs-string">'description'</span>,
            <span class="hljs-attr">message</span>: <span class="hljs-string">'请输入项目描述信息'</span>,
            <span class="hljs-attr">default</span>: <span class="hljs-string">'这是一个自定义脚手架生成的项目'</span>
        &#125;,
        &#123;
            <span class="hljs-attr">name</span>: <span class="hljs-string">'author'</span>,
            <span class="hljs-attr">message</span>: <span class="hljs-string">'请输入作者名称'</span>,
            <span class="hljs-attr">default</span>: <span class="hljs-string">''</span>
        &#125;
    ]).then(<span class="hljs-function"><span class="hljs-params">res</span> =></span> &#123;
        <span class="hljs-comment">// TODO 下载github模板</span>
    &#125;)
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>此时，我们再次输入<code>caoyp create my-project</code>，会发现有对应的模板信息需要我们填写，创建一个空的<code>my-project</code>目录；如果输入<code>caoyp create my-project -f</code>，回车后会发现上次创建的<code>my-project</code>目录被移除掉，重新让我们输入对应的模板信息，重新创建新的模板项目；</p>
<h3 data-id="heading-12">4. 从github下载用户需要的模板</h3>
<p>还是老规矩，动手之前我们先来分析一下该如何从<code>github</code>下载用户需要的模板？</p>
<ol>
<li><code>github</code>上我们提前已经上传好默认的下载 <a href="https://github.com/Paulinho89/webpack5-single-template" target="_blank" rel="nofollow noopener noreferrer">模板</a></li>
</ol>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b29ee907ed494f6b8d102c1f73ba19eb~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<ol start="2">
<li>借助<code>download-git-repo</code>辅助下载模板</li>
</ol>
<p>先安装一下依赖<a href="https://www.npmjs.com/package/download-git-repo" target="_blank" rel="nofollow noopener noreferrer">download-git-repo</a>用于下载github中的模板；<a href="https://www.npmjs.com/package/handlebars" target="_blank" rel="nofollow noopener noreferrer">handlebars</a>用户动态的渲染模板提示信息；<a href="https://www.npmjs.com/package/ora" target="_blank" rel="nofollow noopener noreferrer">ora</a>下载的时候给一个<code>loading</code>效果。</p>
<pre><code class="copyable">npm i download-git-repo handlebars ora --save
<span class="copy-code-btn">复制代码</span></code></pre>
<p><code>./lib</code>目录下创建<code>generator.js</code>文件</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">const</span> ora = <span class="hljs-built_in">require</span>(<span class="hljs-string">'ora'</span>);
<span class="hljs-keyword">const</span> symbols = <span class="hljs-built_in">require</span>(<span class="hljs-string">'log-symbols'</span>);
<span class="hljs-keyword">const</span> inquirer = <span class="hljs-built_in">require</span>(<span class="hljs-string">'inquirer'</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs-extra'</span>);
<span class="hljs-keyword">const</span> downloadGitRepo = <span class="hljs-built_in">require</span>(<span class="hljs-string">'download-git-repo'</span>);
<span class="hljs-keyword">const</span> chalk = <span class="hljs-built_in">require</span>(<span class="hljs-string">'chalk'</span>);
<span class="hljs-keyword">const</span> handlebar = <span class="hljs-built_in">require</span>(<span class="hljs-string">'handlebars'</span>);

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Generator</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-title">constructor</span>(<span class="hljs-params">name, targetDir, res</span>)</span> &#123;
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.targetDir = targetDir;
        <span class="hljs-built_in">this</span>.res = res;
    &#125;

    <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-title">download</span>(<span class="hljs-params"></span>)</span> &#123;
        <span class="hljs-comment">// 1）拼接下载地址</span>
        <span class="hljs-keyword">const</span> requestUrl = <span class="hljs-string">`github.com:Paulinho89/webpack5-single-template#master`</span>;
        <span class="hljs-keyword">const</span> spinner = ora(<span class="hljs-string">`正在下载模板，源地址：<span class="hljs-subst">$&#123;requestUrl&#125;</span>`</span>);
        spinner.start();
        <span class="hljs-comment">// 2）调用下载方法</span>
        <span class="hljs-keyword">await</span> downloadGitRepo(
            <span class="hljs-comment">// 直连下载，默认下载master</span>
            requestUrl,
            <span class="hljs-built_in">this</span>.targetDir,
            <span class="hljs-function">(<span class="hljs-params">error</span>) =></span> &#123;
                <span class="hljs-keyword">if</span> (error) &#123;
                    spinner.fail();
                   <span class="hljs-comment">// 下载失败给出友情提示 console.log(symbols.error, chalk.red(error));</span>
                &#125; <span class="hljs-keyword">else</span> &#123;
                    spinner.succeed();
                    <span class="hljs-keyword">const</span> fileName =  <span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-built_in">this</span>.name&#125;</span>/package.json`</span>;
                    <span class="hljs-comment">// 下载成功后获取命令行输入的提示信息</span>
                    <span class="hljs-keyword">const</span> meta = &#123;
                        <span class="hljs-attr">name</span>: <span class="hljs-built_in">this</span>.name,
                        <span class="hljs-attr">version</span>: <span class="hljs-built_in">this</span>.res.version,
                        <span class="hljs-attr">description</span>: <span class="hljs-built_in">this</span>.res.description,
                        <span class="hljs-attr">author</span>: <span class="hljs-built_in">this</span>.res.author
                    &#125;
                    <span class="hljs-comment">// &#123;&#123;name&#125;&#125;/package.json路径存在时</span>
                    <span class="hljs-keyword">if</span> (fs.existsSync(fileName)) &#123;
                    <span class="hljs-comment">// 读取提示信息</span>
                    <span class="hljs-keyword">const</span> content = fs.readFileSync(fileName).toString();
                    <span class="hljs-keyword">const</span> resultContent = handlebar.compile(content)(meta); <span class="hljs-comment">//写入提示信息到模板项目的package.json文中 </span>
                    fs.writeFileSync(fileName, resultContent);
                    &#125;
                    <span class="hljs-built_in">console</span>.log(symbols.success, chalk.green(<span class="hljs-string">'项目初始化成功'</span>))
                    <span class="hljs-built_in">console</span>.log(symbols.info, <span class="hljs-string">`\r\n  cd <span class="hljs-subst">$&#123;chalk.cyan(<span class="hljs-built_in">this</span>.name)&#125;</span>`</span>)
                    <span class="hljs-built_in">console</span>.log(symbols.info, <span class="hljs-string">`\r\n  npm install`</span>)
                    <span class="hljs-built_in">console</span>.log(symbols.info, <span class="hljs-string">'npm run start\r\n'</span>)
                &#125;
            &#125;
        )
    &#125;
&#125;

<span class="hljs-built_in">module</span>.exports = Generator;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>关于下载<code>downloadGitRepo()</code>方法使用时会经常报出路径错误导致下载模板失败<code>--git clone status 128</code></p>
<p><strong>解决方案：</strong></p>
<p><strong>错误的写法：</strong></p>
<ul>
<li>直接去github模板链接当做第一个参数直接传递</li>
<li>使用&#123;clone: true&#125;</li>
</ul>
<pre><code class="hljs language-js copyable" lang="js">downloadGitRepo(<span class="hljs-string">'https://github.com/Paulinho89/webpack5-single-template'</span>, name, &#123;<span class="hljs-attr">clone</span>: <span class="hljs-literal">true</span>&#125;, <span class="hljs-function">(<span class="hljs-params">err</span>) =></span> &#123;
    <span class="hljs-built_in">console</span>.log(err ? <span class="hljs-string">'Fail'</span> : <span class="hljs-string">'Success'</span>)
&#125;)
<span class="copy-code-btn">复制代码</span></code></pre>
<p><strong>正确的写法：</strong></p>
<ul>
<li>使用github.com:用户名/模板名称#分支名称</li>
<li>去掉&#123;clone: true&#125;</li>
</ul>
<pre><code class="hljs language-js copyable" lang="js">downloadGitRepo(<span class="hljs-string">'github.com:Paulinho89/webpack5-single-template#master'</span>, name, <span class="hljs-function">(<span class="hljs-params">err</span>) =></span> &#123;
    <span class="hljs-built_in">console</span>.log(err ? <span class="hljs-string">'Fail'</span> : <span class="hljs-string">'Success'</span>)
&#125;)
<span class="copy-code-btn">复制代码</span></code></pre>
<ol start="3">
<li>完善上一步TODO：下载成功之后，将每次输入自定义的模板信息填充到模板项目的<code>package.json</code>中去</li>
</ol>
<p>模板项目的<code>package.json</code>中的<code>version</code>、 <code>description</code>、<code>author</code>这几个字段我们可以写成动态渲染的模式。</p>
<pre><code class="hljs language-json copyable" lang="json">&#123;
  <span class="hljs-attr">"name"</span>: <span class="hljs-string">"webpack-single-template"</span>,
  <span class="hljs-attr">"version"</span>: <span class="hljs-string">"&#123;&#123;version&#125;&#125;"</span>,
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"&#123;&#123;description&#125;&#125;"</span>,
  <span class="hljs-attr">"main"</span>: <span class="hljs-string">"index.js"</span>,
  <span class="hljs-attr">"scripts"</span>: &#123;
    <span class="hljs-attr">"start"</span>: <span class="hljs-string">"webpack serve --config build/webpack.config.dev.js"</span>,
    <span class="hljs-attr">"build:test"</span>: <span class="hljs-string">"rimraf dist && webpack --config build/webpack.config.test.js"</span>,
    <span class="hljs-attr">"build:prod"</span>: <span class="hljs-string">"rimraf dist && webpack --config build/webpack.config.prod.js"</span>,
    <span class="hljs-attr">"lint"</span>: <span class="hljs-string">"eslint --fix --ext .vue,.js src build"</span>,
    <span class="hljs-attr">"lint-staged"</span>: <span class="hljs-string">"lint-staged"</span>,
    <span class="hljs-attr">"build:stats"</span>: <span class="hljs-string">"webpack --config build/webpack.config.prod.js --json > stats.json"</span>,
    <span class="hljs-attr">"analyz"</span>: <span class="hljs-string">"cross-env NODE_ENV=production ANALYZE=true npm_config_report=true npm run prod"</span>,
    <span class="hljs-attr">"dll"</span>: <span class="hljs-string">"webpack --config build/webpack.config.dll"</span>
  &#125;,
  <span class="hljs-attr">"pre-commit"</span>: [
    <span class="hljs-string">"lint-staged"</span>
  ],
  <span class="hljs-attr">"lint-staged"</span>: &#123;
    <span class="hljs-attr">"*.&#123;js, vue&#125;"</span>: [
      <span class="hljs-string">"eslint --fix"</span>,
      <span class="hljs-string">"git add"</span>
    ]
  &#125;,
  <span class="hljs-attr">"author"</span>: <span class="hljs-string">"&#123;&#123;author&#125;&#125;"</span>,
  <span class="hljs-attr">"license"</span>: <span class="hljs-string">"ISC"</span>
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">const</span> Generator = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./generator'</span>);

<span class="hljs-keyword">const</span> fn = <span class="hljs-function">(<span class="hljs-params">name, targetAir</span>) =></span> &#123;
    <span class="hljs-comment">// 自定义模板项目信息</span>
    inquirer.prompt([
        &#123;
            <span class="hljs-attr">name</span>: <span class="hljs-string">'version'</span>,
            <span class="hljs-attr">message</span>: <span class="hljs-string">'请输入项目版本'</span>,
            <span class="hljs-attr">default</span>: <span class="hljs-string">'1.0.0'</span>
        &#125;,
        &#123;
            <span class="hljs-attr">name</span>: <span class="hljs-string">'description'</span>,
            <span class="hljs-attr">message</span>: <span class="hljs-string">'请输入项目描述信息'</span>,
            <span class="hljs-attr">default</span>: <span class="hljs-string">'这是一个自定义脚手架生成的项目'</span>
        &#125;,
        &#123;
            <span class="hljs-attr">name</span>: <span class="hljs-string">'author'</span>,
            <span class="hljs-attr">message</span>: <span class="hljs-string">'请输入作者名称'</span>,
            <span class="hljs-attr">default</span>: <span class="hljs-string">''</span>
        &#125;
    ]).then(<span class="hljs-function"><span class="hljs-params">res</span> =></span> &#123;
       <span class="hljs-comment">// 创建项目</span>
        <span class="hljs-keyword">const</span> generator = <span class="hljs-keyword">new</span> Generator(name, targetAir, res);
        generator.download();
    &#125;)
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>当下载模板完成之后会将用户输入的答案渲染到 <code>package.json </code>中。</p>
<h3 data-id="heading-13">5. 发布项目</h3>
<p>经过上边的逻辑梳理后，我们搭建的简易脚手架已经完成了，我们在实际使用的时候都是需要发布到npm仓库里的。</p>
<p>发布流程：</p>
<ol>
<li>注册一个<code>npm账号</code></li>
</ol>
<p>如果是新注册的账号，需要先登录填写的邮箱进行验证，否则直接发布的话发布失败。</p>
<ol start="2">
<li>完善<code>package.json</code>中的配置，确定发布的版本号</li>
</ol>
<pre><code class="hljs language-json copyable" lang="json">&#123;
  <span class="hljs-attr">"name"</span>: <span class="hljs-string">"caoyp-cli"</span>,
  <span class="hljs-attr">"version"</span>: <span class="hljs-string">"1.0.0"</span>,
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"前端单页脚手架"</span>,
  <span class="hljs-attr">"main"</span>: <span class="hljs-string">"index.js"</span>,
  <span class="hljs-attr">"bin"</span>: &#123;
    <span class="hljs-attr">"caoyp"</span>: <span class="hljs-string">"./bin/cli.js"</span>
  &#125;,
  <span class="hljs-attr">"directories"</span>: &#123;
    <span class="hljs-attr">"lib"</span>: <span class="hljs-string">"lib"</span>
  &#125;,
  <span class="hljs-attr">"scripts"</span>: &#123;
    <span class="hljs-attr">"test"</span>: <span class="hljs-string">"echo \"Error: no test specified\" && exit 1"</span>
  &#125;,
  <span class="hljs-attr">"repository"</span>: &#123;
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"git"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"git+https://github.com/Paulinho89/caoyp-cli.git"</span>
  &#125;,
  <span class="hljs-attr">"author"</span>: <span class="hljs-string">"caoyp"</span>,
  <span class="hljs-attr">"keywords"</span>: [
    <span class="hljs-string">"caoyp-cli"</span>,
    <span class="hljs-string">"caoyp"</span>,
    <span class="hljs-string">"脚手架"</span>
  ],
  <span class="hljs-attr">"license"</span>: <span class="hljs-string">"ISC"</span>,
  <span class="hljs-attr">"bugs"</span>: &#123;
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://github.com/Paulinho89/caoyp-cli/issues"</span>
  &#125;,
  <span class="hljs-attr">"homepage"</span>: <span class="hljs-string">"https://github.com/Paulinho89/caoyp-cli#readme"</span>,
  <span class="hljs-attr">"dependencies"</span>: &#123;
    <span class="hljs-attr">"axios"</span>: <span class="hljs-string">"^0.21.1"</span>,
    <span class="hljs-attr">"chalk"</span>: <span class="hljs-string">"^4.1.1"</span>,
    <span class="hljs-attr">"commander"</span>: <span class="hljs-string">"^7.2.0"</span>,
    <span class="hljs-attr">"download-git-repo"</span>: <span class="hljs-string">"^3.0.2"</span>,
    <span class="hljs-attr">"figlet"</span>: <span class="hljs-string">"^1.5.0"</span>,
    <span class="hljs-attr">"fs-extra"</span>: <span class="hljs-string">"^10.0.0"</span>,
    <span class="hljs-attr">"handlebars"</span>: <span class="hljs-string">"^4.7.7"</span>,
    <span class="hljs-attr">"inquirer"</span>: <span class="hljs-string">"^8.1.1"</span>,
    <span class="hljs-attr">"log-symbols"</span>: <span class="hljs-string">"^3.0.0"</span>,
    <span class="hljs-attr">"ora"</span>: <span class="hljs-string">"^5.4.1"</span>
  &#125;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<ol start="3">
<li>使用<code>npm publish</code>发布</li>
</ol>
<pre><code class="copyable">npm publish
<span class="copy-code-btn">复制代码</span></code></pre>
<p>发布成功之后，可以进入到npm个人仓库里，看到自己发布的包。</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/aef61ff2e23341fb955182c815082b5e~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>按照我们<code>README.md</code>中定义好的安装命令把脚手架<code>install</code>到我们的本地，然后创建，重启，一切正常；OK，这时我们的脚手架从项目搭建到发布整个流程就算结束了。</p>
<h2 data-id="heading-14">写到最后</h2>
<ul>
<li>目前，这个脚手架还是偏于简单，有些步骤还需要进一步完善，像我们在向远端仓库拉取模板的时候，通常我们在实际的开发过程中会有<code>多个版本的模板</code>，且每个模板都会有<code>不同的tag</code>；每次拉取可以通过选择不同的版本模板、不同的tag、添加更多的模板、删除模板等。接下来，我也会将这些功能持续完善到脚手架中。</li>
</ul>
<p>如果您觉得这篇文章对您有一点点帮助，欢迎您看完后给我<code>点赞</code>、<code>评论</code>、<code>关注</code>支持一下，您的支持是我写作的动力，谢谢~~😁</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/055781290e2f4d8aae54695023ccf983~tplv-k3u1fbpfcp-watermark.image" alt="images.jpeg" loading="lazy" referrerpolicy="no-referrer"></p></div>  
</div>
            