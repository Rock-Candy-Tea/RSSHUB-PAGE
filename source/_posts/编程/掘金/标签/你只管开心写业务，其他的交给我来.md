
---
title: '你只管开心写业务，其他的交给我来'
categories: 
 - 编程
 - 掘金
 - 标签
headimg: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1a204dec50c14fc688b25977b7f86a12~tplv-k3u1fbpfcp-watermark.image'
author: 掘金
comments: false
date: Tue, 06 Jul 2021 23:13:09 GMT
thumbnail: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1a204dec50c14fc688b25977b7f86a12~tplv-k3u1fbpfcp-watermark.image'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%&#125;.markdown-body p&#123;color:#595959;font-size:15px;line-height:2;font-weight:400&#125;.markdown-body p+p&#123;margin-top:16px&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;padding:30px 0;margin:0;color:#135ce0&#125;.markdown-body h1&#123;position:relative;text-align:center;font-size:22px;margin:50px 0&#125;.markdown-body h1:before&#123;position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)&#125;.markdown-body h2&#123;position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0&#125;.markdown-body h3&#123;font-size:16px&#125;.markdown-body ul&#123;list-style:disc outside;margin-left:2em;margin-top:1em&#125;.markdown-body li&#123;line-height:2;color:#595959&#125;.markdown-body img.loaded&#123;margin:0 auto;display:block&#125;.markdown-body blockquote&#123;background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5&#125;.markdown-body blockquote p&#123;color:#666;line-height:2&#125;.markdown-body a&#123;color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none&#125;.markdown-body em strong,.markdown-body strong&#123;color:#036aca&#125;.markdown-body hr&#123;border-top:1px solid #135ce0&#125;.markdown-body pre&#123;overflow:auto&#125;.markdown-body code,.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body table&#123;border-collapse:collapse;margin:1rem 0;overflow-x:auto&#125;.markdown-body table td,.markdown-body table th&#123;border:1px solid #dfe2e5;padding:.6em 1em&#125;.markdown-body table tr&#123;border-top:1px solid #dfe2e5&#125;.markdown-body table tr:nth-child(2n)&#123;background-color:#f6f8fa&#125;</style><h3 data-id="heading-0">吐槽点</h3>
<ul>
<li>每次开新项目都挺痛苦的，项目搭建（项目结构、组件、公共样式、打包、构建）找到老项目复制粘贴、删除、改造什么的也太 low 了，</li>
<li>再想要改造升级什么的，所有项目都得再撸一遍什么的麻烦死了，倒不如自己折腾一个脚手架体系来摆脱这些不必要的麻烦</li>
<li>还有一点就是，以后接私活啥的真的是太合适了，哈哈哈</li>
<li>代码在这里，@<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fhowieyi%2Fwater-react" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/howieyi/water-react" ref="nofollow noopener noreferrer">water-react</a></li>
</ul>
<h3 data-id="heading-1">要解决什么痛点？</h3>
<ul>
<li>再也不用复制粘贴什么的了</li>
<li>项目模板统一管理</li>
<li>构建流程统一了，构建产物也规范了</li>
<li>专心写业务，框架什么的干一次就行了</li>
<li>团队想积累点东西直接通过扩展脚手架即可方便扩展</li>
</ul>
<h3 data-id="heading-2">cli 打算做什么?</h3>
<ul>
<li>怎么着需要一个项目初始化的功能吧，不然要它做甚</li>
<li>初始化啥呢，这时候就需要定制模板了，对，做几套通用模板</li>
<li>项目初始化完事后呢，项目总需要跑起来吧，这时候就需要构建了</li>
<li>构建么，webpack、snowpack、rollup 什么的大家都不陌生吧，基本也就走这个路子了，选一个喜欢的，开启定制</li>
<li>开发环境构建、生产环境构建、包依赖分析什么的是必备功能了</li>
</ul>
<h3 data-id="heading-3">要如何做呢？</h3>
<ol>
<li>实现 cli 脚本雏形</li>
</ol>
<ul>
<li>利用 <code>package.json</code> 中的 <code>bin</code> 属性来指定各个内部命令对应的可执行文件的位置</li>
</ul>
<blockquote>
<p>node 体系内天然支持映射脚本的功能</p>
</blockquote>
<pre><code class="hljs language-json copyable" lang="json">&#123;
  <span class="hljs-attr">"name"</span>: <span class="hljs-string">"iwr"</span>,
  <span class="hljs-attr">"version"</span>: <span class="hljs-string">"1.0.1"</span>,
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"基于 react 的 cli 脚手架构建工具"</span>,
  <span class="hljs-attr">"bin"</span>: &#123;
    <span class="hljs-attr">"iwr"</span>: <span class="hljs-string">"bin/iwr.js"</span>
  &#125;,
  <span class="hljs-attr">"homepage"</span>: <span class="hljs-string">"https://github.com/howieyi/water-react"</span>,
  <span class="hljs-attr">"author"</span>: <span class="hljs-string">"水逆<huyi247767221@163.com>"</span>,
  <span class="hljs-attr">"license"</span>: <span class="hljs-string">"MIT"</span>
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<ul>
<li><code>bin/iwr.js</code>，这时候就需要编写脚本内容了</li>
</ul>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">// 这一行很关键，是告知系统通过环境变量中的 node 来执行该脚本</span>
#!<span class="hljs-regexp">/usr/</span>bin/env node

<span class="hljs-comment">// commander 是一个命令行处理工具，用作定义和处理命令以及其参数</span>
<span class="hljs-keyword">const</span> program = <span class="hljs-built_in">require</span>(<span class="hljs-string">"commander"</span>);
<span class="hljs-keyword">const</span> version = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../package'</span>).version;

program
  .version(version)
  .usage(
    <span class="hljs-string">`  
  water create
  water dev
  water prod -i -a [analyzerPort]
  water umd -i`</span>
  )
  .description(
    <span class="hljs-string">`Params:
  
  dev:
    -i 是否打印详细信息
  
  prod: 
    -i 是否打印详细信息
    -a [analyzerPort] 是否开启代码依赖分析（默认端口8989）

  umd:
    -i 是否打印详细信息  
    `</span>
  )
  .command(<span class="hljs-string">'create'</span>, <span class="hljs-string">'初始化项目'</span>)
  .command(<span class="hljs-string">'dev'</span>, <span class="hljs-string">'开发环境构建'</span>)
  .command(<span class="hljs-string">'prod'</span>, <span class="hljs-string">'生产环境构建'</span>)
  .command(<span class="hljs-string">'umd'</span>, <span class="hljs-string">'公共包构建'</span>);

program.parse(process.argv);
<span class="copy-code-btn">复制代码</span></code></pre>
<ol start="2">
<li>实现自定义模板雏形</li>
</ol>
<ul>
<li>模板肯定是基于历史项目，抽离共性，拆出来一套公共代码</li>
<li>需要自定义一个配置文件用来告知脚本项目相关的配置，比如定义主目录、编译目录、alias 映射目录等</li>
</ul>
<blockquote>
<p>这里比较灵活，根据需要自定义扩展</p>
</blockquote>
<ul>
<li>这里给出一个范例 <code>iwr.config.js</code></li>
</ul>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-keyword">const</span> proxyMapping = &#123;&#125;;

<span class="hljs-comment">// 接口前缀</span>
<span class="hljs-keyword">const</span> apiPrefix = <span class="hljs-string">'https://api.test.example.com'</span>;

<span class="hljs-comment">// 接口 uri 前缀</span>
<span class="hljs-keyword">const</span> uriPrefix = [<span class="hljs-string">'/api'</span>];

<span class="hljs-comment">// 代理映射</span>
uriPrefix.forEach(<span class="hljs-function"><span class="hljs-params">uri</span> =></span> &#123;
  proxyMapping[uri] = &#123;
    <span class="hljs-attr">target</span>: apiPrefix,
    <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">secure</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">pathRewrite</span>: &#123;
      [<span class="hljs-string">`^<span class="hljs-subst">$&#123;uri&#125;</span>`</span>]: apiPrefix + uri,
    &#125;,
  &#125;;
&#125;);

<span class="hljs-built_in">module</span>.exports = &#123;
  <span class="hljs-comment">// 自定义端口</span>
  <span class="hljs-attr">port</span>: <span class="hljs-string">'3001'</span>,
  <span class="hljs-comment">// 项目根目录</span>
  <span class="hljs-attr">resolvePath</span>: <span class="hljs-string">'./src'</span>,
  <span class="hljs-comment">// 构建主路径</span>
  <span class="hljs-attr">publicPath</span>: <span class="hljs-string">'/'</span>,
  <span class="hljs-comment">// 构建产物目录</span>
  <span class="hljs-attr">buildPath</span>: <span class="hljs-string">'./dist'</span>,
  <span class="hljs-comment">// 默认迁移文件目录</span>
  <span class="hljs-attr">copyPath</span>: <span class="hljs-string">'./src/assets/public'</span>,
  <span class="hljs-comment">// 接口代理</span>
  <span class="hljs-attr">proxy</span>: proxyMapping,
  <span class="hljs-comment">// 是否支持 markdown 转义</span>
  <span class="hljs-attr">markdown</span>: <span class="hljs-literal">false</span>,
&#125;;

<span class="copy-code-btn">复制代码</span></code></pre>
<ol start="3">
<li>基于模板实现构建</li>
</ol>
<blockquote>
<p>这里选的是 webpack5 去实现的构建</p>
</blockquote>
<ul>
<li>代码在这里，@<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fhowieyi%2Fwater-react" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/howieyi/water-react" ref="nofollow noopener noreferrer">water-react</a></li>
<li>开发模式，实现开发构建，hrm/sourceMap/scss/ts 啥的都是必备的</li>
</ul>
<blockquote>
<p>这里直接调用 webpack-dev-server，晒一下主要代码，主要思想是根据上面的配置文件来构建代码，webpack 配置啥的就不再赘述了，相信大家都比较熟悉了</p>
</blockquote>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">// 获取主配置</span>
<span class="hljs-keyword">const</span> webpackConfig = <span class="hljs-built_in">require</span>(<span class="hljs-string">`../webpack/build/webpack.dev.js`</span>)(&#123;
  ...appConfig,
&#125;);

<span class="hljs-keyword">const</span> webpack = <span class="hljs-built_in">require</span>(<span class="hljs-string">"webpack"</span>);
<span class="hljs-keyword">const</span> WebpackDevServer = <span class="hljs-built_in">require</span>(<span class="hljs-string">"webpack-dev-server"</span>);

<span class="hljs-keyword">try</span> &#123;
  <span class="hljs-keyword">const</span> devServerConfig = webpackConfig.devServer;
  <span class="hljs-comment">// 直接调用 webpack-dev-server</span>
  <span class="hljs-keyword">const</span> server = <span class="hljs-keyword">new</span> WebpackDevServer(webpack(webpackConfig), devServerConfig);
  <span class="hljs-comment">// 开启监听</span>
  server.listen(devServerConfig.port, devServerConfig.host, <span class="hljs-function"><span class="hljs-params">err</span> =></span> &#123;
    <span class="hljs-keyword">if</span> (err) &#123;
      <span class="hljs-keyword">throw</span> err;
    &#125;
  &#125;);
&#125; <span class="hljs-keyword">catch</span> (error) &#123;
  <span class="hljs-built_in">console</span>.error(error);
  process.exit(-<span class="hljs-number">1</span>);
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<ul>
<li>生产模式，生产环境构建打包了</li>
</ul>
<blockquote>
<p>贴一段主要代码</p>
</blockquote>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-keyword">const</span> webpack = <span class="hljs-built_in">require</span>(<span class="hljs-string">"webpack"</span>);

<span class="hljs-comment">// 获取主配置</span>
webpackConfig = <span class="hljs-built_in">require</span>(<span class="hljs-string">`../webpack/build/webpack.prod.js`</span>)(&#123;
  ...appConfig,
&#125;);

<span class="hljs-keyword">const</span> buildStamp = <span class="hljs-built_in">Date</span>.now();

<span class="hljs-comment">// 直接调用 webpack</span>
webpack(webpackConfig, <span class="hljs-keyword">async</span> (err, stats) => &#123;
  <span class="hljs-keyword">if</span> (err || stats.hasErrors()) &#123;
    <span class="hljs-keyword">if</span> (err) &#123;
      <span class="hljs-built_in">console</span>.error(red(err.stack || err));
      err.details && <span class="hljs-built_in">console</span>.error(red(err.details));
      <span class="hljs-keyword">return</span>;
    &#125;

    stats.hasErrors() && <span class="hljs-built_in">console</span>.error(stats.toString(&#123; <span class="hljs-attr">colors</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">chunks</span>: <span class="hljs-literal">false</span> &#125;));

    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"\n> 构建异常 \n"</span>);
  &#125; <span class="hljs-keyword">else</span> &#123;
    isInfo && <span class="hljs-built_in">console</span>.warn(stats.toString(&#123; <span class="hljs-attr">colors</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">chunks</span>: <span class="hljs-literal">false</span> &#125;));

    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`\n> 构建完成，耗时 <span class="hljs-subst">$&#123;<span class="hljs-built_in">Date</span>.now() - buildStamp&#125;</span> ms`</span>);
  &#125;
&#125;);
<span class="copy-code-btn">复制代码</span></code></pre>
<ol start="4">
<li>分析包依赖，进一步优化模板</li>
</ol>
<blockquote>
<p>基于生产构建环节，增加了 <code>webpack-bundle-analyzer</code> 分析包依赖的操作</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1a204dec50c14fc688b25977b7f86a12~tplv-k3u1fbpfcp-watermark.image" alt="analysis.png" loading="lazy" referrerpolicy="no-referrer"></p>
<ol start="5">
<li>交互命令行实现初始化项目</li>
</ol>
<blockquote>
<p>这里需要用到 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Finquirer" target="_blank" rel="nofollow noopener noreferrer" title="https://www.npmjs.com/package/inquirer" ref="nofollow noopener noreferrer">inquirer</a> 这个包，专门提供命令行交互的工具</p>
</blockquote>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-meta">#!/usr/bin/env node</span>

<span class="hljs-keyword">const</span> &#123; join &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
<span class="hljs-comment">// 交互命令行工具</span>
<span class="hljs-keyword">const</span> &#123; prompt &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">'inquirer'</span>);
<span class="hljs-keyword">const</span> chalk = <span class="hljs-built_in">require</span>(<span class="hljs-string">'chalk'</span>);
<span class="hljs-keyword">const</span> &#123; exec &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">'child_process'</span>);

<span class="hljs-keyword">const</span> &#123; copyFolder &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../webpack/utils/file'</span>);

<span class="hljs-keyword">const</span> developPath = process.cwd();
<span class="hljs-keyword">const</span> iwrPath = join(__dirname, <span class="hljs-string">'..'</span>);
<span class="hljs-keyword">const</span> templatePathPrefix = <span class="hljs-string">'template'</span>;

<span class="hljs-comment">// 1. 自定义选项</span>
prompt([
  &#123;
    <span class="hljs-attr">type</span>: <span class="hljs-string">'input'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'name'</span>,
    <span class="hljs-attr">message</span>: <span class="hljs-string">'项目名称(英文)：'</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-string">'water-ui'</span>,
  &#125;,
  &#123;
    <span class="hljs-attr">type</span>: <span class="hljs-string">'input'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'description'</span>,
    <span class="hljs-attr">message</span>: <span class="hljs-string">'项目描述：'</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-string">'react 项目'</span>,
  &#125;,
  &#123;
    <span class="hljs-attr">type</span>: <span class="hljs-string">'input'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'version'</span>,
    <span class="hljs-attr">message</span>: <span class="hljs-string">'项目初始版本：'</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-string">'1.0.0'</span>,
  &#125;,
  &#123;
    <span class="hljs-attr">type</span>: <span class="hljs-string">'input'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'author'</span>,
    <span class="hljs-attr">message</span>: <span class="hljs-string">'作者：'</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-string">'iwr'</span>,
  &#125;,
  &#123;
    <span class="hljs-attr">type</span>: <span class="hljs-string">'input'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'port'</span>,
    <span class="hljs-attr">message</span>: <span class="hljs-string">'启动端口'</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-string">'8001'</span>,
  &#125;,
  &#123;
    <span class="hljs-attr">type</span>: <span class="hljs-string">'confirm'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'typescript'</span>,
    <span class="hljs-attr">message</span>: <span class="hljs-string">'使用 Typescript：'</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-string">'Y'</span>,
  &#125;,
])
  .then(<span class="hljs-function"><span class="hljs-params">options</span> =></span> &#123;
    <span class="hljs-keyword">const</span> &#123; name, typescript &#125; = options;

    <span class="hljs-keyword">const</span> templateName = <span class="hljs-string">`react<span class="hljs-subst">$&#123;typescript ? <span class="hljs-string">'-ts'</span> : <span class="hljs-string">''</span>&#125;</span>`</span>;
    <span class="hljs-keyword">const</span> templatePath = join(iwrPath, templatePathPrefix, templateName);
    <span class="hljs-keyword">const</span> toPath = join(developPath, name);

    <span class="hljs-comment">// 2. 复制项目模板，并替换自定义内容</span>
    copyFolder(templatePath, toPath, options);
    <span class="hljs-built_in">console</span>.log(chalk.green(<span class="hljs-string">'> '</span>) + <span class="hljs-string">'初始化完成'</span>);

    <span class="hljs-comment">// 3. 执行 npm i 脚本</span>
    exec(<span class="hljs-string">`cd <span class="hljs-subst">$&#123;name&#125;</span> && npm i`</span>, <span class="hljs-function">(<span class="hljs-params">err, stdout, stderr</span>) =></span> &#123;
      <span class="hljs-keyword">if</span> (err || stderr) &#123;
        <span class="hljs-built_in">console</span>.log(err, stderr);
        process.exit(-<span class="hljs-number">1</span>);
      &#125; <span class="hljs-keyword">else</span> &#123;
        <span class="hljs-built_in">console</span>.log(stdout);
      &#125;
    &#125;);
  &#125;)
  .catch(<span class="hljs-function"><span class="hljs-params">error</span> =></span> &#123;
    <span class="hljs-keyword">if</span> (error.isTtyError) &#123;
      <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'当前环境暂不支持'</span>);
      <span class="hljs-comment">// Prompt couldn't be rendered in the current environment</span>
    &#125; <span class="hljs-keyword">else</span> &#123;
      <span class="hljs-comment">// Something else when wrong</span>
      <span class="hljs-built_in">console</span>.error(error);
    &#125;
  &#125;);
<span class="copy-code-btn">复制代码</span></code></pre>
<blockquote>
<p>以上其实可以有更多发挥和扩展空间，看项目需要，代码在这里，@<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fhowieyi%2Fwater-react" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/howieyi/water-react" ref="nofollow noopener noreferrer">water-react</a></p>
</blockquote>
<ol start="6">
<li>发布到 npm</li>
</ol>
<pre><code class="hljs language-bash copyable" lang="bash"><span class="hljs-comment"># 1. 需要先到 https://www.npmjs.com/ 注册一个所属账号</span>
<span class="hljs-comment"># 2. 设置仓库到 npm，推荐用 nrm 工具管理仓库</span>
$ npm <span class="hljs-built_in">set</span> registry https://registry.npmjs.org/

<span class="hljs-comment"># 3. 使用注册的账号 登录到 npm</span>
$ npm login

<span class="hljs-comment"># 4. 到项目根目录直接 publish</span>
$ npm publish
<span class="copy-code-btn">复制代码</span></code></pre>
<ol start="7">
<li>发布完成后即可在 npm 官网查看到你所发布的包，比如我发布的包 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fiwr" target="_blank" rel="nofollow noopener noreferrer" title="https://www.npmjs.com/package/iwr" ref="nofollow noopener noreferrer">iwr</a></li>
</ol>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/85ec9948311b4e6b8ca6b23061b5d8e4~tplv-k3u1fbpfcp-watermark.image" alt="iwr.png" loading="lazy" referrerpolicy="no-referrer"></p>
<ol start="8">
<li>全局安装使用</li>
</ol>
<pre><code class="hljs language-bash copyable" lang="bash"><span class="hljs-comment"># 全局安装命令行工具</span>
$ npm i -g iwr

<span class="hljs-comment"># 文件权限不够时可能会安装异常，使用以下命令即可</span>
$ sudo npm install -g --production --unsafe-perm=<span class="hljs-literal">true</span> --allow-root iwr
<span class="copy-code-btn">复制代码</span></code></pre>
<ol start="9">
<li>尝试一把初始化</li>
</ol>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a1489a67a7934fb4a47ca7d2685c653d~tplv-k3u1fbpfcp-watermark.image" alt="iwr-create.png" loading="lazy" referrerpolicy="no-referrer"></p>
<blockquote>
<p>哈哈哈，几秒钟完成项目初始化，终于可以躺平了，代码在这里，@<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fhowieyi%2Fwater-react" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/howieyi/water-react" ref="nofollow noopener noreferrer">water-react</a></p>
</blockquote>
<h3 data-id="heading-4">给 cli 升个级，门面还是要撑的</h3>
<ol>
<li>酷炫的开场</li>
</ol>
<blockquote>
<p><code>figlet</code> 和 <code>@darkobits/lolcatjs</code> 实现炫酷自定义开场，哈哈哈，装x利器，代码在这里，@<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fhowieyi%2Fwater-react" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/howieyi/water-react" ref="nofollow noopener noreferrer">water-react</a></p>
</blockquote>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3296413572444f77bd8cf01bd92dfb50~tplv-k3u1fbpfcp-watermark.image" alt="iwr-version.png" loading="lazy" referrerpolicy="no-referrer"></p>
<ol start="2">
<li>changelog 什么的该有的还是得有</li>
</ol>
<pre><code class="hljs language-markdown copyable" lang="markdown"><span class="hljs-section">## v1.0.3</span>

<span class="hljs-bullet">-</span> 调整模板，统一采用 scss 来编写样式

<span class="hljs-section">## v1.0.2</span>

<span class="hljs-bullet">-</span> 修改初始化默认作者名称

<span class="hljs-section">## v1.0.1</span>

<span class="hljs-bullet">-</span> 完善 readme，发布到 npm

<span class="hljs-section">## v1.0.0</span>

<span class="hljs-bullet">-</span> 集成 cli 工具 <span class="hljs-code">`iwr`</span>，主要为实现 <span class="hljs-code">`react 项目`</span> 的构建;
<span class="copy-code-btn">复制代码</span></code></pre>
<ol start="3">
<li>
<p>readme 写写好，总得让别人用的明明白白的，<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fhowieyi%2Fwater-react%2Fblob%2Fv1.0.1%2FREADME.md" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/howieyi/water-react/blob/v1.0.1/README.md" ref="nofollow noopener noreferrer">范例</a></p>
</li>
<li>
<p>接入 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fdownload-git-repo" target="_blank" rel="nofollow noopener noreferrer" title="https://www.npmjs.com/package/download-git-repo" ref="nofollow noopener noreferrer">download-git-repo</a> 以仓库方式替换本地模板方式，更加方便维护模板代码</p>
</li>
<li>
<p>接入 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fora" target="_blank" rel="nofollow noopener noreferrer" title="https://www.npmjs.com/package/ora" ref="nofollow noopener noreferrer">ora</a> 增加脚本执行缓冲，命令行加个异步等待 loading，上档次</p>
</li>
</ol>
<p><img src="https://juejin.cn/post/ora.svg" alt loading="lazy" referrerpolicy="no-referrer"></p></div>  
</div>
            