
---
title: '什么是事件驱动架构'
categories: 
 - 编程
 - 掘金
 - 标签
headimg: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9aa2e13f027b47de8d3d76ab6f9c8269~tplv-k3u1fbpfcp-zoom-1.image'
author: 掘金
comments: false
date: Sat, 10 Jul 2021 23:45:22 GMT
thumbnail: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9aa2e13f027b47de8d3d76ab6f9c8269~tplv-k3u1fbpfcp-zoom-1.image'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><p>进入<a href="https://link.juejin.cn/?target=https%3A%2F%2Fpostcard.lilpilot.co%2Fposts%2F%25E4%25BB%2580%25E4%25B9%2588%25E6%2598%25AF%25E4%25BA%258B%25E4%25BB%25B6%25E9%25A9%25B1%25E5%258A%25A8%25E6%259E%25B6%25E6%259E%2584%2F" target="_blank" rel="nofollow noopener noreferrer" title="https://postcard.lilpilot.co/posts/%E4%BB%80%E4%B9%88%E6%98%AF%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8%E6%9E%B6%E6%9E%84/" ref="nofollow noopener noreferrer">我的网站</a>获得最佳阅读体验</p>
<hr>
<blockquote>
<p>Event-driven architecture (EDA) is a software architecture paradigm promoting the production, detection, consumption of, and reaction to events. - Wikipedia</p>
</blockquote>
<p>什么是事件驱动架构？</p>
<p>按 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FEvent-driven_architecture" target="_blank" rel="nofollow noopener noreferrer" title="https://en.wikipedia.org/wiki/Event-driven_architecture" ref="nofollow noopener noreferrer">维基百科的定义</a>，事件驱动架构（EDA）是一种软件架构范式，促进事件的产生、观测、消费和反应。</p>
<p>在认识事件驱动架构之前，先来明确一下，什么是事件。</p>
<p>事件是已经发生的事实，并且不可变。例如，“创建订单”是个指令，而“订单已创建”就是个事件，订单的信息、订单创建的时间，在这个事件发生后就无法被修改。</p>
<p>在传统的架构体系下，编程思维可以说是过程驱动的，一个指令触发了一段逻辑，这其中可能包含了几个不同的方法行为，它们之间按照过程顺序来编排、嵌套。看起来似乎很清晰，但是很容易写出长长的“面条”代码。而事件驱动架构则强调了事件的产生与消费，将逻辑的过程转换为事件之间的环环相扣。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9aa2e13f027b47de8d3d76ab6f9c8269~tplv-k3u1fbpfcp-zoom-1.image" alt="事件驱动架构。png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>就如上图所展示的，如果采用事件驱动架构，订单服务就只负责订单的创建，然后发出“订单已创建”的事件，交由 EventBus 路由，转发给关心这个事件的各个监听者。</p>
<p>在我的开发经历中，也有采用事件驱动架构的项目，接下来，就结合自身经验，总结一下 EDA 的优缺点和其适用场景。</p>
<h2 data-id="heading-0">EDA 的优点</h2>
<h3 data-id="heading-1">解耦</h3>
<p>首先，解耦是事件驱动架构所带来的最明显的优点。从上述的例子中就可以看出，采用了 EDA 后，订单服务只需要负责处理对应的业务逻辑，而其他的切面逻辑，例如操作记录、发短信等，都可以通过事件的通知机制来解耦，从而保证业务逻辑的简洁、专注。并且，这些切面功能点可以考虑使用异步处理，也能很好地提升系统的响应能力。</p>
<h3 data-id="heading-2">DDD 与事件风暴</h3>
<p>在领域驱动设计（DDD）中，如果采用 <a href="https://link.juejin.cn/?target=http%3A%2F%2Fzhangyi.xyz%2Fevent-storming-distill%2F" target="_blank" rel="nofollow noopener noreferrer" title="http://zhangyi.xyz/event-storming-distill/" ref="nofollow noopener noreferrer">以“领域事件”为核心的建模思路</a>，与业务人员通过事件风暴的形式来梳理业务流程，就会得到一系列的事件列表，也就是事件驱动架构中的所有事件。从业务人员到开发人员，从真实业务逻辑到系统设计实现，都以这些事件为核心，就能够形成统一语言，方便沟通和理解。</p>
<h3 data-id="heading-3">事件溯源</h3>
<p>事件上存储了必要的信息和时间，如果将所有的事件持久化，结合最初的实体信息，你就拥有了一台来去自如的时光机。例如在一个资产管理系统中，存储了“资产已入池”、“资产归属已变更”、“资产已出池”等所有的事件，并且存储了资产初始化时的快照数据，就可以根据快照数据和给定时间范围内的事件列表，重新计算出某个时间的资产数据，这就是事件溯源。如果整个生命周期中事件量很大，可以考虑定期给实体做快照，溯源时获取最近的一份快照数据。事件溯源能给业务提供更灵活的数据支撑，同时，因为存储了所有的事件数据，也保障了系统的故障恢复能力和数据一致性。</p>
<h2 data-id="heading-4">EDA 的缺点</h2>
<h3 data-id="heading-5">系统复杂度</h3>
<p>“在软件工程中，没有一个中间层解决不了的问题”，事件驱动架构，就是通过引入中间层 EventBus 来实现事件机制，看似能带来不少诱人的优点，也必然会增加系统的复杂度。Spring 虽然有提供事件机制，但是比较简单，如果有复杂的使用场景，得考虑自己实现。</p>
<p>事件驱动架构改变了编程思维，一切都围绕事件的发布和订阅，将完整的功能过程，拆解为了不同的事件，也丧失了过程驱动带来的叙事能力。如果事件数量众多，就容易在“事件丛林”中迷了路。</p>
<h2 data-id="heading-6">使用场景</h2>
<p>软件工程没有银弹，事件驱动架构也有其适用的场景，结合上述优缺点，个人认为，以下几个方向可以考虑采用 EDA：</p>
<ul>
<li>组件解耦（消息推送、操作记录等）</li>
<li>数据沉淀系统（审计、资产等）</li>
</ul>
<p>常规的业务逻辑里，如果有一些切面组件，例如消息、操作记录，可以接入轻量的 EDA 来解耦，保证业务逻辑清晰和职责的单一；而在数据沉淀系统中，例如审计、资产等领域，通常没有特别复杂、长链路的业务逻辑，由业务系统来触发更新数据，更关注的是数据的准确性、一致性，就可以考虑使用 EDA 和事件溯源机制。</p></div>  
</div>
            