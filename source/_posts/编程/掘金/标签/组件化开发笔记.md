
---
title: '组件化开发笔记'
categories: 
 - 编程
 - 掘金
 - 标签
headimg: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ef508791e21146d49b3a330438b1fdd8~tplv-k3u1fbpfcp-watermark.image'
author: 掘金
comments: false
date: Thu, 19 Aug 2021 18:26:49 GMT
thumbnail: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ef508791e21146d49b3a330438b1fdd8~tplv-k3u1fbpfcp-watermark.image'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><h1 data-id="heading-0">Modularization</h1>
<h2 data-id="heading-1">什么是组件化</h2>
<p>组件化就是将一个app拆分成不同的组件，每一个组件都是一个独立的module。</p>
<h2 data-id="heading-2">组件化的意义</h2>
<p><strong>组件化能降低耦合性，而耦合性低就能提高维护性。</strong></p>
<p>于此同时由于组件间是独立的，所以组件与组件间耦合性低，所以我们在团队开发的时候可以以组件为分割单位，这样就能<strong>提高开发效率。</strong></p>
<h2 data-id="heading-3">如何进行组件化</h2>
<p>组件化是依靠gradle实现的。所以不会gradle的得去学学基础语法。当然也可以不学，只是说看别人写的代码看的半懂不懂的。</p>
<h3 data-id="heading-4">第一步创建Module</h3>
<p>起点是一个全新的Project</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ef508791e21146d49b3a330438b1fdd8~tplv-k3u1fbpfcp-watermark.image" alt="image-20210818192909793" loading="lazy" referrerpolicy="no-referrer"></p>
<p>创建Module有好几种方法。</p>
<ul>
<li>
<p>右击new Module</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/39551abd6eef41349d0e9c0067f77041~tplv-k3u1fbpfcp-watermark.image" alt="image-20210818193028977" loading="lazy" referrerpolicy="no-referrer"></p>
<p>这个得注意位置哦，不然new出来全在app包下不是很好，通常我们的module是和app平级的。也就是说在大project下面。</p>
<p>在我的这个demo中就是Modularization下面</p>
</li>
<li>
<p>点击File new一个Module</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/55ed010337d44cdba0535344532c7a7f~tplv-k3u1fbpfcp-watermark.image" alt="image-20210818193107528" loading="lazy" referrerpolicy="no-referrer"></p>
</li>
</ul>
<p>这里我创建了3个module，一个lib</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/85f987034b1a4972a4008ad553bca64a~tplv-k3u1fbpfcp-watermark.image" alt="image-20210818193618429" loading="lazy" referrerpolicy="no-referrer"></p>
<p>注意命名，module是module_模块名，lib是lib__库名称.</p>
<p>简单区分以下module和lib，lib就是不显示页面的模块，module就是一个页面模块的集合。</p>
<h3 data-id="heading-5">将版本信息配置到一个gradle文件中</h3>
<pre><code class="hljs language-groovy copyable" lang="groovy"><span class="hljs-attr">Tips:</span>
    <span class="hljs-attr">fileName :</span>app_versions.gradle

<span class="hljs-comment">//applicationIds</span>
<span class="hljs-keyword">def</span> appIds = [:]
appIds.module_main = <span class="hljs-string">"com.example.module_main"</span>
appIds.module_one = <span class="hljs-string">"com.example.module_one"</span>
appIds.module_two = <span class="hljs-string">"com.example.module_two"</span>
appIds.app = <span class="hljs-string">"com.example.modularization"</span>
ext.appIds = appIds
<span class="copy-code-btn">复制代码</span></code></pre>
<p>将该gradle文件配置到project的build.gradle中</p>
<pre><code class="hljs language-groovy copyable" lang="groovy"><span class="hljs-comment">// Top-level build file where you can add configuration options common to all sub-projects/modules.</span>
buildscript &#123;
    apply <span class="hljs-attr">from:</span> <span class="hljs-string">'app_versions.gradle'</span>
    ext&#123;
        app_configs = <span class="hljs-string">"$rootDir/app_config.gradle"</span>
    &#125;
    repositories &#123;
        google()
        mavenCentral()
    &#125;
    dependencies &#123;
        classpath <span class="hljs-string">"com.android.tools.build:gradle:7.0.0"</span>
        classpath <span class="hljs-string">"org.jetbrains.kotlin:kotlin-gradle-plugin:1.5.20"</span>

        <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> Do not place your application dependencies here; they belong</span>
        <span class="hljs-comment">// in the individual module build.gradle files</span>
    &#125;
&#125;

task clean(<span class="hljs-attr">type:</span> Delete) &#123;
    delete rootProject.buildDir
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<h3 data-id="heading-6">配置gradle的编译插件</h3>
<p>先在gradle.properties，加入一个变量判断是否是发行状态</p>
<p>组件化中有两种状态，一种是debug状态，一个是发行状态，</p>
<ul>
<li>debug状态也就是开发阶段，这个阶段每一个模块都是一个独立的app，可以独立运行</li>
<li>release发行状态，这个状态下只有app模块可以独立运行，其他的模块都是lib，依托于app模块。</li>
</ul>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/233297fb4b9042d9b649d2ae68960863~tplv-k3u1fbpfcp-watermark.image" alt="image-20210818194002652" loading="lazy" referrerpolicy="no-referrer"></p>
<p>然后创建了一个app_config.gradle文件</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/93d633c1eaab4489bacd20fd8aceb8ea~tplv-k3u1fbpfcp-watermark.image" alt="image-20210818194518257" loading="lazy" referrerpolicy="no-referrer"></p>
<p>编写代码使得module_XX能在lib和app中切换状态。</p>
<p>这里有一点需要注意我们在gradle.propergies虽然写了一个isRelease的bool变量但是其实gradle这里获取的是一个string，得用toBoolean()进行转化。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3d224d136d9c4f639b2123408faca07e~tplv-k3u1fbpfcp-watermark.image" alt="image-20210818194838453" loading="lazy" referrerpolicy="no-referrer"></p>
<pre><code class="hljs language-groovy copyable" lang="groovy"><span class="hljs-keyword">if</span> (isRelease.toBoolean())&#123;
    <span class="hljs-keyword">if</span> (project.name != <span class="hljs-string">'app'</span>)  apply <span class="hljs-attr">plugin:</span> <span class="hljs-string">'com.android.library'</span>
    <span class="hljs-keyword">else</span> apply <span class="hljs-attr">plugin:</span> <span class="hljs-string">'com.andorid.application'</span>
&#125;
<span class="hljs-keyword">else</span>&#123;
    <span class="hljs-keyword">if</span> (project.name.matches(<span class="hljs-string">'module_.+'</span>) || project.name == <span class="hljs-string">'app'</span>) apply <span class="hljs-attr">plugin:</span> <span class="hljs-string">'com.android.application'</span>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (project.name.matches(<span class="hljs-string">'lib_.+'</span>)) apply <span class="hljs-attr">plugin:</span> <span class="hljs-string">'com.android.library'</span>
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>然后加入必要的依赖</p>
<pre><code class="hljs language-groovy copyable" lang="groovy">apply <span class="hljs-attr">plugin:</span> <span class="hljs-string">'kotlin-android'</span>
apply <span class="hljs-attr">plugin:</span> <span class="hljs-string">'kotlin-kapt'</span>
<span class="copy-code-btn">复制代码</span></code></pre>
<h3 data-id="heading-7">配置Manifest文件</h3>
<pre><code class="hljs language-groovy copyable" lang="groovy">android&#123;
`````

sourceSets&#123;
    main&#123;
        <span class="hljs-keyword">if</span> (isRelease.toBoolean())&#123;
            manifest.srcFile <span class="hljs-string">"src/main/AndroidManifest.xml"</span>
        &#125;<span class="hljs-keyword">else</span> &#123;
            <span class="hljs-keyword">if</span> (project.name.matches(<span class="hljs-string">'module_.+'</span>))&#123;
                manifest.srcFile <span class="hljs-string">"src/main/manifest/AndroidManifest.xml"</span>
            &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (project.name.matches(<span class="hljs-string">'lib_.+'</span>) || project.name == <span class="hljs-string">'app'</span>)&#123;
                manifest.srcFile <span class="hljs-string">"src/main/AndroidManifest.xml"</span>
            &#125;
        &#125;
    &#125;
&#125;


`````
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>然后对module的manifest文件进行一点变动</p>
<p>在main文件夹下创建manifest文件夹，然后把debug状态的manifest的文件放进去。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/622503414ef24a2ebe68ba8bc74347a4~tplv-k3u1fbpfcp-watermark.image" alt="image-20210818200716961" loading="lazy" referrerpolicy="no-referrer"></p>
<p>debug状态下的文件(这个状态下编译的文件是apk所以需要配置启动页和一些application的选项)</p>
<pre><code class="hljs language-xml copyable" lang="xml"><span class="hljs-meta"><?xml version="1.0" encoding="utf-8"?></span>
<span class="hljs-tag"><<span class="hljs-name">manifest</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span>
    <span class="hljs-attr">package</span>=<span class="hljs-string">"com.example.module_main"</span>></span>

    <span class="hljs-tag"><<span class="hljs-name">application</span>
        <span class="hljs-attr">android:allowBackup</span>=<span class="hljs-string">"true"</span>
        <span class="hljs-attr">android:icon</span>=<span class="hljs-string">"@mipmap/ic_launcher"</span>
        <span class="hljs-attr">android:label</span>=<span class="hljs-string">"@string/app_name"</span>
        <span class="hljs-attr">android:roundIcon</span>=<span class="hljs-string">"@mipmap/ic_launcher_round"</span>
        <span class="hljs-attr">android:supportsRtl</span>=<span class="hljs-string">"true"</span>
        <span class="hljs-attr">android:theme</span>=<span class="hljs-string">"@style/Theme.Modularization"</span>></span>
        <span class="hljs-tag"><<span class="hljs-name">activity</span>
            <span class="hljs-attr">android:name</span>=<span class="hljs-string">".MainMainActivity"</span>
            <span class="hljs-attr">android:exported</span>=<span class="hljs-string">"true"</span>></span>
            <span class="hljs-tag"><<span class="hljs-name">intent-filter</span>></span>
                <span class="hljs-tag"><<span class="hljs-name">action</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.intent.action.MAIN"</span> /></span>

                <span class="hljs-tag"><<span class="hljs-name">category</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.intent.category.LAUNCHER"</span> /></span>
            <span class="hljs-tag"></<span class="hljs-name">intent-filter</span>></span>
        <span class="hljs-tag"></<span class="hljs-name">activity</span>></span>
    <span class="hljs-tag"></<span class="hljs-name">application</span>></span>

<span class="hljs-tag"></<span class="hljs-name">manifest</span>></span>
<span class="copy-code-btn">复制代码</span></code></pre>
<p>release状态下的manifest文件(这个状态下的编译文件是aar文件所以只需要注册一个activity，其余的都不需要)</p>
<pre><code class="hljs language-xml copyable" lang="xml"><span class="hljs-meta"><?xml version="1.0" encoding="utf-8"?></span>
<span class="hljs-tag"><<span class="hljs-name">manifest</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span>
    <span class="hljs-attr">package</span>=<span class="hljs-string">"com.example.module_main"</span>></span>

    <span class="hljs-tag"><<span class="hljs-name">application</span>></span>
        <span class="hljs-tag"><<span class="hljs-name">activity</span>
            <span class="hljs-attr">android:name</span>=<span class="hljs-string">".MainMainActivity"</span>
            <span class="hljs-attr">android:exported</span>=<span class="hljs-string">"true"</span> /></span>
    <span class="hljs-tag"></<span class="hljs-name">application</span>></span>

<span class="hljs-tag"></<span class="hljs-name">manifest</span>></span>
<span class="copy-code-btn">复制代码</span></code></pre>
<p>其余的module_XX，模块也是按照这样改。</p>
<h3 data-id="heading-8">配置applicationId</h3>
<p>由于application才有applicationId，所以lib是没有applicationId的，而module在application和module之间疯狂切换，说以是有必要进行设置的。</p>
<pre><code class="hljs language-groovy copyable" lang="groovy"><span class="hljs-keyword">if</span> (isRelease.toBoolean()) &#123;
    applicationId <span class="hljs-string">"com.example.modularization"</span>
&#125;<span class="hljs-keyword">else</span> &#123;
    <span class="hljs-keyword">if</span> (project.name.matches(<span class="hljs-string">'module_.+'</span>) || project.name == <span class="hljs-string">'app'</span>) &#123;
        applicationId appIds[project.name]
    &#125;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>之后在project的build.gradle中加点变量方便其gradle文件访问app_config.gradle文件（注意要加等号‘=’）</p>
<pre><code class="hljs language-groovy copyable" lang="groovy">buildscript &#123;
    ext&#123;
        app_config = <span class="hljs-string">"$rootDir/app_config.gradle"</span>
    &#125;
    repositories &#123;
        google()
        mavenCentral()
    &#125;
    dependencies &#123;
        classpath <span class="hljs-string">"com.android.tools.build:gradle:7.0.0"</span>
        classpath <span class="hljs-string">"org.jetbrains.kotlin:kotlin-gradle-plugin:1.5.20"</span>

        <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> Do not place your application dependencies here; they belong</span>
        <span class="hljs-comment">// in the individual module build.gradle files</span>
    &#125;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<h3 data-id="heading-9">module引用app_config.gradle</h3>
<p>之前</p>
<pre><code class="hljs language-groovy copyable" lang="groovy">plugins &#123;
    id <span class="hljs-string">'com.android.application'</span>
    id <span class="hljs-string">'kotlin-android'</span>
&#125;

android &#123;
    compileSdk <span class="hljs-number">30</span>

    defaultConfig &#123;
        applicationId <span class="hljs-string">"com.example.module_main"</span>
        minSdk <span class="hljs-number">21</span>
        targetSdk <span class="hljs-number">30</span>
        versionCode <span class="hljs-number">1</span>
        versionName <span class="hljs-string">"1.0"</span>

        testInstrumentationRunner <span class="hljs-string">"androidx.test.runner.AndroidJUnitRunner"</span>
    &#125;

    buildTypes &#123;
        release &#123;
            minifyEnabled <span class="hljs-literal">false</span>
            proguardFiles getDefaultProguardFile(<span class="hljs-string">'proguard-android-optimize.txt'</span>), <span class="hljs-string">'proguard-rules.pro'</span>
        &#125;
    &#125;
    compileOptions &#123;
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    &#125;
    kotlinOptions &#123;
        jvmTarget = <span class="hljs-string">'1.8'</span>
    &#125;
&#125;

dependencies &#123;

    implementation <span class="hljs-string">'androidx.core:core-ktx:1.3.2'</span>
    implementation <span class="hljs-string">'androidx.appcompat:appcompat:1.2.0'</span>
    implementation <span class="hljs-string">'com.google.android.material:material:1.3.0'</span>
    implementation <span class="hljs-string">'androidx.constraintlayout:constraintlayout:2.0.4'</span>
    testImplementation <span class="hljs-string">'junit:junit:4.+'</span>
    androidTestImplementation <span class="hljs-string">'androidx.test.ext:junit:1.1.2'</span>
    androidTestImplementation <span class="hljs-string">'androidx.test.espresso:espresso-core:3.3.0'</span>
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>之后</p>
<pre><code class="hljs language-groovy copyable" lang="groovy">apply <span class="hljs-attr">from:</span> app_configs

dependencies &#123;

    implementation <span class="hljs-string">'androidx.core:core-ktx:1.3.2'</span>
    implementation <span class="hljs-string">'androidx.appcompat:appcompat:1.2.0'</span>
    implementation <span class="hljs-string">'com.google.android.material:material:1.3.0'</span>
    implementation <span class="hljs-string">'androidx.constraintlayout:constraintlayout:2.0.4'</span>
    testImplementation <span class="hljs-string">'junit:junit:4.+'</span>
    androidTestImplementation <span class="hljs-string">'androidx.test.ext:junit:1.1.2'</span>
    androidTestImplementation <span class="hljs-string">'androidx.test.espresso:espresso-core:3.3.0'</span>
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>其余的lib和module都是这样</p>
<h3 data-id="heading-10">把android闭包下的一些属性进行抽离</h3>
<pre><code class="hljs language-groovy copyable" lang="groovy">
<span class="hljs-keyword">def</span> android_versions = [:]
android_versions.sdk_version = <span class="hljs-number">30</span>
android_versions.min_version = <span class="hljs-number">21</span>
android_versions.target_version = <span class="hljs-number">30</span>
android_versions.version_code = <span class="hljs-number">1</span>
android_versions.version_name = <span class="hljs-string">"1.0"</span>

<span class="hljs-keyword">def</span> kotlin_options = [:]
kotlin_options.jvm_target = <span class="hljs-string">'1.8'</span>
android_versions.kotlin_options = kotlin_options

ext.android_versions = android_versions
<span class="copy-code-btn">复制代码</span></code></pre>
<p>app_config.gradle的内容</p>
<pre><code class="hljs language-groovy copyable" lang="groovy"><span class="hljs-keyword">if</span> (isRelease.toBoolean())&#123;
    <span class="hljs-keyword">if</span> (project.name != <span class="hljs-string">'app'</span>)  apply <span class="hljs-attr">plugin:</span> <span class="hljs-string">'com.android.library'</span>
    <span class="hljs-keyword">else</span> apply <span class="hljs-attr">plugin:</span> <span class="hljs-string">'com.andorid.application'</span>
&#125;
<span class="hljs-keyword">else</span>&#123;
    <span class="hljs-keyword">if</span> (project.name.matches(<span class="hljs-string">'module_.+'</span>) || project.name == <span class="hljs-string">'app'</span>) apply <span class="hljs-attr">plugin:</span> <span class="hljs-string">'com.android.application'</span>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (project.name.matches(<span class="hljs-string">'lib_.+'</span>)) apply <span class="hljs-attr">plugin:</span> <span class="hljs-string">'com.android.library'</span>
&#125;

apply <span class="hljs-attr">plugin:</span> <span class="hljs-string">'kotlin-android'</span>
apply <span class="hljs-attr">plugin:</span> <span class="hljs-string">'kotlin-kapt'</span>

android &#123;
    compileSdk android_versions.sdk_version

    defaultConfig &#123;
        <span class="hljs-keyword">if</span> (isRelease.toBoolean()) &#123;
            applicationId <span class="hljs-string">"com.example.modularization"</span>
        &#125;<span class="hljs-keyword">else</span> &#123;
            <span class="hljs-keyword">if</span> (project.name.matches(<span class="hljs-string">'module_.+'</span>) || project.name == <span class="hljs-string">'app'</span>) &#123;
                applicationId appIds[project.name]
            &#125;
        &#125;

        minSdk android_versions.min_version
        targetSdk android_versions.target_version
        versionCode android_versions.version_code
        versionName android_versions.version_name

        testInstrumentationRunner <span class="hljs-string">"androidx.test.runner.AndroidJUnitRunner"</span>
    &#125;

    sourceSets&#123;
        main&#123;
            <span class="hljs-keyword">if</span> (isRelease.toBoolean())&#123;
                manifest.srcFile <span class="hljs-string">"src/main/AndroidManifest.xml"</span>
            &#125;<span class="hljs-keyword">else</span> &#123;
                <span class="hljs-keyword">if</span> (project.name.matches(<span class="hljs-string">'module_.+'</span>))&#123;
                    manifest.srcFile <span class="hljs-string">"src/main/manifest/AndroidManifest.xml"</span>
                &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (project.name.matches(<span class="hljs-string">'lib_.+'</span>) || project.name == <span class="hljs-string">'app'</span>)&#123;
                    manifest.srcFile <span class="hljs-string">"src/main/AndroidManifest.xml"</span>
                &#125;
            &#125;
        &#125;
    &#125;

    buildTypes &#123;
        release &#123;
            minifyEnabled <span class="hljs-literal">false</span>
            proguardFiles getDefaultProguardFile(<span class="hljs-string">'proguard-android-optimize.txt'</span>), <span class="hljs-string">'proguard-rules.pro'</span>
        &#125;
    &#125;
    compileOptions &#123;
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    &#125;
    kotlinOptions &#123;
        jvmTarget = android_versions.kotlin_options.jvm_target
    &#125;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre></div>  
</div>
            