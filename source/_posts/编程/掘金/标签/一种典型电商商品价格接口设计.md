
---
title: '一种典型电商商品价格接口设计'
categories: 
 - 编程
 - 掘金
 - 标签
headimg: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b9945eac8a3c4f1c85d4129051b8c572~tplv-k3u1fbpfcp-watermark.image'
author: 掘金
comments: false
date: Sat, 27 Mar 2021 08:08:34 GMT
thumbnail: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b9945eac8a3c4f1c85d4129051b8c572~tplv-k3u1fbpfcp-watermark.image'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><pre><code class="copyable">theme: fancy
highlight: github.css
<span class="copy-code-btn">复制代码</span></code></pre>
<p>在得到一个业务系统需求后，在开发服务接口之前，我们会有一步是对其做领域模型分析，<strong>提炼出该业务系统涉及的各种实的或需的领域对象，并识别它们之间的关系</strong>。对某些业务系统来说，完成这些领域对象的CRUD操作及它们之间关系的组合变化，就能支撑大部分的业务需求。</p>
<p>我们在概要设计的时候，如何做接口设计，如何能做到接口结构清晰， 根据RESTful的规范返回需要呈现的资源结构，并且把某些业务行为或者资源屏蔽细节不对外暴露。</p>
<h3 data-id="heading-0">电商商品价格</h3>
<h4 data-id="heading-1">需求：针对不一样场景有不一样的定价策略选择</h4>
<ul>
<li>
<p>会员需要支持会员级别折扣率（管理员可根据实际业务给会员角色绑定折扣率）</p>
</li>
<li>
<p>对于客户和门店来说，需要支持等级价格，意思是一个每一个最小订货商品里面有固定的多个价格（暂定10个），然后客户需要需要指定某个等级的价格，而且某个租户下面可以设置开启那些等级价格，我们系统有10个商品等级，用户可以设置1-10这个范围</p>
</li>
<li>
<p>需要设计针对某个账户的单独定价</p>
</li>
<li>
<p>需要门店可以选择按基准供应价来订货，其实就是一个统一价格</p>
</li>
<li>
<p>调价单（特殊需求）</p>
</li>
</ul>
<h4 data-id="heading-2">数据库模型</h4>
<p>最终呈现如下的数据库模型：</p>
<ul>
<li>t_customer_level_price 客户等级价格 </li>
<li>t_price_level 价格等级 </li>
<li>t_member_discount 会员基本折扣率 </li>
<li>t_member_level_price 会员价格 </li>
<li>t_customer_single_price 客户单独定价 </li>
<li>t_supplier_price 基准供应价 </li>
<li>t_pricing_relation 等级价格和客户的关联关系，还有定价模式</li>
</ul>
<p><img alt class="lazyload" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b9945eac8a3c4f1c85d4129051b8c572~tplv-k3u1fbpfcp-watermark.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<h4 data-id="heading-3">根据数据库设计呈现出来的接口</h4>
<p><img alt class="lazyload" src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f61219a430a849369d73ab18918e86fa~tplv-k3u1fbpfcp-watermark.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<p><img alt class="lazyload" src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0bc58497a8cf4abcbacdaeee01055212~tplv-k3u1fbpfcp-watermark.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<p>问题总结</p>
<ol>
<li>
<p>首先我们价格模型需要抽象一下。说到底价格体系就是一个定价记录，这个定价记录里面有两个很重要的信息，一个是被定价的商品，一个是<strong>作用于谁</strong>？至于商品我们就不需要再去抽象了，但是这里的商品要是具体到某个可订货商品（sku-id + multi-id）;作用于谁这里的谁，我们可以统一用target来描述，那可能有人会问，需求上面的是固定某个策略只是用某个定价策略，例如折扣率这种只会在会员使用，其实这才是问题，我们大可不必限定折扣和会员绑定上关系</p>
</li>
<li>
<p>我们理清楚定价模式和具体定价模式的关系，在需求上面只要需要新增门店和客户的时候需要选择定价模式来确定门店或者客户使用的是基准供应价还是等级定价，但是领域模型上来说，<strong>定价模式更加应该控制目标的定价模式</strong>，所以定价模式不应该只是控制门店和客户，并且也能选择四种策略的其中一种，并不是其中一种</p>
</li>
<li>
<p>不能把定价策略和等级价格的映射两个不同模型放在一个数据库表上面去。这样导致<strong>职责不单一</strong>（这里有一个问题，就是我们的基准供应价是不是要放在商品基础价格上面） 综述：我们一共支持4中定价模式：分别是基准供应定价、等级价格匹配（商品有固定的若干个价格，客户对用某个价格）、目标（目标可能是客户、会员、或者门店）等级折扣率、目标单独定价，而我们有一个定价模式去决定该目标的定价策略</p>
</li>
</ol>
<h4 data-id="heading-4">设计步骤</h4>
<ol>
<li><strong>根据数据模型梳理关键资源</strong></li>
</ol>
<p><img alt class="lazyload" src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ed1ca473536749fc8905b2ae7fd03ce6~tplv-k3u1fbpfcp-watermark.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<p>2.<strong>梳理资源关系图</strong></p>
<p><img alt class="lazyload" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8ab65b3cb9ee4b3ab51d0d963de7abf1~tplv-k3u1fbpfcp-watermark.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<p><strong>3.定义名词</strong></p>
<p><img alt class="lazyload" src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fb5a42ed32e749ecad04862077a034d4~tplv-k3u1fbpfcp-watermark.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<p><strong>4.设计接口</strong></p>
<p><strong>组织（管理）维度：</strong></p>
<p><img alt class="lazyload" src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/efa2a3bc4802427d8ed5f149dd5472d5~tplv-k3u1fbpfcp-watermark.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<p><strong>定价目标维度：（type是一个枚举值：*</strong>*organization、organization-grade、member、member-grade）**</p>
<p><img alt class="lazyload" src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7ef2d53cbbf8483fa013c196a02eb31a~tplv-k3u1fbpfcp-watermark.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<p><strong>单位商品维度：</strong></p>
<p><img alt class="lazyload" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/058e34b8988245d98b0025eedde3d49b~tplv-k3u1fbpfcp-watermark.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p></div> <div class="image-viewer-box" data-v-78c9b824><!----></div>  
</div>
            