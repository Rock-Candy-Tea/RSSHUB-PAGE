
---
title: '前端模块化开发'
categories: 
 - 编程
 - 掘金
 - 分类
headimg: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/196545d78d3845dbbe235baaba1138da~tplv-k3u1fbpfcp-zoom-1.image'
author: 掘金
comments: false
date: Wed, 12 May 2021 22:02:00 GMT
thumbnail: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/196545d78d3845dbbe235baaba1138da~tplv-k3u1fbpfcp-zoom-1.image'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><h1 data-id="heading-0">历史</h1>
<h2 data-id="heading-1">模块化</h2>
<blockquote>
<p>只是一个思想或者是一个理论，并不包含具体的实现</p>
</blockquote>
<h2 data-id="heading-2">内容概述</h2>
<ol>
<li>模块化演变过程</li>
<li>模块化规范</li>
<li>常用的模块化打包工具</li>
<li>基于模块化工具构建现代Web应用</li>
<li>打包工具的优化技巧</li>
</ol>
<h3 data-id="heading-3">1. 模块化演变过程</h3>
<blockquote>
<p>早期的前端技术标准根本没有预料到前端行业会有今天这样的规模中，所以说很多设计上的遗留问题就导致了我们现在去实现前端模块化的时候会遇到很多的问题。</p>
</blockquote>
<ul>
<li>Stage 1 - 文件划分方式(<strong>每个功能和具体的数据单独存放到不同的文件当中，约定每一个文件就是独立的模块</strong>) -> 早期模块化完全依靠约定
<ul>
<li>污染全局作用域</li>
<li>命名冲突问题</li>
<li>无法管理模块依赖关系</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-html copyable" lang="html"><span class="hljs-tag"><<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"module-a.js"</span>></span><span class="hljs-tag"></<span class="hljs-name">script</span>></span>
<span class="hljs-tag"><<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"module-b.js"</span>></span><span class="hljs-tag"></<span class="hljs-name">script</span>></span>
<span class="hljs-tag"><<span class="hljs-name">script</span>></span><span class="javascript">
<span class="hljs-comment">// 命名冲突</span>
method1()
<span class="hljs-comment">// 模块成员可以被修改</span>
name = <span class="hljs-string">'foo'</span>
</span><span class="hljs-tag"></<span class="hljs-name">script</span>></span>
<span class="copy-code-btn">复制代码</span></code></pre>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">// module-a.js</span>
<span class="hljs-keyword">var</span> name = <span class="hljs-string">'module-a'</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">method1</span>(<span class="hljs-params"></span>) </span>&#123;
    <span class="hljs-built_in">console</span>.log(name + <span class="hljs-string">'#method1'</span>)
&#125;

<span class="hljs-comment">// module-b.js</span>
<span class="hljs-keyword">var</span> name = <span class="hljs-string">'module-b'</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">method1</span>(<span class="hljs-params"></span>) </span>&#123;
    <span class="hljs-built_in">console</span>.log(name + <span class="hljs-string">'#method1'</span>)
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<ul>
<li>Stage 2 - 命名空间方式</li>
</ul>
<blockquote>
<p>每个模块只暴露一个全局对象出来，我们所有的模块成员都挂载到这个对象上面</p>
</blockquote>
<pre><code class="hljs language-html copyable" lang="html"><span class="hljs-tag"><<span class="hljs-name">script</span>></span><span class="javascript">
moduleA.method1()
moduleA.method2()
<span class="hljs-comment">// 模块成员可以被修改</span>
moduleA.name = <span class="hljs-string">'foo'</span>
</span><span class="hljs-tag"></<span class="hljs-name">script</span>></span>
<span class="copy-code-btn">复制代码</span></code></pre>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-keyword">var</span> moduleA = &#123;
    <span class="hljs-attr">name</span>: <span class="hljs-string">'module-a'</span>,
    <span class="hljs-attr">method1</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;
        <span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">this</span>.name + <span class="hljs-string">'#method1'</span>)
    &#125;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<ul>
<li>Stage 3 - IIFE（立即调用函数表达式）</li>
</ul>
<blockquote>
<p>我们使用立即执行函数这种方式去为我们的模块提供私有空间</p>
</blockquote>
<pre><code class="hljs language-javascript copyable" lang="javascript">;(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;
    <span class="hljs-keyword">var</span> name = <span class="hljs-string">'module-a'</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">method1</span>(<span class="hljs-params"></span>) </span>&#123;
        <span class="hljs-built_in">console</span>.log(name + <span class="hljs-string">'#method1'</span>)
    &#125;
    <span class="hljs-comment">// 需要暴露给外部的成员可以通过挂载到全局对象上</span>
    <span class="hljs-built_in">window</span>.moduleA = &#123;
        method1
    &#125;
&#125;)()
<span class="copy-code-btn">复制代码</span></code></pre>
<p><strong>以上是 早期在没有工具和规范的情况下对模块化的落地方式</strong></p>
<h3 data-id="heading-4">2. 模块化规范的出现</h3>
<blockquote>
<p>由于加载不同模块依然使用的是script标签引入,模块的加载并不受我们代码的控制</p>
</blockquote>
<ul>
<li>我们需要模块化标准 + 模块加载器</li>
<li><code>CommonJS</code> 规范 - <code>Nodejs</code> 当中所提出来的一套标准，是以同步模式加载模块（在启动时加载模块，执行过程中不加载）；浏览器使用 <code>CommonJS</code> 必然导致效率低下（每次浏览器加载都导致大师的同步请求出现）
<ul>
<li>一个文件就是一个模块</li>
<li>每个模块都有单独的作用域</li>
<li>通过 <code>module.exports</code> 导出成员</li>
<li>通过 <code>require</code> 函数载入模块</li>
</ul>
</li>
<li><code>AMD (Asynchronous Module Definition)</code> （浏览器端）异步的模块定义规范 -> 出名的库叫做 <code>Require.js</code>
<ul>
<li><code>AMD</code> 使用起来相对复杂</li>
<li>模块 JS 文件请求频繁</li>
</ul>
</li>
</ul>
<p><strong>这个AMD 它只能算是前端模块化演进道路上的一步，它是一种妥协的一种方式，并不是最终的解决方案，只不过呢在当时的那样一个环境背景下，它还是非常有意义的，因为它毕竟给了前端模块化提供了一个标准，除此之外同期出现的还有淘宝推出的叫 Sea.js + CMD</strong></p>
<p><strong>目前绝大多数第三方库都支持AMD规范</strong></p>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">// 定义一个模块</span>
define(<span class="hljs-string">'module1'</span>, [<span class="hljs-string">'jquery'</span>, <span class="hljs-string">'./module2'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$, module2</span>) </span>&#123;
    <span class="hljs-keyword">return</span> &#123;
        <span class="hljs-attr">start</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;
            $(<span class="hljs-string">'body'</span>).animate(&#123; <span class="hljs-attr">margin</span>: <span class="hljs-string">'200px'</span> &#125;)
            module2()
        &#125;
    &#125;
&#125;
<span class="hljs-comment">// 具体代码参见</span>
<span class="hljs-comment">// modular-evolution/stage-5</span>

<span class="hljs-comment">// 载入一个模块</span>
<span class="hljs-built_in">require</span>([<span class="hljs-string">'./module1'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">module1</span>) </span>&#123;
    module1.start()
&#125;)
<span class="copy-code-btn">复制代码</span></code></pre>
<ul>
<li><code>Sea.js</code> + <code>CMD</code> 标准是 CMD</li>
</ul>
<blockquote>
<p>当时的想法是 尽可能的把CMD的代码和 CommonJS 类似，从而减轻开发者的学习压力</p>
</blockquote>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">// CMD 规范 （类似 CommonJS 规范）</span>
define(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"><span class="hljs-built_in">require</span>, <span class="hljs-built_in">exports</span>, <span class="hljs-built_in">module</span></span>) </span>&#123;
<span class="hljs-comment">// 通过 require 引入依赖</span>
<span class="hljs-keyword">var</span> $ = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jquery'</span>)
<span class="hljs-comment">// 通过 exports 或者 module.exports 对外暴露成员</span>
<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'module 2~'</span>);
    $(<span class="hljs-string">'body'</span>).append(<span class="hljs-string">'<p>module2</p>'</span>)
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p><strong>在浏览器环境中使用 ES Modules；在 Node当中使用 CommonJS</strong></p>
<p>ESModules 是在 ECMAScript 2015(ES6) 当中的最新的模块系统</p>
<h2 data-id="heading-5">ESModules</h2>
<h2 data-id="heading-6">1. ES Modules 特性</h2>
<ul>
<li><code>ESM</code> 自动采用严格模式，忽略 'use strict'</li>
<li>每个 <code>ESM</code> 都是运行在单独的私有作用域中</li>
<li><code>ESM</code> 是通过 <code>CORS</code> 的方式请求外部 <code>JS</code> 模块的</li>
<li><code>ESM</code> 的 <code>script</code> 标签会延迟执行脚本 类似 <code>defer</code></li>
</ul>
<pre><code class="hljs language-html copyable" lang="html"><span class="hljs-comment"><!-- 通过给 script 添加 type = module 的属性，就可以以 ES Module 的标准执行其中的 JS 代码 --></span>
<span class="hljs-tag"><<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span>></span><span class="javascript">
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'this is es module'</span>)
</span><span class="hljs-tag"></<span class="hljs-name">script</span>></span>

<span class="hljs-tag"><<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://unpkg.com/jquery@3.4.1/dist/jquery.min.js"</span>></span><span class="hljs-tag"></<span class="hljs-name">script</span>></span>
<span class="copy-code-btn">复制代码</span></code></pre>
<h2 data-id="heading-7">2. ES Modules 导出</h2>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">// </span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">var</span> name = <span class="hljs-string">'foo module'</span>

<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hello</span>(<span class="hljs-params"></span>) </span>&#123;
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'hello'</span>)
&#125;

<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> </span>&#123;&#125;

<span class="hljs-comment">// </span>
<span class="hljs-keyword">var</span> name = <span class="hljs-string">'foo module'</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hello</span> (<span class="hljs-params"></span>) </span>&#123;&#125;

<span class="hljs-comment">// </span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> name
<span class="hljs-comment">// 对应使用</span>
<span class="hljs-keyword">import</span> &#123; <span class="hljs-keyword">default</span> <span class="hljs-keyword">as</span> name &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">''</span>
<span class="hljs-comment">// or</span>
<span class="hljs-keyword">import</span> name <span class="hljs-keyword">from</span> <span class="hljs-string">''</span>
<span class="hljs-comment">//</span>

<span class="hljs-keyword">export</span> &#123;
    name <span class="hljs-keyword">as</span> fooName, <span class="hljs-comment">// 可以取其它名</span>
    hello <span class="hljs-keyword">as</span> fooHello
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<h3 data-id="heading-8">2.2 导入导出的注意事项</h3>
<ul>
<li><code>export</code> 导出的不是一个字面量对象</li>
<li><code>export</code> 实际上是把 <strong>引用关系</strong>给到了外部，且是<strong>只读</strong>的</li>
</ul>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-keyword">var</span> name = <span class="hljs-string">'jack'</span>
<span class="hljs-keyword">var</span> age = <span class="hljs-number">18</span>

<span class="hljs-comment">// 很多人误认为这里是一个字面量对象</span>
<span class="hljs-keyword">export</span> &#123; name, age &#125;
<span class="hljs-comment">// 这里是对字面量对象的解构</span>
<span class="hljs-keyword">import</span> &#123; name, age &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'xxx'</span>
<span class="hljs-comment">// 这其实是错误的</span>


<span class="hljs-comment">// 这是一个固定的用法</span>
<span class="hljs-keyword">export</span> &#123;&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<h2 data-id="heading-9">3. ES Modules 导入用法</h2>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">// module.js</span>
<span class="hljs-keyword">var</span> name = <span class="hljs-string">'jack'</span>
<span class="hljs-keyword">var</span> age = <span class="hljs-number">18</span>

<span class="hljs-keyword">export</span> &#123; name, age &#125;

<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'module action'</span>)

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-string">'default export'</span>


<span class="hljs-comment">// app.js</span>
<span class="hljs-comment">// import &#123; name &#125; from './module'</span>
<span class="hljs-comment">// import &#123; name &#125; from './module.js'</span>
<span class="hljs-comment">// console.log(name)</span>

<span class="hljs-comment">// import &#123; lowercase &#125; from './utils'</span>
<span class="hljs-comment">// import &#123; lowercase &#125; from './utils/index.js'</span>
<span class="hljs-comment">// console.log(lowercase('HHH'))</span>

<span class="hljs-comment">// import &#123; name &#125; from 'module.js'</span>
<span class="hljs-comment">// import &#123; name &#125; from './module.js'</span>
<span class="hljs-comment">// import &#123; name &#125; from '/04-import/module.js'</span>
<span class="hljs-comment">// import &#123; name &#125; from 'http://localhost:3000/04-import/module.js'</span>
<span class="hljs-comment">// console.log(name)</span>

<span class="hljs-comment">// --------------</span>

<span class="hljs-comment">// import &#123;&#125; from './module.js'</span>
<span class="hljs-comment">// import './module.js'</span>

<span class="hljs-comment">// ---------------</span>

<span class="hljs-comment">// import * as mod from './module.js'</span>
<span class="hljs-comment">// console.log(mod)</span>

<span class="hljs-comment">// ---------------</span>

<span class="hljs-comment">// var modulePath = './module.js'</span>
<span class="hljs-comment">// import &#123; name &#125; from modulePath</span>
<span class="hljs-comment">// console.log(name)</span>

<span class="hljs-comment">// if (true) &#123;</span>
<span class="hljs-comment">//   import &#123; name &#125; from './module.js'</span>
<span class="hljs-comment">// &#125;</span>

<span class="hljs-comment">// import('./module.js').then(function (module) &#123;</span>
<span class="hljs-comment">//   console.log(module)</span>
<span class="hljs-comment">// &#125;)</span>

<span class="hljs-comment">// ----------------</span>

<span class="hljs-comment">// import &#123; name, age, default as title &#125; from './module.js'</span>
<span class="hljs-keyword">import</span> abc, &#123; name, age &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'./module.js'</span>
<span class="hljs-built_in">console</span>.log(name, age, abc)

<span class="copy-code-btn">复制代码</span></code></pre>
<h3 data-id="heading-10">3.1 导出导入成员</h3>
<ul>
<li><strong>export &#123; foo, bar &#125; from './module.js'</strong></li>
</ul>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">// import &#123; Button &#125; from './button.js'</span>
<span class="hljs-comment">// import &#123; Avatar &#125; from './avatar.js'</span>

<span class="hljs-comment">// export &#123; Button, Avatar &#125;</span>

<span class="hljs-keyword">export</span> &#123; <span class="hljs-keyword">default</span> <span class="hljs-keyword">as</span> Button &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'./button.js'</span>
<span class="hljs-keyword">export</span> &#123; Avatar &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'./avatar.js'</span>
<span class="copy-code-btn">复制代码</span></code></pre>
<h2 data-id="heading-11">4. 浏览器环境 Polyfill</h2>
<blockquote>
<p>以下是支持 IE 的</p>
</blockquote>
<pre><code class="hljs language-html copyable" lang="html"><span class="hljs-tag"><<span class="hljs-name">script</span> <span class="hljs-attr">nomodule</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://unpkg.com/promise-polyfill@8.1.3/dist/polyfill.min.js"</span>></span><span class="hljs-tag"></<span class="hljs-name">script</span>></span>
<span class="hljs-tag"><<span class="hljs-name">script</span> <span class="hljs-attr">nomodule</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://unpkg.com/browser-es-module-loader@0.4.1/dist/babel-browser-build.js"</span>></span><span class="hljs-tag"></<span class="hljs-name">script</span>></span>
<span class="hljs-tag"><<span class="hljs-name">script</span> <span class="hljs-attr">nomodule</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://unpkg.com/browser-es-module-loader@0.4.1/dist/browser-es-module-loader.js"</span>></span><span class="hljs-tag"></<span class="hljs-name">script</span>></span>
<span class="hljs-tag"><<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span>></span><span class="javascript">
<span class="hljs-keyword">import</span> &#123; foo &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'./module.js'</span>
<span class="hljs-built_in">console</span>.log(foo)
</span><span class="hljs-tag"></<span class="hljs-name">script</span>></span>
<span class="copy-code-btn">复制代码</span></code></pre>
<h2 data-id="heading-12">5. ES Modules 在Node 的支持情况</h2>
<blockquote>
<p>在nodejs当中要使用 ESM，有两步</p>
</blockquote>
<ul>
<li>将.js 更改为 .mjs</li>
<li>使用命令 <code>node --experimental-modules index.mjs</code></li>
</ul>
<p><strong>注意: 说明 import &#123;&#125; 可以导出系统内置的模块，官方做了兼容</strong></p>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">// index.mjs</span>
<span class="hljs-keyword">import</span> fs <span class="hljs-keyword">from</span> <span class="hljs-string">'fs'</span>
<span class="hljs-keyword">import</span> &#123; writeFileSync &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'fs'</span> 
<span class="hljs-comment">// 以上两种都可以</span>

<span class="hljs-keyword">import</span> _ <span class="hljs-keyword">from</span> <span class="hljs-string">'lodash'</span>
<span class="hljs-built_in">console</span>.log(_.camelCase(<span class="hljs-string">'ES Module'</span>))
<span class="hljs-comment">// 以上是可以的</span>
<span class="hljs-comment">// 但是下面的是不可以的</span>
<span class="hljs-keyword">import</span> &#123; camelCase &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'_'</span>
<span class="hljs-built_in">console</span>.log(camelCase(<span class="hljs-string">'ES Module'</span>))
<span class="copy-code-btn">复制代码</span></code></pre>
<h3 data-id="heading-13">5.2 在nodejs 当中使用 CommonJS</h3>
<ul>
<li><code>ES Modules</code> 中可以导入 <code>CommonJS</code> 模块</li>
<li><code>CommonJS</code> 中不能导入 <code>ES Modules</code> 模块</li>
<li><code>CommonJS</code> 始终只会导出一个默认成员</li>
<li>注意 <code>import</code> 不是解构导出对象</li>
</ul>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">// commonjs.js</span>
<span class="hljs-built_in">module</span>.exports = &#123;
    <span class="hljs-attr">foo</span>: <span class="hljs-string">'commonjs exports value'</span>
&#125;

<span class="hljs-comment">// es-module.mjs</span>
<span class="hljs-comment">// 注意 这里不能直接提取成员，注意 import 不是解构导出对象</span>
<span class="hljs-keyword">import</span> mod <span class="hljs-keyword">from</span> <span class="hljs-string">'./commonjs'</span>
<span class="hljs-comment">// node --experimental-modules es-module.mjs  </span>
<span class="hljs-comment">// 是有输出的</span>
<span class="copy-code-btn">复制代码</span></code></pre>
<h3 data-id="heading-14">5.3 ES Modules in Nodejs 与 CommonJS 的差异</h3>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">// cjs.js</span>
<span class="hljs-comment">// 加载模块函数</span>
<span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">require</span>)
<span class="hljs-comment">// 模块对象</span>
<span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">module</span>)
<span class="hljs-comment">// 导出对象别名</span>
<span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">exports</span>)
<span class="hljs-comment">// 当前文件的绝对路径</span>
<span class="hljs-built_in">console</span>.log(__filename)
<span class="hljs-comment">// 当前文件所在目录</span>
<span class="hljs-built_in">console</span>.log(__dirname)

<span class="hljs-comment">// esm.mjs</span>
<span class="hljs-comment">// ESM 中没有 CommonJS 中的那些模块全局成员了</span>
<span class="hljs-keyword">import</span> &#123; fileURLToPath &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'url'</span>
<span class="hljs-keyword">import</span> &#123; dirname &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>
<span class="hljs-keyword">const</span> __filename = fileURLToPath(<span class="hljs-keyword">import</span>.meta.url)
<span class="hljs-built_in">console</span>.log(__filename)
<span class="hljs-keyword">const</span> __dirname = dirname(__filename)
<span class="hljs-built_in">console</span>.log(__dirname)
<span class="copy-code-btn">复制代码</span></code></pre>
<h2 data-id="heading-15">5.4 Node 12.10.0版本中</h2>
<ul>
<li>在 <code>package.json</code> 中添加 <code>"type": "module"</code> - 这样就不用把后缀名更改为 <code>.mjs</code> 了</li>
<li>改了 <code>"type"</code> 之后 <code>CommonJS</code> 的文件需要改为 <code>.cjs</code></li>
</ul>
<h2 data-id="heading-16">5.5 Babel 兼容方案</h2>
<ul>
<li><code>yarn add @babel/node @babel/core @babel/preset-env -D</code></li>
</ul>
<p><a href="https://imgtu.com/i/c3y6sO" target="_blank" rel="nofollow noopener noreferrer"><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/196545d78d3845dbbe235baaba1138da~tplv-k3u1fbpfcp-zoom-1.image" alt="c3y6sO.png" loading="lazy" referrerpolicy="no-referrer"></a>
<a href="https://imgtu.com/i/c3yqeg" target="_blank" rel="nofollow noopener noreferrer"><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/00c397aa2dae460eabfc54aac5b78440~tplv-k3u1fbpfcp-zoom-1.image" alt="c3yqeg.png" loading="lazy" referrerpolicy="no-referrer"></a></p>
<p><strong>添加一个 .babelrc 文件</strong></p>
<pre><code class="hljs language-json copyable" lang="json">&#123;
    <span class="hljs-attr">"presets"</span>: [<span class="hljs-string">"@babel/preset-env"</span>]
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<ul>
<li>使用 <code>yarn babel-node index.js</code> 执行</li>
</ul>
<p><strong>注意 presets 是一组插件，这里我们也可以可以使用单个插件</strong></p>
<pre><code class="hljs language-json copyable" lang="json">&#123;
    <span class="hljs-attr">"plugins"</span>: [
        <span class="hljs-string">"@babel/plugin-transform-modules-commonjs"</span>
    ]
&#125;
<span class="copy-code-btn">复制代码</span></code></pre></div>  
</div>
            