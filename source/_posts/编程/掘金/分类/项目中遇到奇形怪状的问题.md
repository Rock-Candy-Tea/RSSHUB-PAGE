
---
title: '项目中遇到奇形怪状的问题'
categories: 
 - 编程
 - 掘金
 - 分类
headimg: 'https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c625c4147aa04a83b6cbc1609bd6b106~tplv-k3u1fbpfcp-watermark.image'
author: 掘金
comments: false
date: Fri, 13 Aug 2021 00:09:14 GMT
thumbnail: 'https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c625c4147aa04a83b6cbc1609bd6b106~tplv-k3u1fbpfcp-watermark.image'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><h1 data-id="heading-0">前言</h1>
<p>过往一些项目遇到的问题，总结一下</p>
<h1 data-id="heading-1">Vite</h1>
<p>安装官网命令，使用 yarn create vite 提示文件名、目录名或卷标语法不正确</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c625c4147aa04a83b6cbc1609bd6b106~tplv-k3u1fbpfcp-watermark.image" alt="83d090af3d0faca4b711f45ddf928fc.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>根据 Command 的提示，去到指定目录下，发现没有 create-vite 文件
查看命令目录和安装目录，两者位置不一致，则进行修改</p>
<pre><code class="hljs language-javascript copyable" lang="javascript">yarn <span class="hljs-built_in">global</span> bin <span class="hljs-comment">// 命令目录</span>
yarn <span class="hljs-built_in">global</span> dir <span class="hljs-comment">// 安装目录</span>
yarn config set <span class="hljs-built_in">global</span>-folder <span class="hljs-string">"D:\node\yarn\global"</span>
yarn config set cache-folder <span class="hljs-string">"D:\node\yarn\cache"</span>
<span class="copy-code-btn">复制代码</span></code></pre>
<h1 data-id="heading-2">Electron</h1>
<h2 data-id="heading-3">安装慢或失败，通过镜像解决</h2>
<pre><code class="copyable">npm config set registry https://registry.npm.taobao.org/
npm config set ELECTRON_MIRROR http://npm.taobao.org/mirrors/electron/
<span class="copy-code-btn">复制代码</span></code></pre>
<h2 data-id="heading-4">设置任务栏图标和系统图标</h2>
<p>开发环境默认用 electron 图标，打包后才是自己设置的图标，被坑了一个小时</p>
<h2 data-id="heading-5">fs.existsSync is not a function at getElectronPath</h2>
<p>页面无法直接 import、require electron 模块，需要从window环境获取：window.require('electron')</p>
<h2 data-id="heading-6">This dependency was not found: xxx\src\background.js in multi ./src/background.js</h2>
<p>background.ts 报错，tsconfig.json target 设置不对，可改为 esnext</p>
<h1 data-id="heading-7">Element ui</h1>
<h2 data-id="heading-8">el-tree 显示序号</h2>
<ul>
<li>描述：组件通过 solt 加上状态切换功能，如果使用组件序号，在切换状态的时候，会发现序号会不断递增</li>
<li>过程：组件序号不可信，需要另外定义序号</li>
</ul>
<pre><code class="hljs language-javascript copyable" lang="javascript"><el-tree :data=<span class="hljs-string">"listData"</span>>
    <span class="xml"><span class="hljs-tag"><<span class="hljs-name">div</span> <span class="hljs-attr">slot-scope</span>=<span class="hljs-string">"&#123; node, data &#125;"</span>></span>
        <span class="hljs-tag"><<span class="hljs-name">ul</span>></span>
            <span class="hljs-tag"><<span class="hljs-name">li</span>></span>&#123;&#123; getIndex(node) &#125;&#125;<span class="hljs-tag"></<span class="hljs-name">li</span>></span>
            <span class="hljs-tag"><<span class="hljs-name">li</span>></span>
                <span class="hljs-tag"><<span class="hljs-name">el-switch</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"enable"</span> @<span class="hljs-attr">change</span>=<span class="hljs-string">"changeSwitch(data)"</span>></span><span class="hljs-tag"></<span class="hljs-name">el-switch</span>></span>
            <span class="hljs-tag"></<span class="hljs-name">li</span>></span>
        <span class="hljs-tag"></<span class="hljs-name">ul</span>></span>
    <span class="hljs-tag"></<span class="hljs-name">div</span>></span></span>
</el-tree>

<span class="xml"><span class="hljs-tag"><<span class="hljs-name">script</span>></span>
    methods: &#123;
        /**
         * 给 node 新增属性，在点击 switch 用到
         * /
        getIndex(node) &#123;
            let num = listData[0].inx++;
            node.numInx = num;
            return num;
        &#125;,
        /**
         * 组件有点击事件，列表也会累加。假如 listDAta 有 10 条数据，序号为 1，点击 switch 后，序号变成 11，这时候就可以通过 data 的属性 numInx 来重置序号
         * /
        changeSwitch(data) &#123;
            listData[0].inx = data.numInx;
        &#125;
    &#125;
<span class="hljs-tag"></<span class="hljs-name">script</span>></span></span>
<span class="copy-code-btn">复制代码</span></code></pre>
<h1 data-id="heading-9">Git</h1>
<h2 data-id="heading-10">gitlab 与 github 配置不同的 ssh key</h2>
<p>第一步：正常生成 SSH Key</p>
<p>第二步：passphrase可以根据自己的需要设置，一路默认
<img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2f32c80d8f89425abd1f94946c75bf12~tplv-k3u1fbpfcp-watermark.image" alt="1628839447(1).png" loading="lazy" referrerpolicy="no-referrer">
第三步：默认只读取id_rsa，为了让SSH识别新的私钥，需将其添加到SSH agent中，在 .ssh 目录创建 config</p>
<p>第四步：配置如下</p>
<pre><code class="copyable">Host gitlab  
    HostName git.xxx.com 
    PreferredAuthentications publickey  
    IdentityFile ~/.ssh/id_rsa  

Host github.com  
    HostName github.com  
    PreferredAuthentications publickey  
    IdentityFile ~/.ssh/id_rsa_xxx  
<span class="copy-code-btn">复制代码</span></code></pre>
<p>第五步：验证</p>
<pre><code class="copyable">ssh -T git@github.com
ssh -T git@gitlab
<span class="copy-code-btn">复制代码</span></code></pre>
<h2 data-id="heading-11">拉取 github 项目，You've successfully authenticated, but GitHub does not provide shell access</h2>
<p>估计是配置问题，不用 https，改用 ssh 即可。下班啰，不管了，又不是不能用</p>
<h2 data-id="heading-12">git commit 后 git status 提示 nothing to commit, working tree clean</h2>
<p>把本地分支设成远程分支的跟踪分支：git branch -u origin/remoteBranch</p>
<h2 data-id="heading-13">打包“ERR_ELECTRON_BUILDER_CANNOT_EXECUTE”</h2>
<p>网络问题，可以把electron包下好放到缓存文件，把对应的版本
解压放到 C:\Users\Admin\AppData\Local\electron-builder\Cache 目录下</p>
<h2 data-id="heading-14">渲染进程中调用ipc与主进程通讯报错：__dirname is not defined</h2>
<p>默认是不允许调用node的原生插件，BrowserWindow webPreferences 设置 nodeIntegration: true</p>
<h2 data-id="heading-15">设置桌面端的缩放比</h2>
<p>1、通过 commandLine 固定缩放比为 1，假如页面是根据 1920 分辨率去设置 px，4k 屏幕会出问题，一定在页面渲染之前设置，否则不生效
app.commandLine.appendSwitch('high-dpi-support', 'true')
app.commandLine.appendSwitch('force-device-scale-factor', '1')
<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Felectron%2Felectron%2Fissues%2F10659" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/electron/electron/issues/10659" ref="nofollow noopener noreferrer">github.com/electron/el…</a>
<a href="https://link.juejin.cn/?target=https%3A%2F%2Fourcodeworld.com%2Farticles%2Fread%2F547%2Fhow-to-change-the-window-zoom-level-in-electron-framework" target="_blank" rel="nofollow noopener noreferrer" title="https://ourcodeworld.com/articles/read/547/how-to-change-the-window-zoom-level-in-electron-framework" ref="nofollow noopener noreferrer">ourcodeworld.com/articles/re…</a></p>
<p>2、页面是写死的，可以除以一个固定宽度
window.require('electron').webFrame.setZoomFactor(parseFloat(width / 1920))</p>
<p>3、页面渲染后，获取屏幕分辨率，重设缩放比
因为主进程无法监听页面是否渲染成功，所以渲染成功后，渲染进程进行事件触发，主进程响应则把屏幕分辨率发送到渲染进程，再用 setZoomFactor 进行设置缩放比</p>
<h1 data-id="heading-16">图片</h1>
<h2 data-id="heading-17">返回正确的地址，图片显示破图</h2>
<ul>
<li>描述：后端返回的图片地址在浏览器可以打开，但赋值给 img 后，无法显示</li>
<li>过程：在控制台中发现 img src 的地址异常，图片路径地址会拼接当前路由：<a href="https://link.juejin.cn/?target=http%3A%2F%2F172.0.0.1%3A8086%2Fxxx%2F172.0.0.1%2Fpublic%2Fpicture%2F82.jpeg" target="_blank" rel="nofollow noopener noreferrer" title="http://172.0.0.1:8086/xxx/172.0.0.1/public/picture/82.jpeg" ref="nofollow noopener noreferrer">http://172.0.0.1:8086/xxx/172.0.0.1/public/picture/82.jpeg</a></li>
<li>原因：后端返回的地址没有协议：172.0.0.1/public/picture/82.jpeg，浏览器打开会自动补充。vue.config.js assetsPublicPath 为 './'，把没有协议的地址当成相对路径进行拼接</li>
<li>解决：图片地址加上协议即可</li>
</ul>
<h2 data-id="heading-18">img 自动把 http 改为 https</h2>
<ul>
<li>描述：后端给 http:\xxxx 的图片链接，在本地可以正常使用；打包上传服务器后所有的 http 图片都自动变成 https:\xxx 的链接，导致图片全部不能访问，而且只是 chrome 会这样</li>
<li>原因：没找到，浏览器？Nginx 配置？忙得狗一样，不管了</li>
<li>解决：因为是比较小的图片，直接转 base64 完事</li>
</ul>
<h1 data-id="heading-19">数据库</h1>
<h2 data-id="heading-20">SQL 判断两个表的字段是否相等</h2>
<ul>
<li>描述：对两个表的字段做相等判断，无法得到正确结果</li>
<li>原因：两个表的字段类型不一致，值永远不等</li>
</ul>
<h1 data-id="heading-21">第三方插件</h1>
<h2 data-id="heading-22">vue-video-player 出现内存泄漏</h2>
<ul>
<li>描述：一个页面有十二路视频，并且可分页切换，一段时间后，浏览器崩溃</li>
<li>过程：在初步对代码进行排查后，使用浏览器控制台 Performance、Memory 发现大量的 video 节点没有回收，在 github issue 找到原因：<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsurmon-china%2Fvue-video-player%2Fissues%2F317" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/surmon-china/vue-video-player/issues/317" ref="nofollow noopener noreferrer">内存泄漏</a></li>
<li>原因：video.js 本身就存在这种问题，新版本的解决了，不过插件使用的是旧版本</li>
<li>解决：手动升级插件比较麻烦，改为新版 video.js</li>
</ul>
<h2 data-id="heading-23">vue-cropper 截取图片上传</h2>
<ul>
<li>描述：对大图截取 1000 * 1000 的大小，上传后无法显示完全，图片下部分显示透明空白</li>
<li>过程：查找文档、询问开发者，均无法解决，最后对打印出的参数进行一一对比后解决</li>
<li>原因：dataURL 转为 file 的时候，图片大小发生变化，生成的图片比原图还大，插件上传的是原图 size，</li>
<li>导致超出部分缺少</li>
<li>解决：重新把块的 size 赋值</li>
</ul>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-built_in">this</span>.$refs.uploader.uploader.fileList[<span class="hljs-number">0</span>].chunks[<span class="hljs-number">0</span>].endByte = modelView.size; 
<span class="copy-code-btn">复制代码</span></code></pre>
<h1 data-id="heading-24">总结</h1>
<p>写着写着就想摸鱼了，很多都记得不太清楚了，凭记忆写了一些，希望不会出错吧。</p></div>  
</div>
            