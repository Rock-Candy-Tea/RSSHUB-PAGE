
---
title: 'Promise è¢«ç©å‡º 48 ç§_èŠ±æ ·_ï¼Œæ·±åº¦è§£æ10ä¸ªå¸¸ç”¨æ¨¡å—'
categories: 
 - ç¼–ç¨‹
 - æ˜é‡‘
 - åˆ†ç±»
headimg: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a3f0aadad8dd4fedbaf9cff6dfd50e90~tplv-k3u1fbpfcp-watermark.image'
author: æ˜é‡‘
comments: false
date: Mon, 23 Aug 2021 17:37:20 GMT
thumbnail: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a3f0aadad8dd4fedbaf9cff6dfd50e90~tplv-k3u1fbpfcp-watermark.image'
---

<div>   
<div class="markdown-body html cache"><style>.markdown-body&#123;position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#282d36&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px;color:#2f845e&#125;.markdown-body h2&#123;font-size:24px;display:inline-block;font-weight:700;background:#2f845e;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(47,132,194,.2)&#125;.markdown-body h2:before&#123;content:" ";display:inline-block;width:8px&#125;.markdown-body h2:after&#123;content:" ";position:absolute;display:block;width:calc(100% - 40px);border-bottom:3px solid #2f845e&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%;box-shadow:6px 6px 6px #888&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75;border-top:6px solid #2f845e&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#262626;background:linear-gradient(180deg,rgba(66,185,131,.1),transparent)!important&#125;.markdown-body strong&#123;background-color:inherit;color:#2f845e&#125;.markdown-body em&#123;background-color:inherit;color:#949415&#125;.markdown-body a&#123;text-decoration:none;color:#2f8e54;border-bottom:1px solid #3f9e64&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#3f9e64&#125;.markdown-body a[class^=footnote]&#123;margin-left:4px&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:100%;max-width:100%;overflow:auto;border:2px solid #2f8e54&#125;.markdown-body thead&#123;background:#2f8e54;color:#fff;text-align:left;font-weight:700&#125;.markdown-body tr:nth-child(2n)&#123;background-color:rgba(153,255,188,.1)&#125;.markdown-body td,.markdown-body th&#123;width:100%;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;padding:1px 22px;margin:22px 0;border-left:6px solid #2f845e;background-color:rgba(66,185,131,.1);border-radius:4px&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body del&#123;color:#2f845e&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><blockquote>
<p>âš ï¸ æœ¬æ–‡ä¸ºæ˜é‡‘ç¤¾åŒºé¦–å‘ç­¾çº¦æ–‡ç« ï¼Œæœªè·æˆæƒç¦æ­¢è½¬è½½</p>
</blockquote>
<p>æœ€è¿‘ï¼Œé˜¿å®å“¥åœ¨æ¢³ç† <a href="https://link.juejin.cn/?target=https%3A%2F%2Fzh.wikipedia.org%2Fwiki%2F%25E5%2591%25BD%25E4%25BB%25A4%25E8%25A1%258C%25E7%2595%258C%25E9%259D%25A2" target="_blank" rel="nofollow noopener noreferrer" title="https://zh.wikipedia.org/wiki/%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%95%8C%E9%9D%A2" ref="nofollow noopener noreferrer">CLI</a>ï¼ˆCommand Line Interfaceï¼‰çš„ç›¸å…³å†…å®¹ï¼Œå°±å¯¹ä¼˜ç§€çš„ <a href="https://link.juejin.cn/?target=https%3A%2F%2Flerna.js.org%2F" target="_blank" rel="nofollow noopener noreferrer" title="https://lerna.js.org/" ref="nofollow noopener noreferrer">Lerna</a> äº§ç”Ÿäº†å…´è¶£ï¼Œäºæ˜¯å¼€å§‹ â€œå•ƒâ€ èµ·äº†å®ƒçš„æºç ã€‚åœ¨é˜…è¯»å¼€æºé¡¹ç›®æ—¶ï¼Œé˜¿å®å“¥ä¹ æƒ¯å…ˆé˜…è¯»é¡¹ç›®çš„ <strong>README.md</strong> æ–‡æ¡£å’Œ <strong>package.json</strong> æ–‡ä»¶ï¼Œè€Œåœ¨ <strong>package.json</strong> æ–‡ä»¶çš„ <strong>dependencies</strong> å­—æ®µä¸­ï¼Œé˜¿å®å“¥è§åˆ°äº†å¤šä¸ª <strong>p-</strong>* çš„ä¾èµ–åŒ…ï¼š</p>
<pre><code class="hljs language-json copyable" lang="json">&#123;
  <span class="hljs-attr">"name"</span>: <span class="hljs-string">"lerna-monorepo"</span>,
  <span class="hljs-attr">"version"</span>: <span class="hljs-string">"4.0.0-monorepo"</span>, 
  <span class="hljs-attr">"dependencies"</span>: &#123;
    <span class="hljs-attr">"p-map"</span>: <span class="hljs-string">"^4.0.0"</span>,
    <span class="hljs-attr">"p-map-series"</span>: <span class="hljs-string">"^2.1.0"</span>,
    <span class="hljs-attr">"p-pipe"</span>: <span class="hljs-string">"^3.1.0"</span>,
    <span class="hljs-attr">"p-queue"</span>: <span class="hljs-string">"^6.6.2"</span>,
    <span class="hljs-attr">"p-reduce"</span>: <span class="hljs-string">"^2.1.0"</span>,
    <span class="hljs-attr">"p-waterfall"</span>: <span class="hljs-string">"^2.1.1"</span>
  &#125;
&#125;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<blockquote>
<p>æç¤ºï¼šå¦‚æœä½ æƒ³çŸ¥é“é˜¿å®å“¥å¦‚ä½•é˜…è¯»å¼€æºé¡¹ç›®çš„è¯ï¼Œå¯ä»¥é˜…è¯» <a href="https://juejin.cn/post/6887689159918485511" target="_blank" title="https://juejin.cn/post/6887689159918485511">ä½¿ç”¨è¿™äº›æ€è·¯ä¸æŠ€å·§ï¼Œæˆ‘è¯»æ‡‚äº†å¤šä¸ªä¼˜ç§€çš„å¼€æºé¡¹ç›®</a> è¿™ç¯‡æ–‡ç« ã€‚</p>
</blockquote>
<p>ä¹‹åï¼Œé˜¿å®å“¥é¡ºè—¤æ‘¸ç“œæ‰¾åˆ°äº† <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fpromise-fun" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/promise-fun" ref="nofollow noopener noreferrer">promise-fun (3.5K)</a> è¿™ä¸ªé¡¹ç›®ã€‚è¯¥é¡¹ç›®çš„ä½œè€… <strong><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus" ref="nofollow noopener noreferrer">sindresorhus</a></strong> æ˜¯ä¸€ä¸ªå…¨èŒåšå¼€æºçš„å¤§ç‰›ï¼ŒGithub ä¸Šæ‹¥æœ‰ <strong>43.9K</strong> çš„å…³æ³¨è€…ã€‚åŒæ—¶ï¼Œä»–è¿˜ç»´æŠ¤äº†å¤šä¸ªä¼˜ç§€çš„å¼€æºé¡¹ç›®ï¼Œæ¯”å¦‚ <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fawesome" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/awesome" ref="nofollow noopener noreferrer">awesome (167K)</a>ã€<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fawesome-nodejs" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/awesome-nodejs" ref="nofollow noopener noreferrer">awesome-nodejs (42K)</a>ã€<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fgot" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/got" ref="nofollow noopener noreferrer">got (9.8K)</a>ã€<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fora" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/ora" ref="nofollow noopener noreferrer">ora (7.1K)</a> å’Œ <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fscreenfull.js" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/screenfull.js" ref="nofollow noopener noreferrer">screenfull.js (6.1K)</a> ç­‰é¡¹ç›®ã€‚</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a3f0aadad8dd4fedbaf9cff6dfd50e90~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>ï¼ˆå›¾ç‰‡æ¥æº â€”â€” <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%25EF%25BC%2589" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus%EF%BC%89" ref="nofollow noopener noreferrer">github.com/sindresorhuâ€¦</a></p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fpromise-fun" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/promise-fun" ref="nofollow noopener noreferrer">promise-fun</a> é¡¹ç›®æ”¶å½•äº† <strong><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus" ref="nofollow noopener noreferrer">sindresorhus</a></strong> å†™è¿‡çš„ <strong>48</strong> ä¸ªä¸ <a href="https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FPromise" target="_blank" rel="nofollow noopener noreferrer" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise" ref="nofollow noopener noreferrer">Promise</a> ç›¸å…³çš„æ¨¡å—ï¼Œæ¯”å¦‚å‰é¢è§åˆ°çš„ <strong><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-map" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-map" ref="nofollow noopener noreferrer">p-map</a></strong>ã€<strong><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-map-series" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-map-series" ref="nofollow noopener noreferrer">p-map-series</a></strong>ã€<strong><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-pipe" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-pipe" ref="nofollow noopener noreferrer">p-pipe</a></strong> å’Œ <strong><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-waterfall" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-waterfall" ref="nofollow noopener noreferrer">p-waterfall</a></strong> ç­‰æ¨¡å—ã€‚æœ¬æ–‡é˜¿å®å“¥å°†ç­›é€‰ä¸€äº›æ¯”è¾ƒå¸¸ç”¨çš„æ¨¡å—ï¼Œæ¥è¯¦ç»†åˆ†ææ¯ä¸ªæ¨¡å—çš„ç”¨æ³•å’Œå…·ä½“çš„ä»£ç å®ç°ã€‚</p>
<p>è¿™äº›æ¨¡å—æä¾›äº†å¾ˆå¤šæœ‰ç”¨çš„æ–¹æ³•ï¼Œåˆ©ç”¨è¿™äº›æ–¹æ³•ï¼Œå¯ä»¥å¸®æˆ‘ä»¬è§£å†³å·¥ä½œä¸­ä¸€äº›å¾ˆå¸¸è§çš„é—®é¢˜ï¼Œæ¯”å¦‚å®ç°å¹¶å‘æ§åˆ¶ã€å¼‚æ­¥ä»»åŠ¡å¤„ç†ç­‰ï¼Œç‰¹åˆ«æ˜¯å¤„ç†å¤šç§æ§åˆ¶æµï¼Œæ¯”å¦‚ <strong>series</strong>ã€<strong>waterfall</strong>ã€<strong>all</strong>ã€<strong>race</strong> å’Œ <strong>forever</strong> ç­‰ã€‚</p>
<p>æ˜å‹ä»¬ï¼Œå‡†å¤‡å¥½äº†æ²¡ï¼Ÿè®©æˆ‘ä»¬ä¸€èµ·å¼€å¯ <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fpromise-fun" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/promise-fun" ref="nofollow noopener noreferrer">promise-fun</a> é¡¹ç›®çš„ â€œæ¢ç§˜â€ ä¹‹æ—…ã€‚</p>
<h3 data-id="heading-0">åˆå§‹åŒ–ç¤ºä¾‹é¡¹ç›®</h3>
<p>åˆ›å»ºä¸€ä¸ªæ–°çš„ <strong>learn-promise-fun</strong> é¡¹ç›®ï¼Œç„¶ååœ¨è¯¥é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹ï¼Œæ‰§è¡Œ <code>npm init -y</code> å‘½ä»¤è¿›è¡Œé¡¹ç›®åˆå§‹åŒ–æ“ä½œã€‚å½“è¯¥å‘½ä»¤æˆåŠŸè¿è¡Œåï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹å°†ä¼šç”Ÿæˆ <strong>package.json</strong> æ–‡ä»¶ã€‚ç”±äº <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fpromise-fun" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/promise-fun" ref="nofollow noopener noreferrer">promise-fun</a> é¡¹ç›®ä¸­çš„å¾ˆå¤šæ¨¡å—ä½¿ç”¨äº† ES Moduleï¼Œä¸ºäº†ä¿è¯åç»­çš„ç¤ºä¾‹ä»£ç èƒ½å¤Ÿæ­£å¸¸è¿è¡Œï¼Œæˆ‘ä»¬éœ€è¦åœ¨ <strong>package.json</strong> æ–‡ä»¶ä¸­ï¼Œå¢åŠ  <strong>type</strong> å­—æ®µå¹¶è®¾ç½®å®ƒçš„å€¼ä¸º <strong>"module"</strong>ã€‚</p>
<p>ç”±äºé˜¿å®å“¥æœ¬åœ° <a href="https://link.juejin.cn/?target=https%3A%2F%2Fnodejs.org%2Fen%2F" target="_blank" rel="nofollow noopener noreferrer" title="https://nodejs.org/en/" ref="nofollow noopener noreferrer">Node.js</a> çš„ç‰ˆæœ¬æ˜¯ <strong>v12.16.2</strong>ï¼Œè¦è¿è¡Œ ES Module æ¨¡å—ï¼Œè¿˜è¦æ·»åŠ  <strong>--experimental-modules</strong> å‘½ä»¤è¡Œé€‰é¡¹ã€‚è€Œå¦‚æœä½ ä¸æƒ³çœ‹åˆ°è­¦å‘Šæ¶ˆæ¯ï¼Œè¿˜å¯ä»¥æ·»åŠ  <strong>--no-warnings</strong> å‘½ä»¤è¡Œé€‰é¡¹ã€‚æ­¤å¤–ï¼Œä¸ºäº†é¿å…æ¯æ¬¡è¿è¡Œç¤ºä¾‹ä»£ç æ—¶ï¼Œéƒ½éœ€è¦è¾“å…¥ä»¥ä¸Šå‘½ä»¤è¡Œé€‰é¡¹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ <strong>package.json</strong> çš„ <strong>scripts</strong> å­—æ®µä¸­å®šä¹‰ç›¸åº”çš„ <strong>npm script</strong> å‘½ä»¤ï¼Œå…·ä½“å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="hljs language-json copyable" lang="json">&#123;
  <span class="hljs-attr">"name"</span>: <span class="hljs-string">"learn-promise-fun"</span>,
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"module"</span>,
  <span class="hljs-attr">"scripts"</span>: &#123;
    <span class="hljs-attr">"pall"</span>: <span class="hljs-string">"node --experimental-modules ./p-all/p-all.test.js"</span>,
    <span class="hljs-attr">"pfilter"</span>: <span class="hljs-string">"node --experimental-modules ./p-filter/p-filter.test.js"</span>,
    <span class="hljs-attr">"pforever"</span>: <span class="hljs-string">"node --experimental-modules ./p-forever/p-forever.test.js"</span>,
    <span class="hljs-attr">"preduce"</span>: <span class="hljs-string">"node --experimental-modules ./p-reduce/p-reduce.test.js"</span>,
    ...
  &#125;,
&#125;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>åœ¨å®Œæˆé¡¹ç›®åˆå§‹åŒ–ä¹‹åï¼Œæˆ‘ä»¬å…ˆæ¥å›é¡¾ä¸€ä¸‹å¤§å®¶å¹³æ—¶ç”¨å¾—æ¯”è¾ƒå¤šçš„ <code>reduce</code>ã€<code>map</code> å’Œ <code>filter</code> æ•°ç»„æ–¹æ³•çš„ç‰¹ç‚¹ï¼š</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/db8a77d6eb8e40dc92861826659fc1ba~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<blockquote>
<p>æç¤ºï¼šä¸Šå›¾é€šè¿‡ğŸ‘‰  <strong><a href="https://link.juejin.cn/?target=https%3A%2F%2Fcarbon.now.sh%2F" target="_blank" rel="nofollow noopener noreferrer" title="https://carbon.now.sh/" ref="nofollow noopener noreferrer">carbon.now.sh/</a></strong> åœ¨çº¿ç½‘é¡µåˆ¶ä½œç”Ÿæˆã€‚</p>
</blockquote>
<p>ç›¸ä¿¡å¤§å®¶å¯¹å›¾ä¸­çš„ <strong><a href="https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FArray%2FReduce" target="_blank" rel="nofollow noopener noreferrer" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce" ref="nofollow noopener noreferrer">Array.prototype.reduce</a></strong> æ–¹æ³•ä¸ä¼šé™Œç”Ÿï¼Œè¯¥æ–¹æ³•ç”¨äºå¯¹æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ æ‰§è¡Œä¸€ä¸ª <strong>reducer</strong> å‡½æ•°ï¼Œå¹¶å°†ç»“æœæ±‡æ€»ä¸ºå•ä¸ªè¿”å›å€¼ã€‚å¯¹åº”çš„ä½¿ç”¨ç¤ºä¾‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-keyword">const</span> array1 = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>];
<span class="hljs-keyword">const</span> reducer = <span class="hljs-function">(<span class="hljs-params">accumulator, currentValue</span>) =></span> accumulator + currentValue;

<span class="hljs-comment">// 1 + 2 + 3 + 4</span>
<span class="hljs-built_in">console</span>.log(array1.reduce(reducer)); <span class="hljs-comment">// 10</span>
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>å…¶ä¸­ <strong>reducer</strong> å‡½æ•°æ¥æ”¶ 4 ä¸ªå‚æ•°ï¼š</p>
<ul>
<li>accï¼ˆAccumulatorï¼‰ï¼šç´¯è®¡å™¨</li>
<li>curï¼ˆCurrent Valueï¼‰ï¼š å½“å‰å€¼</li>
<li>idxï¼ˆCurrent Indexï¼‰ï¼šå½“å‰ç´¢å¼•</li>
<li>srcï¼ˆSource Arrayï¼‰ï¼š æºæ•°ç»„</li>
</ul>
<p>è€Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦ä»‹ç»çš„ <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-reduce" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-reduce" ref="nofollow noopener noreferrer">p-reduce</a> æ¨¡å—ï¼Œå°±æä¾›äº†è·Ÿ <strong><a href="https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FArray%2FReduce" target="_blank" rel="nofollow noopener noreferrer" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce" ref="nofollow noopener noreferrer">Array.prototype.reduce</a></strong> æ–¹æ³•ç±»ä¼¼çš„åŠŸèƒ½ã€‚</p>
<h3 data-id="heading-1"><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-reduce" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-reduce" ref="nofollow noopener noreferrer">p-reduce</a></h3>
<blockquote>
<p>Reduce a list of values using promises into a promise for a value</p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-reduce" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-reduce" ref="nofollow noopener noreferrer">github.com/sindresorhuâ€¦</a></p>
</blockquote>
<h4 data-id="heading-2">ä½¿ç”¨è¯´æ˜</h4>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-reduce" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-reduce" ref="nofollow noopener noreferrer">p-reduce</a> é€‚ç”¨äºéœ€è¦æ ¹æ®å¼‚æ­¥èµ„æºè®¡ç®—ç´¯åŠ å€¼çš„åœºæ™¯ã€‚è¯¥æ¨¡å—é»˜è®¤å¯¼å‡ºäº†ä¸€ä¸ª <strong>pReduce</strong> å‡½æ•°ï¼Œè¯¥å‡½æ•°çš„ç­¾åå¦‚ä¸‹ï¼š</p>
<blockquote>
<p><strong><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-reduce" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-reduce" ref="nofollow noopener noreferrer">pReduce(input, reducer, initialValue): Promise</a></strong></p>
</blockquote>
<ul>
<li><code>input: Iterable<Promise|any></code></li>
<li><code>reducer(previousValue, currentValue, index): Function</code></li>
<li><code>initialValue: unknown</code></li>
</ul>
<p>äº†è§£å®Œ <strong>pReduce</strong> å‡½æ•°çš„ç­¾åä¹‹åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¯¥å‡½æ•°å¦‚ä½•ä½¿ç”¨ã€‚</p>
<h4 data-id="heading-3">ä½¿ç”¨ç¤ºä¾‹</h4>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">// p-reduce/p-reduce.test.js</span>
<span class="hljs-keyword">import</span> delay <span class="hljs-keyword">from</span> <span class="hljs-string">"delay"</span>;
<span class="hljs-keyword">import</span> pReduce <span class="hljs-keyword">from</span> <span class="hljs-string">"p-reduce"</span>;

<span class="hljs-keyword">const</span> inputs = [<span class="hljs-built_in">Promise</span>.resolve(<span class="hljs-number">1</span>), delay(<span class="hljs-number">50</span>, &#123; <span class="hljs-attr">value</span>: <span class="hljs-number">6</span> &#125;), <span class="hljs-number">8</span>];

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">main</span>(<span class="hljs-params"></span>) </span>&#123;
  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> pReduce(inputs, <span class="hljs-keyword">async</span> (a, b) => a + b, <span class="hljs-number">0</span>);
  <span class="hljs-built_in">console</span>.dir(result); <span class="hljs-comment">// è¾“å‡ºç»“æœï¼š15</span>
&#125;

main();
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>åœ¨ä»¥ä¸Šç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å¯¼å…¥äº† <strong><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fdelay" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/delay" ref="nofollow noopener noreferrer">delay</a></strong> æ¨¡å—é»˜è®¤å¯¼å‡ºçš„ <code>delay</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¯ç”¨äºæŒ‰ç…§ç»™å®šçš„æ—¶é—´ï¼Œå»¶è¿Ÿä¸€ä¸ª Promise å¯¹è±¡ã€‚å³åœ¨ç»™å®šçš„æ—¶é—´ä¹‹åï¼ŒPromise çŠ¶æ€æ‰ä¼šå˜æˆ <strong>resolved</strong>ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ<strong><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fdelay" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/delay" ref="nofollow noopener noreferrer">delay</a></strong> æ¨¡å—å†…éƒ¨æ˜¯é€šè¿‡ <a href="https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FWindowOrWorkerGlobalScope%2FsetTimeout" target="_blank" rel="nofollow noopener noreferrer" title="https://developer.mozilla.org/zh-CN/docs/Web/API/WindowOrWorkerGlobalScope/setTimeout" ref="nofollow noopener noreferrer">setTimeout</a> API æ¥å®ç°å»¶è¿ŸåŠŸèƒ½çš„ã€‚ç¤ºä¾‹ä¸­ <code>delay(50, &#123; value: 6 &#125;)</code> è¡¨ç¤ºå»¶è¿Ÿ 50ms åï¼ŒPromise å¯¹è±¡çš„è¿”å›å€¼ä¸º <strong>6</strong>ã€‚è€Œåœ¨ <code>main</code> å‡½æ•°å†…éƒ¨ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† <code>pReduce</code> å‡½æ•°æ¥è®¡ç®— <code>inputs</code> æ•°ç»„å…ƒç´ çš„ç´¯åŠ å€¼ã€‚å½“ä»¥ä¸Šä»£ç æˆåŠŸè¿è¡Œä¹‹åï¼Œå‘½ä»¤è¡Œä¼šè¾“å‡º <strong>15</strong>ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ <code>pReduce</code> å‡½æ•°å†…éƒ¨æ˜¯å¦‚ä½•å®ç°çš„ã€‚</p>
<h4 data-id="heading-4">æºç åˆ†æ</h4>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">// https://github.com/sindresorhus/p-reduce/blob/main/index.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pReduce</span>(<span class="hljs-params">iterable, reducer, initialValue</span>) </span>&#123;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =></span> &#123;
    <span class="hljs-keyword">const</span> iterator = iterable[<span class="hljs-built_in">Symbol</span>.iterator](); <span class="hljs-comment">// è·å–è¿­ä»£å™¨</span>
    <span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>; <span class="hljs-comment">// ç´¢å¼•å€¼</span>

    <span class="hljs-keyword">const</span> next = <span class="hljs-keyword">async</span> (total) => &#123;
      <span class="hljs-keyword">const</span> element = iterator.next(); <span class="hljs-comment">// è·å–ä¸‹ä¸€é¡¹</span>

      <span class="hljs-keyword">if</span> (element.done) &#123; <span class="hljs-comment">// åˆ¤æ–­è¿­ä»£å™¨æ˜¯å¦è¿­ä»£å®Œæˆ</span>
        resolve(total);
        <span class="hljs-keyword">return</span>;
      &#125;

      <span class="hljs-keyword">try</span> &#123;
        <span class="hljs-keyword">const</span> [resolvedTotal, resolvedValue] = <span class="hljs-keyword">await</span> <span class="hljs-built_in">Promise</span>.all([
          total,
          element.value,
        ]);
        <span class="hljs-comment">// è¿­ä»£ä¸‹ä¸€é¡¹</span>
        <span class="hljs-comment">// reducer(previousValue, currentValue, index): Function</span>
        next(reducer(resolvedTotal, resolvedValue, index++));
      &#125; <span class="hljs-keyword">catch</span> (error) &#123;
        reject(error);
      &#125;
    &#125;;

    <span class="hljs-comment">// ä½¿ç”¨åˆå§‹å€¼ï¼Œå¼€å§‹è¿­ä»£</span>
    next(initialValue);
  &#125;);
&#125;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>åœ¨ä»¥ä¸Šä»£ç ä¸­ï¼Œæ ¸å¿ƒçš„æµç¨‹å°±æ˜¯é€šè¿‡è·å– <code>iterable</code> å¯¹è±¡å†…éƒ¨çš„è¿­ä»£å™¨ï¼Œæ¥ä¸æ–­åœ°è¿›è¡Œè¿­ä»£ã€‚æ­¤å¤–ï¼Œåœ¨ <code>pReduce</code> å‡½æ•°ä¸­ï¼Œä½¿ç”¨äº† <a href="https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FPromise%2Fall" target="_blank" rel="nofollow noopener noreferrer" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/all" ref="nofollow noopener noreferrer"><strong>Promise.all</strong></a> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª promise å¯¹è±¡ï¼Œå½“è¾“å…¥çš„æ‰€æœ‰ promise å¯¹è±¡çš„çŠ¶æ€éƒ½å˜æˆ <code>resolved</code> æ—¶ï¼Œè¿”å›çš„ promise å¯¹è±¡å°±ä¼šä»¥æ•°ç»„çš„å½¢å¼ï¼Œè¿”å›æ¯ä¸ª promise å¯¹è±¡ resolve åçš„ç»“æœã€‚å½“è¾“å…¥çš„ä»»ä½•ä¸€ä¸ª promise å¯¹è±¡çŠ¶æ€å˜æˆ <code>rejected</code> æ—¶ï¼Œåˆ™è¿”å›çš„ promise å¯¹è±¡ä¼š reject å¯¹åº”çš„é”™è¯¯ä¿¡æ¯ã€‚</p>
<p>ä¸è¿‡ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<a href="https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FPromise%2Fall" target="_blank" rel="nofollow noopener noreferrer" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/all" ref="nofollow noopener noreferrer"><strong>Promise.all</strong></a> æ–¹æ³•å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ï¼Œå…·ä½“çš„å…¼å®¹æ€§å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/622880e18e4149fcbb1fccff73634df6~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>ï¼ˆå›¾ç‰‡æ¥æº â€”â€” <a href="https://link.juejin.cn/?target=https%3A%2F%2Fcaniuse.com%2F%3Fsearch%3DPromise.all%25EF%25BC%2589" target="_blank" rel="nofollow noopener noreferrer" title="https://caniuse.com/?search=Promise.all%EF%BC%89" ref="nofollow noopener noreferrer">caniuse.com/?search=Proâ€¦</a></p>
<p>å¯èƒ½æœ‰ä¸€äº›å°ä¼™ä¼´å¯¹ <a href="https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FPromise%2Fall" target="_blank" rel="nofollow noopener noreferrer" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/all" ref="nofollow noopener noreferrer"><strong>Promise.all</strong></a> è¿˜ä¸ç†Ÿæ‚‰ï¼Œå®ƒåˆæ˜¯ä¸€é“æ¯”è¾ƒé«˜é¢‘çš„æ‰‹å†™é¢˜ã€‚æ‰€ä»¥ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥æ‰‹å†™ä¸€ä¸ªç®€æ˜“ç‰ˆçš„ <a href="https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FPromise%2Fall" target="_blank" rel="nofollow noopener noreferrer" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/all" ref="nofollow noopener noreferrer"><strong>Promise.all</strong></a>ï¼š</p>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-built_in">Promise</span>.all = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">iterators</span>) </span>&#123;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =></span> &#123;
    <span class="hljs-keyword">if</span> (!iterators || iterators.length === <span class="hljs-number">0</span>) &#123;
      resolve([]);
    &#125; <span class="hljs-keyword">else</span> &#123;
      <span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>; <span class="hljs-comment">// è®¡æ•°å™¨ï¼Œç”¨äºåˆ¤æ–­æ‰€æœ‰ä»»åŠ¡æ˜¯å¦æ‰§è¡Œå®Œæˆ</span>
      <span class="hljs-keyword">let</span> result = []; <span class="hljs-comment">// ç»“æœæ•°ç»„</span>
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i < iterators.length; i++) &#123;
        <span class="hljs-comment">// è€ƒè™‘åˆ°iterators[i]å¯èƒ½æ˜¯æ™®é€šå¯¹è±¡ï¼Œåˆ™ç»Ÿä¸€åŒ…è£…ä¸ºPromiseå¯¹è±¡</span>
        <span class="hljs-built_in">Promise</span>.resolve(iterators[i]).then(
          <span class="hljs-function">(<span class="hljs-params">data</span>) =></span> &#123;
            result[i] = data; <span class="hljs-comment">// æŒ‰é¡ºåºä¿å­˜å¯¹åº”çš„ç»“æœ</span>
            <span class="hljs-comment">// å½“æ‰€æœ‰ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæˆåï¼Œå†ç»Ÿä¸€è¿”å›ç»“æœ</span>
            <span class="hljs-keyword">if</span> (++count === iterators.length) &#123;
              resolve(result);
            &#125;
          &#125;,
          <span class="hljs-function">(<span class="hljs-params">err</span>) =></span> &#123;
            reject(err); <span class="hljs-comment">// ä»»ä½•ä¸€ä¸ªPromiseå¯¹è±¡æ‰§è¡Œå¤±è´¥ï¼Œåˆ™è°ƒç”¨reject()æ–¹æ³•</span>
            <span class="hljs-keyword">return</span>;
          &#125;
        );
      &#125;
    &#125;
  &#125;);
&#125;;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<h3 data-id="heading-5"><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-map" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-map" ref="nofollow noopener noreferrer">p-map</a></h3>
<blockquote>
<p>Map over promises concurrently</p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-map" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-map" ref="nofollow noopener noreferrer">github.com/sindresorhuâ€¦</a></p>
</blockquote>
<h4 data-id="heading-6">ä½¿ç”¨è¯´æ˜</h4>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-map" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-map" ref="nofollow noopener noreferrer">p-map</a> é€‚ç”¨äºä½¿ç”¨ä¸åŒçš„è¾“å…¥å¤šæ¬¡è¿è¡Œ <strong>promise-returning</strong> æˆ– <strong>async</strong> å‡½æ•°çš„åœºæ™¯ã€‚ä¸å‰é¢ä»‹ç»çš„ <a href="https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FPromise%2Fall" target="_blank" rel="nofollow noopener noreferrer" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/all" ref="nofollow noopener noreferrer">Promise.all</a> æ–¹æ³•çš„åŒºåˆ«æ˜¯ï¼Œä½ å¯ä»¥æ§åˆ¶å¹¶å‘ï¼Œä¹Ÿå¯ä»¥å†³å®šæ˜¯å¦åœ¨å‡ºç°é”™è¯¯æ—¶åœæ­¢è¿­ä»£ã€‚è¯¥æ¨¡å—é»˜è®¤å¯¼å‡ºäº†ä¸€ä¸ª <strong>pMap</strong> å‡½æ•°ï¼Œè¯¥å‡½æ•°çš„ç­¾åå¦‚ä¸‹ï¼š</p>
<blockquote>
<p><strong><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-map" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-map" ref="nofollow noopener noreferrer">pMap(input, mapper, options): Promise</a></strong></p>
</blockquote>
<ul>
<li><code>input: Iterable<Promise | unknown></code></li>
<li><code>mapper(element, index): Function</code></li>
<li><code>options: object</code>
<ul>
<li><code>concurrency: number</code> â€”â€” å¹¶å‘æ•°ï¼Œé»˜è®¤å€¼ <code>Infinity</code>ï¼Œæœ€å°å€¼ä¸º <code>1</code>ï¼›</li>
<li><code>stopOnError: boolean</code> â€”â€” å‡ºç°å¼‚å¸¸æ—¶ï¼Œæ˜¯å¦ç»ˆæ­¢ï¼Œé»˜è®¤å€¼ä¸º <code>true</code>ã€‚</li>
</ul>
</li>
</ul>
<p>äº†è§£å®Œ <strong>pMap</strong> å‡½æ•°çš„ç­¾åä¹‹åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¯¥å‡½æ•°å¦‚ä½•ä½¿ç”¨ã€‚</p>
<h4 data-id="heading-7">ä½¿ç”¨ç¤ºä¾‹</h4>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">// p-map/p-map.test.js</span>
<span class="hljs-keyword">import</span> delay <span class="hljs-keyword">from</span> <span class="hljs-string">"delay"</span>;
<span class="hljs-keyword">import</span> pMap <span class="hljs-keyword">from</span> <span class="hljs-string">"p-map"</span>;

<span class="hljs-keyword">const</span> inputs = [<span class="hljs-number">200</span>, <span class="hljs-number">100</span>, <span class="hljs-number">50</span>];
<span class="hljs-keyword">const</span> mapper = <span class="hljs-function">(<span class="hljs-params">value</span>) =></span> delay(value, &#123; value &#125;);

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">main</span>(<span class="hljs-params"></span>) </span>&#123;
  <span class="hljs-built_in">console</span>.time(<span class="hljs-string">"start"</span>);
  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> pMap(inputs, mapper, &#123; <span class="hljs-attr">concurrency</span>: <span class="hljs-number">1</span> &#125;);
  <span class="hljs-built_in">console</span>.dir(result); <span class="hljs-comment">// è¾“å‡ºç»“æœï¼š[ 200, 100, 50 ]</span>
  <span class="hljs-built_in">console</span>.timeEnd(<span class="hljs-string">"start"</span>);
&#125;

main();
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>åœ¨ä»¥ä¸Šç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿä½¿ç”¨äº† <strong><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fdelay" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/delay" ref="nofollow noopener noreferrer">delay</a></strong> æ¨¡å—å¯¼å‡ºçš„ <code>delay</code> å‡½æ•°ï¼Œç”¨äºå®ç°å»¶è¿ŸåŠŸèƒ½ã€‚å½“æˆåŠŸæ‰§è¡Œä»¥ä¸Šä»£ç åï¼Œå‘½ä»¤è¡Œä¼šè¾“å‡ºä»¥ä¸‹ä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-shell copyable" lang="shell">[ 200, 100, 50 ]
start: 368.708ms
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>è€Œå½“æŠŠ <code>concurrency</code> å±æ€§çš„å€¼æ›´æ”¹ä¸º <code>2</code> ä¹‹åï¼Œå†æ¬¡æ‰§è¡Œä»¥ä¸Šä»£ç ã€‚é‚£ä¹ˆå‘½ä»¤è¡Œå°†ä¼šè¾“å‡ºä»¥ä¸‹ä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-shell copyable" lang="shell">[ 200, 100, 50 ]
start: 210.322ms
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>è§‚å¯Ÿä»¥ä¸Šçš„è¾“å‡ºç»“æœï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºå¹¶å‘æ•°ä¸º <code>1</code> æ—¶ï¼Œç¨‹åºçš„è¿è¡Œæ—¶é—´å¤§äº 350msã€‚è€Œå¦‚æœå¹¶å‘æ•°ä¸º <code>2</code> æ—¶ï¼Œå¤šä¸ªä»»åŠ¡æ˜¯å¹¶è¡Œæ‰§è¡Œçš„ï¼Œæ‰€ä»¥ç¨‹åºçš„è¿è¡Œæ—¶é—´åªéœ€ 210 å¤šæ¯«ç§’ã€‚é‚£ä¹ˆ <code>pMap</code> å‡½æ•°ï¼Œå†…éƒ¨æ˜¯å¦‚ä½•å®ç°å¹¶å‘æ§åˆ¶çš„å‘¢ï¼Ÿä¸‹é¢æ¥åˆ†æä¸€ä¸‹ <code>pMap</code> å‡½æ•°çš„æºç ã€‚</p>
<h4 data-id="heading-8">æºç åˆ†æ</h4>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">// https://github.com/sindresorhus/p-map/blob/main/index.js</span>
<span class="hljs-keyword">import</span> AggregateError <span class="hljs-keyword">from</span> <span class="hljs-string">"aggregate-error"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pMap</span>(<span class="hljs-params">
  iterable,
  mapper,
  &#123; concurrency = <span class="hljs-built_in">Number</span>.POSITIVE_INFINITY, stopOnError = <span class="hljs-literal">true</span> &#125; = &#123;&#125;
</span>) </span>&#123;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =></span> &#123;
    <span class="hljs-comment">// çœç•¥å‚æ•°æ ¡éªŒä»£ç </span>
    <span class="hljs-keyword">const</span> result = []; <span class="hljs-comment">// å­˜å‚¨è¿”å›ç»“æœ</span>
    <span class="hljs-keyword">const</span> errors = []; <span class="hljs-comment">// å­˜å‚¨å¼‚å¸¸å¯¹è±¡</span>
    <span class="hljs-keyword">const</span> skippedIndexes = []; <span class="hljs-comment">// ä¿å­˜è·³è¿‡é¡¹ç´¢å¼•å€¼çš„æ•°ç»„</span>
    <span class="hljs-keyword">const</span> iterator = iterable[<span class="hljs-built_in">Symbol</span>.iterator](); <span class="hljs-comment">// è·å–è¿­ä»£å™¨</span>
    <span class="hljs-keyword">let</span> isRejected = <span class="hljs-literal">false</span>; <span class="hljs-comment">// æ ‡è¯†æ˜¯å¦å‡ºç°å¼‚å¸¸</span>
    <span class="hljs-keyword">let</span> isIterableDone = <span class="hljs-literal">false</span>; <span class="hljs-comment">// æ ‡è¯†æ˜¯å¦å·²è¿­ä»£å®Œæˆ</span>
    <span class="hljs-keyword">let</span> resolvingCount = <span class="hljs-number">0</span>; <span class="hljs-comment">// æ­£åœ¨å¤„ç†çš„ä»»åŠ¡ä¸ªæ•°</span>
    <span class="hljs-keyword">let</span> currentIndex = <span class="hljs-number">0</span>; <span class="hljs-comment">// å½“å‰ç´¢å¼•</span>

    <span class="hljs-keyword">const</span> next = <span class="hljs-function">() =></span> &#123;
      <span class="hljs-keyword">if</span> (isRejected) &#123; <span class="hljs-comment">// è‹¥å‡ºç°å¼‚å¸¸ï¼Œåˆ™ç›´æ¥è¿”å›</span>
        <span class="hljs-keyword">return</span>;
      &#125;

      <span class="hljs-keyword">const</span> nextItem = iterator.next(); <span class="hljs-comment">// è·å–ä¸‹ä¸€é¡¹</span>
      <span class="hljs-keyword">const</span> index = currentIndex; <span class="hljs-comment">// è®°å½•å½“å‰çš„ç´¢å¼•å€¼</span>
      currentIndex++;

      <span class="hljs-keyword">if</span> (nextItem.done) &#123; <span class="hljs-comment">// åˆ¤æ–­è¿­ä»£å™¨æ˜¯å¦è¿­ä»£å®Œæˆ</span>
        isIterableDone = <span class="hljs-literal">true</span>;

        <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦æ‰€æœ‰çš„ä»»åŠ¡éƒ½å·²ç»å®Œæˆäº†</span>
        <span class="hljs-keyword">if</span> (resolvingCount === <span class="hljs-number">0</span>) &#123; 
          <span class="hljs-keyword">if</span> (!stopOnError && errors.length > <span class="hljs-number">0</span>) &#123; <span class="hljs-comment">// å¼‚å¸¸å¤„ç†</span>
            reject(<span class="hljs-keyword">new</span> AggregateError(errors));
          &#125; <span class="hljs-keyword">else</span> &#123;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> skippedIndex <span class="hljs-keyword">of</span> skippedIndexes) &#123;
              <span class="hljs-comment">// åˆ é™¤è·³è¿‡çš„å€¼ï¼Œä¸ç„¶ä¼šå­˜åœ¨ç©ºçš„å ä½</span>
              result.splice(skippedIndex, <span class="hljs-number">1</span>); 
            &#125;
            resolve(result); <span class="hljs-comment">// è¿”å›æœ€ç»ˆçš„å¤„ç†ç»“æœ</span>
          &#125;
        &#125;
        <span class="hljs-keyword">return</span>;
      &#125;

      resolvingCount++; <span class="hljs-comment">// æ­£åœ¨å¤„ç†çš„ä»»åŠ¡æ•°åŠ 1</span>

      (<span class="hljs-keyword">async</span> () => &#123;
        <span class="hljs-keyword">try</span> &#123;
          <span class="hljs-keyword">const</span> element = <span class="hljs-keyword">await</span> nextItem.value;

          <span class="hljs-keyword">if</span> (isRejected) &#123;
            <span class="hljs-keyword">return</span>;
          &#125;

          <span class="hljs-comment">// è°ƒç”¨mapperå‡½æ•°ï¼Œè¿›è¡Œå€¼è¿›è¡Œå¤„ç†</span>
          <span class="hljs-keyword">const</span> value = <span class="hljs-keyword">await</span> mapper(element, index);
          <span class="hljs-comment">// å¤„ç†è·³è¿‡çš„æƒ…å½¢ï¼Œå¯ä»¥åœ¨mapperå‡½æ•°ä¸­è¿”å›pMapSkipï¼Œæ¥è·³è¿‡å½“å‰é¡¹</span>
          <span class="hljs-comment">// æ¯”å¦‚åœ¨å¼‚å¸¸æ•è·çš„catchè¯­å¥ä¸­ï¼Œè¿”å›pMapSkipå€¼</span>
          <span class="hljs-keyword">if</span> (value === pMapSkip) &#123; <span class="hljs-comment">// pMapSkip = Symbol("skip")</span>
            skippedIndexes.push(index);
          &#125; <span class="hljs-keyword">else</span> &#123;
            result[index] = value; <span class="hljs-comment">// æŠŠè¿”å›å€¼æŒ‰ç…§ç´¢å¼•è¿›è¡Œä¿å­˜</span>
          &#125;

          resolvingCount--;
          next(); <span class="hljs-comment">// è¿­ä»£ä¸‹ä¸€é¡¹</span>
        &#125; <span class="hljs-keyword">catch</span> (error) &#123;
          <span class="hljs-keyword">if</span> (stopOnError) &#123; <span class="hljs-comment">// å‡ºç°å¼‚å¸¸æ—¶ï¼Œæ˜¯å¦ç»ˆæ­¢ï¼Œé»˜è®¤å€¼ä¸ºtrue</span>
            isRejected = <span class="hljs-literal">true</span>;
            reject(error);
          &#125; <span class="hljs-keyword">else</span> &#123;
            errors.push(error);
            resolvingCount--;
            next();
          &#125;
        &#125;
      &#125;)();
    &#125;;

    <span class="hljs-comment">// æ ¹æ®é…ç½®çš„concurrencyå€¼ï¼Œå¹¶å‘æ‰§è¡Œä»»åŠ¡</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>; index < concurrency; index++) &#123;
      next();
      <span class="hljs-keyword">if</span> (isIterableDone) &#123;
        <span class="hljs-keyword">break</span>;
      &#125;
    &#125;
  &#125;);
&#125;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> pMapSkip = <span class="hljs-built_in">Symbol</span>(<span class="hljs-string">"skip"</span>);
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p><code>pMap</code> å‡½æ•°å†…éƒ¨çš„å¤„ç†é€»è¾‘è¿˜æ˜¯è›®æ¸…æ™°çš„ï¼ŒæŠŠæ ¸å¿ƒçš„å¤„ç†é€»è¾‘éƒ½å°è£…åœ¨ <code>next</code> å‡½æ•°ä¸­ã€‚åœ¨è°ƒç”¨ <code>pMap</code> å‡½æ•°ä¹‹åï¼Œå†…éƒ¨ä¼šæ ¹æ®é…ç½®çš„<code>concurrency</code> å€¼ï¼Œå¹¶å‘è°ƒç”¨ <code>next</code> å‡½æ•°ã€‚è€Œåœ¨ <code>next</code> å‡½æ•°å†…éƒ¨ï¼Œä¼šé€šè¿‡ <strong>async/await</strong> æ¥æ§åˆ¶ä»»åŠ¡çš„æ‰§è¡Œè¿‡ç¨‹ã€‚</p>
<p>åœ¨ <code>pMap</code> å‡½æ•°ä¸­ï¼Œä½œè€…å·§å¦™è®¾è®¡äº† <strong>pMapSkip</strong>ã€‚å½“æˆ‘ä»¬åœ¨ <code>mapper</code> å‡½æ•°ä¸­è¿”å›äº† <strong>pMapSkip</strong> ä¹‹åï¼Œå°†ä¼šä»è¿”å›çš„ç»“æœæ•°ç»„ä¸­ç§»é™¤å¯¹åº”ç´¢å¼•é¡¹çš„å€¼ã€‚äº†è§£å®Œ <strong>pMapSkip</strong> çš„ä½œç”¨ä¹‹åï¼Œæˆ‘ä»¬æ¥ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼š</p>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-keyword">import</span> pMap, &#123; pMapSkip &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">"p-map"</span>;

<span class="hljs-keyword">const</span> inputs = [<span class="hljs-number">200</span>, pMapSkip, <span class="hljs-number">50</span>];
<span class="hljs-keyword">const</span> mapper = <span class="hljs-keyword">async</span> (value) => value;

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">main</span>(<span class="hljs-params"></span>) </span>&#123;
  <span class="hljs-built_in">console</span>.time(<span class="hljs-string">"start"</span>);
  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> pMap(inputs, mapper, &#123; <span class="hljs-attr">concurrency</span>: <span class="hljs-number">2</span> &#125;);
  <span class="hljs-built_in">console</span>.dir(result); <span class="hljs-comment">// [ 200, 50 ]</span>
  <span class="hljs-built_in">console</span>.timeEnd(<span class="hljs-string">"start"</span>);
&#125;

main();
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>åœ¨ä»¥ä¸Šä»£ç ä¸­ï¼Œæˆ‘ä»¬çš„ <code>inputs</code> æ•°ç»„ä¸­åŒ…å«äº† <code>pMapSkip</code> å€¼ï¼Œå½“ä½¿ç”¨ <code>pMap</code> å‡½æ•°å¯¹ <code>inputs</code> æ•°ç»„è¿›è¡Œå¤„ç†åï¼Œ<code>pMapSkip</code> å€¼å°†ä¼šè¢«è¿‡æ»¤æ‰ï¼Œæ‰€ä»¥æœ€ç»ˆ <code>result</code> çš„ç»“æœä¸º <strong>[200 , 50]</strong>ã€‚</p>
<h3 data-id="heading-9"><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-filter" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-filter" ref="nofollow noopener noreferrer">p-filter</a></h3>
<blockquote>
<p>Filter promises concurrently</p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-filter" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-filter" ref="nofollow noopener noreferrer">github.com/sindresorhuâ€¦</a></p>
</blockquote>
<h4 data-id="heading-10">ä½¿ç”¨è¯´æ˜</h4>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-filter" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-filter" ref="nofollow noopener noreferrer">p-filter</a> é€‚ç”¨äºä½¿ç”¨ä¸åŒçš„è¾“å…¥å¤šæ¬¡è¿è¡Œ <strong>promise-returning</strong> æˆ– <strong>async</strong> å‡½æ•°ï¼Œå¹¶å¯¹è¿”å›çš„ç»“æœè¿›è¡Œè¿‡æ»¤çš„åœºæ™¯ã€‚è¯¥æ¨¡å—é»˜è®¤å¯¼å‡ºäº†ä¸€ä¸ª <strong>pFilter</strong> å‡½æ•°ï¼Œè¯¥å‡½æ•°çš„ç­¾åå¦‚ä¸‹ï¼š</p>
<blockquote>
<p><strong><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-filter" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-filter" ref="nofollow noopener noreferrer">pFilter(input, filterer, options): Promise</a></strong></p>
</blockquote>
<ul>
<li><code>input: Iterable<Promise | any></code></li>
<li><code>filterer(element, index): Function</code></li>
<li><code>options: object</code>
<ul>
<li><code>concurrency: number</code> â€”â€” å¹¶å‘æ•°ï¼Œé»˜è®¤å€¼ <code>Infinity</code>ï¼Œæœ€å°å€¼ä¸º <code>1</code>ã€‚</li>
</ul>
</li>
</ul>
<p>äº†è§£å®Œ <strong>pFilter</strong> å‡½æ•°çš„ç­¾åä¹‹åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¯¥å‡½æ•°å¦‚ä½•ä½¿ç”¨ã€‚</p>
<h4 data-id="heading-11">ä½¿ç”¨ç¤ºä¾‹</h4>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">// p-filter/p-filter.test.js</span>
<span class="hljs-keyword">import</span> pFilter <span class="hljs-keyword">from</span> <span class="hljs-string">"p-filter"</span>;

<span class="hljs-keyword">const</span> inputs = [<span class="hljs-built_in">Promise</span>.resolve(<span class="hljs-number">1</span>), <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
<span class="hljs-keyword">const</span> filterer = <span class="hljs-function">(<span class="hljs-params">x</span>) =></span> x % <span class="hljs-number">2</span>;

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">main</span>(<span class="hljs-params"></span>) </span>&#123;
  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> pFilter(inputs, filterer, &#123; <span class="hljs-attr">concurrency</span>: <span class="hljs-number">1</span> &#125;);
  <span class="hljs-built_in">console</span>.dir(result); <span class="hljs-comment">// è¾“å‡ºç»“æœï¼š[ 1, 3 ]</span>
&#125;

main();
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>åœ¨ä»¥ä¸Šç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>pFilter</code> å‡½æ•°å¯¹åŒ…å« <code>Promise</code> å¯¹è±¡çš„ <code>inputs</code> æ•°ç»„ï¼Œåº”ç”¨äº† <code>(x) => x % 2</code> è¿‡æ»¤å™¨ã€‚å½“ä»¥ä¸Šä»£ç æˆåŠŸè¿è¡Œåï¼Œå‘½ä»¤è¡Œä¼šè¾“å‡º <strong>[1, 3]</strong>ã€‚</p>
<h4 data-id="heading-12">æºç åˆ†æ</h4>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">// https://github.com/sindresorhus/p-filter/blob/main/index.js</span>
<span class="hljs-keyword">const</span> pMap = <span class="hljs-built_in">require</span>(<span class="hljs-string">'p-map'</span>);

<span class="hljs-keyword">const</span> pFilter = <span class="hljs-keyword">async</span> (iterable, filterer, options) => &#123;
<span class="hljs-keyword">const</span> values = <span class="hljs-keyword">await</span> pMap(
iterable,
<span class="hljs-function">(<span class="hljs-params">element, index</span>) =></span> <span class="hljs-built_in">Promise</span>.all([filterer(element, index), element]),
options
);
<span class="hljs-keyword">return</span> values.filter(<span class="hljs-function"><span class="hljs-params">value</span> =></span> <span class="hljs-built_in">Boolean</span>(value[<span class="hljs-number">0</span>])).map(<span class="hljs-function"><span class="hljs-params">value</span> =></span> value[<span class="hljs-number">1</span>]);
&#125;;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>ç”±ä»¥ä¸Šä»£ç å¯çŸ¥ï¼Œåœ¨ <code>pFilter</code> å‡½æ•°å†…éƒ¨ï¼Œä½¿ç”¨äº†æˆ‘ä»¬å‰é¢å·²ç»ä»‹ç»è¿‡çš„ <code>pMap</code> å’Œ <code>Promise.all</code> å‡½æ•°ã€‚è¦ç†è§£ä»¥ä¸Šä»£ç ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ¥å›é¡¾ä¸€ä¸‹ <code>pMap</code> å‡½æ•°çš„å…³é”®ä»£ç ï¼š</p>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">// https://github.com/sindresorhus/p-map/blob/main/index.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pMap</span>(<span class="hljs-params">
  iterable, mapper,
  &#123; concurrency = <span class="hljs-built_in">Number</span>.POSITIVE_INFINITY, stopOnError = <span class="hljs-literal">true</span> &#125; = &#123;&#125;
</span>) </span>&#123;
  <span class="hljs-keyword">const</span> iterator = iterable[<span class="hljs-built_in">Symbol</span>.iterator](); <span class="hljs-comment">// è·å–è¿­ä»£å™¨</span>
  <span class="hljs-keyword">let</span> currentIndex = <span class="hljs-number">0</span>; <span class="hljs-comment">// å½“å‰ç´¢å¼•</span>
  
  <span class="hljs-keyword">const</span> next = <span class="hljs-function">() =></span> &#123;
    <span class="hljs-keyword">const</span> nextItem = iterator.next(); <span class="hljs-comment">// è·å–ä¸‹ä¸€é¡¹</span>
    <span class="hljs-keyword">const</span> index = currentIndex;
    currentIndex++;
    (<span class="hljs-keyword">async</span> () => &#123;
        <span class="hljs-keyword">try</span> &#123;
          <span class="hljs-comment">// element => await Promise.resolve(1);</span>
          <span class="hljs-keyword">const</span> element = <span class="hljs-keyword">await</span> nextItem.value;
          <span class="hljs-comment">// mapper => (element, index) => Promise.all([filterer(element, index), element])</span>
          <span class="hljs-keyword">const</span> value = <span class="hljs-keyword">await</span> mapper(element, index);
          <span class="hljs-keyword">if</span> (value === pMapSkip) &#123;
            skippedIndexes.push(index);
          &#125; <span class="hljs-keyword">else</span> &#123;
            result[index] = value; <span class="hljs-comment">// æŠŠè¿”å›å€¼æŒ‰ç…§ç´¢å¼•è¿›è¡Œä¿å­˜</span>
          &#125;
          resolvingCount--;
          next(); <span class="hljs-comment">// è¿­ä»£ä¸‹ä¸€é¡¹</span>
        &#125; <span class="hljs-keyword">catch</span> (error) &#123;
          <span class="hljs-comment">// çœç•¥å¼‚å¸¸å¤„ç†ä»£ç </span>
        &#125;
    &#125;)();
  &#125;
&#125;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>å› ä¸º <code>pFilter</code> å‡½æ•°ä¸­æ‰€ç”¨çš„ <code>mapper</code> å‡½æ•°æ˜¯ <code>(element, index) => Promise.all([filterer(element, index), element])</code>ï¼Œæ‰€ä»¥ <code>await mapper(element, index)</code> è¡¨è¾¾å¼çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚æ•°ç»„çš„ç¬¬ 1 é¡¹æ˜¯ <code>filterer</code> è¿‡æ»¤å™¨çš„å¤„ç†ç»“æœï¼Œè€Œæ•°ç»„çš„ç¬¬ 2 é¡¹æ˜¯å½“å‰å…ƒç´ çš„å€¼ã€‚å› æ­¤åœ¨è°ƒç”¨ <code>pMap</code> å‡½æ•°åï¼Œå®ƒçš„è¿”å›å€¼æ˜¯ä¸€ä¸ªäºŒç»´æ•°ç»„ã€‚æ‰€ä»¥åœ¨è·å– <code>pMap</code> å‡½æ•°çš„è¿”å›å€¼ä¹‹åï¼Œ ä¼šä½¿ç”¨ä»¥ä¸‹è¯­å¥å¯¹è¿”å›å€¼è¿›è¡Œå¤„ç†ï¼š</p>
<pre><code class="hljs language-javascript copyable" lang="javascript">values.filter(<span class="hljs-function"><span class="hljs-params">value</span> =></span> <span class="hljs-built_in">Boolean</span>(value[<span class="hljs-number">0</span>])).map(<span class="hljs-function"><span class="hljs-params">value</span> =></span> value[<span class="hljs-number">1</span>])
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>å…¶å®ï¼Œå¯¹äºå‰é¢çš„ <code>pFilter</code> ç¤ºä¾‹æ¥è¯´ï¼Œé™¤äº† <code>inputs</code> å¯ä»¥å«æœ‰ Promise å¯¹è±¡ï¼Œæˆ‘ä»¬çš„ <code>filterer</code> è¿‡æ»¤å™¨ä¹Ÿå¯ä»¥è¿”å› Promise å¯¹è±¡ï¼š</p>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-keyword">import</span> pFilter <span class="hljs-keyword">from</span> <span class="hljs-string">"p-filter"</span>;

<span class="hljs-keyword">const</span> inputs = [<span class="hljs-built_in">Promise</span>.resolve(<span class="hljs-number">1</span>), <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
<span class="hljs-keyword">const</span> filterer = <span class="hljs-function">(<span class="hljs-params">x</span>) =></span> <span class="hljs-built_in">Promise</span>.resolve(x % <span class="hljs-number">2</span>);

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">main</span>(<span class="hljs-params"></span>) </span>&#123;
  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> pFilter(inputs, filterer);
  <span class="hljs-built_in">console</span>.dir(result); <span class="hljs-comment">// [ 1, 3 ]</span>
&#125;

main();
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>ä»¥ä¸Šä»£ç æˆåŠŸæ‰§è¡Œåï¼Œå‘½ä»¤è¡Œçš„è¾“å‡ºç»“æœä¹Ÿæ˜¯ <strong>[1, 3]</strong>ã€‚å¥½çš„ï¼Œç°åœ¨æˆ‘ä»¬å·²ç»ä»‹ç»äº† <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-reduce" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-reduce" ref="nofollow noopener noreferrer">p-reduce</a>ã€<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-map" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-map" ref="nofollow noopener noreferrer">p-map</a> å’Œ <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-filter" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-filter" ref="nofollow noopener noreferrer">p-filter</a> 3 ä¸ªæ¨¡å—ã€‚ä¸‹é¢æˆ‘ä»¬æ¥ç»§ç»­ä»‹ç»å¦ä¸€ä¸ªæ¨¡å— â€”â€” <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-waterfall" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-waterfall" ref="nofollow noopener noreferrer">p-waterfall</a>ã€‚</p>
<h3 data-id="heading-13"><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-waterfall" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-waterfall" ref="nofollow noopener noreferrer">p-waterfall</a></h3>
<blockquote>
<p>Run promise-returning & async functions in series, each passing its result to the next</p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-waterfall" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-waterfall" ref="nofollow noopener noreferrer">github.com/sindresorhuâ€¦</a></p>
</blockquote>
<h4 data-id="heading-14">ä½¿ç”¨è¯´æ˜</h4>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-waterfall" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-waterfall" ref="nofollow noopener noreferrer">p-waterfall</a> é€‚ç”¨äºä¸²è¡Œæ‰§è¡Œ <strong>promise-returning</strong> æˆ– <strong>async</strong> å‡½æ•°ï¼Œå¹¶æŠŠå‰ä¸€ä¸ªå‡½æ•°çš„è¿”å›ç»“æœè‡ªåŠ¨ä¼ ç»™ä¸‹ä¸€ä¸ªå‡½æ•°çš„åœºæ™¯ã€‚è¯¥æ¨¡å—é»˜è®¤å¯¼å‡ºäº†ä¸€ä¸ª <strong>pWaterfall</strong> å‡½æ•°ï¼Œè¯¥å‡½æ•°çš„ç­¾åå¦‚ä¸‹ï¼š</p>
<blockquote>
<p><strong><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-waterfall" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-waterfall" ref="nofollow noopener noreferrer">pWaterfall(tasks, initialValue): Promise</a></strong></p>
</blockquote>
<ul>
<li><code>tasks: Iterable<Function></code></li>
<li><code>initialValue: unknown</code>ï¼šå°†ä½œä¸ºç¬¬ä¸€ä¸ªä»»åŠ¡çš„ <code>previousValue</code></li>
</ul>
<p>äº†è§£å®Œ <strong>pWaterfall</strong> å‡½æ•°çš„ç­¾åä¹‹åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¯¥å‡½æ•°å¦‚ä½•ä½¿ç”¨ã€‚</p>
<h4 data-id="heading-15">ä½¿ç”¨ç¤ºä¾‹</h4>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">// p-waterfall/p-waterfall.test.js</span>
<span class="hljs-keyword">import</span> pWaterfall <span class="hljs-keyword">from</span> <span class="hljs-string">"p-waterfall"</span>;

<span class="hljs-keyword">const</span> tasks = [
  <span class="hljs-keyword">async</span> (val) => val + <span class="hljs-number">1</span>,
  <span class="hljs-function">(<span class="hljs-params">val</span>) =></span> val + <span class="hljs-number">2</span>,
  <span class="hljs-keyword">async</span> (val) => val + <span class="hljs-number">3</span>,
];

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">main</span>(<span class="hljs-params"></span>) </span>&#123;
  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> pWaterfall(tasks, <span class="hljs-number">0</span>);
  <span class="hljs-built_in">console</span>.dir(result); <span class="hljs-comment">// è¾“å‡ºç»“æœï¼š6</span>
&#125;

main();
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>åœ¨ä»¥ä¸Šç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº† 3 ä¸ªä»»åŠ¡ï¼Œç„¶åä½¿ç”¨ <code>pWaterfall</code> å‡½æ•°æ¥æ‰§è¡Œè¿™ 3 ä¸ªä»»åŠ¡ã€‚å½“ä»¥ä¸Šä»£ç æˆåŠŸæ‰§è¡Œåï¼Œå‘½ä»¤è¡Œä¼šè¾“å‡º <strong>6</strong>ã€‚å¯¹åº”çš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/23640c8512e346df8b2325b0df11df6e~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<h4 data-id="heading-16">æºç åˆ†æ</h4>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">// https://github.com/sindresorhus/p-waterfall/blob/main/index.js</span>
<span class="hljs-keyword">import</span> pReduce <span class="hljs-keyword">from</span> <span class="hljs-string">'p-reduce'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pWaterfall</span>(<span class="hljs-params">iterable, initialValue</span>) </span>&#123;
<span class="hljs-keyword">return</span> pReduce(iterable, <span class="hljs-function">(<span class="hljs-params">previousValue, function_</span>) =></span> function_(previousValue), initialValue);
&#125;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>åœ¨ <code>pWaterfall</code> å‡½æ•°å†…éƒ¨ï¼Œä¼šåˆ©ç”¨å‰é¢å·²ç»ä»‹ç»çš„ <code>pReduce</code> å‡½æ•°æ¥å®ç° <strong>waterfall</strong> æµç¨‹æ§åˆ¶ã€‚åŒæ ·ï¼Œè¦ææ¸…æ¥šå†…éƒ¨çš„æ§åˆ¶æµç¨‹ï¼Œæˆ‘ä»¬éœ€è¦æ¥å›é¡¾ä¸€ä¸‹ <code>pReduce</code> å‡½æ•°çš„å…·ä½“å®ç°ï¼š</p>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pReduce</span>(<span class="hljs-params">iterable, reducer, initialValue</span>) </span>&#123;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =></span> &#123;
    <span class="hljs-keyword">const</span> iterator = iterable[<span class="hljs-built_in">Symbol</span>.iterator](); <span class="hljs-comment">// è·å–è¿­ä»£å™¨</span>
    <span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>; <span class="hljs-comment">// ç´¢å¼•å€¼</span>

    <span class="hljs-keyword">const</span> next = <span class="hljs-keyword">async</span> (total) => &#123;
      <span class="hljs-keyword">const</span> element = iterator.next(); <span class="hljs-comment">// è·å–ä¸‹ä¸€é¡¹</span>

      <span class="hljs-keyword">if</span> (element.done) &#123;
        <span class="hljs-comment">// åˆ¤æ–­è¿­ä»£å™¨æ˜¯å¦è¿­ä»£å®Œæˆ</span>
        resolve(total);
        <span class="hljs-keyword">return</span>;
      &#125;

      <span class="hljs-keyword">try</span> &#123;
        <span class="hljs-comment">// é¦–æ¬¡è°ƒç”¨nextå‡½æ•°çš„çŠ¶æ€ï¼š</span>
        <span class="hljs-comment">// resolvedTotal => 0</span>
        <span class="hljs-comment">// element.value => async (val) => val + 1</span>
        <span class="hljs-keyword">const</span> [resolvedTotal, resolvedValue] = <span class="hljs-keyword">await</span> <span class="hljs-built_in">Promise</span>.all([
          total,
          element.value,
        ]);
        <span class="hljs-comment">// reducer => (previousValue, function_) => function_(previousValue)</span>
        next(reducer(resolvedTotal, resolvedValue, index++));
      &#125; <span class="hljs-keyword">catch</span> (error) &#123;
        reject(error);
      &#125;
    &#125;;

    <span class="hljs-comment">// ä½¿ç”¨åˆå§‹å€¼ï¼Œå¼€å§‹è¿­ä»£</span>
    next(initialValue);
  &#125;);
&#125;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»çŸ¥é“ <strong>pWaterfall</strong> å‡½æ•°ä¼šæŠŠå‰ä¸€ä¸ªä»»åŠ¡çš„è¾“å‡ºç»“æœï¼Œä½œä¸ºè¾“å…¥ä¼ ç»™ä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚ä½†æœ‰äº›æ—¶å€™ï¼Œåœ¨ä¸²è¡Œæ‰§è¡Œæ¯ä¸ªä»»åŠ¡æ—¶ï¼Œæˆ‘ä»¬å¹¶ä¸å…³å¿ƒæ¯ä¸ªä»»åŠ¡çš„è¿”å›å€¼ã€‚é’ˆå¯¹è¿™ç§åœºåˆï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨ <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-series" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-series" ref="nofollow noopener noreferrer">p-series</a> æ¨¡å—æä¾›çš„ <code>pSeries</code> å‡½æ•°ã€‚</p>
<h3 data-id="heading-17"><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-series" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-series" ref="nofollow noopener noreferrer">p-series</a></h3>
<blockquote>
<p>Run promise-returning & async functions in series</p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-series" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-series" ref="nofollow noopener noreferrer">github.com/sindresorhuâ€¦</a></p>
</blockquote>
<h4 data-id="heading-18">ä½¿ç”¨è¯´æ˜</h4>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-series" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-series" ref="nofollow noopener noreferrer">p-series</a> é€‚ç”¨äºä¸²è¡Œæ‰§è¡Œ <strong>promise-returning</strong> æˆ– <strong>async</strong> å‡½æ•°çš„åœºæ™¯ã€‚</p>
<h4 data-id="heading-19">ä½¿ç”¨ç¤ºä¾‹</h4>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">// p-series/p-series.test.js</span>
<span class="hljs-keyword">import</span> pSeries <span class="hljs-keyword">from</span> <span class="hljs-string">"p-series"</span>;

<span class="hljs-keyword">const</span> tasks = [<span class="hljs-keyword">async</span> () => <span class="hljs-number">1</span> + <span class="hljs-number">1</span>, <span class="hljs-function">() =></span> <span class="hljs-number">2</span> + <span class="hljs-number">2</span>, <span class="hljs-keyword">async</span> () => <span class="hljs-number">3</span> + <span class="hljs-number">3</span>];

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">main</span>(<span class="hljs-params"></span>) </span>&#123;
  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> pSeries(tasks);
  <span class="hljs-built_in">console</span>.dir(result); <span class="hljs-comment">// è¾“å‡ºç»“æœï¼š[2, 4, 6]</span>
&#125;

main();
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>åœ¨ä»¥ä¸Šç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº† 3 ä¸ªä»»åŠ¡ï¼Œç„¶åä½¿ç”¨ <code>pSeries</code> å‡½æ•°æ¥æ‰§è¡Œè¿™ 3 ä¸ªä»»åŠ¡ã€‚å½“ä»¥ä¸Šä»£ç æˆåŠŸæ‰§è¡Œåï¼Œå‘½ä»¤è¡Œä¼šè¾“å‡º <strong>[ 2, 4, 6 ]</strong>ã€‚å¯¹åº”çš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/eba0f1a8c2fb47d4a0f01536197ff7a1~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<h4 data-id="heading-20">æºç åˆ†æ</h4>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">// https://github.com/sindresorhus/p-series/blob/main/index.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pSeries</span>(<span class="hljs-params">tasks</span>) </span>&#123;
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> task <span class="hljs-keyword">of</span> tasks) &#123;
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> task !== <span class="hljs-string">'function'</span>) &#123;
<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">`Expected task to be a \`Function\`, received \`<span class="hljs-subst">$&#123;<span class="hljs-keyword">typeof</span> task&#125;</span>\``</span>);
&#125;
&#125;

<span class="hljs-keyword">const</span> results = [];

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> task <span class="hljs-keyword">of</span> tasks) &#123;
results.push(<span class="hljs-keyword">await</span> task()); <span class="hljs-comment">// eslint-disable-line no-await-in-loop</span>
&#125;

<span class="hljs-keyword">return</span> results;
&#125;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>ç”±ä»¥ä¸Šä»£ç å¯çŸ¥ï¼Œåœ¨ <code>pSeries</code> å‡½æ•°å†…éƒ¨æ˜¯åˆ©ç”¨ <strong><a href="https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FStatements%2Ffor...of" target="_blank" rel="nofollow noopener noreferrer" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/for...of" ref="nofollow noopener noreferrer">for...of</a></strong> è¯­å¥å’Œ <strong><a href="https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FLearn%2FJavaScript%2FAsynchronous%2FAsync_await" target="_blank" rel="nofollow noopener noreferrer" title="https://developer.mozilla.org/zh-CN/docs/Learn/JavaScript/Asynchronous/Async_await" ref="nofollow noopener noreferrer">async/await</a></strong> ç‰¹æ€§æ¥å®ç°ä¸²è¡Œä»»åŠ¡æµæ§åˆ¶ã€‚å› æ­¤åœ¨å®é™…çš„é¡¹ç›®ä¸­ï¼Œä½ ä¹Ÿå¯ä»¥æ— éœ€ä½¿ç”¨è¯¥æ¨¡å—ï¼Œå°±å¯ä»¥è½»æ¾çš„å®ç°ä¸²è¡Œä»»åŠ¡æµæ§åˆ¶ã€‚</p>
<h3 data-id="heading-21"><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-all" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-all" ref="nofollow noopener noreferrer">p-all</a></h3>
<blockquote>
<p>Run promise-returning & async functions concurrently with optional limited concurrency</p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-all" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-all" ref="nofollow noopener noreferrer">github.com/sindresorhuâ€¦</a></p>
</blockquote>
<h4 data-id="heading-22">ä½¿ç”¨è¯´æ˜</h4>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-all" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-all" ref="nofollow noopener noreferrer">p-all</a> é€‚ç”¨äºå¹¶å‘æ‰§è¡Œ <strong>promise-returning</strong> æˆ– <strong>async</strong> å‡½æ•°çš„åœºæ™¯ã€‚è¯¥æ¨¡å—æä¾›çš„åŠŸèƒ½ï¼Œä¸ <a href="https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FPromise%2Fall" target="_blank" rel="nofollow noopener noreferrer" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/all" ref="nofollow noopener noreferrer"><strong>Promise.all</strong></a> API ç±»ä¼¼ï¼Œä¸»è¦çš„åŒºåˆ«æ˜¯è¯¥æ¨¡å—å…è®¸ä½ é™åˆ¶ä»»åŠ¡çš„å¹¶å‘æ•°ã€‚åœ¨æ—¥å¸¸å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„åœºæ™¯å°±æ˜¯æ§åˆ¶ HTTP è¯·æ±‚çš„å¹¶å‘æ•°ï¼Œè¿™æ—¶ä½ ä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨ <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Frxaviers%2Fasync-pool" target="_blank" title="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Frxaviers%2Fasync-pool">async-pool</a> è¿™ä¸ªåº“æ¥è§£å†³å¹¶å‘æ§åˆ¶çš„é—®é¢˜ï¼Œå¦‚æœä½ å¯¹è¯¥åº“çš„å†…éƒ¨å®ç°åŸç†æ„Ÿå…´è¶£çš„è¯ï¼Œå¯ä»¥é˜…è¯» <a href="https://juejin.cn/post/6976028030770610213" target="_blank" title="https://juejin.cn/post/6976028030770610213">JavaScript ä¸­å¦‚ä½•å®ç°å¹¶å‘æ§åˆ¶ï¼Ÿ</a> è¿™ç¯‡æ–‡ç« ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬æ¥ç»§ç»­ä»‹ç» <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-all" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-all" ref="nofollow noopener noreferrer">p-all</a> æ¨¡å—ï¼Œè¯¥æ¨¡å—é»˜è®¤å¯¼å‡ºäº†ä¸€ä¸ª <strong>pAll</strong> å‡½æ•°ï¼Œè¯¥å‡½æ•°çš„ç­¾åå¦‚ä¸‹ï¼š</p>
<blockquote>
<p><strong><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-all" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-all" ref="nofollow noopener noreferrer">pAll(tasks, options)</a></strong></p>
</blockquote>
<ul>
<li><code>tasks: Iterable<Function></code></li>
<li><code>options: object</code>
<ul>
<li><code>concurrency: number</code> â€”â€” å¹¶å‘æ•°ï¼Œé»˜è®¤å€¼ <code>Infinity</code>ï¼Œæœ€å°å€¼ä¸º <code>1</code>ï¼›</li>
<li><code>stopOnError: boolean</code> â€”â€” å‡ºç°å¼‚å¸¸æ—¶ï¼Œæ˜¯å¦ç»ˆæ­¢ï¼Œé»˜è®¤å€¼ä¸º <code>true</code>ã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-23">ä½¿ç”¨ç¤ºä¾‹</h4>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">// p-all/p-all.test.js</span>
<span class="hljs-keyword">import</span> delay <span class="hljs-keyword">from</span> <span class="hljs-string">"delay"</span>;
<span class="hljs-keyword">import</span> pAll <span class="hljs-keyword">from</span> <span class="hljs-string">"p-all"</span>;

<span class="hljs-keyword">const</span> inputs = [
  <span class="hljs-function">() =></span> delay(<span class="hljs-number">200</span>, &#123; <span class="hljs-attr">value</span>: <span class="hljs-number">1</span> &#125;),
  <span class="hljs-keyword">async</span> () => &#123;
    <span class="hljs-keyword">await</span> delay(<span class="hljs-number">100</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>;
  &#125;,
  <span class="hljs-keyword">async</span> () => <span class="hljs-number">8</span>,
];

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">main</span>(<span class="hljs-params"></span>) </span>&#123;
  <span class="hljs-built_in">console</span>.time(<span class="hljs-string">"start"</span>);
  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> pAll(inputs, &#123; <span class="hljs-attr">concurrency</span>: <span class="hljs-number">1</span> &#125;);
  <span class="hljs-built_in">console</span>.dir(result); <span class="hljs-comment">// è¾“å‡ºç»“æœï¼š[ 1, 2, 8 ]</span>
  <span class="hljs-built_in">console</span>.timeEnd(<span class="hljs-string">"start"</span>);
&#125;

main();
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>åœ¨ä»¥ä¸Šç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº† 3 ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œç„¶åé€šè¿‡ <code>pAll</code> å‡½æ•°æ¥æ‰§è¡Œå·²åˆ›å»ºçš„ä»»åŠ¡ã€‚å½“æˆåŠŸæ‰§è¡Œä»¥ä¸Šä»£ç åï¼Œå‘½ä»¤è¡Œä¼šè¾“å‡ºä»¥ä¸‹ä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-shell copyable" lang="shell">[ 1, 2, 8 ]
start: 312.561ms
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>è€Œå½“æŠŠ <code>concurrency</code> å±æ€§çš„å€¼æ›´æ”¹ä¸º <code>2</code> ä¹‹åï¼Œå†æ¬¡æ‰§è¡Œä»¥ä¸Šä»£ç ã€‚é‚£ä¹ˆå‘½ä»¤è¡Œå°†ä¼šè¾“å‡ºä»¥ä¸‹ä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-shell copyable" lang="shell">[ 1, 2, 8 ]
start: 209.469ms
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>å¯ä»¥çœ‹å‡ºå¹¶å‘æ•°ä¸º <code>1</code> æ—¶ï¼Œç¨‹åºçš„è¿è¡Œæ—¶é—´å¤§äº 300msã€‚è€Œå¦‚æœå¹¶å‘æ•°ä¸º <code>2</code> æ—¶ï¼Œå‰é¢ä¸¤ä¸ªä»»åŠ¡æ˜¯å¹¶è¡Œçš„ï¼Œæ‰€ä»¥ç¨‹åºçš„è¿è¡Œæ—¶é—´åªéœ€ 200 å¤šæ¯«ç§’ã€‚</p>
<h4 data-id="heading-24">æºç åˆ†æ</h4>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">// https://github.com/sindresorhus/p-all/blob/main/index.js</span>
<span class="hljs-keyword">import</span> pMap <span class="hljs-keyword">from</span> <span class="hljs-string">'p-map'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pAll</span>(<span class="hljs-params">iterable, options</span>) </span>&#123;
<span class="hljs-keyword">return</span> pMap(iterable, <span class="hljs-function"><span class="hljs-params">element</span> =></span> element(), options);
&#125;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>å¾ˆæ˜æ˜¾åœ¨ <code>pAll</code> å‡½æ•°å†…éƒ¨ï¼Œæ˜¯é€šè¿‡ <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-map" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-map" ref="nofollow noopener noreferrer">p-map</a> æ¨¡å—æä¾›çš„ <code>pMap</code> å‡½æ•°æ¥å®ç°å¹¶å‘æ§åˆ¶çš„ã€‚å¦‚æœä½ å¯¹ <code>pMap</code> å‡½æ•°çš„å†…éƒ¨å®ç°æ–¹å¼ï¼Œè¿˜ä¸æ¸…æ¥šçš„è¯ï¼Œå¯ä»¥å›è¿‡å¤´å†æ¬¡é˜…è¯» <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-map" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-map" ref="nofollow noopener noreferrer">p-map</a> æ¨¡å—çš„ç›¸å…³å†…å®¹ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥ç»§ç»­ä»‹ç»å¦ä¸€ä¸ªæ¨¡å— â€”â€” <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-race" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-race" ref="nofollow noopener noreferrer">p-race</a>ã€‚</p>
<h3 data-id="heading-25"><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-race" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-race" ref="nofollow noopener noreferrer">p-race</a></h3>
<blockquote>
<p>A better <code>Promise.race()</code></p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-race" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-race" ref="nofollow noopener noreferrer">github.com/sindresorhuâ€¦</a></p>
</blockquote>
<h4 data-id="heading-26">ä½¿ç”¨è¯´æ˜</h4>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-race" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-race" ref="nofollow noopener noreferrer">p-race</a> è¿™ä¸ªæ¨¡å—ä¿®å¤äº† <a href="https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FPromise%2Frace" target="_blank" rel="nofollow noopener noreferrer" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/race" ref="nofollow noopener noreferrer">Promise.race</a> API ä¸€ä¸ª â€œæ„šè ¢â€ çš„è¡Œä¸ºã€‚å½“ä½¿ç”¨ç©ºçš„å¯è¿­ä»£å¯¹è±¡ï¼Œè°ƒç”¨ <a href="https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FPromise%2Frace" target="_blank" rel="nofollow noopener noreferrer" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/race" ref="nofollow noopener noreferrer">Promise.race</a> API æ—¶ï¼Œå°†ä¼šè¿”å›ä¸€ä¸ªæ°¸è¿œå¤„äº <strong>pending</strong> çŠ¶æ€çš„ Promise å¯¹è±¡ï¼Œè¿™å¯èƒ½ä¼šäº§ç”Ÿä¸€äº›éå¸¸éš¾ä»¥è°ƒè¯•çš„é—®é¢˜ã€‚è€Œå¦‚æœå¾€ <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-race" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-race" ref="nofollow noopener noreferrer">p-race</a> æ¨¡å—æä¾›çš„ <code>pRace</code> å‡½æ•°ä¸­ä¼ å…¥ä¸€ä¸ªç©ºçš„å¯è¿­ä»£å¯¹è±¡æ—¶ï¼Œè¯¥å‡½æ•°å°†ä¼šç«‹å³æŠ›å‡º <strong>RangeError: Expected the iterable to contain at least one item</strong> çš„å¼‚å¸¸ä¿¡æ¯ã€‚</p>
<p><strong><code>pRace(iterable)</code></strong> æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª promise å¯¹è±¡ï¼Œä¸€æ—¦è¿­ä»£å™¨ä¸­çš„æŸä¸ª promise å¯¹è±¡ <strong>resolved</strong> æˆ– <strong>rejected</strong>ï¼Œè¿”å›çš„ promise å¯¹è±¡å°±ä¼š resolve æˆ– reject ç›¸åº”çš„å€¼ã€‚</p>
<h4 data-id="heading-27">ä½¿ç”¨ç¤ºä¾‹</h4>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">// p-race/p-race.test.js</span>
<span class="hljs-keyword">import</span> delay <span class="hljs-keyword">from</span> <span class="hljs-string">"delay"</span>;
<span class="hljs-keyword">import</span> pRace <span class="hljs-keyword">from</span> <span class="hljs-string">"p-race"</span>;

<span class="hljs-keyword">const</span> inputs = [delay(<span class="hljs-number">50</span>, &#123; <span class="hljs-attr">value</span>: <span class="hljs-number">1</span> &#125;), delay(<span class="hljs-number">100</span>, &#123; <span class="hljs-attr">value</span>: <span class="hljs-number">2</span> &#125;)];

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">main</span>(<span class="hljs-params"></span>) </span>&#123;
  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> pRace(inputs);
  <span class="hljs-built_in">console</span>.dir(result); <span class="hljs-comment">// è¾“å‡ºç»“æœï¼š1</span>
&#125;

main();
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>åœ¨ä»¥ä¸Šç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å¯¼å…¥äº† <strong><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fdelay" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/delay" ref="nofollow noopener noreferrer">delay</a></strong> æ¨¡å—é»˜è®¤å¯¼å‡ºçš„ <code>delay</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¯ç”¨äºæŒ‰ç…§ç»™å®šçš„æ—¶é—´ï¼Œå»¶è¿Ÿä¸€ä¸ª Promise å¯¹è±¡ã€‚åˆ©ç”¨ <code>delay</code> å‡½æ•°ï¼Œæˆ‘ä»¬åˆ›å»ºäº† 2 ä¸ª Promise å¯¹è±¡ï¼Œç„¶åä½¿ç”¨ <code>pRace</code> å‡½æ•°æ¥å¤„ç†è¿™ä¸¤ä¸ª Promise å¯¹è±¡ã€‚ä»¥ä¸Šä»£ç æˆåŠŸè¿è¡Œåï¼Œå‘½ä»¤è¡Œå§‹ç»ˆä¼šè¾“å‡º <strong>1</strong>ã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿä¸‹é¢æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ <code>pRace</code> å‡½æ•°çš„æºç ã€‚</p>
<h4 data-id="heading-28">æºç åˆ†æ</h4>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">// https://github.com/sindresorhus/p-race/blob/main/index.js</span>
<span class="hljs-keyword">import</span> isEmptyIterable <span class="hljs-keyword">from</span> <span class="hljs-string">'is-empty-iterable'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pRace</span>(<span class="hljs-params">iterable</span>) </span>&#123;
<span class="hljs-keyword">if</span> (isEmptyIterable(iterable)) &#123;
<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">RangeError</span>(<span class="hljs-string">'Expected the iterable to contain at least one item'</span>);
&#125;

<span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.race(iterable);
&#125;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>è§‚å¯Ÿä»¥ä¸Šæºç å¯çŸ¥ï¼Œåœ¨ <code>pRace</code> å‡½æ•°å†…éƒ¨ä¼šå…ˆåˆ¤æ–­ä¼ å…¥çš„ <code>iterable</code> å‚æ•°æ˜¯å¦ä¸ºç©ºçš„å¯è¿­ä»£å¯¹è±¡ã€‚æ£€æµ‹å‚æ•°æ˜¯å¦ä¸ºç©ºçš„å¯è¿­ä»£å¯¹è±¡ï¼Œæ˜¯é€šè¿‡ <code>isEmptyIterable</code> å‡½æ•°æ¥å®ç°ï¼Œè¯¥å‡½æ•°çš„å…·ä½“ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">// https://github.com/sindresorhus/is-empty-iterable/blob/main/index.js</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isEmptyIterable</span>(<span class="hljs-params">iterable</span>) </span>&#123;
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> _ <span class="hljs-keyword">of</span> iterable) &#123;
<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
&#125;

<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
&#125;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>å½“å‘ç°æ˜¯ç©ºçš„å¯è¿­ä»£å¯¹è±¡æ—¶ï¼Œ<code>pRace</code> å‡½æ•°ä¼šç›´æ¥æŠ›å‡º <code>RangeError</code> å¼‚å¸¸ã€‚å¦åˆ™ï¼Œä¼šåˆ©ç”¨ <code>Promise.race</code> API æ¥å®ç°å…·ä½“çš„åŠŸèƒ½ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<a href="https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FPromise%2Frace" target="_blank" rel="nofollow noopener noreferrer" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/race" ref="nofollow noopener noreferrer"><strong>Promise.race</strong></a> æ–¹æ³•ä¹Ÿå­˜åœ¨å…¼å®¹æ€§é—®é¢˜ï¼Œå…·ä½“å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/431968918a034a2c8597bc8bfcb48a46~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>ï¼ˆå›¾ç‰‡æ¥æº â€”â€” <a href="https://link.juejin.cn/?target=https%3A%2F%2Fcaniuse.com%2F%3Fsearch%3DPromise.race%25EF%25BC%2589" target="_blank" rel="nofollow noopener noreferrer" title="https://caniuse.com/?search=Promise.race%EF%BC%89" ref="nofollow noopener noreferrer">caniuse.com/?search=Proâ€¦</a></p>
<p>åŒæ ·ï¼Œå¯èƒ½æœ‰ä¸€äº›å°ä¼™ä¼´å¯¹ <a href="https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FPromise%2Frace" target="_blank" rel="nofollow noopener noreferrer" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/race" ref="nofollow noopener noreferrer"><strong>Promise.race</strong></a> è¿˜ä¸ç†Ÿæ‚‰ï¼Œå®ƒä¹Ÿæ˜¯ä¸€é“æŒºé«˜é¢‘çš„æ‰‹å†™é¢˜ã€‚æ‰€ä»¥ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥æ‰‹å†™ä¸€ä¸ªç®€æ˜“ç‰ˆçš„ <a href="https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FPromise%2Frace" target="_blank" rel="nofollow noopener noreferrer" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/race" ref="nofollow noopener noreferrer"><strong>Promise.race</strong></a>ï¼š</p>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-built_in">Promise</span>.race = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">iterators</span>) </span>&#123;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =></span> &#123;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> iter <span class="hljs-keyword">of</span> iterators) &#123;
      <span class="hljs-built_in">Promise</span>.resolve(iter)
        .then(<span class="hljs-function">(<span class="hljs-params">res</span>) =></span> &#123;
          resolve(res);
        &#125;)
        .catch(<span class="hljs-function">(<span class="hljs-params">e</span>) =></span> &#123;
          reject(e);
        &#125;);
    &#125;
  &#125;);
&#125;;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<h3 data-id="heading-29"><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-forever" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-forever" ref="nofollow noopener noreferrer">p-forever</a></h3>
<blockquote>
<p>Run promise-returning & async functions repeatedly until you end it</p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-forever" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-forever" ref="nofollow noopener noreferrer">github.com/sindresorhuâ€¦</a></p>
</blockquote>
<h4 data-id="heading-30">ä½¿ç”¨è¯´æ˜</h4>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-forever" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-forever" ref="nofollow noopener noreferrer">p-forever</a> é€‚ç”¨äºéœ€è¦é‡å¤ä¸æ–­æ‰§è¡Œ <strong>promise-returning</strong> æˆ– <strong>async</strong> å‡½æ•°ï¼Œç›´åˆ°ç”¨æˆ·ç»ˆæ­¢çš„åœºæ™¯ã€‚è¯¥æ¨¡å—é»˜è®¤å¯¼å‡ºäº†ä¸€ä¸ª <strong>pForever</strong> å‡½æ•°ï¼Œè¯¥å‡½æ•°çš„ç­¾åå¦‚ä¸‹ï¼š</p>
<blockquote>
<p><strong><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-forever" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-forever" ref="nofollow noopener noreferrer">pForever(fn, initialValue)</a></strong></p>
</blockquote>
<ul>
<li><code>fn: Function</code>ï¼šé‡å¤æ‰§è¡Œçš„å‡½æ•°ï¼›</li>
<li><code>initialValue</code>ï¼šä¼ é€’ç»™ <code>fn</code> å‡½æ•°çš„åˆå§‹å€¼ã€‚</li>
</ul>
<p>äº†è§£å®Œ <strong>pForever</strong> å‡½æ•°çš„ç­¾åä¹‹åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¯¥å‡½æ•°å¦‚ä½•ä½¿ç”¨ã€‚</p>
<h4 data-id="heading-31">ä½¿ç”¨ç¤ºä¾‹</h4>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">// p-forever/p-forever.test.js</span>
<span class="hljs-keyword">import</span> delay <span class="hljs-keyword">from</span> <span class="hljs-string">"delay"</span>;
<span class="hljs-keyword">import</span> pForever <span class="hljs-keyword">from</span> <span class="hljs-string">"p-forever"</span>;

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">main</span>(<span class="hljs-params"></span>) </span>&#123;
  <span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">await</span> pForever(<span class="hljs-keyword">async</span> () => (++index === <span class="hljs-number">10</span> ? pForever.end : delay(<span class="hljs-number">50</span>)));
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"å½“å‰indexçš„å€¼: "</span>, index); <span class="hljs-comment">// è¾“å‡ºç»“æœï¼šå½“å‰indexçš„å€¼: 10</span>
&#125;

main();
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>åœ¨ä»¥ä¸Šç¤ºä¾‹ä¸­ï¼Œä¼ å…¥ <code>pForever</code> å‡½æ•°çš„ <code>fn</code> å‡½æ•°ä¼šä¸€ç›´é‡å¤æ‰§è¡Œï¼Œç›´åˆ°è¯¥ <code>fn</code> å‡½æ•°è¿”å› <code>pForever.end</code> çš„å€¼ï¼Œæ‰ä¼šç»ˆæ­¢æ‰§è¡Œã€‚å› æ­¤ä»¥ä¸Šä»£ç æˆåŠŸæ‰§è¡Œåï¼Œå‘½ä»¤è¡Œçš„è¾“å‡ºç»“æœæ˜¯ï¼š<strong>å½“å‰indexçš„å€¼:  10</strong>ã€‚</p>
<h4 data-id="heading-32">æºç åˆ†æ</h4>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">// https://github.com/sindresorhus/p-forever/blob/main/index.js</span>
<span class="hljs-keyword">const</span> endSymbol = <span class="hljs-built_in">Symbol</span>(<span class="hljs-string">'pForever.end'</span>);

<span class="hljs-keyword">const</span> pForever = <span class="hljs-keyword">async</span> (function_, previousValue) => &#123;
<span class="hljs-keyword">const</span> newValue = <span class="hljs-keyword">await</span> function_(<span class="hljs-keyword">await</span> previousValue);
<span class="hljs-keyword">if</span> (newValue === endSymbol) &#123;
<span class="hljs-keyword">return</span>;
&#125;
<span class="hljs-keyword">return</span> pForever(function_, newValue);
&#125;;

pForever.end = endSymbol;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> pForever;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>ç”±ä»¥ä¸Šæºç å¯çŸ¥ï¼Œ<code>pForever</code> å‡½æ•°çš„å†…éƒ¨å®ç°å¹¶ä¸å¤æ‚ã€‚å½“åˆ¤æ–­ <code>newValue</code> çš„å€¼ä¸º <code>endSymbol</code> æ—¶ï¼Œå°±ç›´æ¥è¿”å›äº†ã€‚å¦åˆ™ï¼Œå°±ä¼šç»§ç»­è°ƒç”¨ <code>pForever</code> å‡½æ•°ã€‚é™¤äº†ä¸€ç›´é‡å¤æ‰§è¡Œä»»åŠ¡ä¹‹å¤–ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬ä¼šå¸Œæœ›æ˜¾å¼æŒ‡å®šä»»åŠ¡çš„æ‰§è¡Œæ¬¡æ•°ï¼Œé’ˆå¯¹è¿™ç§åœºæ™¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-times" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-times" ref="nofollow noopener noreferrer">p-times</a> æ¨¡å—ã€‚</p>
<h3 data-id="heading-33"><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-times" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-times" ref="nofollow noopener noreferrer">p-times</a></h3>
<blockquote>
<p>Run promise-returning & async functions a specific number of times concurrently</p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-times" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-times" ref="nofollow noopener noreferrer">github.com/sindresorhuâ€¦</a></p>
</blockquote>
<h4 data-id="heading-34">ä½¿ç”¨è¯´æ˜</h4>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-times" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-times" ref="nofollow noopener noreferrer">p-times</a> é€‚ç”¨äºæ˜¾å¼æŒ‡å®š <strong>promise-returning</strong> æˆ– <strong>async</strong> å‡½æ•°æ‰§è¡Œæ¬¡æ•°çš„åœºæ™¯ã€‚è¯¥æ¨¡å—é»˜è®¤å¯¼å‡ºäº†ä¸€ä¸ª <strong>pTimes</strong> å‡½æ•°ï¼Œè¯¥å‡½æ•°çš„ç­¾åå¦‚ä¸‹ï¼š</p>
<blockquote>
<p><strong><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-times" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-times" ref="nofollow noopener noreferrer">pTimes(count, mapper, options): Promise</a></strong></p>
</blockquote>
<ul>
<li><code>count: number</code>ï¼šè°ƒç”¨æ¬¡æ•°ï¼›</li>
<li><code>mapper(index): Function</code>ï¼šmapper å‡½æ•°ï¼Œè°ƒç”¨è¯¥å‡½æ•°åä¼šè¿”å› Promise å¯¹è±¡æˆ–æŸä¸ªå…·ä½“çš„å€¼ï¼›</li>
<li><code>options: object</code>
<ul>
<li><code>concurrency: number</code> â€”â€” å¹¶å‘æ•°ï¼Œé»˜è®¤å€¼ <code>Infinity</code>ï¼Œæœ€å°å€¼ä¸º <code>1</code>ï¼›</li>
<li><code>stopOnError: boolean</code> â€”â€” å‡ºç°å¼‚å¸¸æ—¶ï¼Œæ˜¯å¦ç»ˆæ­¢ï¼Œé»˜è®¤å€¼ä¸º <code>true</code>ã€‚</li>
</ul>
</li>
</ul>
<p>äº†è§£å®Œ <strong>pTimes</strong> å‡½æ•°çš„ç­¾åä¹‹åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¯¥å‡½æ•°å¦‚ä½•ä½¿ç”¨ã€‚</p>
<h4 data-id="heading-35">ä½¿ç”¨ç¤ºä¾‹</h4>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">// p-times/p-times.test.js</span>
<span class="hljs-keyword">import</span> delay <span class="hljs-keyword">from</span> <span class="hljs-string">"delay"</span>;
<span class="hljs-keyword">import</span> pTimes <span class="hljs-keyword">from</span> <span class="hljs-string">"p-times"</span>;

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">main</span>(<span class="hljs-params"></span>) </span>&#123;
  <span class="hljs-built_in">console</span>.time(<span class="hljs-string">"start"</span>);
  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> pTimes(<span class="hljs-number">5</span>, <span class="hljs-keyword">async</span> (i) => delay(<span class="hljs-number">50</span>, &#123; <span class="hljs-attr">value</span>: i * <span class="hljs-number">10</span> &#125;), &#123;
    <span class="hljs-attr">concurrency</span>: <span class="hljs-number">3</span>,
  &#125;);
  <span class="hljs-built_in">console</span>.dir(result);
  <span class="hljs-built_in">console</span>.timeEnd(<span class="hljs-string">"start"</span>);
&#125;

main();
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>åœ¨ä»¥ä¸Šç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ <code>pTimes</code> å‡½æ•°é…ç½® <strong>mapper</strong> å‡½æ•°çš„æ‰§è¡Œæ¬¡æ•°ä¸º <strong>5</strong> æ¬¡ï¼ŒåŒæ—¶è®¾ç½®ä»»åŠ¡çš„å¹¶å‘æ•°ä¸º <strong>3</strong>ã€‚å½“ä»¥ä¸Šä»£ç æˆåŠŸè¿è¡Œåï¼Œå‘½ä»¤è¡Œä¼šè¾“å‡ºä»¥ä¸‹ç»“æœï¼š</p>
<pre><code class="hljs language-shell copyable" lang="shell">[ 0, 10, 20, 30, 40 ]
start: 116.090ms
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>å¯¹äºä»¥ä¸Šç¤ºä¾‹ï¼Œä½ å¯ä»¥é€šè¿‡æ”¹å˜ <code>concurrency</code> çš„å€¼ï¼Œæ¥å¯¹æ¯”è¾“å‡ºçš„ç¨‹åºè¿è¡Œæ—¶é—´ã€‚é‚£ä¹ˆ <code>pTimes</code> å‡½æ•°å†…éƒ¨æ˜¯å¦‚ä½•å®ç°å¹¶å‘æ§åˆ¶çš„å‘¢ï¼Ÿå…¶å®è¯¥å‡½æ•°å†…éƒ¨ä¹Ÿæ˜¯åˆ©ç”¨ <code>pMap</code> å‡½æ•°æ¥å®ç°å¹¶å‘æ§åˆ¶ã€‚</p>
<h4 data-id="heading-36">æºç åˆ†æ</h4>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">// https://github.com/sindresorhus/p-times/blob/main/index.js</span>
<span class="hljs-keyword">import</span> pMap <span class="hljs-keyword">from</span> <span class="hljs-string">"p-map"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pTimes</span>(<span class="hljs-params">count, mapper, options</span>) </span>&#123;
  <span class="hljs-keyword">return</span> pMap(
    <span class="hljs-built_in">Array</span>.from(&#123; <span class="hljs-attr">length</span>: count &#125;).fill(),
    <span class="hljs-function">(<span class="hljs-params">_, index</span>) =></span> mapper(index),
    options
  );
&#125;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>åœ¨ <code>pTimes</code> å‡½æ•°ä¸­ï¼Œä¼šé€šè¿‡ <a href="https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FArray%2Ffrom" target="_blank" rel="nofollow noopener noreferrer" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/from" ref="nofollow noopener noreferrer">Array.from</a> æ–¹æ³•åˆ›å»ºæŒ‡å®šé•¿åº¦çš„æ•°ç»„ï¼Œç„¶åé€šè¿‡ <code>fill</code> æ–¹æ³•è¿›è¡Œå¡«å……ã€‚æœ€åå†æŠŠè¯¥æ•°ç»„ã€<code>mapper</code> å‡½æ•°å’Œ <code>options</code> é…ç½®å¯¹è±¡ï¼Œä½œä¸ºè¾“å…¥å‚æ•°è°ƒç”¨ <code>pMap</code> å‡½æ•°ã€‚å†™åˆ°è¿™é‡Œï¼Œé˜¿å®å“¥è§‰å¾— <code>pMap</code> å‡½æ•°æä¾›çš„åŠŸèƒ½è¿˜æ˜¯è›®å¼ºå¤§çš„ï¼Œå¾ˆå¤šæ¨¡å—çš„å†…éƒ¨éƒ½ä½¿ç”¨äº† <code>pMap</code> å‡½æ•°ã€‚</p>
<h3 data-id="heading-37"><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-pipe" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-pipe" ref="nofollow noopener noreferrer">p-pipe</a></h3>
<blockquote>
<p>Compose promise-returning & async functions into a reusable pipeline</p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-pipe" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-pipe" ref="nofollow noopener noreferrer">github.com/sindresorhuâ€¦</a></p>
</blockquote>
<h4 data-id="heading-38">ä½¿ç”¨è¯´æ˜</h4>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-pipe" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-pipe" ref="nofollow noopener noreferrer">p-pipe</a> é€‚ç”¨äºæŠŠ <strong>promise-returning</strong> æˆ– <strong>async</strong> å‡½æ•°ç»„åˆæˆå¯å¤ç”¨çš„ç®¡é“ã€‚è¯¥æ¨¡å—é»˜è®¤å¯¼å‡ºäº†ä¸€ä¸ª <strong>pPipe</strong> å‡½æ•°ï¼Œè¯¥å‡½æ•°çš„ç­¾åå¦‚ä¸‹ï¼š</p>
<blockquote>
<p><strong><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-pipe" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-pipe" ref="nofollow noopener noreferrer">pPipe(input...)</a></strong></p>
</blockquote>
<ul>
<li><code>input: Function</code>ï¼šæœŸæœ›è°ƒç”¨åä¼šè¿”å› Promise æˆ–ä»»ä½•å€¼çš„å‡½æ•°ã€‚</li>
</ul>
<p>äº†è§£å®Œ <strong>pPipe</strong> å‡½æ•°çš„ç­¾åä¹‹åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¯¥å‡½æ•°å¦‚ä½•ä½¿ç”¨ã€‚</p>
<h4 data-id="heading-39">ä½¿ç”¨ç¤ºä¾‹</h4>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">// p-pipe/p-pipe.test.js</span>
<span class="hljs-keyword">import</span> pPipe <span class="hljs-keyword">from</span> <span class="hljs-string">"p-pipe"</span>;

<span class="hljs-keyword">const</span> addUnicorn = <span class="hljs-keyword">async</span> (string) => <span class="hljs-string">`<span class="hljs-subst">$&#123;string&#125;</span> Unicorn`</span>;
<span class="hljs-keyword">const</span> addRainbow = <span class="hljs-keyword">async</span> (string) => <span class="hljs-string">`<span class="hljs-subst">$&#123;string&#125;</span> Rainbow`</span>;

<span class="hljs-keyword">const</span> pipeline = pPipe(addUnicorn, addRainbow);

(<span class="hljs-keyword">async</span> () => &#123;
  <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">await</span> pipeline(<span class="hljs-string">"â¤ï¸"</span>)); <span class="hljs-comment">// è¾“å‡ºç»“æœï¼šâ¤ï¸ Unicorn Rainbow</span>
&#125;)();
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>åœ¨ä»¥ä¸Šç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ <code>pPipe</code> å‡½æ•°æŠŠ <code>addUnicorn</code> å’Œ <code>addRainbow</code> è¿™ä¸¤ä¸ªå‡½æ•°ç»„åˆæˆä¸€ä¸ªæ–°çš„å¯å¤ç”¨çš„ç®¡é“ã€‚è¢«ç»„åˆå‡½æ•°çš„æ‰§è¡Œé¡ºåºæ˜¯ä»å·¦åˆ°å³ï¼Œæ‰€ä»¥ä»¥ä¸Šä»£ç æˆåŠŸè¿è¡Œåï¼Œå‘½ä»¤è¡Œä¼šè¾“å‡º <strong>â¤ï¸ Unicorn Rainbow</strong>ã€‚</p>
<h4 data-id="heading-40">æºç åˆ†æ</h4>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">// https://github.com/sindresorhus/p-pipe/blob/main/index.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pPipe</span>(<span class="hljs-params">...functions</span>) </span>&#123;
<span class="hljs-keyword">if</span> (functions.length === <span class="hljs-number">0</span>) &#123;
<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Expected at least one argument'</span>);
&#125;

<span class="hljs-keyword">return</span> <span class="hljs-keyword">async</span> input => &#123;
<span class="hljs-keyword">let</span> currentValue = input;

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> function_ <span class="hljs-keyword">of</span> functions) &#123;
currentValue = <span class="hljs-keyword">await</span> function_(currentValue); <span class="hljs-comment">// eslint-disable-line no-await-in-loop</span>
&#125;
<span class="hljs-keyword">return</span> currentValue;
&#125;;
&#125;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>ç”±ä»¥ä¸Šä»£ç å¯çŸ¥ï¼Œåœ¨ <code>pPipe</code> å‡½æ•°å†…éƒ¨æ˜¯åˆ©ç”¨ <strong><a href="https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FStatements%2Ffor...of" target="_blank" rel="nofollow noopener noreferrer" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/for...of" ref="nofollow noopener noreferrer">for...of</a></strong> è¯­å¥å’Œ <strong><a href="https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FLearn%2FJavaScript%2FAsynchronous%2FAsync_await" target="_blank" rel="nofollow noopener noreferrer" title="https://developer.mozilla.org/zh-CN/docs/Learn/JavaScript/Asynchronous/Async_await" ref="nofollow noopener noreferrer">async/await</a></strong> ç‰¹æ€§æ¥å®ç°ç®¡é“çš„åŠŸèƒ½ã€‚åˆ†æå®Œ <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fpromise-fun" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/promise-fun" ref="nofollow noopener noreferrer">promise-fun</a> é¡¹ç›®ä¸­çš„ 10 ä¸ªæ¨¡å—ä¹‹åï¼Œå†æ¬¡æ„Ÿå—åˆ° <strong><a href="https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FLearn%2FJavaScript%2FAsynchronous%2FAsync_await" target="_blank" rel="nofollow noopener noreferrer" title="https://developer.mozilla.org/zh-CN/docs/Learn/JavaScript/Asynchronous/Async_await" ref="nofollow noopener noreferrer">async/await</a></strong> ç‰¹æ€§ç»™å‰ç«¯å¼‚æ­¥ç¼–ç¨‹å¸¦æ¥çš„å·¨å¤§ä¾¿åˆ©ã€‚å…¶å®å¯¹äºå¼‚æ­¥çš„åœºæ™¯æ¥è¯´ï¼Œé™¤äº†å¯ä»¥ä½¿ç”¨ <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fpromise-fun" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/promise-fun" ref="nofollow noopener noreferrer">promise-fun</a> é¡¹ç›®ä¸­æ”¶å½•çš„æ¨¡å—ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fcaolan%2Fasync" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/caolan/async" ref="nofollow noopener noreferrer">async</a> æˆ– <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsuguru03%2Fneo-async" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/suguru03/neo-async" ref="nofollow noopener noreferrer">neo-async</a> è¿™ä¸¤ä¸ªå¼‚æ­¥å¤„ç†æ¨¡å—æä¾›çš„å·¥å…·å‡½æ•°ã€‚åœ¨ Webpack é¡¹ç›®ä¸­ï¼Œå°±ç”¨åˆ°äº† <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsuguru03%2Fneo-async" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/suguru03/neo-async" ref="nofollow noopener noreferrer">neo-async</a> è¿™ä¸ªæ¨¡å—ï¼Œè¯¥æ¨¡å—çš„ä½œè€…æ˜¯å¸Œæœ›ç”¨æ¥æ›¿æ¢ <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fcaolan%2Fasync" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/caolan/async" ref="nofollow noopener noreferrer">async</a> æ¨¡å—ï¼Œä»¥æä¾›æ›´å¥½çš„æ€§èƒ½ã€‚å»ºè®®éœ€è¦ç»å¸¸å¤„ç†å¼‚æ­¥åœºæ™¯çš„å°ä¼™ä¼´ï¼ŒæŠ½ç©ºæµè§ˆä¸€ä¸‹ <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsuguru03%2Fneo-async" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/suguru03/neo-async" ref="nofollow noopener noreferrer">neo-async</a> è¿™ä¸ªæ¨¡å—çš„ <strong><a href="https://link.juejin.cn/?target=http%3A%2F%2Fsuguru03.github.io%2Fneo-async%2Fdoc%2Findex.html" target="_blank" rel="nofollow noopener noreferrer" title="http://suguru03.github.io/neo-async/doc/index.html" ref="nofollow noopener noreferrer">å®˜æ–¹æ–‡æ¡£</a></strong>ã€‚</p>
<h3 data-id="heading-41">æ€»ç»“</h3>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fpromise-fun" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/promise-fun" ref="nofollow noopener noreferrer">promise-fun</a> é¡¹ç›®å…±æ”¶å½•äº† <strong>50</strong> ä¸ªä¸ Promise æœ‰å…³çš„æ¨¡å—ï¼Œè¯¥é¡¹ç›®çš„ä½œè€… <strong><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus" ref="nofollow noopener noreferrer">sindresorhus</a></strong> ä¸ªäººå°±å¼€å‘äº† <strong>48</strong> ä¸ªæ¨¡å—ï¼Œä¸æ„§æ˜¯å…¨èŒåšå¼€æºçš„å¤§ç‰›ã€‚ç”±äºç¯‡å¹…æœ‰é™ï¼Œé˜¿å®å“¥åªä»‹ç»äº†å…¶ä¸­ <strong>10</strong> ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„æ¨¡å—ã€‚å…¶å®è¯¥é¡¹ç›®è¿˜åŒ…å«ä¸€äº›æŒºä¸é”™çš„æ¨¡å—ï¼Œæ¯”å¦‚ <strong><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-queue" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-queue" ref="nofollow noopener noreferrer">p-queue</a></strong>ã€<strong><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-any" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-any" ref="nofollow noopener noreferrer">p-any</a></strong>ã€<strong><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-some" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-some" ref="nofollow noopener noreferrer">p-some</a></strong>ã€<strong><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-debounce" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-debounce" ref="nofollow noopener noreferrer">p-debounce</a></strong>ã€<strong><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-throttle" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-throttle" ref="nofollow noopener noreferrer">p-throttle</a></strong> å’Œ <strong><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsindresorhus%2Fp-timeout" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/sindresorhus/p-timeout" ref="nofollow noopener noreferrer">p-timeout</a></strong> ç­‰ã€‚æ„Ÿå…´è¶£çš„å°ä¼™ä¼´ï¼Œå¯ä»¥è‡ªè¡Œäº†è§£ä¸€ä¸‹å…¶ä»–çš„æ¨¡å—ã€‚</p>
<h3 data-id="heading-42">å‚è€ƒèµ„æº</h3>
<ul>
<li><a href="https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FArray%2FReduce" target="_blank" rel="nofollow noopener noreferrer" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce" ref="nofollow noopener noreferrer">MDN â€” Array.prototype.reduce()</a></li>
<li><a href="https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FArray%2Ffrom" target="_blank" rel="nofollow noopener noreferrer" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/from" ref="nofollow noopener noreferrer">MDN â€” Array.from</a></li>
<li><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fdomenic%2Fpromises-unwrapping%2Fissues%2F75" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/domenic/promises-unwrapping/issues/75" ref="nofollow noopener noreferrer">Promise.race with empty lists</a></li>
<li><a href="https://link.juejin.cn/?target=http%3A%2F%2Fsuguru03.github.io%2Fneo-async%2Fdoc%2Findex.html" target="_blank" rel="nofollow noopener noreferrer" title="http://suguru03.github.io/neo-async/doc/index.html" ref="nofollow noopener noreferrer">neo-async å®˜æ–¹æ–‡æ¡£</a></li>
</ul></div>  
</div>
            