
---
title: '轻松三步写一个扫一扫组件'
categories: 
 - 编程
 - 掘金
 - 分类
headimg: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/888077d688c74ea8b681d02b6636f8cd~tplv-k3u1fbpfcp-watermark.image'
author: 掘金
comments: false
date: Sat, 07 Aug 2021 22:08:46 GMT
thumbnail: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/888077d688c74ea8b681d02b6636f8cd~tplv-k3u1fbpfcp-watermark.image'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><p>之前有搞过相机组件，如今也遇到了需求，顺便记录一下。</p>
<p>主要分为以下三步：</p>
<blockquote>
<ol>
<li>组件版本及实现功能介绍。</li>
<li>安装使用。</li>
<li>界面实现。</li>
</ol>
</blockquote>
<p>先上最终实现效果图： </p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/888077d688c74ea8b681d02b6636f8cd~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer">​</p>
<hr>
<h2 data-id="heading-0">一，版本介绍</h2>
<p>以下是项目中使用的版本信息：</p>
<pre><code class="copyable">"react": "16.8.6",
"react-native": "0.60.5",
"react-native-camera": "^3.8.0"
<span class="copy-code-btn">复制代码</span></code></pre>
<p>想实现的功能是，<strong>可以扫描二维码，同时下方有按钮可以拍照及打开闪光灯</strong>。</p>
<h2 data-id="heading-1"></h2>
<hr>
<h2 data-id="heading-2">二，安装使用</h2>
<p>在 React-Native 0.60之后，安装使用非常的简单，而且不需要 link 。</p>
<p>1，首先，在项目根目录下执行 npm 安装命令，如下：</p>
<pre><code class="copyable">npm install react-native-camera@3.8.0
<span class="copy-code-btn">复制代码</span></code></pre>
<p>2，然后 ，需要 cd 进入 iOS 目录，执行 pod install，自动安装 iOS 端所需依赖。</p>
<p>3，需要在 iOS 的 Info.plist 中配置相机与麦克风权限，在安卓的 AndroidManifest.xml 中配置权限，如下图：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e43150c813984bfca5a8e6ac3e72b258~tplv-k3u1fbpfcp-watermark.image" alt="iOS权限配置" loading="lazy" referrerpolicy="no-referrer">​</p>
<p>iOS 权限配置</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/472b10cce0fc4909928155af14b73575~tplv-k3u1fbpfcp-watermark.image" alt="android 权限配置" loading="lazy" referrerpolicy="no-referrer">​</p>
<p>android 权限配置</p>
<pre><code class="copyable">// android 添加至 AndroidManifest.xml 中
    <uses-permission android:name="android.permission.RECORD_AUDIO"/>
    <uses-permission android:name="android.permission.CAMERA"/>

// iOS 到 info.plist 中选择如下
    Privacy - Microphone Usage Description
    Privacy - Camera Usage Description
<span class="copy-code-btn">复制代码</span></code></pre>
<p>4，在 android/app/build.gradle 中增加如下配置：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/99424657336c4cefa0e2c5ababcbbdf8~tplv-k3u1fbpfcp-watermark.image" alt="android build.gradle 配置" loading="lazy" referrerpolicy="no-referrer">​</p>
<p>android build.gradle 配置</p>
<hr>
<h2 data-id="heading-3">三，界面实现 </h2>
<p>界面如下，包含返回、拍照及闪光灯（<em>PS：由于模拟器，没有摄像头故是黑的</em>）。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a1b60c0e12734685bb44a2e3ddd4da81~tplv-k3u1fbpfcp-watermark.image" alt="扫一扫界面" loading="lazy" referrerpolicy="no-referrer">​</p>
<p>扫一扫界面</p>
<p>拍照或识别到二维码后，跳转到结果页面：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f66d0ccac71e48fb91b27e0c68524fe3~tplv-k3u1fbpfcp-watermark.image" alt="结果扫描页面" loading="lazy" referrerpolicy="no-referrer">​</p>
<p>结果扫描页面</p>
<p> 具体代码如下：</p>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">/**
 * Created by supervons on 2019/10/20.
 * 扫一扫及拍照页面
 * explore page
 */</span>
<span class="hljs-keyword">import</span> React, &#123; Component &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> &#123;
  StyleSheet,
  Text,
  TouchableOpacity,
  View,
  Animated,
  Easing
&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'react-native'</span>;
<span class="hljs-keyword">import</span> &#123; RNCamera &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'react-native-camera'</span>;
<span class="hljs-keyword">import</span> &#123;Icon, IconType&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'react-native-elements'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Scanner</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>&#123;
  <span class="hljs-function"><span class="hljs-title">constructor</span>(<span class="hljs-params">props</span>)</span> &#123;
    <span class="hljs-built_in">super</span>(props);
    <span class="hljs-built_in">this</span>.state = &#123;
      <span class="hljs-attr">moveAnim</span>: <span class="hljs-keyword">new</span> Animated.Value(<span class="hljs-number">0</span>),
      <span class="hljs-attr">FlashMode</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">showCamera</span>: <span class="hljs-literal">true</span>
    &#125;;
    <span class="hljs-built_in">this</span>.isBarcodeRead = <span class="hljs-literal">false</span>;
  &#125;

  <span class="hljs-comment">// 去掉导航条设置，全屏扫描</span>
  <span class="hljs-keyword">static</span> navigationOptions = &#123;
    <span class="hljs-attr">header</span>: <span class="hljs-literal">null</span>
  &#125;;

  <span class="hljs-function"><span class="hljs-title">componentDidMount</span>(<span class="hljs-params"></span>)</span> &#123;
    <span class="hljs-built_in">this</span>.startAnimation();
    <span class="hljs-comment">// 监听当结果页返回时，重新启动相机监听扫描事件</span>
    <span class="hljs-built_in">this</span>.props.navigation.addListener(<span class="hljs-string">"didFocus"</span>, <span class="hljs-function">() =></span>
        <span class="hljs-built_in">this</span>.setState(&#123;<span class="hljs-attr">showCamera</span> : <span class="hljs-literal">true</span>&#125;)
    )
  &#125;

  startAnimation = <span class="hljs-function">() =></span> &#123;
    <span class="hljs-built_in">this</span>.state.moveAnim.setValue(-<span class="hljs-number">200</span>);
    Animated.timing(<span class="hljs-built_in">this</span>.state.moveAnim, &#123;
      <span class="hljs-attr">toValue</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">duration</span>: <span class="hljs-number">1500</span>,
      <span class="hljs-attr">easing</span>: Easing.linear
    &#125;).start(<span class="hljs-function">() =></span> <span class="hljs-built_in">this</span>.startAnimation());
  &#125;;

  <span class="hljs-comment">// 扫描事件</span>
  onBarCodeRead = <span class="hljs-function"><span class="hljs-params">result</span> =></span> &#123;
    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.isBarcodeRead) &#123;
      <span class="hljs-built_in">this</span>.isBarcodeRead = <span class="hljs-literal">true</span>;
      <span class="hljs-comment">// 卸载扫一扫组件，否则还会持续扫描</span>
      <span class="hljs-built_in">this</span>.setState(&#123;<span class="hljs-attr">showCamera</span>: <span class="hljs-literal">false</span>&#125;)
      <span class="hljs-built_in">this</span>.props.navigation.navigate(<span class="hljs-string">'ScannerResult'</span>, &#123;
        <span class="hljs-attr">imageUri</span>: <span class="hljs-literal">null</span>,
        <span class="hljs-attr">scannerResult</span>: <span class="hljs-built_in">JSON</span>.stringify(result)
      &#125;);
    &#125;
  &#125;;

  <span class="hljs-comment">// 拍照事件</span>
  takePicture = <span class="hljs-keyword">async</span> () => &#123;
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.camera) &#123;
      <span class="hljs-keyword">const</span> options = &#123; <span class="hljs-attr">quality</span>: <span class="hljs-number">0.5</span>, <span class="hljs-attr">base64</span>: <span class="hljs-literal">true</span> &#125;;
      <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-built_in">this</span>.camera.takePictureAsync(options);
      <span class="hljs-built_in">this</span>.setState(&#123;<span class="hljs-attr">showCamera</span>: <span class="hljs-literal">false</span>&#125;)
      <span class="hljs-built_in">this</span>.props.navigation.push(<span class="hljs-string">'ScannerResult'</span>, &#123;
        <span class="hljs-attr">imageUri</span>: data.uri,
        <span class="hljs-attr">scannerResult</span>: <span class="hljs-string">''</span>
      &#125;);
    &#125;
  &#125;;

  <span class="hljs-comment">// 闪光灯开关</span>
  <span class="hljs-function"><span class="hljs-title">_changeFlashMode</span>(<span class="hljs-params"></span>)</span> &#123;
    <span class="hljs-built_in">this</span>.setState(&#123;
      <span class="hljs-attr">FlashMode</span>: !<span class="hljs-built_in">this</span>.state.FlashMode
    &#125;);
  &#125;

  <span class="hljs-function"><span class="hljs-title">render</span>(<span class="hljs-params"></span>)</span> &#123;
    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag"><<span class="hljs-name">View</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;styles.container&#125;</span>></span>
        &#123;this.state.showCamera ? (
          <span class="hljs-tag"><<span class="hljs-name">RNCamera</span>
            <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;ref</span> =></span> &#123;
              this.camera = ref;
            &#125;&#125;
            style=&#123;styles.preview&#125;
            type=&#123;RNCamera.Constants.Type.back&#125;
            flashMode=&#123;this.state.FlashMode ? 1 : 0&#125;
            onBarCodeRead=&#123;this.onBarCodeRead&#125;
          >
            <span class="hljs-tag"><<span class="hljs-name">View</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;styles.rectangleContainer&#125;</span>></span>
              <span class="hljs-tag"><<span class="hljs-name">View</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;styles.rectangle&#125;</span> /></span>
              <span class="hljs-tag"><<span class="hljs-name">Animated.View</span>
                <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;[</span>
                  <span class="hljs-attr">styles.border</span>,
                  &#123; <span class="hljs-attr">transform:</span> [&#123; <span class="hljs-attr">translateY:</span> <span class="hljs-attr">this.state.moveAnim</span> &#125;] &#125;
                ]&#125;
              /></span>
              <span class="hljs-tag"><<span class="hljs-name">Text</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;styles.rectangleText&#125;</span>></span>
                将二维码放入框内，即可自动扫描
              <span class="hljs-tag"></<span class="hljs-name">Text</span>></span>
              <span class="hljs-tag"><<span class="hljs-name">View</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">flexDirection:</span> '<span class="hljs-attr">row</span>', <span class="hljs-attr">marginTop:</span> <span class="hljs-attr">15</span> &#125;&#125;></span>
                <span class="hljs-tag"><<span class="hljs-name">TouchableOpacity</span>
                  <span class="hljs-attr">onPress</span>=<span class="hljs-string">&#123;()</span>=></span>this.props.navigation.goBack()&#125;
                >
                  <span class="hljs-tag"><<span class="hljs-name">Icon</span> <span class="hljs-attr">name</span>=<span class="hljs-string">'keyboard-arrow-left'</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&#123;36&#125;</span> <span class="hljs-attr">color</span>=<span class="hljs-string">&#123;</span>'<span class="hljs-attr">green</span>'&#125;/></span>
                <span class="hljs-tag"></<span class="hljs-name">TouchableOpacity</span>></span>
                <span class="hljs-tag"><<span class="hljs-name">TouchableOpacity</span>
                  <span class="hljs-attr">onPress</span>=<span class="hljs-string">&#123;this.takePicture.bind(this)&#125;</span>
                  <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;marginLeft:</span> <span class="hljs-attr">25</span>&#125;&#125;
                ></span>
                  <span class="hljs-tag"><<span class="hljs-name">Icon</span> <span class="hljs-attr">name</span>=<span class="hljs-string">'camera'</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&#123;36&#125;</span> <span class="hljs-attr">color</span>=<span class="hljs-string">&#123;</span>'<span class="hljs-attr">green</span>'&#125;/></span>
                <span class="hljs-tag"></<span class="hljs-name">TouchableOpacity</span>></span>
                <span class="hljs-tag"><<span class="hljs-name">TouchableOpacity</span>
                  <span class="hljs-attr">onPress</span>=<span class="hljs-string">&#123;this._changeFlashMode.bind(this)&#125;</span>
                  <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;marginLeft:</span> <span class="hljs-attr">25</span>&#125;&#125;
                ></span>
                  <span class="hljs-tag"><<span class="hljs-name">Icon</span> <span class="hljs-attr">name</span>=<span class="hljs-string">'highlight'</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&#123;36&#125;</span> <span class="hljs-attr">color</span>=<span class="hljs-string">&#123;this.state.FlashMode</span> ? '<span class="hljs-attr">green</span>' <span class="hljs-attr">:</span> '<span class="hljs-attr">gray</span>'&#125;/></span>
                <span class="hljs-tag"></<span class="hljs-name">TouchableOpacity</span>></span>
              <span class="hljs-tag"></<span class="hljs-name">View</span>></span>
            <span class="hljs-tag"></<span class="hljs-name">View</span>></span>
          <span class="hljs-tag"></<span class="hljs-name">RNCamera</span>></span>
        ) : (
          <span class="hljs-tag"><<span class="hljs-name">View</span> /></span>
        )&#125;
      <span class="hljs-tag"></<span class="hljs-name">View</span>></span></span>
    );
  &#125;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p><img src="https://juejin.cn/post/6993935714912206878" alt title="点击并拖拽以移动" loading="lazy" referrerpolicy="no-referrer"></p>
<p>CSS如下 </p>
<pre><code class="copyable">  text: &#123;
    color: '#fff',
    fontSize: 30,
    fontWeight: 'bold'
  &#125;,
  container: &#123;
    flex: 1,
    flexDirection: 'column'
  &#125;,
  preview: &#123;
    flex: 1,
    justifyContent: 'flex-end',
    alignItems: 'center'
  &#125;,
  rectangleContainer: &#123;
    flex: 1,
    alignItems: 'center',
    justifyContent: 'center',
    backgroundColor: 'transparent'
  &#125;,
  rectangle: &#123;
    height: 200,
    width: 200,
    borderWidth: 1,
    borderColor: '#00FF00',
    backgroundColor: 'transparent'
  &#125;,
  rectangleText: &#123;
    flex: 0,
    color: '#fff',
    marginTop: 10
  &#125;,
  border: &#123;
    flex: 0,
    width: 195,
    height: 2,
    backgroundColor: '#00FF00'
  &#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>git项目地址：<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fsupervons%2FExploreRN" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/supervons/ExploreRN" ref="nofollow noopener noreferrer">github.com/supervons/E…</a></p></div>  
</div>
            