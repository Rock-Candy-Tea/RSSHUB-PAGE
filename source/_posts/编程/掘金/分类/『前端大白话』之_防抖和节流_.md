
---
title: '『前端大白话』之_防抖和节流_'
categories: 
 - 编程
 - 掘金
 - 分类
headimg: 'https://picsum.photos/400/300?random=3421'
author: 掘金
comments: false
date: Sun, 06 Jun 2021 18:33:13 GMT
thumbnail: 'https://picsum.photos/400/300?random=3421'
---

<div>   
<div class="markdown-body"><style>@charset "UTF-8";.markdown-body&#123;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace;letter-spacing:2px;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%;word-break:break-word;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1&#123;font-size:25px;margin-bottom:5px;border-left:5px solid #773098&#125;.markdown-body h1,.markdown-body h2&#123;display:inline-block;font-weight:700;padding-left:10px&#125;.markdown-body h2&#123;font-size:18px;border-left:5px solid #916dd5&#125;.markdown-body h3&#123;font-size:16px;font-weight:700;padding-left:10px;border-left:5px solid #d89cf6&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;border-radius:6px;display:block;margin:20px auto;object-fit:contain;box-shadow:2px 4px 7px #999&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;padding:.2em .5em;font-weight:700;font-size:1em;color:#916dd5;word-break:break-word;overflow-x:auto;background-color:none;border-radius:2px&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;display:block;font-size:12px;padding:16px 12px;margin:0;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#916dd5;font-weight:700;border-bottom:1px solid #916dd5&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#773098&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #916dd5&#125;.markdown-body thead&#123;background-color:#916dd5;color:#fff;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#d89cf6&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #d89cf6;background-color:#f4eeff&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0;line-height:26px&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px;list-style-type:circle&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body b,.markdown-body strong&#123;color:#916dd5;font-weight:700&#125;.markdown-body b:before,.markdown-body strong:before&#123;content:"「"&#125;.markdown-body b:after,.markdown-body strong:after&#123;content:"」"&#125;.markdown-body em,.markdown-body i&#123;color:#916dd5&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><h1 data-id="heading-0">防抖和节流</h1>
<p>面试经常被问到防抖和节流的问题，其实很多概念都只是讲的很 “高大上”（个人愚见），以至于听起来就很懵。
今天就用大白话和大家聊聊「防抖和节流」到底是个啥。</p>
<h2 data-id="heading-1">为啥会出现这么两个概念？</h2>
<p>首先，防抖和节流当然不是凭空出现的，它是来解决问题的。解决啥问题呢？</p>
<p>比如网页上有一个下载按钮，这个按钮是下载图片用的，点一下就可以把这张图直接下载到你的电脑里。那么无论你是成心之过还是无意之举，在一秒钟内你用你单身20年无与伦比的手速抱着把鼠标点坏的决心点了 500 次，然后你的电脑里就有了 500 张相同的图片。</p>
<p>怎么样，感觉还爽吗？23333……</p>
<p>这种情况显然不合理，我所说的不合理不是说你没有那么快的手速，而是说程序允许你在短时间内可以连续的触发同一个事件，这件事它不合理。因为且不说你不需要 500 张一模一样的图，短时间内这么做对程序和服务器的带宽都是一种压力。</p>
<p>于是乎，「防抖和节流」它就 lei 了……</p>
<p>它们就是来解决这个问题滴~（当然这种情况很多，不光是点击按钮。）</p>
<h2 data-id="heading-2">什么是防抖</h2>
<p>防抖，英文：debounce。</p>
<h3 data-id="heading-3">非立即执行版</h3>
<blockquote>
<p>触发事件后函数不会立即执行，而是在 n 秒后执行，如果在 n 秒内又触发了事件，则会重新计算函数执行时间。<br>
也就是说当一次事件发生后，事件处理器要等一定时间，如果这段时间过去后再也没有事件发生，就处理最后一次发生的事件。</p>
</blockquote>
<p><em>啥意思？</em></p>
<p>假设你点了一个按钮（一次事件），我现在设定你点了按钮后必须过 1 秒才能生效（执行事件）。结果还差 0.01 秒就到达指定时间，也就是过了 0.99 秒，这时候你按捺不住自己内心的躁动与渴望又点了一次按钮（又发生了一次事件），那么恭喜你，之前的等待作废，需要重新再等待 1 秒（指定时间）。直到...直到你点了一次按钮之后 1 秒都没有动作，然后才会生效。</p>
<h3 data-id="heading-4">立即执行版</h3>
<blockquote>
<p>触发事件后函数会立即执行，然后 n 秒内不触发事件才能继续执行函数。如果在 n 秒内又触发了事件，则会重新计算函数执行时间。</p>
</blockquote>
<p><em>啥意思？</em></p>
<p>emmm...这么聪明的你应该能举一反三了吧！</p>
<p>其实就是点了按钮会马上执行一次。然后...然后又和非立即执行版一个“德行”了...<br>
你再点，他又得重新等 1 秒，你一直点，它就一直不执行，直到你点完之后一秒内不点了才会执行。</p>
<h3 data-id="heading-5">话不多说</h3>
<h4 data-id="heading-6">非立即执行版：</h4>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">debounce1</span>(<span class="hljs-params">fn, delay</span>) </span>&#123;
    <span class="hljs-comment">//注意下面不要用箭头函数，注意this和arguments的指向</span>
    <span class="hljs-keyword">let</span> timer = <span class="hljs-literal">null</span>; <span class="hljs-comment">//通过闭包保存一个标记</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;
        <span class="hljs-keyword">if</span> (timer) &#123;
            <span class="hljs-built_in">clearTimeout</span>(timer);
        &#125;
        <span class="hljs-comment">//若有timer，就清除timer，所以会重新执行下面的定时器，重新定时。</span>
        timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =></span> &#123;
            fn.apply(<span class="hljs-built_in">this</span>, <span class="hljs-built_in">arguments</span>);
        &#125;, delay);
    &#125;
&#125;
<span class="hljs-comment">//对比两种写法</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">debounce2</span>(<span class="hljs-params">fn, delay</span>) </span>&#123;
    <span class="hljs-keyword">let</span> timer = <span class="hljs-literal">null</span>;
    <span class="hljs-comment">//注意下面不要用箭头函数，注意this和arguments的指向</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">...args</span>) </span>&#123;
        <span class="hljs-keyword">let</span> context = <span class="hljs-built_in">this</span>;
        <span class="hljs-keyword">if</span> (timer) &#123;
            <span class="hljs-built_in">clearTimeout</span>(timer);
        &#125;
        timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;
            fn.apply(context, args);
        &#125;, delay);
    &#125;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<h4 data-id="heading-7">立即执行版：</h4>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">debounce_</span>(<span class="hljs-params">fn, delay, immediate</span>) </span>&#123;
    <span class="hljs-keyword">let</span> timer = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;
        <span class="hljs-keyword">if</span> (timer) &#123;
            <span class="hljs-built_in">clearTimeout</span>(timer);
        &#125;
        timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =></span> &#123;
            immediate = <span class="hljs-literal">true</span>;
        &#125;, delay);
        <span class="hljs-comment">//以上代码每次点击都会执行。</span>
        <span class="hljs-comment">//若定时器没有结束，则immediate为false，下面代码else永远不会执行。</span>
        <span class="hljs-comment">//而return false之后若再重新执行此函数，又会清除掉定时器，再重新开一个timer，则会重新计算时间。</span>
        <span class="hljs-keyword">if</span> (!immediate) &#123;
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        &#125; <span class="hljs-keyword">else</span> &#123;
            fn.apply(<span class="hljs-built_in">this</span>, <span class="hljs-built_in">arguments</span>);
            immediate = <span class="hljs-literal">false</span>;
        &#125;
    &#125;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<h4 data-id="heading-8">合并版：</h4>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">//最终合并完整版</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">debounce</span>(<span class="hljs-params">fn, delay, immediate</span>) </span>&#123;
    <span class="hljs-keyword">let</span> timer = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">let</span> canRun = immediate;
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;
        <span class="hljs-keyword">if</span> (timer) &#123;
            <span class="hljs-built_in">clearTimeout</span>(timer);
        &#125;
        <span class="hljs-keyword">if</span> (immediate) &#123;
            timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =></span> &#123;
                canRun = <span class="hljs-literal">true</span>;
            &#125;, delay);
            <span class="hljs-comment">//用canRun代替了immediate</span>
            <span class="hljs-keyword">if</span> (!canRun) &#123;
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            &#125; <span class="hljs-keyword">else</span> &#123;
                fn.apply(<span class="hljs-built_in">this</span>, <span class="hljs-built_in">arguments</span>);
                canRun = <span class="hljs-literal">false</span>;
            &#125;
        &#125; <span class="hljs-keyword">else</span> &#123;
            timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =></span> &#123;
                fn.apply(<span class="hljs-built_in">this</span>, <span class="hljs-built_in">arguments</span>);
            &#125;,delay);
        &#125;
    &#125;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<h2 data-id="heading-9">什么是节流</h2>
<p>节流，英文：throttle。</p>
<blockquote>
<p>节流就是类似控制阀门一样定期开放的函数，也就是让函数执行一次后，在某个时间段内暂时失效，过了这段时间后再重新激活，喜欢玩 moba 类游戏的同学厉害了，这个东西就类似于技能冷却（技能 cd）。</p>
</blockquote>
<p><em>大白话</em></p>
<p>实际上这个函数的作用就是如此，它可以将一个函数的调用频率限制在一定阈值内，例如 1 秒，那么 1 秒内这个函数一定不会被调用两次。</p>
<p>说白了就是一个按钮你一直不停的点点点点点，其实它一秒就能执行一次。换做讲防抖开始时候那个极不贴切的下载图片的例子就是，即便你十秒内点了一万次，其实你也就只能一秒下载一张图，一共十张而已。</p>
<h3 data-id="heading-10">上代码</h3>
<p><strong>两种思路</strong></p>
<h4 data-id="heading-11">第一种思路：</h4>
<blockquote>
<p>判断当前时间和上一次执行时间的时间差，如果这个时间差大于阈值，才让其执行。</p>
</blockquote>
<p>意思就是当你点击按钮的时候，我判断一下你现在是几点几分几秒点击的按钮，然后减去上一次你点击按钮的时间，看看这个时间差有没有到 1 秒钟。没有上次点击咋办？凉拌（白眼）！</p>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">throttle_</span>(<span class="hljs-params">fn, time</span>) </span>&#123;
    <span class="hljs-keyword">let</span> pre = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">...args</span>) </span>&#123;
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Date</span>.now() - pre > time) &#123;
            fn.apply(<span class="hljs-built_in">this</span>, args);
            pre = <span class="hljs-built_in">Date</span>.now();
        &#125;
    &#125;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<h4 data-id="heading-12">第二种思路：</h4>
<blockquote>
<p>设置一个开关阀门（标记）。如果你点击了一次按钮，就把阀门关了，等 1 秒后再开阀门，也就是技能冷却的思路。</p>
</blockquote>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">throttle</span>(<span class="hljs-params">fn, delay</span>) </span>&#123;
    <span class="hljs-keyword">let</span> canRun = <span class="hljs-literal">true</span>,
    timer = <span class="hljs-literal">null</span>; <span class="hljs-comment">// 通过闭包保存标记</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;
        <span class="hljs-comment">// 在函数开头判断标记是否为true，不为true则return</span>
        <span class="hljs-keyword">if</span> (!canRun) &#123;
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        &#125;
        <span class="hljs-comment">//定时器的作用：当delay秒过后，canRun才能变为true，代码才能执行到这里，才能继续往下执行</span>
        canRun = <span class="hljs-literal">false</span>; <span class="hljs-comment">// 立即设置为false</span>
        <span class="hljs-built_in">clearTimeout</span>(timer);
        timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =></span> &#123; <span class="hljs-comment">// 将外部传入的函数的执行放在setTimeout中</span>
            fn.apply(<span class="hljs-built_in">this</span>, <span class="hljs-built_in">arguments</span>);
            <span class="hljs-comment">// 最后在setTimeout执行完毕后再把标记设置为true(关键)表示可以执行下一次循环了。当定时器没有执行的时候标记永远false，在开头被return掉</span>
            canRun = <span class="hljs-literal">true</span>;
        &#125;, delay);
    &#125;;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<h2 data-id="heading-13">写在最后</h2>
<p>若文中有什么错误的地方，欢迎批评指导。若您有更好的方案或者写法，也欢迎留言。</p></div>  
</div>
            