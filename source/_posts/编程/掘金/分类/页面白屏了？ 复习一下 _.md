
---
title: '页面白屏了？ 复习一下 _.'
categories: 
 - 编程
 - 掘金
 - 分类
headimg: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9b500d2f4bd648f2a92195b4540af3a7~tplv-k3u1fbpfcp-zoom-1.image'
author: 掘金
comments: false
date: Sat, 22 May 2021 23:26:18 GMT
thumbnail: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9b500d2f4bd648f2a92195b4540af3a7~tplv-k3u1fbpfcp-zoom-1.image'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9b500d2f4bd648f2a92195b4540af3a7~tplv-k3u1fbpfcp-zoom-1.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<h1 data-id="heading-0">背景</h1>
<p>今天又被 QA 找: 这个页面昨天还好好的, 今天就白屏了, 是不是你代码有问题啊, 赶紧看看。</p>
<p>上去一看， 找到了原因：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/78d83a65b7ba4bdc9367fabc5c6b0cd6~tplv-k3u1fbpfcp-zoom-1.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>原本 <code>pickup</code>, <code>dropoff</code> 两个字段没有数据的话， 应该返回<code>&#123;&#125;</code>, 结果现在<code>pickup</code>字段返回了<code>null</code>, 而我们取值的时候，也没对这个地方做防御。</p>
<pre><code class="hljs language-css copyable" lang="css">list: openApiOrderInfo.pickup.address_list,
<span class="copy-code-btn">复制代码</span></code></pre>
<p>结果就是：<code>脚本报错， 页面不可用。</code></p>
<p>解决起来也很简单， 要么给个<code>默认值</code>， 要么使用 <code>?.</code> 做一层防御。</p>
<p>改完再试一下， 就 OK 了， 页面恢复正常。</p>
<p>下面我们就说一下这个 <code>?.</code></p>
<p>今天的主要内容：</p>
<ul>
<li>什么是可选链操作符(<code>?.</code>)</li>
<li>如何启用这个功能</li>
<li>可选链操作符(<code>?.</code>) 是如何工作的</li>
<li><code>Heny</code>发布的相关些资料</li>
<li>总结</li>
</ul>
<h1 data-id="heading-1">正文语种</h1>
<p>可选链操作符(<code>?.</code>)， 大家都很熟悉了，这里再简单回顾一下。</p>
<h2 data-id="heading-2">什么是可选链操作符(<code>?.</code>)</h2>
<p>可选链操作符(<code>?.</code>)允许读取位于连接对象链深处的属性的值，而不必明确验证链中的每个引用是否有效。</p>
<p>比如，思考一个存在嵌套结构的对象 obj。不使用可选链的话，查找一个深度嵌套的子属性时，需要验证之间的引用，例如：</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">let</span> nestedProp = obj.first && obj.first.second;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>为了避免报错，在访问obj.first.second之前，要保证 obj.first 的值既不是 null，也不是 undefined。</p>
<p>如果只是直接访问 obj.first.second，而不对 obj.first 进行校验，则有可能抛出错误。</p>
<p>有了可选链操作符（?.），在访问 obj.first.second 之前，不再需要明确地校验 obj.first 的状态，再并用短路计算获取最终结果：</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">let</span> nestedProp = obj.first?.second;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>这等价于以下表达式，但实际上没有创建临时变量：</p>
<pre><code class="copyable">let temp = obj.first;
let nestedProp = ((temp === null || temp === undefined) ? undefined : temp.second);
<span class="copy-code-btn">复制代码</span></code></pre>
<p><code>?.</code> 操作符的功能类似于 <code>.</code> 链式操作符，不同之处在于：</p>
<p>在引用为空(nullish) (<code>null</code> 或者 <code>undefined</code>) 的情况下<code>不会引起错误</code>，该表达式短路返回值是: <code>undefined</code>。</p>
<p>与函数调用一起使用时，如果给定的函数不存在，则返回 <code>undefined</code>。</p>
<p>当尝试访问<code>可能不存在的对象属性</code>时，使用<code>可选链操作符</code>将会使表达式<code>更短、更简明</code>。</p>
<p>有两点需要我们留意：</p>
<ol>
<li>如果存在一个属性名且不是函数, 使用 ?. 仍然会产生一个 TypeError 异常 (x.y is not a function).</li>
</ol>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">let</span> result = someInterface.customMethod?.();
<span class="copy-code-btn">复制代码</span></code></pre>
<p>如果 someInterface 自身是 null 或者 undefined ，异常 <code>TypeError</code> 仍会被抛出。</p>
<p>如果你希望允许 someInterface 也为 <code>null</code> 或者 <code>undefined</code>，那么你需要像这样写 <code>someInterface?.customMethod?.()</code></p>
<ol start="2">
<li>可选链<code>不能用于赋值</code></li>
</ol>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">let</span> object = &#123;&#125;;
object?.property = <span class="hljs-number">1</span>; <span class="hljs-comment">// Uncaught SyntaxError: Invalid left-hand side in assignment</span>
<span class="copy-code-btn">复制代码</span></code></pre>
<h2 data-id="heading-3">如何启用这个功能</h2>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-comment">// install</span>
npm install --save-dev @babel/plugin-proposal-optional-chaining

<span class="hljs-comment">// babel config</span>
&#123;
 <span class="hljs-string">"plugins"</span>: [
    <span class="hljs-string">"@babel/plugin-proposal-optional-chaining"</span> <span class="hljs-comment">//可选链</span>
    <span class="hljs-string">"@babel/plugin-proposal-nullish-coalescing-operator"</span>, <span class="hljs-comment">//双问号</span>
  ]
&#125;

<span class="copy-code-btn">复制代码</span></code></pre>
<h2 data-id="heading-4">可选链操作符(<code>?.</code>) 是如何工作的</h2>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">const</span> a = &#123;
  <span class="hljs-attr">b</span>: <span class="hljs-number">1</span>
&#125;;

<span class="hljs-built_in">console</span>.log(a?.b);
<span class="copy-code-btn">复制代码</span></code></pre>
<p>会被转换成：</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">const</span> a = &#123;
  <span class="hljs-attr">b</span>: <span class="hljs-number">1</span>
&#125;;

<span class="hljs-built_in">console</span>.log(a === <span class="hljs-literal">null</span> ? <span class="hljs-keyword">void</span> <span class="hljs-number">0</span> : a.b);
<span class="copy-code-btn">复制代码</span></code></pre>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ccec874389c041e1abb2ddd4df17a7e1~tplv-k3u1fbpfcp-zoom-1.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>如果层级更深， 会创建临时变量用于记录：</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">const</span> a = &#123;
  <span class="hljs-attr">b</span>: &#123;
    <span class="hljs-attr">c</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">d</span>: <span class="hljs-number">2</span>,
  &#125;
&#125;;

<span class="hljs-built_in">console</span>.log(a?.b?.c)
<span class="copy-code-btn">复制代码</span></code></pre>
<p>会被转换成：</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">var</span> _a$b;

<span class="hljs-keyword">const</span> a = &#123;
  <span class="hljs-attr">b</span>: &#123;
    <span class="hljs-attr">c</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">d</span>: <span class="hljs-number">2</span>
  &#125;
&#125;;
<span class="hljs-built_in">console</span>.log(
  a === <span class="hljs-literal">null</span> || a === <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>
    ? <span class="hljs-keyword">void</span> <span class="hljs-number">0</span> 
    : (_a$b = a.b) === <span class="hljs-literal">null</span> || _a$b === <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>
      ? <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>
      : _a$b.c
);
<span class="copy-code-btn">复制代码</span></code></pre>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2603ce97ea8043a0923b95c1d4cdd37a~tplv-k3u1fbpfcp-zoom-1.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<h2 data-id="heading-5"><code>Heny</code>发布的相关些资料</h2>
<p>Heny 目前是 <code>babel</code> 项目的负责人，之前发过一片介绍当前 babel 困境的文章。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/132ef59acb654e49bdacdb45eb07fc7a~tplv-k3u1fbpfcp-zoom-1.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>上图推文链接：<a href="https://twitter.com/left_pad/status/1136282005170262016" target="_blank" rel="nofollow noopener noreferrer">twitter.com/left_pad/st…</a></p>
<p>感兴趣的可以去看看。</p>
<h1 data-id="heading-6">总结</h1>
<p><code>?.</code> 使用起来是非常方便的, 但如果用的不好， 也会隐藏本应该暴露出来的问题。</p>
<p>所以, 使用的时候一定要清楚自己在做什么。</p>
<p><code>?.</code> 还有个小兄弟叫 <code>空值合并运算符(??)</code>, 这里就不说了， 去 MDN 看文档吧。</p>
<p>今天就这么多， 希望对大家有所启发。</p></div>  
</div>
            