
---
title: '做了这个活动，感觉自己成了垂直排版大师'
categories: 
 - 编程
 - 掘金
 - 分类
headimg: 'https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c831eb7a996f43ddbd75795a3bc8525d~tplv-k3u1fbpfcp-watermark.image'
author: 掘金
comments: false
date: Tue, 25 May 2021 20:30:12 GMT
thumbnail: 'https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c831eb7a996f43ddbd75795a3bc8525d~tplv-k3u1fbpfcp-watermark.image'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><blockquote>
<p>本文作者：阅文前端团队</p>
</blockquote>
<blockquote>
<p>原创声明：本文为阅文前端团队 YFE 成员出品，请尊重原创，转载请联系公众号 (id: yuewen_YFE) 获取授权，并注明作者、出处和链接。</p>
</blockquote>
<blockquote>
<p>全文及图片内的数字信息均非真实，仅供技术展示参考～</p>
</blockquote>
<p>前段时间协助完成作家的盘点活动，设计大大给的视觉稿如下图。最初拿到稿子时，以为是一个简单的常规活动，实际在完成这个活动的过程中有一点点小波折，自己也在这个过程中学习到了关于垂直排版的知识点，下面来跟大家描述做这个活动的心路历程，一起探索垂直排版的奥秘~</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c831eb7a996f43ddbd75795a3bc8525d~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>文字竖排🤔，立马想到使用 <strong>writing-mode</strong>，改变文字展示的行进方向</p>
<h2 data-id="heading-0">大家都知道的writing-mode</h2>
<p>writing-mode 可以将文档流由水平方向调整为垂直方向</p>
<p>以p标签内的一段文本为例，对其添加 writing-mode: vertical-rl，可以快速实现如下图所示的文字竖排效果</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/861213da5f704be8b1121caa627b3fbb~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>p标签示例代码如下：</p>
<pre><code class="hljs language-html copyable" lang="html"><span class="hljs-tag"><<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-vertical"</span>></span>爱交流，也爱独处<span class="hljs-tag"></<span class="hljs-name">p</span>></span>

.text-vertical &#123;
  writing-mode: vertical-rl;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>源码可打开<a href="https://codepen.io/shineasyr/pen/ExNOEXm?fileGuid=RPdpCPygrdKdJcQG" target="_blank" rel="nofollow noopener noreferrer">链接</a></p>
<p>一顿页面基础布局下来，可以看到页面效果和设计稿还是有差异😔，具体如下图的红色框线内；设计稿中红色框线内的数字是“直立向上”展示的</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9c89f1760f694efa99eadf91f82efcd0~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>感觉页面还原的展示也无伤大雅，于是拿着对比图找设计大大沟通；但是设计大大还是比较坚持视觉稿上的数字展示效果，以便更好传达活动内的关键信息（用户不需要旋转手机 or 侧头即可快速看清数据）</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/68cce03b63a348d9bee8906747b9377d~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>在纠结更好实现方案的时候，去请教了一下张老师，张老师提示可以使用 text-orientation:upright，即使是较差机型，可以优雅降级展示非竖向的效果，不影响活动</p>
<p>向产品咨询了产品用户机型占比，较差机型的占比很低很低，而且产品也接受较低端机型降级的效果，完美💯</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b8fa1af027fe4ce9aaadb10a24e097fb~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>在张老师的指点下，专门去学习了 text-orientation 属性相关内容</p>
<h2 data-id="heading-1">部分人知道都text-orientation</h2>
<p><strong>text-orientation: upright</strong> 可以将垂直排版的（设置了 writing-mode，且值不为 horizontal-tb）内容均直立向上展示</p>
<p>在之前的示例基础上，添加 text-orientation: upright 即可实现将数字直立向上展示，面效果可以看下方图片中红色线框内数字</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cb2cfee5c2fd47e7bec39ef6e98f8d26~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>p标签示例代码见下方：</p>
<pre><code class="hljs language-css copyable" lang="css"><<span class="hljs-selector-tag">p</span> class="text-vertical"><span class="hljs-number">999</span>篇日记，<span class="hljs-number">12356</span>万字</<span class="hljs-selector-tag">p</span>>
<span class="hljs-selector-class">.text-vertical</span> &#123;
    writing-mode: vertical-rl;
    text-orientation: upright;
    -webkit-text-orientation: upright;
  &#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>源码可打开<a href="https://codepen.io/shineasyr/pen/qBqQowK?fileGuid=RPdpCPygrdKdJcQG" target="_blank" rel="nofollow noopener noreferrer">链接</a></p>
<p>调整完成后，活动大体完成，活动进入测试阶段；活动提测后，测试随口提了一句“这个日期看着有一点点不方便”</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6f8b6a48de8e4ef480e229c30389a131~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>虽然测试只是随口一说，但我就放在了心上，思考有没有可能优化一下这个日期显示呢？念念不忘，必有回响，偶然发现 text-combine-upright 的属性可以解决此类竖排横向合并</p>
<h1 data-id="heading-2">较少人知道的text-combine-upright</h1>
<p>text-combine-upright，可以横向合并显示 2-4 字符，正好特别适合垂直排版中日期横向显示</p>
<p>下图中红色线框内，就是添加 text-combine-upright: all 后日期横向合并的效果，“10” 被合并到一起展示，更利于读者快速获取文字信息</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/95c0bea5480c43f7a392ac114cbd6671~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer">
示例代码见下方：</p>
<pre><code class="hljs language-html copyable" lang="html"><span class="hljs-tag"><<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-vertical"</span>></span>
  <span class="hljs-tag"><<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"upright-combine"</span>></span>10<span class="hljs-tag"></<span class="hljs-name">span</span>></span>月
  <span class="hljs-tag"><<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"upright-combine"</span>></span>1<span class="hljs-tag"></<span class="hljs-name">span</span>></span>日时光日记上线
<span class="hljs-tag"></<span class="hljs-name">p</span>></span>
<span class="copy-code-btn">复制代码</span></code></pre>
<pre><code class="hljs language-css copyable" lang="css"><span class="hljs-selector-class">.text-vertical</span> &#123;
   writing-mode: vertical-rl;
   text-orientation: upright;
&#125;
<span class="hljs-selector-class">.upright-combine</span> &#123;
   <span class="hljs-comment">/* for IE11+ */</span>
  -ms-text-combine-horizontal: all;
  <span class="hljs-comment">/* for Chrome/Firefox */</span>
  text-combine-upright: all;
  <span class="hljs-comment">/* for Safari */</span>
  -webkit-text-combine: horizontal;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>源码可打开<a href="https://codepen.io/shineasyr/pen/bGBOLVR?fileGuid=RPdpCPygrdKdJcQG" target="_blank" rel="nofollow noopener noreferrer">链接</a>
具体操作步骤说明如下：</p>
<p>1）将待合并元素外包裹一层标签</p>
<p>2）添加 text-combine-upright: all</p>
<p>text-combine-upright 属性支持关键字值和数字值，考虑到数字值的兼容性不佳，此处主要是用使用关键字all实现的</p>
<p>3）兼容处理，对 IE 浏览器和 Safari 浏览器做兼容处理（支持  IE11+），说明及代码见下方：</p>
<p>IE 浏览器使用的是 -ms-text-combine-horizontal 属性，与 text-combine-upright 属性一致 Safari 浏览器使用 -webkit-text-combine 属性，仅支持 none 和 horizontal 属性值</p>
<p>项目中实际代码片段为下方所示，可以兼容移动端项目，日期展示优化完成！</p>
<pre><code class="hljs language-css copyable" lang="css"><span class="hljs-selector-class">.upright-combine</span> &#123;
  <span class="hljs-comment">/* for IE11+ */</span>
  -ms-text-combine-horizontal: all;
  text-combine-upright: all;
  <span class="hljs-comment">/* forSafari */</span>
  -webkit-text-combine: horizontal;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>text-combine-upright 使用注意事项：</p>
<ul>
<li>只用于 2-4 字符的横向合并，例如日期、年份等</li>
<li>由于数字值的兼容性不佳，需要将待横向合并的内容包裹标签</li>
</ul>
<p>至此，该活动顺利完成并上线了，在完成改活动的过程并非一蹴而就。关于数字垂直排版的实现方案，中间也实践过一些其他方案，可能会对大家未来实现类似场景有参考价值～</p>
<h2 data-id="heading-3">数字垂直排版的其他方案</h2>
<p>最初在考虑实现数字垂直排版的时候，实践过其他方案，下面跟大家分享一下～</p>
<h3 data-id="heading-4">1.JS分割大法</h3>
<p>JS 将所有的文本信息均切割为单个标签，将单个文本内容都作为 block 元素，此时无需设置 writing-mode，直接设置外段落文本的最大宽度为 1em，即可达到内容竖向 + 数字直立向上效果</p>
<p>核心代码如下所示：</p>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">text2html</span>(<span class="hljs-params">element</span>) </span>&#123;
  <span class="hljs-keyword">var</span> treeWalker = <span class="hljs-built_in">document</span>.createTreeWalker(element, NodeFilter.SHOW_TEXT);
  <span class="hljs-keyword">var</span> node;
  <span class="hljs-keyword">let</span> list = []
  <span class="hljs-keyword">while</span> ((node = treeWalker.nextNode())) &#123;
    list.push(node)
  &#125;
  <span class="hljs-comment">// 纯文本节点数组遍历</span>
  list.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">node</span>) </span>&#123;
    <span class="hljs-comment">// 纯文本节点切割，替换为span标签</span>
    <span class="hljs-keyword">var</span> replaceArr = node.textContent.split(<span class="hljs-string">''</span>).map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">str</span>) </span>&#123;
      <span class="hljs-keyword">var</span> newSpan = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'span'</span>);
      newSpan.textContent = str;
      <span class="hljs-keyword">return</span> newSpan;
    &#125;);
    node.replaceWith.apply(node, replaceArr);
  &#125;)
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>JS 分割大法，将所有文本内容拆分成单个标签，方案简单粗暴，可能会提高样式布局难度，有潜在风险，故最终未采用该方法，但它较适合对局部个别文案处理、兜底展示或者低端机型处理</p>
<h2 data-id="heading-5">2.半角数字转全角</h2>
<p>数字为全角时，此时垂直展示的时候，它的展示效果和中文类似，天然“直立向上” ，因而可以将半角数字转成全角数字</p>
<p>数字半角转全角的示例代码如下：</p>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">// 数字半转全 0-9 对应 半角对应48-57，全角对应65296-65305</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ToDBC</span>(<span class="hljs-params">txtstring</span>) </span>&#123;
    <span class="hljs-keyword">var</span> newNumber = <span class="hljs-string">""</span>;
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i < txtstring.length; i++) &#123;
        <span class="hljs-keyword">if</span>(txtstring.charCodeAt(i) <= <span class="hljs-number">57</span> && txtstring.charCodeAt(i) >= <span class="hljs-number">48</span>) &#123;
            newNumber = newNumber + <span class="hljs-built_in">String</span>.fromCharCode(txtstring.charCodeAt(i)+<span class="hljs-number">65248</span>);
        &#125; <span class="hljs-keyword">else</span> &#123;
            newNumber = newNumber + txtstring.substring(i, i+<span class="hljs-number">1</span>);
        &#125;
    &#125;
    <span class="hljs-keyword">return</span> newNumber;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>数字半角转全角的方法看似非常完美，但是后续有需要额外考虑哪些不转全角，并且涉及到一些数字计算判断时，还需要把全角转半角（全角数字无法直接参与逻辑运算），展示再转全角，处理起来较为繁琐，故最终没选择此技术方案</p>
<h3 data-id="heading-6">数字“直立向上”方案小结</h3>
<ul>
<li>CSS的 text-orientation</li>
<li>暴力拆解 DOM</li>
<li>调整数字为全角</li>
</ul>
<p>关于数字“直立向上”的实现，如果大家有其他好的思考角度或者解决方案，欢迎分享交流～</p>
<h2 data-id="heading-7">最终的归纳总结</h2>
<ul>
<li>竖向展示排版通过 writing-mode 可快速实现</li>
<li>对于部分数字需要“直立向上”时，采用 text-orientation:upright 方法</li>
<li>日期类字符（2-4字符）可以通过 text-combine-upright 属性横向合并优化展示</li>
</ul>
<p>新人写作，内容如有遗留、错漏，欢迎大家指正。也欢迎有同好者一起探讨研究～～～</p>
<h2 data-id="heading-8">参考链接</h2>
<ul>
<li><a href="https://www.zhangxinxu.com/wordpress/2021/02/css-text-combine-upright/?fileGuid=RPdpCPygrdKdJcQG" target="_blank" rel="nofollow noopener noreferrer">使用 CSS text-combine-upright 实现字符的横向合并</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/text-combine-upright?fileGuid=RPdpCPygrdKdJcQG" target="_blank" rel="nofollow noopener noreferrer">text-combin-upright</a></li>
<li><a href="https://zh.wikipedia.org/wiki/%E5%85%A8%E5%BD%A2%E5%92%8C%E5%8D%8A%E5%BD%A2?fileGuid=RPdpCPygrdKdJcQG" target="_blank" rel="nofollow noopener noreferrer">全角和半角</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/writing-mode?fileGuid=RPdpCPygrdKdJcQG" target="_blank" rel="nofollow noopener noreferrer">writing-mode </a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/text-orientation?fileGuid=RPdpCPygrdKdJcQG" target="_blank" rel="nofollow noopener noreferrer">text-orientation </a></li>
</ul></div>  
</div>
            