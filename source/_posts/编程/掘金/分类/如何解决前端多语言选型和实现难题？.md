
---
title: '如何解决前端多语言选型和实现难题？'
categories: 
 - 编程
 - 掘金
 - 分类
headimg: 'https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/50d366700c964aa6a2900ab3af5d23dc~tplv-k3u1fbpfcp-no-mark:1280:960:0:0.image'
author: 掘金
comments: false
date: Tue, 03 Aug 2021 18:25:10 GMT
thumbnail: 'https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/50d366700c964aa6a2900ab3af5d23dc~tplv-k3u1fbpfcp-no-mark:1280:960:0:0.image'
---

<div>   
<div class="markdown-body"><style>@charset "UTF-8";.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:#353535&#125;.markdown-body h1&#123;padding-bottom:4px;font-size:30px&#125;.markdown-body h1,.markdown-body h2&#123;margin-top:36px;margin-bottom:10px;line-height:1.5;color:#005bb7&#125;.markdown-body h2&#123;position:relative;padding-left:16px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h2:before&#123;content:"「";position:absolute;top:-6px;left:-10px&#125;.markdown-body h2:after&#123;content:"」";position:absolute;top:6px;right:auto&#125;.markdown-body h3&#123;position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:#005bb7;padding-left:6px&#125;.markdown-body h3:before&#123;content:"»";padding-right:6px;color:#2196f3&#125;.markdown-body h4&#123;margin-top:24px;font-size:16px&#125;.markdown-body h4,.markdown-body h5&#123;padding-bottom:0;margin-bottom:10px;line-height:1.5;color:#005bb7;padding-left:6px&#125;.markdown-body h5&#123;margin-top:18px;font-size:14px&#125;.markdown-body h6&#123;padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:#005bb7;padding-left:6px&#125;.markdown-body p&#123;line-height:inherit;margin-top:16px;margin-bottom:16px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,#007fff,rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),#007fff);border-width:0;overflow:visible&#125;.markdown-body hr:after&#123;content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background:#fff;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center&#125;.markdown-body code&#123;padding:.065em .4em;font-size:.87em;color:#c2185b;word-break:break-word;overflow-x:auto;background-color:#fff4f4;border-radius:2px&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8&#125;.markdown-body pre>code::-webkit-scrollbar&#123;width:4px;height:4px&#125;.markdown-body pre>code::-webkit-scrollbar-track&#123;background-color:#bedcff&#125;.markdown-body pre>code::-webkit-scrollbar-thumb&#123;background-color:#2196f3;border-radius:10px&#125;.markdown-body a&#123;position:relative;text-decoration:none;color:#3da8f5;border-bottom:1px solid #bedcff&#125;.markdown-body a:hover&#123;color:#007fff;border-bottom-color:#007fff&#125;.markdown-body a:active&#123;color:#007fff&#125;.markdown-body a:after&#123;position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid #bedcff;transition:top .3s,opacity .3s;transform:translateZ(0)&#125;.markdown-body a:hover:after&#123;top:0;opacity:1;border-bottom-color:#007fff&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #c3e0fd;border-spacing:0;border-collapse:collapse&#125;.markdown-body table thead&#123;color:#000;text-align:left;font-size:14px;background:#f6f6f6&#125;.markdown-body table tr:nth-child(2n)&#123;background-color:#f7fbff&#125;.markdown-body table tr:hover&#123;background-color:#e0edf7&#125;.markdown-body table td,.markdown-body table th&#123;padding:12px 8px;line-height:24px;border:1px solid #c3e0fd&#125;.markdown-body table th&#123;color:#005bb7;background-color:#dff0ff&#125;.markdown-body table td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#8c8c8c;border-left:4px solid #2196f3;background-color:#f0fdff;padding:1px 20px;margin:22px 0&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body b,.markdown-body blockquote>b,.markdown-body blockquote>strong,.markdown-body strong&#123;color:#2196f3&#125;.markdown-body em,.markdown-body i&#123;color:#4fc3f7&#125;.markdown-body del&#123;color:#ccc&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:4px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body details>summary&#123;outline:none;color:#005bb7;font-size:20px;font-weight:bolder;border-bottom:1px solid #bedcff;cursor:pointer&#125;.markdown-body details>p&#123;padding:10px 20px;margin:10px 0 0;color:#666;background-color:#f0fdff;border:2px dashed #2196f3&#125;.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection&#123;color:#005bb7;background-color:rgba(160,200,255,.15)&#125;.markdown-body p::selection&#123;color:#c80000&#125;.markdown-body a::selection,.markdown-body b::selection,.markdown-body del::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection&#123;background-color:transparent&#125;.markdown-body code::selection&#123;background-color:#ffeaeb&#125;.markdown-body pre>code::selection&#123;background-color:rgba(160,200,255,.25)&#125;.markdown-body ol ::selection,.markdown-body ul ::selection&#123;background-color:rgba(160,200,255,.15)&#125;.markdown-body .contains-task-list&#123;padding-left:14px;list-style:none&#125;.markdown-body .contains-task-list input[type=checkbox]&#123;position:relative&#125;.markdown-body .contains-task-list input[type=checkbox]:before&#123;content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1&#125;.markdown-body .contains-task-list input[type=checkbox]:checked:after&#123;content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><blockquote>
<p>国际化演示地址: <a href="https://link.juejin.cn/?target=http%3A%2F%2Fh5.dooring.cn%2Fh5_plus" target="_blank" rel="nofollow noopener noreferrer" title="http://h5.dooring.cn/h5_plus" ref="nofollow noopener noreferrer">H5-Dooring国际化</a> <br> 注: ⚠️本文为掘金社区首发签约文章，未获授权禁止转载</p>
</blockquote>
<p><strong>多语言(i18n)支持</strong> 是企业项目走向国际化的必经之路，也是前端工程师最佳实践的内容之一。不过，多语言框架众多，会带来一系列选型问题，相信大家在平时对项目进行多语言支持时，也往往会遇到如下几个问题：</p>
<ul>
<li>针对不同的技术栈，我该如何选择多语言方案?</li>
<li>如果不借助第三方库，如何独立实现对项目的多语言支持?</li>
<li>在实践多语言方案的过程中，我因该考虑那些问题? 如何更高效的实现多语言?</li>
</ul>
<p>其实，多语言框架虽多，但是从传统的 <code>jquery</code> 时代到目前流行的 <code>MVVM</code> 框架，<strong>多语言方案</strong>一直在演进和优化，最终目的是将其<strong>普适化</strong>和<strong>最简化</strong>。理解了这一点，学习多语言技术就容易多了。</p>
<p>我在设计和实践<strong>低代码</strong>/<strong>零代码</strong>搭建平台 <strong>Dooring</strong> 的过程中，也遇到了<strong>多语言方案</strong>的技术选型，目前方案基本完成，接下来我将带大家一步步分析多语言在不同技术栈中的实现方案，并以实际的项目让大家掌握多言语技术，在文章最后我也会提出对多语言未来演进的一些方向，供大家研究和探索。</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/50d366700c964aa6a2900ab3af5d23dc~tplv-k3u1fbpfcp-no-mark:1280:960:0:0.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>按照我一向的写作风格，我会在下面列出文章的大纲，以便大家有选择且高效率的阅读和学习：</p>
<ul>
<li>目前常用的多语言方案介绍和实践
<ul>
<li>原生js/jquery方案实现多语言</li>
<li>vue项目中的多语言方案</li>
<li>react项目中的多语言方案</li>
</ul>
</li>
<li>使用 @umijs/plugin-locale 落地国际化项目</li>
<li>智能国际化方案畅想</li>
</ul>
<h3 data-id="heading-0">目前常用的多语言方案介绍和实践</h3>
<p>目前常用的多语言方案基本都是人工翻译，然后通过动态替换来实现语言的切换，但是不同的技术框架模式稍有不同, 接下来我们就逐个分析一下。</p>
<h4 data-id="heading-1">1. 原生js/jquery方案实现多语言</h4>
<p>在传统方案中最容易想到的就是<strong>dom替换</strong>。我们通过提前定义好多语言文件(或文案Map)，并在html标签中做语言映射，最后通过切换函数来动态的切换网站语言。其基本的模式如下：</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-comment">// 语言库，我们有两种方式来定义</span>
<span class="hljs-comment">// 1. 单文件Map模式, lang.js</span>
<span class="hljs-keyword">const</span> lang = &#123;
  <span class="hljs-attr">zh</span>: &#123;
        <span class="hljs-string">'title'</span>: <span class="hljs-string">'H5编辑器'</span>,
        <span class="hljs-string">'userLogin'</span>: <span class="hljs-string">'用户登录'</span>,
        <span class="hljs-string">'usernameError'</span>: <span class="hljs-string">'请输入用户名'</span>
    &#125;,
  <span class="hljs-attr">en</span>: &#123;
        <span class="hljs-string">'title'</span>: <span class="hljs-string">'H5 editor'</span>,
        <span class="hljs-string">'userLogin'</span>: <span class="hljs-string">'The user logs on'</span>,
        <span class="hljs-string">'usernameError'</span>: <span class="hljs-string">'Please enter your username'</span>
    &#125;,
&#125;

<span class="hljs-comment">// 2. 多语言包模式</span>
lang/cn.json 
lang/en.json
<span class="copy-code-btn">复制代码</span></code></pre>
<p>html标签结构如下：</p>
<pre><code class="hljs language-html copyable" lang="html"><span class="hljs-tag"><<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"langControl"</span>></span>
  <span class="hljs-tag"><<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"cn"</span>></span>中文<span class="hljs-tag"></<span class="hljs-name">option</span>></span>
  <span class="hljs-tag"><<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"en"</span>></span>English<span class="hljs-tag"></<span class="hljs-name">option</span>></span>
<span class="hljs-tag"></<span class="hljs-name">select</span>></span>

<span class="hljs-tag"><<span class="hljs-name">div</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"title"</span>></span>H5编辑器<span class="hljs-tag"></<span class="hljs-name">div</span>></span>
<span class="hljs-tag"><<span class="hljs-name">div</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"userLogin"</span>></span>用户登录<span class="hljs-tag"></<span class="hljs-name">div</span>></span>
<span class="copy-code-btn">复制代码</span></code></pre>
<p>最后我们通过 <code>javascript</code> 遍历 <code>[lang]</code> 属性并通过映射关系来替换语言。当然我们还可以通过 <code>template.js</code> 这样的模版引擎来优化我们<code>dom</code>的渲染替换方式，但是以上方案在落地过程中仍然需要考虑很多问题。如下：</p>
<ul>
<li>语言持久化需要单独处理</li>
<li>无法动态添加语言文本</li>
<li>无法引入变量以及读取语言文本</li>
<li>缺乏灵活性和配置化</li>
</ul>
<p>在传统方案中我们为了解决以上问题并支持更复杂系统，我们不得不考虑插件化，当然 <code>Jquery-I18n</code> 就是一个非常不错的解决方案。它可以帮助我们轻松地国际化 Web 应用程序，并且支持链式调用, 且可以无刷新切换语言。接下来我就带大家使用 <code>Jquery-I18n</code> 实现一个简单的demo，让大家更好的掌握该方案。</p>
<ol>
<li>引入资源</li>
</ol>
<pre><code class="hljs language-html copyable" lang="html"><span class="hljs-tag"><<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.bootcss.com/jquery/3.10.2/jquery.min.js"</span>></span><span class="hljs-tag"></<span class="hljs-name">script</span>></span> 
<span class="hljs-tag"><<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.bootcss.com/js-cookie/latest/js.cookie.min.js"</span>></span><span class="hljs-tag"></<span class="hljs-name">script</span>></span> 
<span class="hljs-tag"><<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./js/jquery.i18n.js"</span>></span><span class="hljs-tag"></<span class="hljs-name">script</span>></span>
<span class="copy-code-btn">复制代码</span></code></pre>
<ol start="2">
<li>创建并配置多语言文件</li>
</ol>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6826544bece241e2b44933d08f81ff0e~tplv-k3u1fbpfcp-no-mark:1280:960:0:0.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c15880670856487db02e6f24651033eb~tplv-k3u1fbpfcp-no-mark:1280:960:0:0.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<ol start="3">
<li>编写页面内容</li>
</ol>
<pre><code class="hljs language-html copyable" lang="html"><span class="hljs-tag"><<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"langControl"</span>></span>
  <span class="hljs-tag"><<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"cn"</span>></span>中文<span class="hljs-tag"></<span class="hljs-name">option</span>></span>
  <span class="hljs-tag"><<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"en"</span>></span>English<span class="hljs-tag"></<span class="hljs-name">option</span>></span>
<span class="hljs-tag"></<span class="hljs-name">select</span>></span>

<span class="hljs-tag"><<span class="hljs-name">div</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"title"</span>></span>H5编辑器<span class="hljs-tag"></<span class="hljs-name">div</span>></span>
<span class="hljs-tag"><<span class="hljs-name">div</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"userLogin"</span>></span>用户登录<span class="hljs-tag"></<span class="hljs-name">div</span>></span>
<span class="copy-code-btn">复制代码</span></code></pre>
<ol start="4">
<li>初始化 <strong>i18n</strong> 配置并实现语言切换逻辑</li>
</ol>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toggleLang</span>(<span class="hljs-params">lang</span>)</span>&#123;
   $(<span class="hljs-string">"[lang]"</span>).i18n(&#123;
       <span class="hljs-attr">defaultLang</span>: lang,  <span class="hljs-comment">// 默认语言</span>
       <span class="hljs-attr">filePath</span>: <span class="hljs-string">"/lang/"</span>, <span class="hljs-comment">// 语言文件所在的目录</span>
       <span class="hljs-attr">filePrefix</span>: <span class="hljs-string">""</span>,   <span class="hljs-comment">// 语言文件前缀</span>
       <span class="hljs-attr">fileSuffix</span>: <span class="hljs-string">""</span>,   <span class="hljs-comment">// 语言文件后缀</span>
       <span class="hljs-attr">forever</span>: <span class="hljs-literal">true</span>,
       <span class="hljs-attr">callback</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">res</span>) </span>&#123;&#125;  <span class="hljs-comment">// 初始化后的回调</span>
   &#125;);
&#125;

<span class="hljs-comment">// 语言切换</span>
$(<span class="hljs-string">'#langControl'</span>).change(<span class="hljs-function"><span class="hljs-params">val</span> =></span> &#123;
   toggleLang(val)
&#125;)
<span class="copy-code-btn">复制代码</span></code></pre>
<p>当然 <code>Jquery-I18n</code> 有更多强大的配置，大家可以参考文档进行配置，相关库 <code>github</code> 地址如下：</p>
<ul>
<li><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fwikimedia%2Fjquery.i18n" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/wikimedia/jquery.i18n" ref="nofollow noopener noreferrer">Jquery-I18n</a></li>
<li><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fjquery-i18n-properties%2Fjquery-i18n-properties" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/jquery-i18n-properties/jquery-i18n-properties" ref="nofollow noopener noreferrer">jquery-i18n-properties</a></li>
</ul>
<p>当然以上方案还只是手动切换语言，更多的需求场景是要我们基于用户当前的浏览器环境或者网站链接地址的参数不同来自动切换对应的语言。对于通过链接参数来改变系统语言，这个我们只需要通过解析参数并进行对应的处理即可，比如解析 <code>http://xxx.xxx?lan=cn</code> 或 <code>http://xxx.xxx?lan=en</code>。当然浏览器也提供了对应的 <code>api</code> 可以获取当前用户浏览的环境：<code>navigator.language</code> ，我们在浏览器控制台输入该脚本的结果如下：</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4dda6fd38faf472cbe07295a3fd83c1a~tplv-k3u1fbpfcp-no-mark:1280:960:0:0.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>所以我们可以根据这个信息来自动匹配用户当前的语言模式。</p>
<h4 data-id="heading-2">2. vue项目中的多语言方案</h4>
<p>基于 <strong>Vue</strong> 的多语言方案网上也有很多，毕竟国内大部分企业都在使用 <strong>Vue</strong> 开发项目，所以我简单列举几个成熟的方案给大家，并对其中一个方案给出具体的实践：</p>
<ul>
<li><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fvuex-i18n" target="_blank" rel="nofollow noopener noreferrer" title="https://www.npmjs.com/package/vuex-i18n" ref="nofollow noopener noreferrer">vuex-i18n</a></li>
<li><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fkazupon%2Fvue-i18n" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/kazupon/vue-i18n" ref="nofollow noopener noreferrer">vue-i18n</a></li>
</ul>
<p>当然大家如果做的不是很复杂的项目，也可以直接采用 <strong>simplest-i18n</strong>，因为其更简单轻量。</p>
<p>接下来我会以一个完整的例子来说明如何使用 <strong>vue-i18n</strong> 来做 <strong>Vue</strong> 项目的国际化。</p>
<ol>
<li>定义语言文件</li>
</ol>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ae19434eba374c3a8d2840e4f978ca15~tplv-k3u1fbpfcp-no-mark:1280:960:0:0.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<ol start="2">
<li>引入依赖并注册语言包</li>
</ol>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">import</span> Vue <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>;
<span class="hljs-keyword">import</span> VueI18n <span class="hljs-keyword">from</span> <span class="hljs-string">"vue-i18n"</span>;

Vue.use(VueI18n);

<span class="hljs-comment">// 加载所有语言环境并记住上下文</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loadMessages</span>(<span class="hljs-params"></span>) </span>&#123;
  <span class="hljs-keyword">const</span> context = <span class="hljs-built_in">require</span>.context(<span class="hljs-string">"./lang"</span>, <span class="hljs-literal">true</span>, <span class="hljs-regexp">/[a-z0-9-_]+.json$/i</span>);

  <span class="hljs-keyword">const</span> messages = context
    .keys()
    .map(<span class="hljs-function">(<span class="hljs-params">key</span>) =></span> (&#123; key, <span class="hljs-attr">locale</span>: key.match(<span class="hljs-regexp">/[a-z0-9-_]+/i</span>)[<span class="hljs-number">0</span>] &#125;))
    .reduce(
      <span class="hljs-function">(<span class="hljs-params">messages, &#123; key, locale &#125;</span>) =></span> (&#123;
        ...messages,
        [locale]: context(key),
      &#125;),
      &#123;&#125;
    );

  <span class="hljs-keyword">return</span> &#123; context, messages &#125;;
&#125;

<span class="hljs-keyword">const</span> &#123; context, messages &#125; = loadMessages();

<span class="hljs-comment">// VueI18n 实例</span>
<span class="hljs-keyword">const</span> i18n = <span class="hljs-keyword">new</span> VueI18n(&#123;
  <span class="hljs-attr">locale</span>: navigator.language, <span class="hljs-comment">// 根据浏览器环境设置网站语言</span>
  messages,
&#125;);

<span class="hljs-comment">// 运行程序</span>
<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> Vue(&#123;
  i18n,
  <span class="hljs-comment">// ...</span>
&#125;).$mount(<span class="hljs-string">'#app'</span>);

<span class="hljs-comment">// 切换语言(在组件内也可以使用$i18n.locale来切换语言环境)</span>
i18n.locale = <span class="hljs-string">'en-US'</span>

<span class="hljs-comment">// 热更新支持</span>
<span class="hljs-keyword">if</span> (<span class="hljs-built_in">module</span>.hot) &#123;
  <span class="hljs-built_in">module</span>.hot.accept(context.id, <span class="hljs-function">() =></span> &#123;
    <span class="hljs-keyword">const</span> &#123; <span class="hljs-attr">messages</span>: newMessages &#125; = loadMessages();

    <span class="hljs-built_in">Object</span>.keys(newMessages)
      .filter(<span class="hljs-function">(<span class="hljs-params">locale</span>) =></span> messages[locale] !== newMessages[locale])
      .forEach(<span class="hljs-function">(<span class="hljs-params">locale</span>) =></span> &#123;
        messages[locale] = newMessages[locale];
        i18n.setLocaleMessage(locale, messages[locale]);
      &#125;);
  &#125;);
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>当然在项目中我们还可以延迟加载翻译，原理类似 <strong>webpack</strong> 的异步加载文件，参考如下：</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loadLangAsync</span>(<span class="hljs-params">lang</span>) </span>&#123;
  <span class="hljs-comment">// 如果语言相同</span>
  <span class="hljs-keyword">if</span> (i18n.locale === lang) &#123;
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.resolve(...)
  &#125;

  <span class="hljs-comment">// 如果语言已经加载</span>
  <span class="hljs-keyword">if</span> (loadedLanguages.includes(lang)) &#123;
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.resolve(...)
  &#125;

  <span class="hljs-comment">// 如果尚未加载语言</span>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">import</span>(<span class="hljs-comment">/* webpackChunkName: "lang-[request]" */</span> <span class="hljs-string">`@/lang/<span class="hljs-subst">$&#123;lang&#125;</span>.json`</span>).then(
    <span class="hljs-function"><span class="hljs-params">messages</span> =></span> &#123;
      <span class="hljs-comment">// ... 处理逻辑</span>
    &#125;
  )
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>同时 <code>vue-cli</code> 还提供了对应的插件 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fkazupon%2Fvue-cli-plugin-i18n" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/kazupon/vue-cli-plugin-i18n" ref="nofollow noopener noreferrer">vue-cli-plugin-i18n</a> 来支持通过配置化的方式开启多语言。</p>
<h4 data-id="heading-3">3. react项目中的多语言方案</h4>
<p>首先其实多语言在 <strong>Vue</strong> 和 <strong>React</strong> 项目中都有一个非常简单的方案，</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f5bfb2ecc2964fef899bb5acc2b668cd~tplv-k3u1fbpfcp-no-mark:1280:960:0:0.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>其基本流程如下：</p>
<ol>
<li>定义多语言文件</li>
<li>引入到应用</li>
<li>应用根据优先级设置当前语言环境，并写入 <code>cookie</code></li>
<li>当切换语言时，重写 <code>cookie</code> 语言信息并刷新页面</li>
</ol>
<p>当然市场上也有很多成熟的解决方案，如下：</p>
<ul>
<li><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fyahoo%2Freact-intl" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/yahoo/react-intl" ref="nofollow noopener noreferrer">react-intl</a></li>
<li><a href="https://link.juejin.cn/?target=https%3A%2F%2Freact.i18next.com" target="_blank" rel="nofollow noopener noreferrer" title="https://react.i18next.com" ref="nofollow noopener noreferrer">react-i18next</a> + <a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.i18next.com" target="_blank" rel="nofollow noopener noreferrer" title="https://www.i18next.com" ref="nofollow noopener noreferrer">i18next</a></li>
<li><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Falibaba%2Freact-intl-universal" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/alibaba/react-intl-universal" ref="nofollow noopener noreferrer">react-intl-universal</a></li>
</ul>
<p>接下来笔者将结合自己的案例，采用 <a href="https://link.juejin.cn/?target=https%3A%2F%2Freact.i18next.com" target="_blank" rel="nofollow noopener noreferrer" title="https://react.i18next.com" ref="nofollow noopener noreferrer">react-i18next</a> + <a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.i18next.com" target="_blank" rel="nofollow noopener noreferrer" title="https://www.i18next.com" ref="nofollow noopener noreferrer">i18next</a> 方案来实现一个完整的 <strong>demo</strong>。</p>
<ol>
<li>安装依赖</li>
</ol>
<pre><code class="hljs language-bash copyable" lang="bash"><span class="hljs-comment"># npm</span>
$ npm install react-i18next i18next --save
<span class="copy-code-btn">复制代码</span></code></pre>
<ol start="2">
<li>
<p>定义语言包(这里和之前一样，这里不在重述)</p>
</li>
<li>
<p>代码实现</p>
<p>3.1 全局配置i18n</p>
</li>
</ol>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-comment">// i18n.js</span>
<span class="hljs-keyword">import</span> i18n <span class="hljs-keyword">from</span> <span class="hljs-string">"i18next"</span>;
<span class="hljs-keyword">import</span> &#123; initReactI18next &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">"react-i18next"</span>;
<span class="hljs-keyword">import</span> en <span class="hljs-keyword">from</span> <span class="hljs-string">'locales/en-US.js'</span>;
<span class="hljs-keyword">import</span> cn <span class="hljs-keyword">from</span> <span class="hljs-string">'locales/zh-CN.js'</span>;


<span class="hljs-keyword">const</span> resources = &#123;
  <span class="hljs-attr">en</span>: &#123;
    <span class="hljs-attr">translation</span>: en
  &#125;,
  <span class="hljs-attr">cn</span>: &#123;
    <span class="hljs-attr">translation</span>: cn
  &#125;
&#125;;

i18n
  .use(initReactI18next) <span class="hljs-comment">// 注册</span>
  .init(&#123;
    resources,
    <span class="hljs-attr">lng</span>: <span class="hljs-string">"cn"</span>, <span class="hljs-comment">// 默认语言</span>
    <span class="hljs-attr">interpolation</span>: &#123;
      <span class="hljs-attr">escapeValue</span>: <span class="hljs-literal">false</span> <span class="hljs-comment">// xss安全开关</span>
    &#125;
  &#125;);

  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> i18n;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>3.2 配置入口文件</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-comment">// index.js</span>
<span class="hljs-keyword">import</span> React, &#123; Component &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;
<span class="hljs-keyword">import</span> ReactDOM <span class="hljs-keyword">from</span> <span class="hljs-string">"react-dom"</span>;
<span class="hljs-comment">// ...其他库</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'./i18n'</span>;
<span class="hljs-keyword">import</span> App <span class="hljs-keyword">from</span> <span class="hljs-string">'./App'</span>;

ReactDOM.render(
  <span class="xml"><span class="hljs-tag"><<span class="hljs-name">App</span> /></span></span>,
  <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"root"</span>)
);
<span class="copy-code-btn">复制代码</span></code></pre>
<p>3.3 在react组件中使用：</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> &#123; useTranslation &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'react-i18next'</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Home</span> (<span class="hljs-params"></span>) </span>&#123;
  <span class="hljs-keyword">const</span> &#123; t, i18n &#125; = useTranslation();
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag"><<span class="hljs-name">h1</span>></span>&#123;t('title')&#125;<span class="hljs-tag"></<span class="hljs-name">h1</span>></span></span>
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>以上就是一个完整的使用流程，当然大家也可以使用该库实现更多有意思的功能。</p>
<h3 data-id="heading-4">使用 @umijs/plugin-locale 落地国际化项目</h3>
<p>在介绍完不同技术栈实现的多语言方案之后，我们以 <a href="https://link.juejin.cn/?target=http%3A%2F%2Fh5.dooring.cn%2Fh5_plus" target="_blank" rel="nofollow noopener noreferrer" title="http://h5.dooring.cn/h5_plus" ref="nofollow noopener noreferrer"><strong>H5-Dooring</strong></a> 为实际案例，来将其国际化一下。因为 <strong>H5-Dooring</strong> 编辑器端主要采用 <strong>React</strong> 开发，并采用 <strong>umi</strong> 做工程化方案，所以我自然选择 <strong>umi</strong> 对应的生态来实现，好在其提供了开箱即用的 <strong>@umijs/plugin-locale</strong> 插件，我们可以轻松的实现国际化，接下来我将采用该方案来带大家实现国际化，如果大家也在使用 <strong>umi</strong>，可以参考一下。</p>
<p>先上张效果图：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/85a0f0f144084c1f81a140632a966e40~tplv-k3u1fbpfcp-no-mark:1280:960:0:0.image" alt="chrome-capture.gif" loading="lazy" referrerpolicy="no-referrer"></p>
<p>首先我们需要配置一下 <code>umirc.ts</code> 文件，添加如下配置：</p>
<pre><code class="hljs language-js copyable" lang="js">locale: &#123;
    <span class="hljs-attr">default</span>: <span class="hljs-string">'zh-CN'</span>, <span class="hljs-comment">// 默认的语言</span>
    <span class="hljs-attr">antd</span>: <span class="hljs-literal">true</span>,  <span class="hljs-comment">// antd是否也支持国际化</span>
    <span class="hljs-attr">title</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 页面标题是否支持国际化</span>
    <span class="hljs-attr">baseNavigator</span>: <span class="hljs-literal">true</span>,  <span class="hljs-comment">// 开启浏览器语言检测</span>
&#125;,
<span class="copy-code-btn">复制代码</span></code></pre>
<p>其次我们需要定义多语言文件：</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cf93468a12f24b819a39b49c1fbca5d4~tplv-k3u1fbpfcp-no-mark:1280:960:0:0.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>语言文件内容如下：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a2874a531db9489f9af236d9217c14ed~tplv-k3u1fbpfcp-no-mark:1280:960:0:0.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>在做好基本准备工作之后，我们看看如何在项目中使用多语言。我们已入口页面为例来说明：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f2874a323a7a41d79a823e2feb43d918~tplv-k3u1fbpfcp-no-mark:1280:960:0:0.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>首先我们需要引入对应的插件，如下：</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">import</span> &#123; useIntl, setLocale &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'umi'</span>;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>其次在 <code>hooks</code> 组件里使用 <code>hook</code> ：</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">const</span> Home = <span class="hljs-function">(<span class="hljs-params">&#123; location &#125;</span>) =></span> &#123;
  <span class="hljs-comment">// ... 其他逻辑状态</span>
  <span class="hljs-keyword">const</span> [lang, setLang] = useState(<span class="hljs-string">'En'</span>);
  <span class="hljs-keyword">const</span> intl = useIntl();
  
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag"><<span class="hljs-name">div</span>></span>
      <span class="hljs-tag"><<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;styles.btnControl&#125;</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;toggleLang&#125;</span>></span>&#123; lang &#125;
      <span class="hljs-tag"></<span class="hljs-name">span</span>></span>
      <span class="hljs-tag"><<span class="hljs-name">h3</span>></span>&#123; intl.formatMessage(&#123;id: 'dr.friendHelp'&#125;) &#125;<span class="hljs-tag"></<span class="hljs-name">h3</span>></span>
      <span class="hljs-tag"><<span class="hljs-name">h3</span>></span>&#123; intl.formatMessage(&#123;id: 'dr.personHelp'&#125;) &#125;<span class="hljs-tag"></<span class="hljs-name">h3</span>></span>
      <span class="hljs-tag"><<span class="hljs-name">Form.Item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">&#123;</span> <span class="hljs-attr">intl.formatMessage</span>(&#123;<span class="hljs-attr">id:</span> '<span class="hljs-attr">dr.cpEnName</span>'&#125;) &#125; <span class="hljs-attr">name</span>=<span class="hljs-string">"cpField"</span> <span class="hljs-attr">rules</span>=<span class="hljs-string">&#123;[&#123;</span> <span class="hljs-attr">required:</span> <span class="hljs-attr">true</span>, <span class="hljs-attr">message:</span> <span class="hljs-attr">intl.formatMessage</span>(&#123;<span class="hljs-attr">id:</span> '<span class="hljs-attr">dr.cpInfoError</span>'&#125;, &#123; <span class="hljs-attr">text:</span> <span class="hljs-attr">intl.formatMessage</span>(&#123;<span class="hljs-attr">id:</span> '<span class="hljs-attr">dr.cpName</span>'&#125;)&#125;) &#125;]&#125;></span>
         <span class="hljs-tag"><<span class="hljs-name">Input</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&#123;</span> <span class="hljs-attr">intl.formatMessage</span>(&#123;<span class="hljs-attr">id:</span> '<span class="hljs-attr">dr.cpInfoError</span>'&#125;, &#123; <span class="hljs-attr">text:</span> <span class="hljs-attr">intl.formatMessage</span>(&#123;<span class="hljs-attr">id:</span> '<span class="hljs-attr">dr.cpEnName</span>'&#125;)&#125;) &#125; /></span>
      <span class="hljs-tag"></<span class="hljs-name">Form.Item</span>></span>
  <span class="hljs-tag"></<span class="hljs-name">div</span>></span></span>
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>以上就是基本的实现，我们可以在语言文件中使用变量，并在项目中动态指定变量的值，是不是很强大呢? 对于多语言切换，企业提供了对应的 <code>API</code>，并支持无刷新切换和刷新切换两种模式，使用方式如下：</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">const</span> toggleLang = <span class="hljs-function">() =></span> &#123;
    <span class="hljs-keyword">if</span>(lang === <span class="hljs-string">'En'</span>) &#123;
      setLocale(<span class="hljs-string">'en-US'</span>, <span class="hljs-literal">false</span>);
      setLang(<span class="hljs-string">'中文'</span>)
      <span class="hljs-keyword">return</span>
    &#125;
    setLocale(<span class="hljs-string">'zh-CN'</span>, <span class="hljs-literal">false</span>);
    setLang(<span class="hljs-string">'En'</span>);
  &#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>由上可以看出我们使用<code>setLocale</code> 这个api来切换语言，第一个参数为语言文本，第二个参数表示切换语言时是否刷新页面。</p>
<h3 data-id="heading-5">智能国际化方案畅想</h3>
<p>以上探索的方案都是人工来做翻译，我在翻译的过程中耗费了大量的精力和时间，如果网站越来越复杂, 会投入更多的精力，所以说通用的智能化翻译方案在未来将是迫切需要解决的问题，也是国际化 <strong>i18n</strong> 演进的必经之路，虽然国内已经有大公司内部在做对应的事情了，甚至已经有了一定的解决方案积累，在这里我大致给出一个基本的思路设想：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/36b3ae00d88f4bf58e17b5882edbd914~tplv-k3u1fbpfcp-no-mark:1280:960:0:0.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>这样的话我们只需要以一种语言为基础来进行正常开发，其他语言会通过我们的工具自动翻译并转化为对应的语言文件。后续笔者会落实该方案，大家也可以尝试不同的智能化方案，一起探索前端效能提升之路。</p>
<h2 data-id="heading-6">往期文章</h2>
<ul>
<li><a href="https://juejin.cn/post/6986824393653485605" target="_blank" title="https://juejin.cn/post/6986824393653485605">如何设计可视化搭建平台的组件商店？</a></li>
<li><a href="https://juejin.cn/post/6981257575425654792" target="_blank" title="https://juejin.cn/post/6981257575425654792">从零设计可视化大屏搭建引擎</a></li>
<li><a href="https://juejin.cn/post/6976476731662139428" target="_blank" title="https://juejin.cn/post/6976476731662139428">从零使用electron搭建桌面端可视化编辑器Dooring</a></li>
<li><a href="https://juejin.cn/post/6973946702235615269" target="_blank" title="https://juejin.cn/post/6973946702235615269">(低代码)可视化搭建平台数据源设计剖析</a></li>
<li><a href="https://juejin.cn/post/6950075140906418213" target="_blank" title="https://juejin.cn/post/6950075140906418213">从零搭建一款PC页面编辑器PC-Dooring</a></li>
<li><a href="https://juejin.cn/post/6904878119724056584" target="_blank" title="https://juejin.cn/post/6904878119724056584">如何搭积木式的快速开发H5页面?</a></li>
</ul></div>  
</div>
            