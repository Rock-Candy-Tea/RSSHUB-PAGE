
---
title: '产品经理：你能不能在网页里实现裸眼3D'
categories: 
 - 编程
 - 掘金
 - 分类
headimg: 'https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ff3f57253913459cb82d0644fc0d69da~tplv-k3u1fbpfcp-watermark.image'
author: 掘金
comments: false
date: Sun, 25 Jul 2021 12:46:35 GMT
thumbnail: 'https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ff3f57253913459cb82d0644fc0d69da~tplv-k3u1fbpfcp-watermark.image'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><p>本文已参与好文召集令活动，点击查看：<a href="https://juejin.cn/post/6978685539985653767" target="_blank" title="https://juejin.cn/post/6978685539985653767">后端、大前端双赛道投稿，2万元奖池等你挑战！</a></p>
<blockquote>
<p>大家好，我是大帅老猿，不知道自己是什么系程序猿，但可不可以加入火箭队呢？如果喜欢我的文章，可以关注➕点赞，与我一同修行吧～</p>
</blockquote>
<hr>
<h1 data-id="heading-0">前言</h1>
<p>最近<code>产品经理</code>在掘金社区的出镜率很高，看来大家都很喜闻乐见工程师与产品经理的相爱相杀。</p>
<p>这次他让我调研一下在网页里实现裸眼3D</p>
<p>这是故意为难我把？</p>
<p>搞什么调研影响我摸鱼</p>
<p>现在的我想拿枪打他</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ff3f57253913459cb82d0644fc0d69da~tplv-k3u1fbpfcp-watermark.image" alt="619c-hawmaua2753951.gif" loading="lazy" referrerpolicy="no-referrer"></p>
<p>拿弓箭射他</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6352fa2f28ab42c8b715505beac22ae2~tplv-k3u1fbpfcp-watermark.image" alt="26a78036e0304df84daf3c634f264c0d.gif" loading="lazy" referrerpolicy="no-referrer"></p>
<p>点火烧他</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3b38a92d5e894ecbb0e9d77aa32f5ed7~tplv-k3u1fbpfcp-watermark.image" alt="c685-hawmaua2754245.gif" loading="lazy" referrerpolicy="no-referrer"></p>
<p>诶，如果我在3D场景中刻意加上一些框框，会不会看上去更立体呢？</p>
<h1 data-id="heading-1">方案一：造个框框，再打破它</h1>
<p>现在我们用一个非常简单的立方体来试试看</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5f09a88e84414ca2b109aace03df0db7~tplv-k3u1fbpfcp-watermark.image" alt="2021-07-23 13_50_55.gif" loading="lazy" referrerpolicy="no-referrer"></p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/99dd0ec403cd48d699bd9fc827922706~tplv-k3u1fbpfcp-watermark.image" alt="2021-07-23 13_53_07.gif" loading="lazy" referrerpolicy="no-referrer"></p>
<p>立体感是稍微提升一点，但就这？那怕是交不了差的...</p>
<p>不过，大家发挥一下想象力，<code>框框</code>可以不全是直的，这个B站<code>防遮挡弹幕</code>是不是也让你产生了些<code>裸眼3D</code>的效果呢？</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6728cd17c31c4c6d9d972c98022d8f12~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<h1 data-id="heading-2">方案二：人脸识别</h1>
<p>不行，谁都不能耽误我摸鱼。</p>
<p>此时我又想起另一个方案，是不是可以通过摄像头实时检测人脸在摄像头画面中的位置来模拟裸眼3D呢。我找到了<code>tracking.js</code>，这是一款在浏览器中可以实时进行人脸检测的库。</p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Feduardolundgren%2Ftracking.js" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/eduardolundgren/tracking.js" ref="nofollow noopener noreferrer">github.com/eduardolund…</a></p>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-keyword">var</span> tracker = <span class="hljs-keyword">new</span> tracking.ObjectTracker(<span class="hljs-string">'face'</span>);
  tracker.setInitialScale(<span class="hljs-number">4</span>);
  tracker.setStepSize(<span class="hljs-number">2</span>);
  tracker.setEdgesDensity(<span class="hljs-number">0.1</span>);

  tracking.track(<span class="hljs-string">'#video'</span>, tracker, &#123; <span class="hljs-attr">camera</span>: <span class="hljs-literal">true</span> &#125;);

  tracker.on(<span class="hljs-string">'track'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>&#123;
    context.clearRect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, canvas.width, canvas.height);

    event.data.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">rect</span>) </span>&#123;
      context.strokeStyle = <span class="hljs-string">'#a64ceb'</span>;
      context.strokeRect(rect.x, rect.y, rect.width, rect.height);
      context.font = <span class="hljs-string">'11px Helvetica'</span>;
      context.fillStyle = <span class="hljs-string">"#fff"</span>;
      context.fillText(<span class="hljs-string">'x: '</span> + rect.x + <span class="hljs-string">'px'</span>, rect.x + rect.width + <span class="hljs-number">5</span>, rect.y + <span class="hljs-number">11</span>);
      context.fillText(<span class="hljs-string">'y: '</span> + rect.y + <span class="hljs-string">'px'</span>, rect.x + rect.width + <span class="hljs-number">5</span>, rect.y + <span class="hljs-number">22</span>);
    &#125;);
  &#125;);
<span class="copy-code-btn">复制代码</span></code></pre>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/878ea5515291405f949f941c89cfad6a~tplv-k3u1fbpfcp-watermark.image" alt="2021-07-23 14_45_40.gif" loading="lazy" referrerpolicy="no-referrer"></p>
<p>我们可以看到，画面中呈现了人脸在摄像头视角画布中的坐标，有了这个坐标数据，我们就可以做很多事情了。</p>
<p>接着把它接到<code>threejs</code>中，我们仍然拿这个立方体来试试看</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2874dcb143fc45febbf643c4e3849b69~tplv-k3u1fbpfcp-watermark.image" alt="2021-07-23 15_11_29.gif" loading="lazy" referrerpolicy="no-referrer"></p>
<p>实际体验还有点意思，但录屏的感受不太明显，请自行下载demo源码试试看吧</p>
<h1 data-id="heading-3">方案三：陀螺仪</h1>
<p>W3C标准API<code>DeviceOrientation</code>，用于检测移动设备的旋转方向和加速度。通过这个API，我们可以获取到三个基础属性：</p>
<ul>
<li><code>alpha</code>（设备平放时，水平旋转的角度）</li>
</ul>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1eaeeb2475184fb7831ccc0f6f82e26e~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<ul>
<li><code>beta</code>（设备平放时，绕横向X轴旋转的角度）</li>
</ul>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f6b9db7cce9c41e2a56130f691319d91~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<ul>
<li><code>gamma</code>（设备平放时，绕纵向Y轴旋转的角度）</li>
</ul>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ed4a8536bf5240c580e6301151b2bb3b~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>这个API的使用非常简单，通过给window添加一个监听</p>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">capture_orientation</span> (<span class="hljs-params">event</span>) </span>&#123; 
    <span class="hljs-keyword">var</span> alpha = event.alpha; 
    <span class="hljs-keyword">var</span> beta = event.beta; 
    <span class="hljs-keyword">var</span> gamma = event.gamma; 
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Orientation - Alpha: '</span>+alpha+<span class="hljs-string">', Beta: '</span>+beta+<span class="hljs-string">', Gamma: '</span>+gamma); 
&#125;

<span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">'deviceorientation'</span>, capture_orientation, <span class="hljs-literal">false</span>);
<span class="copy-code-btn">复制代码</span></code></pre>
<p>现在我们把这个加入到咱们的立方体演示中，在加入的过程中，这里需要注意的是，在<code>IOS</code>设备上，这个API需要主动申请用户权限。</p>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-built_in">window</span>.DeviceOrientationEvent.requestPermission()
    .then(<span class="hljs-function"><span class="hljs-params">state</span> =></span> &#123;
        <span class="hljs-keyword">switch</span> (state) &#123;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"granted"</span>:
                <span class="hljs-comment">//在这里建立监听</span>
                <span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">'deviceorientation'</span>, capture_orientation, <span class="hljs-literal">false</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"denied"</span>:
                alert(<span class="hljs-string">"你拒绝了使用陀螺仪"</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-string">"prompt"</span>:
                alert(<span class="hljs-string">"其他行为"</span>);
                <span class="hljs-keyword">break</span>;
        &#125;
&#125;);
<span class="copy-code-btn">复制代码</span></code></pre>
<p>返回的是一个promise，所以你也可以这么写</p>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-keyword">var</span> permissionState = <span class="hljs-keyword">await</span> <span class="hljs-built_in">window</span>.DeviceOrientationEvent.requestPermission();
<span class="hljs-keyword">if</span>(permissionState==<span class="hljs-string">"granted"</span>)<span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">'deviceorientation'</span>, capture_orientation, <span class="hljs-literal">false</span>);
<span class="copy-code-btn">复制代码</span></code></pre>
<p>还有几点需要注意的事，<code>requestPermission</code>必须由用户主动发起，也就是必须在用户的行为事件里触发，比如“<code>click</code>”，还有就是这个API的调用，必须在<code>HTTPS</code>协议访问的网页里使用。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/55f851ab1404497786d636786064a9a8~tplv-k3u1fbpfcp-watermark.image" alt="2021-07-25 10_46_16.gif" loading="lazy" referrerpolicy="no-referrer"></p>
<h1 data-id="heading-4">结语</h1>
<p>至此，我能想到在网页里实现裸眼3D的几种方法都在此文中，你还能想到别的方法吗？请在评论区一起讨论吧。</p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1964y1x7aW%2F" target="_blank" rel="nofollow noopener noreferrer" title="https://www.bilibili.com/video/BV1964y1x7aW/" ref="nofollow noopener noreferrer">本文配套视频教程</a></p>
<h1 data-id="heading-5">Demo源码</h1>
<p>微信搜索并关注“<code>大帅老猿</code>”，回复“<code>eye3d</code>”获得本文中的示例代码</p></div>  
</div>
            