
---
title: '搭建一个属于自己的云盘'
categories: 
 - 编程
 - 掘金
 - 分类
headimg: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7b268b0b224a44fa957b27239b930a26~tplv-k3u1fbpfcp-zoom-1.image'
author: 掘金
comments: false
date: Mon, 19 Jul 2021 09:34:14 GMT
thumbnail: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7b268b0b224a44fa957b27239b930a26~tplv-k3u1fbpfcp-zoom-1.image'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><h2 data-id="heading-0">前言</h2>
<p>kodbox是一款云存储程序，支持跨平台访问，可以用它来构建一套网盘存储系统，本文就跟大家分享下整个搭建过程，欢迎各位感兴趣的开发者阅读本文。</p>
<h2 data-id="heading-1">环境搭建</h2>
<p>我们先去可道云官网下载<a href="https://link.juejin.cn/?target=https%3A%2F%2Fkodcloud.com%2Fdownload%2F" target="_blank" rel="nofollow noopener noreferrer" title="https://kodcloud.com/download/" ref="nofollow noopener noreferrer">服务端安装包</a>，如下所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7b268b0b224a44fa957b27239b930a26~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210718225825408" loading="lazy" referrerpolicy="no-referrer"></p>
<p>下载成功后，我们将其解压出来，打开解压出来的文件夹如下所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c4502b15146d44eeb99c12ee5ecdfb88~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210718230707638" loading="lazy" referrerpolicy="no-referrer"></p>
<p>这是一个PHP项目，因此我们需要搭建一套PHP运行环境。</p>
<h3 data-id="heading-2">PHP运行环境</h3>
<p>如果你的设备已经安装了PHP环境，这一步可以跳过。</p>
<p>因为我对PHP不是很熟悉，本文直接使用集成工具<a href="https://link.juejin.cn/?target=http%3A%2F%2Fwww.xsrvs.com%2Findex.html" target="_blank" rel="nofollow noopener noreferrer" title="http://www.xsrvs.com/index.html" ref="nofollow noopener noreferrer">MxSrvs</a>,来构建这套环境，软件下载成功后，直接安装即可，安装完成后的界面如下所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0c53e3c3d37a4339a19ef84d526c6c64~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210718234431362" loading="lazy" referrerpolicy="no-referrer"></p>
<blockquote>
<p>序号1标注的地方默认是没有安装的，安装可道云时我们需要选择redis做缓存，因此需要安装下。</p>
</blockquote>
<p>在扩展中点击redis即可</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5bfd2d9c379248c1a09a99eefe540aa7~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210718235952605" loading="lazy" referrerpolicy="no-referrer"></p>
<h2 data-id="heading-3">环境配置</h2>
<p>我们装好必要的环境后，接下来我们来看下具体的配置，打开<code>MxSrvs</code>的配置编辑菜单，如下所示 ：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b2e531c25f3045debc05d2781c4d90fa~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210719000650960" loading="lazy" referrerpolicy="no-referrer"></p>
<h3 data-id="heading-4">配置nginx</h3>
<p>软件集成的nginx，默认端口号是80，由于这个端口号已经被占用了，因此我么需要修改下端口号。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2b28d8b8a6f8404cb765d5be0f210899~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210719000959555" loading="lazy" referrerpolicy="no-referrer"></p>
<p>点击上图中的序号1标注即可打开nginx的配置，我们找到<code>listen:80;</code>将80改为你想改的端口，此处改为<code>82</code>。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3bd38aa2de3f47959e4de24b47d1a546~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210719001406559" loading="lazy" referrerpolicy="no-referrer"></p>
<p>紧接着，我们添加一个路径映射，指定一个端口号用于访问我们的下载好的php项目，如下图所示，添加一个虚拟主机。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dfdd4bab35be46f8bcd19f52191684f7~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210719001624282" loading="lazy" referrerpolicy="no-referrer"></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c85995faebb1452f901f9a597a3d2186~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210719002707907" loading="lazy" referrerpolicy="no-referrer"></p>
<ul>
<li>主机名称为此配置的名字</li>
<li>文件名称为要访问的php文件名称</li>
<li>项目位置为我们刚才下载的php项目位置</li>
</ul>
<p>添加完成后，默认生成的配置不是我们需要的，我们需要将其修改下：</p>
<ul>
<li>listen为访问端口号</li>
<li>server_name 为我们刚才填写的</li>
<li>root 为项目路径，我们需要指向项目的根目录</li>
</ul>
<pre><code class="hljs language-conf copyable" lang="conf">server &#123;
listen83;
server_namekodbox; 
root/Users/likai/Documents/kodbox.1.21;
#access_log/Applications/MxSrvs/logs/kodbox.log;
includevhosts/_nginx.vhost.fpm;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>上述配置是http访问，我还需要https访问，因此还需要再添加一个虚拟主机，配置如下所示：</p>
<ul>
<li>ssl_certificate 为你的ssl证书文件所在路径(需要crt格式的证书)</li>
<li>ssl_certificate_key 为你的ssl证书key文件所在路径</li>
</ul>
<pre><code class="hljs language-conf copyable" lang="conf">server &#123;
listen84 ssl;
server_namekodbox-https;
ssl_certificate      /Users/likai/Documents/nginx-ssl-home.kaisir.cn/1_home.kaisir.cn_bundle.crt;
    ssl_certificate_key  /Users/likai/Documents/nginx-ssl-home.kaisir.cn/2_home.kaisir.cn.key;

    ssl_session_cache    shared:SSL:1m;
    ssl_session_timeout  5m;

    ssl_ciphers  HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers  on;
root/Users/likai/Documents/kodbox.1.21;
#access_log/Applications/MxSrvs/logs/kodbox-https.log;
includevhosts/_nginx.vhost.fpm;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<h3 data-id="heading-5">配置PHP</h3>
<p>软件集成的PHP服务，包含了<code>phpMyAdmin</code>，其默认端口是<code>80</code>，我们需要将其改成自己需要的端口号，此处改为<code>81</code>。</p>
<p>打开<code>/Applications/MxSrvs/bin/nginx/conf/vhosts/localhost.vhost </code>进行修改</p>
<pre><code class="hljs language-vhost copyable" lang="vhost"># phpMyAdmin
server &#123;
listen81;
server_namepma.mxss.com;
root/Applications/MxSrvs/www/_phpmyadmin;
#access_log/Applications/MxSrvs/logs/phpmyadmin.log;
includevhosts/_nginx.vhost.fpm;
&#125;

# webgrind
server &#123;
listen81;
server_namewg.mxss.com;
root/Applications/MxSrvs/www/_webgrind;
#access_log/Applications/MxSrvs/logs/webgrind.log;
includevhosts/_nginx.vhost.fpm;
&#125;

# beanstalk-console
server &#123;
listen81;
server_namebs.mxss.com;
root/Applications/MxSrvs/www/_beanstalk/public;
#access_log/Applications/MxSrvs/logs/beanstalk.log;
includevhosts/_nginx.vhost.fpm;
&#125;

<span class="copy-code-btn">复制代码</span></code></pre>
<h3 data-id="heading-6">配置mysql</h3>
<p>如果你的设备没有安装mysql，可以选择软件集成的mysql服务，默认端口号为3306，如果不冲突则无需做过多配置。</p>
<p>如果冲突的话，则需要改端口号，如下所示，将<code>port</code>所对应的值改为你需要的即可。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3e9b553ae50641f888d5f3b8b1a44610~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210719005317545" loading="lazy" referrerpolicy="no-referrer"></p>
<h3 data-id="heading-7">配置redis</h3>
<p>由于我的设备上已经有了redis，默认端口号<code>6379</code>被占用了，因此我需要修改下端口号，如下所示，我将端口号改为了<code>63790</code></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8b088e9be5c043458f879e4f8abded02~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210719005617317" loading="lazy" referrerpolicy="no-referrer"></p>
<p>随后，我们需要修改下php的配置文件在其末尾添加：</p>
<pre><code class="hljs language-ini copyable" lang="ini"><span class="hljs-attr">extension</span>=redis.so
<span class="copy-code-btn">复制代码</span></code></pre>
<blockquote>
<p>php中使用redis需要安装php-redis插件（MxSrvs默认已经为我们安装了），这一步的目的就是为了让php可以识别到这个插件</p>
</blockquote>
<h2 data-id="heading-8">启动项目</h2>
<p>做完上述配置后，我们就可以启动项目了，我们打开MxSrvs，切换到“程序控制”菜单下，如下所示，根据自己的需要启动对应的服务即可。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8e574d70edc24fcab1f895890d93a97d~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210719010859001" loading="lazy" referrerpolicy="no-referrer"></p>
<p>启动成功后，通过六拉起访问83端口，出现如下所示的界面就配置成功了，点击下一步继续进行初始化即可。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/028db337625f4dfbaff1bcc3b97bfa12~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210719011040513" loading="lazy" referrerpolicy="no-referrer"></p>
<h2 data-id="heading-9">修改可道云端口号</h2>
<p>如果你修改了<code>mysql</code>的端口号或者<code>redis</code>的端口号，初始化项目时可能会报错<code>../app/autoload.php[2];Redis->flushAll0; NOAUTH Authentication required.</code>，这是因为它使用的是默认的redis，还需要在可道云的配置文件中进行对应的修改。</p>
<p>我刚才还修改了<code>redis</code>的端口号，对应的也需要修改下可道云的端口号。</p>
<p>打开<code>kodbox.1.21/config/setting_user.php </code>文件：</p>
<ul>
<li>DB_PORT 为你的mysql端口号</li>
<li>DB_USER 为你的mysql登陆用户名</li>
<li>DB_PWD 为你的mysql登陆密码</li>
<li><code>$config['cache']['redis']['port'] = '63790';</code> 为你的redis端口号（如果你选择了redis作为缓存这一项就会出现）</li>
</ul>
<pre><code class="hljs language-php copyable" lang="php"><span class="hljs-meta"><?php</span> 
<span class="hljs-variable">$config</span>[<span class="hljs-string">'database'</span>] = <span class="hljs-keyword">array</span> (
  <span class="hljs-string">'DB_TYPE'</span> => <span class="hljs-string">'mysqli'</span>,
  <span class="hljs-string">'DB_HOST'</span> => <span class="hljs-string">'127.0.0.1'</span>,
  <span class="hljs-string">'DB_PORT'</span> => <span class="hljs-number">3306</span>,
  <span class="hljs-string">'DB_USER'</span> => <span class="hljs-string">'root'</span>,
  <span class="hljs-string">'DB_PWD'</span> => <span class="hljs-string">'xxxx'</span>,
  <span class="hljs-string">'DB_NAME'</span> => <span class="hljs-string">'kodbox'</span>,
  <span class="hljs-string">'DB_SQL_LOG'</span> => <span class="hljs-literal">true</span>,
  <span class="hljs-string">'DB_FIELDS_CACHE'</span> => <span class="hljs-literal">true</span>,
  <span class="hljs-string">'DB_SQL_BUILD_CACHE'</span> => <span class="hljs-literal">false</span>,
);
<span class="hljs-variable">$config</span>[<span class="hljs-string">'cache'</span>][<span class="hljs-string">'sessionType'</span>] = <span class="hljs-string">'file'</span>;
<span class="hljs-variable">$config</span>[<span class="hljs-string">'cache'</span>][<span class="hljs-string">'cacheType'</span>] = <span class="hljs-string">'file'</span>;


<span class="hljs-variable">$config</span>[<span class="hljs-string">'cache'</span>][<span class="hljs-string">'sessionType'</span>] = <span class="hljs-string">'redis'</span>;
<span class="hljs-variable">$config</span>[<span class="hljs-string">'cache'</span>][<span class="hljs-string">'cacheType'</span>] = <span class="hljs-string">'redis'</span>;
<span class="hljs-variable">$config</span>[<span class="hljs-string">'cache'</span>][<span class="hljs-string">'redis'</span>][<span class="hljs-string">'host'</span>] = <span class="hljs-string">'127.0.0.1'</span>;
<span class="hljs-variable">$config</span>[<span class="hljs-string">'cache'</span>][<span class="hljs-string">'redis'</span>][<span class="hljs-string">'port'</span>] = <span class="hljs-string">'63790'</span>;

<span class="copy-code-btn">复制代码</span></code></pre>
<h2 data-id="heading-10">实现效果</h2>
<p>完成上述配置后，刷新浏览器即可成功进入可道云主界面，如下所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/94cdb452db0643498e8fd49244098f5d~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210719011845567" loading="lazy" referrerpolicy="no-referrer"></p>
<h2 data-id="heading-11">下载客户端</h2>
<p>可道云的客户端有android、ios、web、mac、windows，在其官网的<a href="https://link.juejin.cn/?target=https%3A%2F%2Fkodcloud.com%2Fdownload%2F" target="_blank" rel="nofollow noopener noreferrer" title="https://kodcloud.com/download/" ref="nofollow noopener noreferrer">下载界面</a>即可下载对应的客户端。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/002d2b3bda044b5da177af94c0452007~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210719012216783" loading="lazy" referrerpolicy="no-referrer"></p>
<h2 data-id="heading-12">写在最后</h2>
<p>至此，文章就分享完毕了。</p>
<p>我是<strong>神奇的程序员</strong>，一位前端开发工程师。</p>
<p>如果你对我感兴趣，请移步我的<a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.kaisir.cn%2F" target="_blank" rel="nofollow noopener noreferrer" title="https://www.kaisir.cn/" ref="nofollow noopener noreferrer">个人网站</a>，进一步了解。</p>
<ul>
<li>文中如有错误，欢迎在评论区指正，如果这篇文章帮到了你，欢迎点赞和关注😊</li>
<li>本文首发于掘金，未经许可禁止转载💌</li>
</ul></div>  
</div>
            