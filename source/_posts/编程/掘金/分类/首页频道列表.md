
---
title: '首页频道列表'
categories: 
 - 编程
 - 掘金
 - 分类
headimg: 'https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9b34609f4e8b440999b20341c967dc88~tplv-k3u1fbpfcp-watermark.image'
author: 掘金
comments: false
date: Tue, 08 Jun 2021 08:00:06 GMT
thumbnail: 'https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9b34609f4e8b440999b20341c967dc88~tplv-k3u1fbpfcp-watermark.image'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><h1 data-id="heading-0">一. 基本结构</h1>
<p>在views/home/index使用<a href="https://youzan.github.io/vant/#/zh-CN/tab#hua-dong-qie-huan" target="_blank" rel="nofollow noopener noreferrer">tabs组件</a> 来放置频道列表</p>
<pre><code class="hljs language-js copyable" lang="js"><!-- 频道列表
<span class="hljs-attr">https</span>:<span class="hljs-comment">//vant-contrib.gitee.io/vant/#/zh-CN/tab#biao-qian-lan-gun-dong</span>
-->
<span class="xml"><span class="hljs-tag"><<span class="hljs-name">template</span>></span>
  <span class="hljs-tag"><<span class="hljs-name">div</span>></span>
    <span class="hljs-tag"><<span class="hljs-name">van-tabs</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"active"</span>></span>
      <span class="hljs-tag"><<span class="hljs-name">van-tab</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"标签 1"</span>></span>内容1<span class="hljs-tag"></<span class="hljs-name">van-tab</span>></span>
      <span class="hljs-tag"><<span class="hljs-name">van-tab</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"标签 2"</span>></span>内容2<span class="hljs-tag"></<span class="hljs-name">van-tab</span>></span>
      <span class="hljs-tag"><<span class="hljs-name">van-tab</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"标签 3"</span>></span>内容3<span class="hljs-tag"></<span class="hljs-name">van-tab</span>></span>
      <span class="hljs-tag"><<span class="hljs-name">van-tab</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"标签 4"</span>></span>内容4<span class="hljs-tag"></<span class="hljs-name">van-tab</span>></span>
      <span class="hljs-tag"><<span class="hljs-name">van-tab</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"标签 5"</span>></span>内容5<span class="hljs-tag"></<span class="hljs-name">van-tab</span>></span>
      <span class="hljs-tag"><<span class="hljs-name">van-tab</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"标签 6"</span>></span>内容6<span class="hljs-tag"></<span class="hljs-name">van-tab</span>></span>
      <span class="hljs-tag"><<span class="hljs-name">van-tab</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"标签 7"</span>></span>内容7<span class="hljs-tag"></<span class="hljs-name">van-tab</span>></span>
      <span class="hljs-tag"><<span class="hljs-name">van-tab</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"标签 8"</span>></span>内容8<span class="hljs-tag"></<span class="hljs-name">van-tab</span>></span>
    <span class="hljs-tag"></<span class="hljs-name">van-tabs</span>></span>
    <span class="hljs-comment"><!--1. tab --></span>
    <span class="hljs-comment"><!--2. list --></span>

  <span class="hljs-tag"></<span class="hljs-name">div</span>></span>
<span class="hljs-tag"></<span class="hljs-name">template</span>></span></span>

<span class="xml"><span class="hljs-tag"><<span class="hljs-name">script</span>></span><span class="javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;
  <span class="hljs-attr">name</span>: <span class="hljs-string">'Index'</span>,
  data () &#123;
    <span class="hljs-keyword">return</span> &#123;
      <span class="hljs-attr">active</span>: <span class="hljs-number">1</span>
    &#125;
  &#125;
&#125;
</span><span class="hljs-tag"></<span class="hljs-name">script</span>></span></span>
<span class="copy-code-btn">复制代码</span></code></pre>
<p>内容要放在对应的<code>van-tab</code>插槽中</p>
<h1 data-id="heading-1">二. 获取频道并显示</h1>
<p>发请求，获取频道列表数据</p>
<h2 data-id="heading-2">1. 封装api</h2>
<p>涉及频道的相关操作很多，封装一个模块来统一处理</p>
<p>创建新文件<code>src/api/channel.js</code></p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-comment">// 处理频道相关操作</span>
<span class="hljs-keyword">import</span> request <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils/request'</span>

<span class="hljs-comment">/**
 * 获取频道列表
 * <span class="hljs-doctag">@returns</span>
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> getChannels = <span class="hljs-function">() =></span> &#123;
  <span class="hljs-keyword">return</span> request(&#123;
    <span class="hljs-attr">url</span>: <span class="hljs-string">'v1_0/user/channels'</span>,
    <span class="hljs-attr">method</span>: <span class="hljs-string">'GET'</span>
  &#125;)
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>这个版本的接口允许不传入token</p>
<h2 data-id="heading-3">2. 调用api获取数据</h2>
<p>在<code>views/home/home.vue</code>中：</p>
<ul>
<li>导入接口</li>
<li>调用接口，保存获取到的数据</li>
<li>数据渲染</li>
</ul>
<p>导入接口函数</p>
<blockquote>
<p>import &#123; getChannels &#125; from '@/api/channel.js'</p>
</blockquote>
<p>使用接口函数</p>
<pre><code class="hljs language-js copyable" lang="js"><script>
<span class="hljs-keyword">import</span> &#123; getChannels &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@/api/channel.js'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;
  data () &#123;
    <span class="hljs-keyword">return</span> &#123;
      <span class="hljs-attr">active</span>: <span class="hljs-number">2</span>, <span class="hljs-comment">// tabs中的选中项的下标</span>
      <span class="hljs-attr">channels</span>: [] <span class="hljs-comment">// 频道列表</span>
    &#125;
  &#125;,
  created () &#123;
    <span class="hljs-built_in">this</span>.loadChannels()
  &#125;,
  <span class="hljs-attr">methods</span>: &#123;
<span class="hljs-keyword">async</span> loadChannels () &#123;
      <span class="hljs-keyword">try</span> &#123;
        <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> getChannels()
        <span class="hljs-built_in">console</span>.log(res)
        <span class="hljs-built_in">this</span>.channels = res.data.data.channels
      &#125; <span class="hljs-keyword">catch</span> (err) &#123;
        <span class="hljs-built_in">console</span>.log(err)
      &#125;
    &#125;
  &#125;
&#125;
</script>
<span class="copy-code-btn">复制代码</span></code></pre>
<h2 data-id="heading-4">3. 渲染视图</h2>
<p>根据数据项<code>channels</code>中的值，通过v-for循环进行渲染</p>
<pre><code class="hljs language-js copyable" lang="js"><van-tabs>
  <span class="xml"><span class="hljs-tag"><<span class="hljs-name">van-tab</span>
       <span class="hljs-attr">v-for</span>=<span class="hljs-string">"channel in channels"</span>
       <span class="hljs-attr">:title</span>=<span class="hljs-string">"channel.name"</span>
       <span class="hljs-attr">:key</span>=<span class="hljs-string">"channel.id"</span>></span>
    频道内容 &#123;&#123; channel.name &#125;&#125;
  <span class="hljs-tag"></<span class="hljs-name">van-tab</span>></span></span>
</van-tabs>
<span class="copy-code-btn">复制代码</span></code></pre>
<h2 data-id="heading-5">4. 检查效果</h2>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9b34609f4e8b440999b20341c967dc88~tplv-k3u1fbpfcp-watermark.image" alt="image-20200707104853206.png" loading="lazy" referrerpolicy="no-referrer"></p>
<h1 data-id="heading-6">四. 频道内容的样式（cv）</h1>
<p>给频道内容添加一个<strong>高度固定</strong>的且<strong>overflow:auto</strong>的父容器，这样当内容较多时，就会自动让滚动条只出现在内容区域</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/863cf9ba839940f5b73a17a3676160f0~tplv-k3u1fbpfcp-watermark.image" alt="image-20210607094750115.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e66446d11bba45e399eb05d4c8f6a7a0~tplv-k3u1fbpfcp-watermark.image" alt="image-20210606235545675.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>采用布局技术，让这个容器能够根据屏幕的尺寸自动得到一个固定的高度值</p>
<pre><code class="hljs language-js copyable" lang="js"><van-tabs>
  <span class="xml"><span class="hljs-tag"><<span class="hljs-name">van-tab</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"channel in channels"</span> <span class="hljs-attr">:title</span>=<span class="hljs-string">"channel.name"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"channel.id"</span>></span>
  <span class="hljs-tag"><<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"height:300px;overflow:auto;border:1px solid red;>
        频道内容 &#123;&#123; channel.name &#125;&#125;
      <p v-for="</span><span class="hljs-attr">idx</span> <span class="hljs-attr">in</span> <span class="hljs-attr">20</span>" <span class="hljs-attr">:key</span>=<span class="hljs-string">"idx"</span>></span>第&#123;&#123;idx&#125;&#125;篇文章<span class="hljs-tag"></<span class="hljs-name">p</span>></span>
      <span class="hljs-tag"></<span class="hljs-name">div</span>></span>
  <span class="hljs-tag"></<span class="hljs-name">van-tab</span>></span></span>
</van-tabs>
<span class="copy-code-btn">复制代码</span></code></pre>
<p><strong>van-nav-bar固定定位</strong></p>
<pre><code class="hljs language-js copyable" lang="js"><!-- 顶部logo搜索导航区域 -->
    <span class="xml"><span class="hljs-tag"><<span class="hljs-name">van-nav-bar</span>
      <span class="hljs-attr">fixed</span>
    ></span>
     省略其它....
    <span class="hljs-tag"></<span class="hljs-name">van-nav-bar</span>></span></span>
<span class="copy-code-btn">复制代码</span></code></pre>
<p><strong>补充必要的class</strong></p>
<ul>
<li>
<p>app.vue的根元素的id是app</p>
</li>
<li>
<p>layout.vue的根元素添加container类</p>
</li>
<li>
<p>home.vue的根元素添加index类</p>
</li>
<li>
<p>scroll-wrapper加在频道内容的容器上</p>
</li>
</ul>
<p><strong>在styles/index.less中通过全局样式来覆盖vant库的样式</strong></p>
<p>给频道内容添加一个高度固定的且overflow:auto的父容器，这样当内容过多时，它就会自动产生垂直方向的滚动条了</p>
<p>在main.js中要引入这个全局样式</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-comment">// 引入全局样式</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'./styles/index.less'</span>
<span class="copy-code-btn">复制代码</span></code></pre>
<p>在home.vue中的频道内容的外层，补充一个容器，并设置class = scroll-wrapper</p>
<pre><code class="hljs language-js copyable" lang="js"><div <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">"index"</span>>
    <span class="xml"><span class="hljs-tag"><<span class="hljs-name">van-tabs</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"active"</span>></span>
      <span class="hljs-tag"><<span class="hljs-name">van-tab</span>
        <span class="hljs-attr">v-for</span>=<span class="hljs-string">"channel in channels"</span>
        <span class="hljs-attr">:key</span>=<span class="hljs-string">"channel.id"</span>
        <span class="hljs-attr">:title</span>=<span class="hljs-string">"channel.name"</span>
      ></span>
        <span class="hljs-tag"><<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"scroll-wrapper"</span>></span>
          内容 &#123;&#123;channel.name&#125;&#125;
          <span class="hljs-tag"><<span class="hljs-name">p</span>
            <span class="hljs-attr">v-for</span>=<span class="hljs-string">"n in 20"</span>
            <span class="hljs-attr">:key</span>=<span class="hljs-string">"n"</span>
          ></span>&#123;&#123;n&#125;&#125;<span class="hljs-tag"></<span class="hljs-name">p</span>></span>
        <span class="hljs-tag"></<span class="hljs-name">div</span>></span>
      <span class="hljs-tag"></<span class="hljs-name">van-tab</span>></span>
    <span class="hljs-tag"></<span class="hljs-name">van-tabs</span>></span></span>
  </div>
<span class="copy-code-btn">复制代码</span></code></pre>
<p>index.less样式:</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-comment">/** 顶部的导航栏 **/</span>
.van-nav-bar__content &#123;
  background-color:#3196fa;
  .van-nav-bar__title&#123;
    <span class="hljs-attr">color</span>: #fff;
  &#125;
&#125;

<span class="hljs-comment">/** 最外层的容器撑满整个屏幕 **/</span>
#app&#123;
  <span class="hljs-attr">position</span>: absolute;
  left: <span class="hljs-number">0</span>;
  top: <span class="hljs-number">0</span>;
  overflow: hidden;
  width: <span class="hljs-number">100</span>%;
  height: <span class="hljs-number">100</span>%;
&#125;
<span class="hljs-comment">/** .container是Layout.vue组件的根元素的类名 **/</span>
.container &#123;
  <span class="hljs-attr">width</span>: <span class="hljs-number">100</span>%;
  height: <span class="hljs-number">100</span>%;
&#125;
<span class="hljs-comment">/** .index 是home/home.vue组件的根元素的类名 **/</span>
.index &#123;
  <span class="hljs-attr">height</span>: <span class="hljs-number">100</span>%;
  <span class="hljs-comment">// 顶部在导航条是固定定位的，让出顶部导航条的距离</span>
  padding-top: 46px;
  .van-tabs &#123;
    padding-top:50px; 
    display: flex;
    flex-direction: column;
    height: <span class="hljs-number">100</span>%;
    .van-tabs__wrap &#123;
      <span class="hljs-attr">position</span>:fixed;
      top:46px; 
      <span class="hljs-comment">/** 跟在顶部固定导航条的下方 **/</span>
      left:0px;
      right:30px; 
      <span class="hljs-comment">/** 高亮当前选中频道的下划线 **/</span>
      .van-tabs__line &#123;
        <span class="hljs-attr">width</span>: 30px !important;
        background-color: #3296fa;
        bottom: 20px;
      &#125;
    &#125;
    .van-tabs__content &#123;
      <span class="hljs-attr">flex</span>:<span class="hljs-number">1</span>;
      overflow: hidden;
      padding-bottom: 4rem;  <span class="hljs-comment">/** 能看到文章列表中的loading效果 **/</span>
      .van-tab__pane&#123; 
        <span class="hljs-attr">height</span>: <span class="hljs-number">100</span>%;
        <span class="hljs-comment">/** .scroll-wrapper 是home/ArticleList.vue组件的根元素的类名 **/</span>
        .scroll-wrapper&#123;
          <span class="hljs-attr">overflow</span>:auto;
          height: <span class="hljs-number">100</span>%;
        &#125;
      &#125;
    &#125;
  &#125;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<h1 data-id="heading-7">van-list组件的<a href="https://youzan.github.io/vant/#/zh-CN/list#list-de-yun-xing-ji-zhi-shi-shi-me" target="_blank" rel="nofollow noopener noreferrer">数据加载机制</a>：</h1>
<ul>
<li>
<p>如果当前的内容不够一屏，它会自动调用onLoad事件的回调函数去加载数据，并填入数据。</p>
</li>
<li>
<p><code>List</code>有以下三种状态：</p>
</li>
<li>
<p>非加载中，<code>loading</code>为<code>false</code>，此时会根据列表滚动位置判断是否触发<code>load</code>事件（列表内容不足一屏幕时，会直接触发）</p>
<ul>
<li>加载中，<code>loading</code>为<code>true</code>，表示正在发送异步请求，此时不会重复触发<code>load</code>事件</li>
<li>加载完成，<code>finished</code>为<code>true</code>，此时将再也不会触发<code>load</code>事件</li>
</ul>
</li>
<li>
<p>在每次请求完毕后，需要手动将<code>loading</code>设置为<code>false</code>，表示本次加载结束</p>
</li>
</ul></div>  
</div>
            