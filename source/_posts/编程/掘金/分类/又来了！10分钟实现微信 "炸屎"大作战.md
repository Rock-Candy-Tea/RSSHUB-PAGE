
---
title: '又来了！10分钟实现微信 "炸屎"大作战'
categories: 
 - 编程
 - 掘金
 - 分类
headimg: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6f5880af4d0c40c8a431292a84b0418a~tplv-k3u1fbpfcp-zoom-1.image'
author: 掘金
comments: false
date: Wed, 02 Jun 2021 19:18:10 GMT
thumbnail: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6f5880af4d0c40c8a431292a84b0418a~tplv-k3u1fbpfcp-zoom-1.image'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><p>大家好，我是秋风，近日，微信又发布了新功能（更新到微信8.0.6）。最火热的非"炸屎"功能莫属了，各种群里纷纷玩起了炸屎的功能。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6f5880af4d0c40c8a431292a84b0418a~tplv-k3u1fbpfcp-zoom-1.image" alt="8gr3b-uxuyu" loading="lazy" referrerpolicy="no-referrer"></p>
<p>不知道大家是否经历过那样一个时候，小时候过年也会看到邻家小孩干这种恶趣味，没想到微信给它做成了一个线上版本。这个功能发明，连创造产品的本人也进行了调侃。但是能做一个功能让全民玩的开心，也不枉产品的出现的意义了。</p>
<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d12499b622c14fbf9a167e44fb460df7~tplv-k3u1fbpfcp-zoom-1.image" width="300" loading="lazy" referrerpolicy="no-referrer">
<p>之前在微信8.0 更新的时候，我也写过一篇<a href="https://mp.weixin.qq.com/s/h2AhO0X-gboZ0TDekcW6nw" target="_blank" rel="nofollow noopener noreferrer">《教你实现微信8.0『炸裂』的礼花表情特效》</a>。之前一篇文章中我是用 <code>canvas</code> 来实现的，上次在文章末有人评论，可以通过 <code>lottie </code> 来实现相似的功能，其实我对这个还是挺感兴趣的，但是一直没有尝试，这一次我就想通过新的方式 <code>lottie</code> 来实现一下这功能。</p>
<p>效果体验:</p>
<p><a href="https://example.qiufeng.blue/wechat-feces/3-2-feces.html" target="_blank" rel="nofollow noopener noreferrer">example.qiufeng.blue/wechat-fece…</a></p>
<p>Github地址：</p>
<p><a href="https://github.com/hua1995116/node-demo/tree/master/wechat-feces" target="_blank" rel="nofollow noopener noreferrer">github.com/hua1995116/…</a></p>
<h2 data-id="heading-0">步骤拆解</h2>
<p>任何一个物体都是由更微小的物体构成，因此我们想要实现以上功能，自然也得一步一步地来。我大致将以上功能拆解成了以下四个步骤。里面的每一个都不会太难，可以说前端小白也能轻松实现。</p>
<p><strong>1.丢炸弹</strong></p>
<p>这一步，我们可以用二次函数的知识，来写一个轨迹路径（类似 y = <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>x</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">x^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span> ），然后通过<code>tween.js</code>来做补间动画。</p>
<p><strong>2.炸弹爆炸</strong></p>
<p>利用<code>lottie</code> 来实现动画。</p>
<p><strong>3.粑粑被炸开</strong></p>
<p>利用 <code>css</code> 动画实现</p>
<p><strong>4.所有人震动</strong></p>
<p>利用 <code>css</code> 动画实现</p>
<p><strong>总结</strong></p>
<p>以上我们大致想说的思路，也许你看思路就对其中一些的实现已经轻车熟路，那你可以跳过一部分。有了上面的思路后，那我们就真刀真枪开始实践啦。</p>
<h2 data-id="heading-1">具体实现</h2>
<h3 data-id="heading-2">1.丢炸弹</h3>
<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/05513d35c18f44db92d247ff1e447328~tplv-k3u1fbpfcp-zoom-1.image" width="300" loading="lazy" referrerpolicy="no-referrer">
<p>我们通过仔细观察其实可以看到，炸弹的运动轨迹其实就是一个抛物线。我们想要实现这个功能，很容易地就可以联想到二次函数。</p>
<p>首先我们先来看看二次函数的定义。</p>
<blockquote>
<p>一般地，把形如<strong>y=ax²+bx+c（a≠0）</strong>（a、b、c是<a href="https://baike.baidu.com/item/%E5%B8%B8%E6%95%B0" target="_blank" rel="nofollow noopener noreferrer">常数</a>）的<a href="https://baike.baidu.com/item/%E5%87%BD%E6%95%B0/301912" target="_blank" rel="nofollow noopener noreferrer">函数</a>叫做二次函数。</p>
</blockquote>
<p>从图像上来表达就是这样的。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/88b02c446d5f472f9b75b98386ee1e9d~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210531230619104" loading="lazy" referrerpolicy="no-referrer"></p>
<p>很显然这和我们想要的轨迹非常的相似。</p>
<p>因为正常的笛卡尔坐标系都是以竖直向上为 y 正轴，横向向右为 x 正轴。而对于 dom 定位而言，左上方为 （0，0）横向向右为 x 正轴，竖直向下为 y 正轴。只不过将坐标系沿着 x 轴进行了一个翻转。</p>
<p>因此我们只要确定一个二次函数，我们就能得到轨迹。由于二次函数的通项有3个未知数，因此，我们只需要知道3个点就能确定一个二次函数。我们先假定我们的二次函数是这样的。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d67a47a43a5c475b8c3038f7f494ac75~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210531233814669" loading="lazy" referrerpolicy="no-referrer"></p>
<p>我们的3个点分别为 (0,H)，(H,0)，(3H, 3H) 我们通过代入通项可以得出以下公式：</p>
<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f041ab5ae2bb425989b66318d73672a9~tplv-k3u1fbpfcp-zoom-1.image" width="200" loading="lazy" referrerpolicy="no-referrer">
<p>然后解出</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2d3a35ced830426d96e8b80834af4873~tplv-k3u1fbpfcp-zoom-1.image" alt="1622476435264-1" loading="lazy" referrerpolicy="no-referrer"></p>
<p>得到：</p>
<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ef4f940753924298a4c6129afe8b261b~tplv-k3u1fbpfcp-zoom-1.image" width="200" loading="lazy" referrerpolicy="no-referrer">
<p>因此，我们只需要得到这个炸弹最高点距离"屎"的高度，就能画出整个轨迹。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/437d072835e448b699f0e7b229be5c3c~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210531235633501" loading="lazy" referrerpolicy="no-referrer"></p>
<p>现在假设我们的炸弹是一个 10px * 10px 的小方块，设置起始点为（300，300）终点为 （0，100） H=100，此时我们得到的二次函数为：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/52ed6cf5227c4e70a066d50fba69e1f7~tplv-k3u1fbpfcp-zoom-1.image" alt="1622477784304" loading="lazy" referrerpolicy="no-referrer"></p>
<p>我们就能得到以下轨迹动画：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/07fed02052d3434abf61662356ed3f01~tplv-k3u1fbpfcp-zoom-1.image" alt="2021-06-01-00.27.29" loading="lazy" referrerpolicy="no-referrer"></p>
<p>而渲染每一帧动画，我们则用了著名的补间动画库<a href="http://tweenjs.github.io/tween.js" target="_blank" rel="nofollow noopener noreferrer">Tween.js</a>  补间(动画)是一个概念，允许你以平滑的方式更改对象的属性。你只需告诉它哪些属性要更改，当补间结束运行时它们应该具有哪些最终值，以及这需要多长时间，补间引擎将负责计算从起始点到结束点的值。</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">var</span> coords = &#123; <span class="hljs-attr">x</span>: <span class="hljs-number">300</span> &#125;;  <span class="hljs-comment">// 起始点 为 x = 300</span>
<span class="hljs-keyword">var</span> tween = <span class="hljs-keyword">new</span> TWEEN.Tween(coords)
.to(&#123; <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>  &#125;, <span class="hljs-number">1000</span>) <span class="hljs-comment">// 终点为 x = 0, 并且这个动作将在1秒内完成</span>
  .easing(TWEEN.Easing.Linear.None)<span class="hljs-comment">// 匀速</span>
<span class="copy-code-btn">复制代码</span></code></pre>
<p>通过以上定义，我们就可以在 <code>onUpdate</code> 中，拿到每次变化的<code>x</code>值，然后通过上面二次函数得到 y，然后对小方块进行更新。</p>
<pre><code class="hljs language-js copyable" lang="js">tween.onUpdate(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;
    <span class="hljs-keyword">var</span> x = coords.x;
    <span class="hljs-keyword">var</span> y = <span class="hljs-number">1</span>/<span class="hljs-number">120</span> * x * x - <span class="hljs-number">11</span>/<span class="hljs-number">6</span> * x + <span class="hljs-number">100</span>;
box.style.setProperty(<span class="hljs-string">'transform'</span>, <span class="hljs-string">'translate('</span> + x + <span class="hljs-string">'px, '</span> + y + <span class="hljs-string">'px)'</span>);
&#125;)
<span class="copy-code-btn">复制代码</span></code></pre>
<p>此时我们完成的效果还是缺了点东西，就像画画一样，我们只给他画了骨骼，我们需要给它包装上色，接下来我们只需要做以下两件事，然后就能看到效果啦~</p>
<p>1.将方块换成炸弹然，炸弹的形状很简单，我们可以通过 ps 将它从图层中抠出来。</p>
<p>2.修改它运动时候的角度。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a01b86a7bda946ac8048fd7123db425f~tplv-k3u1fbpfcp-zoom-1.image" alt="2021-06-01-23.19.17" loading="lazy" referrerpolicy="no-referrer"></p>
<p>本节完整代码：<a href="https://github.com/hua1995116/node-demo/blob/master/wechat-feces/1-2-animation.html" target="_blank" rel="nofollow noopener noreferrer">github.com/hua1995116/…</a></p>
<h3 data-id="heading-3">2.炸弹爆炸</h3>
<p>然后再谈谈炸弹爆炸的效果，上面也说了，想换成<code>lottie </code> 来写动画，那么<code>lottie</code> 是什么呢？</p>
<blockquote>
<p>Lottie是一个库，可以解析使用AE制作的动画（需要用bodymovin导出为json格式），支持web、ios、android和react native。在web侧，lottie-web库可以解析导出的动画json文件，并将其以svg或者canvas的方式将动画绘制到我们页面中。</p>
</blockquote>
<p>然后我去 <a href="https://lottiefiles.com/" target="_blank" rel="nofollow noopener noreferrer">lottiefiles.com/</a> 找了一个<code>json</code>爆炸的特效文件。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2b05754935c04669929c2e62024fc4ba~tplv-k3u1fbpfcp-zoom-1.image" alt="2021-06-01-23.29.33" loading="lazy" referrerpolicy="no-referrer"></p>
<p>而它的写法非常简单，只需要引入 <code>lottie </code>，然后调用 <code>bodymovin.loadAnimation</code> 方法。</p>
<pre><code class="hljs language-html copyable" lang="html"><span class="hljs-tag"><<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.bootcdn.net/ajax/libs/lottie-web/5.7.8/lottie.min.js"</span>></span><span class="hljs-tag"></<span class="hljs-name">script</span>></span>
<span class="hljs-tag"></<span class="hljs-name">head</span>></span>
<span class="hljs-tag"><<span class="hljs-name">body</span>></span>
<span class="hljs-tag"><<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"bodymovin"</span>></span><span class="hljs-tag"></<span class="hljs-name">div</span>></span>
<span class="hljs-tag"><<span class="hljs-name">script</span>></span><span class="javascript">
    <span class="hljs-keyword">const</span> animation = <span class="hljs-built_in">window</span>.bodymovin.loadAnimation(&#123;
        <span class="hljs-attr">container</span>: <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">'.bodymovin'</span>), <span class="hljs-comment">// 要包含该动画的dom元素</span>
        <span class="hljs-attr">renderer</span>: <span class="hljs-string">'svg'</span>, <span class="hljs-comment">// 渲染方式，svg、canvas、html（轻量版仅svg渲染）</span>
        <span class="hljs-attr">loop</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 是否循环播放</span>
        <span class="hljs-attr">autoplay</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 是否自动播放</span>
        <span class="hljs-attr">path</span>: <span class="hljs-string">'./bomb.json'</span>, <span class="hljs-comment">// 动画json文件路径</span>
    &#125;);
</span><span class="hljs-tag"></<span class="hljs-name">script</span>></span>
<span class="copy-code-btn">复制代码</span></code></pre>
<p>因此我们只需要在抛物线完成后再立即调用爆炸特效，而<code>tween.js</code> 也给我提供了事件方法<code>onComplete</code>。我们只需要在<code>onComplete</code>回调中，让爆炸动画开始。</p>
<pre><code class="hljs language-js copyable" lang="js">tween.onComplete(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;
  <span class="hljs-comment">// 写爆炸动画</span>
&#125;)
<span class="copy-code-btn">复制代码</span></code></pre>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a83ec760293a44a5aa1e9e58caebecf5~tplv-k3u1fbpfcp-zoom-1.image" alt="2021-06-02-01.53.54" loading="lazy" referrerpolicy="no-referrer"></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c7f0bb71651743408754bbc25f8a0ac4~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210602013807913" loading="lazy" referrerpolicy="no-referrer"></p>
<p>本节完整代码： <a href="https://github.com/hua1995116/node-demo/blob/master/wechat-feces/2-2-lottie.html" target="_blank" rel="nofollow noopener noreferrer">github.com/hua1995116/…</a></p>
<h3 data-id="heading-4">3.粑粑被炸开</h3>
<h4 data-id="heading-5">3.1形状</h4>
<p>同理炸弹用 PS 抠图把 "粑粑" 抠出一个透明的图层，就想这样。（稍微有点毛刺没关系，实际的粑粑也没这么大, 所以不太容易看到毛刺，也可以通过微调给他修复）</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/80a99eaa52e844eb90ee4bcbd0ad9be0~tplv-k3u1fbpfcp-zoom-1.image" alt="feces" loading="lazy" referrerpolicy="no-referrer"></p>
<pre><code class="hljs language-css copyable" lang="css"><span class="hljs-selector-class">.feces</span> &#123;
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">background-image</span>: <span class="hljs-built_in">url</span>(<span class="hljs-string">./feces.png</span>);
  <span class="hljs-attribute">background-size</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">background-position</span>: center;
  <span class="hljs-attribute">background-repeat</span>: no-repeat;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">80px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">80px</span>;
  <span class="hljs-attribute">transform-origin</span>: center;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-comment">// 创建一个粑粑元素</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createfeces</span>(<span class="hljs-params">scale = <span class="hljs-number">1</span></span>) </span>&#123;
  <span class="hljs-keyword">const</span> fece = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'div'</span>);
  fece.className = <span class="hljs-string">'feces'</span>;
  <span class="hljs-comment">// 由于粑粑有大有小，有方向，因此预留了值。</span>
  <span class="hljs-keyword">const</span> symbol = <span class="hljs-built_in">Math</span>.random() > <span class="hljs-number">0.5</span> ? <span class="hljs-number">1</span> : -<span class="hljs-number">1</span>;
  fece.style.transform = <span class="hljs-string">`scale(<span class="hljs-subst">$&#123;scale * <span class="hljs-number">1.1</span>&#125;</span>) rotate(<span class="hljs-subst">$&#123;symbol * <span class="hljs-number">20</span> * <span class="hljs-built_in">Math</span>.random()&#125;</span>deg)`</span>
  <span class="hljs-keyword">return</span> fece;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<h4 data-id="heading-6">3.2位置</h4>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/14e5672c0410495197cbbc50ee42793a~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210602221656176" loading="lazy" referrerpolicy="no-referrer"></p>
<p>我们可以看到粑粑是从炸裂的地方飞出来的，飞出来主要是7个粑粑，其中中间的最大，其他的随着离中心粑粑越远而越小，排列的方式是类似于一个圆，但是又不是那么规律。</p>
<p>因此我们可以先通过最简单的方式来实现，就是以一个圆形环绕。一个圆是 360 °，我们只需要给它平均分成6等分就好。我们环绕的一共是6个粑粑，因此，每个之间是60°。</p>
<p>由于我们上面的炸弹是大致是一个 300 * 300的区域，因此我将<strong>中心的坐标定为(150,150)</strong>，然后随机生成一个 70 ~ 230 的x点，就能算出 y 值，在确定第一个点后，根据每个点之间的角度是 60°，就能计算出其余的5个点。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bbd790051fbc42528a3d1d00292a9777~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210603002233233" loading="lazy" referrerpolicy="no-referrer"></p>
<p>由于用中心点为 (150,150) 为圆心计算比较麻烦，因此我将中心点移到了(0, 0)进行计算，最后再将所有计算出来的点都往 x 轴，y 轴平移 150。</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-comment">// 计算要生成的多个粑粑的位置</span>
<span class="hljs-comment">// 传入的参数num为要生成的粑粑的数量</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">randomPosition</span>(<span class="hljs-params">num</span>) </span>&#123;
  <span class="hljs-keyword">const</span> radius = <span class="hljs-number">80</span>; <span class="hljs-comment">// 圆半径</span>
  <span class="hljs-keyword">const</span> randomX = <span class="hljs-built_in">Math</span>.random() * radius <span class="hljs-comment">// 任取0到半径中的任意一个x</span>
  <span class="hljs-keyword">const</span> y = <span class="hljs-built_in">Math</span>.round(<span class="hljs-built_in">Math</span>.sqrt(radius * radius - randomX * randomX)); <span class="hljs-comment">// 确定一个第一象限在圆上的点</span>
  <span class="hljs-keyword">const</span> radian = <span class="hljs-built_in">Math</span>.atan(y / randomX); <span class="hljs-comment">// 这个点的弧度值</span>

  <span class="hljs-keyword">const</span> step = <span class="hljs-built_in">Math</span>.PI * <span class="hljs-number">2</span> / num; <span class="hljs-comment">// 每坨屎间距的弧度值</span>

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(num).fill(<span class="hljs-number">0</span>).map(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =></span> &#123;
    <span class="hljs-keyword">const</span> r = (index * step + radian)
    <span class="hljs-comment">// 将弧度为0 - 2 * PI</span>
    <span class="hljs-keyword">const</span> tr = r > <span class="hljs-built_in">Math</span>.PI * <span class="hljs-number">2</span> ? r - <span class="hljs-built_in">Math</span>.PI * <span class="hljs-number">2</span> : r < <span class="hljs-number">0</span> ? r + <span class="hljs-built_in">Math</span>.PI * <span class="hljs-number">2</span> : r;
    <span class="hljs-keyword">return</span> &#123;
      <span class="hljs-attr">x</span>: radius * <span class="hljs-built_in">Math</span>.sin(tr),
      <span class="hljs-attr">y</span>: radius * <span class="hljs-built_in">Math</span>.cos(tr),
    &#125;
  &#125;)
            
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/549b41d4160e4f95b645f0cb91077acc~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210603002426209" loading="lazy" referrerpolicy="no-referrer"></p>
<p>然后我们按照这个思路进行绘制，绘制出 6 个粑粑，再向x轴和y轴分别平移150。</p>
<pre><code class="hljs language-js copyable" lang="js">randomPosition(<span class="hljs-number">6</span>).map(<span class="hljs-function"><span class="hljs-params">item</span> =></span> (&#123; <span class="hljs-attr">x</span>: item.x + <span class="hljs-number">150</span>, <span class="hljs-attr">y</span>: item.y + <span class="hljs-number">150</span> &#125;)) <span class="hljs-comment">// 此处你也定义多于6个</span>
<span class="copy-code-btn">复制代码</span></code></pre>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ab2be82d64034a9c90fbc2c77a1b26fc~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210603002701496" loading="lazy" referrerpolicy="no-referrer"></p>
<p>貌似有点那味了，但是所有的都一样大，因此我们需要处理一下，根据距离中心远近来缩放大小，大致写了一个，因为圆的半径为80，每增加 80，就把粑粑的大小变成原来的 2/3。</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">const</span> dis = <span class="hljs-built_in">Math</span>.sqrt((end.x - <span class="hljs-number">150</span>) * (end.x - <span class="hljs-number">150</span>) + (end.y - <span class="hljs-number">150</span>) * (end.y - <span class="hljs-number">150</span>)); <span class="hljs-comment">// 由于此时已经平移 150 ，因此需要计算距离中心点的距离</span>
<span class="hljs-keyword">const</span> r = <span class="hljs-built_in">Math</span>.pow(<span class="hljs-number">2</span>/<span class="hljs-number">3</span>, dis / length); <span class="hljs-comment">// 要缩放的比例</span>
<span class="copy-code-btn">复制代码</span></code></pre>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/daa65c711e664540b2919d7681de4b3e~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210603002847549" loading="lazy" referrerpolicy="no-referrer"></p>
<p>然而真实场景中，我们摆放位置会更加随机，因此我给每个粑粑的位置增加了一个随机值，并且中心粑粑会更加偏向于左上角，也更加了一定的随机值。</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">randomPosition</span>(<span class="hljs-params">num</span>) </span>&#123;
...
<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(num).fill(<span class="hljs-number">0</span>).map(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =></span> &#123;
  <span class="hljs-keyword">const</span> r = (index * step + radian)
  <span class="hljs-keyword">const</span> tr = r > <span class="hljs-built_in">Math</span>.PI * <span class="hljs-number">2</span> ? r - <span class="hljs-built_in">Math</span>.PI * <span class="hljs-number">2</span> : r < <span class="hljs-number">0</span> ? r + <span class="hljs-built_in">Math</span>.PI * <span class="hljs-number">2</span> : r;
  <span class="hljs-keyword">return</span> &#123;
    <span class="hljs-comment">// 增加随机值</span>
    <span class="hljs-attr">x</span>: length * <span class="hljs-built_in">Math</span>.sin(tr) + (<span class="hljs-built_in">Math</span>.random() > <span class="hljs-number">0.5</span> ? <span class="hljs-number">1</span> : -<span class="hljs-number">1</span>) * <span class="hljs-number">10</span> * <span class="hljs-built_in">Math</span>.random(),
    <span class="hljs-attr">y</span>: length * <span class="hljs-built_in">Math</span>.cos(tr) + (<span class="hljs-built_in">Math</span>.random() > <span class="hljs-number">0.5</span> ? <span class="hljs-number">1</span> : -<span class="hljs-number">1</span>) * <span class="hljs-number">10</span> * <span class="hljs-built_in">Math</span>.random(),
  &#125;
&#125;)
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/41854ebab56f4771be6b4269d2813bf6~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210603003823351" loading="lazy" referrerpolicy="no-referrer"></p>
<h4 data-id="heading-7">3.3角度</h4>
<p>最后们只需要点缀一下每个粑粑的角度就可以啦。</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createfeces</span>(<span class="hljs-params">scale</span>) </span>&#123;
  <span class="hljs-keyword">const</span> fece = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'div'</span>);
  fece.className = <span class="hljs-string">'feces'</span>;
  <span class="hljs-keyword">const</span> symbol = <span class="hljs-built_in">Math</span>.random() > <span class="hljs-number">0.5</span> ? <span class="hljs-number">1</span> : -<span class="hljs-number">1</span>; <span class="hljs-comment">// 生成 -20 ~ 20 之间的随机角度</span>
  fece.style.transform = <span class="hljs-string">`scale(<span class="hljs-subst">$&#123;scale&#125;</span>) rotate(<span class="hljs-subst">$&#123;symbol * <span class="hljs-number">20</span> * <span class="hljs-built_in">Math</span>.random()&#125;</span>deg)`</span>
  fece.style.opacity = <span class="hljs-string">'0'</span>;
  <span class="hljs-keyword">return</span> fece;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d87e1716b63a4ac2a51e1e4d0366bb67~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210603004011365" loading="lazy" referrerpolicy="no-referrer"></p>
<h4 data-id="heading-8">3.4动画</h4>
<p>由于这里和丢炸弹类似，我就不详细展开讲了。需要提一下的是，由于粑粑是先从炸弹位置出来，再缓缓下来，这里我们需要利用两次 Tween 补间动画。</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-comment">// 一开始的出现时候的动画，从爆炸口冲出来</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initFece</span>(<span class="hljs-params">end</span>) </span>&#123;
...
  <span class="hljs-keyword">const</span> start = &#123; <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">100</span>, <span class="hljs-attr">z</span>: <span class="hljs-number">0</span> &#125;; <span class="hljs-comment">// 爆炸口</span>
  <span class="hljs-keyword">const</span> tween = <span class="hljs-keyword">new</span> TWEEN.Tween(start)
  .to(&#123; ...end, <span class="hljs-attr">z</span>: <span class="hljs-number">1</span> &#125;, <span class="hljs-number">100</span>)
  .easing(TWEEN.Easing.Linear.None)
  .onUpdate(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;
    fece.style.setProperty(<span class="hljs-string">'top'</span>, <span class="hljs-string">`<span class="hljs-subst">$&#123;start.y&#125;</span>px`</span>);
    fece.style.setProperty(<span class="hljs-string">'left'</span>, <span class="hljs-string">`<span class="hljs-subst">$&#123;start.x&#125;</span>px`</span>);
    fece.style.setProperty(<span class="hljs-string">'opacity'</span>, <span class="hljs-string">`<span class="hljs-subst">$&#123;start.z&#125;</span>`</span>);
  &#125;)
  .onComplete(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;
    initDown(start, fece).start(); <span class="hljs-comment">// 冲出完成，进行下落透明动画</span>
  &#125;)
  <span class="hljs-keyword">return</span> tween;
&#125;
<span class="hljs-comment">// 下落同时变透明动画</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initDown</span>(<span class="hljs-params">start, fece</span>) </span>&#123;
  <span class="hljs-keyword">const</span> s = &#123;
    <span class="hljs-attr">y</span>: start.y,
    <span class="hljs-attr">o</span>: <span class="hljs-number">1</span>,
  &#125;;
  <span class="hljs-keyword">const</span> e = &#123; <span class="hljs-attr">y</span>: start.y + <span class="hljs-number">80</span>, <span class="hljs-attr">o</span>: <span class="hljs-number">0</span> &#125;;
  <span class="hljs-keyword">const</span> tween = <span class="hljs-keyword">new</span> TWEEN.Tween(s)
  .to(e, <span class="hljs-number">2000</span> + <span class="hljs-number">500</span> * <span class="hljs-built_in">Math</span>.random())
  .easing(TWEEN.Easing.Quadratic.In)
  .onUpdate(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;
    fece.style.setProperty(<span class="hljs-string">'top'</span>, <span class="hljs-string">`<span class="hljs-subst">$&#123;s.y&#125;</span>px`</span>);
    fece.style.setProperty(<span class="hljs-string">'opacity'</span>, <span class="hljs-string">`<span class="hljs-subst">$&#123;s.o&#125;</span>`</span>);
  &#125;)
  .onComplete(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;
  &#125;)
  <span class="hljs-keyword">return</span> tween;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>最后效果</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/12d5074c5f1b4d25862ccbc7752daed2~tplv-k3u1fbpfcp-zoom-1.image" alt="2021-06-03-01.18.57" loading="lazy" referrerpolicy="no-referrer"></p>
<p>本节完整代码：<a href="https://github.com/hua1995116/node-demo/blob/master/wechat-feces/3-2-feces.html" target="_blank" rel="nofollow noopener noreferrer">github.com/hua1995116/…</a></p>
<h4 data-id="heading-9">3.5总结</h4>
<p>由于这一节比较长，总结一下知识</p>
<ul>
<li>先利用 <code>1 = x² + y²</code> 圆轨迹的特性，建立初步位置</li>
<li>再通过加入随机值，使得整个分布稍微不那么规则一些</li>
<li>给粑粑添加随机角度</li>
<li>让中心粑粑更趋向于爆炸口</li>
<li>添加链式动画出现和下落</li>
</ul>
<h3 data-id="heading-10">4.所有人震动</h3>
<p>这个功能只需要用简单 css 动画就能完成这里就不再详细讲啦，有兴趣的小伙伴可以实现一下放到评论里~</p>
<h2 data-id="heading-11">结尾</h2>
<p>本次纯属于一个对这个效果好奇的探索，不是100%还原动画。本人也不是专门写动画的，上述库也是第一次使用，写的可能不那么专业（有任何问题欢迎评论区指出错误）。但是希望能给大家提供一个好玩的思路，在做动画的时候可以利用 <code>lottie</code> 和 <code>tween</code> 两个库，以及将复杂问题简单化，把不规律的东西变成规律的东西，把复杂的东西变成简单的，最后再一步步地去深化。同时感谢<a href="https://juejin.cn/user/4230576475472573" target="_blank">楠溪</a>对本文的校对。</p>
<p><strong>回看笔者往期高赞文章，也许能收获更多喔！</strong></p>
<ul>
<li>
<p><a href="https://juejin.cn/post/6930419481835470861" target="_blank">2021前端学习路径书单—自我成长之路</a>：<code>570+</code>点赞量</p>
</li>
<li>
<p><a href="https://juejin.cn/post/6926010284578603021" target="_blank">教你实现微信8.0『炸裂』的🎉表情特效</a>：<code>400+</code>点赞量</p>
</li>
<li>
<p><a href="https://juejin.cn/post/6900713052270755847" target="_blank">从破解某设计网站谈前端水印(详细教程)</a>：<code>790+</code>点赞量</p>
</li>
<li>
<p><a href="https://juejin.cn/post/6891053442530279432" target="_blank">从王者荣耀里我学会的前端新手指引</a>：<code>260+</code>点赞量</p>
</li>
<li>
<p><a href="https://juejin.cn/post/6867469476196155400" target="_blank">一文带你层层解锁「文件下载」的奥秘</a>：<code>140+</code>点赞量</p>
</li>
<li>
<p><a href="https://juejin.cn/post/6844904126246027278" target="_blank">10种跨域解决方案（附终极大招）</a>：<code>940+</code>点赞量</p>
</li>
</ul>
<h3 data-id="heading-12">结语</h3>
<p><strong>❤️关注+点赞+收藏+评论+转发❤️</strong>，原创不易，鼓励笔者创作更好的文章</p>
<p><strong>关注公众号<code>秋风的笔记</code>，一个专注于前端面试、工程化、开源的前端公众号</strong></p></div>  
</div>
            