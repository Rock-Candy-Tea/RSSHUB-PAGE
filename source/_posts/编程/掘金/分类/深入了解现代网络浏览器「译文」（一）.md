
---
title: '深入了解现代网络浏览器「译文」（一）'
categories: 
 - 编程
 - 掘金
 - 分类
headimg: 'https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e58787c15553425d8875ae0e1b206e2b~tplv-k3u1fbpfcp-watermark.image'
author: 掘金
comments: false
date: Thu, 15 Jul 2021 22:26:16 GMT
thumbnail: 'https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e58787c15553425d8875ae0e1b206e2b~tplv-k3u1fbpfcp-watermark.image'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><h4 data-id="heading-0">原文链接 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fdevelopers.google.com%2Fweb%2Fupdates%2F2018%2F09%2Finside-browser-part1" target="_blank" rel="nofollow noopener noreferrer" title="https://developers.google.com/web/updates/2018/09/inside-browser-part1" ref="nofollow noopener noreferrer">developers.google.com/web/updates…</a></h4>
<h1 data-id="heading-1">CPU、GPU、内存和多进程架构</h1>
<p>    本系列一共4篇文章，我们将从高级架构到渲染管道的细节深入了解 Chrome 浏览器。 如果您想知道浏览器如何将您的代码转换为功能性网站，或者您不确定为什么建议使用特定技术来提高性能，那么本系列适合您。作为本系列的第 1 部分，我们将了解核心计算术语和 Chrome 的多进程架构。</p>
<blockquote>
<p>注意：如果你熟悉 CPU/GPU 和进程/线程的概念，你可以跳到浏览器架构。</p>
</blockquote>
<h2 data-id="heading-2">一、计算机的核心 CPU 和 GPU</h2>
<p>为了了解浏览器运行的环境，我们需要了解一些计算机部件以及它们的作用。</p>
<h3 data-id="heading-3">CPU</h3>
<p>CPU 是<code>Central Processing Unit</code>的首字母缩写，即中央处理器。CPU可以被认为是你的电脑的大脑，下图为一个办公室工作者，可以一一处理许多不同的任务，它可以处理从数学到艺术的所有事情，同时知道如何回复客户电话。过去大多数 CPU 都是单芯片，一个内核就像是同一个芯片中的另一个 CPU；在现代硬件中，会有多个内核，为您的手机和笔记本电脑提供更多的计算能力。</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e58787c15553425d8875ae0e1b206e2b~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer">
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="green"><mrow><mtext>图</mtext><mn>1</mn><mtext>：</mtext><mn>4</mn><mtext>个</mtext><mi>C</mi><mi>P</mi><mi>U</mi><mtext>内核作为办公室工作人员坐在每个办公桌前处理他们进来的任务</mtext></mrow></mstyle></mrow><annotation encoding="application/x-tex">\color&#123;green&#125; &#123;图1：4个CPU 内核作为办公室工作人员坐在每个办公桌前处理他们进来的任务&#125; </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord" style="color:green;"><span class="mord cjk_fallback" style="color:green;">图</span><span class="mord" style="color:green;">1</span><span class="mord cjk_fallback" style="color:green;">：</span><span class="mord" style="color:green;">4</span><span class="mord cjk_fallback" style="color:green;">个</span><span class="mord mathnormal" style="margin-right:0.07153em;color:green;">C</span><span class="mord mathnormal" style="margin-right:0.13889em;color:green;">P</span><span class="mord mathnormal" style="margin-right:0.10903em;color:green;">U</span><span class="mord cjk_fallback" style="color:green;">内</span><span class="mord cjk_fallback" style="color:green;">核</span><span class="mord cjk_fallback" style="color:green;">作</span><span class="mord cjk_fallback" style="color:green;">为</span><span class="mord cjk_fallback" style="color:green;">办</span><span class="mord cjk_fallback" style="color:green;">公</span><span class="mord cjk_fallback" style="color:green;">室</span><span class="mord cjk_fallback" style="color:green;">工</span><span class="mord cjk_fallback" style="color:green;">作</span><span class="mord cjk_fallback" style="color:green;">人</span><span class="mord cjk_fallback" style="color:green;">员</span><span class="mord cjk_fallback" style="color:green;">坐</span><span class="mord cjk_fallback" style="color:green;">在</span><span class="mord cjk_fallback" style="color:green;">每</span><span class="mord cjk_fallback" style="color:green;">个</span><span class="mord cjk_fallback" style="color:green;">办</span><span class="mord cjk_fallback" style="color:green;">公</span><span class="mord cjk_fallback" style="color:green;">桌</span><span class="mord cjk_fallback" style="color:green;">前</span><span class="mord cjk_fallback" style="color:green;">处</span><span class="mord cjk_fallback" style="color:green;">理</span><span class="mord cjk_fallback" style="color:green;">他</span><span class="mord cjk_fallback" style="color:green;">们</span><span class="mord cjk_fallback" style="color:green;">进</span><span class="mord cjk_fallback" style="color:green;">来</span><span class="mord cjk_fallback" style="color:green;">的</span><span class="mord cjk_fallback" style="color:green;">任</span><span class="mord cjk_fallback" style="color:green;">务</span></span></span></span></span></span></p>
<h3 data-id="heading-4">GPU</h3>
<p>GPU 是<code>Graphics Processing Unit</code>的首字母缩写，即图形处理单元。GPU计算机的另一部分，GPU 擅长处理简单的任务，并且同时跨多个内核。顾名思义，它最初是为处理图形而开发的，因为它的渲染快速和交互流畅。最近几年，通过 GPU 加速计算，越来越多的计算可以单独使用 GPU。</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7ed1e13664ba48758a433d42f808c062~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer">
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="green"><mrow><mtext>图</mtext><mn>2</mn><mtext>：许多带有扳手的</mtext><mi>G</mi><mi>P</mi><mi>U</mi><mtext>内核在处理一个有限的任务</mtext></mrow></mstyle></mrow><annotation encoding="application/x-tex">\color&#123;green&#125; &#123;图2：许多带有扳手的 GPU 内核在处理一个有限的任务&#125; </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord" style="color:green;"><span class="mord cjk_fallback" style="color:green;">图</span><span class="mord" style="color:green;">2</span><span class="mord cjk_fallback" style="color:green;">：</span><span class="mord cjk_fallback" style="color:green;">许</span><span class="mord cjk_fallback" style="color:green;">多</span><span class="mord cjk_fallback" style="color:green;">带</span><span class="mord cjk_fallback" style="color:green;">有</span><span class="mord cjk_fallback" style="color:green;">扳</span><span class="mord cjk_fallback" style="color:green;">手</span><span class="mord cjk_fallback" style="color:green;">的</span><span class="mord mathnormal" style="color:green;">G</span><span class="mord mathnormal" style="margin-right:0.13889em;color:green;">P</span><span class="mord mathnormal" style="margin-right:0.10903em;color:green;">U</span><span class="mord cjk_fallback" style="color:green;">内</span><span class="mord cjk_fallback" style="color:green;">核</span><span class="mord cjk_fallback" style="color:green;">在</span><span class="mord cjk_fallback" style="color:green;">处</span><span class="mord cjk_fallback" style="color:green;">理</span><span class="mord cjk_fallback" style="color:green;">一</span><span class="mord cjk_fallback" style="color:green;">个</span><span class="mord cjk_fallback" style="color:green;">有</span><span class="mord cjk_fallback" style="color:green;">限</span><span class="mord cjk_fallback" style="color:green;">的</span><span class="mord cjk_fallback" style="color:green;">任</span><span class="mord cjk_fallback" style="color:green;">务</span></span></span></span></span></span></p>
<p>当您在计算机或手机上启动应用程序，应用程序会使用操作系统提供的机制在 CPU 和 GPU 上运行。</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c6f608b0978a4881aaccd63c80e9b6e4~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer">
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="green"><mrow><mtext>图</mtext><mn>3</mn><mtext>：三层计算机体系结构。底部是机器硬件，中间是操作系统，顶部是应用程序。</mtext></mrow></mstyle></mrow><annotation encoding="application/x-tex">\color&#123;green&#125; &#123;图3：三层计算机体系结构。 底部是机器硬件，中间是操作系统，顶部是应用程序。&#125; </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord" style="color:green;"><span class="mord cjk_fallback" style="color:green;">图</span><span class="mord" style="color:green;">3</span><span class="mord cjk_fallback" style="color:green;">：</span><span class="mord cjk_fallback" style="color:green;">三</span><span class="mord cjk_fallback" style="color:green;">层</span><span class="mord cjk_fallback" style="color:green;">计</span><span class="mord cjk_fallback" style="color:green;">算</span><span class="mord cjk_fallback" style="color:green;">机</span><span class="mord cjk_fallback" style="color:green;">体</span><span class="mord cjk_fallback" style="color:green;">系</span><span class="mord cjk_fallback" style="color:green;">结</span><span class="mord cjk_fallback" style="color:green;">构</span><span class="mord cjk_fallback" style="color:green;">。</span><span class="mord cjk_fallback" style="color:green;">底</span><span class="mord cjk_fallback" style="color:green;">部</span><span class="mord cjk_fallback" style="color:green;">是</span><span class="mord cjk_fallback" style="color:green;">机</span><span class="mord cjk_fallback" style="color:green;">器</span><span class="mord cjk_fallback" style="color:green;">硬</span><span class="mord cjk_fallback" style="color:green;">件</span><span class="mord cjk_fallback" style="color:green;">，</span><span class="mord cjk_fallback" style="color:green;">中</span><span class="mord cjk_fallback" style="color:green;">间</span><span class="mord cjk_fallback" style="color:green;">是</span><span class="mord cjk_fallback" style="color:green;">操</span><span class="mord cjk_fallback" style="color:green;">作</span><span class="mord cjk_fallback" style="color:green;">系</span><span class="mord cjk_fallback" style="color:green;">统</span><span class="mord cjk_fallback" style="color:green;">，</span><span class="mord cjk_fallback" style="color:green;">顶</span><span class="mord cjk_fallback" style="color:green;">部</span><span class="mord cjk_fallback" style="color:green;">是</span><span class="mord cjk_fallback" style="color:green;">应</span><span class="mord cjk_fallback" style="color:green;">用</span><span class="mord cjk_fallback" style="color:green;">程</span><span class="mord cjk_fallback" style="color:green;">序</span><span class="mord cjk_fallback" style="color:green;">。</span></span></span></span></span></span></p>
<h2 data-id="heading-5">二、在进程和线程上执行程序</h2>
<p>在深入研究浏览器架构之前要掌握的另一个概念是进程和线程，进程可以被描述为应用程序的执行程序，线程是存在于进程内部，并执行其进程程序的任何部分。</p>
<p>当您启动应用程序时，就会创建一个进程。 程序可能会创建线程来帮助它工作。操作系统为进程提供了一块“内存块”以供使用，并且所有应用程序状态都保存在该私有内存空间中。当您关闭应用程序时，该进程也会消失，操作系统会释放内存。</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c06fa767e22a465d97d68cd6ec84027c~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer">
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="green"><mrow><mtext>图</mtext><mn>4</mn><mtext>：进程作为边界框，线程作为在进程内游动的抽象鱼</mtext></mrow></mstyle></mrow><annotation encoding="application/x-tex">\color&#123;green&#125; &#123;图4：进程作为边界框，线程作为在进程内游动的抽象鱼&#125; </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord" style="color:green;"><span class="mord cjk_fallback" style="color:green;">图</span><span class="mord" style="color:green;">4</span><span class="mord cjk_fallback" style="color:green;">：</span><span class="mord cjk_fallback" style="color:green;">进</span><span class="mord cjk_fallback" style="color:green;">程</span><span class="mord cjk_fallback" style="color:green;">作</span><span class="mord cjk_fallback" style="color:green;">为</span><span class="mord cjk_fallback" style="color:green;">边</span><span class="mord cjk_fallback" style="color:green;">界</span><span class="mord cjk_fallback" style="color:green;">框</span><span class="mord cjk_fallback" style="color:green;">，</span><span class="mord cjk_fallback" style="color:green;">线</span><span class="mord cjk_fallback" style="color:green;">程</span><span class="mord cjk_fallback" style="color:green;">作</span><span class="mord cjk_fallback" style="color:green;">为</span><span class="mord cjk_fallback" style="color:green;">在</span><span class="mord cjk_fallback" style="color:green;">进</span><span class="mord cjk_fallback" style="color:green;">程</span><span class="mord cjk_fallback" style="color:green;">内</span><span class="mord cjk_fallback" style="color:green;">游</span><span class="mord cjk_fallback" style="color:green;">动</span><span class="mord cjk_fallback" style="color:green;">的</span><span class="mord cjk_fallback" style="color:green;">抽</span><span class="mord cjk_fallback" style="color:green;">象</span><span class="mord cjk_fallback" style="color:green;">鱼</span></span></span></span></span></span></p>
<p>一个进程可以要求操作系统启动另一个进程来运行不同的任务。 发生这种情况时，会为新进程分配内存的不同部分。 如果两个进程需要通信，它们可以使用进程间通信 (IPC) 来实现。 许多应用程序都设计为以这种方式工作，因此如果工作进程没有响应，它可以重新启动，而无需停止运行应用程序不同部分的其他进程。</p>
<h3 data-id="heading-6">浏览器架构</h3>
<p>那么如何使用进程和线程构建 Web 浏览器呢？ 嗯，它可能是一个进程有许多不同的线程，也可能是许多不同的进程有几个线程通过 IPC 进行通信。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cdd13602057748b38f6c2927c8edf92d~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer">
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="green"><mrow><mtext>图</mtext><mn>5</mn><mtext>：进程</mtext><mi mathvariant="normal">/</mi><mtext>线程图中的不同浏览器架构</mtext></mrow></mstyle></mrow><annotation encoding="application/x-tex">\color&#123;green&#125; &#123;图5：进程/线程图中的不同浏览器架构&#125; </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord" style="color:green;"><span class="mord cjk_fallback" style="color:green;">图</span><span class="mord" style="color:green;">5</span><span class="mord cjk_fallback" style="color:green;">：</span><span class="mord cjk_fallback" style="color:green;">进</span><span class="mord cjk_fallback" style="color:green;">程</span><span class="mord" style="color:green;">/</span><span class="mord cjk_fallback" style="color:green;">线</span><span class="mord cjk_fallback" style="color:green;">程</span><span class="mord cjk_fallback" style="color:green;">图</span><span class="mord cjk_fallback" style="color:green;">中</span><span class="mord cjk_fallback" style="color:green;">的</span><span class="mord cjk_fallback" style="color:green;">不</span><span class="mord cjk_fallback" style="color:green;">同</span><span class="mord cjk_fallback" style="color:green;">浏</span><span class="mord cjk_fallback" style="color:green;">览</span><span class="mord cjk_fallback" style="color:green;">器</span><span class="mord cjk_fallback" style="color:green;">架</span><span class="mord cjk_fallback" style="color:green;">构</span></span></span></span></span></span></p>
<p>这里需要注意的重要一点是，这些不同的架构是实现细节。 没有关于如何构建 Web 浏览器的标准规范。 一种浏览器的方法可能与另一种完全不同。</p>
<p>在本系列4篇文章中，我们将使用下图中描述的 Chrome 最新架构。顶部是浏览器进程与其他处理应用程序不同部分的进程协调。 对于渲染器进程，会创建多个进程并将其分配给每个选项卡。直到最近，Chrome 还在可能的情况下为每个选项卡提供了一个进程； 现在它尝试为每个站点提供自己的进程，包括 iframe（请参阅站点隔离）。</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/af7425b3fe9f4dc4bf57f4aeaf948d8b~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer">
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="green"><mrow><mtext>图</mtext><mn>6</mn><mtext>：多个层显示在渲染器进程下，代表</mtext><mi>C</mi><mi>h</mi><mi>r</mi><mi>o</mi><mi>m</mi><mi>e</mi><mtext>为每个选项卡运行多个渲染器进程。</mtext></mrow></mstyle></mrow><annotation encoding="application/x-tex">\color&#123;green&#125; &#123;图6：多个层显示在渲染器进程下，代表 Chrome 为每个选项卡运行多个渲染器进程。&#125; </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord" style="color:green;"><span class="mord cjk_fallback" style="color:green;">图</span><span class="mord" style="color:green;">6</span><span class="mord cjk_fallback" style="color:green;">：</span><span class="mord cjk_fallback" style="color:green;">多</span><span class="mord cjk_fallback" style="color:green;">个</span><span class="mord cjk_fallback" style="color:green;">层</span><span class="mord cjk_fallback" style="color:green;">显</span><span class="mord cjk_fallback" style="color:green;">示</span><span class="mord cjk_fallback" style="color:green;">在</span><span class="mord cjk_fallback" style="color:green;">渲</span><span class="mord cjk_fallback" style="color:green;">染</span><span class="mord cjk_fallback" style="color:green;">器</span><span class="mord cjk_fallback" style="color:green;">进</span><span class="mord cjk_fallback" style="color:green;">程</span><span class="mord cjk_fallback" style="color:green;">下</span><span class="mord cjk_fallback" style="color:green;">，</span><span class="mord cjk_fallback" style="color:green;">代</span><span class="mord cjk_fallback" style="color:green;">表</span><span class="mord mathnormal" style="margin-right:0.07153em;color:green;">C</span><span class="mord mathnormal" style="color:green;">h</span><span class="mord mathnormal" style="margin-right:0.02778em;color:green;">r</span><span class="mord mathnormal" style="color:green;">o</span><span class="mord mathnormal" style="color:green;">m</span><span class="mord mathnormal" style="color:green;">e</span><span class="mord cjk_fallback" style="color:green;">为</span><span class="mord cjk_fallback" style="color:green;">每</span><span class="mord cjk_fallback" style="color:green;">个</span><span class="mord cjk_fallback" style="color:green;">选</span><span class="mord cjk_fallback" style="color:green;">项</span><span class="mord cjk_fallback" style="color:green;">卡</span><span class="mord cjk_fallback" style="color:green;">运</span><span class="mord cjk_fallback" style="color:green;">行</span><span class="mord cjk_fallback" style="color:green;">多</span><span class="mord cjk_fallback" style="color:green;">个</span><span class="mord cjk_fallback" style="color:green;">渲</span><span class="mord cjk_fallback" style="color:green;">染</span><span class="mord cjk_fallback" style="color:green;">器</span><span class="mord cjk_fallback" style="color:green;">进</span><span class="mord cjk_fallback" style="color:green;">程</span><span class="mord cjk_fallback" style="color:green;">。</span></span></span></span></span></span></p>
<h3 data-id="heading-7">哪个进程控制什么？</h3>
<p>下面的表格描述了每个 Chrome 进程及其控制的内容：</p>

























<table><thead><tr><th>进程及其控制的内容</th><th></th></tr></thead><tbody><tr><td>浏览器</td><td>控制应用程序的“chrome”部分，包括地址栏、书签、后退和前进按钮。还处理 Web 浏览器的不可见的特权部分，例如网络请求和文件访问。</td></tr><tr><td>渲染器</td><td>控制显示网站的选项卡内的任何内容。</td></tr><tr><td>插件</td><td>控制网站使用的任何插件，例如 flash。</td></tr><tr><td>GPU</td><td>独立于其他进程处理 GPU 任务。 它被分成不同的进程，因为 GPU 处理来自多个应用程序的请求并将它们绘制在同一个表面上。</td></tr></tbody></table>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b5442f47a08f46098032020023a32a9e~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer">
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="green"><mrow><mtext>图</mtext><mn>7</mn><mtext>：不同的进程指向浏览器</mtext><mi>U</mi><mi>I</mi><mtext>的不同部分。</mtext></mrow></mstyle></mrow><annotation encoding="application/x-tex">\color&#123;green&#125; &#123;图7：不同的进程指向浏览器 UI 的不同部分。&#125; </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord" style="color:green;"><span class="mord cjk_fallback" style="color:green;">图</span><span class="mord" style="color:green;">7</span><span class="mord cjk_fallback" style="color:green;">：</span><span class="mord cjk_fallback" style="color:green;">不</span><span class="mord cjk_fallback" style="color:green;">同</span><span class="mord cjk_fallback" style="color:green;">的</span><span class="mord cjk_fallback" style="color:green;">进</span><span class="mord cjk_fallback" style="color:green;">程</span><span class="mord cjk_fallback" style="color:green;">指</span><span class="mord cjk_fallback" style="color:green;">向</span><span class="mord cjk_fallback" style="color:green;">浏</span><span class="mord cjk_fallback" style="color:green;">览</span><span class="mord cjk_fallback" style="color:green;">器</span><span class="mord mathnormal" style="margin-right:0.10903em;color:green;">U</span><span class="mord mathnormal" style="margin-right:0.07847em;color:green;">I</span><span class="mord cjk_fallback" style="color:green;">的</span><span class="mord cjk_fallback" style="color:green;">不</span><span class="mord cjk_fallback" style="color:green;">同</span><span class="mord cjk_fallback" style="color:green;">部</span><span class="mord cjk_fallback" style="color:green;">分</span><span class="mord cjk_fallback" style="color:green;">。</span></span></span></span></span></span></p>
<p>还有更多的进程，如扩展进程和实用程序进程。 如果您想查看 Chrome 中正在运行的进程数，请单击右上角的选项菜单图标（三个点），选择更多工具，然后选择任务管理器。 将会打开一个窗口，其中包含当前正在运行的进程列表以及它们使用的 CPU/内存量。</p>
<h3 data-id="heading-8">Chrome 中多进程架构的好处</h3>
<p>之前，我提到 Chrome 使用多个渲染器进程。 在最简单的情况下，您可以想象每个选项卡都有自己的渲染器进程。 假设您打开了 3 个选项卡，每个选项卡都由一个独立的渲染器进程运行。 如果一个选项卡变得无响应，那么您可以关闭无响应的选项卡并继续保持其他选项卡的活动。如果所有选项卡都在一个进程上运行，当一个选项卡变得无响应时，所有选项卡都无响应。 这很糟糕。</p>
<p>将浏览器的工作分成多个进程的另一个好处是安全性和沙盒。 由于操作系统提供了一种限制进程权限的方法，因此浏览器可以从某些功能中对某些进程进行沙箱处理。例如，Chrome 浏览器为了处理任意用户输入的进程（如渲染器进程），限制任意文件访问。</p>
<p>因为进程有自己的私有内存空间，所以它们通常包含公共基础设施的副本（比如 V8，它是 Chrome 的 JavaScript 引擎）。 这意味着更多的内存使用量，虽然它们是同一进程内的线程，却无法共享它们。为了节省内存，Chrome 限制了它可以启动的进程数。 该限制取决于您设备的内存和 CPU 能力，但当 Chrome 达到限制时，它会开始在一个进程中运行来自同一站点的多个选项卡。</p>
<h3 data-id="heading-9">节省更多内存 - Chrome 中的服务化</h3>
<p>同样的方法应用于浏览器进程。 Chrome 正在经历架构变化，以将浏览器程序的每个部分作为一项服务运行，从而可以轻松地拆分为不同的进程或聚合为一个进程。</p>
<p>一般的想法是，当 Chrome 在强大的硬件上运行时，它可能会将每个服务拆分为不同的进程以提供更高的稳定性，但如果它在资源受限的设备上，Chrome 会将服务合并到一个进程中以节省内存占用。 在此更改之前，已在 Android 等平台上使用了类似的方法来合并进程以减少内存使用量。</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="green"><mrow><mtext>图</mtext><mn>8</mn><mtext>：</mtext><mi>C</mi><mi>h</mi><mi>r</mi><mi>o</mi><mi>m</mi><mi>e</mi><mtext>服务化将不同服务移入多个进程和单个浏览器进程的示意图。</mtext></mrow></mstyle></mrow><annotation encoding="application/x-tex">\color&#123;green&#125; &#123;图8：Chrome 服务化将不同服务移入多个进程和单个浏览器进程的示意图。&#125; </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord" style="color:green;"><span class="mord cjk_fallback" style="color:green;">图</span><span class="mord" style="color:green;">8</span><span class="mord cjk_fallback" style="color:green;">：</span><span class="mord mathnormal" style="margin-right:0.07153em;color:green;">C</span><span class="mord mathnormal" style="color:green;">h</span><span class="mord mathnormal" style="margin-right:0.02778em;color:green;">r</span><span class="mord mathnormal" style="color:green;">o</span><span class="mord mathnormal" style="color:green;">m</span><span class="mord mathnormal" style="color:green;">e</span><span class="mord cjk_fallback" style="color:green;">服</span><span class="mord cjk_fallback" style="color:green;">务</span><span class="mord cjk_fallback" style="color:green;">化</span><span class="mord cjk_fallback" style="color:green;">将</span><span class="mord cjk_fallback" style="color:green;">不</span><span class="mord cjk_fallback" style="color:green;">同</span><span class="mord cjk_fallback" style="color:green;">服</span><span class="mord cjk_fallback" style="color:green;">务</span><span class="mord cjk_fallback" style="color:green;">移</span><span class="mord cjk_fallback" style="color:green;">入</span><span class="mord cjk_fallback" style="color:green;">多</span><span class="mord cjk_fallback" style="color:green;">个</span><span class="mord cjk_fallback" style="color:green;">进</span><span class="mord cjk_fallback" style="color:green;">程</span><span class="mord cjk_fallback" style="color:green;">和</span><span class="mord cjk_fallback" style="color:green;">单</span><span class="mord cjk_fallback" style="color:green;">个</span><span class="mord cjk_fallback" style="color:green;">浏</span><span class="mord cjk_fallback" style="color:green;">览</span><span class="mord cjk_fallback" style="color:green;">器</span><span class="mord cjk_fallback" style="color:green;">进</span><span class="mord cjk_fallback" style="color:green;">程</span><span class="mord cjk_fallback" style="color:green;">的</span><span class="mord cjk_fallback" style="color:green;">示</span><span class="mord cjk_fallback" style="color:green;">意</span><span class="mord cjk_fallback" style="color:green;">图</span><span class="mord cjk_fallback" style="color:green;">。</span></span></span></span></span></span>
<img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7289e7d0326448a086fce69d93454fe6~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<div align="center">
    <img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e11d254ef0ca4cf78800c94bb1a741dc~tplv-k3u1fbpfcp-watermark.image" width="100" loading="lazy" referrerpolicy="no-referrer">
</div>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/38baffd44e4e47178a108528b00147f1~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<h3 data-id="heading-10">每帧渲染器进程 - 站点隔离</h3>
<p>站点隔离是 Chrome 中最近引入的一项功能，它为每个跨站点 iframe 运行单独的渲染器进程。 我们一直在讨论每个选项卡模型一个渲染器进程，它允许跨站点 iframe 在单个渲染器进程中运行，并在不同站点之间共享内存空间。 在同一个渲染器进程中运行 a.com 和 b.com 似乎没问题。 同源策略是网络安全的核心；它确保一个站点在未经同意的情况下无法访问其他站点的数据。 绕过此策略是安全攻击的主要目标。 进程隔离是分离站点的最有效方法。 对于 Meltdown 和 Spectre，我们需要使用流程来分离站点变得更加明显。自 Chrome 67 以来，桌面上默认启用站点隔离，选项卡中的每个跨站点 iframe 都有一个单独的渲染器进程。</p>
<blockquote>
<p>Meltdown / Spectre：现代 CPU 中的漏洞，进程可以使用这些漏洞读取任意内存——包括不属于该进程的内存。 这些漏洞被命名为 Spectre 和 Meltdown。链接：<a href="https://link.juejin.cn/?target=https%3A%2F%2Fdevelopers.google.com%2Fweb%2Fupdates%2F2018%2F02%2Fmeltdown-spectre" target="_blank" rel="nofollow noopener noreferrer" title="https://developers.google.com/web/updates/2018/02/meltdown-spectre" ref="nofollow noopener noreferrer">developers.google.com/web/updates…</a></p>
</blockquote>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d28d823a618f4f9cb0a47ae59078b09e~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer">
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="green"><mrow><mtext>图</mtext><mn>9</mn><mtext>：站点隔离示意图；多个渲染器进程指向站点内的</mtext><mi>i</mi><mi>f</mi><mi>r</mi><mi>a</mi><mi>m</mi><mi>e</mi></mrow></mstyle></mrow><annotation encoding="application/x-tex">\color&#123;green&#125; &#123;图9：站点隔离示意图； 多个渲染器进程指向站点内的 iframe&#125; </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord" style="color:green;"><span class="mord cjk_fallback" style="color:green;">图</span><span class="mord" style="color:green;">9</span><span class="mord cjk_fallback" style="color:green;">：</span><span class="mord cjk_fallback" style="color:green;">站</span><span class="mord cjk_fallback" style="color:green;">点</span><span class="mord cjk_fallback" style="color:green;">隔</span><span class="mord cjk_fallback" style="color:green;">离</span><span class="mord cjk_fallback" style="color:green;">示</span><span class="mord cjk_fallback" style="color:green;">意</span><span class="mord cjk_fallback" style="color:green;">图</span><span class="mord cjk_fallback" style="color:green;">；</span><span class="mord cjk_fallback" style="color:green;">多</span><span class="mord cjk_fallback" style="color:green;">个</span><span class="mord cjk_fallback" style="color:green;">渲</span><span class="mord cjk_fallback" style="color:green;">染</span><span class="mord cjk_fallback" style="color:green;">器</span><span class="mord cjk_fallback" style="color:green;">进</span><span class="mord cjk_fallback" style="color:green;">程</span><span class="mord cjk_fallback" style="color:green;">指</span><span class="mord cjk_fallback" style="color:green;">向</span><span class="mord cjk_fallback" style="color:green;">站</span><span class="mord cjk_fallback" style="color:green;">点</span><span class="mord cjk_fallback" style="color:green;">内</span><span class="mord cjk_fallback" style="color:green;">的</span><span class="mord mathnormal" style="color:green;">i</span><span class="mord mathnormal" style="margin-right:0.10764em;color:green;">f</span><span class="mord mathnormal" style="margin-right:0.02778em;color:green;">r</span><span class="mord mathnormal" style="color:green;">a</span><span class="mord mathnormal" style="color:green;">m</span><span class="mord mathnormal" style="color:green;">e</span></span></span></span></span></span></p>
<p>启用站点隔离是一项多年的工程努力。 站点隔离并不像分配不同的渲染器进程那么简单； 它从根本上改变了 iframe 相互通信的方式。在不同进程上运行 iframe 的页面上打开 devtools 意味着 devtools 必须实施幕后工作以使其看起来无缝。 即使运行简单的 Ctrl+F 来查找页面中的单词也意味着在不同的渲染器进程中进行搜索。 您可以知道为何浏览器工程师称 Site Isolation 的发布为重大里程碑！</p>
<h3 data-id="heading-11">总结</h3>
<p>在这篇文章中，我们涵盖了浏览器架构的高级视图，并涵盖了多进程架构的好处。 我们还介绍了与多进程架构密切相关的 Chrome 中的服务化和站点隔离。 在下一篇文章中，我们将开始深入探讨这些进程和线程之间为了显示网站而发生的事情。</p>
<blockquote>
<p>读者朋友如果有更好的理解可以提出，我来改进，避免误导其他读者~~</p>
</blockquote></div>  
</div>
            