
---
title: 'å‡æœŸè®©ä½ çš„åšå®¢é›†æˆå¾®ä¿¡å°ç¨‹åºæ‰«ç ç™»å½•'
categories: 
 - ç¼–ç¨‹
 - æ˜é‡‘
 - åˆ†ç±»
headimg: 'https://picsum.photos/400/300?random=4757'
author: æ˜é‡‘
comments: false
date: Fri, 30 Apr 2021 18:08:18 GMT
thumbnail: 'https://picsum.photos/400/300?random=4757'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;color:#383838;font-size:15px;line-height:37.5px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:120px&#125;.markdown-body ::selection&#123;color:#fff;background-color:#a862ea&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;margin:30px 0 15px;color:#a862ea&#125;.markdown-body h1&#123;line-height:2;font-size:1.4em&#125;.markdown-body h1~p:first-of-type:first-letter&#123;color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder&#125;.markdown-body h2&#123;font-size:1.2em&#125;.markdown-body h3&#123;font-size:1.1em&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:2em&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;padding-left:.2em&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:10px&#125;.markdown-body li::marker&#123;color:#a862ea&#125;.markdown-body li,.markdown-body p&#123;opacity:.9;vertical-align:baseline;transition:all .1s ease&#125;.markdown-body li:hover,.markdown-body p:hover&#123;opacity:1&#125;.markdown-body a&#123;display:inline-block;color:#a862ea;cursor:pointer;padding-bottom:2px;text-decoration:none;position:relative&#125;.markdown-body a:after&#123;content:"";position:absolute;width:98%;height:2px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out&#125;.markdown-body a:hover:after&#123;transform:scaleX(1);transform-origin:bottom left&#125;.markdown-body a:active,.markdown-body a:link&#123;color:#a862ea&#125;.markdown-body img&#123;max-width:100%;user-select:none;margin:1em 0;box-shadow:0 0 20px 0 #e7daff;transition:transform .2s ease 0s;background-color:#f8f5ff&#125;.markdown-body img:hover&#123;opacity:1;transform:translateY(-2px)&#125;.markdown-body blockquote&#123;padding:.5em 1em;margin:15px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:4px solid #a862ea;background-color:#f8f5ff&#125;.markdown-body blockquote>p&#123;margin:0&#125;.markdown-body code&#123;padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff&#125;.markdown-body pre&#123;margin:2em 0;box-shadow:0 0 20px #e7daff&#125;.markdown-body pre>code&#123;display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:22.5px;color:#383838;border-radius:3px;scroll-behavior:smooth&#125;.markdown-body pre>code::-webkit-scrollbar&#123;height:6px;background-color:#f8f5ff&#125;.markdown-body pre>code::-webkit-scrollbar-thumb&#123;background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px&#125;.markdown-body hr&#123;margin:2em 0;border-top:1px solid #a862ea&#125;.markdown-body table&#123;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse;border:1px solid #e7daff&#125;.markdown-body thead&#123;color:#a862ea;background:#f8f5ff&#125;.markdown-body td,.markdown-body th&#123;padding:1em .5em&#125;.markdown-body tr&#123;background-color:#fcfcfc&#125;@media (max-width:720px)&#123;.markdown-body&#123;font-size:12px&#125;&#125;</style><p>å¸¸è§çš„å¾®ä¿¡æ‰«ç ç™»å½•é€»è¾‘æœ‰ä¸¤ç§</p>
<p>1ã€<a href="https://developers.weixin.qq.com/doc/oplatform/Website_App/WeChat_Login/Wechat_Login.html" target="_blank" rel="nofollow noopener noreferrer">å¾®ä¿¡å¼€æ”¾å¹³å°</a></p>
<p>2ã€<a href="https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login" target="_blank" rel="nofollow noopener noreferrer">å¾®ä¿¡æœåŠ¡å·</a></p>
<p>è¿™ä¸¤ç§éƒ½éœ€è¦ä¼ä¸šèµ„æ–™è®¤è¯ï¼Œå¯¹ä¸ªäººå¼€å‘è€…æ˜¯æ²¡æœ‰æƒé™çš„ï¼Œæ— æ„é—´çœ‹åˆ°<a href="https://docs.qq.com/desktop/?fromsrc=homepage" target="_blank" rel="nofollow noopener noreferrer">è…¾è®¯æ–‡æ¡£</a>æ‰«ç ç™»å½•çš„æ—¶å€™æ‰“å¼€çš„æ˜¯å°ç¨‹åºï¼Œå¼€å§‹è¿˜ä»¥ä¸ºåªæœ‰è…¾è®¯æœ‰æƒé™ï¼ˆæ»‘ç¨½çš„ç¬‘äº†ğŸ˜„ ï¼‰ï¼Œç„¶åå°±ä¸€é¡¿æœç´¢ï¼Œå‘ç°è¿™ä¸ªé€»è¾‘å…¶å®å°±æ˜¯æˆ‘ä»¬æ—¥å¸¸å¼€å‘å°ç¨‹åºä¸­çš„<a href="https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/qr-code/wxacode.getUnlimited.html" target="_blank" rel="nofollow noopener noreferrer">å°ç¨‹åºç </a>åŠŸèƒ½ï¼Œå¤–åŠ ä¸€ä¸ªwebsocketåŠŸèƒ½å°±å¯ä»¥æå®š</p>
<p>æ–‡ç« é¦–å‘äºæˆ‘çš„<a href="https://youxiubiji.com/" target="_blank" rel="nofollow noopener noreferrer">åšå®¢</a>ï¼Œæ¬¢è¿å¤§å®¶å‰æ¥å›´è§‚ğŸš€ï¸ ğŸš€ï¸ ğŸš€ï¸</p>
<h2 data-id="heading-0">å®ç°åŸç†</h2>
<ul>
<li>åšå®¢ç‚¹å‡»å¾®ä¿¡ç™»å½•å¼¹çª—ï¼Œå»ºç«‹websocketè¿æ¥ï¼Œè¿æ¥å»ºç«‹æˆåŠŸä¹‹åï¼Œå‘é€æ¶ˆæ¯ä»æœåŠ¡ç«¯è·å–å¸¦æœ‰æ—¶é—´æˆ³çš„éšæœºidï¼Œæ¥å—åˆ°idä¹‹åæºå¸¦idè¯·æ±‚å°ç¨‹åºç ï¼ˆidç”¨äºç½‘é¡µç«¯å’Œå°ç¨‹åºçš„é€šä¿¡ç»‘å®šï¼‰ï¼Œ</li>
<li>ç”¨æˆ·é€šè¿‡å¾®ä¿¡æ‰«ç ç‚¹å‡»ç™»å½•ä¹‹åï¼ŒæŠŠç”¨æˆ·ä¿¡æ¯ã€codeã€å’Œidæäº¤åˆ°æœåŠ¡ç«¯ï¼Œ</li>
<li>æœåŠ¡ç«¯æ ¹æ®codeè·å–openidï¼Œç„¶åæ ¹æ®openidåˆ¤æ–­æ˜¯åˆ›å»ºè¿˜æ˜¯æ›´æ–°ç”¨æˆ·ä¿¡æ¯ï¼Œç„¶åç”Ÿæˆtokené€šè¿‡websocketå¹¿æ’­ç»™å”¯ä¸€idçš„å‰ç«¯ç½‘é¡µ</li>
<li>å‰ç«¯æ¥å—åˆ°tokenï¼Œå­˜å‚¨tokenï¼Œé¡µé¢é‡æ–°åŠ è½½è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œæ–­å¼€websocketè¿æ¥</li>
</ul>
<h2 data-id="heading-1">å‰ç«¯ä»£ç å®ç°</h2>
<blockquote>
<p>å‰ç«¯æˆ‘ä½¿ç”¨çš„vue</p>
</blockquote>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">//åˆå§‹åŒ–weosocket</span>
        <span class="hljs-function"><span class="hljs-title">initWebSocket</span>(<span class="hljs-params"></span>)</span> &#123;
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.websock) &#123;
                <span class="hljs-built_in">this</span>.websock.close();
            &#125;
            <span class="hljs-comment">// websocket æ¶ˆæ¯å¤„ç†</span>
            <span class="hljs-keyword">const</span> messageHandler = &#123;
                <span class="hljs-comment">// è·å¾— codeId æ¥ä¸‹æ¥æˆ‘ä»¬è¦ç”ŸæˆäºŒç»´ç </span>
                <span class="hljs-attr">CODE_ID</span>: <span class="hljs-keyword">async</span> (res) => &#123;
                    <span class="hljs-keyword">let</span> $res = <span class="hljs-keyword">await</span> wxcodeUrl(&#123; <span class="hljs-attr">scene</span>: res.data.uuid &#125;);
                    <span class="hljs-built_in">this</span>.wxCodeSrc = <span class="hljs-string">"http://localhost:3000/"</span> + $res.data.url;
                    <span class="hljs-built_in">this</span>.codeLoading = <span class="hljs-literal">false</span>;
                    <span class="hljs-built_in">this</span>.isFailure = <span class="hljs-literal">false</span>;
                    <span class="hljs-built_in">this</span>.desccontent = <span class="hljs-string">"è¯·ä½¿ç”¨å¾®ä¿¡æ‰«ä¸€æ‰«"</span>;
                &#125;,
                <span class="hljs-comment">// äºŒç»´ç è¢«æ‰«æï¼Œç­‰å¾…å®¢æˆ·ç«¯ç¡®è®¤</span>
                <span class="hljs-attr">SCANNED</span>: <span class="hljs-function">() =></span> &#123;
                    <span class="hljs-built_in">this</span>.isLoadingScan = <span class="hljs-literal">true</span>;
                    <span class="hljs-built_in">this</span>.desccontent = <span class="hljs-string">"è¯·åœ¨å¾®ä¿¡ä¸­ç‚¹å‡»ç¡®è®¤ç™»å½•"</span>;
                &#125;,
                <span class="hljs-comment">// ç™»å½•æˆåŠŸï¼Œä¿å­˜è·å¾—çš„ token</span>
                <span class="hljs-attr">SUCCESS</span>: <span class="hljs-function">(<span class="hljs-params">res</span>) =></span> &#123;
                    <span class="hljs-built_in">this</span>.$store.commit(<span class="hljs-string">"user/SET_TOKEN"</span>, res.data.token);
                    setToken(res.data.token);
                    location.reload();
                    <span class="hljs-built_in">this</span>.$notify(&#123;
                        <span class="hljs-attr">title</span>: <span class="hljs-string">"æˆåŠŸ"</span>,
                        <span class="hljs-attr">message</span>: <span class="hljs-string">"ç™»å½•æˆåŠŸ~"</span>,
                        <span class="hljs-attr">type</span>: <span class="hljs-string">"success"</span>,
                    &#125;);
                    <span class="hljs-built_in">this</span>.codeLoading = <span class="hljs-literal">false</span>;
                    <span class="hljs-built_in">this</span>.websock.close();
                &#125;,
            &#125;;
            <span class="hljs-comment">//åˆå§‹åŒ–weosocket</span>
            <span class="hljs-built_in">this</span>.websock = <span class="hljs-keyword">new</span> WebSocket(<span class="hljs-string">"ws://localhost:3000/webSocket"</span>);
            <span class="hljs-built_in">this</span>.websock.onmessage = <span class="hljs-function">(<span class="hljs-params">e</span>) =></span> &#123;
                <span class="hljs-keyword">const</span> res = <span class="hljs-built_in">JSON</span>.parse(e.data);
                <span class="hljs-keyword">const</span> handlerFn = messageHandler[res.data.type];
                <span class="hljs-comment">// åŒ¹é…åˆ°ç›¸åº”çš„å‡½æ•°ï¼Œæ‰§è¡Œä¹‹</span>
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> handlerFn === <span class="hljs-string">"function"</span>) &#123;
                    handlerFn(res);
                &#125;
            &#125;;
            <span class="hljs-comment">// è¿æ¥å»ºç«‹æˆåŠŸ</span>
            <span class="hljs-built_in">this</span>.websock.onopen = <span class="hljs-function">() =></span> &#123;
                <span class="hljs-comment">// å‘é€æ¶ˆæ¯ï¼Œè¯·æ±‚éšæœº id</span>
                <span class="hljs-built_in">this</span>.websock.send(<span class="hljs-string">"GET_CODE"</span>);
            &#125;;
            <span class="hljs-built_in">this</span>.websock.onerror = <span class="hljs-built_in">this</span>.websocketonerror;
            <span class="hljs-built_in">this</span>.websock.onclose = <span class="hljs-built_in">this</span>.websocketclose;
        &#125;,
        <span class="hljs-comment">//è¿æ¥å»ºç«‹å¤±è´¥é‡è¿</span>
        <span class="hljs-function"><span class="hljs-title">websocketonerror</span>(<span class="hljs-params"></span>)</span> &#123;
            <span class="hljs-built_in">this</span>.initWebSocket();
        &#125;,
        <span class="hljs-comment">//å…³é—­è¿æ¥</span>
        <span class="hljs-function"><span class="hljs-title">websocketclose</span>(<span class="hljs-params"></span>)</span> &#123;
            <span class="hljs-built_in">this</span>.isFailure = <span class="hljs-literal">true</span>;
            <span class="hljs-built_in">this</span>.isLoadingScan = <span class="hljs-literal">false</span>;
            <span class="hljs-built_in">this</span>.desccontent = <span class="hljs-string">""</span>;
        &#125;,
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<h2 data-id="heading-2">æœåŠ¡ç«¯ä»£ç </h2>
<blockquote>
<p>æœåŠ¡ç«¯æˆ‘ä½¿ç”¨çš„æ˜¯koaï¼ŒwebSocketè¿æ¥ä½¿ç”¨çš„æ˜¯wsæ’ä»¶ï¼Œåªè´´ä¸€éƒ¨åˆ†ä»£ç ï¼Œåƒé‚£äº›ç”Ÿæˆå°ç¨‹åºç éƒ½æ˜¯æ¥å£è°ƒç”¨
ç”±äºæˆ‘koaå’ŒwebSocketä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªç«¯å£å·ï¼Œæ‰€ä»¥åœ¨koaå¯åŠ¨çš„æ—¶å€™å°±åˆå§‹åŒ–webSocket</p>
</blockquote>
<pre><code class="copyable">app.listen(3000);
app.on('error', onError);
app.on('listening', onListening);

// websocket åˆå§‹åŒ–
const wss = createWss(server);
initWebsocket(wss);
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<ul>
<li><code>WebSocket Server å¯¹è±¡</code></li>
</ul>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-keyword">const</span> WebSocket = <span class="hljs-built_in">require</span>(<span class="hljs-string">'ws'</span>);

<span class="hljs-comment">// WebSocket Server å¯¹è±¡</span>
<span class="hljs-keyword">let</span> wss = <span class="hljs-literal">null</span>;

<span class="hljs-comment">// åˆ›å»º wss å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ Koa çš„ Server çš„å¯¹è±¡ä¼ å…¥ï¼Œæ¥å…±äº«ç«¯å£ï¼Œ</span>
<span class="hljs-comment">// ç¬¬ä¸€æ¬¡åˆ›å»ºæ—¶ï¼Œæˆ‘ä»¬ä¼šç»“æœèµ‹å€¼ç»™å°†ä¸Šé¢çš„ wssï¼Œ</span>
<span class="hljs-comment">// è¿™æ ·çš„å¥½å¤„æ˜¯æ–¹ä¾¿åœ¨æ¥å£å±‚ä¸­è·å– wss å¯¹è±¡ï¼ŒåŒ¹é…æ­£ç¡®çš„å®¢æˆ·ç«¯</span>
<span class="hljs-keyword">const</span> createWss = <span class="hljs-function">(<span class="hljs-params">server</span>) =></span> &#123;
    <span class="hljs-keyword">if</span> (!wss) &#123;
        wss = <span class="hljs-keyword">new</span> WebSocket.Server(&#123;
            <span class="hljs-attr">server</span>: server
        &#125;)
        <span class="hljs-keyword">return</span> wss;
    &#125; <span class="hljs-keyword">else</span> &#123;
        <span class="hljs-keyword">return</span> wss;
    &#125;
&#125;

<span class="hljs-comment">// è·å– wss å¯¹è±¡</span>
<span class="hljs-keyword">const</span> getWss = <span class="hljs-function">() =></span> &#123;
    <span class="hljs-keyword">return</span> wss;
&#125;


<span class="hljs-built_in">module</span>.exports = &#123;
    <span class="hljs-attr">createWss</span>: createWss,
    <span class="hljs-attr">getWss</span>: getWss
&#125;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<ul>
<li><code>åˆå§‹åŒ–åçš„äº‹ä»¶</code></li>
</ul>
<pre><code class="hljs language-JavaScript copyable" lang="JavaScript"><span class="hljs-comment">// å‘é€æ¶ˆæ¯</span>
<span class="hljs-keyword">const</span> sendData = <span class="hljs-function">(<span class="hljs-params">client, status, data</span>) =></span> &#123;
    <span class="hljs-keyword">if</span> (client && client.send) &#123;
        client.send(<span class="hljs-built_in">JSON</span>.stringify(&#123;
            <span class="hljs-attr">status</span>: status,
            <span class="hljs-attr">data</span>: data
        &#125;));
    &#125;
&#125;

<span class="hljs-comment">// æœåŠ¡åˆå§‹åŒ–</span>
<span class="hljs-keyword">const</span> initWebsocket = <span class="hljs-function">(<span class="hljs-params">wss</span>) =></span> &#123;
    wss.on(<span class="hljs-string">"connection"</span>, <span class="hljs-function">(<span class="hljs-params">ws</span>) =></span> &#123;
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`[SERVER] connection`</span>);
        <span class="hljs-comment">// æ¥æ”¶åˆ°æ•°æ®</span>
        ws.on(<span class="hljs-string">'message'</span>, <span class="hljs-function">(<span class="hljs-params">msg</span>) =></span> &#123;
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`[SERVER] Received: <span class="hljs-subst">$&#123;msg&#125;</span>`</span>);
            <span class="hljs-comment">// å‘é€æ•°æ®</span>
            <span class="hljs-keyword">const</span> fn = loginMessageHandler[msg];
            <span class="hljs-keyword">if</span> (fn) &#123;
                fn(ws);
            &#125; <span class="hljs-keyword">else</span> &#123;
                ws.send(<span class="hljs-string">"bad command!"</span>);
            &#125;
        &#125;);
    &#125;);
&#125;

<span class="hljs-comment">// å¤„ç†ç™»å½•æ¶ˆæ¯ï¼Œæ ¹æ®å®¢æˆ·ç«¯å‘æ¥çš„æ¶ˆæ¯åŒ¹é…ç›¸åº”çš„ä¸šåŠ¡é€»è¾‘æ“ä½œå‡½æ•°</span>
<span class="hljs-keyword">const</span> loginMessageHandler = &#123;
    <span class="hljs-string">"GET_CODE"</span>: <span class="hljs-function">(<span class="hljs-params">ws</span>) =></span> &#123;
        <span class="hljs-keyword">const</span> uid = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime();
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"è·å–äºŒç»´ç ----"</span> + uid);
        ws.loginCondition = &#123;
            <span class="hljs-attr">uuid</span>: uid,
            <span class="hljs-attr">status</span>: <span class="hljs-number">0</span>
        &#125;
        sendData(ws, <span class="hljs-string">"ok"</span>, &#123;
            <span class="hljs-attr">uuid</span>: uid,
            <span class="hljs-attr">type</span>: <span class="hljs-string">"CODE_ID"</span>
        &#125;);
    &#125;
&#125;

<span class="hljs-built_in">module</span>.exports = &#123;
    <span class="hljs-attr">initWebsocket</span>: initWebsocket,
    <span class="hljs-attr">sendData</span>: sendData
&#125;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<h2 data-id="heading-3">å¾®ä¿¡æ‰«ç ç™»å½•</h2>
<pre><code class="hljs language-JavaScript copyable" lang="JavaScript"><span class="hljs-comment">/**
     * å¾®ä¿¡æ‰«ç ç™»å½•
     * <span class="hljs-doctag">@param <span class="hljs-type">&#123;*&#125;</span> </span>ctx 
     */</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-title">wxscanLogin</span>(<span class="hljs-params">ctx</span>)</span> &#123;
        <span class="hljs-keyword">const</span> &#123; <span class="hljs-attr">scene</span>: uuid &#125; = ctx.request.body;
        <span class="hljs-keyword">let</span> payload = ctx.state.user;
        <span class="hljs-keyword">try</span> &#123;
            <span class="hljs-keyword">const</span> token = tools.generatorToken(&#123; <span class="hljs-attr">id</span>: payload.id &#125;);
            <span class="hljs-keyword">const</span> wss = getWss();
            <span class="hljs-keyword">if</span> (wss && wss.clients && token) &#123;
                <span class="hljs-comment">// å¯ä»¥åœ¨ wss.clients ä¸­æ‰¾åˆ°ç›¸åº”çš„å®¢æˆ·ç«¯</span>
                <span class="hljs-keyword">const</span> clients = wss.clients;
                <span class="hljs-comment">// æ‰¾åˆ°å¯¹åº”çš„ ws å®¢æˆ·ç«¯</span>
                <span class="hljs-keyword">let</span> targetClient = [...clients].find(<span class="hljs-function">(<span class="hljs-params">client</span>) =></span> client.loginCondition.uuid == uuid);
                <span class="hljs-keyword">if</span> (targetClient) &#123;
                    <span class="hljs-keyword">if</span> (targetClient.loginCondition.status == <span class="hljs-number">0</span>) &#123;
                        sendData(targetClient, <span class="hljs-string">"ok"</span>, &#123;
                            <span class="hljs-attr">uuid</span>: uuid,
                            <span class="hljs-attr">type</span>: <span class="hljs-string">"SUCCESS"</span>,
                            <span class="hljs-attr">token</span>: token
                        &#125;);
                    &#125;
                &#125;
                ctx.success();
            &#125;
        &#125; <span class="hljs-keyword">catch</span> (err) &#123;
            ctx.fail();
        &#125;
    &#125;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>æ¼”ç¤ºåœ°å€ : <a href="https://youxiubiji.com/" target="_blank" rel="nofollow noopener noreferrer">youxiubiji.com</a></p></div>  
</div>
            