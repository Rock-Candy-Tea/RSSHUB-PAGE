
---
title: 'AirPods Pro都买了吧，但是Apple官网的动效你会做吗？'
categories: 
 - 编程
 - 掘金
 - 分类
headimg: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4571d9cde7f7479fbec1f312ff528d42~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?'
author: 掘金
comments: false
date: Fri, 16 Sep 2022 01:12:03 GMT
thumbnail: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4571d9cde7f7479fbec1f312ff528d42~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?'
---

<div>   
<div class="markdown-body cache"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:24px;margin-bottom:5px&#125;.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;font-size:20px&#125;.markdown-body h2&#123;padding-bottom:12px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4571d9cde7f7479fbec1f312ff528d42~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?" alt="Snipaste_2022-09-16_15-01-35.png" loading="lazy" referrerpolicy="no-referrer">
“我正在参加「码上掘金挑战赛」详情请看：<a href="https://juejin.cn/post/7139728821862793223" title="https://juejin.cn/post/7139728821862793223" target="_blank">码上掘金挑战赛来了！</a>”</p>
<blockquote>
<p>苹果每年一度的发布会，前不久刚刚结束。毫无疑问今年的爱疯，依旧没啥创新没有新意。但是灵动岛设计，可谓是受到了各大媒体的追捧。部分人更是喊着 <code>支持华为，我买苹果</code>老段子了。</p>
</blockquote>
<p>发布会的第二天，就看到部门的妹纸在看新出的<code>AirPods Pro</code>，还说道：<br>
<code>“这个官网做的真好看，很有科技感！苹果的程序员就是厉害！”</code>；<br>
？？？ 我一脸不服气说道：<br>
<code>“这就厉害了？ 让我看看，看我不实现给你看。”</code>。<br>
然后自己仔细看了下，确实很炫酷很有冲击力，大家可以去看一下 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.apple.com.cn%2Fairpods-pro%2F" target="_blank" rel="nofollow noopener noreferrer" title="https://www.apple.com.cn/airpods-pro/" ref="nofollow noopener noreferrer">AirPods Pro</a>。看起来挺有难度的，不过我可是搞前端的，男人不能在女人面前说不行啊。（一生好强的男人。。。）<br>
走着， 不能在妹妹面前丢人。。。</p>
<h1 data-id="heading-0">1. 苹果官网</h1>
<p>首先，我们先来看一下，苹果实现的效果。</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9753a599415c4e59a5935b9793a7fcb7~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?" alt="SDGIF_Rusult_1.gif" loading="lazy" referrerpolicy="no-referrer"></p>
<h1 data-id="heading-1">2. 思考</h1>
<p>看到这里，我脑子里已经在思考这是怎么实现的了。首先我想到的是。。。  相信大家都很聪明，和我有这差不多的童年，这都是我们小时候玩过的。废话不多说上图。</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f3af770a28174565a511437e599803a0~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?" alt="20220916-152623.gif" loading="lazy" referrerpolicy="no-referrer">
看到了吧，<code>火柴人</code> 都玩过吧。我的想法就是创建一个动画，快速连续切换一系列图像。就像翻书一样，让我们的<code>火柴人</code>可以动起来。<br>
这时，我们就可以根据用户滚动的位置同步图片的每一帧，向上或者向下时，视觉上看起来像是一整套无缝的动画。</p>
<h1 data-id="heading-2">3. 分析</h1>
<p>然后我们打开官网<code>F12 </code>审查元素，找到这一元素。我们可以看到<code>Apple</code>用的<code>Canvas </code>。</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2c6c6e833c3a4da695fe8421624b2986~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?" alt="Snipaste_2022-09-16_14-42-16.png" loading="lazy" referrerpolicy="no-referrer">
这时，我们就可以初步判断了，我们的想法大概是一致的。然后我就切换到了<code>Network </code> 选择<code>img</code>，哈哈哈! 看到这里时 我就大概已经知道我该怎么做了。</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5434bb0d893d4833b60a655d1127ea00~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?" alt="Snipaste_2022-09-16_15-38-05.png" loading="lazy" referrerpolicy="no-referrer">
看一下我图片标的红框位置，这里<code>Apple</code>的<code>UI</code>切好了一整套流程的每一帧。并且我们可以轻松通过末尾的路径来精准渲染每帧的图像。拿到了现成的图片路径，我们废话不多说直接开始码。</p>
<h1 data-id="heading-3">4. 上代码</h1>
<pre><code class="hljs language-html copyable" lang="html">  <span class="hljs-tag"><<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>></span>
    <span class="hljs-tag"><<span class="hljs-name">head</span>></span>
      <span class="hljs-tag"><<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>></span>
      <span class="hljs-tag"><<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"IE=edge"</span>></span>
      <span class="hljs-tag"><<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>></span>
      <span class="hljs-tag"><<span class="hljs-name">title</span>></span>Document<span class="hljs-tag"></<span class="hljs-name">title</span>></span>
    <span class="hljs-tag"></<span class="hljs-name">head</span>></span>
    <span class="hljs-tag"><<span class="hljs-name">body</span>></span>
        <span class="hljs-tag"><<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"apple"</span> /></span>
    <span class="hljs-tag"></<span class="hljs-name">body</span>></span>
  <span class="hljs-tag"></<span class="hljs-name">html</span>></span>
<span class="copy-code-btn">复制代码</span></code></pre>
<pre><code class="hljs language-css copyable" lang="css">    // 因为我们要向下滚动页面（即内容不超过视口高度），并且<span class="hljs-selector-tag">Canvas</span>要停留在视口的顶部。
    <span class="hljs-selector-tag">body</span> &#123;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">500vh</span>;
      <span class="hljs-attribute">background</span>: <span class="hljs-number">#000</span>;
    &#125;

    <span class="hljs-selector-tag">canvas</span> &#123;
      <span class="hljs-attribute">position</span>: fixed;
      <span class="hljs-attribute">max-width</span>: <span class="hljs-number">100vw</span>;
      <span class="hljs-attribute">max-height</span>: <span class="hljs-number">100vh</span>;
    &#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>基础的代码我们已经写好了，接下来就是我们的<code>js</code>的部分了。<br></p>
<h2 data-id="heading-4">1. 使用 getContext 获得渲染上下文 拿到canvas的js基础代码</h2>
<pre><code class="hljs language-js copyable" lang="js">  <span class="hljs-keyword">const</span> html = <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>;
  <span class="hljs-keyword">const</span> canvas = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"apple"</span>);
  <span class="hljs-keyword">const</span> context = canvas.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">"2d"</span>);
  <span class="hljs-keyword">const</span> imgCount = <span class="hljs-number">65</span>; <span class="hljs-comment">// 图片的总张数</span>
  
<span class="copy-code-btn">复制代码</span></code></pre>
<h2 data-id="heading-5">2. 写一个函数，根据用户的滚动位置返回图片路径</h2>
<pre><code class="hljs language-js copyable" lang="js">      <span class="hljs-keyword">const</span> <span class="hljs-title function_">currentImg</span> = index => (
        index < <span class="hljs-number">10</span> <span class="hljs-comment">// 这里注意拼接的编号 就在这里做处理了</span>
         ? 
        <span class="hljs-string">`https://www.apple.com.cn/105/media/us/airpods-pro/2022/d2deeb8e-83eb-48ea-9721-f567cf0fffa8/anim/hero/large/000<span class="hljs-subst">$&#123;index&#125;</span>.png`</span>
         : 
         <span class="hljs-string">`https://www.apple.com.cn/105/media/us/airpods-pro/2022/d2deeb8e-83eb-48ea-9721-f567cf0fffa8/anim/hero/large/00<span class="hljs-subst">$&#123;index&#125;</span>.png`</span>
      )
<span class="copy-code-btn">复制代码</span></code></pre>
<h2 data-id="heading-6">3. 这里我们绘制我们的第一张图片</h2>
<p><span href="https://code.juejin.cn/pen/7143887641266618372" target="_blank" class="code-editor-container"><iframe class="code-editor-frame" data-code="code-editor-element" data-code-id="7143887641266618372" data-src="https://code.juejin.cn/pen/7143887641266618372" style="display: none" loading="lazy"></iframe></span></p>
<h2 data-id="heading-7">4. 我们的第一张图片已经成功渲染到我们的<code>Canvas </code>了，下面我们将根据用户滚动控制图片的每一帧渲染。</h2>
<p>这里我们需要知道：<br></p>
<ol>
<li>滚动开始结束的地方</li>
<li>滚动的多少</li>
<li>滚动进度对应的图片</li>
</ol>
<p>我们用 <code>scroll</code>的一些相关参数，获取我们需要的一些相关信息进行计算，得到想要的值。<br>
然后通过<code>scroll</code>事件，获取滚动进度与我们的图片序号进行对应。</p>
<pre><code class="hljs language-js copyable" lang="js">    
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'scroll'</span>, <span class="hljs-function">() =></span> &#123;  
  
    <span class="hljs-keyword">const</span> scrollTop = html.<span class="hljs-property">scrollTop</span>;
    <span class="hljs-keyword">const</span> maxScrollTop = html.<span class="hljs-property">scrollHeight</span> - <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>;
    <span class="hljs-keyword">const</span> scrollFraction = scrollTop / maxScrollTop;
    <span class="hljs-keyword">const</span> index = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(
      imgCount  - <span class="hljs-number">1</span>,
      <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(scrollFraction * imgCount )
    );
  &#125;);
<span class="copy-code-btn">复制代码</span></code></pre>
<h2 data-id="heading-8">5. 写一个回调函数，可以使其跟随我们的滚动更新渲染匹配的图片</h2>
<pre><code class="hljs language-js copyable" lang="js">  <span class="hljs-keyword">const</span> <span class="hljs-title function_">updateImg</span> = index => &#123;
    context.<span class="hljs-title function_">clearRect</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>,   canvas.<span class="hljs-property">width</span>,   canvas.<span class="hljs-property">height</span>) <span class="hljs-comment">// 清除上次img的渲染</span>
    img.<span class="hljs-property">src</span> = <span class="hljs-title function_">currentImg</span>(index);
    context.<span class="hljs-title function_">drawImage</span>(img, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
  &#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<h2 data-id="heading-9">6. 这里我们使用<a href="https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FWindow%2FrequestAnimationFrame" target="_blank" rel="nofollow noopener noreferrer" title="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestAnimationFrame" ref="nofollow noopener noreferrer"> requestAnimationFrame </a>来匹配浏览器的刷新率，可以让我们图片的每一帧平滑的过度。</h2>
<pre><code class="hljs language-js copyable" lang="js">  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'scroll'</span>, <span class="hljs-function">() =></span> &#123;  
  
    <span class="hljs-keyword">const</span> scrollTop = html.<span class="hljs-property">scrollTop</span>;
    <span class="hljs-keyword">const</span> maxScrollTop = html.<span class="hljs-property">scrollHeight</span> - <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>;
    <span class="hljs-keyword">const</span> scrollFraction = scrollTop / maxScrollTop;
    <span class="hljs-keyword">const</span> index = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(
      imgCount  - <span class="hljs-number">1</span>,
      <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(scrollFraction * imgCount )
    );
    <span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =></span> <span class="hljs-title function_">updateImg</span>(index + <span class="hljs-number">1</span>))
  &#125;);
<span class="copy-code-btn">复制代码</span></code></pre>
<h2 data-id="heading-10">7. 由于我们滚动的比较快速，需要更新的图片高达六十多张，新图像每次都要从新发起新的网络请求。</h2>
<blockquote>
<p>这里我们使用预加载，这样我们的每一帧都下载完成，我们的滚动就可以更丝滑了。<code>（毕竟咱是市级露娜，必须丝滑。狗头）</code></p>
</blockquote>
<pre><code class="hljs language-js copyable" lang="js">  <span class="hljs-keyword">const</span> <span class="hljs-title function_">preloadImg</span> = (<span class="hljs-params"></span>) => &#123;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i < imgCount ; i++) &#123;
      <span class="hljs-keyword">const</span> img = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Image</span>();
      img.<span class="hljs-property">src</span> = <span class="hljs-title function_">currentImg</span>(i);
    &#125;
  &#125;;
<span class="copy-code-btn">复制代码</span></code></pre>
<h1 data-id="heading-11">5. 完成 看效果</h1>
<p>AirPods Pro 一代
<span href="https://code.juejin.cn/pen/7143898365011427363" target="_blank" class="code-editor-container"><iframe class="code-editor-frame" data-code="code-editor-element" data-code-id="7143898365011427363" data-src="https://code.juejin.cn/pen/7143898365011427363" style="display: none" loading="lazy"></iframe></span>
AirPods Pro 二代
<span href="https://code.juejin.cn/pen/7143895374745337896" target="_blank" class="code-editor-container"><iframe class="code-editor-frame" data-code="code-editor-element" data-code-id="7143895374745337896" data-src="https://code.juejin.cn/pen/7143895374745337896" style="display: none" loading="lazy"></iframe></span>
<code>不知道为什么在代码片段里会有一些小闪烁，我本地是没有的，很丝滑。</code></p>
<p>好了这里我们整个流程就走完了，当然<code>Apple </code>官网并非写的这么简单。我写的比较简单一些，只是让大家看一下我的大概思想。有兴趣的同学可以试着去研究一下，还有很多优化的点需要优化。<br>
事实上整个实现过程并不是很难，但是咱们男人在妹纸面前说的大话不能食言呐！<br>
立马给妹纸看一下<code>(心想：“小样，迷不死你！” 这该死的魅力。。。。狗头)</code>。</p>
<h1 data-id="heading-12">6. 结尾</h1>
<p>其实有在想，为什么不能给这些图片合并成一个视频，或者使用一张巨大的<code>精灵图</code>，只请求一次图片？然后在让滚动和播放进度进行同步，不知道对于流畅度和文件大小不知道这样做是好一些还是差一些。当然自己水平有限，<code>Apple</code>的开发人员也应该有他们的想法考虑，获取使用图片才是最好的选择。（哈哈哈，自己的胡思乱想！）</p></div>  
</div>
            