
---
title: '常用函数手写整理'
categories: 
 - 编程
 - 掘金
 - 分类
headimg: 'https://picsum.photos/400/300?random=5029'
author: 掘金
comments: false
date: Thu, 10 Jun 2021 20:09:01 GMT
thumbnail: 'https://picsum.photos/400/300?random=5029'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><h2 data-id="heading-0">debounce/throttle</h2>
<blockquote>
<p>debounce一段时间内持续触发事件时，只执行最后一次</p>
</blockquote>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">debounce</span>(<span class="hljs-params">fn, delay = <span class="hljs-number">1000</span></span>)</span>&#123;
    <span class="hljs-keyword">let</span> timer = <span class="hljs-literal">null</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">...args</span>)</span>&#123;
        timer && <span class="hljs-built_in">clearTimeout</span>(timer)
        timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =></span> &#123;
            fn(...args)
        &#125;, delay)
    &#125;
&#125;

<span class="copy-code-btn">复制代码</span></code></pre>
<blockquote>
<p>throttle一段时间内持续触发事件时，只执行第一次</p>
</blockquote>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">throttle</span>(<span class="hljs-params">fn, delay = <span class="hljs-number">1000</span></span>)</span>&#123;
    <span class="hljs-keyword">let</span> flag = <span class="hljs-literal">true</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">...args</span>)</span>&#123;
        <span class="hljs-keyword">if</span>(flag)&#123;
            flag = <span class="hljs-literal">false</span>
            <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =></span> &#123;
                flag = <span class="hljs-literal">true</span>
            &#125;, delay)
        &#125;
    &#125;
&#125;

<span class="copy-code-btn">复制代码</span></code></pre>
<h2 data-id="heading-1">call/apply/bind</h2>
<blockquote>
<p>三者都可以改变函数运行时的this指向</p>
</blockquote>
<blockquote>
<p>call（）方法使用一个指定的 this 值和单独给出的一个或多个参数来调用一个函数。</p>
</blockquote>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">call</span>(<span class="hljs-params">context, ...args</span>)</span>&#123;
    <span class="hljs-keyword">const</span> ctx = context || <span class="hljs-built_in">window</span>
    <span class="hljs-keyword">const</span> func = <span class="hljs-built_in">Symbol</span>()
    ctx[func] = <span class="hljs-built_in">this</span>
    <span class="hljs-keyword">const</span> res = ctx[func](...args)
    <span class="hljs-keyword">delete</span> ctx[func]
    <span class="hljs-keyword">return</span> res
&#125;

<span class="copy-code-btn">复制代码</span></code></pre>
<blockquote>
<p>apply()方法使用一个指定this值，以及一个数组（或者类数组）形式的参数</p>
</blockquote>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">apply</span>(<span class="hljs-params">context, ...args</span>)</span>&#123;
    <span class="hljs-keyword">const</span> ctx = context || <span class="hljs-built_in">window</span>
    <span class="hljs-keyword">const</span> func = <span class="hljs-built_in">Symbol</span>()
    ctx[func] = <span class="hljs-built_in">this</span>
    <span class="hljs-keyword">const</span> res = ctx[func](...args)
    <span class="hljs-keyword">delete</span> ctx[func]
    <span class="hljs-keyword">return</span> res
&#125;

<span class="copy-code-btn">复制代码</span></code></pre>
<blockquote>
<p>bind()方法创建一个新的函数，在bind被调用时，这个新函数的this被指定为bind函数的第一个参数，而其余参数将作为新函数的参数。</p>
</blockquote>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">bind</span>(<span class="hljs-params">context, ...args</span>)</span>&#123;
    <span class="hljs-keyword">const</span> fn = <span class="hljs-built_in">this</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">...newArgs</span>)</span>&#123;
        fn.call(context, ...args, ...newArgs)
    &#125;
&#125;

<span class="copy-code-btn">复制代码</span></code></pre>
<h4 data-id="heading-2">new</h4>
<blockquote>
<p>new关键字会进行如下操作</p>
</blockquote>
<ul>
<li>创建一个空的简单JavaScript对象(即&#123;&#125;)</li>
<li>链接该对象（设置该对象的constructor）到另一个对象</li>
<li>将新创建的对象作为this上下文</li>
<li>如果该函数没有返回值就返回this</li>
</ul>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">myNew</span>(<span class="hljs-params">ctor, ...args</span>)</span>&#123;
    <span class="hljs-comment">// 创建新对象</span>
    <span class="hljs-keyword">const</span> obj = <span class="hljs-built_in">Object</span>.create()
    <span class="hljs-comment">// 链接该对象</span>
    obj.prototype = ctor.prototype
    <span class="hljs-comment">// 设置上下文</span>
    <span class="hljs-keyword">const</span> res = ctor.call(obj, ...args)
    <span class="hljs-comment">// 返回</span>
    <span class="hljs-keyword">return</span> res <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Object</span>? res: obj
    
&#125;

<span class="copy-code-btn">复制代码</span></code></pre>
<h4 data-id="heading-3">instanceOf</h4>
<blockquote>
<p>instanceOf 运算符用于检测构造函数的prototype是否出现在某个实例的原型链上</p>
</blockquote>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">// 用法 object instanceof constructor</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">C</span>(<span class="hljs-params"></span>)</span>&#123;&#125;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">D</span>(<span class="hljs-params"></span>)</span>&#123;&#125;
<span class="hljs-keyword">const</span> cExp = <span class="hljs-keyword">new</span> C()
<span class="hljs-keyword">const</span> dExp = <span class="hljs-keyword">new</span> D()
<span class="hljs-comment">// true 因为Object.getPrototypeOf(cExp) === C.prototype</span>
cExp <span class="hljs-keyword">instanceof</span> C 
<span class="hljs-comment">// false D.prototype不在cExp的原型上</span>

<span class="copy-code-btn">复制代码</span></code></pre>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">// 实现</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">myInstanceof</span>(<span class="hljs-params">obj=实例, Cla=类</span>)</span>&#123;
    <span class="hljs-keyword">let</span> leftPro = <span class="hljs-built_in">Object</span>.getPrototypeOf(obj)
    <span class="hljs-keyword">const</span> rightPro = Cla.prototype
    <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>)&#123;
        <span class="hljs-keyword">if</span>(!leftPro) trun <span class="hljs-literal">false</span>
        <span class="hljs-keyword">if</span>(leftPro === rightPro) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
        leftPro = <span class="hljs-built_in">Object</span>.getPrototypeOf(leftPro)
    &#125;
&#125;

<span class="copy-code-btn">复制代码</span></code></pre>
<h4 data-id="heading-4">Object.create</h4>
<blockquote>
<p>Object.create()方法创建一个新对象，使用现有的对象来提供新对象的__proto__</p>
</blockquote>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">myCreate</span>(<span class="hljs-params">ctor</span>)</span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">C</span>(<span class="hljs-params"></span>)</span>&#123;&#125;
    C.prototype = ctor
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> C()
&#125;

<span class="copy-code-btn">复制代码</span></code></pre>
<h4 data-id="heading-5">Object.assign</h4>
<blockquote>
<p>Object.assign()方法用于将所有可枚举的属性从一个或多个源对象分配到目标对象，它将返回目标对象</p>
</blockquote>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">myAssign</span>(<span class="hljs-params">target, args</span>)</span>&#123;
    <span class="hljs-keyword">const</span> to = <span class="hljs-built_in">Object</span>(target)
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i< args.length; i++)&#123;
        <span class="hljs-keyword">const</span> nextSource = args[i]
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> nextKey <span class="hljs-keyword">in</span> nextSource)&#123;
            <span class="hljs-keyword">if</span>(<span class="hljs-built_in">Object</span>.prototype.hasOwnProperty(nextSource,nextKey))&#123;
                to[nextKey] = nextSource[nextKey]
            &#125;
        &#125;
    &#125;
&#125;

<span class="copy-code-btn">复制代码</span></code></pre>
<h4 data-id="heading-6">deepClone</h4>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">deepClone</span>(<span class="hljs-params">target</span>)</span>&#123;
    <span class="hljs-keyword">if</span>(target instanceOf <span class="hljs-built_in">RegExp</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(target)
    <span class="hljs-keyword">if</span>(target instanceOf <span class="hljs-built_in">Date</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(target)
    <span class="hljs-keyword">if</span>(target !== <span class="hljs-literal">null</span> || <span class="hljs-keyword">typeof</span> target !== <span class="hljs-string">'object'</span>) <span class="hljs-keyword">return</span> target
    <span class="hljs-keyword">let</span> ctor = <span class="hljs-keyword">new</span> target.constructor()
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> key <span class="hljs-keyword">in</span> target)&#123;
        <span class="hljs-keyword">if</span>(target.hasOwnProperty()key)&#123;
           ctor = deepClone(target[key])
        &#125;
    &#125;
    <span class="hljs-keyword">return</span> ctor
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<h4 data-id="heading-7">数组扁平化</h4>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">myFlat</span>(<span class="hljs-params">data</span>)</span>&#123;
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Array</span>.reduce(<span class="hljs-function">(<span class="hljs-params">prev,cur</span>) =></span> &#123;
        <span class="hljs-keyword">return</span> prev.concat(myFlat(cur))
    &#125;,[])
&#125;

<span class="copy-code-btn">复制代码</span></code></pre>
<h4 data-id="heading-8">节点遍历</h4>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">traverse</span>(<span class="hljs-params">node, nodeList = []</span>)</span>&#123;
    nodeList.push(node)
    <span class="hljs-keyword">const</span> children = node.children
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i < children.length; i++)&#123;
        traverse(children[i], nodeList)
    &#125;
    <span class="hljs-keyword">return</span> nodeList
&#125;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">traverse2</span>(<span class="hljs-params">node</span>)</span>&#123;
    <span class="hljs-keyword">let</span> nodeList = []
    nodeList.push(node)
    <span class="hljs-keyword">const</span> children = node.children
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>;i < children.length; i++)&#123;
        nodeList = nodeList.concat(traverse2(children[i]))
    &#125;
    <span class="hljs-keyword">return</span> nodeList
&#125;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">traverse3</span>(<span class="hljs-params">node</span>)</span>&#123;
    <span class="hljs-keyword">let</span> nodeList = []
    <span class="hljs-keyword">let</span> stack = []
    stack.push(node)
    <span class="hljs-keyword">while</span>(stack.length)&#123;
        <span class="hljs-keyword">const</span> item = stack.pop()
        nodeList.push(item)
        <span class="hljs-keyword">const</span> children = item.children
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i< children.length; i++)&#123;
            stack.push(children[i])
        &#125;
    &#125;
    <span class="hljs-keyword">return</span> nodeList
&#125;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">traverse4</span>(<span class="hljs-params">node</span>)</span>&#123;
    <span class="hljs-keyword">let</span> nodeList = []
    <span class="hljs-keyword">let</span> stack = []
    stack.push(node)
    <span class="hljs-keyword">while</span>(stack.length)&#123;
        <span class="hljs-keyword">const</span> item = stack.shift()
        <span class="hljs-keyword">const</span> children = item.children
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i < children.length; i++)&#123;
            stack.push(children[i])
        &#125;
    &#125;
    <span class="hljs-keyword">return</span> nodeList
&#125;

<span class="copy-code-btn">复制代码</span></code></pre>
<h4 data-id="heading-9">函数柯里化</h4>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sum</span>(<span class="hljs-params">a, b, c</span>)</span>&#123;
    <span class="hljs-keyword">return</span> a + b + c
&#125;
<span class="hljs-keyword">const</span> sum = curry(sum)
sum(<span class="hljs-number">1</span>)(<span class="hljs-number">2</span>)(<span class="hljs-number">3</span>) <span class="hljs-comment">// 6</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">curry</span>(<span class="hljs-params">fn, ...args</span>)</span>&#123;
    <span class="hljs-keyword">const</span> fnLen = fn.length
    <span class="hljs-keyword">const</span> argsLen = args.length
    <span class="hljs-comment">//如果参数不够就继续返回curry</span>
    <span class="hljs-comment">//若参数够了就执行函数</span>
    <span class="hljs-keyword">if</span>(fnLen > argsLen)&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">...args2</span>)</span>&#123;
            <span class="hljs-keyword">return</span> curry(fn, ...args,...args2)
        &#125;
    &#125;<span class="hljs-keyword">else</span>&#123;
        fn(...args)
    &#125;
&#125;

<span class="copy-code-btn">复制代码</span></code></pre>
<h4 data-id="heading-10">JSONP</h4>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">JSONP</span>(<span class="hljs-params">url, data</span>)</span>&#123;
    <span class="hljs-keyword">const</span> callback = <span class="hljs-string">'callback'</span> + <span class="hljs-built_in">Math</span>.random()
    <span class="hljs-keyword">const</span> src = url + <span class="hljs-string">'?callback='</span> + callback
    <span class="hljs-keyword">const</span> script = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'script'</span>)
    script.setAttribute(<span class="hljs-string">'type'</span>, <span class="hljs-string">'text/javascript'</span>)
    script.src = src
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =></span> &#123;
        <span class="hljs-built_in">window</span>[callback] = <span class="hljs-function"><span class="hljs-params">r</span> =></span> &#123;
          resolve(r)
          headEle.removeChild(JSONP)
          <span class="hljs-keyword">delete</span> <span class="hljs-built_in">window</span>[callback]
        &#125;
        headEle.appendChild(JSONP)
    &#125;)
&#125;
JSONP().then(<span class="hljs-function"><span class="hljs-params">res</span> =></span> &#123;
    <span class="hljs-comment">//res就是我们要拿的数据</span>
    <span class="hljs-built_in">console</span>.log(res)
&#125;)
<span class="copy-code-btn">复制代码</span></code></pre>
<h4 data-id="heading-11">观察者模式</h4>
<blockquote>
<p>定义对象间的一种一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都得到通知并被自动更新</p>
</blockquote>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Subject</span></span>&#123;
    <span class="hljs-function"><span class="hljs-title">constructor</span>(<span class="hljs-params"></span>)</span>&#123;
        <span class="hljs-built_in">this</span>.name = <span class="hljs-string">'JavaScript'</span>
        <span class="hljs-built_in">this</span>.observers = []
    &#125;
    <span class="hljs-function"><span class="hljs-title">attach</span>(<span class="hljs-params">obs</span>)</span>&#123;
        <span class="hljs-built_in">this</span>.observers.push(obs)
    &#125;
    <span class="hljs-function"><span class="hljs-title">detach</span>(<span class="hljs-params">obs</span>)</span>&#123;
        <span class="hljs-built_in">this</span>.observers.remove(obs)
    &#125;
    <span class="hljs-function"><span class="hljs-title">notify</span>(<span class="hljs-params"></span>)</span>&#123;
        <span class="hljs-built_in">this</span>.observers.forEach(<span class="hljs-function"><span class="hljs-params">o</span> =></span> o.update(<span class="hljs-built_in">this</span>.name))
    &#125;
&#125;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Observer</span></span>&#123;
    <span class="hljs-function"><span class="hljs-title">update</span>(<span class="hljs-params"></span>)</span>&#123;
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'收到通知更新啦'</span>)
    &#125;
&#125;
<span class="hljs-keyword">const</span> sub = <span class="hljs-keyword">new</span> Subject()
<span class="hljs-keyword">const</span> obsmm = <span class="hljs-keyword">new</span> Observer()
<span class="hljs-keyword">const</span> obsnn = <span class="hljs-keyword">new</span> Observer()
sub.attach(obsmm)
sub.attach(obsnn)
sub.notify()
<span class="copy-code-btn">复制代码</span></code></pre>
<h4 data-id="heading-12">EventEmitter 事件侦听器</h4>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EventEmitter</span></span>&#123;
    <span class="hljs-function"><span class="hljs-title">constructor</span>(<span class="hljs-params"></span>)</span>&#123;
        <span class="hljs-built_in">this</span>.events = &#123;&#125;
    &#125;
    <span class="hljs-function"><span class="hljs-title">on</span>(<span class="hljs-params">event, cb</span>)</span>&#123;
        <span class="hljs-keyword">const</span> cbList = <span class="hljs-built_in">this</span>.events[event] || []
        cbList.push(cb)
        <span class="hljs-built_in">this</span>.events[event] = cbList
    &#125;
    <span class="hljs-function"><span class="hljs-title">off</span>(<span class="hljs-params">event, cb</span>)</span>&#123;
        <span class="hljs-keyword">const</span> cbList = <span class="hljs-built_in">this</span>.events[event] || []
        <span class="hljs-built_in">this</span>.events[event] = cbList.filter(<span class="hljs-function"><span class="hljs-params">fn</span> =></span> fn !== cb)
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>
    &#125;
    <span class="hljs-function"><span class="hljs-title">emit</span>(<span class="hljs-params">event, ...args</span>)</span>&#123;
        <span class="hljs-keyword">const</span> cbList = <span class="hljs-built_in">this</span>.events[event] || []
        cbList.forEach(<span class="hljs-function"><span class="hljs-params">fn</span> =></span> fn(...args))
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>
    &#125;
    <span class="hljs-built_in">this</span>.once(event, cb)&#123;
        <span class="hljs-keyword">const</span> fn = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">...args</span>)</span>&#123;
            cb(...args)
            <span class="hljs-built_in">this</span>.off(event, fn)
        &#125;
        <span class="hljs-built_in">this</span>.on(event, fn)
    &#125;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<h4 data-id="heading-13">数组随机排序/生成随机数</h4>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-keyword">let</span> arr = [<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">454</span>,<span class="hljs-number">34</span>,<span class="hljs-number">324</span>,<span class="hljs-number">32</span>]
arr.sort(randomSort)
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">randomSort</span>(<span class="hljs-params">a,b</span>)</span>&#123;
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Math</span>.random() > <span class="hljs-number">0.5</span>? -<span class="hljs-number">1</span>: <span class="hljs-number">1</span>
&#125;
<span class="hljs-comment">// --------------------------------------</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getRandom</span>(<span class="hljs-params">max, min</span>)</span>&#123;
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Math</span>.random() * (max - min) + min
&#125;

<span class="copy-code-btn">复制代码</span></code></pre>
<h4 data-id="heading-14">sleep</h4>
<blockquote>
<p>sleep函数作用是让线程休眠，等到指定时间在重新唤起</p>
</blockquote>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sleep</span>(<span class="hljs-params">delay</span>)</span>&#123;
    <span class="hljs-keyword">const</span> start = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime()
    <span class="hljs-keyword">while</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime() - start < delay)&#123;
        <span class="hljs-keyword">continue</span>
    &#125;
&#125;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">test</span>(<span class="hljs-params"></span>)</span>&#123;
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'start'</span>)
    sleep(<span class="hljs-number">2000</span>)
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'end'</span>)
&#125;
test()
<span class="copy-code-btn">复制代码</span></code></pre>
<h4 data-id="heading-15">对象数组去重</h4>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">// 将value转成字符串，利用set去重</span>
<span class="hljs-keyword">const</span> arr = [&#123;<span class="hljs-attr">a</span>:<span class="hljs-number">1</span>,<span class="hljs-attr">b</span>:<span class="hljs-number">2</span>,<span class="hljs-attr">c</span>:<span class="hljs-number">3</span>&#125;,&#123;<span class="hljs-attr">b</span>:<span class="hljs-number">2</span>,<span class="hljs-attr">c</span>:<span class="hljs-number">3</span>,<span class="hljs-attr">a</span>:<span class="hljs-number">1</span>&#125;,&#123;<span class="hljs-attr">d</span>:<span class="hljs-number">2</span>,<span class="hljs-attr">c</span>:<span class="hljs-number">2</span>&#125;]
<span class="hljs-function"><span class="hljs-title">objSort</span>(<span class="hljs-params">obj</span>)</span>&#123;
    <span class="hljs-keyword">let</span> newObj = <span class="hljs-built_in">Object</span>.create(&#123;&#125;)
    <span class="hljs-built_in">Object</span>.keys(obj).forEach(<span class="hljs-function"><span class="hljs-params">key</span> =></span> &#123;
        newObj[key] = obj[key]
    &#125;)
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">JSON</span>.stringify(newObj)
&#125;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">unique</span>(<span class="hljs-params">arr</span>)</span>&#123;
    <span class="hljs-keyword">let</span> set = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Set</span>()
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i < arr.length; i++)&#123;
        set.add(objSort(arr[i]))
    &#125;
    returm [...set].map(<span class="hljs-function"><span class="hljs-params">item</span> =></span> <span class="hljs-built_in">JSON</span>.parse(item))
&#125;

<span class="copy-code-btn">复制代码</span></code></pre>
<h4 data-id="heading-16">Promise</h4>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-keyword">let</span> id = <span class="hljs-number">0</span>
<span class="hljs-keyword">const</span> PENDING = <span class="hljs-number">0</span>
<span class="hljs-keyword">const</span> FULFILLED = <span class="hljs-number">1</span>
<span class="hljs-keyword">const</span> REJECTED  = <span class="hljs-number">2</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Promise</span></span>&#123;
    <span class="hljs-function"><span class="hljs-title">constructor</span>(<span class="hljs-params">excutor</span>)</span>&#123;
        <span class="hljs-built_in">this</span>.promiseId = ++id
        <span class="hljs-built_in">this</span>.state = <span class="hljs-literal">undefined</span>
        <span class="hljs-built_in">this</span>.result = <span class="hljs-literal">undefined</span>
        <span class="hljs-built_in">this</span>.subscribers = []
        excutor(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resolvePromise</span>(<span class="hljs-params">value</span>)</span>&#123;
            <span class="hljs-built_in">this</span>.resolve(value)
        &#125;, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">rejectPromise</span>(<span class="hljs-params">reason</span>)</span>&#123;
            <span class="hljs-built_in">this</span>.reject(reason)
        &#125;)
    &#125;
    <span class="hljs-function"><span class="hljs-title">resolve</span>(<span class="hljs-params">value</span>)</span>&#123;
        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">this</span>.state !== PENDING) <span class="hljs-keyword">return</span> 
        <span class="hljs-built_in">this</span>.state = FULFILLED
        <span class="hljs-built_in">this</span>.result = value
        <span class="hljs-comment">//异步任务执行的resolve需要执行一下收集的onFulfilled/onRejected方法（then里面的回调）</span>
        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">this</span>.subscribers.length)&#123;
            <span class="hljs-built_in">this</span>.publish
        &#125;
    &#125;,
    <span class="hljs-function"><span class="hljs-title">reject</span>(<span class="hljs-params">reason</span>)</span>&#123;
        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">this</span>.state !== PENDING) <span class="hljs-keyword">return</span>
        <span class="hljs-built_in">this</span>.state = REJECTED
        <span class="hljs-built_in">this</span>.result = reason
    &#125;
    <span class="hljs-function"><span class="hljs-title">then</span>(<span class="hljs-params">onFulfilled,onRejected</span>)</span>&#123;
        <span class="hljs-keyword">const</span> child = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;&#125;)
        <span class="hljs-comment">//如果是同步任务执行的resolve或者reject那么此时state是有值的</span>
        <span class="hljs-comment">//那么需要执行then的回调，并给新的promise进行赋值</span>
        <span class="hljs-comment">//如果是异步任务执行resolve或者reject，那么将then的回调收集起来</span>
        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">this</span>.state)&#123;
            <span class="hljs-built_in">this</span>.invokeCallback(<span class="hljs-built_in">this</span>.state,child,onFulfilled,<span class="hljs-built_in">this</span>.result)
        &#125;<span class="hljs-keyword">else</span>&#123;
            <span class="hljs-built_in">this</span>.subscribe(child,onFulfilled,onRejected)
        &#125;
    &#125;
    <span class="hljs-function"><span class="hljs-title">subscribe</span>(<span class="hljs-params">promise, onFulfilled,onRejected</span>)</span>&#123;
        <span class="hljs-keyword">const</span> length = <span class="hljs-built_in">this</span>.subsceibers.length
        <span class="hljs-built_in">this</span>.subscribers[length] = promise
        <span class="hljs-built_in">this</span>.subscribers[length + FULFILLED] = onFulfilled
        <span class="hljs-built_in">this</span>.subscribers[length + REJECTED] = onRejected
    &#125;
    <span class="hljs-function"><span class="hljs-title">invokeCallback</span>(<span class="hljs-params">state, promise, callback, result</span>)</span>&#123;
        <span class="hljs-keyword">let</span> value = result
        <span class="hljs-keyword">if</span>(getType(callback) === <span class="hljs-string">'function'</span>)&#123;
            value = callback()
        &#125;
        <span class="hljs-comment">// 给新生成的promise进行赋值</span>
        promise.resolve(value)
    &#125;
    <span class="hljs-function"><span class="hljs-title">publish</span>(<span class="hljs-params"></span>)</span>&#123;
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i=<span class="hljs-number">0</span>;i<<span class="hljs-built_in">this</span>.subscribers.length;i++)&#123;
            <span class="hljs-keyword">let</span> child=<span class="hljs-built_in">this</span>.subsctibers[i]
            <span class="hljs-keyword">let</span> cb = <span class="hljs-built_in">this</span>.subscribers[i + <span class="hljs-built_in">this</span>.state]
            <span class="hljs-keyword">if</span>(child)&#123;
                <span class="hljs-built_in">this</span>.invokeCallback(<span class="hljs-built_in">this</span>.state,child,cb,<span class="hljs-built_in">this</span>.result)
            &#125;<span class="hljs-keyword">else</span>&#123;
                cb(<span class="hljs-built_in">this</span>.result)
            &#125;
        &#125;
    &#125;
    
&#125;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getType</span>(<span class="hljs-params">target</span>)</span>&#123;
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.prototype.toString.call(target).slice(<span class="hljs-number">8</span>,-<span class="hljs-number">1</span>).toLowercase()
&#125;

<span class="copy-code-btn">复制代码</span></code></pre></div>  
</div>
            