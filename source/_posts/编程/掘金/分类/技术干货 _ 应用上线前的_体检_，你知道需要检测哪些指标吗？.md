
---
title: '技术干货 _ 应用上线前的_体检_，你知道需要检测哪些指标吗？'
categories: 
 - 编程
 - 掘金
 - 分类
headimg: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8bf8e4685ca54927b3cc3ab07b598334~tplv-k3u1fbpfcp-zoom-1.image'
author: 掘金
comments: false
date: Thu, 15 Apr 2021 22:15:58 GMT
thumbnail: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8bf8e4685ca54927b3cc3ab07b598334~tplv-k3u1fbpfcp-zoom-1.image'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><p>随着越来越多的企业基于 mPaaS 搭建并上线新的 App，App 的上线质量也成为各个客户关注的重点。上线前检测哪些项目？如何检测？检测数据指标包括哪些？</p>
<p>借着上次去 XX 农信客户去做线上功能检测，加上之前多个 mPaaS 历史项目的经验总结，将 App 上线前 mPaaS 相关检测内容整理沉淀如下。</p>
<h2 data-id="heading-0">一、安全性</h2>
<h3 data-id="heading-1">1.1 RPC 是否开启国密加密</h3>
<p>对 App 来说，数据通信安全至关重要，mPaaS 已经支持 ECC、RSA 和国密（SM2）三种方式。其中，在金融行业 App 内建议开启加密配置为 SM2 国密加密，满足行业监管要求。配置可以参考产品文档：<a href="https://help.aliyun.com/document_detail/72752.html" target="_blank" rel="nofollow noopener noreferrer">数据加密</a></p>
<h3 data-id="heading-2">1.2 离线包是否开启验签</h3>
<p><img alt="1.png" title="1.png" class="lazyload" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8bf8e4685ca54927b3cc3ab07b598334~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<p>为了保证下发到本地离线包的安全性，mPaaS 提供了离线包验签机制，保证了离线包的安全性。整体示意图如上所示，用户设置流程如下:</p>
<ol>
<li>开发者配置好一对公私钥，私钥放在服务端用于对离线包签名，公钥放在客户端，用于对签名对验证。</li>
<li>在离线包发布平台，如果配置了签名私钥，平台下发的 amr 文件就会带上签名信息（通过私钥对离线包的 hash 值加密后得到的密文）。</li>
<li>客户端在拿到 amr 包并解压后，客户端会使用在项目中预置的公钥进行签名的验证（解密上一步的密文得到一个 hash 值，同时本地计算离线包的 hash 值，判断两者是否相同），如果相同则通过验证。</li>
<li>如果签名校验失败，则删除离线包走 fallback 地址。</li>
</ol>
<p>通过离线包的验签机制，可以达到以下的目的：</p>
<ol>
<li>保证了离线包的内容完整，解决解压异常，读取异常下的正常显示</li>
<li>保证了离线包的来源正确，不被本地恶意篡改</li>
</ol>
<h3 data-id="heading-3">1.3 userId 信息是否设置正确</h3>
<p>因为 userId 会被后续用到很多地方，比如推送，白名单。所以一般建议选择服务端的 userId 字段作为存储字段，方便后续和服务端做 userId 字段同步，不建议存储个人手机号或者身份证等个人信息作为 userId。</p>
<h3 data-id="heading-4">1.4 埋点信息是否包含敏感信息，比如交易单号</h3>
<p>考虑到埋点的量级很大，所以 mPaas 的埋点默认本地是没有做数据加密的，所以埋点信息不建议包含敏感字段，防止由于埋点导致信息泄漏。敏感字段建议走 RPC 的数据通道上报，保证数据安全。如果有埋点埋敏感字段的诉求，需要主动开启埋点的本地加密配置。</p>
<h3 data-id="heading-5">1.5 隐私权限配置</h3>
<p>由于现在监管机构对隐私权限管控比较严格，mPaas 针对权限管控做了对应的接入方案。需要需要确保上线前隐私权限相关配置已经正常接入。</p>
<h2 data-id="heading-6">二、稳定性</h2>
<h3 data-id="heading-7">2.1 验证在 Android4.X 版本的是否可以正常使用</h3>
<p>mPaaS 最低支持 Android 4.3 版本以上，所以发布前需要验证下低版本 Android 设备的可用性，遇到比较多的是在 Android 4.X 设备上由于多 dex 加载导致的类找不到导致的安装闪退问题。</p>
<h3 data-id="heading-8">2.2 iOS 符号表是否正常上传</h3>
<p>发布前需要确保 iOS 的符号表已经上传到 mPaaS 后台，方便后台反解闪退信息。</p>
<h3 data-id="heading-9">2.3 热修复模块是否接入并且验证通过</h3>
<p>发布前需要确保热修复模块的正常接入以及验证通过，保证上线有针对 Native 模块的热修复能力，保证异常场景下的修复能力。</p>
<h3 data-id="heading-10">2.4 离线包 Fallback 域名确认</h3>
<p>确认 Fallback 域名是否是外网可访问的地址，遇到过发布后下发的还是内网地址的 case。</p>
<h3 data-id="heading-11">2.5 离线包模块接入 CDN</h3>
<p>上线前做好容量评估，默认 mPaaS 的离线包是存储在 OSS 内的，但是一般建议针对离线包模块接入 CDN，通过 CDN 的缓存功能解决因为离线包下载导致带宽打满的风险，同时相对于 OSS 存储来说，CDN 的费用更低。接入示意图如下：</p>
<p><img alt="2.png" title="2.png" class="lazyload" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/de63ac106bb44f198717c72412c4e758~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<h3 data-id="heading-12">2.6 RPC 核心链路接口压测</h3>
<p>上线前需要对 App 核心链路的 RPC 接口做性能压测，获取接口性能瓶颈，可以用做后续的限流值的设定参考。同时需要针对 RPC 限流场景做演练，防止上线限流后客户端出现各种异常。</p>
<h3 data-id="heading-13">2.7 发布更新功能可用</h3>
<p>上线前需要验证发布 apk 功能可用，包括发布更新的强制更新功能，保证在极端场景下，需要强制升级使用。</p>
<h2 data-id="heading-14">三、性能体验</h2>
<h4 data-id="heading-15">3.1 离线包离线功能是否正常生效</h4>
<p>确保离线包的离线功能正常使用，防止由于离线包各种配置问题导致离线功能不生效。</p>
<h3 data-id="heading-16">3.2 UC 内核是否正常接入</h3>
<p>确保 UC 内核正确配置接入，主要解决系统 WebView 下的各种兼容性问题。同时 UC 提供了很好的稳定性，比系统 WebView 更稳定。</p>
<h3 data-id="heading-17">3.3 核心链路离线包是否预制</h3>
<p>在发布前，需要预制核心链路离线包，保证核心链路在极端异常场景下仍然可以打开。</p>
<p><img alt="作者介绍.png" title="作者介绍.png" class="lazyload" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/499be44f6cff47a380373348474b9593~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<p><img alt="动态-logo.gif" title="动态-logo.gif" class="lazyload" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2f3b636b2c1b43a9b7a5f3206b6659ba~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<p><img alt="底部banner.png" title="底部banner.png" class="lazyload" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e9a03bd4e4b94b2f9c2e449ebf92706f~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<p>点击下方“<a href="https://www.aliyun.com/product/mobilepaas/mpaas" target="_blank" rel="nofollow noopener noreferrer"><strong>阅读原文</strong></a>”，了解「mPaaS」更多资讯。</p></div> <div class="image-viewer-box" data-v-78c9b824><!----></div>  
</div>
            