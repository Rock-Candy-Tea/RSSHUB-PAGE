
---
title: 'ã€ç©è½¬æ˜é‡‘ã€‘ æˆ‘çš„èµï¼Œæˆ‘çš„ğŸ’—ï¼Œéƒ½ç»™äº†è°ï¼Œæœ‰ä½ å—ï¼Ÿ'
categories: 
 - ç¼–ç¨‹
 - æ˜é‡‘
 - åˆ†ç±»
headimg: 'https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/84bac01d8fa8425785ab5079462e897e~tplv-k3u1fbpfcp-watermark.image'
author: æ˜é‡‘
comments: false
date: Tue, 17 Aug 2021 16:22:30 GMT
thumbnail: 'https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/84bac01d8fa8425785ab5079462e897e~tplv-k3u1fbpfcp-watermark.image'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><p>è¿™æ˜¯æˆ‘å‚ä¸8æœˆæ›´æ–‡æŒ‘æˆ˜çš„ç¬¬18å¤©ï¼Œæ´»åŠ¨è¯¦æƒ…æŸ¥çœ‹ï¼š<a href="https://juejin.cn/post/6987962113788493831" title="https://juejin.cn/post/6987962113788493831" target="_blank">8æœˆæ›´æ–‡æŒ‘æˆ˜</a>ã€‚</p>
<h2 data-id="heading-0">å‰è¨€</h2>
<p><a href="https://juejin.cn/column/6993674706347884580" target="_blank" title="https://juejin.cn/column/6993674706347884580">ç©è½¬æ˜é‡‘</a> ç³»åˆ—ï¼Œå¯¹æ˜é‡‘æ‰©å±•ä¸€äº›æœ‰æ„æ€çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li><a href="https://juejin.cn/post/6990140519342932004" target="_blank" title="https://juejin.cn/post/6990140519342932004">ã€ç©è½¬æ˜é‡‘ã€‘æ˜é‡‘ä¸“æ æ–‡ç« æ­£ç”Ÿæˆpdfæ–‡æ¡£</a></li>
<li><a href="https://juejin.cn/post/6995717142318415880" target="_blank" title="https://juejin.cn/post/6995717142318415880">ã€ç©è½¬æ˜é‡‘ã€‘æ˜é‡‘ç­¾çº¦ä½œè€…ï¼Œæˆ˜åŠ›å‚æ•°åˆ†æï¼Œæ•°æ®ç¯‡</a></li>
</ul>
<p>æŸå¤©è¿›å…¥ä¸ªäººä¸»é¡µä¸€çœ‹ï¼Œè‡ªå·±å·²ç»ç»™åˆ«äººç‚¹èµè¿‡<code>åƒ</code>äº†ï¼Œæˆ‘æ»´ä¸ªç¥ã€‚<br>
ä½œä¸ºæ–°äººï¼Œäº’ç›¸æ”¯æŒä¸€ä¸‹ï¼Œä¹Ÿç®—æ­£å¸¸ï¼Œæˆ‘çš„è¿™äº›ğŸ’—ï¼Œéƒ½ç»™äº†è°å‘¢ï¼Œè¿½å¯»çœŸåƒï¼Œè‡ªå·±åŠ¨æ‰‹å®ç°ä¸€ä¸ªå§ã€‚</p>
<h2 data-id="heading-1">æ•ˆæœæ¼”ç¤º</h2>
<p><strong>è¯¦æƒ…åˆ—è¡¨æ˜¯å¯ä»¥ç‚¹å‡»è¿›å…¥æ–‡ç« é¡µé¢çš„</strong><br>
<img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/84bac01d8fa8425785ab5079462e897e~tplv-k3u1fbpfcp-watermark.image" alt="stars.gif" loading="lazy" referrerpolicy="no-referrer"></p>
<h2 data-id="heading-2">æºç åœ°å€</h2>
<p>æºç åœ°å€ï¼š<strong><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fxiangwenhu%2FjuejinBlogsCodes%2Ftree%2Fmaster%2FJJMyStarAndC" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/xiangwenhu/juejinBlogsCodes/tree/master/JJMyStarAndC" ref="nofollow noopener noreferrer">JJMyStarAndC </a></strong></p>
<p>åç«¯æœåŠ¡é‡‡ç”¨nodejsç¼–å†™ï¼Œä½ éœ€è¦å®‰è£…å¯¹åº”çš„å®‰è£…åŒ…ã€‚</p>
<h2 data-id="heading-3">å®ç°æ€è·¯</h2>
<p>å¯è¡Œçš„æ€è·¯ï¼š</p>
<ol>
<li>Chromeæ’ä»¶ + æ¸¸çŒ´è„šæœ¬</li>
<li>é™æ€é¡µé¢ + nginxä»£ç†</li>
<li>é™æ€é¡µé¢ + æœåŠ¡è½¬å‘</li>
<li>......</li>
</ol>
<p>æœ¬æ–‡çš„æ€è·¯æ˜¯  <code>é™æ€é¡µé¢</code> + <code>nodejsè‡ªå®šä¹‰æœåŠ¡</code>,<br>
çº¯å±ä¸ºäº†å¥½ç©é¢å¤–ç”¨äº† <a href="https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-TW%2Fdocs%2FWeb%2FAPI%2FServer-sent_events" target="_blank" rel="nofollow noopener noreferrer" title="https://developer.mozilla.org/zh-TW/docs/Web/API/Server-sent_events" ref="nofollow noopener noreferrer">Server Sent Events</a> , ç®€ç§°SSEï¼ŒæœåŠ¡å™¨ç«¯å•è¾¹æ¨é€ï¼Œ<strong>å…¶ä½œç”¨æ˜¯æœåŠ¡ç«¯è·å–æ•°æ®åï¼Œå•è¾¹æ¨åŠ¨ç»™å®¢æœç«¯ã€‚</strong></p>
<p>æœ‰äººå¯èƒ½ä¼šè¯´ï¼Œå’‹ä¸ç”¨ <code>socket.io</code>, æˆ‘è¿™é‡Œé¢å¤–è¯´ä¸€ä¸‹ï¼Œ <code>socket.io</code>å·ç§°socketä¸­çš„jQueryï¼Œ è¿™ä¸ªæ„æ€ï¼Œå¤§å®¶æ‡‚äº†å§ï¼Œè€Œä¸”è¿˜è¦é…å¥—å…¶æœåŠ¡ç«¯åº“ä¸€èµ·ä½¿ç”¨ï¼Œè®¨åŒï¼ï¼</p>
<p>æ›´å¥½çš„å®ç°æ–¹æ¡ˆï¼šé€ä¼ å³å¯<br>
<code>express</code> + <code>http-proxy-middleware</code></p>
<h2 data-id="heading-4">å®ç°ç»†èŠ‚</h2>
<h3 data-id="heading-5">æ•°æ®è·å–</h3>
<p>ä¸€åˆ‡å‡å›´ç»•æ•°æ®å±•å¼€ï¼Œæ²¡æœ‰æ•°æ®ï¼Œåˆ«ç”»é¥¼ï¼Œåˆ«è°ˆç†æƒ³ã€‚</p>
<p>å¯¹äºStarè·å–ï¼Œä¸€ä¸ªæ¥å£è¶³ä»¥ï¼</p>
<p><strong>è¯·æ±‚åœ°å€ï¼š</strong> <a href="https://api.juejin.cn/interact_api/v1/digg/query_page" target="_blank" title="https://api.juejin.cn/interact_api/v1/digg/query_page">api.juejin.cn/interact_apâ€¦</a><br>
<strong>è¯·æ±‚æ–¹å¼ï¼š</strong> <strong>post</strong><br>
<strong>è¯·æ±‚å‚æ•°ï¼š</strong><br>
å…¶æœ‰æ²¡æœ‰éšè—çš„<code>limit</code>å‚æ•°é€‰é¡¹å‘¢ï¼Ÿ å¤§å®¶å¯ä»¥å°è¯•ä¸€æ³¢ï¼</p>
<pre><code class="hljs language-js copyable" lang="js"> &#123;
    <span class="hljs-attr">cursor</span>: <span class="hljs-string">`<span class="hljs-subst">$&#123;cursor&#125;</span>`</span>,  <span class="hljs-comment">// èµ·å§‹æŸ¥è¯¢ä½ç½®</span>
    <span class="hljs-attr">item_type</span>: <span class="hljs-number">2</span>,    <span class="hljs-comment">// æ–‡ç« ç‚¹èµï¼Œå¯¹åº”æœ‰æ²¸ç‚¹ç‚¹èµ</span>
    <span class="hljs-attr">sort_type</span>: <span class="hljs-number">2</span>,   <span class="hljs-comment">// æ’åºï¼Œæœ‰è¿‘å¯¼å‘˜</span>
    <span class="hljs-attr">user_id</span>: uid, <span class="hljs-comment">// ç”¨æˆ·id</span>
  &#125;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p><strong>è¿”å›ç»“æœï¼š</strong></p>
<pre><code class="hljs language-js copyable" lang="js">&#123;
   <span class="hljs-attr">has_more</span>:Â <span class="hljs-literal">true</span>,
   <span class="hljs-attr">data</span>: [&#123;
       <span class="hljs-attr">author_user_info</span>:&#123;
           <span class="hljs-attr">user_id</span>:Â <span class="hljs-string">"3465271329953806"</span>, <span class="hljs-comment">// ç”¨æˆ·ID</span>
           <span class="hljs-attr">user_name</span>:Â <span class="hljs-string">"å°é­”ç«¥å“ªå’"</span> <span class="hljs-comment">// ç”¨æˆ·å</span>
       &#125;, 
       <span class="hljs-attr">article_info</span>: &#123;
           <span class="hljs-attr">article_id</span>: <span class="hljs-string">"6996484371305725965"</span>  <span class="hljs-comment">// æ–‡ç« ID</span>
           <span class="hljs-attr">title</span>:Â <span class="hljs-string">"k8s å­¦ä¹ äºŒ"</span>  <span class="hljs-comment">// æ–‡ç« æ ‡é¢˜</span>
       &#125;
   &#125;]
&#125;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>è¯·æ±‚çš„æ—¶å€™ï¼Œ <code>cursor</code>å‚æ•°éå¸¸é‡è¦ï¼Œè¡¨ç¤ºæŒ‡é’ˆä½ç½®ï¼Œä»å“ªç»§ç»­å¾€åèµ°ã€‚<br>
è¿”å›ç»“æœé‡Œé¢ï¼Œå¾ˆé‡è¦çš„å­—æ®µ<code>has_more</code>ï¼Œ è¡¨ç¤ºè¿˜æ²¡æœ‰æ•°æ®ï¼Œå¦‚æœæœ‰ï¼Œç»§ç»­è·å–ã€‚</p>
<p>æ˜é‡‘å¾ˆå¤šçš„æ¥å£ï¼Œèµ·åˆæ²¡åšé™åˆ¶çš„ï¼Œå½“åˆæˆ‘è®°å¾—æŸäº›æ¥å£å¯ä»¥ä¼ å…¥<code>limit</code>å‚æ•°ä¸º1000ï¼Œä¹Ÿå¯ä»¥ï¼Œåæ¥åšäº†æ”¹è¿›ï¼Œå€¼å¾—èµä¸€æ³¢ã€‚</p>
<p>å…¶å¾ªç¯è·å–æ ¸å¿ƒä»£ç ï¼š</p>
<pre><code class="hljs language-js copyable" lang="js"> <span class="hljs-keyword">while</span> (res.has_more) &#123;
    data.cursor = <span class="hljs-string">`<span class="hljs-subst">$&#123;cursor&#125;</span>`</span>
    
    res = (<span class="hljs-keyword">await</span> axios.default.post(url, data, &#123;
      headers
    &#125;)).data;
    
    cursor += <span class="hljs-number">10</span>;
    <span class="hljs-keyword">await</span> delay(<span class="hljs-literal">undefined</span>, <span class="hljs-number">16</span>).run();  <span class="hljs-comment">// æš‚åœ16ms, æ•…æ„çš„</span>
  &#125;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>æˆ‘ä»¬è¯´äº†ï¼Œè¿™é‡Œæ˜¯æœåŠ¡ç«¯è·å–äº†æ•°æ®ï¼Œè¿˜æ²¡æ¨åŠ¨åˆ°å‰ç«¯ã€‚</p>
<h3 data-id="heading-6">æ•°æ®æ¨é€</h3>
<p>nodejsç«¯ä½¿ç”¨SSEï¼Œä¹Ÿå¾ˆç®€å•ï¼Œæˆ‘è¿™é‡Œå°±æ²¡æœ‰ä½¿ç”¨ä¸‰æ–¹åº“äº†ã€‚</p>
<ol>
<li>requestä¼ äº†uidï¼Œridä¸¤ä¸ªå‚æ•°
uidè¡¨ç¤ºç”¨æˆ·ID, ridè¡¨ç¤ºrequestId</li>
<li><code>getStars</code> è¡¨ç¤ºå¼€å§‹æŸ¥è¯¢</li>
<li>SSEçš„æ ¸å¿ƒå°±åœ¨äº<code>Content-Type</code>ä¸<code>Connection</code><br>
<code>'Content-Type': 'text/event-stream'</code>ç”³æ˜ç±»å‹<br>
<code>'Connection': 'keep-alive'</code>è¡¨ç¤ºä¸å…³é—­è¿æ¥</li>
<li>å› ä¸ºè¿™é‡Œä¹Ÿå±äºä¸€ä¸ªè¯·æ±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬å€ŸåŠ©äº‹ä»¶ä¸­å¿ƒæ¥æ´¾å‘äº‹ä»¶ç»™è¯·æ±‚ï¼Œè¯·æ±‚å†å›å†™æ•°æ®</li>
</ol>
<pre><code class="hljs language-js copyable" lang="js">app.get(<span class="hljs-string">'/sseStream'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">request, response</span>) </span>&#123;
  response.writeHead(<span class="hljs-number">200</span>, &#123;
    <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/event-stream'</span>,
    <span class="hljs-string">'Cache-Control'</span>: <span class="hljs-string">'no-cache'</span>,
    <span class="hljs-string">'Connection'</span>: <span class="hljs-string">'keep-alive'</span>
  &#125;);

  <span class="hljs-keyword">const</span> &#123; uid, rid &#125; = request.query;
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"uid:"</span>, uid);

  <span class="hljs-comment">// æŸ¥è¯¢ç”¨æˆ·çš„ç‚¹èµ</span>
  getStars(uid, rid);

  <span class="hljs-comment">// äº§çº¿å¯åˆ«è¿™ä¹ˆç”¨</span>
  eventsCenter.removeAllListeners(<span class="hljs-string">"ssePush"</span>);
  <span class="hljs-comment">// äº‹ä»¶ä¸­å¿ƒ</span>
  eventsCenter.on(<span class="hljs-string">"ssePush"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">event, data</span>) </span>&#123;
    <span class="hljs-comment">// console.log("push message to clients");</span>
    response.write(<span class="hljs-string">"event: "</span> + <span class="hljs-built_in">String</span>(event) + <span class="hljs-string">"\n"</span> + <span class="hljs-string">"data: "</span> + <span class="hljs-built_in">JSON</span>.stringify(data) + <span class="hljs-string">"\n\n"</span>);

  &#125;);
&#125;);
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>é‚£äº‹ä»¶æ˜¯å“ªæ´¾å‘å‡ºæ¥çš„ï¼Œå°±æ˜¯æ•°æ®è·å–é‚£é‡Œæ´¾å‘çš„ï¼Œæˆ‘è¡¥ä¸Šä»£ç , è¿™é‡Œå¤šäº†ä¸¤ç§å¤–çš„äº‹ä»¶<code>messageTotal</code>, <code>messageEnd</code>, ä¸€ä¸ªæ˜¯æ€»æ•°æ¶ˆæ¯ï¼Œæœ‰ä¸ªæ˜¯è¡¨ç¤ºè¯·æ±‚ç»“æŸçš„æ¶ˆæ¯ã€‚</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getStars</span>(<span class="hljs-params">uid, rid</span>) </span>&#123;
  <span class="hljs-keyword">let</span> cursor = <span class="hljs-number">0</span>
  <span class="hljs-keyword">const</span> data = &#123;
    <span class="hljs-attr">cursor</span>: <span class="hljs-string">`<span class="hljs-subst">$&#123;cursor&#125;</span>`</span>,
    <span class="hljs-attr">item_type</span>: <span class="hljs-number">2</span>,
    <span class="hljs-attr">sort_type</span>: <span class="hljs-number">2</span>,
    <span class="hljs-attr">user_id</span>: uid,
  &#125;
  <span class="hljs-keyword">let</span> res = &#123;
    <span class="hljs-attr">has_more</span>: <span class="hljs-literal">true</span>
  &#125;;

  <span class="hljs-keyword">while</span> (res.has_more) &#123;
    data.cursor = <span class="hljs-string">`<span class="hljs-subst">$&#123;cursor&#125;</span>`</span>

    res = (<span class="hljs-keyword">await</span> axios.default.post(url, data, &#123;
      headers
    &#125;)).data;

    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"res:"</span>, data, res)

    eventsCenter.emit(<span class="hljs-string">"ssePush"</span>, <span class="hljs-string">"messageTotal"</span>, &#123;
      uid,
      rid,
      <span class="hljs-attr">count</span>: res.count
    &#125;);
    eventsCenter.emit(<span class="hljs-string">"ssePush"</span>, <span class="hljs-string">"message"</span>, &#123;
      uid,
      rid,
      <span class="hljs-attr">datas</span>: (res.data || []).map(<span class="hljs-function"><span class="hljs-params">d</span> =></span> (&#123;
        <span class="hljs-attr">user_id</span>: d.author_user_info.user_id,
        <span class="hljs-attr">user_name</span>: d.author_user_info.user_name,
        <span class="hljs-attr">title</span>: d.article_info.title
      &#125;))
    &#125;);
    cursor += <span class="hljs-number">10</span>;
    <span class="hljs-keyword">await</span> delay(<span class="hljs-literal">undefined</span>, <span class="hljs-number">16</span>).run();
  &#125;
  eventsCenter.emit(<span class="hljs-string">"ssePush"</span>, <span class="hljs-string">"messageEnd"</span>, &#123;
    uid,
    rid
  &#125;)
&#125;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<h3 data-id="heading-7">å‰ç«¯æ•°æ®è·å–</h3>
<p>å‰å°å¯¹åº”ç›‘å¬äº‹ä»¶å°±å¥½äº†, å°±è¿™ä¹ˆç®€å•ã€‚</p>
<pre><code class="hljs language-js copyable" lang="js">    <span class="hljs-keyword">const</span> source = <span class="hljs-keyword">new</span> EventSource(<span class="hljs-string">`/sseStream?uid=<span class="hljs-subst">$&#123;uid&#125;</span>&rid=<span class="hljs-subst">$&#123;rid&#125;</span>`</span>);

    <span class="hljs-comment">// æ”¶åˆ°æ–°æ•°æ®</span>
    source.addEventListener(<span class="hljs-string">'message'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>&#123;
        <span class="hljs-keyword">let</span> data = <span class="hljs-built_in">JSON</span>.parse(e.data)
        <span class="hljs-comment">// ä¸æ˜¯éœ€è¦çš„æ•°æ®</span>
        <span class="hljs-keyword">if</span> (data.uid != uid || data.rid != rid) &#123;
            <span class="hljs-keyword">return</span>;
        &#125;

        listArr.push(...data.datas);
        <span class="hljs-comment">// console.log("listArr:", listArr);</span>
        renderList(listArr);
        gotStarsEl.innerHTML = listArr.length;

    &#125;, <span class="hljs-literal">false</span>)

    <span class="hljs-comment">// æ”¶åˆ°æ€»æ•°æ®æ¶ˆæ¯</span>
    source.addEventListener(<span class="hljs-string">'messageTotal'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>&#123;
        <span class="hljs-keyword">let</span> data = <span class="hljs-built_in">JSON</span>.parse(e.data)

        <span class="hljs-comment">// ä¸æ˜¯éœ€è¦çš„æ•°æ®</span>
        <span class="hljs-keyword">if</span> (data.uid != uid || data.rid != rid) &#123;
            <span class="hljs-keyword">return</span>;
        &#125;
        totalStarsEl.innerHTML = data.count;
    &#125;, <span class="hljs-literal">false</span>)

    <span class="hljs-comment">// ç»Ÿè®¡å®Œæ¯•</span>
    source.addEventListener(<span class="hljs-string">'messageEnd'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>&#123;
        <span class="hljs-keyword">let</span> data = <span class="hljs-built_in">JSON</span>.parse(e.data)
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"meesage"</span>, data);
    &#125;, <span class="hljs-literal">false</span>)
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<h3 data-id="heading-8">ç»Ÿè®¡å’Œåˆ†ç»„</h3>
<ol>
<li>ç»Ÿè®¡ï¼š ä»¥ç”¨æˆ·IDä¸ºkeyï¼Œæ²¡æœ‰åˆ™æ–°å»ºï¼Œæœ‰åˆ™ä¿®æ”¹åŸºæ•°ã€‚</li>
<li>å¯¹keysè¿›è¡Œmapè½¬æ•°ç»„ï¼Œç„¶åsortã€‚</li>
</ol>
<p>å°±è¿™ä¹ˆç®€å•ï¼</p>
<pre><code class="hljs language-js copyable" lang="js">    <span class="hljs-keyword">const</span> statObj = list.reduce(<span class="hljs-function">(<span class="hljs-params">obj, cur</span>) =></span> &#123;
        <span class="hljs-keyword">if</span> (hasOwnProperty.call(obj, cur.user_id)) &#123;
            obj[cur.user_id].count += <span class="hljs-number">1</span>;
            obj[cur.user_id].items.push(cur);
        &#125; <span class="hljs-keyword">else</span> &#123;
            obj[cur.user_id] = &#123;
                <span class="hljs-attr">items</span>: [cur],
                <span class="hljs-attr">count</span>: <span class="hljs-number">1</span>,
                ...cur
            &#125;;
        &#125;
        <span class="hljs-keyword">return</span> obj;
    &#125;, &#123;&#125;);

    <span class="hljs-comment">// åˆ†ç»„</span>
    <span class="hljs-keyword">const</span> groupList = <span class="hljs-built_in">Object</span>
        .keys(statObj)
        .map(<span class="hljs-function"><span class="hljs-params">k</span> =></span> statObj[k])  <span class="hljs-comment">//åˆ†ç»„</span>
        .sort(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =></span> a.count > b.count ? -<span class="hljs-number">1</span> : <span class="hljs-number">1</span>);  <span class="hljs-comment">// æ’åº</span>
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>æ›´å¤šçš„å®ç°ç»†èŠ‚ï¼Œè¯·ç§»æ­¥æºç ã€‚</p>
<h2 data-id="heading-9">å†™åœ¨æœ€å</h2>
<p>3-5åˆ†é’Ÿï¼Œ500-1000å­—ï¼Œæœ‰æ‰€å¾—ï¼Œè€Œä¸ä¸ºæ‰€ç´¯ï¼Œå¦‚æœä½ è§‰å¾—ä¸é”™ï¼Œä½ çš„ä¸€èµä¸€è¯„å°±æ˜¯æˆ‘å‰è¡Œçš„æœ€å¤§åŠ¨åŠ›ã€‚</p>
<p>æŠ€æœ¯äº¤æµç¾¤è¯·åˆ° <a href="https://juejin.cn/pin/6994350401550024741" title="https://juejin.cn/pin/6994350401550024741" target="_blank">è¿™é‡Œæ¥</a>ã€‚
æˆ–è€…æ·»åŠ æˆ‘çš„å¾®ä¿¡ dirge-cloudï¼Œä¸€èµ·å­¦ä¹ ã€‚</p></div>  
</div>
            