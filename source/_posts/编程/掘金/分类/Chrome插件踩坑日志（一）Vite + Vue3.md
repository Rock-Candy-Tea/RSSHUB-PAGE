
---
title: 'Chromeæ’ä»¶è¸©å‘æ—¥å¿—ï¼ˆä¸€ï¼‰Vite + Vue3'
categories: 
 - ç¼–ç¨‹
 - æ˜é‡‘
 - åˆ†ç±»
headimg: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6ac6a7d1b14a401eaeb85ad90c8157ee~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.image'
author: æ˜é‡‘
comments: false
date: Wed, 14 Sep 2022 19:13:32 GMT
thumbnail: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6ac6a7d1b14a401eaeb85ad90c8157ee~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.image'
---

<div>   
<div class="markdown-body cache"><style>.markdown-body&#123;word-break:break-word;line-height:1.7;font-weight:400;font-size:16px;overflow-x:hidden;color:#2c3e50;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;font-weight:600;margin-top:35px;margin-bottom:8px;padding-bottom:5px&#125;.markdown-body h1 :before,.markdown-body h2 :before,.markdown-body h3 :before,.markdown-body h4 :before,.markdown-body h5 :before,.markdown-body h6 :before&#123;content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:8px;margin-top:50px;font-size:24px;border-bottom:1px solid #eaecef&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #eaecef;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;overflow-x:auto;font-weight:400;background-color:rgba(27,31,35,.05);color:#476582;margin:0;font-size:.85em;border-radius:3px;font-size:.87em;padding:.165em .5em&#125;.markdown-body code,.markdown-body pre&#123;font-family:source-code-pro,Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.6;padding:20px 24px;background-color:#282c34;border-radius:6px&#125;.markdown-body pre>code&#123;font-size:14px;padding:0;margin:0;word-break:normal;display:block;overflow-x:auto;color:#fff&#125;.markdown-body a&#123;text-decoration:none;color:#3eaf7c;font-weight:500&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#42b983;border-bottom:1px solid #42b983&#125;.markdown-body table&#123;display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;margin:16px 0;border-collapse:collapse&#125;.markdown-body thead&#123;background:#f6f6f6;background:#3eaf7c;color:#000;color:#fff;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#f6f8fa&#125;.markdown-body td,.markdown-body th&#123;border:1px solid #dfe2e5;padding:10px 16px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;font-size:14px;padding:6px 23px;margin:22px 0;border-left:6px solid #42b983;background-color:#f3f5f7;font-weight:400&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body p,.markdown-body ul&#123;line-height:1.7&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><p>â€œæˆ‘æŠ¥åå‚åŠ é‡‘çŸ³è®¡åˆ’1æœŸæŒ‘æˆ˜â€”â€”ç“œåˆ†10ä¸‡å¥–æ± ï¼Œè¿™æ˜¯æˆ‘çš„ç¬¬nç¯‡æ–‡ç« ï¼Œ<a href="https://s.juejin.cn/ds/jooSN7t" title="https://s.juejin.cn/ds/jooSN7t" target="_blank">ç‚¹å‡»æŸ¥çœ‹æ´»åŠ¨è¯¦æƒ…</a>â€</p>
<p>ä¹‹å‰æœ‰æ®µæ—¶é—´ä¸€ç›´åœ¨å¼€å‘<code>chrome</code>æ’ä»¶ï¼Œè¸©äº†å¥½å¤šçš„å‘ï¼Œè€Œä¸”é—®é¢˜éƒ½å¾ˆç¢ç‰‡åŒ–ï¼Œæ‰€ä»¥æ‰“ç®—å¼€ä¸€ä¸ªç³»åˆ—æ¥è®°å½•ä¸€ä¸‹ã€‚åœ¨è¿™ä¸ªç³»åˆ—é‡Œä¼šé€æ­¥äº§å‡ºä¸¤ä¸ªä¸œè¥¿ï¼Œä¸€ä¸ªæ˜¯ç”¨äºæ’ä»¶å¼€å‘æ¨¡æ¿å·¥ç¨‹ï¼Œå³æ‹‰å³ç”¨ï¼Œä¸€ä¸ªæ˜¯æ ¹æ®æ¨¡æ¿å¼€å‘çš„ä¸€æ¬¾æ’ä»¶ï¼ŒåŠŸèƒ½æ˜¯ç»“åˆæˆ‘æ—¥å¸¸å·¥ä½œä¸­æ¯”è¾ƒç—›ç‚¹çš„ä¸€äº›åŠŸèƒ½ã€‚</p>
<blockquote>
<p>PSï¼šä¸ºäº†é™ä½é˜…è¯»ç–²åŠ³ï¼Œå•ç¯‡å¹…ä¸¤åƒå­—å·¦å³ ğŸš²ï¼Œçœ‹ä¸å®Œå°±ç‚¹ä¸ªèµã€‚</p>
</blockquote>
<h2 data-id="heading-0">Chromeæ’ä»¶ç®€ä»‹ ğŸ§©</h2>
<p>é¦–å…ˆæ¥ç®€å•ä»‹ç»ä¸‹ä»€ä¹ˆæ˜¯chromeæ’ä»¶ï¼Œåé¢ä¹Ÿä¼šç©¿æ’ä¸€äº›å…³äºæ’ä»¶çš„åŸºæœ¬çŸ¥è¯†ã€‚</p>
<p>chromeæ’ä»¶åˆå«crxï¼ˆ<code>chrome extension</code>ï¼‰,çœ‹ä¸‹å›¾å°±å¾ˆæ˜æ˜¾äº†ï¼Œå®é™…ä¸Šåº”è¯¥å«<strong>chromeæ‰©å±•ç¨‹åº</strong>ï¼Œåªæ˜¯ä¸­æ–‡è¡¨è¾¾å«æ’ä»¶æ›´æ–¹ä¾¿ã€‚</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6ac6a7d1b14a401eaeb85ad90c8157ee~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>æ’ä»¶ä¸»è¦èƒ½æä¾›äº†ä¸€äº›æµè§ˆå™¨åœ¨Webé¡µé¢ä¹‹å¤–çš„èƒ½åŠ›ï¼Œç”¨æ¥<strong>å¢å¼ºç”¨æˆ·ä½“éªŒ</strong>ï¼Œæ¯”å¦‚è¯´å¯¹é¡µé¢å­—ç¬¦ä¸²è¿›è¡Œjsonæ ¼å¼åŒ–ï¼Œæ•´ä½“é¡µé¢é•¿æˆªå›¾ï¼ŒReactè°ƒè¯•å·¥å…·ç­‰ç­‰ï¼Œå—ä¼—é¢éå¸¸å¹¿ã€‚</p>
<p>chromeæ’ä»¶çš„åº•å±‚ä»£ç å…¶å®å°±æ˜¯å‰ç«¯åŒå­¦æœ€ç†Ÿæ‚‰çš„ <code>html + js + css</code> ä¸‰å‰‘å®¢ï¼ŒåŒæ—¶å†åŠ ä¸Šä¸€äº›åŸç”Ÿçš„<code>chrome API</code>ã€‚</p>
<h3 data-id="heading-1">manifest.json</h3>
<p>è¿™ä¸ªjsonæ–‡ä»¶åœ¨æ’ä»¶çš„ç›®å½•ä¸‹æ˜¯å¿…é¡»è¦æœ‰çš„ï¼Œé‡è¦æ€§å¯ç­‰åŒäºå‰ç«¯é¡¹ç›®é‡Œçš„<code>package.json</code>ï¼Œå¯ä»¥ç†è§£ä¸ºæ˜¯æ’ä»¶çš„<strong>é…ç½®æ¸…å•</strong>ã€‚</p>
<p>ä¸‹é¢å°±æ˜¯å®é™…çš„ä¸€ä¸ªä¾‹å­ï¼Œå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡æ¥è§¦ä¸éœ€è¦ç»†çœ‹ï¼Œåé¢ä¼šç»“åˆåœºæ™¯æ¥ä»‹ç»å®é™…çš„å«ä¹‰ã€‚</p>
<pre><code class="hljs language-perl copyable" lang="perl">&#123;
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"æ’ä»¶å"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"0.0.1"</span>,
  <span class="hljs-string">"manifest_version"</span>: <span class="hljs-number">3</span>,
  <span class="hljs-string">"author"</span>: <span class="hljs-string">"dty6809183@gmail.com"</span>,
  <span class="hljs-string">"description"</span>: <span class="hljs-string">"TinssonTaiçš„æ’ä»¶æ¨¡æ¿"</span>,
  <span class="hljs-string">"icons"</span>: &#123;
    <span class="hljs-string">"16"</span>: <span class="hljs-string">"/assets/dev.png"</span>,
    <span class="hljs-string">"48"</span>: <span class="hljs-string">"/assets/dev.png"</span>,
    <span class="hljs-string">"96"</span>: <span class="hljs-string">"/assets/dev.png"</span>,
    <span class="hljs-string">"128"</span>: <span class="hljs-string">"/assets/dev.png"</span>
  &#125;,
  <span class="hljs-string">"permissions"</span>: [
    <span class="hljs-string">"activeTab"</span>
  ],
  <span class="hljs-string">"host_permissions"</span>: [
    <span class="hljs-string">"http://*/*"</span>,
    <span class="hljs-string">"https://*/*"</span>
  ],
  <span class="hljs-string">"background"</span>: &#123;
    <span class="hljs-string">"service_worker"</span>: <span class="hljs-string">"/background/index.js"</span>
  &#125;,
  <span class="hljs-string">"content_scripts"</span>: [
    &#123;
      <span class="hljs-string">"matches"</span>: [<span class="hljs-string">"<all_urls>"</span>],
      <span class="hljs-string">"js"</span>: [<span class="hljs-string">"/contentScript/index.js"</span>],
      <span class="hljs-string">"run_at"</span>: <span class="hljs-string">"document_end"</span>
    &#125;
  ],
&#125;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>å­—æ®µä¼šåˆ†<strong>å¿…å¡«é¡¹</strong>ï¼Œæ¨èé¡¹ï¼Œé…ç½®é€‰é¡¹ï¼Œéƒ¨åˆ†å­—æ®µè¯´æ˜ï¼š</p>













































<table><thead><tr><th>å­—æ®µå</th><th>å«ä¹‰</th><th>é€‰é¡¹ç±»å‹</th></tr></thead><tbody><tr><td>name</td><td>æ’ä»¶åç§°</td><td><strong>å¿…å¡«é¡¹ï¼ˆRequiredï¼‰</strong></td></tr><tr><td>version</td><td>æ’ä»¶ç‰ˆæœ¬å·ï¼Œéšå¼€å‘é€’å¢</td><td><strong>å¿…å¡«é¡¹ï¼ˆRequiredï¼‰</strong></td></tr><tr><td>manifest_version</td><td>æ¸…å•æ–‡ä»¶ç‰ˆæœ¬ï¼Œ2 or 3</td><td><strong>å¿…å¡«é¡¹ï¼ˆRequiredï¼‰</strong></td></tr><tr><td>description</td><td>æ’ä»¶æè¿°</td><td>æ¨èé¡¹ï¼ˆRecommendedï¼‰</td></tr><tr><td>icons</td><td>ä¸åŒä½ç½®çš„å›¾æ ‡</td><td>æ¨èé¡¹ï¼ˆRecommendedï¼‰</td></tr><tr><td>background</td><td>å¸¸é©»çš„åå°é…ç½®</td><td>é…ç½®é€‰é¡¹ï¼ˆOptionalï¼‰</td></tr><tr><td>permissions</td><td>éƒ¨åˆ†chrome APIéœ€è¦ç”³è¯·çš„æƒé™</td><td>é…ç½®é€‰é¡¹ï¼ˆOptionalï¼‰</td></tr></tbody></table>
<h3 data-id="heading-2">V3ç‰ˆæœ¬é—®é¢˜</h3>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/71a4d3adda254a72bd03a1e41c7ddbf5~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>è¿™æ˜¯ä¸€å¼ æ¥è‡ªå®˜æ–¹æ–‡æ¡£çš„å›¾ç‰‡ï¼Œç®€å•æ¥è¯´å°±æ˜¯manifestçš„ç‰ˆæœ¬ä»¥ååªä¼šæ”¯æŒV3çš„ç‰ˆæœ¬ï¼ŒV3çš„å‡çº§ä¸»è¦æ˜¯ä»¥ä¸‹å‡ ä¸ªç‚¹ï¼š</p>
<ul>
<li>backgroundä¸Šä¸‹æ–‡å‡çº§ä¸º<code>service worker</code></li>
<li>ç½‘ç»œç›¸å…³APIæœ‰æ‰€å˜åŠ¨ï¼Œéœ€è¦æå‰å£°æ˜æƒé™</li>
<li>ä¸èƒ½åŠ è½½è¿œç¨‹ä»£ç ï¼Œ<code>script</code>æ ‡ç­¾ï¼Œ<code>eval</code>ç­‰</li>
<li>å¤šåœºæ™¯æ”¯æŒ<code>Promise</code>è°ƒç”¨</li>
</ul>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.chrome.com%2Fdocs%2Fextensions%2Fmv3%2Fintro%2Fmv3-overview%2F" target="_blank" rel="nofollow noopener noreferrer" title="https://developer.chrome.com/docs/extensions/mv3/intro/mv3-overview/" ref="nofollow noopener noreferrer">æ–‡æ¡£é“¾æ¥</a></p>
<p>V3å’ŒV2çš„å¯¹æ¯”ï¼ˆä¸ªäººè§‚ç‚¹ï¼‰</p>
<p>ä¼˜ç‚¹ï¼š</p>
<ol>
<li><strong>éšç§ã€å®‰å…¨</strong>å’Œ<strong>æ€§èƒ½</strong>éƒ½æœ‰æ‰€å¢å¼º</li>
<li>æ›´å¿«çš„å®¡æ ¸æ—¶é—´å’Œæ›´é«˜çš„é€šè¿‡ç‡</li>
</ol>
<p>ç¼ºç‚¹ï¼š</p>
<ol>
<li>æ— æ³•åŠ è½½<strong>è¿œç¨‹ä»£ç </strong>å¯¼è‡´çµæ´»æ€§ä¸‹é™</li>
<li>æƒé™æ§åˆ¶ä¸¥æ ¼ï¼Œå¼€å‘è€…ä¸Šæ‰‹æˆæœ¬å¢åŠ </li>
</ol>
<blockquote>
<p>PSï¼šchrome 88æ‰å¼€å§‹å¯¹v3çš„æ”¯æŒ</p>
</blockquote>
<h2 data-id="heading-3">æŠ€æœ¯æ–¹æ¡ˆ ğŸ§°</h2>
<p>æ—¢ç„¶åº•å±‚çš„æŠ€æœ¯æ ˆæ˜¯å‰ç«¯ä¸‰å‰‘å®¢ï¼Œé‚£ä¹ˆå°±èƒ½è¿ç”¨ç°ä»£å‰ç«¯æŠ€æœ¯æ¥è¿›è¡Œæ„é€ ï¼Œç»è¿‡è°ƒç ”ï¼Œæœ€ç»ˆé€‰æ‹©äº†<code>vite</code> + <code>vue3</code>çš„æ–¹æ¡ˆã€‚</p>
<p>why not webpackï¼Ÿ</p>
<p><code>webpack</code>åœ¨æ„å»ºwebåº”ç”¨çš„æ—¶å€™éå¸¸å¥½ï¼Œæœ‰å¾ˆå¤šæˆç†Ÿçš„è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯åœ¨chromeæ’ä»¶V3ç‰ˆæœ¬çš„åœºæ™¯ä¸‹ä¼šæœ‰ä¸€äº›éº»çƒ¦çš„<strong>è¾¹é™…é—®é¢˜</strong>è¦å¤„ç†ï¼Œå¦‚æœæ˜¯V2ç‰ˆæœ¬çš„æ’ä»¶æˆ‘è¿˜æ˜¯ä¼šæ¨èwebpackï¼Œç´¢æ€§å°±ç›´æ¥ç”¨viteçš„buildæ‰“åŒ…æ›´åŠ <strong>è½»é‡</strong>ã€‚</p>
<h3 data-id="heading-4">vite + vue3</h3>
<ol>
<li>å®‰è£…vite + vue3 + ts</li>
</ol>
<pre><code class="hljs language-css copyable" lang="css">pnpm <span class="hljs-selector-tag">i</span> -D vite typescript vue <span class="hljs-keyword">@vitejs</span>/plugin-vue
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<ol start="2">
<li>è®¾ç½®vite.config.ts</li>
</ol>
<pre><code class="hljs language-php copyable" lang="php">import &#123; defineConfig &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
import Vue <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-vue'</span>
import &#123; resolve &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>

export <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">r</span> = (...args: <span class="hljs-keyword">string</span>[]) => <span class="hljs-title function_ invoke__">resolve</span>(__dirname, <span class="hljs-string">'.'</span>, ...args)

export <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">commonConfig</span> = &#123;
  root: <span class="hljs-title function_ invoke__">r</span>(<span class="hljs-string">'src'</span>),
  plugins: [
    <span class="hljs-title function_ invoke__">Vue</span>()
  ],
&#125;

export <span class="hljs-keyword">default</span> <span class="hljs-title function_ invoke__">defineConfig</span>(&#123;
  ...commonConfig,
  <span class="hljs-attr">build</span>: &#123;
    <span class="hljs-attr">watch</span>: &#123;&#125;,
    <span class="hljs-attr">cssCodeSplit</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">emptyOutDir</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">sourcemap</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">outDir</span>: <span class="hljs-title function_ invoke__">r</span>(<span class="hljs-string">'local'</span>),
    <span class="hljs-attr">rollupOptions</span>: &#123;
      <span class="hljs-attr">input</span>: &#123;
        <span class="hljs-attr">background</span>: <span class="hljs-title function_ invoke__">r</span>(<span class="hljs-string">'src/background/index.ts'</span>),
      &#125;,
      <span class="hljs-attr">output</span>: &#123;
        <span class="hljs-attr">entryFileNames</span>: <span class="hljs-string">'[name]/index.js'</span>,
        <span class="hljs-attr">extend</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">format</span>: <span class="hljs-string">'iife'</span>
      &#125;,
    &#125;,
  &#125;,
&#125;)
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>å¯ä»¥çœ‹åˆ°åœ¨configä¸­ä¸»è¦æ˜¯buildçš„é…ç½®ï¼Œè¿™æ˜¯å› ä¸ºåœ¨è¾“å‡ºç›®æ ‡åº”ç”¨çš„æ—¶å€™æˆ‘ä»¬éœ€è¦ç”ŸæˆçœŸå®å­˜åœ¨çš„æ–‡ä»¶ï¼Œä¸èµ°devæ¨¡å¼ä¸‹çš„koaä»£ç†ï¼Œä¸ºäº†ä¾¿äºå¼€å‘ï¼Œé»˜è®¤å¼€å¯watchï¼Œå¹¶å…³é—­cssä»£ç åˆ†å—ã€‚</p>
<p>è¿™é‡Œç”Ÿæˆäº†ä¸€ä¸ª<code>background/index.js</code>æ–‡ä»¶ï¼Œä¸»è¦çš„ä½œç”¨åé¢ä¼šè¯¦ç»†ä»‹ç»ã€‚</p>
<ol start="3">
<li>å†åŠ ä¸ªvite.content.config.ts</li>
</ol>
<pre><code class="hljs language-php copyable" lang="php">import &#123; defineConfig &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
import &#123; r, commonConfig &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'./vite.config'</span>
import &#123; replaceCodePlugin &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'vite-plugin-replace'</span>


<span class="hljs-comment">// bundling the content script</span>
export <span class="hljs-keyword">default</span> <span class="hljs-title function_ invoke__">defineConfig</span>(&#123;
  ...commonConfig,
  <span class="hljs-attr">build</span>: &#123;
    <span class="hljs-attr">watch</span>: &#123;&#125;,
    <span class="hljs-attr">cssCodeSplit</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">emptyOutDir</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">sourcemap</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">outDir</span>: <span class="hljs-title function_ invoke__">r</span>(<span class="hljs-string">'local/contentScript'</span>),
    <span class="hljs-attr">rollupOptions</span>: &#123;
      <span class="hljs-attr">input</span>: &#123;
        <span class="hljs-attr">contentScript</span>: <span class="hljs-title function_ invoke__">r</span>(<span class="hljs-string">'src/contentScript/index.ts'</span>),
      &#125;,
      <span class="hljs-attr">output</span>: &#123;
        <span class="hljs-attr">assetFileNames</span>: <span class="hljs-string">'[name].[ext]'</span>,
        <span class="hljs-attr">entryFileNames</span>: <span class="hljs-string">'index.js'</span>,
        <span class="hljs-attr">extend</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">format</span>: <span class="hljs-string">'iife'</span>
      &#125;,
    &#125;,
  &#125;
&#125;)
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>è¿™ä¸ªé…ç½®ä¸»è¦æ˜¯ä¸ºäº†å•ç‹¬è¾“å‡º<code>contentScript/index.js</code>æ–‡ä»¶ï¼Œæ˜¯æ’ä»¶æ³¨å…¥é¡µé¢çš„ä¸€æ®µjsæ–‡ä»¶ã€‚</p>
<p>åœ¨æ¨¡æ¿ä»“åº“é‡Œ<code>contentScript</code>å¯¹åº”çš„åŠŸèƒ½å°±å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåœ¨æ‰€æœ‰é¡µé¢çš„å³ä¸Šè§’å¢åŠ ä¸€ä¸ªå…·å¤‡å¼¹çª—çš„æŒ‰é’®ã€‚</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1eda27ae87f24d849f0f3123a570a6b1~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<ol start="4">
<li>tsconfigé…ç½®å¦‚ä¸‹</li>
</ol>
<pre><code class="hljs language-json copyable" lang="json"><span class="hljs-punctuation">&#123;</span>
  <span class="hljs-attr">"compilerOptions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
    <span class="hljs-attr">"baseUrl"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"."</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ESNext"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"target"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"es2016"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"lib"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"DOM"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"ESNext"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"strict"</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">false</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"esModuleInterop"</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"incremental"</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">false</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"skipLibCheck"</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"jsx"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"preserve"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"moduleResolution"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"resolveJsonModule"</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"noUnusedLocals"</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"forceConsistentCasingInFileNames"</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">true</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"types"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-string">"vite/client"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"element-plus/global"</span>
    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"paths"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span>
      <span class="hljs-attr">"~/*"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"src/*"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">&#125;</span>
  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"exclude"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"dist"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"node_modules"</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">&#125;</span>
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>é¢å¤–å¼•äº†<code>vite</code>å’Œ<code>element-plus</code>çš„typeå®šä¹‰</p>
<ol start="5">
<li>ç›‘å¬manifest.json + é™æ€æ–‡ä»¶</li>
</ol>
<pre><code class="hljs language-scss copyable" lang="scss">const fs = <span class="hljs-built_in">require</span>('fs-extra')
const chokidar = <span class="hljs-built_in">require</span>('chokidar')
const path = <span class="hljs-built_in">require</span>('path')
const &#123; resolve &#125; = path

const r = (rootPath) => <span class="hljs-built_in">resolve</span>(__dirname, '..', rootPath)

const origin = &#123;
  manifest: r(<span class="hljs-string">'src/manifest.json'</span>),
  assets: r(<span class="hljs-string">'src/assets'</span>)
&#125;

const target = &#123;
  manifest: r(<span class="hljs-string">'local/manifest.json'</span>),
  assets: r(<span class="hljs-string">'local/assets'</span>)
&#125;

const copuManifest = () => &#123;
  fs<span class="hljs-selector-class">.copy</span>(origin.manifest, target.manifest)
&#125;

<span class="hljs-built_in">copuManifest</span>()

const copyAssets = () => &#123;
  fs<span class="hljs-selector-class">.copy</span>(origin.assets, target.assets)
&#125;

<span class="hljs-built_in">copyAssets</span>()

<span class="hljs-comment">// ç›‘å¬æ–‡ä»¶å˜åŒ–ï¼ŒåŒæ­¥è‡³æ’ä»¶æ ¹ç›®å½•</span>
chokidar<span class="hljs-selector-class">.watch</span>([origin.manifest])
  <span class="hljs-selector-class">.on</span>('change', () => &#123;
    <span class="hljs-built_in">copuManifest</span>()
  &#125;)
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>è¿™ä¸ªè„šæœ¬ä¼šç›‘å¬<code>mainifest.json</code>æ–‡ä»¶ï¼Œæœ‰å˜åŒ–å°±copyè¿›ç›®æ ‡ç›®å½•ä¸‹ï¼ŒåŒæ—¶ä¹ŸæŠŠassetsé‡Œçš„é™æ€æ–‡ä»¶å¤åˆ¶è¿‡å»ã€‚</p>
<p><code>chokidar</code>ï¼šè½»é‡è·¨å¹³å°æ–‡ä»¶ç›‘å¬å·¥å…·</p>
<p><code>fs-extra</code>ï¼šnode-fsåŒ…çš„æ‰©å±•</p>
<h3 data-id="heading-5">åˆæ­¥æ¶æ„</h3>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/23b251de766341208d0a4d180969ca4f~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>ç›®å‰åˆæ­¥çš„æ¶æ„å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä¼šåˆ©ç”¨<code>npm-run-all</code>åŒæ—¶å¯åŠ¨ä¸‰ä¸ªè¿›ç¨‹è¿è¡Œï¼š</p>
<ol>
<li>ç›‘å¬éƒ¨åˆ†é™æ€æ–‡ä»¶å˜åŒ–ï¼Œç›´æ¥copyè¿›ç›®æ ‡ç›®å½•</li>
<li><code>vite.config.ts</code>é»˜è®¤è¾“å‡ºbackgroudn å’Œ popupç›¸å…³</li>
<li><code>vite.content.config.ts</code>å•ç‹¬å¤„ç†contentScriptsï¼ˆæœ‰ä¸€äº›å‘ä¸‹é¢ä¼šæåˆ°ï¼‰</li>
</ol>
<p>ä¸ºäº†æ›´å¥½ç†è§£ä»“åº“ï¼Œè´´ä¸Špackage.jsonæ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-perl copyable" lang="perl">&#123;
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"vite-crx-template"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"0.0.1"</span>,
  <span class="hljs-string">"description"</span>: <span class="hljs-string">"Simple Chrome Extension Vite Starter Template"</span>,
  <span class="hljs-string">"scripts"</span>: &#123;
    <span class="hljs-string">"dev"</span>: <span class="hljs-string">"npm run clear && run-p dev:*"</span>,
    <span class="hljs-string">"dev:code"</span>: <span class="hljs-string">"vite build"</span>,
    <span class="hljs-string">"dev:content"</span>: <span class="hljs-string">"vite build --config vite.content.config.ts"</span>,
    <span class="hljs-string">"dev:json"</span>: <span class="hljs-string">"node scripts/monitor.js"</span>,
    <span class="hljs-string">"clear"</span>: <span class="hljs-string">"rimraf local"</span>
  &#125;,
  <span class="hljs-string">"author"</span>: <span class="hljs-string">"TinssonTai"</span>,
  <span class="hljs-string">"devDependencies"</span>: &#123;
    <span class="hljs-string">"@types/node"</span>: <span class="hljs-string">"^18.7.17"</span>,
    <span class="hljs-string">"@vitejs/plugin-vue"</span>: <span class="hljs-string">"^3.1.0"</span>,
    <span class="hljs-string">"chokidar"</span>: <span class="hljs-string">"^3.5.3"</span>,
    <span class="hljs-string">"fs-extra"</span>: <span class="hljs-string">"^10.1.0"</span>,
    <span class="hljs-string">"npm-run-all"</span>: <span class="hljs-string">"^4.1.5"</span>,
    <span class="hljs-string">"rimraf"</span>: <span class="hljs-string">"^3.0.2"</span>,
    <span class="hljs-string">"typescript"</span>: <span class="hljs-string">"^4.8.3"</span>,
    <span class="hljs-string">"vite"</span>: <span class="hljs-string">"^3.1.0"</span>,
    <span class="hljs-string">"vite-plugin-replace"</span>: <span class="hljs-string">"^0.1.1"</span>,
    <span class="hljs-string">"vue"</span>: <span class="hljs-string">"^3.2.39"</span>
  &#125;,
  <span class="hljs-string">"dependencies"</span>: &#123;
    <span class="hljs-string">"element-plus"</span>: <span class="hljs-string">"^2.2.16"</span>
  &#125;
&#125;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<h2 data-id="heading-6">é‡å‘ ğŸš§</h2>
<h3 data-id="heading-7">Cssæ ·å¼å†²çª</h3>
<p><code>contentScript</code>å¯ä»¥ç†è§£ä¸ºæ’ä»¶æ³¨å…¥åˆ°é¡µé¢çš„ä¸€æ®µjsï¼Œå¦‚æœæƒ³è¦å†™ä¸€äº›åŠŸèƒ½è‚¯å®šä¼šæ¶‰åŠåˆ°cssæ ·å¼ï¼Œæ¯”å¦‚ä¸Šé¢æåˆ°çš„æŒ‰é’®å¼¹çª—ã€‚</p>
<p>å¦‚æœç›´æ¥åœ¨bodyåº•ä¸‹æ³¨å…¥ä¸€æ®µdivæ˜¯æœ‰å¯èƒ½è¢«é¡µé¢åŸæœ¬çš„<strong>å…¨å±€æ ·å¼</strong>å½±å“çš„ï¼Œæ¯”å¦‚é¡µé¢é‡Œçš„cssç›´æ¥ä½œç”¨äºbodyä¸‹æ‰€æœ‰å…ƒç´ ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆï¼š</p>
<p>åˆ©ç”¨<code>shadow DOM</code>çš„<strong>æ ·å¼éš”ç¦»</strong>æ¥é¿å…å…¨å±€æ ·å¼æ±¡æŸ“ï¼Œå¯ä»¥æŠŠ<code>shadow DOM</code>è§†ä¸ºâ€œDOMä¸­çš„DOMâ€ï¼Œå†…å±‚domå®Œå…¨æ˜¯ç‹¬ç«‹çš„æ ·å¼ç©ºé—´ã€‚</p>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-keyword">import</span> &#123; createApp &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ElementPlus</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'element-plus'</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'element-plus/dist/index.css'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>

(<span class="hljs-function">() =></span> &#123;
  <span class="hljs-keyword">const</span> container = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>)
  <span class="hljs-keyword">const</span> root = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>)
  <span class="hljs-keyword">const</span> styleEl = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'link'</span>)
  <span class="hljs-keyword">const</span> shadowDOM = container.<span class="hljs-property">attachShadow</span>?.(&#123; <span class="hljs-attr">mode</span>: <span class="hljs-string">'open'</span> &#125;) || container
  styleEl.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'rel'</span>, <span class="hljs-string">'stylesheet'</span>)
  styleEl.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'href'</span>, chrome.<span class="hljs-property">runtime</span>.<span class="hljs-title function_">getURL</span>(<span class="hljs-string">'contentScript/style.css'</span>))
  shadowDOM.<span class="hljs-title function_">appendChild</span>(styleEl)
  shadowDOM.<span class="hljs-title function_">appendChild</span>(root)
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(container)

  <span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)
  app.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">ElementPlus</span>)
  app.<span class="hljs-title function_">mount</span>(root)
&#125;)()
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>ä¸Šé¢ä»£ç å°±æ˜¯æŠŠvue3åˆ›å»ºå‡ºæ¥çš„Appå®ä¾‹æŒ‚è½½åœ¨<code>shadow DOM</code>ä¸‹ã€‚</p>
<h3 data-id="heading-8">:rootä¸‹colorå˜é‡varä¸ç”Ÿæ•ˆ</h3>
<p>é€šè¿‡ä¸Šè¿°çš„ä»£ç jymä¼šå‘ç°å¼•å…¥äº†<code>ElementPlus</code>ï¼Œè¿™æ—¶å€™å¦‚æœç›´æ¥ç”¨çš„è¯ï¼Œä¼šå‡ºç°ä¸‹å›¾çš„æƒ…å†µï¼Œé¢œè‰²å˜é‡å®Œå…¨ä¸ç”Ÿæ•ˆ</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d17eef246ce1408eace1c8ca57a049d9~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>åŸå› ï¼š</p>
<p>æ‰“åŒ…å‡ºæ¥çš„css é¢œè‰²å˜é‡å…¶å®æ˜¯æŒ‚è½½åœ¨<code>:root</code>ä¸‹ï¼Œè¿™ä¸ªå¯ä»¥ç†è§£æ˜¯é¡µé¢çš„æ ¹èŠ‚ç‚¹ï¼Œä½†æ˜¯å¤„äºshadow DOMæ ·å¼éš”ç¦»çš„æƒ…å†µä¸‹æ— æ³•ç”Ÿæ•ˆã€‚</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/aa85f913e0804c54878195bf4bb7a4cf~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>è§£å†³æ–¹æ¡ˆï¼š</p>
<p>æŠŠæ‰€æœ‰<code>:root</code>æ›¿æ¢æˆ<code>:host</code> å°±èƒ½æ”¹å˜cssé¢œè‰²å˜é‡çš„æŒ‚è½½èŠ‚ç‚¹ï¼Œè¿™æ—¶å€™åœ¨viteçš„configæ–‡ä»¶ä¸‹å¢åŠ ä¸€ä¸ªreplaceæ’ä»¶è¿›è¡Œ<strong>å…¨å±€æ›¿æ¢</strong></p>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-keyword">import</span> &#123; defineConfig &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> &#123; replaceCodePlugin &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'vite-plugin-replace'</span>


<span class="hljs-comment">// bundling the content script</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(&#123;
  ...commonConfig,
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-title function_">replaceCodePlugin</span>(&#123;
      <span class="hljs-attr">replacements</span>: [
        &#123;
          <span class="hljs-attr">from</span>: <span class="hljs-regexp">/:root&#123;/g</span>,
          <span class="hljs-attr">to</span>: <span class="hljs-string">':host&#123;'</span>
        &#125;
      ]
    &#125;)
  ]
&#125;)
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>æœ€åè´´ä¸Šå½“å‰æ¨¡æ¿çš„gitä»“åº“ï¼š</p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2FTinsson%2Fvite-crx-template" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/Tinsson/vite-crx-template" ref="nofollow noopener noreferrer">github.com/Tinsson/vitâ€¦</a></p>
<h2 data-id="heading-9">ç»“è¯­</h2>
<p>ç›®å‰chromeæ’ä»¶v3ç‰ˆæœ¬çš„æ–‡ç« ä¸æ˜¯å¾ˆå¤šï¼Œæœ‰å¾ˆå¤šå‘éœ€è¦å»è¸©ï¼Œæœ¬ç³»åˆ—ä¹Ÿä¼šæŒç»­æ›´æ–°ï¼Œæ¨¡æ¿ä»“åº“æä¾›çš„èƒ½åŠ›ä¹Ÿä¼šè·Ÿç€æ–‡ç« æŒç»­è¿­ä»£ã€‚</p>
<p>åˆ›é€ ä¸æ˜“ï¼Œå¸Œæœ›jymå¤šå¤š ç‚¹èµ + å…³æ³¨ äºŒè¿ï¼ŒæŒç»­æ›´æ–°ä¸­ï¼ï¼ï¼</p>
<p>PS: æ–‡ä¸­æœ‰ä»»ä½•é”™è¯¯ï¼Œæ¬¢è¿jymæŒ‡æ­£</p>
<p>å¾€æœŸç²¾å½©ğŸ“Œ</p>
<ul>
<li><a href="https://juejin.cn/post/7139686780143403039" target="_blank" title="https://juejin.cn/post/7139686780143403039">å‰ç«¯å·¥å…·å°æŒ‡å—ä¹‹Prettier</a>âœ¨</li>
<li><a href="https://juejin.im/post/6877546408925200391" target="_blank" title="https://juejin.im/post/6877546408925200391">Reactè°ƒè¯•åˆ©å™¨ï¼šReact DevTools</a> âœ¨</li>
<li><a href="https://juejin.im/post/6875713523968802829" target="_blank" title="https://juejin.im/post/6875713523968802829">Vue3æ‹¥æŠ±TypeScriptçš„æ­£ç¡®å§¿åŠ¿</a> âœ¨</li>
</ul>
<p>å‚è€ƒï¼š</p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fantfu%2Fvitesse-webext" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/antfu/vitesse-webext" ref="nofollow noopener noreferrer">github.com/antfu/vitesâ€¦</a></p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fsegmentfault.com%2Fa%2F1190000017970486" target="_blank" rel="nofollow noopener noreferrer" title="https://segmentfault.com/a/1190000017970486" ref="nofollow noopener noreferrer">segmentfault.com/a/119000001â€¦</a></p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fcn.vitejs.dev%2Fconfig%2Fbuild-options.html" target="_blank" rel="nofollow noopener noreferrer" title="https://cn.vitejs.dev/config/build-options.html" ref="nofollow noopener noreferrer">cn.vitejs.dev/config/builâ€¦</a></p></div>  
</div>
            