
---
title: '数值千分位，6种方法和性能对比，值得一看'
categories: 
 - 编程
 - 掘金
 - 分类
headimg: 'https://picsum.photos/400/300?random=4556'
author: 掘金
comments: false
date: Fri, 27 Aug 2021 17:18:17 GMT
thumbnail: 'https://picsum.photos/400/300?random=4556'
---

<div>   
<div class="markdown-body html cache"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><h2 data-id="heading-0">前提</h2>
<p>前端嘛，经常处理数值和时间。 所以数值和时间的格式化少不了。<br>
最近一直在面试前端， 就出了一个如何给数值添加千分位的面试题。</p>
<p>至于答案，， 一是基于你现有的知识实现， 二是知识面。
有人说， 不就一个千分位， 分分钟解决你， 正则万岁。  没错， 正则很帅， 那么性能呢？</p>
<p>我就喜欢一本正紧的瞎掰。  好了， 进入正文。</p>
<h2 data-id="heading-1">实现</h2>
<p>如下有的方法，稍微改造，就可以变成更加通用的方法，比如不是添加,而是添加#等等。</p>
<h3 data-id="heading-2">数值转字符串遍历</h3>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">format_with_array</span>(<span class="hljs-params">number</span>) </span>&#123;
    <span class="hljs-keyword">var</span> arr = (number + <span class="hljs-string">''</span>).split(<span class="hljs-string">'.'</span>);
    <span class="hljs-keyword">var</span> int = arr[<span class="hljs-number">0</span>].split(<span class="hljs-string">''</span>);
    <span class="hljs-keyword">var</span> fraction = arr[<span class="hljs-number">1</span>] || <span class="hljs-string">''</span>;
    <span class="hljs-keyword">var</span> r = <span class="hljs-string">""</span>;
    <span class="hljs-keyword">var</span> len = int.length;
    int.reverse().forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">v, i</span>) </span>&#123;
        <span class="hljs-keyword">if</span> (i !== <span class="hljs-number">0</span> && i % <span class="hljs-number">3</span> === <span class="hljs-number">0</span>) &#123;
            r = v + <span class="hljs-string">","</span> + r;
        &#125; <span class="hljs-keyword">else</span> &#123;
            r = v + r;
        &#125;
    &#125;)
    <span class="hljs-keyword">return</span> r + (!!fraction ? <span class="hljs-string">"."</span> + fraction : <span class="hljs-string">''</span>);
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<h3 data-id="heading-3">substring</h3>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">format_with_substring</span>(<span class="hljs-params">number</span>) </span>&#123;
    <span class="hljs-keyword">var</span> arr = (number + <span class="hljs-string">''</span>).split(<span class="hljs-string">'.'</span>);
    <span class="hljs-keyword">var</span> int = arr[<span class="hljs-number">0</span>] + <span class="hljs-string">''</span>;
    <span class="hljs-keyword">var</span> fraction = arr[<span class="hljs-number">1</span>] || <span class="hljs-string">''</span>;
    <span class="hljs-keyword">var</span> f = int.length % <span class="hljs-number">3</span>;
    <span class="hljs-keyword">var</span> r = int.substring(<span class="hljs-number">0</span>, f);

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i < <span class="hljs-built_in">Math</span>.floor(int.length / <span class="hljs-number">3</span>); i++) &#123;
        r += <span class="hljs-string">','</span> + int.substring(f + i * <span class="hljs-number">3</span>, f + (i + <span class="hljs-number">1</span>) * <span class="hljs-number">3</span>)
    &#125;

    <span class="hljs-keyword">if</span> (f === <span class="hljs-number">0</span>) &#123;
        r = r.substring(<span class="hljs-number">1</span>);
    &#125;
    <span class="hljs-keyword">return</span> r + (!!fraction ? <span class="hljs-string">"."</span> + fraction : <span class="hljs-string">''</span>);
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<h3 data-id="heading-4">除法+求模</h3>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">format_with_mod</span>(<span class="hljs-params">number</span>) </span>&#123;
    <span class="hljs-keyword">var</span> n = number;
    <span class="hljs-keyword">var</span> r = <span class="hljs-string">""</span>; 
    <span class="hljs-keyword">var</span> temp;
    <span class="hljs-keyword">do</span> &#123;
        mod = n % <span class="hljs-number">1000</span>;
        n = n / <span class="hljs-number">1000</span>;
        temp = ~~mod;
        r =  (n > <span class="hljs-number">1</span> ?<span class="hljs-string">`<span class="hljs-subst">$&#123;temp&#125;</span>`</span>.padStart(<span class="hljs-number">3</span>, <span class="hljs-string">"0"</span>): temp) + (!!r ? <span class="hljs-string">","</span> + r : <span class="hljs-string">""</span>)
    &#125; <span class="hljs-keyword">while</span> (n > <span class="hljs-number">1</span>)

    <span class="hljs-keyword">var</span> strNumber = number + <span class="hljs-string">""</span>;
    <span class="hljs-keyword">var</span> index = strNumber.indexOf(<span class="hljs-string">"."</span>);
    <span class="hljs-keyword">if</span> (index > <span class="hljs-number">0</span>) &#123;
        r += strNumber.substring(index);
    &#125;
    <span class="hljs-keyword">return</span> r;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<h3 data-id="heading-5">正则</h3>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">format_with_regex</span>(<span class="hljs-params">number</span>) </span>&#123;
    <span class="hljs-keyword">var</span> reg = <span class="hljs-regexp">/\d&#123;1,3&#125;(?=(\d&#123;3&#125;)+$)/g</span>;
    <span class="hljs-keyword">return</span> (number + <span class="hljs-string">''</span>).replace(reg, <span class="hljs-string">'$&,'</span>);
&#125;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">format_with_regex</span>(<span class="hljs-params">number</span>) </span>&#123;
    <span class="hljs-keyword">var</span> reg = <span class="hljs-regexp">/(\d)(?=(?:\d&#123;3&#125;)+$)/g</span>   
    <span class="hljs-keyword">return</span> (number + <span class="hljs-string">''</span>).replace(reg, <span class="hljs-string">'$1,'</span>);
&#125;

<span class="copy-code-btn">复制代码</span></code></pre>
<h3 data-id="heading-6">toLocaleString</h3>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">format_with_toLocaleString</span>(<span class="hljs-params">number, minimumFractionDigits, maximumFractionDigits</span>) </span>&#123;
    minimumFractionDigits = minimumFractionDigits || <span class="hljs-number">2</span>;
    maximumFractionDigits = (maximumFractionDigits || <span class="hljs-number">2</span>);
    maximumFractionDigits = <span class="hljs-built_in">Math</span>.max(minimumFractionDigits, maximumFractionDigits);

    <span class="hljs-keyword">return</span> number.toLocaleString(<span class="hljs-string">"en-us"</span>, &#123;
        <span class="hljs-attr">maximumFractionDigits</span>: maximumFractionDigits || <span class="hljs-number">2</span>,
        <span class="hljs-attr">minimumFractionDigits</span>: minimumFractionDigits || <span class="hljs-number">2</span>
    &#125;)
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<h3 data-id="heading-7">Intl.NumberFormat</h3>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">format_with_Intl</span>(<span class="hljs-params">number, minimumFractionDigits, maximumFractionDigits</span>) </span>&#123;
    minimumFractionDigits = minimumFractionDigits || <span class="hljs-number">2</span>;
    maximumFractionDigits = (maximumFractionDigits || <span class="hljs-number">2</span>);
    maximumFractionDigits = <span class="hljs-built_in">Math</span>.max(minimumFractionDigits, maximumFractionDigits);

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Intl</span>.NumberFormat(<span class="hljs-string">'en-us'</span>, &#123;
        <span class="hljs-attr">maximumFractionDigits</span>: maximumFractionDigits || <span class="hljs-number">2</span>,
        <span class="hljs-attr">minimumFractionDigits</span>: minimumFractionDigits || <span class="hljs-number">2</span>
    &#125;).format(number)
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<h2 data-id="heading-8">性能</h2>
<p>测试地址： <a href="https://link.juejin.cn/?target=https%3A%2F%2Fxiangwenhu.github.io%2FjuejinBlogsCodes%2F%25E5%258D%2583%25E5%2588%2586%25E4%25BD%258D.html" target="_blank" rel="nofollow noopener noreferrer" title="https://xiangwenhu.github.io/juejinBlogsCodes/%E5%8D%83%E5%88%86%E4%BD%8D.html" ref="nofollow noopener noreferrer">千分位性能测试</a><br>
准备性能测试的代码, 为了测试带小数位和不带小数位，在getData的时候，如果随机值大于0.5, 将去除小数位。</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getData</span>(<span class="hljs-params">count</span>) </span>&#123;
    <span class="hljs-keyword">var</span> data = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(count).fill(<span class="hljs-number">0</span>).map(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">i</span>) </span>&#123;
        <span class="hljs-keyword">var</span> rd = <span class="hljs-built_in">Math</span>.random();
        <span class="hljs-keyword">var</span> r = rd * <span class="hljs-built_in">Math</span>.pow(<span class="hljs-number">10</span>, <span class="hljs-number">10</span>);
        <span class="hljs-keyword">if</span> (rd > <span class="hljs-number">0.5</span>) &#123;
            r = ~~r;
        &#125;
        <span class="hljs-keyword">return</span> r
    &#125;)
    <span class="hljs-keyword">return</span> data;
&#125;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">test</span>(<span class="hljs-params">data, fn, label</span>) </span>&#123;
    <span class="hljs-keyword">var</span> start = performance.now();
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i < data.length; i++) &#123;
        fn(data[i]);
    &#125;
    <span class="hljs-keyword">var</span> time = performance.now() - start;

    message((fn.name || label) + <span class="hljs-string">":"</span> + time + <span class="hljs-string">"ms"</span>);
&#125;


<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">executeTest</span>(<span class="hljs-params"></span>) </span>&#123;
    <span class="hljs-keyword">var</span> data = getData(+textCount.value);
    test(data, format_with_array);
    test(data, format_with_mod);
    test(data, format_with_substring);
    test(data, format_with_regex);
    test(data, format_with_toLocaleString);
    test(data, format_with_Intl);
&#125;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">message</span>(<span class="hljs-params">msg</span>) </span>&#123;
    <span class="hljs-keyword">var</span> el = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">"p"</span>);
    el.innerHTML = msg;
    messageEl.appendChild(el);
&#125;

<span class="copy-code-btn">复制代码</span></code></pre>
<p>测试数据50000</p>
<p><strong>1. chrome 版本 74.0.3729.131（正式版本） （32 位）</strong></p>
<p>format_with_array:59.13ms</p>
<p>format_with_mod:23.96ms</p>
<p>format_with_substring:44.04ms</p>
<p>format_with_regex:53.54ms</p>
<p>format_with_toLocaleString:1813.61ms</p>
<p>format_with_Intl:1973.45ms</p>
<p><strong>2. 360极速浏览器11.0.2052.0</strong><br>
极速模式</p>
<p>format_with_array:63.30ms</p>
<p>format_with_mod:37.80ms</p>
<p>format_with_substring:41.40ms</p>
<p>format_with_regex:51.20ms</p>
<p>format_with_toLocaleString:3334.30ms</p>
<p>format_with_Intl:3485.80ms</p>
<p>兼容模式不支持 Array.fill Pass</p>
<p><strong>3. 搜狗高速浏览器 8.5.10.30358</strong></p>
<p>format_with_array:75.29ms</p>
<p>format_with_mod:35.47ms</p>
<p>format_with_substring:40.79ms</p>
<p>format_with_regex:49.86ms</p>
<p>format_with_toLocaleString:2418.04ms</p>
<p>format_with_Intl:2474.30ms</p>
<p><strong>4. firefox 66.0.3</strong></p>
<p>format_with_array:41.00ms</p>
<p>format_with_mod:25.00ms</p>
<p>format_with_substring:28.00ms</p>
<p>format_with_regex:43.00ms</p>
<p>format_with_toLocaleString:1799.00ms</p>
<p>format_with_Intl:2239.00ms</p>
<p>基本的结果都是一致的， 因为随机数不一样，结果也会偶尔不一致。</p>
<p>format_with_mod > format_with_substring >  format_with_regex > format_with_array >  format_with_toLocaleString > format_with_Intl</p>
<p>其中Intl.NumberFormat是有很大提升空间的，可以把实例缓存之类的。</p>
<p><strong>当然，测试可能不严谨，问题不大，知道有这么几种思路就行，还有哪些思路呢？ 欢迎留言。</strong></p>
<h2 data-id="heading-9">写在最后</h2>
<p>如果你觉得不错，你的一赞一评就是我前行的最大动力。</p>
<p><strong>技术交流群请到 <a href="https://juejin.cn/pin/6994350401550024741" title="https://juejin.cn/pin/6994350401550024741" target="_blank">这里来</a>。
或者添加我的微信 dirge-cloud，一起学习。</strong></p></div>  
</div>
            