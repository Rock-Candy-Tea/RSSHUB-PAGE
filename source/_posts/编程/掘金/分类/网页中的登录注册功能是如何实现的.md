
---
title: '网页中的登录注册功能是如何实现的'
categories: 
 - 编程
 - 掘金
 - 分类
headimg: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0ca16120227f4a05910543dcc081cdf8~tplv-k3u1fbpfcp-zoom-1.image'
author: 掘金
comments: false
date: Tue, 13 Apr 2021 19:27:04 GMT
thumbnail: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0ca16120227f4a05910543dcc081cdf8~tplv-k3u1fbpfcp-zoom-1.image'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><p><strong>摘要</strong>：登录注册是一个网站最常用的也是最基本的功能，本文就来详细的介绍一下在网页中，实现这两个最基本的需求从后端到前端需要做些什么。</p>
<p>注：本文所提到的所有代码都已上传至<a href="https://github.com/dreamqyq/ServerTest" target="_blank" rel="nofollow noopener noreferrer">github</a> ，可以直接clone后在终端使用测试。</p>
<h2 data-id="heading-0">一、前置知识：</h2>
<ul>
<li>
<p>基础知识可见我之前的博客：<a href="https://www.jianshu.com/p/109de7b74813" target="_blank" rel="nofollow noopener noreferrer">HTTP入门（请求与响应的基本知识）</a> 。首先我们至少需要了解HTTP最基本的<strong>request请求</strong>和<strong>response响应</strong>的相关概念。</p>
</li>
<li>
<p>再看一下服务端和客户端之间的交互，如下图：</p>
</li>
</ul>
<p><img alt class="lazyload" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0ca16120227f4a05910543dcc081cdf8~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<p>用文字描述一下：</p>
<ol>
<li>客户端（即浏览器）向服务端发起request请求</li>
<li>服务端通过监听80端口（http）或443端口（https）来接收请求</li>
<li>服务端接收请求后进行相关处理</li>
<li>服务端向客户端发response响应。</li>
<li>客户端接收response响应，完成一次交互。</li>
</ol>
<ul>
<li>需要了解用JS如何向服务端发请求，举个例子：</li>
</ul>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">let</span> xhr = <span class="hljs-keyword">new</span> XMLHttpRequest()
xhr.open(<span class="hljs-string">'POST'</span>,<span class="hljs-string">'/'</span>)
xhr.setRequestHeader(<span class="hljs-string">'content-type'</span>,<span class="hljs-string">'x-www-form-urlencoded'</span>)  <span class="hljs-comment">// 设置请求头</span>
xhr.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;
  <span class="hljs-keyword">if</span>(request.readyState === <span class="hljs-number">4</span>)&#123; <span class="hljs-comment">// 整个请求过程已完成</span>
    <span class="hljs-keyword">if</span>(request.status >=<span class="hljs-number">200</span> && request.status < <span class="hljs-number">400</span>)&#123; <span class="hljs-comment">// 状态码在200到400之间，说明请求成功</span>
      successFn.call(<span class="hljs-literal">undefined</span>,request.responseText) <span class="hljs-comment">//调用成功函数</span>
    &#125;<span class="hljs-keyword">else</span>&#123;
      failFn.call(<span class="hljs-literal">undefined</span>,request.status) <span class="hljs-comment">// 调用失败函数</span>
    &#125;
  &#125; 
&#125;
xhr.send(body) <span class="hljs-comment">// 发送请求体</span>
<span class="copy-code-btn">复制代码</span></code></pre>
<ul>
<li>需要知道后端如何发出响应（Nodejs实现）</li>
</ul>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-comment">// 注：Nodejs中没有path、method、response这三个api，需要另外获取</span>
<span class="hljs-comment">// 这里的代码旨在我们了解后端需要做的事情，不用深入研究</span>
<span class="hljs-keyword">if</span>(path === <span class="hljs-string">'/'</span> && method === <span class="hljs-string">'GET'</span>)&#123;
    <span class="hljs-keyword">var</span> string = fs.readFileSync(<span class="hljs-string">'./index.html'</span>,<span class="hljs-string">'utf-8'</span>) <span class="hljs-comment">// 读取服务端文件</span>
    response.statusCode = <span class="hljs-number">200</span> <span class="hljs-comment">// 设置响应状态码</span>
    response.setHeader(<span class="hljs-string">'Content-Type'</span>,<span class="hljs-string">'text/html;charset=utf-8'</span>) <span class="hljs-comment">// 设置响应头</span>
    response.write(string) <span class="hljs-comment">// 设置响应体</span>
    response.end() <span class="hljs-comment">// 本次响应结束</span>
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<h2 data-id="heading-1">二、注册具体流程</h2>
<h4 data-id="heading-2">1、首先前端需要做一个注册的页面</h4>
<p>像这样：
<img alt class="lazyload" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f0160252d8444500b279fbd82b9c944a~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<h4 data-id="heading-3">2、然后前端需要在用户提交数据后，获取到这些数据</h4>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">let</span> $form = $(<span class="hljs-string">'#register-form'</span>)
$form.on(<span class="hljs-string">'submit'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>&#123;
  e.preventDefault() <span class="hljs-comment">// 阻止默认事件，因为form的submit事件默认会刷新页面</span>
  <span class="hljs-keyword">let</span> hash = &#123;&#125;
  <span class="hljs-keyword">let</span> need = [<span class="hljs-string">'email'</span>, <span class="hljs-string">'password'</span>, <span class="hljs-string">'repassword'</span>]
  need.forEach(<span class="hljs-function">(<span class="hljs-params">name</span>) =></span> &#123; <span class="hljs-comment">// 通过遍历获取表单数据并存到hash里</span>
    <span class="hljs-keyword">let</span> value = $form.find(<span class="hljs-string">`[name=<span class="hljs-subst">$&#123;name&#125;</span>]`</span>).val()
    hash[name] = value
  &#125;)
&#125;)
<span class="copy-code-btn">复制代码</span></code></pre>
<h4 data-id="heading-4">3、前端需要将上一步所获得的数据通过post请求发送给服务端</h4>
<p>（为什么不是get请求呢，主要还是因为post相对来说更安全）</p>
<pre><code class="hljs language-js copyable" lang="js">$.post(<span class="hljs-string">'/register'</span>, hash) <span class="hljs-comment">// 第一个参数与是路径，第二个参数要传给服务端的数据</span>
  .then(<span class="hljs-function">() =></span> &#123;
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'success'</span>)
  &#125;, <span class="hljs-function">() =></span> &#123;
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'error'</span>)
  &#125;)
<span class="copy-code-btn">复制代码</span></code></pre>
<h4 data-id="heading-5">4、后端接收前端发来的请求并从中读取到需要的信息（如传过来的邮箱密码）</h4>
<p><strong>注：实际开发中密码肯定是不能被后台获取到的</strong>，这里只是举例说明整体的流程。</p>
<ul>
<li>得到post请求的数据，Node没有直接读取请求体的api，所以先封装一个函数。（因为客户端向服务端发送post请求传输数据时，实际上是一段一段传的，所以无法直接获取数据。）</li>
</ul>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">readBody</span>(<span class="hljs-params">request</span>)</span>&#123;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>)=></span>&#123;
    <span class="hljs-keyword">let</span> body = [] <span class="hljs-comment">// 请求体</span>
    <span class="hljs-comment">// 监听request的data事件，每接收到一段data，就放到请求体这个哈希表里面</span>
    request.on(<span class="hljs-string">'data'</span>, <span class="hljs-function">(<span class="hljs-params">chunk</span>) =></span> &#123;
      body.push(chunk);
    &#125;).on(<span class="hljs-string">'end'</span>, <span class="hljs-function">() =></span> &#123;
      <span class="hljs-comment">// 当数据全部接收完时，会触发end事件，然后就可以把所有的数据都得到啦</span>
      body = Buffer.concat(body).toString();
      resolve(body)
    &#125;)
  &#125;)
&#125;
<span class="hljs-comment">// 调用上面的函数，得到的请求体类似于这种形式：</span>
<span class="hljs-comment">// email=1&password=2&repassword=3</span>
<span class="copy-code-btn">复制代码</span></code></pre>
<ul>
<li>后端通过上面的函数获得了如：<code>email=1&password=2&repassword=3</code>这样的字符串，然后需要通过<code>split</code>方法将字符串按照所需要的结构解析出来。如：</li>
</ul>
<pre><code class="hljs language-js copyable" lang="js">body =  <span class="hljs-string">'email=1&password=2&repassword=3'</span>
<span class="hljs-keyword">let</span> strings = body.split(<span class="hljs-string">'&'</span>) 
<span class="hljs-comment">// 结果为 ['email=1', 'password=2', 'password_confirmation=3']</span>
<span class="copy-code-btn">复制代码</span></code></pre>
<h4 data-id="heading-6">5、简单的数据校验</h4>
<p>后端拿到数据后，进行简单的数据校验，出错后将错误信息返回给前端，前端进行解释展示给用户。</p>
<ul>
<li>后端简单校验：</li>
</ul>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-comment">// 默认 @ 符号会转义成 %40 ，所以需要decodeURIComponent解码URI</span>
hash[key] = <span class="hljs-built_in">decodeURIComponent</span>(value) 
<span class="hljs-comment">// 然后才可以检测email 中是否存在 @ 符号</span>
<span class="hljs-keyword">if</span> (email.indexOf(<span class="hljs-string">'@'</span>) === -<span class="hljs-number">1</span>) &#123; <span class="hljs-comment">// 邮箱中没有@说明邮箱格式错误</span>
  response.statusCode = <span class="hljs-number">400</span>
  response.setHeader(<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'application/json;charset=utf-8'</span>)
  <span class="hljs-comment">// 如果出错响应体返回JSON对象，前端就可以直接解析</span>
  response.write(<span class="hljs-string">`&#123;
    "errors": &#123;
      "email": "invalid"
    &#125;
  &#125;`</span>)
&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (password !== repassword) &#123; <span class="hljs-comment">// 两次输入的密码不一致</span>
  response.statusCode = <span class="hljs-number">400</span>
  response.write(<span class="hljs-string">'password not match'</span>)
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<ul>
<li>前端解析错误信息展示给用户</li>
</ul>
<pre><code class="hljs language-js copyable" lang="js">$.post(<span class="hljs-string">'/register'</span>, hash)
.then(<span class="hljs-function">(<span class="hljs-params">response</span>)=></span>&#123;
  <span class="hljs-built_in">console</span>.log(response)
&#125;, <span class="hljs-function">(<span class="hljs-params">response</span>)=></span>&#123;
  <span class="hljs-comment">// 获得后端传过来的响应体内容</span>
  <span class="hljs-comment">// 因为响应体一定是字符串，故需要使用JSON.parse将其转换成对象</span>
  <span class="hljs-keyword">let</span> &#123;errors&#125; = <span class="hljs-built_in">JSON</span>.parse(response.responseText)
  <span class="hljs-keyword">if</span>(errors.email && errors.email === <span class="hljs-string">'invalid'</span>)&#123;
    $form.find(<span class="hljs-string">'[name="email"]'</span>).siblings(<span class="hljs-string">'.error'</span>)
    .text(<span class="hljs-string">'邮箱格式错误'</span>)
  &#125;
&#125;)
<span class="copy-code-btn">复制代码</span></code></pre>
<p>效果如下：</p>
<p><img alt class="lazyload" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/87badbf0f2f740148b28da62d6f031f0~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<ul>
<li>当用户没有填信息就提交时，就需要前端进行校验了，这种情况下应该直接提示用户填信息而不用再次给后端发请求：</li>
</ul>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-comment">// 先将所有错误提示清空</span>
$form.find(<span class="hljs-string">'.error'</span>).each(<span class="hljs-function">(<span class="hljs-params">index, span</span>)=></span>&#123;
  $(span).text(<span class="hljs-string">''</span>)
&#125;)
<span class="hljs-comment">// 邮箱、密码和确认密码没有填数据时，如：</span>
<span class="hljs-keyword">if</span>(hash[<span class="hljs-string">'email'</span>] === <span class="hljs-string">''</span>)&#123;
  $form.find(<span class="hljs-string">'[name="email"]'</span>).siblings(<span class="hljs-string">'.error'</span>)
    .text(<span class="hljs-string">'填邮箱呀同学'</span>)
  <span class="hljs-keyword">return</span>
&#125;
<span class="hljs-comment">// 密码和确认密码填写的数据不一致时：</span>
<span class="hljs-keyword">if</span>(hash[<span class="hljs-string">'password'</span>] !== hash[<span class="hljs-string">'repassword'</span>])&#123;
  $form.find(<span class="hljs-string">'[name="repassword"]'</span>).siblings(<span class="hljs-string">'.error'</span>)
    .text(<span class="hljs-string">'密码不匹配'</span>)
  <span class="hljs-keyword">return</span>
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>效果如下：
<img alt class="lazyload" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/162c2ed5351b419e86a40873a8bc3a16~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<ul>
<li>关于前端校验和后端校验</li>
</ul>
<p>看到这里你会发现，其实前端和后端都可以的进行简单的数据校验，但是要注意的是：<strong>前端可以没有表单校验的过程</strong>（当然有一些简单的数据校验更好），但是<strong>后端必须得有数据校验</strong>。主要原因是：<strong>前端的数据校验是很容易被绕过去的</strong>（比如curl 命令可以绕过前端直接向后台发请求），我们不能过于依赖网页中的JS校验，必须得有后台的数据校验来确保数据的安全。</p>
<h4 data-id="heading-7">6、注册成功后将用户数据传到数据库中</h4>
<p><strong>注：实际开发中不能将密码直接传到数据库存储，数据库中应该存的是用户的密码加密后的数据，然后用户如果登录，服务端得到密码，将其加密后再和数据库中的信息做对比</strong>，不过加密操作比较复杂，本文暂时不作演示，使用明文密码来进行操作。</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">var</span> users = fs.readFileSync(<span class="hljs-string">'./database/users'</span>, <span class="hljs-string">'utf8'</span>) <span class="hljs-comment">// 获取数据库中的数据</span>
<span class="hljs-keyword">try</span> &#123;
  users = <span class="hljs-built_in">JSON</span>.parse(users) <span class="hljs-comment">// 将数据库中的数据转换成JSON对象</span>
&#125; <span class="hljs-keyword">catch</span> (exception) &#123; <span class="hljs-comment">// 如果转化失败直接让users等于空数组</span>
  users = []
&#125;
users.push(&#123; <span class="hljs-comment">// 将数据push到数据库中</span>
    <span class="hljs-attr">email</span>: email,
    <span class="hljs-attr">password</span>: password
&#125;)
<span class="hljs-keyword">var</span> usersString = <span class="hljs-built_in">JSON</span>.stringify(users) <span class="hljs-comment">// 将JSON对象字符串化后再进行存储</span>
fs.writeFileSync(<span class="hljs-string">'./database/users'</span>, usersString) <span class="hljs-comment">// 将数据写入数据库</span>
response.statusCode = <span class="hljs-number">200</span>
<span class="copy-code-btn">复制代码</span></code></pre>
<h4 data-id="heading-8">7、后端校验：邮箱是否被注册</h4>
<p>比如某一个邮箱已经被注册了，服务端应该先检索数据库中是否存在该邮箱的账号，若存在，应该提示用户然后阻止用户再次使用相同的邮箱进行注册。</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">let</span> inUse = <span class="hljs-literal">false</span> <span class="hljs-comment">// 声明变量 isUse ，用于表示数组是否被注册过</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i < users.length; i++) &#123;
  <span class="hljs-comment">// 遍历数据库中的原有数据，如果邮箱存在，isUse 为 true</span>
  <span class="hljs-keyword">let</span> user = users[i]
  <span class="hljs-keyword">if</span> (user.email === email) &#123;
    inUse = <span class="hljs-literal">true</span>
    <span class="hljs-keyword">break</span>;
  &#125;
&#125;
<span class="hljs-keyword">if</span> (inUse) &#123;
  <span class="hljs-comment">// 如果邮箱已被注册，返回状态码400，返回响应体 'email in use'</span>
  response.statusCode = <span class="hljs-number">400</span>
  response.write(<span class="hljs-string">'email in use'</span>)
&#125; <span class="hljs-keyword">else</span> &#123;
  <span class="hljs-comment">// 此时数据库中没有用户输入的邮箱，于是将本次数据传入数据库</span>
  users.push(&#123;
    <span class="hljs-attr">email</span>: email,
    <span class="hljs-attr">password</span>: password
  &#125;)
  <span class="hljs-keyword">var</span> usersString = <span class="hljs-built_in">JSON</span>.stringify(users)
  fs.writeFileSync(<span class="hljs-string">'./database/users'</span>, usersString)
  response.statusCode = <span class="hljs-number">200</span>
&#125;

<span class="copy-code-btn">复制代码</span></code></pre>
<h2 data-id="heading-9">三、登录具体流程</h2>
<h4 data-id="heading-10">1、前端先写一个登录页面</h4>
<p>就像这样：</p>
<p><img alt class="lazyload" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c513b6b29cec4b8e887ee8b3ef70f611~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<h4 data-id="heading-11">2、前端需要将用户写的登录信息拿到并传给数据库，并会做一些简单的数据校验</h4>
<p>因为登录功能的这部分前端代码和注册类似，这里就不再赘述，整体的前端代码如下：</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">let</span> $form = $(<span class="hljs-string">'#login-form'</span>)
$form.on(<span class="hljs-string">'submit'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>&#123;
  e.preventDefault()
  <span class="hljs-keyword">let</span> hash = &#123;&#125;
  <span class="hljs-keyword">let</span> need = [<span class="hljs-string">'email'</span>, <span class="hljs-string">'password'</span>]
  need.forEach(<span class="hljs-function">(<span class="hljs-params">name</span>) =></span> &#123;
    <span class="hljs-keyword">let</span> value = $form.find(<span class="hljs-string">`[name=<span class="hljs-subst">$&#123;name&#125;</span>]`</span>).val()
    hash[name] = value
  &#125;)
  $form.find(<span class="hljs-string">'.error'</span>).each(<span class="hljs-function">(<span class="hljs-params">index, span</span>) =></span> &#123;
    $(span).text(<span class="hljs-string">''</span>)
  &#125;)
  <span class="hljs-keyword">if</span> (hash[<span class="hljs-string">'email'</span>] === <span class="hljs-string">''</span>) &#123;
    $form.find(<span class="hljs-string">'[name="email"]'</span>).siblings(<span class="hljs-string">'.error'</span>)
      .text(<span class="hljs-string">'填邮箱呀同学'</span>)
    <span class="hljs-keyword">return</span>
  &#125;
  <span class="hljs-keyword">if</span> (hash[<span class="hljs-string">'password'</span>] === <span class="hljs-string">''</span>) &#123;
    $form.find(<span class="hljs-string">'[name="password"]'</span>).siblings(<span class="hljs-string">'.error'</span>)
      .text(<span class="hljs-string">'填密码呀同学'</span>)
    <span class="hljs-keyword">return</span>
  &#125;
  $.post(<span class="hljs-string">'/login'</span>, hash)
    .then(<span class="hljs-function">(<span class="hljs-params">response</span>) =></span> &#123;
        <span class="hljs-comment">// 登陆成功直接跳转到首页</span>
       <span class="hljs-built_in">window</span>.location.href = <span class="hljs-string">'/'</span>
    &#125;, <span class="hljs-function">(<span class="hljs-params">request</span>) =></span> &#123;
      <span class="hljs-keyword">let</span> &#123; errors &#125; = request.responseJSON
      <span class="hljs-built_in">console</span>.log(errors)
      <span class="hljs-comment">// 如果得到响应提示fail，则说明经过后端验证，登录的邮箱不存在或者密码错误</span>
      <span class="hljs-comment">// 然后设置错误信息提示用户</span>
      <span class="hljs-keyword">if</span> (errors && errors === <span class="hljs-string">'fail'</span>) &#123;
        $form.find(<span class="hljs-string">'[name="password"]'</span>).siblings(<span class="hljs-string">'.error'</span>)
          .text(<span class="hljs-string">'邮箱或密码错误'</span>)
      &#125;
    &#125;)
&#125;)
<span class="copy-code-btn">复制代码</span></code></pre>
<h4 data-id="heading-12">3、后端从数据库中验证用户信息</h4>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">let</span> found
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i < users.length; i++) &#123;
  <span class="hljs-comment">// 遍历数据库，看用户所传的邮箱和密码是否和数据库中的数据匹配</span>
  <span class="hljs-keyword">if</span> (users[i].email === email && users[i].password === password) &#123;
    <span class="hljs-comment">// 如果匹配，fond为true</span>
    found = <span class="hljs-literal">true</span>
    <span class="hljs-keyword">break</span>
  &#125;
&#125;
<span class="hljs-keyword">if</span> (found) &#123; 
  <span class="hljs-comment">// 如果从数据库中找到了该用户</span>
  response.statusCode = <span class="hljs-number">200</span>
  response.write(<span class="hljs-string">'success'</span>)
&#125; <span class="hljs-keyword">else</span> &#123;
  <span class="hljs-comment">// 如果没找到用户信息，说明邮箱不存在或者密码错误</span>
  <span class="hljs-comment">// 返回状态码401，表示认证失败</span>
  response.statusCode = <span class="hljs-number">401</span>
  response.setHeader(<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'application/json;charset=utf-8'</span>)
  <span class="hljs-comment">// 并返回一个JSON对象，方便前端读取错误信息并提示用户</span>
  response.write(<span class="hljs-string">`&#123;
    "errors": "fail"
  &#125;`</span>)
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<h4 data-id="heading-13">4、后端设置cookie</h4>
<p>这里暂不解释cookie的概念，深入了解可以看我的这一篇博客<a href="https://www.jianshu.com/p/9ed3e8759ce3" target="_blank" rel="nofollow noopener noreferrer">浏览器缓存控制详解</a>。
目前你只需要理解cookie就是个请求头，他会告诉服务器你这个用户到底是谁即可。</p>
<pre><code class="hljs language-js copyable" lang="js"> <span class="hljs-keyword">if</span>(found)&#123;
    <span class="hljs-comment">// 设置cookie</span>
   response.setHeader(<span class="hljs-string">'Set-Cookie'</span>, <span class="hljs-string">`login_email=<span class="hljs-subst">$&#123;email&#125;</span>`</span>)
   response.statusCode = <span class="hljs-number">200</span>
   response.write(<span class="hljs-string">'success'</span>)
 &#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>设置cookie后，再看注册页面的响应头多了个东西，这就是我们刚才设置的cookie：</p>
<p><img alt class="lazyload" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/597f4c800ed2491c93e82d54e0eb47bc~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<p>然后跳转到首页，再看首页的请求头：</p>
<p><img alt class="lazyload" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cee7db415e3f4e53b38ff4e0503d071b~tplv-k3u1fbpfcp-zoom-1.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<p>所以我们可以得出，<strong>只要在某一个页面设置了<code>Set-Cookie</code>头，那么从此以后，只要是相同的源（即同一个域名）的请求，在请求头里面都会带上你设置的cookie。</strong></p>
<h4 data-id="heading-14">5、后端通过读取cookie响应对应的用户信息</h4>
<p>下面的例子是将用户的邮箱账号显示在首页中：</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">let</span> cookies = <span class="hljs-string">''</span>
<span class="hljs-comment">// 如果有多个cookie，会这始终形式：'login_email=1@enoch.com ; a=1 ; b=2'</span>
<span class="hljs-comment">// 通过split方法将其分离成我们需要的形式</span>
<span class="hljs-keyword">if</span> (request.headers.cookie) &#123;
  cookies = request.headers.cookie.split(<span class="hljs-string">'; '</span>) <span class="hljs-comment">// ['login_email=1@enoch.com', 'a=1', 'b=2']</span>
&#125;
<span class="hljs-keyword">let</span> hash = &#123;&#125;
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i < cookies.length; i++) &#123;
  <span class="hljs-keyword">let</span> parts = cookies[i].split(<span class="hljs-string">'='</span>)
  <span class="hljs-keyword">let</span> key = parts[<span class="hljs-number">0</span>]
  <span class="hljs-keyword">let</span> value = parts[<span class="hljs-number">1</span>]
  hash[key] = value
&#125;
<span class="hljs-comment">// 上述操作最终会得到 hash = &#123;login_email:'1@enoch.com',a:'1',b:'2'&#125;</span>
<span class="hljs-keyword">let</span> email = hash.login_email
<span class="hljs-keyword">let</span> users = fs.readFileSync(<span class="hljs-string">'./database/users'</span>, <span class="hljs-string">'utf8'</span>)
users = <span class="hljs-built_in">JSON</span>.parse(users)
<span class="hljs-keyword">let</span> foundUser
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i < users.length; i++) &#123;
  <span class="hljs-keyword">if</span> (users[i].email === email) &#123;
    foundUser = users[i]
    <span class="hljs-keyword">break</span>
  &#125;
&#125;
<span class="hljs-keyword">if</span> (foundUser) &#123;
  <span class="hljs-comment">// 如果找到该用户的信息，就将首页的'__username__'替换成用户的邮箱</span>
  string = string.replace(<span class="hljs-string">'__username__'</span>, foundUser.email)
&#125; <span class="hljs-keyword">else</span> &#123;
  <span class="hljs-comment">// 如果没有找到该用户的信息，就将首页的'__username__'替换成N/A</span>
  string = string.replace(<span class="hljs-string">'__username__'</span>, <span class="hljs-string">'N/A'</span>)
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>（END）</p></div> <div class="image-viewer-box" data-v-78c9b824><!----></div>  
</div>
            