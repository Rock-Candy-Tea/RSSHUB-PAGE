
---
title: 'React useEffect 使用指南'
categories: 
 - 编程
 - 掘金
 - 分类
headimg: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c43365c28bd54bb0a9a54dd60efa1038~tplv-k3u1fbpfcp-watermark.image'
author: 掘金
comments: false
date: Sat, 28 Aug 2021 03:30:17 GMT
thumbnail: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c43365c28bd54bb0a9a54dd60efa1038~tplv-k3u1fbpfcp-watermark.image'
---

<div>   
<div class="markdown-body html cache"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><h2 data-id="heading-0"><em>useEffect</em> 介绍</h2>
<p><em>useEffect</em> 是在 React 文档中介绍的第二个 React hook。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c43365c28bd54bb0a9a54dd60efa1038~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>从命名可知，与 Effect 副作用有关，那么<strong>什么是副作用呢</strong>？</p>
<p>在 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2FMostlyAdequate%2Fmostly-adequate-guide" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/MostlyAdequate/mostly-adequate-guide" ref="nofollow noopener noreferrer">《mostly adequate guide》</a>一书中，是这样定义的：</p>
<blockquote>
<p>A side effect is a change of system state or observable interaction with the outside world that occurs during the calculation of a result.</p>
</blockquote>
<p>对应的中文意思是：副作用是在计算结果的过程中，系统状态的一种变化，或者与外部世界进行的
可观察的交互。</p>
<p><strong>产生副作用的情形</strong>：修改 DOM、发送 http 请求、修改 URL query、修改 cookie、sessionStorage、localStorage 和 <code>console.log</code> 等。可见，副作用无法避免，而且非常常见，<em>useEffect</em> 可以让我们在函数组件中执行副作用操作。</p>
<p><strong><em>useEffect</em> 的参数</strong>: 我们查看 <em>useEffect</em> 的声明， 在 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2FDefinitelyTyped%2FDefinitelyTyped%2Fblob%2Fmaster%2Ftypes%2Freact%2Findex.d.ts%23L1085" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/types/react/index.d.ts#L1085" ref="nofollow noopener noreferrer">react/index.d.ts</a> 可以看到 <code>useEffect</code> 的第一个参数是 effect 的回调，第二个参数是 deps 依赖项，可选，类型是数组，会根据依赖项，决定是否调用 EffectCallback。</p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fcarbon.now.sh%2F%3Fbg%3Drgba%2528171%252C%2B184%252C%2B195%252C%2B1%2529%26t%3Done-light%26wt%3Dnone%26l%3Djavascript%26ds%3Dtrue%26dsyoff%3D20px%26dsblur%3D68px%26wc%3Dtrue%26wa%3Dfalse%26pv%3D56px%26ph%3D56px%26ln%3Dfalse%26fl%3D1%26fm%3DHack%26fs%3D14px%26lh%3D133%2525%26si%3Dfalse%26es%3D2x%26wm%3Dfalse%26code%3D%25252F%25252F%252520Similar%252520to%252520componentDidMount%252520and%252520componentDidUpdate%25253A%25250AuseEffect%2528%25250A%252520%252520%2528%2529%252520%25253D%25253E%252520%25257B%25250A%252520%252520%252520%252520%25252F%25252F%252520Update%252520the%252520document%252520title%252520using%252520the%252520browser%252520API%25250A%252520%252520%252520%252520document.title%252520%25253D%252520%252560Clicked%252520%252524%25257Bcount%25257D%252520times%252560%25253B%252520%252520%25257D%2529%25253B%25250A%252520%252520%25257D%25250A%2529%25250A%25250A%25250A%25252F%25252F%252520Photo%252520by%252520Ignacio%252520Aguilar%252520on%252520Unsplash" target="_blank" rel="nofollow noopener noreferrer" title="https://carbon.now.sh/?bg=rgba%28171%2C+184%2C+195%2C+1%29&t=one-light&wt=none&l=javascript&ds=true&dsyoff=20px&dsblur=68px&wc=true&wa=false&pv=56px&ph=56px&ln=false&fl=1&fm=Hack&fs=14px&lh=133%25&si=false&es=2x&wm=false&code=%252F%252F%2520Similar%2520to%2520componentDidMount%2520and%2520componentDidUpdate%253A%250AuseEffect%28%250A%2520%2520%28%29%2520%253D%253E%2520%257B%250A%2520%2520%2520%2520%252F%252F%2520Update%2520the%2520document%2520title%2520using%2520the%2520browser%2520API%250A%2520%2520%2520%2520document.title%2520%253D%2520%2560Clicked%2520%2524%257Bcount%257D%2520times%2560%253B%2520%2520%257D%29%253B%250A%2520%2520%257D%250A%29%250A%250A%250A%252F%252F%2520Photo%2520by%2520Ignacio%2520Aguilar%2520on%2520Unsplash" ref="nofollow noopener noreferrer"><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dee09d9d326f47d5b7c5850f5dd916df~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></a></p>
<p><strong><em>useEffect</em> 调用时机</strong>：</p>
<ol>
<li>与渲染的先后关系：React 会等待浏览器完成画面渲染之后才会延迟调用 <em>useEffect</em></li>
<li>调用次数：在不传 deps 依赖项情况下，<em>useEffect</em> 会在每次渲染后都执行</li>
</ol>
<h2 data-id="heading-1"><em>useEffect</em> 依赖项</h2>
<p>接下来会介绍 <strong>通过控制依赖项，有条件地执行 EffectCallback，可用于性能优化</strong>。</p>
<h3 data-id="heading-2">一、不传依赖项</h3>
<p><strong>调用时机：</strong> 在不传 deps 依赖项情况下，<em>useEffect</em> 会在<strong>每次渲染后都执行</strong>，即它在第一次渲染之后<em>和</em>每次更新之后都会执行。相当于在 <code>componentDidMount</code> 和 <code>componentDidUpdate</code> 两个类方法中执行。</p>
<p>适合于 effect 的回调里计算量小，不会触发渲染的情形。</p>
<p>为降低开发难度，React 文档推荐这种使用方式，可点击查看 <a href="https://link.juejin.cn/?target=https%3A%2F%2Freact.docschina.org%2Fdocs%2Fhooks-effect.html%23explanation-why-effects-run-on-each-update" target="_blank" rel="nofollow noopener noreferrer" title="https://react.docschina.org/docs/hooks-effect.html#explanation-why-effects-run-on-each-update" ref="nofollow noopener noreferrer">解释: 为什么每次更新的时候都要运行 Effect</a></p>
<p>示例代码如下：</p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fcarbon.now.sh%2F%3Fbg%3Drgba%2528171%252C%2B184%252C%2B195%252C%2B1%2529%26t%3Done-light%26wt%3Dnone%26l%3Djavascript%26ds%3Dtrue%26dsyoff%3D20px%26dsblur%3D68px%26wc%3Dtrue%26wa%3Dfalse%26pv%3D56px%26ph%3D56px%26ln%3Dfalse%26fl%3D1%26fm%3DHack%26fs%3D14px%26lh%3D133%2525%26si%3Dfalse%26es%3D2x%26wm%3Dfalse%26code%3D%25252F%25252F%252520Similar%252520to%252520componentDidMount%252520and%252520componentDidUpdate%25253A%25250AuseEffect%2528%25250A%252520%252520%2528%2529%252520%25253D%25253E%252520%25257B%25250A%252520%252520%252520%252520%25252F%25252F%252520Update%252520the%252520document%252520title%252520using%252520the%252520browser%252520API%25250A%252520%252520%252520%252520document.title%252520%25253D%252520%252560Clicked%252520%252524%25257Bcount%25257D%252520times%252560%25253B%252520%252520%25257D%2529%25253B%25250A%252520%252520%25257D%25250A%2529%25250A%25250A%25250A%25252F%25252F%252520Photo%252520by%252520Ignacio%252520Aguilar%252520on%252520Unsplash" target="_blank" rel="nofollow noopener noreferrer" title="https://carbon.now.sh/?bg=rgba%28171%2C+184%2C+195%2C+1%29&t=one-light&wt=none&l=javascript&ds=true&dsyoff=20px&dsblur=68px&wc=true&wa=false&pv=56px&ph=56px&ln=false&fl=1&fm=Hack&fs=14px&lh=133%25&si=false&es=2x&wm=false&code=%252F%252F%2520Similar%2520to%2520componentDidMount%2520and%2520componentDidUpdate%253A%250AuseEffect%28%250A%2520%2520%28%29%2520%253D%253E%2520%257B%250A%2520%2520%2520%2520%252F%252F%2520Update%2520the%2520document%2520title%2520using%2520the%2520browser%2520API%250A%2520%2520%2520%2520document.title%2520%253D%2520%2560Clicked%2520%2524%257Bcount%257D%2520times%2560%253B%2520%2520%257D%29%253B%250A%2520%2520%257D%250A%29%250A%250A%250A%252F%252F%2520Photo%2520by%2520Ignacio%2520Aguilar%2520on%2520Unsplash" ref="nofollow noopener noreferrer"><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8658fa920e1f4d8e96eda68ff7347abe~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></a></p>
<h3 data-id="heading-3">二、依赖项为空数组</h3>
<p><strong>调用时机：</strong> 当不需要在每次渲染后都执行，希望<strong>只在它第一次渲染之后执行</strong>，我们可以把 <em>useEffect</em> 的依赖项设为空数组，相当于以前的 class 组件的 <code>componentDidMount</code>。</p>
<p>以下举三个例子</p>
<ol>
<li>
<p>引用官方文档的<a href="https://link.juejin.cn/?target=https%3A%2F%2Freact.docschina.org%2Fdocs%2Fhooks-faq.html%23what-can-i-do-if-my-effect-dependencies-change-too-often" target="_blank" rel="nofollow noopener noreferrer" title="https://react.docschina.org/docs/hooks-faq.html#what-can-i-do-if-my-effect-dependencies-change-too-often" ref="nofollow noopener noreferrer">例子</a>，设定 Interval 定时器。</p>
<p>这个例子需求是让 state count 每秒自加一。如果不传依赖项，就会每秒都 <code>setInterval</code>, 不符合需求。正确做法是，只在第一次渲染之后执行。代码如下：</p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fcarbon.now.sh%2F%3Fbg%3Drgba%2528171%252C%2B184%252C%2B195%252C%2B1%2529%26t%3Done-light%26wt%3Dnone%26l%3Djavascript%26ds%3Dtrue%26dsyoff%3D20px%26dsblur%3D68px%26wc%3Dtrue%26wa%3Dfalse%26pv%3D56px%26ph%3D56px%26ln%3Dfalse%26fl%3D1%26fm%3DHack%26fs%3D14px%26lh%3D133%2525%26si%3Dfalse%26es%3D2x%26wm%3Dfalse%26code%3D%25252F%25252F%252520Similar%252520to%252520componentDidMount%252520and%252520componentDidUpdate%25253A%25250AuseEffect%2528%25250A%252520%252520%2528%2529%252520%25253D%25253E%252520%25257B%25250A%252520%252520%252520%252520%25252F%25252F%252520Update%252520the%252520document%252520title%252520using%252520the%252520browser%252520API%25250A%252520%252520%252520%252520document.title%252520%25253D%252520%252560Clicked%252520%252524%25257Bcount%25257D%252520times%252560%25253B%252520%252520%25257D%2529%25253B%25250A%252520%252520%25257D%25250A%2529%25250A%25250A%25250A%25252F%25252F%252520Photo%252520by%252520Ignacio%252520Aguilar%252520on%252520Unsplash" target="_blank" rel="nofollow noopener noreferrer" title="https://carbon.now.sh/?bg=rgba%28171%2C+184%2C+195%2C+1%29&t=one-light&wt=none&l=javascript&ds=true&dsyoff=20px&dsblur=68px&wc=true&wa=false&pv=56px&ph=56px&ln=false&fl=1&fm=Hack&fs=14px&lh=133%25&si=false&es=2x&wm=false&code=%252F%252F%2520Similar%2520to%2520componentDidMount%2520and%2520componentDidUpdate%253A%250AuseEffect%28%250A%2520%2520%28%29%2520%253D%253E%2520%257B%250A%2520%2520%2520%2520%252F%252F%2520Update%2520the%2520document%2520title%2520using%2520the%2520browser%2520API%250A%2520%2520%2520%2520document.title%2520%253D%2520%2560Clicked%2520%2524%257Bcount%257D%2520times%2560%253B%2520%2520%257D%29%253B%250A%2520%2520%257D%250A%29%250A%250A%250A%252F%252F%2520Photo%2520by%2520Ignacio%2520Aguilar%2520on%2520Unsplash" ref="nofollow noopener noreferrer"><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5be9f857f8fb4ebcbcb4b80b77e4086d~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></a></p>
</li>
<li>
<p>进行数据请求。</p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fcarbon.now.sh%2F%3Fbg%3Drgba%2528171%252C%2B184%252C%2B195%252C%2B1%2529%26t%3Done-light%26wt%3Dnone%26l%3Djavascript%26ds%3Dtrue%26dsyoff%3D20px%26dsblur%3D68px%26wc%3Dtrue%26wa%3Dfalse%26pv%3D56px%26ph%3D56px%26ln%3Dfalse%26fl%3D1%26fm%3DHack%26fs%3D14px%26lh%3D133%2525%26si%3Dfalse%26es%3D2x%26wm%3Dfalse%26code%3D%25252F%25252F%252520Similar%252520to%252520componentDidMount%252520and%252520componentDidUpdate%25253A%25250AuseEffect%2528%25250A%252520%252520%2528%2529%252520%25253D%25253E%252520%25257B%25250A%252520%252520%252520%252520%25252F%25252F%252520Update%252520the%252520document%252520title%252520using%252520the%252520browser%252520API%25250A%252520%252520%252520%252520document.title%252520%25253D%252520%252560Clicked%252520%252524%25257Bcount%25257D%252520times%252560%25253B%252520%252520%25257D%2529%25253B%25250A%252520%252520%25257D%25250A%2529%25250A%25250A%25250A%25252F%25252F%252520Photo%252520by%252520Ignacio%252520Aguilar%252520on%252520Unsplash" target="_blank" rel="nofollow noopener noreferrer" title="https://carbon.now.sh/?bg=rgba%28171%2C+184%2C+195%2C+1%29&t=one-light&wt=none&l=javascript&ds=true&dsyoff=20px&dsblur=68px&wc=true&wa=false&pv=56px&ph=56px&ln=false&fl=1&fm=Hack&fs=14px&lh=133%25&si=false&es=2x&wm=false&code=%252F%252F%2520Similar%2520to%2520componentDidMount%2520and%2520componentDidUpdate%253A%250AuseEffect%28%250A%2520%2520%28%29%2520%253D%253E%2520%257B%250A%2520%2520%2520%2520%252F%252F%2520Update%2520the%2520document%2520title%2520using%2520the%2520browser%2520API%250A%2520%2520%2520%2520document.title%2520%253D%2520%2560Clicked%2520%2524%257Bcount%257D%2520times%2560%253B%2520%2520%257D%29%253B%250A%2520%2520%257D%250A%29%250A%250A%250A%252F%252F%2520Photo%2520by%2520Ignacio%2520Aguilar%2520on%2520Unsplash" ref="nofollow noopener noreferrer"><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/53f53d059441472eacc0a80356fdc0cd~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></a></p>
</li>
<li>
<p>从 URLSearchParams 获取数据，用于初始化 state。</p>
<p>这个例子是在页码选择器，从 URL query 中获取 page，用于初始化 page state。</p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fcarbon.now.sh%2F%3Fbg%3Drgba%2528171%252C%2B184%252C%2B195%252C%2B1%2529%26t%3Done-light%26wt%3Dnone%26l%3Djavascript%26ds%3Dtrue%26dsyoff%3D20px%26dsblur%3D68px%26wc%3Dtrue%26wa%3Dfalse%26pv%3D56px%26ph%3D56px%26ln%3Dfalse%26fl%3D1%26fm%3DHack%26fs%3D14px%26lh%3D133%2525%26si%3Dfalse%26es%3D2x%26wm%3Dfalse%26code%3D%25252F%25252F%252520Similar%252520to%252520componentDidMount%252520and%252520componentDidUpdate%25253A%25250AuseEffect%2528%25250A%252520%252520%2528%2529%252520%25253D%25253E%252520%25257B%25250A%252520%252520%252520%252520%25252F%25252F%252520Update%252520the%252520document%252520title%252520using%252520the%252520browser%252520API%25250A%252520%252520%252520%252520document.title%252520%25253D%252520%252560Clicked%252520%252524%25257Bcount%25257D%252520times%252560%25253B%252520%252520%25257D%2529%25253B%25250A%252520%252520%25257D%25250A%2529%25250A%25250A%25250A%25252F%25252F%252520Photo%252520by%252520Ignacio%252520Aguilar%252520on%252520Unsplash" target="_blank" rel="nofollow noopener noreferrer" title="https://carbon.now.sh/?bg=rgba%28171%2C+184%2C+195%2C+1%29&t=one-light&wt=none&l=javascript&ds=true&dsyoff=20px&dsblur=68px&wc=true&wa=false&pv=56px&ph=56px&ln=false&fl=1&fm=Hack&fs=14px&lh=133%25&si=false&es=2x&wm=false&code=%252F%252F%2520Similar%2520to%2520componentDidMount%2520and%2520componentDidUpdate%253A%250AuseEffect%28%250A%2520%2520%28%29%2520%253D%253E%2520%257B%250A%2520%2520%2520%2520%252F%252F%2520Update%2520the%2520document%2520title%2520using%2520the%2520browser%2520API%250A%2520%2520%2520%2520document.title%2520%253D%2520%2560Clicked%2520%2524%257Bcount%257D%2520times%2560%253B%2520%2520%257D%29%253B%250A%2520%2520%257D%250A%29%250A%250A%250A%252F%252F%2520Photo%2520by%2520Ignacio%2520Aguilar%2520on%2520Unsplash" ref="nofollow noopener noreferrer"><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d19f9fdf7cf04366beb3f5b070fc658b~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></a></p>
</li>
</ol>
<h3 data-id="heading-4">三、依赖项为非空数组</h3>
<p><strong>调用时机：</strong> 当依赖项为非空数组，则 <strong>在每次渲染后，非空数组上的 state 有更新</strong>时，就会执行 <em>EffectCallback</em>，即 <em>useEffect</em> 传入回调函数。</p>
<p>前文提到了 “当依赖项为非空数组，则在每次渲染后，非空数组上的 state 有更新时，就会执行 <em>EffectCallback</em> ”</p>
<p><strong>这里的更新是指什么呢？是指对依赖项进行浅比较</strong>，对数组中的每个state，进行上次渲染后的值，跟这次渲染后的值，进行浅比较，不相等时，就执行 <em>EffectCallback</em>。</p>
<p>浅比较如何比较呢？</p>
<p>在 JavaScript 中，数据类型分为 <em>值类型</em> 和 <em>引用类型</em>。</p>
<p>对于<strong>值类型的浅比较是对比值是否相等</strong>。</p>
<p>有 boolean number string 三种，比如 <code>true !== false</code>、<code>1 !== 2</code> 和 <code>'1' !== '2'</code> 。</p>
<p>对于<strong>引用类型的浅比较是对比对象的引用，对比对象指向的内存地址</strong>。有 object array function 等类型。</p>
<h2 data-id="heading-5"><em>useEffect</em> 清除机制</h2>
<p><strong>触发时机：</strong> 在依赖项为空数组下，相当于 class 组件的 <em>componentWillUnmount</em> 。</p>
<p>我们查看 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2FDefinitelyTyped%2FDefinitelyTyped%2Fblob%2Fmaster%2Ftypes%2Freact%2Findex.d.ts%23L902" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/types/react/index.d.ts#L902" ref="nofollow noopener noreferrer">react/index.d.ts#L902</a>，可以发现 useEffet 回调函数 <em>EffectCallback</em> 的返回值 <code>void | Destructor</code>，其中 <code>Destructor</code> 是可选的析构函数。</p>
<pre><code class="hljs language-ts copyable" lang="ts"><span class="hljs-keyword">type</span> EffectCallback = <span class="hljs-function">() =></span> (<span class="hljs-built_in">void</span> | Destructor);
<span class="copy-code-btn">复制代码</span></code></pre>
<p>我们再重新看上面计数器的例子，实际上在组件销毁时，还需要清除计时器 <code>clearInterval</code>，可通过在 <em>EffectCallback</em> 返回 <code>() => clearInterval(id)</code> 去实现。</p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fcarbon.now.sh%2F%3Fbg%3Drgba%2528171%252C%2B184%252C%2B195%252C%2B1%2529%26t%3Done-light%26wt%3Dnone%26l%3Djavascript%26ds%3Dtrue%26dsyoff%3D20px%26dsblur%3D68px%26wc%3Dtrue%26wa%3Dfalse%26pv%3D56px%26ph%3D56px%26ln%3Dfalse%26fl%3D1%26fm%3DHack%26fs%3D14px%26lh%3D133%2525%26si%3Dfalse%26es%3D2x%26wm%3Dfalse%26code%3D%25252F%25252F%252520Similar%252520to%252520componentDidMount%252520and%252520componentDidUpdate%25253A%25250AuseEffect%2528%25250A%252520%252520%2528%2529%252520%25253D%25253E%252520%25257B%25250A%252520%252520%252520%252520%25252F%25252F%252520Update%252520the%252520document%252520title%252520using%252520the%252520browser%252520API%25250A%252520%252520%252520%252520document.title%252520%25253D%252520%252560Clicked%252520%252524%25257Bcount%25257D%252520times%252560%25253B%252520%252520%25257D%2529%25253B%25250A%252520%252520%25257D%25250A%2529%25250A%25250A%25250A%25252F%25252F%252520Photo%252520by%252520Ignacio%252520Aguilar%252520on%252520Unsplash" target="_blank" rel="nofollow noopener noreferrer" title="https://carbon.now.sh/?bg=rgba%28171%2C+184%2C+195%2C+1%29&t=one-light&wt=none&l=javascript&ds=true&dsyoff=20px&dsblur=68px&wc=true&wa=false&pv=56px&ph=56px&ln=false&fl=1&fm=Hack&fs=14px&lh=133%25&si=false&es=2x&wm=false&code=%252F%252F%2520Similar%2520to%2520componentDidMount%2520and%2520componentDidUpdate%253A%250AuseEffect%28%250A%2520%2520%28%29%2520%253D%253E%2520%257B%250A%2520%2520%2520%2520%252F%252F%2520Update%2520the%2520document%2520title%2520using%2520the%2520browser%2520API%250A%2520%2520%2520%2520document.title%2520%253D%2520%2560Clicked%2520%2524%257Bcount%257D%2520times%2560%253B%2520%2520%257D%29%253B%250A%2520%2520%257D%250A%29%250A%250A%250A%252F%252F%2520Photo%2520by%2520Ignacio%2520Aguilar%2520on%2520Unsplash" ref="nofollow noopener noreferrer"><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e46052886e8f42e3b0cb8be42dedc037~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></a></p>
<p><strong>更准确的触发时机：</strong> 当依赖项更新时，先调用上一次渲染后执行的 <em>EffectCallback</em> 的销毁函数</p>
<p>代码示例：我们继续复用计数器的例子，将每秒自加一，改为由参数配置每隔几秒自加一，修改代码位置如下：</p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fcarbon.now.sh%2F%3Fbg%3Drgba%2528171%252C%2B184%252C%2B195%252C%2B1%2529%26t%3Done-light%26wt%3Dnone%26l%3Djavascript%26ds%3Dtrue%26dsyoff%3D20px%26dsblur%3D68px%26wc%3Dtrue%26wa%3Dfalse%26pv%3D56px%26ph%3D56px%26ln%3Dfalse%26fl%3D1%26fm%3DHack%26fs%3D14px%26lh%3D133%2525%26si%3Dfalse%26es%3D2x%26wm%3Dfalse%26code%3D%25252F%25252F%252520Similar%252520to%252520componentDidMount%252520and%252520componentDidUpdate%25253A%25250AuseEffect%2528%25250A%252520%252520%2528%2529%252520%25253D%25253E%252520%25257B%25250A%252520%252520%252520%252520%25252F%25252F%252520Update%252520the%252520document%252520title%252520using%252520the%252520browser%252520API%25250A%252520%252520%252520%252520document.title%252520%25253D%252520%252560Clicked%252520%252524%25257Bcount%25257D%252520times%252560%25253B%252520%252520%25257D%2529%25253B%25250A%252520%252520%25257D%25250A%2529%25250A%25250A%25250A%25252F%25252F%252520Photo%252520by%252520Ignacio%252520Aguilar%252520on%252520Unsplash" target="_blank" rel="nofollow noopener noreferrer" title="https://carbon.now.sh/?bg=rgba%28171%2C+184%2C+195%2C+1%29&t=one-light&wt=none&l=javascript&ds=true&dsyoff=20px&dsblur=68px&wc=true&wa=false&pv=56px&ph=56px&ln=false&fl=1&fm=Hack&fs=14px&lh=133%25&si=false&es=2x&wm=false&code=%252F%252F%2520Similar%2520to%2520componentDidMount%2520and%2520componentDidUpdate%253A%250AuseEffect%28%250A%2520%2520%28%29%2520%253D%253E%2520%257B%250A%2520%2520%2520%2520%252F%252F%2520Update%2520the%2520document%2520title%2520using%2520the%2520browser%2520API%250A%2520%2520%2520%2520document.title%2520%253D%2520%2560Clicked%2520%2524%257Bcount%257D%2520times%2560%253B%2520%2520%257D%29%253B%250A%2520%2520%257D%250A%29%250A%250A%250A%252F%252F%2520Photo%2520by%2520Ignacio%2520Aguilar%2520on%2520Unsplash" ref="nofollow noopener noreferrer"><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f4a0649f67be419d83bb223e7126a757~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></a></p>
<p>可以<a href="https://link.juejin.cn/?target=https%3A%2F%2Fcodepen.io%2Fliveabean%2Fpen%2FExXVPZo%3Feditors%3D0011" target="_blank" rel="nofollow noopener noreferrer" title="https://codepen.io/liveabean/pen/ExXVPZo?editors=0011" ref="nofollow noopener noreferrer">在 codepen 上尝试本代码</a> 的实际运行效果 😊</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3702b0c832594b048778f6563e3fc520~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<h2 data-id="heading-6">参考资料</h2>
<ul>
<li><a href="https://link.juejin.cn/?target=https%3A%2F%2Freactjs.org%2Fdocs%2Fhooks-intro.html" target="_blank" rel="nofollow noopener noreferrer" title="https://reactjs.org/docs/hooks-intro.html" ref="nofollow noopener noreferrer">React 文档</a></li>
<li><a href="https://link.juejin.cn/?target=http%3A%2F%2Fgk.link%2Fa%2F10wzH" target="_blank" rel="nofollow noopener noreferrer" title="http://gk.link/a/10wzH" ref="nofollow noopener noreferrer">极客时间 -《React Hooks 核心原理与实战》</a></li>
</ul></div>  
</div>
            