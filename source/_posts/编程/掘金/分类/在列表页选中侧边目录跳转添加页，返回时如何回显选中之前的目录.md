
---
title: '在列表页选中侧边目录跳转添加页，返回时如何回显选中之前的目录'
categories: 
 - 编程
 - 掘金
 - 分类
headimg: 'https://picsum.photos/400/300?random=7358'
author: 掘金
comments: false
date: Fri, 20 Aug 2021 16:34:14 GMT
thumbnail: 'https://picsum.photos/400/300?random=7358'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><p>这是我参与8月更文挑战的第3天，活动详情查看：<a href="https://juejin.cn/post/6987962113788493831" title="https://juejin.cn/post/6987962113788493831" target="_blank">8月更文挑战</a></p>
<p>近期写项目的时候，遇到个需求，项目里有一个列表页面，在列表里可以点添加跳转到添加页面，添加完成之后或者点击取消需要返回列表页面，这个简单，直接$router.push就完事了。谁知道测试的时候，测试给提bug了，原因是列表页面有一个侧边的地区目录，跳转添加页时候选中的哪个地区，返回列表页时候还要选中哪个地区。</p>
<p>这个不难，现在就来整理一下思路，首先我们肯定要知道跳转添加页的时候选中的是哪个地区，怎么知道呢？我们在跳转的时候传过去，返回的时候再传过来不就好了。</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-comment">// 列表页</span>
<span class="hljs-built_in">this</span>.$router.push(&#123;
  <span class="hljs-attr">path</span>: <span class="hljs-string">'/add'</span>,
  <span class="hljs-attr">query</span>: &#123;
    <span class="hljs-attr">areaCode</span>: <span class="hljs-number">15</span>
  &#125;
&#125;)

<span class="hljs-comment">// 添加页</span>
<span class="hljs-built_in">this</span>.$router.push(&#123;
  <span class="hljs-attr">path</span>: <span class="hljs-string">'/list'</span>,
  <span class="hljs-attr">query</span>: &#123;
    <span class="hljs-attr">areaCode</span>: <span class="hljs-built_in">this</span>.$route.query.areaCode
  &#125;
&#125;)
<span class="copy-code-btn">复制代码</span></code></pre>
<p>然后我们在列表页获取地区数据之后，把这个id给选中就可以了，我们这里的侧边目录用的是element-ui的el-tree组件。</p>
<pre><code class="hljs language-html copyable" lang="html"><span class="hljs-tag"><<span class="hljs-name">el-tree</span>
    <span class="hljs-attr">class</span>=<span class="hljs-string">"filter-tree"</span>
    <span class="hljs-attr">:data</span>=<span class="hljs-string">"spaceData"</span>
    <span class="hljs-attr">highlight-current</span>
    <span class="hljs-attr">node-key</span>=<span class="hljs-string">"areaCode"</span>
    <span class="hljs-attr">:expand-on-click-node</span>=<span class="hljs-string">"false"</span>
    <span class="hljs-attr">ref</span>=<span class="hljs-string">"tree"</span>
    <span class="hljs-attr">v-loading</span>=<span class="hljs-string">"spaceLoading"</span>
    <span class="hljs-attr">:props</span>=<span class="hljs-string">"spaceProps"</span>
    @<span class="hljs-attr">current-change</span>=<span class="hljs-string">"spaceChange"</span>
></span>
    <span class="hljs-tag"><<span class="hljs-name">el-tooltip</span>
        <span class="hljs-attr">class</span>=<span class="hljs-string">"custom-tree-node"</span>
        <span class="hljs-attr">slot-scope</span>=<span class="hljs-string">"&#123; node &#125;"</span>
        <span class="hljs-attr">:content</span>=<span class="hljs-string">"node.label"</span>
        <span class="hljs-attr">effect</span>=<span class="hljs-string">"light"</span>
        <span class="hljs-attr">placement</span>=<span class="hljs-string">"right-start"</span>
    ></span>
        <span class="hljs-tag"><<span class="hljs-name">span</span>></span>&#123;&#123; node.label &#125;&#125;<span class="hljs-tag"></<span class="hljs-name">span</span>></span>
    <span class="hljs-tag"></<span class="hljs-name">el-tooltip</span>></span>
<span class="hljs-tag"></<span class="hljs-name">el-tree</span>></span>

<span class="copy-code-btn">复制代码</span></code></pre>
<pre><code class="hljs language-js copyable" lang="js">getSpaceData () &#123;
  <span class="hljs-comment">// ...</span>
  <span class="hljs-keyword">let</span> queryId = <span class="hljs-built_in">this</span>.$route.query.areaCode
  <span class="hljs-keyword">if</span> (queryId) &#123;
    <span class="hljs-built_in">this</span>.$refs.tree.setCurrentKey(queryId)
  &#125;
  <span class="hljs-comment">// ...</span>
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>大功告成，不过刷新几下就会发现，每次请求地区数据的之后，这个参数都会生效，都会默认选中url中这个地区，就算我选了其他地区，刷新之后还是默认选中这个地区，这可咋整？</p>
<p>想了想，我们在第一次参数第一次生效（也就是从添加页返回列表页默认选中之前的地区）之后，就把这个参数给删除掉是不是就好了，于是去百度，寻找如何删除地址栏参数，然后找到了这个方法<code>history.replaceState</code>，这里就不详细讲解了，感兴趣的同学可以去百度一下，下面附上使用方法。</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-comment">/**
 * <span class="hljs-doctag">@name</span>: 修改地址栏参数
 * <span class="hljs-doctag">@param <span class="hljs-type">&#123;*&#125;</span> </span>arg 要修改的参数
 * <span class="hljs-doctag">@param <span class="hljs-type">&#123;*&#125;</span> </span>arg_val 要修改的新值
 * <span class="hljs-doctag">@return <span class="hljs-type">&#123;*&#125;</span></span>
 */</span>
changeURLArg (arg, arg_val) &#123;
  <span class="hljs-keyword">let</span> url = location.href
  <span class="hljs-keyword">let</span> unformatStr = <span class="hljs-string">''</span>
  <span class="hljs-keyword">var</span> pattern = arg + <span class="hljs-string">'=([^&]*)'</span>;
  <span class="hljs-keyword">var</span> replaceText = arg + <span class="hljs-string">'='</span> + arg_val;
  <span class="hljs-keyword">if</span> (url.match(pattern)) &#123;
    <span class="hljs-keyword">var</span> tmp = <span class="hljs-string">'/('</span> + arg + <span class="hljs-string">'=)([^&]*)/gi'</span>;
    tmp = url.replace(<span class="hljs-built_in">eval</span>(tmp), replaceText);
    unformatStr = tmp;
  &#125; <span class="hljs-keyword">else</span> &#123;
    <span class="hljs-keyword">if</span> (url.match(<span class="hljs-string">'[\?]'</span>)) &#123;
      unformatStr = url + <span class="hljs-string">'&'</span> + replaceText;
    &#125; <span class="hljs-keyword">else</span> &#123;
      unformatStr = url + <span class="hljs-string">'?'</span> + replaceText;
    &#125;
  &#125;
  <span class="hljs-keyword">if</span> (!!(<span class="hljs-built_in">window</span>.history && history.pushState)) &#123;
    history.replaceState(<span class="hljs-literal">null</span>, <span class="hljs-string">""</span>, unformatStr);
  &#125;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>这样我们只需要在回显成功之后修改地址栏参数为空即可。</p>
<pre><code class="hljs language-js copyable" lang="js">getSpaceData () &#123;
  <span class="hljs-comment">// ...</span>
  <span class="hljs-keyword">let</span> queryId = <span class="hljs-built_in">this</span>.$route.query.areaCode
  <span class="hljs-keyword">if</span> (queryId) &#123;
    <span class="hljs-built_in">this</span>.$refs.tree.setCurrentKey(queryId)
    <span class="hljs-built_in">this</span>.changeURLArg(<span class="hljs-string">'areaCode'</span>, <span class="hljs-string">''</span>)
  &#125;
  <span class="hljs-comment">// ...</span>
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>这样就大工高成了，知识点虽小，但很实用，希望可以帮助你。用这个方法同样可以实现一些函数进页面只执行一次的需求。</p></div>  
</div>
            