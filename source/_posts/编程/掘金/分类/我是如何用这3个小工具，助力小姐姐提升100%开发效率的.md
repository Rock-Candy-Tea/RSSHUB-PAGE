
---
title: '我是如何用这3个小工具，助力小姐姐提升100%开发效率的'
categories: 
 - 编程
 - 掘金
 - 分类
headimg: 'https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4a95795dfdf24872ae83ce49fb86d9b8~tplv-k3u1fbpfcp-watermark.image'
author: 掘金
comments: false
date: Sun, 29 Aug 2021 15:38:32 GMT
thumbnail: 'https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4a95795dfdf24872ae83ce49fb86d9b8~tplv-k3u1fbpfcp-watermark.image'
---

<div>   
<div class="markdown-body html cache"><style>@charset "UTF-8";.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:#353535&#125;.markdown-body h1&#123;padding-bottom:4px;font-size:30px&#125;.markdown-body h1,.markdown-body h2&#123;margin-top:36px;margin-bottom:10px;line-height:1.5;color:#005bb7&#125;.markdown-body h2&#123;position:relative;padding-left:16px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h2:before&#123;content:"「";position:absolute;top:-6px;left:-10px&#125;.markdown-body h2:after&#123;content:"」";position:absolute;top:6px;right:auto&#125;.markdown-body h3&#123;position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:#005bb7;padding-left:6px&#125;.markdown-body h3:before&#123;content:"»";padding-right:6px;color:#2196f3&#125;.markdown-body h4&#123;margin-top:24px;font-size:16px&#125;.markdown-body h4,.markdown-body h5&#123;padding-bottom:0;margin-bottom:10px;line-height:1.5;color:#005bb7;padding-left:6px&#125;.markdown-body h5&#123;margin-top:18px;font-size:14px&#125;.markdown-body h6&#123;padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:#005bb7;padding-left:6px&#125;.markdown-body p&#123;line-height:inherit;margin-top:16px;margin-bottom:16px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,#007fff,rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),#007fff);border-width:0;overflow:visible&#125;.markdown-body hr:after&#123;content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background:#fff;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center&#125;.markdown-body code&#123;padding:.065em .4em;font-size:.87em;color:#c2185b;word-break:break-word;overflow-x:auto;background-color:#fff4f4;border-radius:2px&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8&#125;.markdown-body pre>code::-webkit-scrollbar&#123;width:4px;height:4px&#125;.markdown-body pre>code::-webkit-scrollbar-track&#123;background-color:#bedcff&#125;.markdown-body pre>code::-webkit-scrollbar-thumb&#123;background-color:#2196f3;border-radius:10px&#125;.markdown-body a&#123;position:relative;text-decoration:none;color:#3da8f5;border-bottom:1px solid #bedcff&#125;.markdown-body a:hover&#123;color:#007fff;border-bottom-color:#007fff&#125;.markdown-body a:active&#123;color:#007fff&#125;.markdown-body a:after&#123;position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid #bedcff;transition:top .3s,opacity .3s;transform:translateZ(0)&#125;.markdown-body a:hover:after&#123;top:0;opacity:1;border-bottom-color:#007fff&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #c3e0fd;border-spacing:0;border-collapse:collapse&#125;.markdown-body table thead&#123;color:#000;text-align:left;font-size:14px;background:#f6f6f6&#125;.markdown-body table tr:nth-child(2n)&#123;background-color:#f7fbff&#125;.markdown-body table tr:hover&#123;background-color:#e0edf7&#125;.markdown-body table td,.markdown-body table th&#123;padding:12px 8px;line-height:24px;border:1px solid #c3e0fd&#125;.markdown-body table th&#123;color:#005bb7;background-color:#dff0ff&#125;.markdown-body table td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#8c8c8c;border-left:4px solid #2196f3;background-color:#f0fdff;padding:1px 20px;margin:22px 0&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body b,.markdown-body blockquote>b,.markdown-body blockquote>strong,.markdown-body strong&#123;color:#2196f3&#125;.markdown-body em,.markdown-body i&#123;color:#4fc3f7&#125;.markdown-body del&#123;color:#ccc&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:4px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body details>summary&#123;outline:none;color:#005bb7;font-size:20px;font-weight:bolder;border-bottom:1px solid #bedcff;cursor:pointer&#125;.markdown-body details>p&#123;padding:10px 20px;margin:10px 0 0;color:#666;background-color:#f0fdff;border:2px dashed #2196f3&#125;.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection&#123;color:#005bb7;background-color:rgba(160,200,255,.15)&#125;.markdown-body p::selection&#123;color:#c80000&#125;.markdown-body a::selection,.markdown-body b::selection,.markdown-body del::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection&#123;background-color:transparent&#125;.markdown-body code::selection&#123;background-color:#ffeaeb&#125;.markdown-body pre>code::selection&#123;background-color:rgba(160,200,255,.25)&#125;.markdown-body ol ::selection,.markdown-body ul ::selection&#123;background-color:rgba(160,200,255,.15)&#125;.markdown-body .contains-task-list&#123;padding-left:14px;list-style:none&#125;.markdown-body .contains-task-list input[type=checkbox]&#123;position:relative&#125;.markdown-body .contains-task-list input[type=checkbox]:before&#123;content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1&#125;.markdown-body .contains-task-list input[type=checkbox]:checked:after&#123;content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><h2 data-id="heading-0">前言</h2>
<p>简单的知识点搭配合适的业务场景，往往能起到意想不到的效果。这篇文章会用三个最基础人人都知道的前端知识来说明如何助力运营小姐姐、公司48+前端开发同学的日常工作，让他们的工作效率得到极大地提升。</p>
<p>看完您可以会收获</p>
<ol>
<li>
<p><code>用vue从零开始写一个chrome插件</code></p>
</li>
<li>
<p><code>如何用Object.defineProperty拦截fetch</code>请求`</p>
</li>
<li>
<p><code>如何使用油猴脚本开发一个扩展程序</code></p>
</li>
<li>
<p><code>日常提效的一些思考</code></p>
</li>
</ol>
<h2 data-id="heading-1">油猴脚本入门示例</h2>
<blockquote>
<p>因为接下来的两个小工具都是基于<code>油猴</code>脚本来实现的，所以我们提前先了解一下它</p>
</blockquote>
<h3 data-id="heading-2">油猴脚本是什么？</h3>
<blockquote>
<p>油猴脚本（<a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.tampermonkey.net%2F" target="_blank" rel="nofollow noopener noreferrer" title="https://www.tampermonkey.net/" ref="nofollow noopener noreferrer">Tampermonkey</a>）是一个流行的浏览器扩展，可以运行用户编写的扩展脚本，来实现各式各样的功能，比如去广告、修改样式、下载视频等。</p>
</blockquote>
<h3 data-id="heading-3">如何写一个油猴脚本?</h3>
<p><strong>1. 安装油猴</strong></p>
<p>以chrome浏览器扩展为例，<a href="https://link.juejin.cn/?target=https%3A%2F%2Fchrome.google.com%2Fwebstore%2Fdetail%2Ftampermonkey%2Fdhdgffkkebhmkfjojejmpbldmpobfkfo" target="_blank" rel="nofollow noopener noreferrer" title="https://chrome.google.com/webstore/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo" ref="nofollow noopener noreferrer">点击这里</a>先安装</p>
<p>安装完成之后可以看到右上角多了这个</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4a95795dfdf24872ae83ce49fb86d9b8~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p><strong>2. 新增示例脚本 hello world</strong></p>
<pre><code class="hljs language-javascript copyable" lang="javascript">
<span class="hljs-comment">// ==UserScript==</span>
<span class="hljs-comment">// @name         hello world // 脚本名称</span>
<span class="hljs-comment">// @namespace    http://tampermonkey.net/</span>
<span class="hljs-comment">// @version      0.1</span>
<span class="hljs-comment">// @description  try to take over the world!</span>
<span class="hljs-comment">// @author       You</span>
<span class="hljs-comment">// @match        https://juejin.cn/* // 表示怎样的url才执行下面的代码</span>
<span class="hljs-comment">// @icon         https://www.google.com/s2/favicons?domain=juejin.cn</span>
<span class="hljs-comment">// @grant        none</span>
<span class="hljs-comment">// ==/UserScript==</span>

(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;
<span class="hljs-meta">    'use strict'</span>;
  alert(<span class="hljs-string">'hello world'</span>)
    <span class="hljs-comment">// Your code here...</span>
&#125;)();


<span class="copy-code-btn">复制代码</span></code></pre>
<p>没错当打开任意一个<code>https://juejin.cn/*</code>掘金的页面时，都会弹出<code>hello world</code>，而其他的网页如<code>https://baidu.com</code>则不会。</p>
<p>到此你就完成了一个最简单的油猴脚本，接下来我们看一下用同样简单的代码，来解决一个实际问题吧！O(∩_∩)O</p>
<h2 data-id="heading-4">3行代码让SSO自动登录</h2>
<h3 data-id="heading-5">问题是什么？</h3>
<p><strong>1. 有一天运营小姐姐要在几个系统之间配置点东西</strong></p>
<p>一顿操作，终于把事情搞定了，心情美美的。</p>
<p><code>但是她心想，为啥每个系统都要我登录一次，不开心 o(￣ヘ￣o＃)</code></p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/90d13a0d2a2241428dd2d677c8940f20~tplv-k3u1fbpfcp-watermark.image" alt="1.gif" loading="lazy" referrerpolicy="no-referrer"></p>
<p><strong>2. 下午一觉醒来，领导让把上午的配置重新改一下</strong><code>(尽职的小姐姐马上开始操作)</code></p>
<p>但是让她没想到的是：上午的登录页面仿佛许久没有见到她一样，又和小姐姐来了一次亲密接触😭</p>
<p><code>此时，她的内心已经开始崩溃了</code></p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0171e94c13244f4a92196434df7b5c52~tplv-k3u1fbpfcp-watermark.image" alt="2.gif" loading="lazy" referrerpolicy="no-referrer"></p>
<p><strong>3. 但是这不是结束，以后的每一天她都是这种状态😭😭😭</strong></p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9ea5afa1e46846bfb6cc9cbcf391e5d9~tplv-k3u1fbpfcp-watermark.image" alt="3.gif" loading="lazy" referrerpolicy="no-referrer"></p>
<h3 data-id="heading-6">痛点在哪里？</h3>
<blockquote>
<p>看完上面的动图，我猜你已经在替小姐姐一起骂娘了，这做的什么玩意，太垃圾了。SSO是统一登录，你们这搞的是什么东西。</p>
</blockquote>
<p>是的，我的内心和你一样<code>愤愤不平</code>, 一样有一万个草泥马在奔腾，这是哪个sb设计的方案，简直<code>不配做人</code>，一天啥事也不干，尽是跳登录页，输入用户名密码点登录按钮了，久而久之，朋友间见面说的第一句话不是“你吃了吗？”，而是“你登录了吗？”。</p>
<p>不过吐槽完，我们还是要想想如何通过技术手段解决这两个痛点，达到<code>只需要登录一次的目的</code>。</p>
<p><strong>1. 在A系统登录之后，跑到其他系统需要重新登录。</strong></p>
<p><strong>2. 登录时效只有2小时，2小时后，需要重新登录</strong></p>
<h3 data-id="heading-7">该如何解决？</h3>
<p>根本原因还是公司的SSO统一登录方案设计的有问题，所以需要推动他们修改，但是这是一个相对长期的过程，短期内有没有什么办法能让我们愉快的登录呢？</p>
<p>痛点1: <code>1. 在A系统登录之后，跑到其他系统需要重新登录。</code>已无力回天</p>
<p>痛点2: <code>2. 登录时效只有2小时，2小时后，需要重新登录</code>已无力回天</p>
<p>我们不好直接侵入各个系统去改造登录逻辑，改造其登录时效，但是却可以对<code>登录页面（示例）</code>做点手脚</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9ee6a0c3b18641bebbf05fdc56c7e7ca~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>最关键的是：</p>
<ol>
<li>
<p><strong>用户名输入框</strong></p>
</li>
<li>
<p><strong>密码输入框</strong></p>
</li>
<li>
<p><strong>点击按钮</strong></p>
</li>
</ol>
<p>所以可以借助油猴脚本，在DOMContentLoaded的时候，插入一下代码，来实现自动登录，减少手动操作的过程，大概原理如下。</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/586e8152bd574bf5b5eca8cfa52d94e0~tplv-k3u1fbpfcp-watermark.image" alt="结构图.jpg" loading="lazy" referrerpolicy="no-referrer"></p>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">// ==UserScript==</span>
<span class="hljs-comment">// @name         SSO自动登录</span>
<span class="hljs-comment">// @namespace    http://tampermonkey.net/</span>
<span class="hljs-comment">// @version      0.1</span>
<span class="hljs-comment">// @description  try to take over the world!</span>
<span class="hljs-comment">// @author       You</span>
<span class="hljs-comment">// @match        https://*.xxx.com/login* // 这里是SSO登录页面地址，表示只有符合这个规则的才注入这段代码</span>
<span class="hljs-comment">// @grant        none</span>
<span class="hljs-comment">// ==/UserScript==</span>

<span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">'#username'</span>).value = <span class="hljs-string">'xxx'</span> <span class="hljs-comment">// 用户名</span>
<span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">'#password'</span>).value = <span class="hljs-string">'yyy'</span> <span class="hljs-comment">// 密码</span>
<span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">'#login-submit'</span>).click() <span class="hljs-comment">// 自动提交登录</span>
<span class="copy-code-btn">复制代码</span></code></pre>
<p><strong>是不是太简单了，简单到令人发指，令人痛恨，令人想吐口水！！！，没有一点技术含量</strong></p>
<p><strong>是不是太简单了，简单到令人发指，令人痛恨，令人想吐口水！！！，没有一点技术含量</strong></p>
<p><strong>是不是太简单了，简单到令人发指，令人痛恨，令人想吐口水！！！，没有一点技术含量</strong></p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c111fc434eb24bdab83662e175520b4d~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>是的，<code>就这 😄</code>，第一次帮小姐姐解决了困扰她许久的问题，晚上就请我吃了麻辣烫，还夸我"技术"好（<code>此处不是开车</code>）</p>
<h3 data-id="heading-8">试试效果</h3>
<p>gif中前半部分没有开启自动登录的脚本需要手动登录，后半部开启了就可以自动登录了。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bf2c2bff17f74af9be500743634f5e9f~tplv-k3u1fbpfcp-watermark.image" alt="autoLogin.gif" loading="lazy" referrerpolicy="no-referrer"></p>
<h2 data-id="heading-9">拦截fetch请求，只留你想要的页面</h2>
<h3 data-id="heading-10">问题是什么？</h3>
<p><strong>前端常见的调试方式</strong></p>
<ol>
<li>chrome inspect</li>
<li>vconsole</li>
<li>weinre</li>
<li>等等</li>
</ol>
<p>这些方式都有各自的优缺点，比如chrome inspect第一次需要翻墙才能使用，只适用于安卓; vconsole不方便直接调试样式; weinre只适用于调试样式等。</p>
<p>基于这些原因，公司很久之前搞了一个远程调试工具，可以很方便的<code>增删DOM结构、调试样式、查看请求、查看application</code> 修改后手机上立即生效。</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d83d4fb42acf4f0587477d33b282becb~tplv-k3u1fbpfcp-watermark.image" alt="autoLogin2.gif" loading="lazy" referrerpolicy="no-referrer"></p>
<p><strong>远程调试平台使用流程</strong></p>
<p>他的使用流程大概是这样的</p>
<ol>
<li>
<p>打开远程调试页面列表</p>
<p><strong>此页面包含测试环境<code>所有人</code>打开的调试页面链接, 多的时候有<code>上百个</code></strong></p>
</li>
</ol>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f9f607da70444882be40471018fff3bc~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<ol start="2">
<li>点击你要调试的页面，就可以进入像chrome控制台一样调试了</li>
</ol>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c0e7d39846eb4f03b23ae2082270b7e4~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>看完流程你应该大概知道问题在哪里了, <code>远程调试页面列表不仅仅包含我自己的页面，还包括很多其他人的，导致很难快速找到自己想要调试的页面</code></p>
<h3 data-id="heading-11">该如何解决？</h3>
<p><strong>问题解析</strong></p>
<p>有什么办法能让我快速找到自己想要调试的页面呢？其实观察解析这个页面会发现列表是</p>
<ol>
<li>通过发送一个请求获取的</li>
<li>响应中包含设备关键字</li>
</ol>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c9c1ac70ebcb48db984828d525be9c8e~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p><strong>拦截请求</strong></p>
<p>所以聪明的你已经猜到了，我们可以通过<code>Object.defineProperty</code>拦截<code>fetch</code>请求，过滤设备让列表中只存在我们指定的设备（<code>毕竟平时开发时调试的设备基本是固定的，而设备完全相同的概率是很低的，所以指定了设备其实就是唯一标识了自己</code>）页面。</p>
<p>具体如何做呢？</p>
<pre><code class="hljs language-javascript copyable" lang="javascript">
<span class="hljs-comment">// ==UserScript==</span>
<span class="hljs-comment">// @name         前端远程调试设备过滤</span>
<span class="hljs-comment">// @namespace    http://tampermonkey.net/</span>
<span class="hljs-comment">// @version      0.1</span>
<span class="hljs-comment">// @description  try to take over the world!</span>
<span class="hljs-comment">// @author       You</span>
<span class="hljs-comment">// @match        https://chii-fe.xxx.com/ // 指定脚本生效的页面</span>
<span class="hljs-comment">// @grant        none</span>
<span class="hljs-comment">// @run-at       document-start // 注意这里，脚本注入的时机是document-start</span>
<span class="hljs-comment">// ==/UserScript==</span>

;(<span class="hljs-function">() =></span> &#123;
  <span class="hljs-keyword">const</span> replaceRe = <span class="hljs-regexp">/\s*/g</span>
  <span class="hljs-comment">// 在这里设置设备白名单</span>
  <span class="hljs-keyword">const</span> DEVICE_WHITE_LIST = [
      <span class="hljs-string">'Xiaomi MI 8'</span>,
      <span class="hljs-string">'iPhone9,2'</span>,
  ].map(<span class="hljs-function">(<span class="hljs-params">it</span>) =></span> it.replace(replaceRe, <span class="hljs-string">''</span>).toLowerCase())
  
  <span class="hljs-keyword">const</span> originFetch = <span class="hljs-built_in">window</span>.fetch
  <span class="hljs-keyword">const</span> recordListUrl = <span class="hljs-string">'record-list'</span>
  <span class="hljs-keyword">const</span> filterData = <span class="hljs-function">(<span class="hljs-params">source</span>) =></span> &#123;
    <span class="hljs-comment">// 数据过滤，返回DEVICE_WHITE_LIST指定的设备的数据</span>
    <span class="hljs-comment">// 详细过程省略</span>
    <span class="hljs-keyword">return</span> data
  &#125;
  <span class="hljs-comment">// 拦截fetch请求  </span>
  <span class="hljs-built_in">Object</span>.defineProperty(<span class="hljs-built_in">window</span>, <span class="hljs-string">'fetch'</span>, &#123;
    <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,
    get () &#123;
      <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">url, options</span>) </span>&#123;
        <span class="hljs-keyword">return</span> originFetch(url, options).then(<span class="hljs-function">(<span class="hljs-params">response</span>) =></span> &#123;
          <span class="hljs-comment">// 只处理指定的url</span>
          <span class="hljs-keyword">if</span> (url.includes(recordListUrl)) &#123;
            <span class="hljs-keyword">if</span> (response.clone) &#123;
              <span class="hljs-keyword">const</span> cloneRes = response.clone()

              <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =></span> &#123;
                resolve(&#123;
                  <span class="hljs-attr">text</span>: <span class="hljs-function">() =></span> &#123;
                    <span class="hljs-keyword">return</span> cloneRes.json().then(<span class="hljs-function"><span class="hljs-params">json</span> =></span> &#123;
                      <span class="hljs-keyword">return</span> filterData(<span class="hljs-built_in">JSON</span>.stringify(json))
                    &#125;);
                  &#125;
                &#125;)
              &#125;)
            &#125;
          &#125;

          <span class="hljs-keyword">return</span> response
        &#125;)
      &#125;
    &#125;
  &#125;)
&#125;)()


<span class="copy-code-btn">复制代码</span></code></pre>
<h3 data-id="heading-12">试试效果</h3>
<p>通过下图可以看出，过滤前有37个页面，过滤后只剩3个，瞬间就找到你要调试页面，再也不用从几百个页面中寻找你自己的那个啦！</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1b265791dd2e4b82bf7e3673ac793d27~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<h2 data-id="heading-13">助力全公司45+前端开发 - chrome插件的始与终</h2>
<blockquote>
<p>通过插件一键设置ua，模拟用户登录状态，提高开发效率。</p>
</blockquote>
<h3 data-id="heading-14">先看结果</h3>
<p><strong>插件使用方式</strong></p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/85e21b35a2294a1c8d64a62fb3229dbd~tplv-k3u1fbpfcp-watermark.image" alt="new.gif" loading="lazy" referrerpolicy="no-referrer"></p>
<p><strong>插件使用结果</strong></p>
<blockquote>
<p>团队48+小伙伴也使用起来了</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/819217c5d6bd4d1aba79e45b2420d152~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/902ae929ed3541ebbfac9ea76ecf4030~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<h3 data-id="heading-15">背景和问题</h3>
<blockquote>
<p>日常c端业务中有很多场景都需要用户<code>登录后</code>才能正常进行，而开发阶段基本都是通过chrome模拟手机设备来开发，所以往往会涉及到在chrome浏览器中模拟用户登录，其涉及以下三步(<code>这个步骤比较繁琐</code>)。</p>
</blockquote>
<p><strong>备注：保持用户的登录态一般是通过cookie，但也有通过header来做，比如我们公司是改写ua来做的</strong></p>
<ol>
<li><code>获取ua</code>： 前往公司UA生成平台输入手机号生成ua</li>
<li><code>添加ua</code>： 将ua复制到chrome devtool<code>设置/修改</code>device</li>
<li><code>使用ua</code>： 选择新添加的ua，刷新页面，重新开发调试</li>
</ol>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d7c3dd39312641fa80e50008dedbcbc6~tplv-k3u1fbpfcp-watermark.image" alt="ua.gif" loading="lazy" referrerpolicy="no-referrer"></p>
<p><strong>来看一段对话</strong></p>
<blockquote>
<p>隔壁98年刚毕业妹子：</p>
</blockquote>
<p><code>又过期了，谁又把我挤下去了嘛</code></p>
<p><code>好的，稍等一会哈，我换个账号测测</code></p>
<p><code>好麻烦哎！模拟一个用户信息，要这么多步骤，好烦呀！！！</code></p>
<blockquote>
<p>我，好奇的大叔：</p>
</blockquote>
<p>“细心”了解下，她正在做一个h5活动项目，场景复杂，涉及的状态很多，需要用<strong>不同的账号</strong>来做测试。</p>
<p><code>模拟一两个用户还好，但是此刻小姐姐测这么多场景，已经模拟了好多个（谁都会烦啊）</code></p>
<p><code>公司的登录体系是单点登录，一个好不容易模拟的账号，有可能别人也在用，结果又被顶掉了，得重新生成，我TM</code></p>
<p>看着她快气哭的小眼神，作为隔壁桌友好的邻居，此刻我心里只想着一件事...！帮她解决这个恼人的问题。</p>
<h3 data-id="heading-16">分析和解决问题</h3>
<blockquote>
<p>通过上面的介绍您应该可以感觉到我们开发阶段遇到需要频繁切换账号做测试时的烦恼，相对繁琐的ua生成过程导致了它一定是个<code>费时费力</code>的麻烦事。</p>
</blockquote>
<p>有没有什么办法让我们的开发效率得到提升，别浪费在这种事情上呢？一起一步步做起来</p>
<p><strong>需求有哪些</strong></p>
<blockquote>
<p>提供一种便捷地模拟ua的方式，助力开发效率提升。</p>
</blockquote>
<ol>
<li><code>基本诉求</code>：本地开发阶段，希望有<strong>更便捷</strong>的方式来模拟用户登录</li>
<li><code>多账号</code>： 一个项目需要多个账号，不同项目间的账号可以共享也可以不同</li>
<li><code>指定域</code>: 只有指定的<code>域</code>下才需要模拟ua，不能影响浏览器正常使用</li>
<li><code>过期处理</code>: 账号过期后，可以主动生成，无需手动重新获取</li>
</ol>
<p><strong>如何解决</strong></p>
<ol>
<li>
<p><code>需求1</code>：结合前面生成ua阶段，我们可以通过某种方式让用户能直接在当前页面生成ua，无需跳出，一键设置省略手动过程</p>
</li>
<li>
<p><code>需求2</code>：提供多账号管理功能，能直接选中切换ua</p>
</li>
<li>
<p><code>需求3</code>：限定指定域，该ua才生效</p>
</li>
<li>
<p><code>需求4</code>：当使用到过期账号时，可一键重新生成即可</p>
</li>
</ol>
<p><strong>为什么是chrome插件</strong></p>
<ol>
<li>
<p>浏览器中发送<strong>ajax请求的ua</strong>无法直接修改，但是chrome插件可以修改请求的ua（<strong>很重要的一点</strong>）</p>
</li>
<li>
<p>chrome插件popup模式可直接在当前页面打开，无需跳出开发页面，减少跳出过程</p>
</li>
</ol>
<h3 data-id="heading-17">用vue从零开始写一个chrome插件</h3>
<blockquote>
<p>篇幅原因，这里只做示例级别的简单介绍，如果您希望详细了解chrome插件的编写可以<a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.cnblogs.com%2Fliuxianan%2Fp%2Fchrome-plugin-develop.html%23%25E5%2586%2599%25E5%259C%25A8%25E5%2589%258D%25E9%259D%25A2" target="_blank" rel="nofollow noopener noreferrer" title="https://www.cnblogs.com/liuxianan/p/chrome-plugin-develop.html#%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2" ref="nofollow noopener noreferrer">参考这里</a></p>
</blockquote>
<h4 data-id="heading-18">从一个小例子开始</h4>
<blockquote>
<p>接下来我们会以下页面为例，说明用vue如何写出来。</p>
</blockquote>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ad0509fefa01426fb58640f850841b94~tplv-k3u1fbpfcp-watermark.image" alt="ua3.gif" loading="lazy" referrerpolicy="no-referrer"></p>
<p><strong>基本功能</strong></p>
<ol>
<li>
<p><strong>底部tab切换区域</strong>：<code>viewA</code>、<code>viewB</code>、<code>viewC</code></p>
</li>
<li>
<p><strong>中间内容区域</strong>：切换viewA、B、C分别展示对应的页面</p>
</li>
</ol>
<p><strong>content部分</strong></p>
<p>借助chrome浏览器可以向网页插入脚本的特性，我们会演示如何插入脚本并且在网页加载的时候弹一个<code>hello world</code></p>
<p><strong>popup与background通信部分</strong></p>
<p>popup完成用户的主要交互，在viewA页面点击获取自定义的ua信息</p>
<p><strong>修改ajax请求ua部分</strong></p>
<p>会演示如果通过chrome插件修改请求header</p>
<h4 data-id="heading-19">1. 了解一个chrome插件的构成</h4>
<ol>
<li>manifest.json</li>
<li>background script</li>
<li>content script</li>
<li>popup</li>
</ol>
<p><strong>1. manifest.json</strong></p>
<blockquote>
<p>几乎所有的东西都要在这里进行声明、<code>权限</code>、<code>资源</code>、<code>页面</code>等等</p>
</blockquote>
<pre><code class="hljs language-javascript copyable" lang="javascript">
&#123;
  <span class="hljs-string">"manifest_version"</span>: <span class="hljs-number">2</span>, <span class="hljs-comment">// 清单文件的版本，这个必须写</span>
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"hello vue extend"</span>, <span class="hljs-comment">// 插件的名称，等会我们写的插件名字就叫hello vue extend</span>
  <span class="hljs-string">"description"</span>: <span class="hljs-string">"hello vue extend"</span>, <span class="hljs-comment">// 插件描述</span>
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"0.0.1"</span>, <span class="hljs-comment">// 插件的版本</span>
  <span class="hljs-comment">// 图标，写一个也行</span>
  <span class="hljs-string">"icons"</span>: &#123;
    <span class="hljs-string">"48"</span>: <span class="hljs-string">"img/logo.png"</span>
  &#125;,
  <span class="hljs-comment">// 浏览器右上角图标设置，browser_action、page_action、app必须三选一</span>
  <span class="hljs-string">"browser_action"</span>: &#123;
    <span class="hljs-string">"default_icon"</span>: <span class="hljs-string">"img/logo.png"</span>,
    <span class="hljs-string">"default_title"</span>: <span class="hljs-string">"hello vue extend"</span>,
    <span class="hljs-string">"default_popup"</span>: <span class="hljs-string">"popup.html"</span>
  &#125;,
  <span class="hljs-comment">// 一些常驻的后台JS或后台页面</span>
  <span class="hljs-string">"background"</span>: &#123;
    <span class="hljs-string">"scripts"</span>: [
      <span class="hljs-string">"js/hot-reload.js"</span>,
      <span class="hljs-string">"js/background.js"</span>
    ]
  &#125;,
  <span class="hljs-comment">// 需要直接注入页面的JS</span>
  <span class="hljs-string">"content_scripts"</span>: [&#123;
    <span class="hljs-string">"matches"</span>: [<span class="hljs-string">"<all_urls>"</span>],
    <span class="hljs-string">"js"</span>: [<span class="hljs-string">"js/content.js"</span>],
    <span class="hljs-string">"run_at"</span>: <span class="hljs-string">"document_start"</span>
  &#125;],
  <span class="hljs-comment">// devtools页面入口，注意只能指向一个HTML文件</span>
  <span class="hljs-string">"devtools_page"</span>: <span class="hljs-string">"devcreate.html"</span>,
  <span class="hljs-comment">// Chrome40以前的插件配置页写法</span>
  <span class="hljs-string">"options_page"</span>: <span class="hljs-string">"options.html"</span>,
  <span class="hljs-comment">// 权限申请</span>
  <span class="hljs-string">"permissions"</span>: [
    <span class="hljs-string">"storage"</span>,
    <span class="hljs-string">"webRequest"</span>,
    <span class="hljs-string">"tabs"</span>,
    <span class="hljs-string">"webRequestBlocking"</span>,
    <span class="hljs-string">"<all_urls>"</span>
  ]
&#125;

<span class="copy-code-btn">复制代码</span></code></pre>
<p><strong>2. background script</strong></p>
<blockquote>
<p>后台，可以认为是一个常驻的页面，权限很高，几乎可以调用所有的API，可以与popup、content script等通信</p>
</blockquote>
<p><strong>3. content script</strong></p>
<blockquote>
<p>chrome插件向页面注入脚本的一种形式（js和css都可以）</p>
</blockquote>
<p><strong>4. popup</strong></p>
<blockquote>
<p><code>popup</code>是点击<code>browser_action</code>或者<code>page_action</code>图标时打开的一个小窗口网页，焦点离开网页就立即关闭。</p>
</blockquote>
<p>比如我们要用vue做的页面。</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a0611900325745a0a58984da164b4345~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<h4 data-id="heading-20">2. 改写vue.config.js</h4>
<blockquote>
<p>manifest.json对文件引用的结构基本决定了打包后的文件路径</p>
</blockquote>
<p><strong>打包后的路径</strong></p>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">// dist目录用来chrome扩展导入</span>

├── dist
│   ├── favicon.ico
│   ├── img
│   │   └── logo.png
│   ├── js
│   │   ├── background.js
│   │   ├── chunk-vendors.js
│   │   ├── content.js
│   │   ├── hot-reload.js
│   │   └── popup.js
│   ├── manifest.json
│   └── popup.html

<span class="copy-code-btn">复制代码</span></code></pre>
<p><strong>源码目录</strong></p>
<pre><code class="hljs language-javascript copyable" lang="javascript">
├── README.md
├── babel.config.js
├── package-lock.json
├── package.json
├── public
│   ├── favicon.ico
│   ├── index.html
│   └── js
│       └── hot-reload.js
├── src
│   ├── assets
│   │   ├── <span class="hljs-number">01</span>.png
│   │   ├── disabled.png
│   │   └── logo.png
│   ├── background
│   │   └── background.js
│   ├── content
│   │   └── content.js
│   ├── manifest.json
│   ├── popup
│   │   ├── App.vue
│   │   ├── main.js
│   │   ├── router.js
│   │   └── views
│   │       ├── viewA.vue
│   │       ├── viewB.vue
│   │       └── viewC.vue
│   └── utils
│       ├── base.js
│       ├── fixCaton.js
│       └── storage.js
└── vue.config.js


<span class="copy-code-btn">复制代码</span></code></pre>
<p><strong>修改vue.config.js</strong></p>
<blockquote>
<p>主需要稍微改造变成可以多页打包，注意输出的目录结构就可以了</p>
</blockquote>
<pre><code class="hljs language-javascript copyable" lang="javascript">
<span class="hljs-keyword">const</span> CopyWebpackPlugin = <span class="hljs-built_in">require</span>(<span class="hljs-string">'copy-webpack-plugin'</span>)
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>)
<span class="hljs-comment">// 这里考虑可以添加多页</span>
<span class="hljs-keyword">const</span> pagesObj = &#123;&#125;
<span class="hljs-keyword">const</span> chromeName = [<span class="hljs-string">'popup'</span>]
<span class="hljs-keyword">const</span> plugins = [
  &#123;
    <span class="hljs-attr">from</span>: path.resolve(<span class="hljs-string">'src/manifest.json'</span>),
    <span class="hljs-attr">to</span>: <span class="hljs-string">`<span class="hljs-subst">$&#123;path.resolve(<span class="hljs-string">'dist'</span>)&#125;</span>/manifest.json`</span>
  &#125;,
  &#123;
    <span class="hljs-attr">from</span>: path.resolve(<span class="hljs-string">'src/assets/logo.png'</span>),
    <span class="hljs-attr">to</span>: <span class="hljs-string">`<span class="hljs-subst">$&#123;path.resolve(<span class="hljs-string">'dist'</span>)&#125;</span>/img/logo.png`</span>
  &#125;,
  &#123;
    <span class="hljs-attr">from</span>: path.resolve(<span class="hljs-string">'src/background/background.js'</span>),
    <span class="hljs-attr">to</span>: <span class="hljs-string">`<span class="hljs-subst">$&#123;path.resolve(<span class="hljs-string">'dist'</span>)&#125;</span>/js/background.js`</span>
  &#125;,
  &#123;
    <span class="hljs-attr">from</span>: path.resolve(<span class="hljs-string">'src/content/content.js'</span>),
    <span class="hljs-attr">to</span>: <span class="hljs-string">`<span class="hljs-subst">$&#123;path.resolve(<span class="hljs-string">'dist'</span>)&#125;</span>/js/content.js`</span>
  &#125;,
]

chromeName.forEach(<span class="hljs-function"><span class="hljs-params">name</span> =></span> &#123;
  pagesObj[name] = &#123;
    <span class="hljs-attr">css</span>: &#123;
      <span class="hljs-attr">loaderOptions</span>: &#123;
        <span class="hljs-attr">less</span>: &#123;
          <span class="hljs-attr">modifyVars</span>: &#123;&#125;,
          <span class="hljs-attr">javascriptEnabled</span>: <span class="hljs-literal">true</span>
        &#125;
      &#125;
    &#125;,
    <span class="hljs-attr">entry</span>: <span class="hljs-string">`src/<span class="hljs-subst">$&#123;name&#125;</span>/main.js`</span>,
    <span class="hljs-attr">filename</span>: <span class="hljs-string">`<span class="hljs-subst">$&#123;name&#125;</span>.html`</span>
  &#125;
&#125;)

<span class="hljs-keyword">const</span> vueConfig = &#123;
  <span class="hljs-attr">lintOnSave</span>:<span class="hljs-literal">false</span>, <span class="hljs-comment">//关闭eslint检查</span>
  <span class="hljs-attr">pages</span>: pagesObj,
  <span class="hljs-attr">configureWebpack</span>: &#123;
    <span class="hljs-attr">entry</span>: &#123;&#125;,
    <span class="hljs-attr">output</span>: &#123;
      <span class="hljs-attr">filename</span>: <span class="hljs-string">'js/[name].js'</span>
    &#125;,
    <span class="hljs-attr">plugins</span>: [<span class="hljs-keyword">new</span> CopyWebpackPlugin(plugins)]
  &#125;,
  <span class="hljs-attr">filenameHashing</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">productionSourceMap</span>: <span class="hljs-literal">false</span>
&#125;

<span class="hljs-built_in">module</span>.exports = vueConfig


<span class="copy-code-btn">复制代码</span></code></pre>
<h4 data-id="heading-21">3. 热刷新</h4>
<blockquote>
<p>我们希望修改插件源代码进行打包之后，chrome插件对应的页面能主动更新。为什么叫热刷新而不是热更新呢？因为它其实是全局刷新页面，并不会保存状态。</p>
</blockquote>
<p>这里推荐一个github上的解决方案<a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fxpl%2Fcrx-hotreload" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/xpl/crx-hotreload" ref="nofollow noopener noreferrer">crx-hotreload</a></p>
<h4 data-id="heading-22">4. 完成小例子编写</h4>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/85e21b35a2294a1c8d64a62fb3229dbd~tplv-k3u1fbpfcp-watermark.image" alt="new.gif" loading="lazy" referrerpolicy="no-referrer"></p>
<p><strong>文件目录结构</strong></p>
<pre><code class="hljs language-javascript copyable" lang="javascript">
├── popup
│   ├── App.vue
│   ├── main.js
│   ├── router.js
│   └── views
│       ├── viewA.vue
│       ├── viewB.vue
│       └── viewC.vue


<span class="copy-code-btn">复制代码</span></code></pre>
<p><strong>main.js</strong></p>
<pre><code class="hljs language-javascript copyable" lang="javascript">
<span class="hljs-keyword">import</span> Vue <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> App <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>
<span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">'./router'</span>

Vue.config.productionTip = <span class="hljs-literal">false</span>

<span class="hljs-keyword">new</span> Vue(&#123;
  router,
  <span class="hljs-attr">render</span>: <span class="hljs-function"><span class="hljs-params">h</span> =></span> h(App)
&#125;).$mount(<span class="hljs-string">'#app'</span>)


<span class="copy-code-btn">复制代码</span></code></pre>
<p><strong>router.js</strong></p>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-keyword">import</span> Vue <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> Router <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>

<span class="hljs-keyword">import</span> ViewA <span class="hljs-keyword">from</span> <span class="hljs-string">'./views/viewA.vue'</span>
<span class="hljs-keyword">import</span> ViewB <span class="hljs-keyword">from</span> <span class="hljs-string">'./views/viewB.vue'</span>
<span class="hljs-keyword">import</span> ViewC <span class="hljs-keyword">from</span> <span class="hljs-string">'./views/viewC.vue'</span>

Vue.use(Router)

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">new</span> Router(&#123;
  <span class="hljs-attr">mode</span>: <span class="hljs-string">'history'</span>,
  <span class="hljs-attr">base</span>: process.env.BASE_URL,
  <span class="hljs-attr">routes</span>: [
    &#123;
      <span class="hljs-attr">path</span>: <span class="hljs-string">'/'</span>,
      <span class="hljs-attr">name</span>: <span class="hljs-string">'home'</span>,
      <span class="hljs-attr">redirect</span>: <span class="hljs-string">'/view/a'</span>
    &#125;,
    &#123;
      <span class="hljs-attr">path</span>: <span class="hljs-string">'/view/a'</span>,
      <span class="hljs-attr">name</span>: <span class="hljs-string">'viewA'</span>,
      <span class="hljs-attr">component</span>: ViewA,
    &#125;,
    &#123;
      <span class="hljs-attr">path</span>: <span class="hljs-string">'/view/b'</span>,
      <span class="hljs-attr">name</span>: <span class="hljs-string">'viewB'</span>,
      <span class="hljs-attr">component</span>: ViewB,
    &#125;,
    &#123;
      <span class="hljs-attr">path</span>: <span class="hljs-string">'/view/c'</span>,
      <span class="hljs-attr">name</span>: <span class="hljs-string">'viewC'</span>,
      <span class="hljs-attr">component</span>: ViewC,
    &#125;,
  ]
&#125;)


<span class="copy-code-btn">复制代码</span></code></pre>
<p><strong>App.vue</strong></p>
<pre><code class="hljs language-javascript copyable" lang="javascript">
<template>
  <span class="xml"><span class="hljs-tag"><<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>></span>
    <span class="hljs-tag"><<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"app-router"</span>></span>
      <span class="hljs-tag"><<span class="hljs-name">router-view</span> /></span>
    <span class="hljs-tag"></<span class="hljs-name">div</span>></span>
    <span class="hljs-tag"><<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"app-tab"</span>></span>
      <span class="hljs-tag"><<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"app-tab-item"</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(tabName, i) in tabs"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"i"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"onToView(tabName)"</span>></span>
        &#123;&#123; tabName &#125;&#125;
      <span class="hljs-tag"></<span class="hljs-name">div</span>></span>
    <span class="hljs-tag"></<span class="hljs-name">div</span>></span>
  <span class="hljs-tag"></<span class="hljs-name">div</span>></span></span>
</template>

<span class="xml"><span class="hljs-tag"><<span class="hljs-name">script</span>></span><span class="javascript">

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;
  <span class="hljs-attr">name</span>: <span class="hljs-string">'App'</span>,
  data () &#123;
    <span class="hljs-keyword">return</span> &#123;
      <span class="hljs-attr">tabs</span>: [
        <span class="hljs-string">'viewA'</span>,
        <span class="hljs-string">'viewB'</span>,
        <span class="hljs-string">'viewC'</span>,
      ]
    &#125;
  &#125;,
  <span class="hljs-attr">methods</span>: &#123;
    onToView (name) &#123;
      <span class="hljs-built_in">this</span>.$router.push(&#123;
        name
      &#125;)
    &#125;
  &#125;
&#125;
</span><span class="hljs-tag"></<span class="hljs-name">script</span>></span></span>

<span class="xml"><span class="hljs-tag"><<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"less"</span>></span><span class="css">
<span class="hljs-selector-id">#app</span> &#123;
  <span class="hljs-attribute">font-family</span>: Avenir, Helvetica, Arial, sans-serif;
  -webkit-<span class="hljs-attribute">font-smoothing</span>: antialiased;
  -moz-osx-<span class="hljs-attribute">font-smoothing</span>: grayscale;
  <span class="hljs-attribute">text-align</span>: center;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#2c3e50</span>;

  <span class="hljs-attribute">width</span>: <span class="hljs-number">375px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">15px</span>;
  <span class="hljs-attribute">box-sizing</span>: border-box;

  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">justify-content</span>: space-between;
  <span class="hljs-attribute">flex-direction</span>: column;

  <span class="hljs-selector-class">.app-router</span>&#123;
    <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>;
  &#125;

  <span class="hljs-selector-class">.app-tab</span>&#123;
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">align-items</span>: center;
    <span class="hljs-attribute">justify-content</span>: space-between;

    <span class="hljs-selector-class">.app-tab-item</span>&#123;
      <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;
      <span class="hljs-attribute">color</span>: coral;
      <span class="hljs-attribute">cursor</span>: pointer;
    &#125;
  &#125;
&#125;

</span><span class="hljs-tag"></<span class="hljs-name">style</span>></span></span>


<span class="copy-code-btn">复制代码</span></code></pre>
<p><strong>viewA、viewB、viewC</strong></p>
<blockquote>
<p>三个页面基本长得是一样的，只有背景色和文案内容不一样，这里我就只贴viewA的代码了。</p>
</blockquote>
<p>需要注意的是这里会演示<a href="https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.chrome.com%2Fdocs%2Fextensions%2Freference%2Fruntime%2F%23method-sendMessage" target="_blank" rel="nofollow noopener noreferrer" title="https://developer.chrome.com/docs/extensions/reference/runtime/#method-sendMessage" ref="nofollow noopener noreferrer">popup与background</a>,通过sendMessage方法获取background后台数据</p>
<pre><code class="hljs language-javascript copyable" lang="javascript">
<template>
  <span class="xml"><span class="hljs-tag"><<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"view-a"</span>></span>我是A页面

    <span class="hljs-tag"><<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"onGetCUstomUa"</span>></span>获取自定义ua<span class="hljs-tag"></<span class="hljs-name">button</span>></span>
  <span class="hljs-tag"></<span class="hljs-name">div</span>></span></span>
</template>

<span class="xml"><span class="hljs-tag"><<span class="hljs-name">script</span>></span><span class="javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;
  <span class="hljs-attr">name</span>: <span class="hljs-string">'viewA'</span>,
  <span class="hljs-attr">methods</span>: &#123;
    onGetCUstomUa () &#123;
      
      chrome.runtime.sendMessage(&#123;<span class="hljs-attr">type</span>: <span class="hljs-string">'getCustomUserAgent'</span>&#125;, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>&#123;
        alert(<span class="hljs-built_in">JSON</span>.stringify(response))
      &#125;)
    &#125;
  &#125;
&#125;
</span><span class="hljs-tag"></<span class="hljs-name">script</span>></span></span>

<span class="xml"><span class="hljs-tag"><<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"less"</span>></span><span class="css">
<span class="hljs-selector-class">.view-a</span>&#123;
  <span class="hljs-attribute">background-color</span>: cadetblue;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">60px</span>;
&#125;
</span><span class="hljs-tag"></<span class="hljs-name">style</span>></span></span>


<span class="copy-code-btn">复制代码</span></code></pre>
<p><strong>background.js</strong></p>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-keyword">const</span> customUa = <span class="hljs-string">'hello world ua'</span>
<span class="hljs-comment">// 请求发送前拦截</span>
<span class="hljs-keyword">const</span> onBeforeSendCallback = <span class="hljs-function">(<span class="hljs-params">details</span>) =></span> &#123;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i < details.requestHeaders.length; ++i) &#123;
    <span class="hljs-keyword">if</span> (details.requestHeaders[i].name === <span class="hljs-string">'User-Agent'</span>) &#123;
      details.requestHeaders.splice(i, <span class="hljs-number">1</span>);
      <span class="hljs-keyword">break</span>;
    &#125;
  &#125;
  <span class="hljs-comment">// 修改请求UA为hello world ua</span>
  details.requestHeaders.push(&#123;
    <span class="hljs-attr">name</span>: <span class="hljs-string">'User-Agent'</span>,
    <span class="hljs-attr">value</span>: customUa
  &#125;);
  
  <span class="hljs-keyword">return</span> &#123; <span class="hljs-attr">requestHeaders</span>: details.requestHeaders &#125;;
&#125;

<span class="hljs-comment">// 前面的sendMessage获取getCustomUserAgent，会被这里监听</span>
<span class="hljs-keyword">const</span> onRuntimeMessageListener = <span class="hljs-function">() =></span> &#123;
  chrome.runtime.onMessage.addListener(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">msg, sender, callback</span>) </span>&#123;
    <span class="hljs-keyword">if</span> (msg.type === <span class="hljs-string">'getCustomUserAgent'</span>) &#123;
      callback(&#123;
        customUa
      &#125;);
    &#125;
  &#125;);
&#125;

<span class="hljs-keyword">const</span> init = <span class="hljs-function">() =></span> &#123;
  onRuntimeMessageListener()
  onBeforeSendHeadersListener()
&#125;

init()

<span class="copy-code-btn">复制代码</span></code></pre>
<p><strong>content.js</strong></p>
<blockquote>
<p>演示如何往网页中插入代码</p>
</blockquote>
<pre><code class="hljs language-javascript copyable" lang="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setScript</span>(<span class="hljs-params">&#123; code = <span class="hljs-string">''</span>, needRemove = <span class="hljs-literal">true</span> &#125; = params</span>) </span>&#123;
  <span class="hljs-keyword">let</span> textNode = <span class="hljs-built_in">document</span>.createTextNode(code)
  <span class="hljs-keyword">let</span> script = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'script'</span>)

  script.appendChild(textNode)
  script.remove()

  <span class="hljs-keyword">let</span> parentNode = <span class="hljs-built_in">document</span>.head || <span class="hljs-built_in">document</span>.documentElement

  parentNode.appendChild(script)
  needRemove && parentNode.removeChild(script)
&#125;

setScript(&#123;
  <span class="hljs-attr">code</span>: <span class="hljs-string">`alert ('hello world')`</span>,
&#125;)


<span class="copy-code-btn">复制代码</span></code></pre>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ad0509fefa01426fb58640f850841b94~tplv-k3u1fbpfcp-watermark.image" alt="ua3.gif" loading="lazy" referrerpolicy="no-referrer"></p>
<h3 data-id="heading-23">关于一键设置ua插件</h3>
<blockquote>
<p>大体上和小例子差不都，只是功能相对复杂一些，会涉及到</p>
</blockquote>
<ol>
<li>
<p>数据本地存储<code>chrome.storage.sync.get|set</code>、<code>chrome.tabs.query</code>等API</p>
</li>
<li>
<p>popup与background通信、content与background通信</p>
</li>
<li>
<p>拦截请求修改UA</p>
</li>
<li>
<p>其他的大体就是常规的vue代码编写啦！</p>
</li>
</ol>
<p>这里就不贴详细的代码实现了。</p>
<h2 data-id="heading-24">日常提效的一些思考</h2>
<blockquote>
<p>工作中咱们时长会遇到一些阻碍我们提高工作效率的问题，这些问题或许是因为老方案设计不合理、或许是因为流程又臭又长，又或许是现有功能不满足新的需求。等等，如果能做到这几点，不仅对自己的成长有所帮助，对团队也会有所贡献。</p>
</blockquote>
<ol>
<li>
<p><code>主人翁心态</code>： 发现了问题主动尝试去解决问题，不做旁观者</p>
</li>
<li>
<p><code>保持学习力</code>： 发现问题之后，解决方案如果不在你的知识储备范围，一定要尝试去学习新的东西（<strong>惭愧，没写一键设置UA插件之前，我自己完全没写过chrome插件</strong>），走出舒适圈，会学会更多</p>
</li>
<li>
<p><code>保持热心态</code>：每个人遇到的问题是不一样的，主动和同事或者朋友讨论，需要时伸出你的双手</p>
</li>
<li>
<p><code>执行力</code>：把影响效率(举例，还有其他)的事情看成魔鬼，马上行动起来，达到魔鬼，不要一拖再拖</p>
</li>
<li>
<p><code>学会推广</code>：也许一开始你写的插件只是解决了自己的问题，但同样的工作环境，别人也许也会遇到，要学会往外分享和推广</p>
</li>
</ol>
<h2 data-id="heading-25">相约再见</h2>
<blockquote>
<p>以上就是这篇文章的全部内容啦！愿大家晚安🌛，下次再见。</p>
</blockquote>
<h2 data-id="heading-26">参考</h2>
<ol>
<li>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.cnblogs.com%2Fliuxianan%2Fp%2Fchrome-plugin-develop.html" target="_blank" rel="nofollow noopener noreferrer" title="https://www.cnblogs.com/liuxianan/p/chrome-plugin-develop.html" ref="nofollow noopener noreferrer">【干货】Chrome插件(扩展)开发全攻略</a></p>
</li>
<li>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fsegmentfault.com%2Fa%2F1190000021654926" target="_blank" rel="nofollow noopener noreferrer" title="https://segmentfault.com/a/1190000021654926" ref="nofollow noopener noreferrer">油猴脚本编写教程</a></p>
</li>
</ol></div>  
</div>
            