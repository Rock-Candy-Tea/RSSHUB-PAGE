
---
title: '【中台】靓仔请留步，跟我一起撸中后台啊~（系列篇二：项目配置及依赖 ）'
categories: 
 - 编程
 - 掘金
 - 分类
headimg: 'https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cb8773662f7041839b700b1e62ef4541~tplv-k3u1fbpfcp-watermark.image'
author: 掘金
comments: false
date: Sun, 02 May 2021 06:42:13 GMT
thumbnail: 'https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cb8773662f7041839b700b1e62ef4541~tplv-k3u1fbpfcp-watermark.image'
---

<div>   
<div class="markdown-body"><style>@charset "UTF-8";.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:#353535&#125;.markdown-body h1&#123;padding-bottom:4px;font-size:30px&#125;.markdown-body h1,.markdown-body h2&#123;margin-top:36px;margin-bottom:10px;line-height:1.5;color:#005bb7&#125;.markdown-body h2&#123;position:relative;padding-left:16px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h2:before&#123;content:"「";position:absolute;top:-6px;left:-10px&#125;.markdown-body h2:after&#123;content:"」";position:absolute;top:6px;right:auto&#125;.markdown-body h3&#123;position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:#005bb7;padding-left:6px&#125;.markdown-body h3:before&#123;content:"»";padding-right:6px;color:#2196f3&#125;.markdown-body h4&#123;margin-top:24px;font-size:16px&#125;.markdown-body h4,.markdown-body h5&#123;padding-bottom:0;margin-bottom:10px;line-height:1.5;color:#005bb7;padding-left:6px&#125;.markdown-body h5&#123;margin-top:18px;font-size:14px&#125;.markdown-body h6&#123;padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:#005bb7;padding-left:6px&#125;.markdown-body p&#123;line-height:inherit;margin-top:16px;margin-bottom:16px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,#007fff,rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),#007fff);border-width:0;overflow:visible&#125;.markdown-body hr:after&#123;content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background:#fff;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center&#125;.markdown-body code&#123;padding:.065em .4em;font-size:.87em;color:#c2185b;word-break:break-word;overflow-x:auto;background-color:#fff4f4;border-radius:2px&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8&#125;.markdown-body pre>code::-webkit-scrollbar&#123;width:4px;height:4px&#125;.markdown-body pre>code::-webkit-scrollbar-track&#123;background-color:#bedcff&#125;.markdown-body pre>code::-webkit-scrollbar-thumb&#123;background-color:#2196f3;border-radius:10px&#125;.markdown-body a&#123;position:relative;text-decoration:none;color:#3da8f5;border-bottom:1px solid #bedcff&#125;.markdown-body a:hover&#123;color:#007fff;border-bottom-color:#007fff&#125;.markdown-body a:active&#123;color:#007fff&#125;.markdown-body a:after&#123;position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid #bedcff;transition:top .3s,opacity .3s;transform:translateZ(0)&#125;.markdown-body a:hover:after&#123;top:0;opacity:1;border-bottom-color:#007fff&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #c3e0fd;border-spacing:0;border-collapse:collapse&#125;.markdown-body table thead&#123;color:#000;text-align:left;font-size:14px;background:#f6f6f6&#125;.markdown-body table tr:nth-child(2n)&#123;background-color:#f7fbff&#125;.markdown-body table tr:hover&#123;background-color:#e0edf7&#125;.markdown-body table td,.markdown-body table th&#123;padding:12px 8px;line-height:24px;border:1px solid #c3e0fd&#125;.markdown-body table th&#123;color:#005bb7;background-color:#dff0ff&#125;.markdown-body table td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#8c8c8c;border-left:4px solid #2196f3;background-color:#f0fdff;padding:1px 20px;margin:22px 0&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body b,.markdown-body blockquote>b,.markdown-body blockquote>strong,.markdown-body strong&#123;color:#2196f3&#125;.markdown-body em,.markdown-body i&#123;color:#4fc3f7&#125;.markdown-body del&#123;color:#ccc&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:4px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body details>summary&#123;outline:none;color:#005bb7;font-size:20px;font-weight:bolder;border-bottom:1px solid #bedcff;cursor:pointer&#125;.markdown-body details>p&#123;padding:10px 20px;margin:10px 0 0;color:#666;background-color:#f0fdff;border:2px dashed #2196f3&#125;.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection&#123;color:#005bb7;background-color:rgba(160,200,255,.15)&#125;.markdown-body p::selection&#123;color:#c80000&#125;.markdown-body a::selection,.markdown-body b::selection,.markdown-body del::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection&#123;background-color:transparent&#125;.markdown-body code::selection&#123;background-color:#ffeaeb&#125;.markdown-body pre>code::selection&#123;background-color:rgba(160,200,255,.25)&#125;.markdown-body ol ::selection,.markdown-body ul ::selection&#123;background-color:rgba(160,200,255,.15)&#125;.markdown-body .contains-task-list&#123;padding-left:14px;list-style:none&#125;.markdown-body .contains-task-list input[type=checkbox]&#123;position:relative&#125;.markdown-body .contains-task-list input[type=checkbox]:before&#123;content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1&#125;.markdown-body .contains-task-list input[type=checkbox]:checked:after&#123;content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><hr>
<h1 data-id="heading-0">前言</h1>
<p>啰嗦几句哈，<code>系列篇一</code> 中的 <code>Demo</code> 项目不会作为正式的项目，在写那个Demo项目时，<code>Vue3</code> 还没有出来，在 <code>Vue2.0</code> 里面写 <code>TypeScript</code> 是比较麻烦的，但是通过 <code>vue-class-component</code> 写起来就还不错，虽然要去熟悉好多新的东西，增加了心理压力哈哈哈哈~~~</p>
<p>终于啊，<code>Vue3</code> 出来了，天然支持 <code>TypeScript</code>，我们再也不用增加那么多心智负担了，废话就不说了，直接撸起袖子干。</p>
<h1 data-id="heading-1">环境依赖</h1>
<pre><code class="copyable">- node v14.15.1 
- npm 7.7.2
- qiankun ^2.4.1
- @vue/cli 4.5.11 
- Vue3 ^3.0.0
- Typescript ~3.9.3
- ant-design-vue ^2.0.0
- vue-router ^4.0.4
- vuex 4.0
<span class="copy-code-btn">复制代码</span></code></pre>
<h1 data-id="heading-2">初始化项目</h1>
<p>通过 <code>vue create project-name</code> 创建项目</p>
<p>选择 <code> Manually select features</code></p>
<p>选择 <code>TypeScript</code>，选择 <code>3.x (Preview)</code></p>
<p>在初始化项目的时候，最好是安装 <code>vue-router</code> 和 <code>vuex</code>，因为这也是我们项目中必须要的依赖，否则我们在写的过程中还需要手动去添加！</p>
<p>选择 <code>ESLint + Standard config</code>，<code>Lint on save</code>，</p>
<p>选择<code>In dedicated config files</code>，在专用配置文件中配置各自的信息</p>
<p>选择 <code>Save this as a preset for future projects?</code> <code>Yes</code>，将配置保存为未来项目的预设，将来创建项目就可以直接选择你的模板了。</p>
<p>最后回车，静静的等待就好了。</p>
<p>具体配置如图所示:</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cb8773662f7041839b700b1e62ef4541~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>项目初始化完成之后，打开项目看到如下目录结构:</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/287881f615ff491f8f1610d472ad17e6~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>然后我们随便改点东西试试：</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b19cb055842a45f1bb0e9c8877ddd5a7~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>到此我们的 <code>Vue3</code> + <code>TypeScript</code> 项目就创建好了。</p>
<h2 data-id="heading-3">ant-design-vue 2.0</h2>
<h3 data-id="heading-4">安装</h3>
<pre><code class="copyable">npm install ant-design-vue@^2.0.0 -S

yarn add ant-design-vue@^2.0.0 -S
<span class="copy-code-btn">复制代码</span></code></pre>
<h3 data-id="heading-5">按需引入</h3>
<p>安装 <code>babel-plugin-import</code> 插件</p>
<p>修改 <code>babel.config.js</code></p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-built_in">module</span>.exports = &#123;
  <span class="hljs-attr">presets</span>: [
    <span class="hljs-string">'@vue/cli-plugin-babel/preset'</span>
  ],
  <span class="hljs-attr">plugins</span>: [
    [
      <span class="hljs-string">"import"</span>,
      &#123; <span class="hljs-attr">libraryName</span>: <span class="hljs-string">'ant-design-vue'</span>, <span class="hljs-attr">libraryDirectory</span>: <span class="hljs-string">"es"</span>, <span class="hljs-attr">style</span>: <span class="hljs-literal">true</span> &#125;
    ]
  ]
&#125;

<span class="copy-code-btn">复制代码</span></code></pre>
<h3 data-id="heading-6">如何使用this.$message</h3>
<ul>
<li>方法一: 使用 <code>provide/inject</code>（用于组合或选项API）</li>
</ul>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">import</span> &#123; message &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'ant-design-vue'</span>

<span class="hljs-keyword">const</span> app = createApp(&#123; ... &#125;)

app.provide(<span class="hljs-string">'message'</span>, message)

<span class="copy-code-btn">复制代码</span></code></pre>
<p>在组件中使用</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">import</span> &#123; inject &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-function"><span class="hljs-title">setup</span>(<span class="hljs-params"></span>)</span> &#123;
  <span class="hljs-keyword">const</span> $message = inject(<span class="hljs-string">'message'</span>)
  
  $message.success(<span class="hljs-string">'Hello_AlexCc'</span>)
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<ul>
<li>方法二: 使用全局配置 <code>globalProperties</code></li>
</ul>
<p>注意：这只适用于选项API。</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">import</span> &#123; message &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'ant-design-vue'</span>

<span class="hljs-keyword">const</span> app = createApp(&#123; ... &#125;)

app.config.globalProperties.$message = message
<span class="copy-code-btn">复制代码</span></code></pre>
<p>在组件中使用</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-function"><span class="hljs-title">mounted</span>(<span class="hljs-params"></span>)</span> &#123;
  <span class="hljs-built_in">this</span>.$message.success(<span class="hljs-string">'mounted: this.$message.success'</span>)
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>或者</p>
<pre><code class="hljs language-html copyable" lang="html"><span class="hljs-tag"><<span class="hljs-name">a-button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"$message.error('error!!')"</span>></span>弹窗<span class="hljs-tag"></<span class="hljs-name">a-button</span>></span>
<span class="copy-code-btn">复制代码</span></code></pre>
<h3 data-id="heading-7">使用ant图标</h3>
<p>当你复制一个图标粘贴到代码里去，它是一个组件，比如 <code>问号</code> 图标 <code><QuestionOutlined /></code>。</p>
<p>你需要从 <code>@ant-design/icons-vue</code> 中导入。</p>
<p>如果没有安装的话，需要 <code>yarn add @ant-design/icons-vue</code></p>
<h3 data-id="heading-8">使用 iconfont 图标</h3>
<p><a href="https://www.iconfont.cn/" target="_blank" rel="nofollow noopener noreferrer">iconfont官网</a></p>
<p>首先我们去到 <code>iconfont</code> 官网，找一些你喜欢的图标，将他们收藏到你自己的仓库。</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">import</span> &#123; StepForwardOutlined, createFromIconfontCN &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@ant-design/icons-vue'</span>

<span class="hljs-comment">// 使用 iconfont 图标，这里的 url 就是你收藏的 iconfont 项目 js 路径</span>
<span class="hljs-keyword">const</span> IconFont = createFromIconfontCN(&#123;
  <span class="hljs-attr">scriptUrl</span>: <span class="hljs-string">'//at.alicdn.com/t/font_2299454_fvw4ct8o61.js'</span>
&#125;)

<span class="hljs-comment">// 局部注册 IconFont</span>
<span class="hljs-attr">components</span>: &#123; IconFont &#125;

<span class="hljs-comment">// 全局注册</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;
  <span class="hljs-comment">// App 是 vue实例 的类型</span>
  <span class="hljs-attr">install</span>: <span class="hljs-function">(<span class="hljs-params">app: App, options: InstallOptions = defaultInstallOpt </span>) =></span> &#123;
    app.component(<span class="hljs-string">'icon-font'</span>, IconFont)
    AntdComponent.forEach(<span class="hljs-function"><span class="hljs-params">comp</span> =></span> &#123;
      app.component(comp.name, comp)
    &#125;)
  &#125;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>使用图标</p>
<pre><code class="hljs language-html copyable" lang="html"><span class="hljs-tag"><<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"icon-list"</span>></span>
  <span class="hljs-tag"><<span class="hljs-name">icon-font</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"icon-mugua"</span>></span><span class="hljs-tag"></<span class="hljs-name">icon-font</span>></span>
  <span class="hljs-tag"><<span class="hljs-name">icon-font</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"icon-caomei"</span>></span><span class="hljs-tag"></<span class="hljs-name">icon-font</span>></span>
  <span class="hljs-tag"><<span class="hljs-name">icon-font</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"icon-xigua"</span>></span><span class="hljs-tag"></<span class="hljs-name">icon-font</span>></span>
  <span class="hljs-tag"><<span class="hljs-name">icon-font</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"icon-yingtao"</span>></span><span class="hljs-tag"></<span class="hljs-name">icon-font</span>></span>
  <span class="hljs-tag"><<span class="hljs-name">icon-font</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"icon-douya"</span>></span><span class="hljs-tag"></<span class="hljs-name">icon-font</span>></span>
  <span class="hljs-tag"><<span class="hljs-name">icon-font</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"icon-xianggu"</span>></span><span class="hljs-tag"></<span class="hljs-name">icon-font</span>></span>
  <span class="hljs-tag"><<span class="hljs-name">icon-font</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"icon-angel"</span>></span><span class="hljs-tag"></<span class="hljs-name">icon-font</span>></span>
<span class="hljs-tag"></<span class="hljs-name">div</span>></span>

<span class="hljs-tag"><<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"less"</span>></span><span class="css">
<span class="hljs-selector-class">.icon-list</span> &#123;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">2em</span> <span class="hljs-number">0</span>;
  :<span class="hljs-built_in">deep</span>(.anticon) &#123;
    font-size: <span class="hljs-number">36px</span>;
    <span class="hljs-attribute">margin-right</span>: .<span class="hljs-number">5em</span>;
  &#125;
&#125;
</span><span class="hljs-tag"></<span class="hljs-name">style</span>></span>
<span class="copy-code-btn">复制代码</span></code></pre>
<p>效果如下。</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7e2157629f8e4d57a7eebf67dbd865c9~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<h2 data-id="heading-9">vue-router 4</h2>
<ul>
<li><a href="https://next.router.vuejs.org/zh/installation.html#%E7%9B%B4%E6%8E%A5%E4%B8%8B%E8%BD%BD-cdn" target="_blank" rel="nofollow noopener noreferrer">官网地址</a></li>
</ul>
<h3 data-id="heading-10">安装</h3>
<p>使用npm 或者 yarn</p>
<pre><code class="copyable">npm install vue-router@4 -S

yarn add vue-router@4 -S
<span class="copy-code-btn">复制代码</span></code></pre>
<h3 data-id="heading-11">使用</h3>
<p><code>createRouter</code> 函数可以创建一个被 <code>Vue</code> 应用程序使用的实例。<code>Options</code> 用来初始化 <code>router</code>。</p>
<p><code>createWebHistory</code> 创建一个<code>HTML5</code>历史，单页面应用程序中最常见的历史记录。也就是之前版本的 <code>mode</code> : <code>history</code>。 另一种常见的 <code>hash</code> 模式，在 <code>v4</code> 中采用 <code>createWebHashHistory</code>。路由表中的用法还是跟以前一样用就行了。</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-comment">// router/index.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> createRouter(&#123;
  <span class="hljs-attr">history</span>: createWebHistory(),
  <span class="hljs-attr">routes</span>: constantRoutes
&#125;)
<span class="copy-code-btn">复制代码</span></code></pre>
<p>不过，在 <code>composition api</code> 中我们都是通过 <code>setup</code> 钩子作为组合式<code>API</code>的入口，里面是无法使用 <code>this</code> 的，不过在 <code>template</code> 中可以使用 <code>$router</code> 或者 <code>$route</code>。</p>
<p>那么我们如何像之前那样通过编程式路由 <code>this.$router</code> 或者 <code>this.$route</code> 呢?</p>
<p>使用 <code>useRouter</code> 和 <code>uesRoute</code></p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">import</span> &#123; useRouter, useroute &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>

<span class="hljs-function"><span class="hljs-title">setup</span>(<span class="hljs-params"></span>)</span> &#123;
  <span class="hljs-keyword">const</span> router = useRouter()
  <span class="hljs-keyword">const</span> store = useStore()

  router.push(<span class="hljs-string">'/login'</span>)
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>其它 <code>Router Api</code> 去官网查看就好了。</p>
<h2 data-id="heading-12">Vuex 4.0</h2>
<ul>
<li><a href="https://next.vuex.vuejs.org/" target="_blank" rel="nofollow noopener noreferrer">官网地址</a></li>
</ul>
<h3 data-id="heading-13">安装</h3>
<p>使用 npm 或者 yarn 安装</p>
<pre><code class="copyable">npm install vuex@next --save

yarn add vuex@next --save
<span class="copy-code-btn">复制代码</span></code></pre>
<h3 data-id="heading-14">使用</h3>
<p>创建 <code>store/index.ts</code> 文件，从 <code>vuex</code> 中导入 <code>createStore</code> 来创建我们的 <code>store</code> 实例，写好内容后不要忘了使用 <code>vue</code> 去注册。</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-comment">// store/index.ts</span>

<span class="hljs-keyword">import</span> &#123; createStore &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">"vuex"</span>

<span class="hljs-comment">// 定义存储状态的类型</span>
<span class="hljs-keyword">export</span> interface State &#123;
  <span class="hljs-attr">count</span>: number
&#125;

<span class="hljs-comment">// 如果不将 'State' 接口传入到 'createStore' 中，在 'mutations' 中使用的 state 会被推测为 'unknown' 类型</span>
<span class="hljs-keyword">const</span> store = createStore<State>(&#123;
  <span class="hljs-function"><span class="hljs-title">state</span>(<span class="hljs-params"></span>)</span> &#123;
    <span class="hljs-keyword">return</span> &#123;
      <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>
    &#125;
  &#125;,
  <span class="hljs-attr">mutations</span>: &#123;
    <span class="hljs-function"><span class="hljs-title">increment</span>(<span class="hljs-params">state</span>)</span> &#123;
      state.count++
    &#125;
  &#125;
&#125;)

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> store
<span class="copy-code-btn">复制代码</span></code></pre>
<p>注册<code>store</code></p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-comment">// main.ts</span>

<span class="hljs-keyword">const</span> app = createApp(&#123; <span class="hljs-comment">/* your root component */</span> &#125;)
app.use(store)
<span class="copy-code-btn">复制代码</span></code></pre>
<p>当我们需要用 在 <code>store</code> 中定义的 <code>count</code> 时，发现 <code>count</code> 的类型是 <code>any</code></p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5cea6ef9d1d7491199ebd59bf3882f46~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>当我们在Composition API中编写Vue组件时，很可能希望<code>useStore</code>返回类型化的存储。为了让<code>useStore</code>正确地返回输入的存储，必须做如下几步操作:</p>
<pre><code class="copyable">1. 定义类型化的`InjectionKey`。
2. 在`Vue`应用程序中安装 `store` 时提供类型化的`InjectionKey`。
3. 将类型化的`InjectionKey`传递给`useStore`方法。
<span class="copy-code-btn">复制代码</span></code></pre>
<p>回到 <code>store/index.ts</code> 文件
```ts
import &#123; InjectionKey &#125; from "vue"
import &#123; createStore, Store &#125; from "vuex"</p>
<pre><code class="copyable">// 定义注入 key
export const key: InjectionKey<Store<State>> = Symbol()
```
<span class="copy-code-btn">复制代码</span></code></pre>
<p>然后我们可以将<code>key</code>传递给<code>useStore</code>方法以检索类型化的存储，在使用的地方就能正确推到出<code>state.count</code> 的类型了。</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2cf248631fc44420a1781468f1becc0f~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<h2 data-id="heading-15">qiankun</h2>
<p>在 <code>系列一</code> 文中已经介绍 <code>qiankun</code> 和 <code>微前端</code>的概念了，这里就不再啰嗦了。</p>
<h3 data-id="heading-16">安装</h3>
<pre><code class="copyable">yarn add qiankun@2.4.1 -S
<span class="copy-code-btn">复制代码</span></code></pre>
<h3 data-id="heading-17">使用</h3>
<p>虽然 <a href="https://juejin.cn/post/6901603817499688967" target="_blank">系列篇一</a> 中已经写过用法了，但是在正式开始的这个项目里面还是有点不一样，所以这里我们再看看如何再 <code>Vue3</code> 中使用它。</p>
<p>现在我们还是以一个小栗子为入口，去了解如何使用它。</p>
<p>首先我们在 <code>src</code> 下面新建一个文件 <code>single-spa.ts</code> 文件，用来处理连接 <code>子应用</code> 的配置，代码很简单，直接上代码，里面描述了一些关键信息。</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-comment">//single-spa.ts</span>

<span class="hljs-keyword">import</span> &#123;
  registerMicroApps,
  setDefaultMountApp,
  addGlobalUncaughtErrorHandler,
  start
&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">"qiankun"</span>

<span class="hljs-keyword">const</span> apps = [
  &#123;
    <span class="hljs-attr">name</span>: <span class="hljs-string">'vue3-base'</span>, <span class="hljs-comment">// 应用名称</span>
    <span class="hljs-attr">entry</span>: <span class="hljs-string">'//localhost:8080'</span>, <span class="hljs-comment">// 应用入口,资源路径</span>
    <span class="hljs-attr">container</span>: <span class="hljs-string">'#subAppContainer'</span>, <span class="hljs-comment">// 在主体中存放 子应用 的容器 id</span>
    <span class="hljs-attr">activeRule</span>: <span class="hljs-string">'/vue-base'</span>, <span class="hljs-comment">// 根据此规则切换指定子应用,激活规则</span>
    <span class="hljs-attr">props</span>: &#123;
      <span class="hljs-comment">// 传递给子应用的数据</span>
      <span class="hljs-attr">user</span>: &#123;
        <span class="hljs-attr">name</span>: <span class="hljs-string">'ZHONG TAI ADMIN'</span>,
        <span class="hljs-attr">age</span>: <span class="hljs-number">18</span>
      &#125;
    &#125;
  &#125;
]

<span class="hljs-keyword">const</span> excutorSingleSpa = <span class="hljs-function">() =></span> &#123;

  registerMicroApps(apps, &#123;
    <span class="hljs-attr">beforeLoad</span>: [
      <span class="hljs-comment">// @ts-ignore</span>
      <span class="hljs-function"><span class="hljs-params">app</span> =></span> &#123;
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'加载应用之前打印apps'</span>, app)
      &#125;
    ]
  &#125;)

  addGlobalUncaughtErrorHandler(<span class="hljs-function">(<span class="hljs-params">event: Event | string</span>) =></span> &#123;
    <span class="hljs-built_in">console</span>.error(event)
    <span class="hljs-keyword">const</span> &#123; <span class="hljs-attr">message</span>: msg &#125; = event <span class="hljs-keyword">as</span> any
    <span class="hljs-comment">// 加载失败时提示</span>
    <span class="hljs-keyword">if</span> (msg || msg.includes(<span class="hljs-string">"died in status LOADING_SOURCE_CODE"</span>)) &#123;
      <span class="hljs-built_in">console</span>.error(<span class="hljs-string">"微应用加载失败，请检查应用是否可运行"</span>, msg);
    &#125;
  &#125;)

  start(&#123;
    <span class="hljs-comment">// 是否开启预加载，默认为 true。</span>
    <span class="hljs-comment">// 配置为 true 则会在第一个微应用 mount 完成后开始预加载其他微应用的静态资源</span>
    <span class="hljs-attr">prefetch</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">sandbox</span>: <span class="hljs-literal">true</span>
  &#125;)
&#125;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> excutorSingleSpa
<span class="copy-code-btn">复制代码</span></code></pre>
<p>在项目结构方面，我们一般都会有一个 <code>layouts.vue</code> 组件，里面有个一区域是用来渲染我们各个路由页面的。而我们的 <code>子应用</code> 也是在这里渲染的。</p>
<pre><code class="hljs language-html copyable" lang="html">// layout/index.vue
// 其它结构省略

<span class="hljs-tag"><<span class="hljs-name">a-layout-content</span>
  <span class="hljs-attr">:style</span>=<span class="hljs-string">"&#123; background: '#fff', padding: '24px', margin: 0, minHeight: '280px' &#125;"</span>></span>
  <span class="hljs-comment"><!-- 主内容渲染部分 --></span>
  <span class="hljs-tag"><<span class="hljs-name">router-view</span>></span><span class="hljs-tag"></<span class="hljs-name">router-view</span>></span>
  
  <span class="hljs-comment"><!-- 子应用渲染部分 --></span>
  <span class="hljs-tag"><<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"subAppContainer"</span>></span><span class="hljs-tag"></<span class="hljs-name">div</span>></span>
<span class="hljs-tag"></<span class="hljs-name">a-layout-content</span>></span>
<span class="copy-code-btn">复制代码</span></code></pre>
<p>在 <code>layout/index.vue</code> 文件中，我们引入 <code>single-spa.ts</code> 文件。</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">import</span> useSingleSpa <span class="hljs-keyword">from</span>  <span class="hljs-string">'@/single-spa'</span>

<span class="hljs-function"><span class="hljs-title">setup</span>(<span class="hljs-params"></span>)</span> &#123;
  useSingleSpa()
&#125;

<span class="copy-code-btn">复制代码</span></code></pre>
<p>然后我们在 <code>router/index.ts</code> 中，加入 <code>子应用</code> 的菜单。</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-comment">// routes</span>
<span class="hljs-keyword">import</span> &#123; RouterView &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>

<span class="hljs-keyword">const</span> routes = [
  <span class="hljs-comment">// 省略其它路由</span>
  &#123;
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/vue-base'</span>,
    <span class="hljs-attr">component</span>: Layout,
    <span class="hljs-attr">children</span>: [
      &#123;
        <span class="hljs-attr">path</span>: <span class="hljs-string">'home'</span>,
        <span class="hljs-comment">// `RouterView` 表示显示当前路由，就跟 `<router-view />` 一样。</span>
        <span class="hljs-comment">// 以前我们可能是这么写 component: h => h('router-view')</span>
        <span class="hljs-attr">component</span>: RouterView,
      &#125;,
      &#123;
        <span class="hljs-attr">path</span>: <span class="hljs-string">'about'</span>,
        <span class="hljs-attr">component</span>: RouterView,
      &#125;
    ]
  &#125;
]
<span class="copy-code-btn">复制代码</span></code></pre>
<p>到这里，主项目就差不多配置好了。然后去配置 <code>子应用</code>。</p>
<h3 data-id="heading-18">子应用配置</h3>
<p>如果你看了 <code>系列篇一</code>，就知道我们在子应用中不需要安装任何依赖，只需要在 <code>main.ts</code> 中导出这几个钩子函数 <code>bootstrap</code>，<code>mount</code>，<code>unmount</code>。</p>
<p>我们看下子应用的路由如何配置。</p>
<p>这里的根目录 <code>'/'</code> 是相对于子应用的，由于通过<code>createWebHistory('/vue-base')</code> 设置了路由前缀，其实这里会是 <code>/vue-base</code> ，然后重定向到 <code>/vue-base/about</code></p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-comment">// router/index.ts</span>

<span class="hljs-keyword">import</span> &#123; createRouter, createWebHistory, RouteRecordRaw &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>
<span class="hljs-keyword">import</span> Home <span class="hljs-keyword">from</span> <span class="hljs-string">'../views/Home.vue'</span>

<span class="hljs-keyword">const</span> routes: <span class="hljs-built_in">Array</span><RouteRecordRaw> = [
  &#123;
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/'</span>,
    <span class="hljs-attr">redirect</span>: <span class="hljs-string">'/about'</span>
  &#125;,
  &#123;
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/home'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'Home'</span>,
    <span class="hljs-attr">component</span>: Home
  &#125;,
  &#123;
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/about'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'About'</span>,
    <span class="hljs-comment">// 路由懒加载</span>
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =></span> <span class="hljs-keyword">import</span>(<span class="hljs-comment">/* webpackChunkName: "about" */</span> <span class="hljs-string">'../views/About.vue'</span>)
  &#125;
]

<span class="hljs-keyword">const</span> router = createRouter(&#123;
  <span class="hljs-comment">// 检测如何是由主体渲染的，就加个 `/vue-base` 路由前缀，以便区分主体和子应用的路由</span>
  <span class="hljs-attr">history</span>: <span class="hljs-built_in">window</span>.__POWERED_BY_QIANKUN__ ? createWebHistory(<span class="hljs-string">'/vue-base'</span>) : createWebHistory(process.env.BASE_URL),
  routes
&#125;)

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> router

<span class="copy-code-btn">复制代码</span></code></pre>
<p>子应用的 <code>App.vue</code> 的结构如下</p>
<pre><code class="hljs language-html copyable" lang="html"><span class="hljs-tag"><<span class="hljs-name">template</span>></span>
  <span class="hljs-tag"><<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"app"</span>></span>
    <span class="hljs-tag"><<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"nav"</span>></span>
      <span class="hljs-tag"><<span class="hljs-name">router-link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/home"</span>></span>Home<span class="hljs-tag"></<span class="hljs-name">router-link</span>></span> |
      <span class="hljs-tag"><<span class="hljs-name">router-link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/about"</span>></span>About<span class="hljs-tag"></<span class="hljs-name">router-link</span>></span>
    <span class="hljs-tag"></<span class="hljs-name">div</span>></span>
    
    <span class="hljs-comment"><!-- 渲染匹配的路由component --></span>
    <span class="hljs-tag"><<span class="hljs-name">router-view</span>></span><span class="hljs-tag"></<span class="hljs-name">router-view</span>></span>
  <span class="hljs-tag"></<span class="hljs-name">div</span>></span>
<span class="hljs-tag"></<span class="hljs-name">template</span>></span>
<span class="copy-code-btn">复制代码</span></code></pre>
<p>然后我们创建 <code>vue.config.js</code>，来处理 <code>子应用</code> 嵌入主体项目可能会出现的问题。</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">const</span> &#123; name &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./package.json'</span>)

<span class="hljs-built_in">module</span>.exports = &#123;
  <span class="hljs-attr">devServer</span>: &#123;
    <span class="hljs-attr">headers</span>: &#123;
      <span class="hljs-string">"Access-Control-Allow-Origin"</span>: <span class="hljs-string">"*"</span>
    &#125;
  &#125;,
  <span class="hljs-attr">configureWebpack</span>: &#123;
    <span class="hljs-attr">output</span>: &#123;
      <span class="hljs-attr">library</span>: <span class="hljs-string">`<span class="hljs-subst">$&#123;name&#125;</span>-[name]`</span>,
      <span class="hljs-attr">libraryTarget</span>: <span class="hljs-string">'umd'</span>,
      <span class="hljs-attr">jsonpFunction</span>: <span class="hljs-string">`webpackJsonp_<span class="hljs-subst">$&#123;name&#125;</span>`</span>
    &#125;
  &#125;
&#125;

<span class="copy-code-btn">复制代码</span></code></pre>
<p>到这里，我们的子应用 <code>vue-base</code> 就配置好了。</p>
<p>我们来看下效果吧！</p>
<p>现在看到的界面是 <code>主体</code> 项目的首页。</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a28abd7c280344329e7a9e0945387a85~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>这个界面，就是点击 <code>导航vue-base</code> 之后看到的页面。</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ef32347f1aa94cd1a09e341aef70c6f9~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>到这里，我们的子应用和主体就链接起来了，之后项目不停的迭代之后，会变得越来越复杂。</p>
<h1 data-id="heading-19">一起交流</h1>
<p>如果喜欢这部分内容，就加入我们的QQ群，和大家一起交流技术吧~</p></div>  
</div>
            