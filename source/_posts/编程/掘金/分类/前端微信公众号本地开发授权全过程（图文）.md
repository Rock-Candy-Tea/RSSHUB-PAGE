
---
title: '前端微信公众号本地开发授权全过程（图文）'
categories: 
 - 编程
 - 掘金
 - 分类
headimg: 'https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/91bf9c33f6754b659b3aca4b600eb474~tplv-k3u1fbpfcp-watermark.image'
author: 掘金
comments: false
date: Tue, 08 Jun 2021 17:41:28 GMT
thumbnail: 'https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/91bf9c33f6754b659b3aca4b600eb474~tplv-k3u1fbpfcp-watermark.image'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><blockquote>
<p>最近用uni-app开发公司的公众号项目，授权这块踩了不少坑，在这记录一下本地开发授权的全过程。</p>
</blockquote>
<p>一般做登录验证的时候前端都需要给后端传一个code，这个code需要授权才能取，在本地开发时授权这一步要做的准备工作比较麻烦。</p>
<h3 data-id="heading-0">1、准备开发的测试号</h3>
<h4 data-id="heading-1">1.1、登录公司的公众号看一下接口权限</h4>
<p>确保这里有权限，再点修改填公司项目域名（这一块一般给后端填）<br>
<strong>个人的服务号没有这个权限，需要企业认证才行</strong></p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/91bf9c33f6754b659b3aca4b600eb474~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<h4 data-id="heading-2">1.2、把用来开发的微信账号添加为开发者</h4>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/429a481277124089bbc1a2cc48720c54~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8f716ca4c2344cea9da965f1b9eaf9c6~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<h4 data-id="heading-3">1.3、申请一个测试号，直接用你用来开发的微信扫码</h4>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/df04c931eec3454b87e59aeed2c89187~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer">
进入到测试号管理页面，接口配置信息可以写，可以不写。</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c4726414a24742308f19a15af1fe7c35~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>JS接口安全域名的ip填写你本机的ip要加端口号，不加http。
<img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/babdf6a21a1e49cdb13093e583da65e1~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>把用来开发的微信账号扫这个码，扫出来的测试号关注一下就可以。
<img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4bd868d8b44240e9be15974737423553~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer">
其他没提到的地方就不用管了。</p>
<h4 data-id="heading-4">1.4、修改网页授权的地址</h4>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4515e82bc7ab4cc695780149b23fe705~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer">
还是一样填写本机ip加端口号，不加http。</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e8bfd647658a40419eb349db15382d82~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<h3 data-id="heading-5">2、授权代码</h3>
<p>我是写在路由钩子里，每次跳转页面都会检查授权，未授权先授权；授权后拿用户的code做登录验证，未注册跳转注册页，注册后跳转信息页。</p>
<h4 data-id="heading-6">2.1、检查授权</h4>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-comment">//从路径中把用户的code截取出来的方法</span>
<span class="hljs-keyword">const</span> getUrlParam=<span class="hljs-function">(<span class="hljs-params">name</span>)=></span> &#123; <span class="hljs-comment">//封装方法</span>
<span class="hljs-keyword">var</span> reg = <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(<span class="hljs-string">"(^|&)"</span> + name + <span class="hljs-string">"=([^&]*)(&|$)"</span>); <span class="hljs-comment">//构造一个含有目标参数的正则表达式对象</span>
<span class="hljs-keyword">var</span> r = <span class="hljs-built_in">window</span>.location.search.substr(<span class="hljs-number">1</span>).match(reg); <span class="hljs-comment">//匹配目标参数</span>
<span class="hljs-keyword">if</span> (r != <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-built_in">unescape</span>(r[<span class="hljs-number">2</span>]);
<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">//返回参数值</span>

&#125;
<span class="hljs-keyword">let</span> code = getUrlParam(<span class="hljs-string">'code'</span>)
<span class="copy-code-btn">复制代码</span></code></pre>
<p>如果code不为空就是用户已授权，接下来做登录验证操作，一般都是用后端的登录验证接口，把获取的code传过去；如果code为空，就证明用户没授权，接下来进行授权操作。</p>
<h4 data-id="heading-7">2.2授权</h4>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-comment">//授权</span>
<span class="hljs-keyword">let</span> appid = <span class="hljs-string">'xxx'</span>  <span class="hljs-comment">//在上一步你用来注册成测试号的appid</span>
<span class="hljs-keyword">let</span> local = <span class="hljs-string">'http://192.168.1.33:8080'</span> <span class="hljs-comment">//要加http，要加端口号</span>
<span class="hljs-built_in">window</span>.location.href = <span class="hljs-string">'https://open.weixin.qq.com/connect/oauth2/authorize?appid='</span> + appid +
<span class="hljs-string">'&redirect_uri='</span> + <span class="hljs-built_in">encodeURIComponent</span>(local) + <span class="hljs-string">'&response_type=code&scope=snsapi_userinfo&state=1#wechat_redirect'</span>
<span class="hljs-comment">//登录验证</span>
<span class="hljs-keyword">if</span>(code)&#123;...&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>会跳出来一个页面请求你的授权，由于我授权过，这一步就不截图了，授权完就可以继续登录验证了。</p>
<h3 data-id="heading-8">3、常见错误</h3>
<h4 data-id="heading-9">3.1、redirect_uri 参数错误</h4>
<pre><code class="copyable">Ⅰ、微信测试号上没有配置授权回调域名
    回看1.4步
Ⅱ、配置的授权回调页面域名跟请求时带着的参数不一样
    回看2.2步
Ⅲ、本地开发有端口，配置的回调域名没有带着端口
    回看第1步全过程
<span class="copy-code-btn">复制代码</span></code></pre></div>  
</div>
            