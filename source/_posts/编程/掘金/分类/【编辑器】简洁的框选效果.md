
---
title: '【编辑器】简洁的框选效果'
categories: 
 - 编程
 - 掘金
 - 分类
headimg: 'https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/98b5251e4fa843b69bd5478f60878869~tplv-k3u1fbpfcp-watermark.image'
author: 掘金
comments: false
date: Thu, 15 Jul 2021 22:25:00 GMT
thumbnail: 'https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/98b5251e4fa843b69bd5478f60878869~tplv-k3u1fbpfcp-watermark.image'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><h2 data-id="heading-0">最终效果：</h2>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/98b5251e4fa843b69bd5478f60878869~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<h2 data-id="heading-1">1、先写一个可以滚动的内容</h2>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ce29404e59f948158867d30436d76500~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<h2 data-id="heading-2">2、声明框选 有效区 </h2>
<p>编辑器的灵魂是什么：所有的操作都是在一个黑板上进行，我们只能在这个黑板上进行绘制、操作，这个黑板叫做编辑器有效区。</p>
<pre><code class="copyable">var selectContainer = document.getElementById('container'); //选框有效区
<span class="copy-code-btn">复制代码</span></code></pre>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9d3d0c82395b41009809760d3048c1cc~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<h2 data-id="heading-3">3、鼠标按下时，进入一个总的方法</h2>
<pre><code class="copyable">selectContainer.onmousedown = function () &#123;
    alert(2222222);        //测试在有效区内，鼠标按下响应的事件
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<h2 data-id="heading-4">4、鼠标按下：在容器里新添加一个方形div</h2>
<p>（demo一直在换颜色....）</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f4b8ca5071874f11aece9a98f574979f~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<pre><code class="copyable">var selection = document.createElement('div');

selectContainer.onmousedown = function (e) &#123;        
    selection.style.cssText="width: 100px; height: 100px; background: lightblue; opacity: 0.4";
    document.getElementById('container').appendChild(selection);
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>这个浅蓝色的方块就是我们未来的<strong>框选框</strong>。但是框选框的起始位置(x,y)，我们要相对于有效区绝对定位。所以，代码进一步写成：</p>
<pre><code class="copyable">#container &#123;
    width: 400px;
    height: 300px;
    overflow-y: auto;
    position: relative;
    border: 1px solid #ddd;
&#125;


selection.style.cssText="width: 100px; height: 100px; background: lightblue; opacity: 0.4; position: absolute";
<span class="copy-code-btn">复制代码</span></code></pre>
<p>并且此时我们要声明两个变量：水平坐标，垂直坐标（框选框左上角的点）。</p>
<pre><code class="copyable">var startX = 0;
var startY = 0;

selectContainer.onmousedown = function (e) &#123;        
    startX = e.clientX - selectContainer.offsetLeft + selectContainer.scrollLeft;
    startY = e.clientY - selectContainer.offsetTop + selectContainer.scrollTop;
    /* 鼠标相对于视口的水平坐标 - 外框container偏移的位置（固定） + 滚动偏移
    
    ***这里是很容易写出bug的地方***
    写框选框的时候，很多人会把框选框相对于整个页面定位
    但是这样的话，在我们框选住一个方块 同时又让编辑区内容滚动 的时候，
    框选框不会覆盖到滚动部分的内容，而是会出现框选框 傻傻地fixed在一个地方 的现象，也就是和编辑区的内容结合不起来。
    ***结束***
   
    */
<span class="copy-code-btn">复制代码</span></code></pre>
<p>得到了鼠标点击的位置后，我们试着把浅蓝色方块定位到鼠标点击的位置。</p>
<pre><code class="copyable">selection.style.left = startX;
selection.style.top = startY;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>我们现在得到了鼠标点击的定位点，接下来就要找到鼠标放下的定位点和框选框的宽高。</p>
<h2 data-id="heading-5">5、找方块的范围</h2>
<p>首先，我们的方块范围是通过鼠标移动的多少来决定的，所以我们要写一个鼠标按下后的移动事件：</p>
<pre><code class="copyable">selectContainer.onmousemove = function (e) &#123;
    if (e.buttons == 1 || e.which == 1) &#123;    //多加一个条件：鼠标左键按住
        alert("移动了！");
    &#125;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>然后，要让死的方块跟着鼠标拖拽的位置动起来。但是在这之前，我们要把刚刚的浅蓝色小方块重置样式（宽高设0，默认隐藏）</p>
<pre><code class="copyable">selection.style.cssText="width: 0; height: 0; background: lightblue; opacity: 0.4; position: absolute; display: none;";
<span class="copy-code-btn">复制代码</span></code></pre>
<p>重置过后，写动态框选框的代码，如下：</p>
<pre><code class="copyable">selection.style.display = "block";
selection.style.width = Math.abs(_x - startX) + "px";
selection.style.height = Math.abs(_y - startY) + "px";
<span class="copy-code-btn">复制代码</span></code></pre>
<p>6、鼠标放下的交互</p>
<pre><code class="copyable">selectContainer.onmouseup = function (e) &#123;
    selection.style.display = "none";
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>7、框选框和备选节点</p>
<p>框选结束后，有一部分节点是被选中的状态，我们未来会对这些节点进行一些批量的操作。<br>
所以，要有个装这些节点的空容器：</p>
<pre><code class="copyable">//首先获取所有可被选中的备选节点
var lines = document.getElementsByClassName("line");

//被选中节点的容器
var selectedEls = [];
<span class="copy-code-btn">复制代码</span></code></pre>
<p>再往前推，计算框选框选中了多少节点。</p>
<h2 data-id="heading-6">8、框选框和备选项的关系</h2>
<pre><code class="copyable">selectContainer.onmouseup = function (e) &#123;
    var a = selection.offsetLeft;
    var b = selection.offsetWidth;
    var c = selection.offsetTop;
    var d = selection.offsetHeight;

    for (var i = 0; i < lines.length; i++) &#123;                
        var sr = lines[i].offsetWidth + lines[i].offsetLeft;        //备选项最右侧
        var sb = lines[i].offsetHeight + lines[i].offsetTop;        //备选项最底侧
        // 备选项 最右侧 sl > 框选框 水平偏移 a
        // 备选项 最底部 st > 框选框 垂直偏移 c
        // 备选项 距左侧距离 lines[i].offsetLeft < 框选框 水平偏移 a + 框选框宽度 b
        // 备选项 距顶部距离 lines[i].offsetTop < 框选框 垂直偏移 c + 框选框高度 d 
        if(sr > a && sb > c && lines[i].offsetLeft < a + b && lines[i].offsetTop < c + d) &#123;
            lines[i].style.background = "#0082cc";
            selectedEls.push(lines[i]);
        &#125; else &#123;
            ......        
        &#125;
    &#125;    

    selection.style.display = "none";
&#125;
<span class="copy-code-btn">复制代码</span></code></pre></div>  
</div>
            