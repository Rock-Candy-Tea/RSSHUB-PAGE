
---
title: '记一次参与开源项目的过程'
categories: 
 - 编程
 - 掘金
 - 分类
headimg: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/973a7eb4d54e4c93addae8ad25655962~tplv-k3u1fbpfcp-zoom-1.image'
author: 掘金
comments: false
date: Tue, 04 May 2021 02:28:27 GMT
thumbnail: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/973a7eb4d54e4c93addae8ad25655962~tplv-k3u1fbpfcp-zoom-1.image'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><blockquote>
<p>jQuery作为一款老牌js库，在DOM操作上依然有不错的优势，最近在认真演习jQuery源码，顺带写着一个专栏：<a href="https://www.tech-share.cn/column/20" target="_blank" rel="nofollow noopener noreferrer">《Js编程技巧之jQuery源码分析》</a>，记录一下里面有用的技巧、写法和设计思想。在一次查阅API文档时，发现了一个问题，并尝试定位、解决此问题，提交了issue，本文在此记录一下。</p>
</blockquote>
<h2 data-id="heading-0">发现问题</h2>
<p>API文档里的错误截图（红色方框里）：
<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/973a7eb4d54e4c93addae8ad25655962~tplv-k3u1fbpfcp-zoom-1.image" alt="在这里插入图片描述" loading="lazy" referrerpolicy="no-referrer"></p>
<p>根据提示可以得知，由于回调函数可能返回两个参数，文档定义了两个参数类型：<code>String</code>或者<code>Array</code>，导致抛出了错误信息：<code>ERROR: A single return element is expected</code></p>
<p>于是决定找出导致错误信息的地方，添加对多类型的支持，fix它。</p>
<h2 data-id="heading-1">追踪、解决问题</h2>
<h3 data-id="heading-2">jQuery站点工程化的调研</h3>
<p>经过一段时间对贡献说明文档的探索研究，发现了该项目的特点：</p>
<ul>
<li>jQuery有一套预定的wordpress实例（一整套解决方案，不需要开发者额外配置数据库），所有的jQuery Foundation的网站都采用该实例，实现可标准化。（不难发现这些网站结构比较类似）</li>
<li>该wordpress实例通过<code>Vagrant</code>+<code>VM VirtualBox</code>跑在虚拟容器里</li>
<li>jQuery API站点通过<code>grunt</code>打包工具将编译后的文件搬到wordpress实例的相关目录下</li>
</ul>
<p>流程图如下：
<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4f4006a244aa436890b6cfd8230e86b5~tplv-k3u1fbpfcp-zoom-1.image" alt="在这里插入图片描述" loading="lazy" referrerpolicy="no-referrer"></p>
<h3 data-id="heading-3">定位问题</h3>
<p>观察源码，根据错误信息定位到<code>grunt编译打包过程</code>，XML的编译是由一个名为<code>grunt-jquery-content</code>的npm包实现的，定位到这个package里的<code>entries2html-base.xsl</code>文件,该文件负责将xml编译为html文件.
决定做以下修改：
由</p>
<pre><code class="copyable"><!-- a return element -->
<xsl:if test="return">
<xsl:for-each select="return">
<xsl:if test="position() &gt; 1">
<strong>ERROR: A single return element is expected</strong>
</xsl:if>
<xsl:call-template name="render-types"/>
</xsl:for-each>
</xsl:if>
<span class="copy-code-btn">复制代码</span></code></pre>
<p>改为</p>
<pre><code class="copyable"><!-- a return element -->
<xsl:if test="return">
<xsl:for-each select="return">
<xsl:if test="position() &gt; 1">
<span> | </span>
</xsl:if>
<xsl:call-template name="render-types"/>
</xsl:for-each>
</xsl:if>
<span class="copy-code-btn">复制代码</span></code></pre>
<p>修改的效果如下：
<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e12f6f795c754305bfd54b8935071f0c~tplv-k3u1fbpfcp-zoom-1.image" alt="在这里插入图片描述" loading="lazy" referrerpolicy="no-referrer">
完美解决问题！</p>
<ul>
<li>xml的依赖库安装:<code>libxml2-2.7.8.win32</code>、<code>iconv-1.9.2.win32</code>、<code>zlib-1.2.5</code>、<code>libxslt-1.1.26.win32</code>,<a href="https://www.zlatkovic.com/pub/libxml/" target="_blank" rel="nofollow noopener noreferrer">下载地址</a>，并设置环境变量。用于解析或编译<code>xml文件</code>。x64电脑必须下载win32版本。</li>
<li>Vagrant启动缓慢（需要梯子并在网速空闲时下载依赖资源）</li>
<li>需要配置一下本机的hosts文件里域名到IP的映射，文件目录为：<code>C:\Windows\System32\drivers\etc\hosts</code></li>
</ul>
<h3 data-id="heading-4">提出issue</h3>
<p>然后就是到官方的github仓库，提出issue：
<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/952172acd2ce4b12b8fd7ed058021c8b~tplv-k3u1fbpfcp-zoom-1.image" alt="在这里插入图片描述" loading="lazy" referrerpolicy="no-referrer">
截至到发稿日期，该issue尚未得到官方的回应，看来jQuery社区已经不再活跃，但无论如何，这次参与对我而言都是非常有意义的。</p>
<h2 data-id="heading-5">总结</h2>
<ul>
<li>windows平台总体还是比较鸡肋，特别是一些第三方库的安装和支持不太好（尽可能使用mac工作）</li>
<li>jQuery本地开发环境通过<code>Vagrant</code>+<code>VM VirtualBox</code>跑在本机的虚拟容器里，保证了开发与部署环境的一致性，抹平的平台差异。这点让我感觉惊艳，学习到了虚拟容器技术给开发部署带来的便利</li>
<li>提issue时，要有一个负责的心态，提供详细、准确的英文表达，描述你发现的问题，以及你如何尝试并解决了这个问题。</li>
</ul></div>  
</div>
            