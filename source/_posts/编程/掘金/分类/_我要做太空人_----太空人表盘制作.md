
---
title: '_我要做太空人_----太空人表盘制作'
categories: 
 - 编程
 - 掘金
 - 分类
headimg: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c8dc51e8547d41dbb6bb21148bc2dc2c~tplv-k3u1fbpfcp-zoom-1.image'
author: 掘金
comments: false
date: Sun, 06 Jun 2021 15:21:56 GMT
thumbnail: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c8dc51e8547d41dbb6bb21148bc2dc2c~tplv-k3u1fbpfcp-zoom-1.image'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><h3 data-id="heading-0">“这是我参与更文挑战的第4天，活动详情查看： 更文挑战”</h3>
<h1 data-id="heading-1">需求</h1>
<p>有智能手表的人都知道，前段时间的“太空人表盘”非常火热。那么我们也可以自己动手来制作一款太空人表盘。</p>
<h1 data-id="heading-2">准备</h1>
<ol>
<li>Visual Studio 2019</li>
<li>EasyX Graphics Library ：Visual C++ 的免费绘图库</li>
</ol>
<h1 data-id="heading-3">程序</h1>
<h2 data-id="heading-4">huawei.h</h2>
<pre><code class="copyable">#ifndef _HUAWEI_H_
#define _HUAWEI_H_
#include<graphics.h>
void SetWindowNewStyle(int w, int h)
&#123;
// 去掉标题
SetWindowLong(GetHWnd(), GWL_STYLE, GetWindowLong(GetHWnd(), GWL_STYLE) & ~WS_CAPTION);
// 初始化界面为圆形
SetWindowRgn(GetHWnd(), CreateEllipticRgn(0, 0, w, h), true);
&#125;
//png透明贴图
void drawImg(IMAGE* pimg, int x, int y)
&#123;
// 变量初始化
DWORD* dst = GetImageBuffer();
DWORD* src = GetImageBuffer(pimg);
int dst_width = ::getwidth();//窗口宽高
int dst_height = ::getheight();
int _w = pimg->getwidth();
int _h = pimg->getheight();

// 计算贴图的实际长宽
int iwidth = (x + _w > dst_width) ? dst_width - x : _w;// 处理超出右边界
int iheight = (y + _h > dst_height) ? dst_height - y : _h;// 处理超出下边界
if (x < 0) &#123; src += -x;iwidth -= -x;x = 0; &#125;// 处理超出左边界
if (y < 0) &#123; src += (_w * -y);iheight -= -y;y = 0; &#125;// 处理超出上边界
// 修正贴图起始位置
dst += (dst_width * y + x);

// 实现透明贴图
for (int iy = 0; iy < iheight; iy++)
&#123;
for (int ix = 0; ix < iwidth; ix++)
&#123;
byte a = (byte)(src[ix] >> 24);//计算透明通道的值[0,256) 0为完全透明 255为完全不透明
if (a > 100)
&#123;
dst[ix] = src[ix];
&#125;
&#125;
//换到下一行
dst += dst_width;
src += _w;
&#125;
&#125;
//去掉窗口标题以后，能够点击移动窗口
void mouseEvent()
&#123;
//求鼠标相对于当前窗口左上角的坐标(即鼠标距离窗口左上的的宽度和高度)
static POINT WndPtSize;
static bool isMove = false;
if (MouseHit())
&#123;
MOUSEMSG msg = GetMouseMsg();
if (msg.uMsg == WM_LBUTTONDOWN)//左键按下
&#123;
//获取窗口相对与屏幕左上角的 左上角坐标，和右下角坐标
RECT wndRect;
GetWindowRect(GetHWnd(), &wndRect);


//获取鼠标光标相对于屏幕的坐标
POINT curPos;
GetCursorPos(&curPos);

//求鼠标相对于当前窗口左上角的坐标
WndPtSize.x = curPos.x - wndRect.left;
WndPtSize.y = curPos.y - wndRect.top;

isMove = true;
&#125;
else if (msg.uMsg == WM_LBUTTONUP)//左键弹起
&#123;
isMove = false;
&#125;
else if (msg.uMsg == WM_MOUSEMOVE)//鼠标移动
&#123;
if (isMove)
&#123;
POINT CursorPos;
GetCursorPos(&CursorPos);
/*把窗口移动到屏幕的x，y的位置
* @hwnd:窗口句柄
* @hwndInsertAfter:窗口的z顺序  HWND_TOPMOST &#123;在前面, 位于任何顶部窗口的前面&#125;
* @X，Y: 窗口左上角的新位置（相对于屏幕）
* @cx，xy: 窗口大小
* @uFlags:SWP_NOSIZE &#123;忽略 cx、cy, 保持大小&#125;
*/
SetWindowPos(GetHWnd(), HWND_TOPMOST, CursorPos.x - WndPtSize.x, CursorPos.y - WndPtSize.y, 0, 0, SWP_NOSIZE);
//CursorPos.x - WndPtSize.x//获取当前窗口左上角相对于屏幕的坐标
//CursorPos.y - WndPtSize.y

//printf("%d %d\n", CursorPos.x - WndPtSize.x, CursorPos.y - WndPtSize.y);
&#125;
&#125;
else if (msg.uMsg == WM_RBUTTONDOWN)//右键按下
&#123;
exit(0);
&#125;
&#125;
&#125;
#endif // !_TOOLS_H_
<span class="copy-code-btn">复制代码</span></code></pre>
<h2 data-id="heading-5">huawei.c</h2>
<pre><code class="copyable">#include <stdio.h>
#include <time.h>
#include "huawei.h"
#include <mmsystem.h>
#pragma comment(lib,"winmm.lib")
#pragma warning(disable:4996)
/*
1,文本字体设置
2,图片动画效果
3,绘制表盘
*/
#define WIN_SIZE 500
#define WIN_HALF (WIN_SIZE/2)//窗口的一半
IMAGE spaceMan[59];
IMAGE other[6];
const char *week[7] = &#123; "日","一","二","三","四","五","六" &#125;;
void setTextStyle(int height, int width, const char *faceName)
&#123;
LOGFONT f = &#123; 0 &#125;;
f.lfHeight = height;
f.lfWidth = width;
f.lfQuality = ANTIALIASED_QUALITY;
strcpy(f.lfFaceName, faceName);
settextstyle(&f);
&#125;
void loadImg()
&#123;
mciSendString("D:\\VS\\作品\\智能表盘\\images/风儿吹.mp3", NULL, 0, NULL);
mciSendString("D:\\VS\\作品\\智能表盘\\images/风儿吹.mp3 repeat", NULL, 0, NULL);

char fileName[50] = &#123; 0 &#125;;
for (int i = 0; i < 30; i++)
&#123;
sprintf_s(fileName, "./images/guoguoxiaoshidi (%d).jpeg", i + 1);
loadimage(spaceMan + i, fileName, 140, 130);
&#125;

loadimage(&other[0], "./images/xinlv.jpg", 60, 60);//心率
loadimage(&other[1], "./images/sun.jpg", 40, 40);//太阳
loadimage(&other[2], "./images/shoes.jpg", 40, 40);//鞋子
loadimage(&other[3], "./images/shang.jpg", 30, 30);//上箭头
loadimage(&other[4], "./images/xia.jpg", 30, 30);//下箭头
loadimage(&other[5], "./images/rocket.jpg", 40, 40);//火箭
&#125;

//太空人旋转动画
void animation()
&#123;
static int index = 0;//[0~59)
putimage(175, 210, spaceMan + index);
static DWORD t1;
DWORD t2 = clock();//获取程序运行到调用该函数经过的毫秒
if (t2 - t1 > 20)
&#123;
index = (index + 1) % 30;
t1 = t2;
&#125;
&#125;
void gameDraw()
&#123;
setbkcolor(RGB(255, 0, 0));
cleardevice();
//绘制表盘
setlinecolor(RGB(0, 0, 0));//设置边框颜色
setlinestyle(PS_SOLID, 30);
setfillcolor(RGB(255, 255, 255));//设置圆的填充白色
fillellipse(0, 0, WIN_SIZE, WIN_SIZE);//绘制一个圆

//绘制线条
setlinestyle(PS_SOLID, 4);
setlinecolor(BLACK);
//最上面竖线
line(WIN_HALF - 30, 20, WIN_HALF - 30, 130);
//横线x2
line(WIN_HALF - 195, WIN_HALF - 120, WIN_HALF + 195, WIN_HALF - 120);
line(WIN_HALF - 195, WIN_HALF + 120, WIN_HALF + 195, WIN_HALF + 120);
//下面线条x3
line(WIN_HALF + 80, WIN_HALF + 120, WIN_HALF + 80, WIN_HALF + 175);
line(WIN_HALF + 80, WIN_HALF + 175, WIN_HALF - 60, WIN_HALF + 175);
line(WIN_HALF - 60, WIN_HALF + 175, WIN_HALF - 60, WIN_HALF + 175 + 48);
setbkmode(TRANSPARENT);
//左上空气湿度90%
setTextStyle(55, 23, "Arial");
settextcolor(BLACK);
outtextxy(WIN_HALF - 155, 75, "90%");
drawImg(other + 5, WIN_HALF - 90, 35);//火箭//右上
putimage(WIN_HALF - 90, 35, other + 5);
setTextStyle(25, 15, "黑体");
outtextxy(WIN_HALF - 25, 35, "空气良好");
setTextStyle(25, 13, "宋体");
outtextxy(WIN_HALF - 25, 65, "晴天");
outtextxy(WIN_HALF - 25, 95, "25℃");
outtextxy(WIN_HALF + 38, 65, "26°");
outtextxy(WIN_HALF + 38, 95, "17°");
drawImg(other + 4, WIN_HALF + 73, 60);//上面的箭头
drawImg(other + 3, WIN_HALF + 73, 90);//下面的箭头
drawImg(other + 1, WIN_HALF + 105, 70);//太阳
putimage(WIN_HALF + 73, 60, other + 4);
putimage(WIN_HALF + 73, 90, other + 3);
putimage(WIN_HALF + 105, 70, other + 1);
// 下部分
setTextStyle(37, 17, "宋体");
outtextxy(100, WIN_HALF + 130, "睡眠");
outtextxy(WIN_HALF + 90, WIN_HALF + 130, "距离");
outtextxy(50, WIN_HALF-40, "平顶山");

setTextStyle(40, 15, "Arial");
outtextxy(185, WIN_HALF + 125, "7h30m");
outtextxy(215, WIN_HALF + 180, "9.88km");
//中间
//心率
setTextStyle(25, 13, "宋体");
outtextxy(60, WIN_HALF + 30, "80~128");
drawImg(&other[0], 65, WIN_HALF + 50);//心率图
putimage(65, WIN_HALF + 50, other + 0);
setTextStyle(40, 15, "Arial");
outtextxy(135, WIN_HALF + 60, "92");
// 步数
drawImg(&other[2], WIN_HALF + 65, WIN_HALF + 65);
putimage(WIN_HALF + 65, WIN_HALF + 65, &other[2]);
outtextxy(WIN_HALF + 125, WIN_HALF + 75, "9527");
//时间、日期相关
time_t timep = time(NULL);//获取当前时间
struct tm* p = localtime(&timep);//把时间转成格式化时间
setTextStyle(25, 12, "宋体");
outtextxy(WIN_HALF + 110, WIN_HALF - 20, "四月六号");
char fileName[40] = &#123; 0 &#125;;
sprintf_s(fileName, "周%s %d-%d", week[p->tm_wday], p->tm_mon + 1, p->tm_mday);
outtextxy(WIN_HALF + 110, WIN_HALF + 10, fileName);
// 获取字体
setTextStyle(100, 40, "Arial");
char szBuf[40] = &#123; 0 &#125;;
sprintf_s(szBuf, "%d:%02d", p->tm_hour, p->tm_min);
outtextxy(105, 120, szBuf);
// 秒
setTextStyle(55, 23, "Arial");
sprintf(szBuf, "%02d", p->tm_sec);
outtextxy(335, 160, szBuf);
&#125;
int main()
&#123;
initgraph(WIN_SIZE, WIN_SIZE/*,EW_SHOWCONSOLE*/);
SetWindowNewStyle(WIN_SIZE, WIN_SIZE);
loadImg();
BeginBatchDraw();//双缓冲 防止闪屏
while (true)
&#123;
gameDraw();
animation();
mouseEvent();
FlushBatchDraw();
&#125;
EndBatchDraw();
return 0;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<h1 data-id="heading-6">运行图</h1>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c8dc51e8547d41dbb6bb21148bc2dc2c~tplv-k3u1fbpfcp-zoom-1.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<h1 data-id="heading-7">后续</h1>
<p>如果想了解更多物联网知识，可以关注我的项目实战专栏</p></div>  
</div>
            