
---
title: '如何从0到1实现自己的组件库'
categories: 
 - 编程
 - 掘金
 - 分类
headimg: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/45949fd10238476a97534d5c76735ddf~tplv-k3u1fbpfcp-zoom-1.image'
author: 掘金
comments: false
date: Thu, 06 May 2021 00:58:04 GMT
thumbnail: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/45949fd10238476a97534d5c76735ddf~tplv-k3u1fbpfcp-zoom-1.image'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><p>前段时间自己在尝试从0到1实现一个组件库，把一些常见功能总结下，如组件封装、按需加载、文档自动生成等</p>
<h3 data-id="heading-0">封装弹窗组件</h3>
<h4 data-id="heading-1">Vue组件封装常用api</h4>
<p>Vue组件的API主要包含三部分：props、slot、event</p>
<ol>
<li>props 表示组件接收的参数，最好用对象的写法，这样可以针对每个属性设置类型、默认值或自定义校验属性的值，此外还可以通过type、validator等方式对输入进行验证</li>
<li>slot 可以给组件动态插入一些内容或组件，是实现高阶组件的重要途径；当需要多个插槽时，可以使用具名slot</li>
<li>event 是子组件向父组件传递消息的重要途径,($emit)</li>
</ol>
<h4 data-id="heading-2">props单向数据流</h4>
<p>如果直接改变 props 时会发生一个警告报错，因为Vue传递数据时是单向数据流的：父级 prop 的更新会向下流动到子组件中，但是反过来则不行，这是为了防止从子组件意外变更父级组件的状态。</p>
<h4 data-id="heading-3">组件间通信</h4>
<ol>
<li>父子组件的关系可以总结为 prop 向下传递，事件event向上传递</li>
<li>祖先组件和后代组件（跨多代）的数据传递，可以使用provide和inject来实现</li>
</ol>
<h4 data-id="heading-4">封装一个弹窗组件</h4>
<p>蓝湖地址：<a href="https://lanhuapp.com/web/#/item/project/board/detail?pid=19313cf3-77fa-45da-8760-42bd2f4def34&project_id=19313cf3-77fa-45da-8760-42bd2f4def34&image_id=0be7133d-4f35-406f-86a9-155648b3f93a" target="_blank" rel="nofollow noopener noreferrer">lanhuapp.com/web/#/item/…</a></p>
<p>看设计稿分析需要传进来的prop:</p>
<ol>
<li>控制显示与隐藏</li>
<li>标题</li>
<li>内容</li>
<li>底部按钮文案（取消跟确定）</li>
</ol>
<pre><code class="copyable">props:&#123;
    // 控制显示隐藏
    visible: &#123;
      type: Boolean,
      default: false
    &#125;,
    // 标题
    title: &#123;
      type: String,
      default: ''
    &#125;,
    // 内容描述
    desc: &#123;
      type: String,
      default: ''
    &#125;,
    // 取消文案
    cancelText: &#123;
      type: String,
      default: '以后再说'
    &#125;,
    // 确定文案
    okText: &#123;
      type: String,
      default: '我知道了'
    &#125;,
&#125;,
<span class="copy-code-btn">复制代码</span></code></pre>
<p>modal组件</p>
<pre><code class="copyable"><template>
  <div  class="modal_wrapper" v-show="visible">
    <div class="modal">
      <div class="modal_body">
        <div class="title"> 
            &#123;&#123;title&#125;&#125;
        </div>
        <div class="desc">
            &#123;&#123;desc&#125;&#125;
        </div>
      </div>
      <div class="modal_footer">
        <div class="btn-list">
          <div class="cancel-btn" @click="close">&#123;&#123;cancelText&#125;&#125;</div>
          <div class="confirm-btn" @click="confirm">&#123;&#123;okText&#125;&#125;</div>
        </div>
      </div>
    </div>
  </div>
</template>
<script>
export default &#123;
  name: "Modal",
  props:&#123;
    // 控制显示隐藏
    visible: &#123;
      type: Boolean,
      default: false
    &#125;,
    // 标题
    title: &#123;
      type: String,
      default: ''
    &#125;,
    // 内容描述
    desc: &#123;
      type: String,
      default: ''
    &#125;,
    // 取消文案
    cancelText: &#123;
      type: String,
      default: '以后再说'
    &#125;,
    // 确定文案
    okText: &#123;
      type: String,
      default: '我知道了'
    &#125;,
  &#125;,
  data() &#123;
    return &#123;&#125;
  &#125;,
  methods: &#123;
    close() &#123;
      this.$emit("toggle", false);
    &#125;,
    confirm() &#123;
      this.$emit("confirm"); 
    &#125;
  &#125;
&#125;;
</script>
<style lang='less' scoped>
.modal_wrapper&#123;
  width: 100vw;
  height: 100vh;
  position: fixed;
  top: 0;
  left: 0;
  background-color: rgba(0,0,0,0.5);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 999;
  .modal &#123;
    background-color: #fff;
     border-radius: .16rem;
     
    .modal_body &#123;
      width: 5.6rem;
      padding: .5rem;
      box-sizing: border-box;
      min-height: 2.6rem;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      .title &#123;
        margin-bottom: .3rem;
        font-size: .32rem;
        color: #333333;
        font-weight: bold;
        line-height: .42rem;
      &#125;
      .desc &#123;
        font-size: .28rem;
        color: #999999;
        font-weight: bold;
        line-height: .42rem;
      &#125;
    &#125;
    .modal_footer&#123;
     border-top: 1px solid #E5E5E5;
      .btn-list &#123;
       
        display: flex;
        font-size: .32rem;
        
        align-items: center;
        .cancel-btn &#123;
          flex: 1;
          color: #999999;
          height: 1rem;
          line-height: 1rem;
        &#125;
        .confirm-btn &#123;
          flex: 1;
          color: #FE5D72;
          border-left: 1px solid #E5E5E5;
          height: 1rem;
          line-height: 1rem;
        &#125;
      &#125;
    &#125;
  &#125;
&#125;
</style>
<span class="copy-code-btn">复制代码</span></code></pre>
<p>使用</p>
<pre><code class="copyable"><modal @close="close" :visible="visible" title="确定拉到黑名单？" desc="拉黑后你将不再受到对方消息"></modal>

data()&#123;
  return &#123;
    visible: false
  &#125;
&#125;,
methods:&#123;
  close(value)&#123;
    this.visible = value
  &#125;,
  open()&#123;
    this.visible = true
  &#125;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<h4 data-id="heading-5">使用.sync 修饰符</h4>
<p>上面控制组件显示隐藏的实现方式：打开时向组件传入一个为true布尔值，关闭时向父组件发送一个close事件并带上false参数，让父组件中修改原始的prop数据，完成状态的更新。</p>
<p>但是这样做过于繁琐，这时候可以使用.sync修饰符进行简写。</p>
<p>子组件中</p>
<pre><code class="copyable">close()&#123;
    this.$emit('close', false)
    this.$emit('update:visible', false)
  &#125;,
<span class="copy-code-btn">复制代码</span></code></pre>
<p>父组件</p>
<pre><code class="copyable"><modal :visible.sync="visible" title="确定拉到黑名单？" desc="拉黑后你将不再受到对方消息"></modal>
<span class="copy-code-btn">复制代码</span></code></pre>
<p>上面的写法等同于</p>
<pre><code class="copyable"><modal :visible="visible" @update:visible="val => visible = val" title="确定拉到黑名单？" desc="拉黑后你将不再受到对方消息"></modal>
<span class="copy-code-btn">复制代码</span></code></pre>
<p>@update:visible 中是update是显示更新的事件，跟在后面的:visible则是需要改变对应的props值。</p>
<h4 data-id="heading-6">v-model</h4>
<p>在input元素中我们常常用v-model进行双向绑定</p>
<pre><code class="copyable"><input v-model="something">
等同于
<input :value="something" @input="something = $event.target.value">
<span class="copy-code-btn">复制代码</span></code></pre>
<p>既然在元素上能进行双向绑定，那在组件中进行双向绑定又如何实现，原理其实都是一样的，只是应用在自定义的组件上时，拿的并不是$event.target.value，因为我此时不作用在 Input 输入框上,拿的值应该传过来的第一个参数arguments[0]</p>
<p>在组件中使用v-model</p>
<pre><code class="copyable"><modal  v-model="visible" title="确定拉到黑名单？" desc="拉黑后你将不再受到对方消息"></modal>
等同于
<modal  :value="visible" @input="visible = arguments[0]" title="确定拉到黑名单？" desc="拉黑后你将不再受到对方消息"></modal>
<span class="copy-code-btn">复制代码</span></code></pre>
<p>那么在子组件中就要接收名字为value的prop和发送input事件</p>
<pre><code class="copyable"><template>
  <div  class="modal_wrapper" v-show="value">
    <div class="modal">
      <div class="modal_body">
        <div class="title"> 
            &#123;&#123;title&#125;&#125;
        </div>
        <div class="desc">
            &#123;&#123;desc&#125;&#125;
        </div>
      </div>
      <div class="modal_footer">
        <div class="btn-list">
          <div class="cancel-btn" @click="close">&#123;&#123;cancelText&#125;&#125;</div>
          <div class="confirm-btn" @click="confirm">&#123;&#123;okText&#125;&#125;</div>
        </div>
      </div>
    </div>
  </div>
</template>

<script >
  export default &#123;
    name: 'Modal',
    props:&#123;
      // 控制显示隐藏value
      value: &#123;
        type: Boolean,
        default: false
      &#125;,
      // 标题
      title: &#123;
        type: String,
        default: ''
      &#125;,
      // 内容描述
      desc: &#123;
        type: String,
        default: ''
      &#125;,
      // 取消文案
      cancelText: &#123;
        type: String,
        default: '以后再说'
      &#125;,
      // 确定文案
      okText: &#123;
        type: String,
        default: '我知道了'
      &#125;,
    &#125;,
    data () &#123;
      return &#123;
      &#125;
    &#125;,
    methods:&#123;
      close()&#123;
        this.$emit('close', false)
        this.$emit('input', false)
      &#125;,
      confirm()&#123;

      &#125;
    &#125;
  &#125;
</script>
<span class="copy-code-btn">复制代码</span></code></pre>
<p>默认情况下，一个组件的 v-model 会使用 value 属性和 input 事件</p>
<p>往往有些时候，value 值被占用了，或者表单的和自定义v-model的$emit('input')事件发生冲突，为了避免这种冲突，可以定制组件 v-model</p>
<p>在子组件中</p>
<pre><code class="copyable"><template>
  <div  class="modal_wrapper" v-show="visible">
    <div class="modal">
      <div class="modal_body">
        <div class="title"> 
            &#123;&#123;title&#125;&#125;
        </div>
        <div class="desc">
            &#123;&#123;desc&#125;&#125;
        </div>
      </div>
      <div class="modal_footer">
        <div class="btn-list">
          <div class="cancel-btn" @click="close">&#123;&#123;cancelText&#125;&#125;</div>
          <div class="confirm-btn" @click="confirm">&#123;&#123;okText&#125;&#125;</div>
        </div>
      </div>
    </div>
  </div>
</template>

<script >
  export default &#123;
    name: 'Modal',
    model:&#123;
      prop: 'visible',
      event: 'toggle'
    &#125;,
    props:&#123;
      // 控制显示隐藏
      visible: &#123;
        type: Boolean,
        default: false
      &#125;,
      // 标题
      title: &#123;
        type: String,
        default: ''
      &#125;,
      // 内容描述
      desc: &#123;
        type: String,
        default: ''
      &#125;,
      // 取消文案
      cancelText: &#123;
        type: String,
        default: '以后再说'
      &#125;,
      // 确定文案
      okText: &#123;
        type: String,
        default: '我知道了'
      &#125;,
    &#125;,
    methods:&#123;
      close()&#123;
        this.$emit('close', false)
        this.$emit('toggle', false)
      &#125;,
      confirm()&#123;

      &#125;
    &#125;
  &#125;
</script>
<span class="copy-code-btn">复制代码</span></code></pre>
<p>通过 model 选项的改变，把 props 从原本的value换成了visible，input触发的事件换成了toggle，解决了冲突的问题。</p>
<p><code>.sync</code>和<code>v-model</code>使用场景：父子组件间需要双向绑定某个数据的时候。</p>
<h4 data-id="heading-7">使用插槽动态替换内容</h4>
<p>现在弹窗内容只能单单根据props传进来的文字进行修改，如果想传入一个组件或者一张图片呢， 那就要用到插槽了。</p>
<p>使用插槽改写</p>
<pre><code class="copyable"><template>
  <div  class="modal_wrapper" v-show="visible">
    <div class="modal">
      <div class="modal_body">
          <div class="title"> 
            <!-- 匿名插槽 -->
            <slot>
              &#123;&#123;title&#125;&#125;
            </slot>
          </div>
        <div class="desc">
           <!-- 具名插槽 -->
          <slot name="desc">&#123;&#123;desc&#125;&#125;</slot>
        </div>
      </div>
      <div class="modal_footer">
        <!-- 具名插槽 -->
        <slot name="footer">
          <div class="btn-list">
            <div class="cancel-btn" @click="close">&#123;&#123;cancelText&#125;&#125;</div>
            <div class="confirm-btn" @click="confirm">&#123;&#123;okText&#125;&#125;</div>
          </div>
        </slot>
      </div>
    </div>
  </div>
</template>
<span class="copy-code-btn">复制代码</span></code></pre>
<p>父组件使用</p>
<pre><code class="copyable"><modal v-model="visible" title="确定拉到黑名单？" desc="拉黑后你将不再受到对方消息">
    好的
    <template slot="desc">
      开通会员，每日不限匹配次数
    </template>
    <template slot="footer">
      <div class="btn">知道了</div>
    </template>
</modal>
<span class="copy-code-btn">复制代码</span></code></pre>
<p>匿名插槽： name 属性默认是default
具名插槽： 带有name 属性</p>
<p><code><template></code> 元素中的所有内容都将会被传入相应名字的插槽。没有插槽名字的 <code><template></code> 中的内容都会被视为默认插槽的内容。</p>
<h3 data-id="heading-8">基于vue-cli3 脚手架实现组件按需加载打包</h3>
<h4 data-id="heading-9">组件库打包</h4>
<p>一般引用组件库有两种方式引入，一种是全部引入，一种是按需加载</p>
<p>我们一般采用第二种，就是可以这样加载组件</p>
<pre><code class="copyable">import &#123; modal &#125;  from 'my-ui'
Vue.use(modal)
<span class="copy-code-btn">复制代码</span></code></pre>
<p>按需加载的实现方式有两种：</p>
<ol>
<li>各个组件分开打包，使用时要安装babel-plugin-import 利用它实现组件按需引入（目前ant design vue 跟element-ui 都是采用这种方式）</li>
<li>利用webpack 生产环境下的Tree-shaking(移除 JavaScript 上下文中的未引用代码), 但需要满足使用 ES2015 模块语法（即 import 和 export），webpack 目前还并没有支持 ES modules 输出格式的包，但是rollup支持打包成es module模块的包</li>
</ol>
<blockquote>
<p>CommonJS是通过module.exports定义模块， require引入模块的，但在前端浏览器中并不支持该规范，webpack以及Node是采用CommonJS的规范来写的</p>
</blockquote>
<blockquote>
<p>AMD(Asynchronous Module Definition):异步模块定义,使用时需要引入第三方的库文件：RequireJS,是运行在浏览器环境中异步加载模块，可以并行加载多个模块。</p>
</blockquote>
<blockquote>
<p>CMD(Common Module Definition)：通用模块定义。它解决的问题和AMD规范是一样的，只不过在模块定义方式和模块加载时机上不同，CMD也需要额外的引入第三方的库文件：SeaJS</p>
</blockquote>
<blockquote>
<p>UMD：兼容CommonJS 和 AMD,能运行在浏览器和node或者webpack环境中，同时还支持window的全局变量规范</p>
</blockquote>
<blockquote>
<p>ES6 module：import和export。import命令用于输入其他模块提供的功能。export命令用于规范模块的对外接口， 浏览器还有兼容问题，需要babel编译成es5 才能使用</p>
</blockquote>
<p>我们由于是基于vue-cli3 进行开发的，所以我们就采用第一种方式实现按需加载</p>
<ol>
<li>使用vue-cli3 创建一个项目</li>
</ol>
<pre><code class="copyable">vue create my-ui
<span class="copy-code-btn">复制代码</span></code></pre>
<ol>
<li>创建packages文件夹用来存放组件库源码。</li>
<li>创建组件文件，一个组件至少包括两个文件，一个index.js用来导出组件作为插件使用，一个.vue文件，用来编写组件。</li>
</ol>
<p>modal组件下的index.js</p>
<pre><code class="copyable">import modal from './modal.vue'
modal.install = (Vue)=>&#123;
  Vue.component(modal.name, modal)
&#125;
export default modal
<span class="copy-code-btn">复制代码</span></code></pre>
<p>文件目录
<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/45949fd10238476a97534d5c76735ddf~tplv-k3u1fbpfcp-zoom-1.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>在packages文件新建index.js用来导出所有的组件库</p>
<p>packages/index.js</p>
<pre><code class="copyable">import './index.less'
const components = []
// 遍历当前文件夹中所有.js文件 自动导入组件
const ctx = require.context('./',true,/\.js$/)

ctx.keys().forEach(path =>&#123;
  if (path.startsWith('./index')) return  // 如果是最外面的index.js 就退出
  const componentConfig = ctx(path) //导入组件
  // 兼容 import export 和 require module.export 两种规范
  const comp = componentConfig.default || componentConfig
  components.push(comp)
&#125;)

const install = (Vue)=>&#123;
  components.forEach(comp =>&#123;
    Vue.use(comp)
  &#125;)
&#125;

// 判断是否是直接引入vue文件
if (typeof window !== 'undefined' && window.Vue) &#123;
  install(window.Vue)
&#125;

export default &#123;
  install
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<h4 data-id="heading-10">require.context</h4>
<p>传入三个参数：一个要搜索的目录，一个标记表示是否还搜索其子目录， 以及一个匹配文件的正则表达式。</p>
<p>require.context函数执行后返回的是一个（require）函数,参数是想要加载模块的路径,并且这个函数有3个属性：resolve, keys, id。这里主要用到keys</p>
<p>keys(Function) -返回匹配成功模块的名字组成的数组</p>
<pre><code class="copyable">const ctx = require.context('./', true, /\.js$/)
console.log(ctx.keys())
// ['./index.js', './modal/index.js', './toast/index.js']
<span class="copy-code-btn">复制代码</span></code></pre>
<p>webpack 会在构建中解析代码中的 require.context()</p>
<h4 data-id="heading-11">Vue.use</h4>
<p>使用Vue.use()方法加载插件时必须提供一个install方法，在install方法中会传入Vue实例，通过Vue.component(name, component)全局注册组件</p>
<p>由于需要支持按需加载，所有每个组件都必须实现install方法，全局注册组件</p>
<p>packages/modal/index.js</p>
<pre><code class="copyable">import modal from './modal.vue'
modal.install = (Vue)=>&#123;
  Vue.component(modal.name, modal)
&#125;
export default modal
<span class="copy-code-btn">复制代码</span></code></pre>
<ol start="3">
<li>新建vue.config.js配置文件，修改打包时多入口配置</li>
</ol>
<pre><code class="copyable">const path =  require('path')
const fs = require('fs')
function resolve(name)&#123;
  return path.resolve(__dirname, name)
&#125;
const entry=&#123;&#125;
//获取packages文件夹下所有文件名
const files = fs.readdirSync(resolve('./packages'))
files.forEach(name =>&#123;
  name = name.split('.')[0]
  entry[name] = resolve('./packages/'+ name)
&#125;)
console.log(entry)
/*
多入口打包配置
&#123; 
  index: 'E:\\demo\\my-ui\\packages\\index', 
  modal: 'E:\\demo\\my-ui\\packages\\modal', 
  toast: 'E:\\demo\\my-ui\\packages\\toast' 
&#125;
*/
const prod = &#123;
  css: &#123;
    sourceMap: true,
    extract: &#123;
        filename: 'style/[name].css'
    &#125;
  &#125;,
  configureWebpack: &#123;
      entry: &#123;
          ...entry,
      &#125;,
      output: &#123;
          filename: '[name]/index.js',
          libraryTarget: 'umd',
      &#125;
  &#125;,
  chainWebpack: config =>&#123;
    // @ 默认指向 src 目录，这里要改成 examples
    // 另外也可以新增一个 ~ 指向 packages
    config.resolve.alias
    .set('@', path.resolve('examples'))
    .set('~', path.resolve('packages'))
    config.module.rule('js')
    .include.add(/packages/).end()
    .include.add(/examples/).end()
    .use('babel')
    .loader('babel-loader')
    .tap(options => &#123;
      // 修改它的选项...
      return options
    &#125;)
    config.optimization.delete('splitChunks')
    config.plugins.delete('copy')
    config.plugins.delete('html')
    config.plugins.delete('preload')
    config.plugins.delete('prefetch')
    config.plugins.delete('hmr')
    config.entryPoints.delete('app')
  &#125;,
  outputDir: 'lib',
  productionSourceMap: false,
&#125;
const dev = &#123;
  pages: &#123;
    index: &#123;
      entry: 'examples/main.js',
      template: 'public/index.html',
      filename: 'index.html',
    &#125;,
&#125;,
  chainWebpack: config =>&#123;
    // @ 默认指向 src 目录，这里要改成 examples
    // 另外也可以新增一个 ~ 指向 packages
    config.resolve.alias
    .set('@', path.resolve('examples'))
    .set('~', path.resolve('packages'))
    config.module.rule('js')
    .include.add(/packages/).end()
    .include.add(/examples/).end()
    .use('babel')
    .loader('babel-loader')
    .tap(options => &#123;
      // 修改它的选项...
      return options
    &#125;)
  &#125;,
  
&#125; 
module.exports = process.env.NODE_ENV === 'production'? prod: dev
<span class="copy-code-btn">复制代码</span></code></pre>
<p>运行 npm run build 生产环境下会导出prod的配置 进行打包
打包后生成的文件夹目录
<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fbae2a7fd4a34872b99ef06e0c4ad432~tplv-k3u1fbpfcp-zoom-1.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>在使用时候需要安装babel-plugin-import插件，利用它实现组件按需引入。（element-ui和ant design vue 目前也是采用这种方法）</p>
<pre><code class="copyable">npm install babel-plugin-import --save-dev
<span class="copy-code-btn">复制代码</span></code></pre>
<p>修改babel.config.js配置</p>
<pre><code class="copyable">module.exports = &#123;
    "presets": ["@vue/app"],
    "plugins": [
        [
            "import",
            &#123;
                "libraryName": "my-ui",//组件库名称
                "camel2DashComponentName": false,//是否需要驼峰转短线
                "camel2UnderlineComponentName": false//是否需要驼峰转下划线
                "style": (name) =>&#123; // 自动引入css
                    const cssName = name.split('/')[2];
                    return `my-ui/lib/style/$&#123;cssName&#125;.css` 
                &#125;

            &#125;
        ],
    ]
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>这个插件做了什么？</p>
<pre><code class="copyable">import &#123; modal, toast &#125; from 'my-ui';
相当于
import modal from  "my-ui/lib/modal/index.js";
import "my-ui/lib/style/modal.css" 
import toast from  "my-ui/lib/toast/index.js";
import "my-ui/lib/style/toast.css"
<span class="copy-code-btn">复制代码</span></code></pre>
<p>插件会帮你转换成 my-ui/lib/xxx 的写法，这样的话就只会引入使用到组件的js和css文件，做到按需加载。</p>
<h3 data-id="heading-12">文档自动生成</h3>
<p>对于 Vue 组件，一般来说需要对外暴露： props、event、slot 等接口信息
对于 UI 组件，还需要提供预览，方便快速选择合适的组件
如果使用 Markdown 撰写，虽然能写 API 文档，但是无法提供组件预览，并且手动写文档的成本也很大</p>
<p>使用 vue-cli-plugin-styleguidist 进行自动化文档的生成，并提供组件预览</p>
<p>安装：</p>
<pre><code class="copyable">npm install vue-cli-plugin-styleguidist --save-dev
<span class="copy-code-btn">复制代码</span></code></pre>
<p>然后在 package.json 配置下面两行命令，分别用于开发预览和部署打包</p>
<pre><code class="copyable">&#123;
  "scripts": &#123;
    "styleguide": "vue-styleguidist server",
    "styleguide:build": "vue-styleguidist build"
  &#125;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>在项目根目录下，创建 styleguide.config.js</p>
<pre><code class="copyable">// styleguide.config
module.exports = &#123;
  title: 'my-ui',          // 文档的标题
  components: 'packages/**/*.vue', // 组件的目录
  usageMode: 'expand',                   // 是否展开用法
  exampleMode: 'expand',                 // 是否展开示例代码
  styleguideDir: 'styleguide',           // 打包的目录
  codeSplit: true,                       // 打包时是否进行分片
&#125;;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>编写好的组件注释</p>
<pre><code class="copyable"><template>
  <div class="modal_wrapper" v-show="visible">
    <div class="modal">
      <div class="modal_body">
        <div class="title">
          <!--  @slot 匿名插槽 标题 -->
          <slot>
            &#123;&#123; title &#125;&#125;
          </slot>
        </div>
        <div class="desc">
          <!--  @slot 具名插槽 内容描述-->
          <slot name="desc" :user="title">&#123;&#123; desc &#125;&#125;</slot>
        </div>
      </div>
      <div class="modal_footer">
        <!--  @slot 具名插槽 底部按钮-->
        <slot name="footer">
          <div class="btn-list">
            <div class="cancel-btn" @click="close">&#123;&#123; cancelText &#125;&#125;</div>
            <div class="confirm-btn" @click="confirm">&#123;&#123; okText &#125;&#125;</div>
          </div>
        </slot>
      </div>
    </div>
  </div>
</template>

<script>
import "../index.less";
export default &#123;
  name: "Modal",
  model: &#123;
    prop: "visible",
    event: "toggle"
  &#125;,
  props: &#123;
    /**
     * 控制显示隐藏
     * @model
     */

    visible: &#123;
      type: Boolean,
      default: false
    &#125;,
    /**
     * 标题
     *
     */

    title: &#123;
      type: String,
      default: ""
    &#125;,
    /** 内容描述*/

    desc: &#123;
      type: String,
      default: ""
    &#125;,
    /** 取消文案*/

    cancelText: &#123;
      type: String,
      default: "以后再说"
    &#125;,
    /** 确定文案*/

    okText: &#123;
      type: String,
      default: "我知道了"
    &#125;
  &#125;,
  data() &#123;
    return &#123;
      on: false
    &#125;;
  &#125;,
  methods: &#123;
    close() &#123;
      /**
       * 按钮点击成功emit事件
       * @event toggle
       * @type &#123;boolean&#125;
       */
      this.$emit("toggle", false);
    &#125;,
    confirm() &#123;&#125;
  &#125;
&#125;;
</script>

<style lang="less" scoped>
.modal_wrapper &#123;
  width: 100vw;
  height: 100vh;
  position: fixed;
  top: 0;
  left: 0;
  background-color: rgba(0, 0, 0, 0.5);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 999;
  .modal &#123;
    background-color: #fff;
    border-radius: 0.16rem;

    .modal_body &#123;
      width: 5.6rem;
      padding: 0.5rem;
      box-sizing: border-box;
      min-height: 2.6rem;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      .title &#123;
        margin-bottom: 0.3rem;
        font-size: 0.32rem;
        color: #333333;
        font-weight: bold;
        line-height: 0.42rem;
      &#125;
      .desc &#123;
        font-size: 0.28rem;
        color: #999999;
        font-weight: bold;
        line-height: 0.42rem;
      &#125;
    &#125;
    .modal_footer &#123;
      border-top: 1px solid #e5e5e5;
      .btn-list &#123;
        display: flex;
        font-size: 0.32rem;

        align-items: center;
        .cancel-btn &#123;
          flex: 1;
          color: #999999;
          height: 1rem;
          line-height: 1rem;
        &#125;
        .confirm-btn &#123;
          flex: 1;
          color: #fe5d72;
          border-left: 1px solid #e5e5e5;
          height: 1rem;
          line-height: 1rem;
        &#125;
      &#125;
    &#125;
  &#125;
&#125;
</style>
<span class="copy-code-btn">复制代码</span></code></pre>
<p>效果图
<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9a1b0b79bb9c4f6a98857c4ebe352418~tplv-k3u1fbpfcp-zoom-1.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>UI组件预览,在组件目录下新建 Readme.md文件 用```vue开头做的标识，这个插件会把这一段代码编译成vue组件，并且能够提供交互。组件开发时候可以用这个插件一边调式组件一般写文档</p>
<p>readme.md 文档</p>
<pre><code class="copyable"> ```vue
<template>
  <div id="app">
    <div @click="open">打开弹窗</div>
    <modal  v-model="visible" title="确定拉到黑名单？" desc="拉黑后你将不再受到对方消息">
      你还不是会员
      <template #desc="&#123; user &#125;">
        开通会员，每日不限匹配次数a &#123;&#123;user&#125;&#125;
      </template>
    </modal>
  </div>
</template>
<script>
import '../index.less'
export default &#123;  
  name: 'App',
  data()&#123;
    return &#123;
      visible: false
    &#125;
  &#125;,
  methods:&#123;
    close()&#123;
      this.visible = false
    &#125;,
    open()&#123;
      console.log('a')
      this.visible = true
    &#125;
  &#125;
&#125;
</script>

<style lang="less" scoped>
#app &#123;
  font-family: Avenir, Helvetica, Arial, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-align: center;
  color: #2c3e50;
  margin-top: 60px;
  /deep/
  .btn &#123;
    line-height: 1rem;
    height: 1rem;
    color: #FE5D72;
    font-size: .32rem;
  &#125;
&#125;
</style>

 ```vue

<span class="copy-code-btn">复制代码</span></code></pre>
<p>效果图
<img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8c518258b42d4d96a71eb10fb6e648a2~tplv-k3u1fbpfcp-zoom-1.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<h3 data-id="heading-13">发布到npm</h3>
<p>发布到npm这一步比较简单，首先得注册npm账号， 然后修改packages.js配置</p>
<pre><code class="copyable">&#123;
  "name": "my-ui", // 包名
  "version": "0.1.0", // 每次发布都要修改版本号
  "private": false, // 这里传到npm 必须设置false，表示是公开的包，除非给钱
  "scripts": &#123;
    "serve": "vue-cli-service serve",
    "build": "vue-cli-service build",
    "lint": "vue-cli-service lint",
    "styleguide": "vue-styleguidist server",
    "styleguide:build": "vue-styleguidist build"
  &#125;,
  "main": "lib/index/index.js", // 访问入口
  "files": [ "lib" ] //需要发布到npm的文件， 一般是打包后的文件夹
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>然后就是登录发布了</p>
<pre><code class="copyable">npm login

npm publish
<span class="copy-code-btn">复制代码</span></code></pre></div>  
</div>
            