
---
title: '微信小程序实现锚点定位'
categories: 
 - 编程
 - 掘金
 - 分类
headimg: 'https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/662b8554a2064552819e0281e311b753~tplv-k3u1fbpfcp-watermark.image'
author: 掘金
comments: false
date: Sun, 11 Jul 2021 22:05:36 GMT
thumbnail: 'https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/662b8554a2064552819e0281e311b753~tplv-k3u1fbpfcp-watermark.image'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><p>在小程序开发中，我们经常会遇到滚动列表查看的需求，那么使用锚点定位来实现可以达到交互体验更加友好的效果，我们看下项目中实现的效果：</p>
<p>                                        <img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/662b8554a2064552819e0281e311b753~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<h3 data-id="heading-0">功能实现</h3>
<p>采用小程序视图容器组件实现：<strong>scroll-view</strong><br>
这里需要注意的是，竖向滚动时，<strong>scroll-view需要指定一个固定高度</strong>，我们看下WXML代码：</p>
<pre><code class="copyable"><scroll-view style="height:&#123;&#123;autoHeight&#125;&#125;;" scroll-y scroll-into-view="&#123;&#123;toView&#125;&#125;" class="scroll-warp" scroll-with-animation="&#123;&#123;true&#125;&#125;" bindscroll="handelScroll">
   <block wx:for="&#123;&#123;dataList&#125;&#125;" wx:key="&#123;&#123;index&#125;&#125;">
      <view class="floorType" id="&#123;&#123;item.floor&#125;&#125;">
     </view>
   </block>
</scroll-view>
<span class="copy-code-btn">复制代码</span></code></pre>
<p>这里autoHeight是根据不同机型的高度动态计算出来的，scroll-view有个重要属性：scroll-into-view，它接收一个string值，即为滚动的地点（锚点），那么我们需要在scroll-view子节点也设置相应的锚点列表：如上图的class=floorType节点中的id属性。这样我们的滚动就有了一一对应的关系了，在筛选块点击楼层，将<strong>toView</strong>变量设置成对应的数据，列表也会滚动到对应的位置。</p>
<p><strong>当我们滚动列表的时候，顶部的高亮筛选项也需要对应切换，那这个时候怎么办呢？</strong><br>
我们可以在bindscroll此事件上做文章：滚动列表的时候会触发此事件。</p>
<p>关键代码：</p>
<pre><code class="copyable">handelScroll(e) &#123;
        let scrollTop=e.detail.scrollTop;
        let scrollArr= this.data.anchorArray;
        if(scrollTop>=scrollArr[scrollArr.length-1]-this.data.autoHeight)&#123;
                return;
          &#125;else &#123;
              for(let i=0;i<scrollArr.length;i++)&#123;
                    if(scrollTop>=0&&scrollTop<scrollArr[0])&#123;
                    // selectFloorIndex控制筛选块高亮显示
                        this.setData(&#123;
                            selectFloorIndex: 0
                        &#125;);
                    &#125;else if(scrollTop>=scrollArr[i-1]&&scrollTop<scrollArr[i]) &#123;
                        this.setData(&#123;
                            selectFloorIndex: i
                        &#125;);
                 &#125;
             &#125;
         &#125;
    &#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>这里的<strong>anchorArray</strong>为所有锚点块所占页面高度的数组总和，用图可以看得更加清晰一点：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a11c6bf20b87452c80221c1264d50efe~tplv-k3u1fbpfcp-watermark.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>每个锚点块都有一个固定的高度，我们在拿到数据渲染完页面后，可以通过<br>
boundingClientRect方法拿到类名为floorType各个节点的高度，并将这些高度装进anchorArray数组中，那么当我们滚动超过某块锚点高度之后，顶部筛选项也会随之切换到下一个。</p>
<p>关键代码：</p>
<pre><code class="copyable">            let query = wx.createSelectorQuery().in(this);
            let heightArr =[];
            let h = 0;
            query.selectAll('.floorType').boundingClientRect((react)=>&#123;
                react.forEach((res)=>&#123;
                    h+=res.height;
                    heightArr.push(h)
                &#125;)
                this.setData(&#123;
                    anchorArray:heightArr
                &#125;);
            &#125;).exec();
<span class="copy-code-btn">复制代码</span></code></pre>
<p>到这里，我们的锚点定位滚动已完成，希望能对大家有所帮助，如有问题，欢迎沟通指出！</p></div>  
</div>
            