
---
title: '前后端分离项目部署实战（1）'
categories: 
 - 编程
 - 掘金
 - 分类
headimg: 'https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a4574d4a48554b0ea6d467b478866846~tplv-k3u1fbpfcp-watermark.image'
author: 掘金
comments: false
date: Thu, 17 Jun 2021 18:10:04 GMT
thumbnail: 'https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a4574d4a48554b0ea6d467b478866846~tplv-k3u1fbpfcp-watermark.image'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;color:#383838;font-size:15px;line-height:37.5px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:120px&#125;.markdown-body ::selection&#123;color:#fff;background-color:#a862ea&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;margin:30px 0 15px;color:#a862ea&#125;.markdown-body h1&#123;line-height:2;font-size:1.4em&#125;.markdown-body h1~p:first-of-type:first-letter&#123;color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder&#125;.markdown-body h2&#123;font-size:1.2em&#125;.markdown-body h3&#123;font-size:1.1em&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:2em&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;padding-left:.2em&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:10px&#125;.markdown-body li::marker&#123;color:#a862ea&#125;.markdown-body li,.markdown-body p&#123;opacity:.9;vertical-align:baseline;transition:all .1s ease&#125;.markdown-body li:hover,.markdown-body p:hover&#123;opacity:1&#125;.markdown-body a&#123;display:inline-block;color:#a862ea;cursor:pointer;padding-bottom:2px;text-decoration:none;position:relative&#125;.markdown-body a:after&#123;content:"";position:absolute;width:98%;height:2px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out&#125;.markdown-body a:hover:after&#123;transform:scaleX(1);transform-origin:bottom left&#125;.markdown-body a:active,.markdown-body a:link&#123;color:#a862ea&#125;.markdown-body img&#123;max-width:100%;user-select:none;margin:1em 0;box-shadow:0 0 20px 0 #e7daff;transition:transform .2s ease 0s;background-color:#f8f5ff&#125;.markdown-body img:hover&#123;opacity:1;transform:translateY(-2px)&#125;.markdown-body blockquote&#123;padding:.5em 1em;margin:15px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:4px solid #a862ea;background-color:#f8f5ff&#125;.markdown-body blockquote>p&#123;margin:0&#125;.markdown-body code&#123;padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff&#125;.markdown-body pre&#123;margin:2em 0;box-shadow:0 0 20px #e7daff&#125;.markdown-body pre>code&#123;display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:22.5px;color:#383838;border-radius:3px;scroll-behavior:smooth&#125;.markdown-body pre>code::-webkit-scrollbar&#123;height:6px;background-color:#f8f5ff&#125;.markdown-body pre>code::-webkit-scrollbar-thumb&#123;background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px&#125;.markdown-body hr&#123;margin:2em 0;border-top:1px solid #a862ea&#125;.markdown-body table&#123;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse;border:1px solid #e7daff&#125;.markdown-body thead&#123;color:#a862ea;background:#f8f5ff&#125;.markdown-body td,.markdown-body th&#123;padding:1em .5em&#125;.markdown-body tr&#123;background-color:#fcfcfc&#125;@media (max-width:720px)&#123;.markdown-body&#123;font-size:12px&#125;&#125;</style><h2 data-id="heading-0">最新一时脑热，买了个云服务玩玩。作为前端开发，对项目部署比较生疏，借这个机会就尝试下。提高自己。内容比较基础，大佬勿喷！</h2>
<h3 data-id="heading-1">1.前台代码配置</h3>
<p>demo基于vue开发，相关开发配置如下：</p>
<blockquote>
<p>开发相关配置：</p>
</blockquote>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">"axios"</span>;
<span class="hljs-keyword">const</span> service = axios.create(&#123;
  <span class="hljs-attr">baseURL</span>: <span class="hljs-string">"/api/"</span>, 
  <span class="hljs-attr">timeout</span>: <span class="hljs-number">5000</span>, <span class="hljs-comment">// request timeout</span>
&#125;);

==========================================================

devServer: &#123;
    <span class="hljs-attr">proxy</span>: &#123;
      <span class="hljs-string">"/api"</span>: &#123;
        <span class="hljs-attr">target</span>: <span class="hljs-string">"http://真实服务器IP:3000/"</span>, <span class="hljs-comment">//后台服务部署端口</span>
        <span class="hljs-attr">ws</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">pathRewrite</span>: &#123;
          <span class="hljs-comment">// 路径重写</span>
          <span class="hljs-string">"/api"</span>: <span class="hljs-string">""</span>, <span class="hljs-comment">// 这个意思就是以api开头的，定向到哪里, 如果你的后边还有路径的话， 会自动拼接上</span>
        &#125;,
      &#125;,
    &#125;,
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<blockquote>
<p>打包配置</p>
</blockquote>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-built_in">module</span>.exports = &#123;
  <span class="hljs-attr">publicPath</span>: <span class="hljs-string">"/vuemusic/"</span>, <span class="hljs-comment">//nginx静态文件访问路径</span>
  .
  .
  .
&#125;;
<span class="copy-code-btn">复制代码</span></code></pre>
<h3 data-id="heading-2">2.后台服务说明</h3>
<p>后台服务为大佬开发的 ”网易云音乐API“，<a href="https://github.com/Binaryify/NeteaseCloudMusicApi" target="_blank" rel="nofollow noopener noreferrer">github链接</a></p>
<p>服务默认部署在3000端口。监听3000端口下的请求。请求路径为根目录开始</p>
<h3 data-id="heading-3">3.部署问题</h3>
<p>前提说明：我的服务器为 CentOS 7.5 64位 。 静态服务器为nginx。安装方法请自行百度。</p>
<p>问题：我这边nginx服务为80端口，但是后台服务为3000端口。牵扯跨域问题。</p>
<ul>
<li>我的nginx配置：</li>
</ul>
<pre><code class="hljs language-sh copyable" lang="sh">    server &#123;
        listen       80;
        server_name  localhost1;
        root         /usr/share/nginx/html;

        <span class="hljs-comment"># Load configuration files for the default server block.</span>
        include /etc/nginx/default.d/*.conf;



        <span class="hljs-comment">#将所有以api开头的请求都代理到3000端口</span>
        <span class="hljs-comment"># 浏览器访问 http://真实服务器IP/api/song/url?id=33894312 </span>
        <span class="hljs-comment"># 实际在访问 http://真实服务器IP:3000/song/url?id=33894312</span>
        location /api/ &#123;
            proxy_pass http://localhost:3000/;
            proxy_set_header Host <span class="hljs-variable">$http_host</span>;
            proxy_set_header X-Real-IP <span class="hljs-variable">$remote_addr</span>;
            proxy_set_header X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;
            proxy_set_header X-Forwarded-Proto <span class="hljs-variable">$scheme</span>;
        &#125;
        <span class="hljs-comment"># 其他请求，都默认走80端口</span>
        location / &#123;
        &#125;

        error_page 404 /404.html;
        location = /404.html &#123;
        &#125;

        error_page 500 502 503 504 /50x.html;
        location = /50x.html &#123;
        &#125;
      &#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<ul>
<li>静态文件部署存放目录【vuemusic】：</li>
</ul>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a4574d4a48554b0ea6d467b478866846~tplv-k3u1fbpfcp-watermark.image" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<blockquote>
<p>此处存放路径，会影响vue打包的 publicPath ，以及nginx的相关配置。</p>
</blockquote>
<p>后话：本次部署，也是出了很多为题。自己百度解决。后续其他部署问题还会继续更新相关知识。欢迎大佬评论指导。</p></div>  
</div>
            