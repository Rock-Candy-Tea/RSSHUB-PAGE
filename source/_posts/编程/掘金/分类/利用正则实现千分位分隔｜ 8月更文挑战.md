
---
title: '利用正则实现千分位分隔｜ 8月更文挑战'
categories: 
 - 编程
 - 掘金
 - 分类
headimg: 'https://picsum.photos/400/300?random=8459'
author: 掘金
comments: false
date: Mon, 02 Aug 2021 07:05:00 GMT
thumbnail: 'https://picsum.photos/400/300?random=8459'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><h3 data-id="heading-0">前言</h3>
<p>在一些涉及到比较大的数字的场景中，比如人数，金额等，我们常常需要对这些数字进行千分位，然后逗号分隔，这样会比较好阅读。</p>
<p>比如</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-number">123456789</span>
<span class="copy-code-btn">复制代码</span></code></pre>
<p>如果是千分位分隔</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-number">123</span>,<span class="hljs-number">456</span>,<span class="hljs-number">789</span>
<span class="copy-code-btn">复制代码</span></code></pre>
<p>对比这两种，我们肯定是选择第二种，方便阅读。</p>
<h3 data-id="heading-1">实现</h3>
<p>那怎么实现呢？</p>
<p>一般是<strong>利用正则表达式</strong></p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">formatNumber</span>(<span class="hljs-params">num</span>) </span>&#123;
  <span class="hljs-keyword">const</span> reg = <span class="hljs-regexp">/(\d)(?=(\d&#123;3&#125;)+$)/g</span>
  <span class="hljs-keyword">return</span> num.toString().replace(reg, <span class="hljs-string">'$1,'</span>)
&#125;
formatNumber(<span class="hljs-number">12345678</span>) <span class="hljs-comment">// "12,345,678"</span>
formatNumber(<span class="hljs-number">8765432188</span>) <span class="hljs-comment">// "8,765,432,188"</span>
<span class="copy-code-btn">复制代码</span></code></pre>
<p>测试通过。</p>
<p>但是这是基于数字是整数型的正则，如果你的数字是有小数点的，结果如下</p>
<pre><code class="hljs language-js copyable" lang="js">formatNumber(<span class="hljs-number">1234.5678</span>) <span class="hljs-comment">// "1234.5,678"</span>
<span class="copy-code-btn">复制代码</span></code></pre>
<p>期望是<code>"1,234.5678"</code>，不需要对小数点部分做千分位分隔，只需要对整数部分做千分位分隔,</p>
<p>实际是<code> "1234.5,678"</code></p>
<p>所以需要对正则进行优化。</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">formatNumber</span>(<span class="hljs-params">num</span>) </span>&#123;
  <span class="hljs-keyword">const</span> reg = <span class="hljs-regexp">/(\d)(?=(\d&#123;3&#125;)+\.)/g</span>
  <span class="hljs-keyword">return</span> num.toString().replace(reg, <span class="hljs-string">'$1,'</span>)
&#125;
formatNumber(<span class="hljs-number">1234.5678</span>) <span class="hljs-comment">// "1,234.5678"</span>
formatNumber(<span class="hljs-number">1234</span>) <span class="hljs-comment">// "1234"</span>
<span class="copy-code-btn">复制代码</span></code></pre>
<p>从上面例子可以看到，</p>
<p>如果数字带有小数点，则是有效果的</p>
<p>但是如果数字是没有小数点的，这个正则是不起作用的， 所以需要对两个正则整合起来，实现对整数和小数的支持</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">formatNumber</span>(<span class="hljs-params">num</span>) </span>&#123;
  num = num.toString()
  <span class="hljs-keyword">let</span> reg = num.indexOf(<span class="hljs-string">'.'</span>) > -<span class="hljs-number">1</span> ? <span class="hljs-regexp">/(\d)(?=(\d&#123;3&#125;)+\.)/g</span> : <span class="hljs-regexp">/(\d)(?=(\d&#123;3&#125;)+$)/g</span>
  <span class="hljs-keyword">return</span> num.replace(reg, <span class="hljs-string">'$1,'</span>)
&#125;
formatNumber(<span class="hljs-number">1234.5678</span>) <span class="hljs-comment">// "1,234.5678"</span>
formatNumber(<span class="hljs-number">1234</span>) <span class="hljs-comment">// "1,234"</span>
<span class="copy-code-btn">复制代码</span></code></pre>
<p>下面对正则<code>/(\d)(?=(\d&#123;3&#125;)+$)/g</code>和<code>/(\d)(?=(\d&#123;3&#125;)+\.)/g</code>进行分析：</p>
<ol>
<li>这个正则主要是利用<code>d&#123;3&#125;</code>每3位数字匹配一次，匹配到就对前面的那个数字加上逗号，以此类推。</li>
<li>正则这里加了<code>$</code>和<code>.</code>,是为了优先后面的凑成3位，开头如果不足3位就不处理。</li>
<li>这里还使用了正则一个表达式<code>(?=pattern)</code>，术语叫<code>零宽断言</code>，或者也叫<code>正向肯定预查</code>。</li>
</ol>
<p>实现千分位分隔，核心点就是这个，下面来讲讲这个正则表达式。</p>
<h3 data-id="heading-2">零宽断言（正向肯定预查）</h3>
<p>(?=pattern)， 是指配合正则表达式进行匹配，但是不获取该匹配。下次匹配还是从该位置开始。</p>
<p>配合例子来讲会比较好理解：</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">var</span> regA = <span class="hljs-regexp">/答案(?=cp3)/</span>
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'答案cp3'</span>.match(regA)) <span class="hljs-comment">// ["答案"]</span>

<span class="hljs-keyword">var</span> regB = <span class="hljs-regexp">/cp3(?=cp3)/g</span>
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'cp3cp3cp3cp3'</span>.match(regB)) <span class="hljs-comment">// ["cp3", "cp3", "cp3"]</span>
<span class="copy-code-btn">复制代码</span></code></pre>
<p>第一个例子可以看到匹配到了<code>答案cp3</code>，但是只获取到了<code>答案</code>，<code>cp3</code>不获取</p>
<p>第二个例子可以看到匹配到了<code>cp3cp3</code>,只获取到了<code>cp3</code>，下次匹配从第二个<code>cp3</code>开始，以此类推，最终输出三个<code>cp3</code>。</p>
<p>结合上面的千分位分隔例子，因为我们使用了零宽断言，因为它下次匹配还是从该位置开始，所以就导致每个数字都会被匹配到，直到结尾</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">let</span> reg = <span class="hljs-regexp">/(\d)(?=(\d&#123;3&#125;)+)/g</span>
<span class="hljs-string">'1234567890'</span>.replace(reg, <span class="hljs-function">(<span class="hljs-params">match,$<span class="hljs-number">1</span>, $<span class="hljs-number">2</span>, index, str</span>) =></span> &#123;
 <span class="hljs-built_in">console</span>.log(match,$<span class="hljs-number">1</span>, $<span class="hljs-number">2</span>, index, str)
 <span class="hljs-keyword">return</span> $<span class="hljs-number">1</span> + <span class="hljs-string">','</span>
&#125;)

输出 <span class="hljs-number">1</span> <span class="hljs-number">1</span> <span class="hljs-number">890</span> <span class="hljs-number">0</span> <span class="hljs-number">1234567890</span>
输出 <span class="hljs-number">2</span> <span class="hljs-number">2</span> <span class="hljs-number">678</span> <span class="hljs-number">1</span> <span class="hljs-number">1234567890</span>
输出 <span class="hljs-number">3</span> <span class="hljs-number">3</span> <span class="hljs-number">789</span> <span class="hljs-number">2</span> <span class="hljs-number">1234567890</span>
输出 <span class="hljs-number">4</span> <span class="hljs-number">4</span> <span class="hljs-number">890</span> <span class="hljs-number">3</span> <span class="hljs-number">1234567890</span>
输出 <span class="hljs-number">5</span> <span class="hljs-number">5</span> <span class="hljs-number">678</span> <span class="hljs-number">4</span> <span class="hljs-number">1234567890</span>
输出 <span class="hljs-number">6</span> <span class="hljs-number">6</span> <span class="hljs-number">789</span> <span class="hljs-number">5</span> <span class="hljs-number">1234567890</span>
输出 <span class="hljs-number">7</span> <span class="hljs-number">7</span> <span class="hljs-number">890</span> <span class="hljs-number">6</span> <span class="hljs-number">1234567890</span>
返回 <span class="hljs-string">"1,2,3,4,5,6,7,890"</span>
<span class="copy-code-btn">复制代码</span></code></pre>
<p>所以我们在零宽断言里面加上<code>$</code>或者<code>.</code>去约束条件,限制优先匹配结尾，开头不足3位就不处理</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">let</span> reg = <span class="hljs-regexp">/(\d)(?=(\d&#123;3&#125;)+$)/g</span>
<span class="hljs-string">'1234567890'</span>.replace(reg, <span class="hljs-function">(<span class="hljs-params">match,$<span class="hljs-number">1</span>, $<span class="hljs-number">2</span>, index, str</span>) =></span> &#123;
 <span class="hljs-built_in">console</span>.log(match,$<span class="hljs-number">1</span>, $<span class="hljs-number">2</span>, index, str)
 <span class="hljs-keyword">return</span> $<span class="hljs-number">1</span> + <span class="hljs-string">','</span>
&#125;)
输出 <span class="hljs-number">1</span> <span class="hljs-number">1</span> <span class="hljs-number">890</span> <span class="hljs-number">0</span> <span class="hljs-number">1234567890</span>
输出 <span class="hljs-number">4</span> <span class="hljs-number">4</span> <span class="hljs-number">890</span> <span class="hljs-number">3</span> <span class="hljs-number">1234567890</span>
输出 <span class="hljs-number">7</span> <span class="hljs-number">7</span> <span class="hljs-number">890</span> <span class="hljs-number">6</span> <span class="hljs-number">1234567890</span>
返回 <span class="hljs-string">"1,234,567,890"</span>
<span class="copy-code-btn">复制代码</span></code></pre>
<p>这样子就没有问题了。</p>
<h3 data-id="heading-3">总结</h3>
<p>以上就是利用正则实现千分位分隔的总结</p>
<p>完整代码：</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">formatNumber</span>(<span class="hljs-params">num</span>) </span>&#123;
  num = num.toString()
  <span class="hljs-keyword">let</span> reg = num.indexOf(<span class="hljs-string">'.'</span>) > -<span class="hljs-number">1</span> ? <span class="hljs-regexp">/(\d)(?=(\d&#123;3&#125;)+\.)/g</span> : <span class="hljs-regexp">/(\d)(?=(\d&#123;3&#125;)+$)/g</span>
  <span class="hljs-keyword">return</span> num.replace(reg, <span class="hljs-string">'$1,'</span>)
&#125;
<span class="copy-code-btn">复制代码</span></code></pre></div>  
</div>
            