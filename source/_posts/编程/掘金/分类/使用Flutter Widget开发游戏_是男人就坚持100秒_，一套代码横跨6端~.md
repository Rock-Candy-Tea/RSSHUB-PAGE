
---
title: 'ä½¿ç”¨Flutter Widgetå¼€å‘æ¸¸æˆ_æ˜¯ç”·äººå°±åšæŒ100ç§’_ï¼Œä¸€å¥—ä»£ç æ¨ªè·¨6ç«¯~'
categories: 
 - ç¼–ç¨‹
 - æ˜é‡‘
 - åˆ†ç±»
headimg: 'https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b941c3d9142d45fe92f1e6f7b9000bfe~tplv-k3u1fbpfcp-watermark.image'
author: æ˜é‡‘
comments: false
date: Mon, 12 Apr 2021 01:08:37 GMT
thumbnail: 'https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b941c3d9142d45fe92f1e6f7b9000bfe~tplv-k3u1fbpfcp-watermark.image'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><h1 data-id="heading-0">å‰è¨€</h1>
<p>ä¹‹å‰ä½¿ç”¨Flutteré‡Œçš„æ¸¸æˆå¼•æ“Flareå·²ç»å¼€å‘äº†ä¸€ç‰ˆè¿™ä¸ªæ¸¸æˆï¼ŒåŸæ–‡åœ°å€ï¼š<a href="https://juejin.cn/post/6939065092965629983" target="_blank">juejin.cn/post/693906â€¦</a> ã€‚åœ¨æ–‡ç« é‡Œæˆ‘è¯´è¦ç”¨Widgetå†æ¥åšä¸€æ¬¡ã€‚ç°åœ¨å…‘ç°æˆ‘çš„æ‰¿è¯ºï¼Œå¹¶ä¸”ä¸Šå‘¨æ—¥åœ¨Bç«™ç›´æ’­äº†æ•´ä¸ªå¼€å‘è¿‡ç¨‹</p>
<p><a href="https://www.bilibili.com/video/BV1JK411F7wi/" target="_blank" rel="nofollow noopener noreferrer">ğŸ“ºç‚¹å‡»æŸ¥çœ‹ç›´æ’­è§†é¢‘</a></p>
<h1 data-id="heading-1">åœ¨Flutteré‡Œå±•ç¤ºSpriteåŠ¨ç”»</h1>
<p>è¯·çœ‹è¿™ç¯‡æ–‡ç« <a href="https://juejin.cn/post/6948604732822781966" target="_blank">ã€Šæ‰‹å†™ä¸€ä¸ªåœ¨Flutteré‡Œå±•ç¤ºâ€ç²¾çµå›¾â€œçš„Widgetã€‹</a></p>
<h1 data-id="heading-2">é£æœºçš„ç§»åŠ¨</h1>
<p>é¦–å…ˆå°†é£æœºæ”¾ç½®åœ¨ç”»é¢æ­£ä¸­ï¼Œç”±äºWidgetçš„åŸç‚¹ç»Ÿä¸€ä¸ºå·¦ä¸Šè§’ï¼Œæ‰€ä»¥è¦å‡å»é£æœºå›¾åƒå®½å’Œé«˜çš„ä¸€åŠã€‚</p>
<pre><code class="hljs language-dart copyable" lang="dart"><span class="hljs-comment">//è·å¾—ç”»å¸ƒçš„å®½é«˜</span>
Size screenSize = <span class="hljs-built_in">window</span>.physicalSize/<span class="hljs-built_in">window</span>.devicePixelRatio;

<span class="hljs-comment">//å°†é£æœºçš„x,yåæ ‡è®¾å®šä¸ºç”»é¢ä¸­å¿ƒ</span>
playerLeft = screenSize.width/<span class="hljs-number">2</span><span class="hljs-number">-66</span>/<span class="hljs-number">2</span>;
playerTop = screenSize.height/<span class="hljs-number">2</span><span class="hljs-number">-82</span>/<span class="hljs-number">2</span>;

<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>é£æœºæˆ‘ä»¬éœ€è¦æ•è·åˆ°ç”¨æˆ·çš„æ‰‹åŠ¿äº‹ä»¶ï¼Œä½¿ç”¨GestureDetectorè¿™ä¸ªWidgetæ¥æ‹–åŠ¨é£æœºã€‚</p>
<pre><code class="hljs language-dart copyable" lang="dart">GestureDetector( 
  onPanUpdate: (DragUpdateDetails details) &#123;
    setState(() &#123;
      playerLeft += details.delta.dx;
      playerTop += details.delta.dy;
    &#125;);
  &#125;,
  child:<span class="hljs-comment">//é£æœºçš„Widget</span>
&#125;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p><img alt="2021-04-12 16_29_13.gif" class="lazyload" src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b941c3d9142d45fe92f1e6f7b9000bfe~tplv-k3u1fbpfcp-watermark.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<h1 data-id="heading-3">è®¾å®šFPS</h1>
<p>ç”±äºæ²¡æœ‰ä½¿ç”¨æ¸¸æˆå¼•æ“ï¼Œæ‰€ä»¥åªå¥½è‡ªå·±é€šè¿‡å®šæ—¶å™¨æ¥å®ç°ã€‚æ¯”å¦‚æˆ‘ä»¬è¦å®ç°60FPSçš„åˆ·æ–°ç‡ï¼Œå¯ä»¥å°†å®šæ—¶å™¨è®¾ç½®ä¸º17æ¯«ç§’ï¼Œè¿™æ ·çš„è¯åˆ·æ–°ç‡çº¦ç­‰äº59fpsã€‚å½“ç„¶å¯ä»¥æ›´ç²¾ç¡®ä¸€äº›ï¼Œä½†æ²¡æœ‰é‚£ä¸ªå¿…è¦ã€‚</p>
<pre><code class="hljs language-dart copyable" lang="dart">Timer.periodic(<span class="hljs-built_in">Duration</span>(milliseconds: <span class="hljs-number">17</span>), (timer) &#123;
  gameloop();
&#125;);

gameloop()&#123;
    setState(() &#123;
        <span class="hljs-comment">//è§¦å‘buildæ–¹æ³•</span>
    &#125;);
&#125;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>ä¸è¿‡æˆ‘è¿™é‡Œå»ºè®®è®¾ç½®ä¸ºæ¯<code>20</code>æ¯«ç§’åˆ·æ–°ä¸€æ¬¡ï¼ŒåŸå› åœ¨åé¢ä¼šè®²ã€‚</p>
<h1 data-id="heading-4">æ·»åŠ å­å¼¹</h1>
<p>æˆ‘ä»¬å»ºç«‹ä¸€ä¸ªå­å¼¹ç®¡ç†æ•°ç»„ï¼Œå°†æ‰€æœ‰å­å¼¹çš„æ•°æ®éƒ½æ”¾åœ¨æ•°ç»„ä¸­</p>
<pre><code class="hljs language-dart copyable" lang="dart"><span class="hljs-built_in">List</span> bulletsData = [];

addBullet()&#123;
    <span class="hljs-built_in">double</span> bulletX;
    <span class="hljs-built_in">double</span> bulletY;

    <span class="hljs-keyword">if</span> (Random().nextBool()) &#123;
      bulletX = Random().nextDouble() * (screenSize.width + bulletSize.width) -
          bulletSize.width;
      bulletY = Random().nextBool() ? -bulletSize.height : screenSize.height;
    &#125; <span class="hljs-keyword">else</span> &#123;
      bulletX = Random().nextBool() ? -bulletSize.width : screenSize.width;
      bulletY = Random().nextDouble() * (screenSize.height + bulletSize.height) -
          bulletSize.height;
    &#125;

    bulletsData.add(&#123;
      <span class="hljs-string">"x"</span>:bulletX,
      <span class="hljs-string">"y"</span>:bulletY,
      <span class="hljs-string">"speed"</span>: (<span class="hljs-number">1</span>+gameTime/<span class="hljs-number">10</span>) + Random().nextDouble()*<span class="hljs-number">3</span>,
      <span class="hljs-string">"angle"</span>: atan2(((bulletY + bulletSize.height/<span class="hljs-number">2</span>) - (playerTop + playerHeight / <span class="hljs-number">2</span>)),
          ((bulletX + bulletSize.width) - (playerLeft + playerWidth / <span class="hljs-number">2</span>)))
    &#125;);
&#125;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<h2 data-id="heading-5">å­å¼¹ç§»åŠ¨</h2>
<p>åœ¨<code>gameloop</code>ä¸­éå†æ•°ç»„å¯¹å­å¼¹è¿›è¡Œç§»åŠ¨ã€‚</p>
<pre><code class="hljs language-dart copyable" lang="dart"><span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = bulletsData.length - <span class="hljs-number">1</span>; i >= <span class="hljs-number">0</span>; i--) &#123;
      <span class="hljs-keyword">var</span> bulletItem = bulletsData[i];

      <span class="hljs-built_in">double</span> angle = bulletItem[<span class="hljs-string">"angle"</span>];
      <span class="hljs-built_in">double</span> speed = bulletItem[<span class="hljs-string">"speed"</span>];

      bulletItem[<span class="hljs-string">"x"</span>] -= cos(angle) * speed;
      bulletItem[<span class="hljs-string">"y"</span>] -= sin(angle) * speed;

      <span class="hljs-keyword">if</span> (isHitPlayer(bulletItem[<span class="hljs-string">"x"</span>], bulletItem[<span class="hljs-string">"y"</span>])) &#123;
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"gameOver"</span>);
        gameOver();
      &#125;

      <span class="hljs-keyword">if</span> (isNotInScreen(bulletItem[<span class="hljs-string">"x"</span>], bulletItem[<span class="hljs-string">"y"</span>])) &#123;
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"bullet removed"</span>);
        bulletsData.removeAt(i);
        <span class="hljs-keyword">continue</span>;
      &#125;
    &#125;
&#125;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<h2 data-id="heading-6">å­å¼¹å±•ç¤º</h2>
<p>ä¸Šè¿°ä»£ç å®Œæˆåï¼Œæˆ‘ä»¬çš„å­å¼¹åœ¨æ•°æ®ä¸­å°±å­˜åœ¨äº†ã€‚ä½†æ˜¯ä½ çœ‹ä¸è§å®ƒä»¬ï¼Œå› ä¸ºä»–ä»¬æ²¡æœ‰è¢«ç»˜åˆ¶åˆ°ç”»é¢ä¸­ã€‚æˆ‘ä»¬éœ€è¦åˆ©ç”¨<code>Stack</code>å’Œ<code>Positioned</code>æ§ä»¶æ¥å±•ç¤ºå®ƒä»¬ã€‚</p>
<pre><code class="hljs language-dart copyable" lang="dart">Stack(
  children: getBulletsWidget(),
)

getBulletsWidget()&#123;
    <span class="hljs-built_in">List</span><Positioned> bullets = [];

    <span class="hljs-keyword">for</span>(<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>;i<bulletsData.length;i++)&#123;
      <span class="hljs-keyword">var</span> bulletItem = bulletsData[i];
      <span class="hljs-comment">// print(bulletItem);</span>
      <span class="hljs-keyword">var</span> bulletWidget = Positioned(
        left: bulletItem[<span class="hljs-string">"x"</span>],
        top: bulletItem[<span class="hljs-string">"y"</span>],
        child: bulletImage
      );

      bullets.add(bulletWidget);
    &#125;

    <span class="hljs-keyword">return</span> bullets;
&#125;
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p><img alt="2021-04-12 16_42_24.gif" class="lazyload" src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1f19a9bf4e364feba8eccc62e7846a2a~tplv-k3u1fbpfcp-watermark.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<h1 data-id="heading-7">æŒ‰ç§’è®¡æ—¶</h1>
<p>æ—¢ç„¶æ¸¸æˆæ ‡é¢˜å«â€œæ˜¯ç”·äººå°±åšæŒ100ç§’â€ï¼Œé‚£æ¸¸æˆä¸­è‚¯å®šéœ€è¦ä¸€ä¸ªæŒ‰ç§’çš„è®¡æ—¶å™¨ã€‚è¿˜è®°å¾—å‰é¢ä¸ºä»€ä¹ˆæˆ‘å»ºè®®å°†è®¡æ—¶å™¨çš„åˆ·æ–°é¢‘ç‡è®¾ç½®ä¸º20æ¯«ç§’å—ï¼Ÿè¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬æ¯åˆ·æ–°50æ¬¡æ˜¯ä¸æ˜¯å°±æ˜¯1ç§’é’Ÿå‘¢ï¼Ÿ</p>
<pre><code class="hljs language-dart copyable" lang="dart">Timer.periodic(<span class="hljs-built_in">Duration</span>(milliseconds: <span class="hljs-number">20</span>), (timer) &#123;
  <span class="hljs-keyword">if</span>(timer.tick%<span class="hljs-number">50</span>==<span class="hljs-number">0</span>)&#123;
    gameSeconds+=<span class="hljs-number">1</span>;
    <span class="hljs-comment">//seconds</span>
  &#125;

  loop();
&#125;);
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>åœ¨Flutteré‡Œæˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼Œ<code>timer</code>é‡Œçš„<code>tick</code>æ˜¯ä¸€ä¸ªè®¡æ—¶å™¨çš„æ‰§è¡Œè®¡æ•°ï¼Œä¼šä¸æ–­ç´¯è®¡ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å¯¹50å–ä½™ï¼Œæ¯æ¬¡æ•´é™¤50çš„æ—¶å€™å°±æ˜¯1ç§’é’Ÿå•¦~</p>
<h1 data-id="heading-8">è·¨ç«¯</h1>
<p>å€ŸåŠ©Flutterå¼ºå¤§çš„è·¨ç«¯èƒ½åŠ›ï¼Œè¿™ä¸ªæ¸¸æˆæˆ‘ä»¬å¯ä»¥...</p>
<h2 data-id="heading-9">è¿è¡Œåœ¨Macæ¡Œé¢</h2>
<pre><code class="hljs language-dart copyable" lang="dart">flutter run -d macOS
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p><img alt="2021-04-12 11_45_01.gif" class="lazyload" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cce11d5dd7c040dd97ebe22012b32843~tplv-k3u1fbpfcp-watermark.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<h2 data-id="heading-10">è¿è¡Œåœ¨æµè§ˆå™¨</h2>
<pre><code class="hljs language-dart copyable" lang="dart">flutter run -d Chrome
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p><img alt="2021-04-12 16_54_04.gif" class="lazyload" src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/08328e8bcd46448d863f71c9dfc942d9~tplv-k3u1fbpfcp-watermark.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<h2 data-id="heading-11">è¿è¡Œåœ¨iOS</h2>
<pre><code class="hljs language-dart copyable" lang="dart">flutter run -d æ¨¡æ‹Ÿå™¨ID
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p><img alt="2021-04-12 17_05_27.gif" class="lazyload" src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9a37bd4a6b024af4811089124cdaf821~tplv-k3u1fbpfcp-watermark.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<p>è¿˜æœ‰Linuxï¼ŒWindowsï¼ŒAndroidæˆ‘å°±ä¸ä¸€ä¸€ç»™å¤§å®¶æˆªå›¾äº†</p>
<p>é¡¹ç›®å·²å¼€æºï¼Œè¯·è‡ªè¡Œè¿è¡Œå§ï¼</p>
<h1 data-id="heading-12">æºç ä»“åº“</h1>
<p><a href="https://github.com/ezshine/fluttergame-keepalive100s" target="_blank" rel="nofollow noopener noreferrer">github.com/ezshine/fluâ€¦</a></p>
<h1 data-id="heading-13">å…³æ³¨å¤§å¸…å§</h1>
<p>æ¥ä¸€æ³¢èµå’Œå…³æ³¨å¯å¥½ï¼Ÿ</p></div> <div class="image-viewer-box" data-v-78c9b824><!----></div>  
</div>
            