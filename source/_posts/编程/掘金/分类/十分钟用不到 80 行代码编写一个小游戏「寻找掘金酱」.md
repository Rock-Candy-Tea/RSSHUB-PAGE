
---
title: '十分钟用不到 80 行代码编写一个小游戏「寻找掘金酱」'
categories: 
 - 编程
 - 掘金
 - 分类
headimg: 'https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6affc60aa9e24030978d575e5d034255~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?'
author: 掘金
comments: false
date: Thu, 08 Sep 2022 22:00:03 GMT
thumbnail: 'https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6affc60aa9e24030978d575e5d034255~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?'
---

<div>   
<div class="markdown-body cache"><style>.markdown-body&#123;color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px&#125;.markdown-body ::selection&#123;color:#fff;background-color:#a862ea&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;margin:24px 0 12px;color:#a862ea&#125;.markdown-body h1&#123;line-height:2;font-size:1.4em&#125;.markdown-body h1~p:first-of-type:first-letter&#123;color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder&#125;.markdown-body h2&#123;font-size:1.2em&#125;.markdown-body h3&#123;font-size:1.1em&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:2em&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;padding-left:.2em&#125;.markdown-body ol li::marker,.markdown-body ul li::marker&#123;color:#a862ea&#125;.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item&#123;list-style:none&#125;.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:10px&#125;.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p&#123;opacity:.85;vertical-align:baseline;transition:all .1s ease&#125;.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover&#123;opacity:1&#125;.markdown-body a&#123;display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative&#125;.markdown-body a:after&#123;content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out&#125;.markdown-body a:hover:after&#123;transform:scaleX(1);transform-origin:bottom left&#125;.markdown-body a:active,.markdown-body a:link&#123;color:#a862ea&#125;.markdown-body img&#123;max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff&#125;.markdown-body img:hover&#123;opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)&#125;.markdown-body blockquote&#123;padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff&#125;.markdown-body blockquote>p&#123;margin:0&#125;.markdown-body .math&#123;font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff&#125;.markdown-body .math>p&#123;margin:0&#125;.markdown-body code&#123;padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff&#125;.markdown-body pre&#123;margin:2em 0&#125;.markdown-body pre>code&#123;display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff&#125;.markdown-body pre>code:hover&#123;box-shadow:0 0 20px #e7daff&#125;.markdown-body pre>code::-webkit-scrollbar&#123;height:6px;background-color:#f8f5ff&#125;.markdown-body pre>code::-webkit-scrollbar-thumb&#123;background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px&#125;.markdown-body hr&#123;margin:2em 0;border-top:1px solid #a862ea&#125;.markdown-body table&#123;width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse&#125;.markdown-body thead&#123;color:#a862ea;background:#f8f5ff&#125;.markdown-body td,.markdown-body th&#123;padding:.5em;border:1px solid #e7daff&#125;.markdown-body tr&#123;background-color:#f8f5ff&#125;@media (max-width:720px)&#123;.markdown-body&#123;font-size:12px&#125;&#125;</style><p>我正在参加「码上掘金挑战赛」详情请看：<a href="https://juejin.cn/post/7139728821862793223" target="_blank" title="https://juejin.cn/post/7139728821862793223">码上掘金挑战赛来了！</a></p>
<p><a href="https://link.juejin.cn/?target=https%3A%2F%2Fp1-juejin.byteimg.com%2Ftos-cn-i-k3u1fbpfcp%2F33127b0ebc424d188c048574fa8f4dc0~tplv-k3u1fbpfcp-watermark.image%3F" target="_blank" rel="nofollow noopener noreferrer" title="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/33127b0ebc424d188c048574fa8f4dc0~tplv-k3u1fbpfcp-watermark.image?" ref="nofollow noopener noreferrer"></a>
<a href="https://link.juejin.cn/?target=https%3A%2F%2Fp3-juejin.byteimg.com%2Ftos-cn-i-k3u1fbpfcp%2Fcf2e426ed75a4df099433c8a169cf029~tplv-k3u1fbpfcp-watermark.image%3F" target="_blank" rel="nofollow noopener noreferrer" title="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cf2e426ed75a4df099433c8a169cf029~tplv-k3u1fbpfcp-watermark.image?" ref="nofollow noopener noreferrer"></a></p>
<h2 data-id="heading-0">前言</h2>
<p>如你所见，这是一个<del>萌系休闲类</del>小游戏，应该非常适合在深夜里一个人打发寂寞时光！（<em>查询作者精神状态</em>）</p>
<p>游戏是这样的，通过控制鼠标可以在这个被黑夜笼罩的都市中打开一束光，照亮某片区域，玩家要尽可能快地寻找到 <strong>掘金酱</strong> 的身影，鼠标只要命中即为游戏结束，此时如果继续滑动鼠标则会看到 <strong>掘金酱</strong> 向你鬼畜而来.....（期初可能只是一个BUG，但我觉得挺有趣的就保留了下来，我们通常应该可以将此类事件称之为——"创意"）</p>
<blockquote>
<p>本游戏采用 <strong>melonJS 2</strong> 进行开发，<strong>melonJS 2</strong> 是 <strong>melonJS</strong> 游戏引擎的现代版本。它几乎完全使用 <strong>ES6</strong> 的类、继承和语义等进行了重建，并使用 <strong>Rollup</strong> 打包以提供现代功能。了解更多可以查看我的这篇文章: <a href="https://juejin.cn/post/7140439045577900069/" target="_blank" title="https://juejin.cn/post/7140439045577900069/">全新轻量级 2D 开源游戏引擎，采用现代化构建</a>，只需要会使用 <strong>JS</strong>(ES6语法) 即可开始编写游戏，接下来进入正题。</p>
</blockquote>
<h2 data-id="heading-1">创建场景</h2>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> me <span class="hljs-keyword">from</span> <span class="hljs-string">"https://esm.run/melonjs"</span>;

me.<span class="hljs-property">device</span>.<span class="hljs-title function_">onReady</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;
    <span class="hljs-comment">// 初始化</span>
    <span class="hljs-keyword">if</span> (!me.<span class="hljs-property">video</span>.<span class="hljs-title function_">init</span>(<span class="hljs-number">728</span>, <span class="hljs-number">360</span>, &#123; <span class="hljs-attr">parent</span>: <span class="hljs-string">"screen"</span>, <span class="hljs-attr">scaleMethod</span>: <span class="hljs-string">"flex-width"</span>, <span class="hljs-attr">renderer</span>: me.<span class="hljs-property">video</span>.<span class="hljs-property">WEBGL</span> &#125;)) &#123;
        <span class="hljs-keyword">return</span>;
    &#125;
    <span class="hljs-comment">// 注册事件</span>
    me.<span class="hljs-property">state</span>.<span class="hljs-title function_">set</span>(me.<span class="hljs-property">state</span>.<span class="hljs-property">PLAY</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">PlayScreen</span>());
    me.<span class="hljs-property">state</span>.<span class="hljs-title function_">set</span>(me.<span class="hljs-property">state</span>.<span class="hljs-property">GAME_END</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">EndingScreen</span>());
    <span class="hljs-comment">// 加载资源</span>
    me.<span class="hljs-property">loader</span>.<span class="hljs-property">crossOrigin</span> = <span class="hljs-string">"anonymous"</span> <span class="hljs-comment">// 这里因为我加载的是网络资源</span>
    me.<span class="hljs-property">loader</span>.<span class="hljs-title function_">preload</span>(resource, <span class="hljs-function">() =></span> &#123;
        me.<span class="hljs-property">state</span>.<span class="hljs-title function_">change</span>(me.<span class="hljs-property">state</span>.<span class="hljs-property">PLAY</span>);
        startTime = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>()
    &#125;);
&#125;);

<span class="hljs-keyword">var</span> resource = [&#123; <span class="hljs-attr">name</span>: <span class="hljs-string">"background"</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">"image"</span>, <span class="hljs-attr">src</span>: <span class="hljs-string">"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/33127b0ebc424d188c048574fa8f4dc0~tplv-k3u1fbpfcp-watermark.image?"</span> &#125;, &#123; <span class="hljs-attr">name</span>: <span class="hljs-string">"jjj"</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">"image"</span>, <span class="hljs-attr">src</span>: <span class="hljs-string">"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cf2e426ed75a4df099433c8a169cf029~tplv-k3u1fbpfcp-watermark.image?"</span> &#125;]
<span class="hljs-keyword">var</span> isEnd = <span class="hljs-literal">false</span> <span class="hljs-comment">// 结束标识</span>
<span class="hljs-keyword">var</span> startTime = <span class="hljs-number">0</span> <span class="hljs-comment">// 开始时间戳</span>
<span class="hljs-keyword">var</span> endTime = <span class="hljs-number">0</span> <span class="hljs-comment">// 结束时间戳</span>
<span class="copy-code-btn">复制代码</span></code></pre>
<p>在设备与引擎准备完毕时，会触发 <code>onReady</code> 回调，这里我们先初始化一个画布，<code>renderer</code> 可以改变渲染器的方式，默认是 <code>Canvas</code>，因为我使用到了<a href="https://link.juejin.cn/?target=http%3A%2F%2Fmelonjs.github.io%2FmelonJS%2Fdocs%2Fmelonjs%2FLight2d.html" target="_blank" rel="nofollow noopener noreferrer" title="http://melonjs.github.io/melonJS/docs/melonjs/Light2d.html" ref="nofollow noopener noreferrer">2D点光源</a>的效果，所以改成在 <code>WebGL</code> 渲染更好。</p>
<p><code>me.state</code> 命名空间是重要的一个概念，它用来设置和改变游戏中的<strong>生命周期状态</strong>，比如 <strong>暂停游戏</strong>、<strong>开始/结束游戏</strong>、<strong>进入菜单</strong>等等，这里通过 <code>set</code> 方法分别设置了<strong>游戏启动</strong>时的场景实例和<strong>游戏结束</strong>时的场景实例。</p>
<p><code>loader.preload</code> 是用于预加载资源的方法，资源通过对象数组注入，其中<code>name</code>参数标识了对应资源的名称，后续引用资源不需要变量，可以直接使用名称就能找到对应资源。当资源加载完毕后，触发回调函数，回调中修改状态来开始游戏，并记录下一个时间戳，用于过程中统计游戏进行的时间。</p>
<p>下面我们开始为游戏编写第一个场景。</p>
<h2 data-id="heading-2">游戏场景</h2>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PlayScreen</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">me.Stage</span> &#123;
    <span class="hljs-title function_">onResetEvent</span>(<span class="hljs-params"></span>) &#123;
        <span class="hljs-comment">// 背景元素</span>
        <span class="hljs-keyword">var</span> bg_sprite = <span class="hljs-keyword">new</span> me.<span class="hljs-title class_">Sprite</span>( me.<span class="hljs-property">game</span>.<span class="hljs-property">viewport</span>.<span class="hljs-property">width</span> / <span class="hljs-number">2</span>, me.<span class="hljs-property">game</span>.<span class="hljs-property">viewport</span>.<span class="hljs-property">height</span> / <span class="hljs-number">2</span>, &#123; <span class="hljs-attr">image</span>: <span class="hljs-string">"background"</span>, <span class="hljs-attr">anchorPoint</span>: &#123; <span class="hljs-attr">x</span>: <span class="hljs-number">0.5</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0.5</span> &#125;&#125; );
        <span class="hljs-comment">// 添加目标</span>
        <span class="hljs-keyword">var</span> target_sprite = <span class="hljs-keyword">new</span> me.<span class="hljs-title class_">Sprite</span>(point.<span class="hljs-property">x</span>, point.<span class="hljs-property">y</span>, &#123; <span class="hljs-attr">image</span>: <span class="hljs-string">"jjj"</span> &#125;);
        <span class="hljs-comment">// 添加元素进画布</span>
        me.<span class="hljs-property">game</span>.<span class="hljs-property">world</span>.<span class="hljs-title function_">addChild</span>(bg_sprite);
        me.<span class="hljs-property">game</span>.<span class="hljs-property">world</span>.<span class="hljs-title function_">addChild</span>(target_sprite);
    &#125;
&#125;;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>通过 <code>Sprite</code> 对象创建精灵图，在2D游戏中，通常以一张顺序包含帧动画的图片来制作动态的图像，没错，就跟CSS精灵技术是同种原理，不过这里我们并不做到那么复杂，只是静态显示。</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6affc60aa9e24030978d575e5d034255~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>我们继续丰富场景，作为游戏中的上帝，怎么能没有光呢？场景继承的基类 <a href="https://link.juejin.cn/?target=http%3A%2F%2Fmelonjs.github.io%2FmelonJS%2Fdocs%2Fmelonjs%2FStage.html" target="_blank" rel="nofollow noopener noreferrer" title="http://melonjs.github.io/melonJS/docs/melonjs/Stage.html" ref="nofollow noopener noreferrer"><code>Stage</code></a> 中有一个 <code>lights</code> 属性用于设置光源列表，我们找到一个 <a href="https://link.juejin.cn/?target=http%3A%2F%2Fmelonjs.github.io%2FmelonJS%2Fdocs%2Fmelonjs%2FLight2d.html" target="_blank" rel="nofollow noopener noreferrer" title="http://melonjs.github.io/melonJS/docs/melonjs/Light2d.html" ref="nofollow noopener noreferrer"><code>Light2d</code></a> 聚光灯的类，实例化一个灯光系统设置进光源列表中，这样我们的场景中就有了一束光：</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-comment">// 灯光系统</span>
<span class="hljs-keyword">var</span> whiteLight = <span class="hljs-keyword">new</span> me.<span class="hljs-title class_">Light2</span>d(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">100</span>, <span class="hljs-number">70</span>, <span class="hljs-string">"#fff"</span>, <span class="hljs-number">0.7</span>);
<span class="hljs-comment">// 设置灯光</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-property">lights</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">"whiteLight"</span>, whiteLight);
<span class="copy-code-btn">复制代码</span></code></pre>
<p>现在该让光束随着鼠标移动起来了，你完全可以使用 <strong>DOM</strong> 的监听事件来做，当然<strong>melonJS</strong>下同样内置了许多输入监听事件，这里的 <code>pointermove</code> 事件是不是跟 <code>document</code> 中的 <code>mousemove</code> 事件很类似？只不过它以传入第二个参数的方式来设置监听范围：</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-comment">// 光随着鼠标事件移动</span>
me.<span class="hljs-property">input</span>.<span class="hljs-title function_">registerPointerEvent</span>(<span class="hljs-string">"pointermove"</span>, me.<span class="hljs-property">game</span>.<span class="hljs-property">viewport</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =></span> &#123;
    whiteLight.<span class="hljs-title function_">centerOn</span>(event.<span class="hljs-property">gameX</span>, event.<span class="hljs-property">gameY</span>);
&#125;);
<span class="copy-code-btn">复制代码</span></code></pre>
<p>动起来了，是不是很简单？</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6f44beda318d4b83bdcddd00cda21209~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?" alt="2022-09-09 09.41.42.gif" loading="lazy" referrerpolicy="no-referrer"></p>
<p>最后为场景添加一个纯黑遮罩，营造出一点氛围感~就是开头看到的效果</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-variable language_">this</span>.<span class="hljs-property">ambientLight</span>.<span class="hljs-title function_">parseCSS</span>(<span class="hljs-string">"#000"</span>);
<span class="copy-code-btn">复制代码</span></code></pre>
<h2 data-id="heading-3">创建角色</h2>
<p>上面我们往游戏中添加了静态的精灵图，但是游戏需要交互动作才能进行下去，这时我们就需要创建一个新的类继承精灵图，就叫它 <code>Actor</code> 好了，接着扩展一下这个类，这里我们使用游戏引擎提供的物理模型 <a href="https://link.juejin.cn/?target=http%3A%2F%2Fmelonjs.github.io%2FmelonJS%2Fdocs%2Fmelonjs%2FEllipse.html" target="_blank" rel="nofollow noopener noreferrer" title="http://melonjs.github.io/melonJS/docs/melonjs/Ellipse.html" ref="nofollow noopener noreferrer">Ellipse</a> 对象，只是单纯为了添加一个椭圆作为物理身体，参数比较随意，然后设置了这个类的碰撞事件，在触发碰撞检测时执行游戏结束的相关动作。</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Actor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">me.Sprite</span> &#123;
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) &#123;
        <span class="hljs-variable language_">super</span>(me.<span class="hljs-property">Math</span>.<span class="hljs-title function_">random</span>(-<span class="hljs-number">15</span>, me.<span class="hljs-property">game</span>.<span class="hljs-property">viewport</span>.<span class="hljs-property">width</span>), me.<span class="hljs-property">Math</span>.<span class="hljs-title function_">random</span>(-<span class="hljs-number">15</span>, me.<span class="hljs-property">game</span>.<span class="hljs-property">viewport</span>.<span class="hljs-property">height</span>), &#123; <span class="hljs-attr">image</span>: <span class="hljs-string">"jjj"</span> &#125;);
        <span class="hljs-comment">// 为角色设置身体</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">body</span> = <span class="hljs-keyword">new</span> me.<span class="hljs-title class_">Body</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-keyword">new</span> me.<span class="hljs-title class_">Ellipse</span>(<span class="hljs-number">6</span>, <span class="hljs-number">6</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">width</span> - <span class="hljs-number">6</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">height</span> - <span class="hljs-number">6</span>));
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">body</span>.<span class="hljs-property">gravityScale</span> = <span class="hljs-number">0</span>; <span class="hljs-comment">// 消除掉重力</span>
    &#125;
    <span class="hljs-title function_">onCollision</span>(<span class="hljs-params"></span>) &#123;
        <span class="hljs-comment">// 标记游戏结束，在鼠标移动事件中会读取该全局变量进行判断</span>
        isEnd = <span class="hljs-literal">true</span>
        <span class="hljs-comment">// 记录下游戏结束时间，计算游戏时长</span>
        endTime = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>()
        <span class="hljs-comment">// 改变游戏场景，进入 GAME END 游戏结束场景</span>
        me.<span class="hljs-property">state</span>.<span class="hljs-title function_">change</span>(me.<span class="hljs-property">state</span>.<span class="hljs-property">GAME_END</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    &#125;
&#125;;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>对于游戏引擎中的物理模型来说，通常都会有一个重力属性，我们的游戏本质还是静态的角色，所以这里需要把重力 <code>gravityScale</code> 设置为 0 ，否则我们的 <strong>掘金酱</strong> 会像这样掉下去（原谅我不厚道地笑了）：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d65c66dcddea468cbae73f9349f555d4~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?" alt="2022-09-09 12.52.51.gif" loading="lazy" referrerpolicy="no-referrer"></p>
<p>由于我们的光源并没有物理模型，那要怎么让鼠标和掘金酱之间产生碰撞呢？这里我取巧了一下，利用 <code>Actor</code> 类，创建了一个"小掘金酱"，让它跟随鼠标移动，然后隐藏它，这样就能触发物理碰撞的判定了（<del>画外音：这个类取名 Actor 原来是这个意思吗！</del>）：</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">const</span> point_sprite = me.<span class="hljs-property">game</span>.<span class="hljs-property">world</span>.<span class="hljs-title function_">addChild</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Actor</span>());
point_sprite.<span class="hljs-title function_">scale</span>(<span class="hljs-number">0.5</span>) <span class="hljs-comment">// 缩小一点</span>
point_sprite.<span class="hljs-title function_">setOpacity</span>(<span class="hljs-number">0</span>) <span class="hljs-comment">// 变成透明</span>
<span class="hljs-comment">// 鼠标移动事件：</span>
me.<span class="hljs-property">input</span>.<span class="hljs-title function_">registerPointerEvent</span>(<span class="hljs-string">"pointermove"</span>, me.<span class="hljs-property">game</span>.<span class="hljs-property">viewport</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =></span> &#123;
    <span class="hljs-keyword">if</span> (!isEnd) &#123;
        <span class="hljs-comment">// 移动光源</span>
        whiteLight.<span class="hljs-title function_">centerOn</span>(event.<span class="hljs-property">gameX</span>, event.<span class="hljs-property">gameY</span>);
        <span class="hljs-comment">// 移动透明的物理模型，把它当成鼠标指针</span>
        point_sprite.<span class="hljs-title function_">centerOn</span>(event.<span class="hljs-property">gameX</span> + <span class="hljs-number">22</span>, event.<span class="hljs-property">gameY</span> + <span class="hljs-number">22</span>);
    &#125; <span class="hljs-keyword">else</span> &#123;
        target_sprite.<span class="hljs-title function_">setOpacity</span>(<span class="hljs-number">0.7</span>)
        target_sprite.<span class="hljs-title function_">scale</span>(<span class="hljs-number">1.02</span>)
    &#125;
&#125;);
<span class="copy-code-btn">复制代码</span></code></pre>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b10a4ac4226e40fdbf31ab797597b0a1~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
<h2 data-id="heading-4">结束场景</h2>
<p>这个场景就蛮简单的了，就是输出文字内容，代码很好理解：</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">EndingScreen</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">me.Stage</span> &#123;
    <span class="hljs-title function_">onResetEvent</span>(<span class="hljs-params"></span>) &#123;
        me.<span class="hljs-property">game</span>.<span class="hljs-property">world</span>.<span class="hljs-title function_">addChild</span>(<span class="hljs-keyword">new</span> me.<span class="hljs-title class_">Text</span>(me.<span class="hljs-property">game</span>.<span class="hljs-property">viewport</span>.<span class="hljs-property">width</span> / <span class="hljs-number">2</span>, me.<span class="hljs-property">game</span>.<span class="hljs-property">viewport</span>.<span class="hljs-property">height</span> / <span class="hljs-number">2</span> - <span class="hljs-number">20</span>, &#123;
            <span class="hljs-attr">font</span>: <span class="hljs-string">"Arial"</span>,
            <span class="hljs-attr">size</span>: <span class="hljs-number">50</span>,
            <span class="hljs-attr">fillStyle</span>: <span class="hljs-string">"#FFFFFF"</span>,
            <span class="hljs-attr">textAlign</span>: <span class="hljs-string">"center"</span>,
            <span class="hljs-attr">text</span>: <span class="hljs-string">"恭喜你找到了掘金酱！\n通关时间："</span> + ((endTime - startTime) / <span class="hljs-number">1000</span>).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>) + <span class="hljs-string">'秒'</span>
        &#125;));
    &#125;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<h2 data-id="heading-5">完整的代码和游戏演示</h2>
<p>完整的代码和游戏演示（由于引用资源第一次加载可能需要等待时间），因为懒没有做游戏界面，所以猛戳上面的 <strong>○ 运行</strong> 按钮来重复开始游戏：</p>
<p><span href="https://code.juejin.cn/pen/7139768318650482718" target="_blank" class="code-editor-container"><iframe class="code-editor-frame" data-code="code-editor-element" data-code-id="7139768318650482718" data-src="https://code.juejin.cn/pen/7139768318650482718" style="display: none" loading="lazy"></iframe></span></p>
<p>试玩一下吧！看看你最快多少秒可以抓住掘金酱？</p>
<h2 data-id="heading-6">结束</h2>
<p>总结一下，利用 <strong>melonJS</strong> 我们仅用了几十行代码就完成了一个小游戏，虽然这个游戏并不复杂，即使用原生 <strong>JS</strong> 可能也不难实现，但你却很难自己轻易实现一个 <strong>WebGL</strong> / <strong>Canvas</strong> 级别的渲染器，使用游戏引擎可以做到更多，这里只是现学现卖小试了一下牛刀，顺便也可以练习 <strong>ES6</strong> 语法，如果你感兴趣，也可以仔细参阅官方的API文档和Demo，做出更好玩的东西~</p>
<blockquote>
<p>最后建议码上掘金的编辑器后续可以考虑做个文件目录的功能，以支持组件/小文件引用。目前写写内容少的小网页还行，稍微复杂点的拆不了组件，做这类演示项目时资源也不知道要放哪里（比如引入图片、JSON文件啥的），本文中引用到的图片资源我还是传到文章里再隐藏的，哈哈。</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e358cc91320d409a85e70fe4b475bf20~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?" alt="image.png" loading="lazy" referrerpolicy="no-referrer"></p>
</blockquote></div>  
</div>
            