
---
title: '摄影师教你开发小程序，「龟斯的风光摄影助手」的设计与开发思路详解'
categories: 
 - 编程
 - 掘金
 - 分类
headimg: 'https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/325e312276c3423b8e5722ba1a51dd6d~tplv-k3u1fbpfcp-watermark.image'
author: 掘金
comments: false
date: Thu, 08 Jul 2021 02:34:45 GMT
thumbnail: 'https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/325e312276c3423b8e5722ba1a51dd6d~tplv-k3u1fbpfcp-watermark.image'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><p>作者｜陆尧</p>
<p>作为一名风光摄影师，会拍摄一场壮丽的日出日落是基本功。精力充沛一点的，在日落之后便会继续守候，期待能有漫天繁星。在这看似简单的拍摄计划背后，实践起来，一定会遇到几个问题：</p>
<blockquote>
<p>应该去哪里拍摄？什么时候日落？太阳会在哪个方向落下？星空会在几点出现？银河在哪？</p>
</blockquote>
<p>这些问题都是初入风光摄影时必然会踩到的坑。</p>
<p>我是一名风光摄影师，同时又是一名个人开发者，既了解摄影师的需求，也能通过技术满足摄影师的需求，「龟斯的风光摄影助手」便是为了解决这些问题而诞生。</p>
<p>「龟斯的风光摄影助手」提供了日月时间、月相、银河起落等信息，还提供了曝光计算、光绘笔、天气预报和潮汐查询等实用功能，帮助风光摄影爱好者轻松安排拍摄计划。</p>
<p>小程序第一版的开发，在知晓云平台的支持下，只用了 5 天时间。上线后完全靠口碑传播的情况下，已服务了万余名风光摄影师，同时也获得了 2020 年知晓云最佳创意奖。</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/325e312276c3423b8e5722ba1a51dd6d~tplv-k3u1fbpfcp-watermark.image" alt="image6.jpg" loading="lazy" referrerpolicy="no-referrer"></p>
<p>虽然数据上看并不起眼，但对于我来说，确实是不小的鼓励。那么这一切是怎么做到的？</p>
<h3 data-id="heading-0">友好 + 高效</h3>
<p>要做到「友好+高效」这一点，需要从功能展现和用户体验出发。</p>
<p>首先，在设计之初，就要求绝大部分功能在点击三下以内完成，页面层级一定不能超过五页。作为一个功能聚合的小程序，在刚打开的首页，便要清晰的展现功能分类，用户点击一下即可看到最重要的信息，而不是一股脑把所有东西都扔给用户，造成屏幕上全是重点以至于用户不知道哪个是重点。另外，考虑到户外拍摄用户可能是戴了手套的，所以功能面板的触摸区域也设置的非常大，方便操作。</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2e85cc0fa0be40039f4d6c8cff67fbeb~tplv-k3u1fbpfcp-watermark.image" alt="image12.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>第二，有明确的导航。绝大部分小程序都会使用自定义导航栏，此时微信会保留右上角的菜单按钮但是不会提供统一的返回按钮，而返回功能恰好又是非常不起眼且容易忘记做的功能。虽然微信官方是支持屏幕右滑退出的，但是这个功能在屏幕上不能漏掉，因为他的滑动交互可能会和页面操作冲突。比如地图页，滑动退出时其实也触发了地图的滑动操作，从避免误操作的角度来说，最好还是直接将返回键放置在屏幕上。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bc18cce8c7fe4aa48fd9bad7ea804225~tplv-k3u1fbpfcp-watermark.image" alt="image15.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>第三，对于一些相对复杂、需要一点学习成本的功能，直接给出可参阅的简易教程，而不是采用全屏弹窗、或是步骤教学强迫用户一步步点击才能使用。</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/27ffa5463f6040df87672d672ff5ee64~tplv-k3u1fbpfcp-watermark.image" alt="image9.png" loading="lazy" referrerpolicy="no-referrer"></p>
<h3 data-id="heading-1">稳定 + 可靠</h3>
<p>稳定可靠的服务。这一点不仅需要在交互上，也需要从前后端开发的角度来解决问题。作为一名前端开发者，在几乎没有后端支持的情况下，如何为用户提供一个在线服务属实是个大问题。
首先遇到的困难就是内置图片太多导致小程序包超过容量限制。如果压制图片，画质损失又很大，因此必须把图片资源放到了线上。好在知晓云提供了静态资源的功能，还能通过 URL 作图来直接快速获取想要的图片尺寸。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/17a5e4ea98094f1e825c098c0bbbddf0~tplv-k3u1fbpfcp-watermark.image" alt="image18.jpg" loading="lazy" referrerpolicy="no-referrer"></p>
<p>第二个困难是在线服务的稳定性。对我来说一整套完整可用的后台系统搭建以及维护是需要耗费非常大的精力的，并且为了使服务能够更加快速稳定，每年购置云主机的费用也不低，最麻烦的（其实就是懒）是需要自己写接口。好在知晓云就提供了一揽子 serverless 解决方案，从前端就能够直接获取设计好的数据结构，大大节省工作量。</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e52c1b4be48e4fa9943b0d6e1ad0ebe7~tplv-k3u1fbpfcp-watermark.image" alt="image2.png" loading="lazy" referrerpolicy="no-referrer"></p>
<h3 data-id="heading-2">代码实战</h3>
<p>以「机位收藏夹」为例， 这个功能设计用来给摄影师对机位进行记录与分享。在这个功能中，包含了数据的新增、删除、修改、查询四个基本操作。在页面结构的搭建时，我们可以从用户的操作顺序依次开始。</p>
<p>首先分析我们的产品操作流程：用户创建一个地点，即一条数据。创建者可以自己对这个地点进行编辑或删除，也可以将这个地点分享出去。当别人通过分享打开时，点击收藏这个地点，那么这条数据就被复制了一份到收藏者的名下，收藏者就可以在自己的收藏夹看到并修改自己的这条记录。</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b7b75b2c692142a3ab2c684af0f5b03d~tplv-k3u1fbpfcp-watermark.image" alt="image11.jpg" loading="lazy" referrerpolicy="no-referrer"></p>
<p>明确流程之后，我们在知晓云后台创建一个数据表，并设置好用户权限。我们的地点可以由创建者编辑，但是其他人只能看（复制这条记录后才能编辑），所以按照下图设置好 ACL 权限：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6c8781b728cc40fab17d4af5045b1ca5~tplv-k3u1fbpfcp-watermark.image" alt="image10.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>然后我们根据每条记录的内容设计好表字段：标题（Title，字符串类型）、多张图片（Img，数组类型）、地点（Location，geojson 地理坐标类型）、出处（Source，字符串类型）、星级（Level，Integer 类型）、其他信息（Info，字符串类型）、所有者（Owner，number 类型），然后还能根据未来功能的规划，增加标签、评论等预留字段。这里在创建字段时一定要想好，一旦创建好，要更改他的某些属性就很麻烦了（比如变更数据类型）。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dca245a418cf4572b78e1777882310b8~tplv-k3u1fbpfcp-watermark.image" alt="image1.jpg" loading="lazy" referrerpolicy="no-referrer"></p>
<p>然后我们开始根据设想来画页面、接接口。根据原型图对页面的搭建非常简单，这里不多展开。在最后的保存按钮中，对于标题、星级、其他信息这些普通的字符串、数字字段就可以直接保存到数据表中，其中有三个字段需要单独做处理。</p>
<p>一是图片上传。我们需要在知晓云后台的「文件」模块下，新增一个分类「机位」，后续用户上传的图片将会存储在这里。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9624cdc131784957b0a9ecd219421fa3~tplv-k3u1fbpfcp-watermark.image" alt="image4.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>然后根据文档，只需要几行核心代码就可以封装好一个批量上传图片的公共方法，上传完成后我们在数据表中保存图片的 id 或是 url（使用 uniapp 框架）：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/42b00400170d4040bf4590fb2cab482e~tplv-k3u1fbpfcp-watermark.image" alt="image8.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>第二个就是地理位置。首先我们要知道国际标准为 wgs84，而我国的国测局标准为 gcj02，这两个坐标系在使用时有一个转换的过程。在小程序中，为了保证日出日落这种涉及坐标的计算的准确性，统一使用了 wgs84 标准，而腾讯地图的地理坐标选择是 gcj02 的，所以用户在选择地点并点击确定时，需要转换成 wgs84（这里我使用了 <a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fcoordtransform2" target="_blank" rel="nofollow noopener noreferrer" title="https://www.npmjs.com/package/coordtransform2" ref="nofollow noopener noreferrer">coordtransform2</a> 的 npm 包）。可以在 app.onLaunch 中将这个包直接设为全局方法，直接通过 this.coordtransform.gcj02towgs84(latitude, longitude) 这种形式使用：</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cd598962f1a04d669486e6438062d11f~tplv-k3u1fbpfcp-watermark.image" alt="image14.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>最后，在保存数据时，由于要存储的是 geojson 类型，而 javascript 本身没有这个类型，因此要记得通过知晓云提供的创建地理位置对象方法进行转换：</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/21c3b825341045f6839036b37200cd06~tplv-k3u1fbpfcp-watermark.image" alt="image5.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>保存成功后我们在知晓云后台就能看到这样的地理位置数据：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/128057d33d70440db40a26328083bff3~tplv-k3u1fbpfcp-watermark.image" alt="image13.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>第三就是 Owner 字段。这个字段和创建者 Created_by 字段的区别就在于，当用户收藏别人的地点后，这个 Owner 就指向看用户自己，这样就能区分出这条数据是用户自己创建的，还是从别人那边收藏来的。</p>
<p>有了数据之后，剩下的就非常简单了，用户在查看时直接根据 Owner 字段等于当前用户的 id 查询他能看到的地点：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c40f14d7132a4e95a7e9c520a06ba737~tplv-k3u1fbpfcp-watermark.image" alt="image3.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>在点击收藏时将这条数据复制，Owner 换成自己的 id 并保存到当前用户名下即可：</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ee93354907cc41f8b7c8a315638ca107~tplv-k3u1fbpfcp-watermark.image" alt="image7.jpg" loading="lazy" referrerpolicy="no-referrer"></p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/125737dcc2bc4f9f8d4a779b92798efc~tplv-k3u1fbpfcp-watermark.image" alt="image16.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>一来二去，通过少量的代码完成了对一个裂变功能的实现。这中间，我们利用了知晓云现成的文件上传 api、wx.BaaS 方法来访问和操作数据表，通过对 ACL 的权限设置来保证对数据的权限的控制，完全不需要任何后端的支持就能做到，把有限的精力更多的放在产品逻辑的实现上，对像我这样的个人开发者来说是非常友好的。</p>
<p>我的分享就是这些啦，希望思路对你有帮助；也希望大家能够尝试 serverless 开发这种形式，创造更多极具创意的产品，更好的服务用户。</p>
<h4 data-id="heading-3">小编有话说：</h4>
<p>作者作为一名开发者，同时也是一名使用者，可以更好地站在用户角度，将「龟斯的风光摄影助手」的功能与用户体验做到极致。小程序有很好的视觉效果、功能齐全、操作简单明了，可以成为摄影爱好者随时随地便能使用的工具。</p>
<p>如果你觉得作者的分享和开发的小程序对你有用，请转发文章并为小程序点个赞，给作者更多鼓励～</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6e809d18438d4248895740acc23806d5~tplv-k3u1fbpfcp-watermark.image" alt="龟斯的风光摄影助手小程序码.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>知晓云的初衷，便是通过提供的 Serverless 无服务架构，让开发者无需掌握繁琐的后端开发，不用去搭建服务器、完成域名备案，只需专注于业务逻辑的实现，从而又快又省地上线小程序。很荣幸能够在「龟斯的风光摄影助手」开发中提供支持，希望知晓云云服务能持续帮助更多开发者快速将创意落地。</p>
<p>如果你有任何建议和想法，欢迎你在文末留言或向小晓云私信，我们将会第一时间向作者传达你的信息，也欢迎你一起分享「你开发的小程序背后的故事」。</p></div>  
</div>
            