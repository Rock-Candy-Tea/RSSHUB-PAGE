
---
title: '微信小游戏开发实战6-把图形放置到网格上'
categories: 
 - 编程
 - 掘金
 - 分类
headimg: 'https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/66f51dffdb8e4a3996ecada5ce4ed65c~tplv-k3u1fbpfcp-watermark.image'
author: 掘金
comments: false
date: Sun, 13 Jun 2021 05:04:19 GMT
thumbnail: 'https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/66f51dffdb8e4a3996ecada5ce4ed65c~tplv-k3u1fbpfcp-watermark.image'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><blockquote>
<p>这是“<a href="https://juejin.cn/column/6970854825193897998" target="_blank">微信小游戏开发实战</a>“系列的第 6 篇，这个系列中我们会从 0 开始，制作出一个 1010 游戏。</p>
<p>如果你对游戏开发没有任何经验，可以阅读我的“<a href="https://juejin.cn/column/6960570072054104077" target="_blank">人人都能做游戏</a>”系列教程，它能手把手的带你做出自己的第一个微信游戏。</p>
<p>教程中所使用的小游戏开发工具为微信官方的小游戏制作工具：<a href="https://gamemaker.weixin.qq.com/#/" target="_blank" rel="nofollow noopener noreferrer">微信小游戏制作工具</a></p>
</blockquote>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/66f51dffdb8e4a3996ecada5ce4ed65c~tplv-k3u1fbpfcp-watermark.image" alt="1.gif" loading="lazy" referrerpolicy="no-referrer"></p>
<p>在<a href="https://juejin.cn/post/6972341522108776462" target="_blank">第四节</a>中我们实现了图形的拖拽功能，拖拽的图形最终需要被放置在网格的对应位置上。</p>
<p>先说一下实现思路：</p>
<p>使用拖拽图形上的左下角的位置作为图形位置，与整个网格的位置进行比对。如果图形位置与当前单元格的位置匹配，则根据图形的数据从当前的单元格开始填充，直到填充完整个图形为止。</p>
<p>看不懂？没关系。接着往下我会一步一步的进行拆解和分析。</p>
<h2 data-id="heading-0">计算拖拽图形左下角的位置作为图形的比对位置</h2>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5d26645468bc49a4bdf18e95029f9506~tplv-k3u1fbpfcp-watermark.image" alt="2.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>如图，是要拖拽的图形，由四个正方形组成的“田字”形，每个正方形的边长是 60 ，两个正方形之间的间隔是 2 。左下方的红色圆点为我们将会计算的图形位置。假设当前图形的中点位置(即坐标轴的中心)为（x，y)，根据正方形的边长和间隔，可以计算出红色的点的位置是(x - 31，y - 31)。</p>
<p>在场景加入四个边长为 60 的正方形，将四个正方形同时选中，点击鼠标右键，选择“将选中图层组成容器”。将它们放在一个容器下。</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/20950e8285f446b299a8b06c9b4a7e3d~tplv-k3u1fbpfcp-watermark.image" alt="3.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2c15ae94b77140038e34a2fec963d6d3~tplv-k3u1fbpfcp-watermark.image" alt="4.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>如图，四个正方形被放在了“容器-1”中。坐标轴中心的位置即为“容器-1”的坐标位置。</p>
<p>在游戏中每个图形都是由多个正方形组成，我们会统一使用容器来打包这些正方形，作为图形使用。
容器中的四个正方形的坐标位置分别是这样的。</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/579ed9eb9bd841f7a713c47cf2cbeae8~tplv-k3u1fbpfcp-watermark.image" alt="5.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>为什么要使用左下角的位置作为图形位置与网格位置进行比对呢？</p>
<p><strong>理由一</strong>：便于确定图形想要放置的位置。</p>
<p>假设现在我们使用图形的中心位置作为比对位置。</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/af5479bcebf3414290ccf114a03cf7f4~tplv-k3u1fbpfcp-watermark.image" alt="6.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>如图，图形的中心位置位于第二行第二列的网格中，但是这个田字形的图形应该安放在哪里呢？不是很直观，也不太好判断。</p>
<p>现在我们将图形的左下方位置作为比对位置。</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/12ee64d997934817b16bba33b11de996~tplv-k3u1fbpfcp-watermark.image" alt="7.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>如图， 左下方的蓝点当前位于第一行第一列的格子中，可以很容易的看出当前图形是想要放在左下角的四个格子中，像下面这样。</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e47b756931924dfa856221963378e47a~tplv-k3u1fbpfcp-watermark.image" alt="8.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>最终的比对位置的计算可以进行“四舍五入”处理，这样能够容许一定的位置偏移和误差，即只要位置差不多的话，图形就应该被放置上去。</p>
<p><strong>理由二</strong>：便于图形的绘制，我们将会总是从左下角的位置开始遍历绘制整个图形。后续会进行解释。</p>
<h2 data-id="heading-1">用图形位置与网格位置进行比对</h2>
<p>假设当前的“田字”图形位于网格的正中间。</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cf83386e9c314358bad6961b874a35f1~tplv-k3u1fbpfcp-watermark.image" alt="9.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>在绘制网格一节中，我们已经讲过了如何计算网格左下角的起点位置。根据图形当前的位置（蓝点），网格起点（红点）位置以及单元格的边长，就能够计算出当前图形左下方的点（蓝点）位于网格中的行号和列号。图中当前蓝点位于第 5 行第 5 列的格子中，我们将会从这个格子开始绘制整个田字图形。</p>
<blockquote>
<p>图形点（x，y），网格起点（a，b），单元格边长n</p>
<p>行号 = (y - b) / n + 1</p>
<p>列号 = (x - a) / n + 1</p>
</blockquote>
<p>获取到行号和列号后，就可以进行下一步填充操作了。</p>
<h2 data-id="heading-2">在网格上填充图形</h2>
<p>实现思路：获取到当前图形在网格中的位置，也就是我们上一步的操作。从当前位置开始，根据图形的数据依次填充网格中的单元格。</p>
<p>依旧很难理解？没关系，接着看。</p>
<p>第一节中我们讲过，计算机只能够理解数据，我们所看到的图形，想要计算机能够理解，就需要映射成数据，像下面这样，第一个“田字”图形其实是由两行两列的 1 组成。</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0ba62efe460c47fe800b559ea35b58ab~tplv-k3u1fbpfcp-watermark.image" alt="10.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>下面我们就为“田字”图形设置数据。选中“容器-1”，为其添加一个局部变量表格数据，命名“形状数据”。</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d43b791c24314c2e94a0268c441e792d~tplv-k3u1fbpfcp-watermark.image" alt="11.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>在表格中增加两行两列数据，并且都设置为 1。（图形由四个正方形组成，所以四个数值都是 1）</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c04d2ab876e24d20acad6a2b41822c97~tplv-k3u1fbpfcp-watermark.image" alt="12.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>接下来，为“容器-1”增加一些变量，在稍后实现逻辑时会使用。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cfcc68bad837426492abe4c6ff7d1ec0~tplv-k3u1fbpfcp-watermark.image" alt="13.png" loading="lazy" referrerpolicy="no-referrer"></p>
<blockquote>
<p>“容器-1”的局部变量：</p>
<p><strong>被按住</strong>：当前图形是否被按住，用于图形的拖拽。</p>
<p><strong>网格位置X/Y</strong>: 记录当前图形位于整个网格的哪一行，哪一列。</p>
<p><strong>行号/列号</strong>：用于田字图形的表格数据的遍历。</p>
<p><strong>起点偏移X/Y</strong>:用于计算图形的左下角的点的位置。</p>
</blockquote>
<blockquote>
<p>全局变量：</p>
<p><strong>全局-列号/行号</strong>：用于记录要填充的方格的行号和列号。</p>
<p><strong>全局-单个格子边长</strong>：每个正方形单元格的边长。</p>
<p><strong>全局-总行数/列数</strong>：网格一共多少行，多少列。</p>
<p><strong>全局-起点X/Y坐标</strong>：整个网格的左下角的起点位置。</p>
</blockquote>
<p>你可能注意到了，我在所有的全局变量前增加了前缀“全局-”，这样，当你在积木块中选择变量时可以很容易的将全局变量与局部变量区分开，尤其是当变量很多的时候，这是一个不错的习惯，推荐你使用。
接下来，我们先在场景中增加一个“填充方块”，用于在网格上进行填充。</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/10cfeebf228f45ff8bae2e011ae5c9b0~tplv-k3u1fbpfcp-watermark.image" alt="14.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>如图，在场景中加入了一个填充方块，为了与红色的拖拽图形区分开，把它设置成绿色。</p>
<p>为其增加如下的积木逻辑。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5cd1789e385b47c4b571fb57e256850d~tplv-k3u1fbpfcp-watermark.image" alt="15.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>逻辑不复杂，当自己被克隆出来后，将自己设置到网格中的对应位置。</p>
<p>接着，选择“容器-1”，为其增加如下的积木逻辑：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fb153eb37fdf4d79bed18ab34e618759~tplv-k3u1fbpfcp-watermark.image" alt="16.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bca97e5512a44623a23d6e5f48ba103c~tplv-k3u1fbpfcp-watermark.image" alt="17.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>重点包含两部分的逻辑，被拖拽时，计算图形位于网格中的位置。手放开时，从当前的位置开始，遍历当前图形的数据，并在网格上对应的位置填充方块。</p>
<p>点击“预览场景”，看一下效果。</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fe0205f5bb404132acd91a79e5642211~tplv-k3u1fbpfcp-watermark.image" alt="18.gif" loading="lazy" referrerpolicy="no-referrer"></p>
<p>拖拽图形放置在网格上，就会在对应的位置上填充图形。观察一下，即使拖拽图形的位置与网格的位置有一些偏差，也会在正确的位置上进行填充。这样会给玩家带来比较良好的游戏体验：虽然你的手指头控制的不是很精准，但是没关系，我知道你其实是想放在那里的。</p>
<h2 data-id="heading-3">总结一下</h2>
<p>这一节我们了解了如何将拖拽的形状填充到网格中，包括实现思路以及具体的实现方法。虽然包含了比较多的计算，但是这些计算其实都不复杂，对照着图片在纸上画一下更容易理解。</p>
<h2 data-id="heading-4">练一下</h2>
<p>在“1010”游戏中除了由四个正方形组成的“田字”形状，还包含很多其他的形状，试着实现一个由三个正方形组成的“L”形的形状，并实现它在网格中的填充。</p>
<p>这一节大概是我写过的最难的一节教程，虽然我想尽量的将其写的简单易懂，但是其中的一些计算和想法确实是很难进行最浅显易懂的解释。如果你读起来感觉有困难，可以多读几遍，配合图片然后自己亲自动手试着实现一下，有任何的问题欢迎给我留言，我会尽可能的为你提供帮助。</p>
<hr>
<p>如果你对游戏开发感兴趣，想了解更多与游戏开发有关的原创内容和教程，欢迎关注我的公众号：小蚂蚁游戏开发。</p>
<p>如果觉得文章不错，请点个「 <strong>赞</strong> 」给我点动力，感谢～</p></div>  
</div>
            