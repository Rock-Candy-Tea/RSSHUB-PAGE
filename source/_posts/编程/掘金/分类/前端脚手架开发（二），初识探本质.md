
---
title: '前端脚手架开发（二），初识探本质'
categories: 
 - 编程
 - 掘金
 - 分类
headimg: 'https://picsum.photos/400/300?random=519'
author: 掘金
comments: false
date: Sun, 06 Jun 2021 18:05:04 GMT
thumbnail: 'https://picsum.photos/400/300?random=519'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><p>这是我参与更文挑战的第 7 天，活动详情查看： <a href="https://juejin.cn/post/6967194882926444557" target="_blank">更文挑战</a></p>
<blockquote>
<p>2021-06-07 总结 TANGJIE 其他 脚手架基础 脚手架原理</p>
</blockquote>
<h1 data-id="heading-0">前端脚手架开发，初识探本质</h1>
<h2 data-id="heading-1">1. 基本原理</h2>
<h3 data-id="heading-2">1.1 手脚架是如何创建自己的主命令的</h3>
<p>例如vue-cli，其主命令是vue，那么这个命令是怎么创建的呢？</p>
<p>找到vue这个命令的文件地址：<code>which vue</code></p>
<p>这样我们就能够轻易的找到这样的文件夹如图：</p>
<p>在其中我们可以发现<code>@vue/cli</code> 有一个<code>package.json</code>里面有一条很清晰的配置语句:</p>
<pre><code class="hljs language-json copyable" lang="json">...
<span class="hljs-string">"bin"</span>: &#123;
    <span class="hljs-attr">"vue"</span>: <span class="hljs-string">"bin/vue.js"</span>
 &#125;
...
<span class="copy-code-btn">复制代码</span></code></pre>
<p>这也就是为什么下载了一个Vue-cli手脚架，用来创建其项目的时候，使用是<code>vue</code>这个命令的原因;</p>
<h3 data-id="heading-3">1.2 安装执行手脚架发生了什么？</h3>
<p>上面说的只是一种配置，具体我们能用到<code>vue create xxx</code> 那就需要项目安装的时候去配置一些东西。</p>
<ul>
<li>很浅显的第一步，将包下载到全局的node_moudles这个文件夹中</li>
<li>解析package.json中bin的这个语句，然后再<code>/c/Users/Administrator/AppData/Roaming/npm</code>目录下创建一个软链接（shell脚本），这个链接就指向了bin配置的路径</li>
<li>执行vue命令时 首先在<code>which vue</code>找到这个路径下的vue软链接，然后通过这个软链接去执行vue.js 但是这里有一个很大的问题是，vue.js是不能去直接执行的，执行解释js文件需要一个专门的解释器，也就node，那么她如何用node发起执行的呢？ 打开@vue/cli/bin/vue.js，看到代码第一条<code>#!/usr/bin/env node</code>,对没错就是这条语句，使得终端知道用node去解释执行vue.js文件，那么这个语句的意思是什么呢？ 意思是通过环境变量找到node解释器，如果是其他语言就改一下解释器就行了</li>
</ul>
<h2 data-id="heading-4">2. 小试破菜刀</h2>
<p>看了上面的原理，我们来实践一下，毕竟实践出真知</p>
<ol>
<li>找个地方创建一个cli文件夹，写入test.js,我的目录地址是<code>E:/myproject/Demo/cli/test.js</code></li>
</ol>
<pre><code class="hljs language-javascript copyable" lang="javascript"><span class="hljs-comment">// test.js</span>

#!<span class="hljs-regexp">/usr/</span>bin/env node

<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'test'</span>);
<span class="copy-code-btn">复制代码</span></code></pre>
<ol start="2">
<li>使用<code>echo $PATH</code>去找到node的环境变量 <code>C:\Users\Administrator\AppData\Roaming\npm</code>,其实用<code>which vue</code>也行,前提是你电脑全局安装了vue-cli;</li>
<li>进入到这个文件夹下，创建软链接<code>ln -s E:/myproject/Demo/cli/test.js examplecli</code>;</li>
<li>随便在一个地方，打开命令行工具 输入 <code>examplecli</code>命令，完美打印出 test 这个字样</li>
</ol>
<h2 data-id="heading-5">3. 手脚架的开发流程</h2>
<h3 data-id="heading-6">3.1 基本开发流程</h3>
<ol>
<li>创建npm项目</li>
<li>创建手脚架入口文件，并添加<code>#!/usr/bin/env node</code>语句</li>
<li>配置packag.json 添加bin属性，映射项目入口文件位置</li>
<li>编写手脚架</li>
<li>将手脚架发布到npm</li>
</ol>
<h3 data-id="heading-7">3.2 开发难点</h3>
<ol>
<li>分包，将复杂的系统分成若干个模块</li>
<li>命令注册</li>
</ol>
<pre><code class="hljs language-JavaScript copyable" lang="JavaScript"><span class="hljs-comment">// 例如vue-cli的这些命令是怎么注册的</span>
vue create
vue add
vue invoke
<span class="copy-code-btn">复制代码</span></code></pre>
<ol start="3">
<li>参数解析，<code>主命令 command [options] <params></code>,options的全称：--version；options的简写-r ；带params的options等；</li>
<li>帮助文档</li>
<li>命令行交互</li>
<li>日志打印</li>
<li>命令行变色</li>
<li>网络通信</li>
<li>文件处理</li>
</ol>
<p>这些问题可以先自己思考，欢迎关注下一期</p></div>  
</div>
            