
---
title: '前端安全—常见的攻击方式及防御方法'
categories: 
 - 编程
 - 掘金
 - 分类
headimg: 'https://picsum.photos/400/300?random=2831'
author: 掘金
comments: false
date: Sun, 04 Jul 2021 23:59:01 GMT
thumbnail: 'https://picsum.photos/400/300?random=2831'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><h1 data-id="heading-0">常见攻击</h1>
<h2 data-id="heading-1">Cookie挟持</h2>
<p><code>HTTP</code>是无状态的协议，为了维持和跟踪用户的状态，引入了<code>Cookie</code>和<code>Session</code>。 <code>Cookie</code>包含了浏览器客户端的用户凭证，相对较小。<code>Session</code>则维护在服务器，用于维护相对较大的用户信息。可以把<code>Cookie</code>当成密码，而<code>Session</code>是保险柜。由于<code>HTTP</code>是明文传输，<code>Cookie</code>很容易被盗取，如果被盗取，别人就可以冒充你的身份，打开你的保险柜，获取你的信息，动用你的资金，这是很危险的。</p>
<p>Cookie和Session的关系可以看这篇：<a href="https://www.cnblogs.com/suguangti/p/11043039.html" target="_blank" rel="nofollow noopener noreferrer">浅谈session和cookie的关系</a></p>
<h3 data-id="heading-2">1.危害</h3>
<p>盗取<code>cookie</code>信息，冒充他人身份，盗取信息。</p>
<h3 data-id="heading-3">2.防御</h3>
<ul>
<li>给<code>cookie</code>添加<code>HttpOnly</code>属性，该属性设置后，只能在<code>http</code>请求中传递，在脚本中，<code>document.cookie</code>无法获取到该<code>cookie</code>值，对XSS攻击有防御作用，但对网络拦截还是会泄露。</li>
<li>在<code>cookie</code>中添加校验信息，这个校验信息和当前用户外置环境有些关系，比如<code>ip</code>、<code>user agent</code>等有关.这样当<code>cookie</code>被人劫持冒用时，在服务器端校验的时候，发现校验值发生了变化，因此会要求用户重新登录，可以规避<code>cookie</code>劫持。</li>
<li><code>cookie</code>中<code>session id</code>的定时更换，让<code>session id</code>按一定频率变换，同时对用户而言，该操作是透明的，这样保证了服务体验的一致性。</li>
</ul>
<h2 data-id="heading-4">XSS跨站脚本攻击</h2>
<p>攻击者在<code>web</code>页面恶意插入<code>HTML</code>或<code>script</code>标签，当用户浏览该页面时，恶意代码就会被执行，从而达到攻击的目的。<code>XSS</code>利用的是<strong>用户对指定网站的信任</strong>。</p>
<h3 data-id="heading-5">1.类型</h3>
<ul>
<li>
<p>反射型(非持久)：攻击者事先制作好攻击链接,需要欺骗用户自己去点击链接才能触发<code>XSS</code>代码，所谓反射型<code>XSS</code>就是将恶意用户输入的<code>js</code>脚本，反射到浏览器执行。</p>
</li>
<li>
<p>储存型(持久型)：会把攻击者的数据储存到服务端，攻击行为将伴随攻击数据一直存在，每当用户访问该页面就会触发代码执行。</p>
</li>
<li>
<p>DOM型：基于文档对象模型的漏洞。</p>
</li>
</ul>
<p>最经典的存储型<code>XSS</code>漏洞是留言板，当用户A在留言板留言一段<code>JS</code>代码<code><script>alert("run javascript");</script></code>,后端未经过滤直接存储到数据库，当正常用户浏览到他的留言后，这段<code>JS</code>代码就会被执行，可以借此来盗取<code>cookie</code>。</p>
<h3 data-id="heading-6">2.危害</h3>
<ul>
<li>盗取网页浏览中的<code>cookie</code>值，盗用<code>cookie</code>实现无密码登录，盗取用户信息。</li>
<li>劫持访问，实现恶意跳转。</li>
<li>配合CSRF攻击完成恶意请求。</li>
</ul>
<h3 data-id="heading-7">3.防御方法</h3>
<ul>
<li>标签过滤，如<code><script></code>、<code><img></code>、<code><a></code>标签等</li>
<li>编码，对字符<code><</code> 、<code>></code>、<code>&</code>、<code>"</code> 、<code>'</code> 、<code>+</code>、<code>/</code>等进行转义。</li>
<li><code>cookie</code>防盗，将<code>cookie</code>设置为<code>http-only</code>,<code>js</code>脚本将无法读取到<code>cookie</code>信息。</li>
<li>纯前端渲染，明确<code>innerText</code>、<code>setAttribute</code>、<code>style</code>，将代码与数据分隔开。</li>
<li>避免不可信的数据拼接到字符串中传递给这些<code>API</code>，如<code>DOM</code>中的内联事件监听器，<code>location</code>、<code>onclick</code>、<code>onload</code>、<code>onmouseover</code>等，<code><a></code>标签的<code>href</code>属性，<code>JavaScript</code>的<code>eval()</code>、<code>setTimeout()</code>、<code>setInterval()</code>等，都能把字符串作为代码运行。</li>
</ul>
<h2 data-id="heading-8">CSRF跨站点请求伪造</h2>
<p>顾名思义就是通过伪造连接请求，在用户不知情的情况下，让用户以自己的身份来完成非本意操作的攻击方法。<code>CSRF</code>利用的是<strong>网站对浏览器的信任</strong>。</p>
<h3 data-id="heading-9">1.原理</h3>
<ol>
<li>用户<code>C</code>浏览并登录信任网站<code>A</code>,产生<code>cookie</code></li>
<li>用户<code>C</code>未退出网站<code>A</code>，在同一个浏览器危险访问网站<code>B</code></li>
<li>网站<code>B</code>的页面存有一些攻击性的代码，会发出访问<code>A</code>的请求</li>
<li>浏览器收到请求后，在用户不知情的情况下携带<code>cookie</code>访问网站<code>A</code></li>
<li><code>A</code>不知道请求是谁发的，浏览器会带上用户的<code>cookie</code>，所以<code>A</code>会根据用户的权限处理<code>B</code>发出的请求。这样就达到了攻击的目的。</li>
</ol>
<h3 data-id="heading-10">2.防御</h3>
<ul>
<li>验证码：对敏感操作加入验证码，强制用户与网站进行交互</li>
<li>使用<code>POST</code>请求，避免使用<code>GET</code>，降低攻击风险，<code>post</code>请求攻击方需要构造一个<code>form</code>表单才可以发起请求，比<code>get</code>请求（<code>img</code>的<code>src</code>，<code>a</code>标签的<code>href</code>等等）的攻击方式复杂了一些，相对来说能降低风险，但不能阻止。</li>
<li>检查<code>HTTP</code>中的<code>referer</code>字段，该字段记录了<code>HTTP</code>请求的来源地址</li>
<li>在请求头中加入<code>token</code>验证字段，浏览器并不会自动携带<code>Token</code>去请求，且<code>Token</code>可以携带一段加密的<code>jwt</code>用作身份认证，这样进行<code>CSRF</code>的时候仅传递了<code>cookie</code>，并不能表明用户身份，网站即拒绝攻击请求。</li>
<li>在<code>http</code>中自定义属性并验证。</li>
</ul>
<h2 data-id="heading-11">点击挟持</h2>
<ul>
<li>
<h3 data-id="heading-12">ClickJacking点击劫持</h3>
</li>
</ul>
<p>当访问某网站时，利用<code>CSS</code>将攻击者实际想让你点击的页面进行透明化隐藏，然后在页面后显示 一些东西诱导让你点击，点击后则会在用户毫不知情的情况下做了某些操作，这就是点击劫持<code>ClickJacking</code>。</p>
<ul>
<li>
<h3 data-id="heading-13">iframe覆盖</h3>
</li>
</ul>
<p>第三方网站通过<code>iframe</code>内嵌某一个网站，并且将<code>iframe</code>设置为透明不可见，将其覆盖在其他经过伪装的<code>DOM</code>上，伪装的可点击<code>DOM</code>（按钮等）与实际内嵌网站的可点击<code>DOM</code>位置相同，当用户点击伪装的<code>DOM</code>时，实际上点击的是<code>iframe</code>中内嵌的网页的<code>DOM</code>从而触发请求操作。</p>
<h3 data-id="heading-14">防御</h3>
<ul>
<li>设置<code>http</code>响应头<code>X-FRAME-OPTIONS</code>是目前最可靠的方法。<code>X-FRAME-OPTIONS</code>是微软提出的一个<code>HTTP</code>头，专门用来防御利用<code>iframe</code>嵌套的点击劫持攻击。</li>
</ul>
<pre><code class="copyable">DENY // 拒绝任何域加载
SAMEORIGIN // 只允许同源域下加载
ALLOW-FROM // 可以定义允许iframe加载的页面地址
<span class="copy-code-btn">复制代码</span></code></pre></div>  
</div>
            