
---
title: '_JS_07.变量提升处理机制'
categories: 
 - 编程
 - 掘金
 - 分类
headimg: 'https://picsum.photos/400/300?random=6009'
author: 掘金
comments: false
date: Thu, 19 Aug 2021 02:00:11 GMT
thumbnail: 'https://picsum.photos/400/300?random=6009'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><h3 data-id="heading-0">1. 变量提升概念</h3>
<ul>
<li>在当前上下文中（全局/私有/块级），JS代码自上而下执行之前，浏览器会提前处理一些事情（可以理解为词法解析的一个环节，词法解析一定发生在代码执行之前）</li>
</ul>
<h3 data-id="heading-1">2. 词法解析：</h3>
<ul>
<li>词法解析会把当前上下文中所有带var/function关键字的进行提前声明或者定义
<ul>
<li>带var的只提前声明</li>
<li>带function的提前声明+定义</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-js copyable" lang="js">创建变量：<span class="hljs-keyword">var</span> a = <span class="hljs-number">10</span>;
<span class="hljs-number">1.</span> 声明declare：<span class="hljs-keyword">var</span> a
<span class="hljs-number">2.</span> 定义defined：a = <span class="hljs-number">10</span>
<span class="copy-code-btn">复制代码</span></code></pre>
<h3 data-id="heading-2">3. var的变量提升</h3>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-comment">/*
  代码执行之前，全局上下文中的变量提升
    var a; 默认值是undefined
*/</span>
<span class="hljs-built_in">console</span>.log(a);  <span class="hljs-comment">// a变量提升，未定义，undefined</span>
<span class="hljs-keyword">var</span> a = <span class="hljs-number">12</span>;  <span class="hljs-comment">// 定义赋值 a = 12</span>
a = <span class="hljs-number">13</span>;  <span class="hljs-comment">// 全局变量 a = 13</span>
<span class="hljs-built_in">console</span>.log(a);  <span class="hljs-comment">// 13</span>
<span class="copy-code-btn">复制代码</span></code></pre>
<h3 data-id="heading-3">4. function声明函数和函数表达式声明函数</h3>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-comment">/*
  全局上下文中的变量提升
    func = 函数，函数在这个阶段赋值就做了
*/</span>
func();
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">func</span>(<span class="hljs-params"></span>) </span>&#123;
  <span class="hljs-keyword">var</span> a = <span class="hljs-number">12</span>;
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'OK'</span>)
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<ul>
<li>真实项目中期望用函数表达式方式创建函数，因为这样在变量提升阶段只会声明func，不会赋值，顺序性，不要再声明前执行</li>
</ul>
<pre><code class="hljs language-js copyable" lang="js">func()  <span class="hljs-comment">// func is not a function</span>
<span class="hljs-keyword">var</span> func = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<ul>
<li>函数表达式声明非匿名函数</li>
</ul>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">var</span> func = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">AAA</span>(<span class="hljs-params"></span>) </span>&#123;
  <span class="hljs-comment">// 把原本作为值的函数表达式匿名函数具名化，但是外部不能访问，也就是不会在当前上下文创建这个名字</span>
  <span class="hljs-comment">// 函数执行，在形成的私有上下文中，可以访问</span>
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'OK'</span>)
  <span class="hljs-comment">//AAA()  // 递归死循环</span>
  <span class="hljs-built_in">console</span>.log(AAA, <span class="hljs-keyword">typeof</span> AAA) <span class="hljs-comment">// "function" </span>
&#125;
AAA() <span class="hljs-comment">// Uncaught ReferenceError: AAA is not defined</span>
func()
<span class="copy-code-btn">复制代码</span></code></pre>
<ul>
<li>匿名函数具名化eg</li>
</ul>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-built_in">setTimeout</span>(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">func</span>(<span class="hljs-params"></span>) </span>&#123;
  func()
&#125;, <span class="hljs-number">1000</span>)
<span class="copy-code-btn">复制代码</span></code></pre>
<h3 data-id="heading-4">5. 例子</h3>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-comment">/*
  EC(G)全局变量提升
*/</span>
<span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">window</span>.a);  <span class="hljs-comment">// undefined</span>
<span class="hljs-built_in">console</span>.log(a); <span class="hljs-comment">// a is not defined</span>
a = <span class="hljs-number">13</span>;
<span class="hljs-built_in">console</span>.log(a) <span class="hljs-comment">// 13</span>
<span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">window</span>.a)  <span class="hljs-comment">// 13</span>

<span class="hljs-comment">// let 定义 不会同时在window创建, var和直接创建都会在windoow中</span>
<span class="copy-code-btn">复制代码</span></code></pre>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-comment">/*
  EC(G)全局变量提升，let和const 不变量提升
*/</span>
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'OK'</span>)  <span class="hljs-comment">// OK</span>
<span class="hljs-built_in">console</span>.log(a); <span class="hljs-comment">// a is not defined</span>
<span class="hljs-keyword">let</span> a = <span class="hljs-number">12</span>;
a = <span class="hljs-number">13</span>;
<span class="hljs-built_in">console</span>.log(a);
<span class="copy-code-btn">复制代码</span></code></pre>
<blockquote>
<p>基于 <code>var/function</code> 在<code>全局上下文</code>中声明的变量，全局变量，会映射到GO（全局对象），也就是<code>window</code>上一份，作为属性</p>
</blockquote>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-comment">// 无论条件是否成立，都要进行变量提升</span>
<span class="hljs-keyword">if</span>(!(<span class="hljs-string">"a"</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">window</span>)) &#123;   <span class="hljs-comment">// !true -> false</span>
 <span class="hljs-keyword">var</span> a = <span class="hljs-number">1</span>;
&#125;
<span class="hljs-built_in">console</span>.log(a);  <span class="hljs-comment">// undefined</span>
<span class="copy-code-btn">复制代码</span></code></pre>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-comment">/*
  变量提升
  扫描代码，fn=>1 不会重新声明，但是要重新赋值
  fn=>2
  var fn 上面做过了，忽略
  fn=>4
  fn=>5
  window.fn 此时也是5
*/</span>
fn();   <span class="hljs-comment">// 5 变量提升完结果是5</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fn</span>(<span class="hljs-params"></span>) </span>&#123;<span class="hljs-built_in">console</span>.log(<span class="hljs-number">1</span>)&#125;  <span class="hljs-comment">// 不再处理，变量提升阶段已经做过</span>
fn();  <span class="hljs-comment">// 5</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fn</span>(<span class="hljs-params"></span>) </span>&#123;<span class="hljs-built_in">console</span>.log(<span class="hljs-number">2</span>)&#125;
fn();  <span class="hljs-comment">// 5</span>
<span class="hljs-keyword">var</span> fn = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;<span class="hljs-built_in">console</span>.log(<span class="hljs-number">3</span>)&#125;  <span class="hljs-comment">// 变量提升阶段，没做个这个赋值，现在赋值</span>
fn();  <span class="hljs-comment">// 3</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fn</span>(<span class="hljs-params"></span>) </span>&#123;<span class="hljs-built_in">console</span>.log(<span class="hljs-number">4</span>)&#125;   <span class="hljs-comment">// 不再处理</span>
fn();  <span class="hljs-comment">// 3</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fn</span>(<span class="hljs-params"></span>) </span>&#123;<span class="hljs-built_in">console</span>.log(<span class="hljs-number">5</span>)&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">var</span> foo = <span class="hljs-number">1</span>;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">bar</span>(<span class="hljs-params"></span>) </span>&#123;
  <span class="hljs-keyword">if</span>(!foo) &#123;
    <span class="hljs-keyword">var</span> foo = <span class="hljs-number">10</span>;
  &#125;
  <span class="hljs-built_in">console</span>.log(foo)
&#125;
bar(); <span class="hljs-comment">// 10</span>
<span class="hljs-built_in">console</span>.log(foo)  <span class="hljs-comment">// 1</span>
<span class="copy-code-btn">复制代码</span></code></pre></div>  
</div>
            