
---
title: '2021 年移动端的开发的几点经验'
categories: 
 - 编程
 - 掘金
 - 分类
headimg: 'https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/52fa6964726a44ceaecfc1ca7313baff~tplv-k3u1fbpfcp-watermark.image'
author: 掘金
comments: false
date: Tue, 13 Apr 2021 19:24:50 GMT
thumbnail: 'https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/52fa6964726a44ceaecfc1ca7313baff~tplv-k3u1fbpfcp-watermark.image'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><h3 data-id="heading-0">1. 图标和文字居中</h3>
<p>文字和图标不能很好的居中</p>
<p><img alt="image.png" class="lazyload" src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/52fa6964726a44ceaecfc1ca7313baff~tplv-k3u1fbpfcp-watermark.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<p><img alt="image.png" class="lazyload" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e9943d5f87c64343bdea7159ee06f78e~tplv-k3u1fbpfcp-watermark.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<p>其实是做不到完全的居中的，可以跟设计师沟通图标位置，让设计师调整一下 svg 里面的居中，在一定接受范围。</p>
<p>延伸阅读
<a href="https://juejin.cn/post/6870293447300317192" target="_blank">字体构造与文字垂直居中方案探索</a></p>
<h3 data-id="heading-1">2. react 事件冒泡</h3>
<p>移动端小屏幕下，元素堆叠起来，事件冒泡出现几率大很多。</p>
<p><img alt="image.png" class="lazyload" src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/970ab537821440edb66b989d6a080557~tplv-k3u1fbpfcp-watermark.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<h3 data-id="heading-2">3.wx.config</h3>
<p>跳转到需要使用到 wx.config 接口页面的时候，使用 windoe.location 取代 react-router 的 push、replace 等</p>
<h3 data-id="heading-3">4. wx.previewImage</h3>
<p>微信处理图片的能力一部分继承自操作系统，在不同机型，不同系统下表现不一样。
预览的图片的大小，尺寸都可能导致图片预览失败（小米和华为出现几率很高）。</p>
<ol>
<li>限制图片大小和尺寸（尺寸比较难限制）</li>
<li>使用第三方 <a href="https://github.com/xiaolin/react-image-gallery" target="_blank" rel="nofollow noopener noreferrer">实现预览图片</a></li>
</ol>
<h3 data-id="heading-4">5.微信浮窗图标</h3>
<p>根据当前页面使用 JS-SDK 时注入的配置信息 wx.config 中的 appId 所对应的公众号的头像来展示的。如果页面没有使用 JS-SDK，则默认【浮窗】图标为灰色的“链接”形状。</p>
<h3 data-id="heading-5">6.修改当前页面的全局</h3>
<p>在 global.css 全局设置了白色背景，有些特殊页面用了其他颜色的背景，不要修改 css,用下面方法更好。</p>
<p><img alt="image.png" class="lazyload" src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4ce770f369f84d46a6c6c705c57b8fbd~tplv-k3u1fbpfcp-watermark.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<h3 data-id="heading-6">7.调试器不要打包进代码里面</h3>
<p>用 cdn + 域名判断去加载调试，如果用 npm 包可能会被打包到代码里，增加代码大小。</p>
<p><img alt="image.png" class="lazyload" src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/265744e19c6c4f5da0f28650b9d816e7~tplv-k3u1fbpfcp-watermark.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<h3 data-id="heading-7">8. url 特殊字符跳转</h3>
<p>推荐 url 跳转的参数使用 <a href="https://www.npmjs.com/package/js-base64" target="_blank" rel="nofollow noopener noreferrer">js-base64</a> 转译</p>
<p><img alt="image.png" class="lazyload" src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dfbd82eb854f4185aa9646552c21f2ca~tplv-k3u1fbpfcp-watermark.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<h3 data-id="heading-8">7. 批量取消 ajax</h3>
<p>单页面应用中，经常出现这个路由页面还没请求完，就切换到下一个路由，上一个路由页面数据请求成功但页面销毁了，控制台可能就报错了。</p>
<p>请求：
<img alt="image.png" class="lazyload" src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b52bc16610dd4f6c9fca833562b82758~tplv-k3u1fbpfcp-watermark.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<p>布局组件：
<img alt="image.png" class="lazyload" src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/19f74a6ad51440d79e4e1f8898819516~tplv-k3u1fbpfcp-watermark.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<h3 data-id="heading-9">9. css 禁止用户按住出现扫描二维码</h3>
<pre><code class="copyable"> 元素加上 pointer-events: none; 属性
<span class="copy-code-btn">复制代码</span></code></pre>
<h3 data-id="heading-10">10. iframe ios 14 出现跨域问题</h3>
<p><img alt="image.png" class="lazyload" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/63490cb5ae854027b779bc9a496daacd~tplv-k3u1fbpfcp-watermark.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<h3 data-id="heading-11">11. iphone 刘海屏适配安全区域</h3>
<p>其实微信浏览器 ios 自带适配，不过自己适配一下更好。
<a href="https://segmentfault.com/a/1190000020887571" target="_blank" rel="nofollow noopener noreferrer">css适配iPhoneX屏幕安全区</a></p>
<h3 data-id="heading-12">12. react && 符号的判断</h3>
<p>data 如果是 0 页面就会渲染成 0，而不是不渲染 ，所以一定要做严格<strong>真值</strong>判断。</p>
<p><img alt="image.png" class="lazyload" src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7f739990d2594c5aadbd3740696ff251~tplv-k3u1fbpfcp-watermark.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<h3 data-id="heading-13">13. 部分安卓手机 border 跟 radius 一起使用时，border不出现</h3>
<p><img alt="image.png" class="lazyload" src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/da0a4d8a04274fdf91b8408428ebd143~tplv-k3u1fbpfcp-watermark.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<h3 data-id="heading-14">14. react 17 和 ts 搭配使用</h3>
<p><img alt="image.png" class="lazyload" src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/41087e88e38f4c4496d42ca627a51bff~tplv-k3u1fbpfcp-watermark.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<p><img alt="image.png" class="lazyload" src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/714ec97b24454e6aaa95a996308f2048~tplv-k3u1fbpfcp-watermark.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<p>详情请看 =><a href="https://juejin.cn/post/6927475526202294285" target="_blank"> 细嚼慢咽 Typescript + React17 +Eslint + Git hook 工作流</a></p>
<h3 data-id="heading-15">15. 产品适老化</h3>
<p>微信内设置字体放大，会导致页面布局错乱</p>
<p>ios(none 和 100%貌似都行):
<img alt="image.png" class="lazyload" src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cb8217d792784f7e8ab1e4bd2d45147a~tplv-k3u1fbpfcp-watermark.image" data-width="800" data-height="600" referrerpolicy="no-referrer">
Android：未做</p>
<p>延伸阅读=><a href="https://juejin.cn/post/6890159347167395848" target="_blank"> 设置微信字体大小引发的页面布局错乱问题
</a></p>
<h3 data-id="heading-16">16. 增加依赖包升级频率</h3>
<p>推荐每个迭代，看看有没有 npm 包可以升级，能升尽量升，不然大家都不升级，以后大版本就没人敢升级，最终成为代码屎山。</p>
<h3 data-id="heading-17">17. 部分安卓机，滚动条侧边会有一个黑点（多余的横向滚动条）。</h3>
<p><img alt="image.png" class="lazyload" src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1545aee4ea7b4df79864c1c2e9cd41fd~tplv-k3u1fbpfcp-watermark.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<h3 data-id="heading-18">18. 页面跳转后滚动条置顶</h3>
<p><img alt="image.png" class="lazyload" src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/943ffdebeb604bd494adbb453a78b433~tplv-k3u1fbpfcp-watermark.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<h3 data-id="heading-19">19. 手势返回的时候，弹框未关闭</h3>
<p>history.push 页面并没有销毁，上一个页面的弹框未关闭可能引发一些问题.最好每个页面都关闭，或者使用全局一些方法去关闭。</p>
<p>antd 可以用Modal.destroyAll();</p>
<p><img alt="image.png" class="lazyload" src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2cdce8968d7741f39dd6f20289a5d8f4~tplv-k3u1fbpfcp-watermark.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<h3 data-id="heading-20">20. ios 返回页面不刷新</h3>
<p><img alt="image.png" class="lazyload" src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/52989919f9ce499b8a60876c965156a5~tplv-k3u1fbpfcp-watermark.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<h3 data-id="heading-21">21. 部分andriod机后退ajax缓存处理</h3>
<p><img alt="image.png" class="lazyload" src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/188b6be1a7814a4a8276a218f0d71581~tplv-k3u1fbpfcp-watermark.image" data-width="800" data-height="600" referrerpolicy="no-referrer"></p>
<h3 data-id="heading-22">22 苹果手机相邻元素 onClick 事件快速点击问题</h3>
<p>手机端：快速点击上面和下面文字（实际业务场景是相邻按钮），会出现连续点击上面的情况，下面文字的事件不触发（要非常快）。
<a href="https://codesandbox.io/s/nostalgic-merkle-w4ug6?file=/src/App.tsx" target="_blank" rel="nofollow noopener noreferrer">演示地址</a></p>
<pre><code class="copyable">import "./styles.css";
import &#123; useState &#125; from "react";

export default function App() &#123;
  const [tType, setT] = useState(false);
  const [bType, setB] = useState(false);
  const top = () => &#123;
    console.log("这是上面的", tType);
    setT((state) => !state);
  &#125;;
  const bottom = () => &#123;
    console.log("这下面的", bType);
    setB((state) => !state);
  &#125;;
  return (
    <div>
      <div className="pt20" onClick=&#123;top&#125;>
        <div>这是上面的</div>
      </div>
      <div className="pt20" onClick=&#123;bottom&#125;>
        <div>这下面的</div>
      </div>
    </div>
  );
&#125;

<span class="copy-code-btn">复制代码</span></code></pre>
<p>解决办法是把 onClick 事件换成 onTouchStart (怀疑是 onClick 事件有延迟导致的，没找到根本原因，如果有更好的办法，麻烦评论区一起讨论)</p>
<h3 data-id="heading-23">相关资料</h3>
<p><a href="https://juejin.cn/post/6870293447300317192" target="_blank">字体构造与文字垂直居中方案探索</a></p>
<p><a href="https://juejin.cn/post/6927475526202294285" target="_blank"> 细嚼慢咽 Typescript + React17 +Eslint + Git hook 工作流</a></p>
<p><a href="https://segmentfault.com/a/1190000020887571" target="_blank" rel="nofollow noopener noreferrer">css适配iPhoneX屏幕安全区</a></p>
<p><a href="https://carbon.now.sh/" target="_blank" rel="nofollow noopener noreferrer">Carbon是一个在线的代码块截图工具</a></p></div> <div class="image-viewer-box" data-v-78c9b824><!----></div>  
</div>
            