
---
title: '可视化搭建移动端店铺解决方案'
categories: 
 - 编程
 - 掘金
 - 分类
headimg: 'https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8bd9f2bc1d344f8e9c83a042663da1bc~tplv-k3u1fbpfcp-watermark.image'
author: 掘金
comments: false
date: Tue, 29 Jun 2021 18:38:43 GMT
thumbnail: 'https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8bd9f2bc1d344f8e9c83a042663da1bc~tplv-k3u1fbpfcp-watermark.image'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;color:#383838;font-size:15px;line-height:37.5px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:120px&#125;.markdown-body ::selection&#123;color:#fff;background-color:#a862ea&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;margin:30px 0 15px;color:#a862ea&#125;.markdown-body h1&#123;line-height:2;font-size:1.4em&#125;.markdown-body h1~p:first-of-type:first-letter&#123;color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder&#125;.markdown-body h2&#123;font-size:1.2em&#125;.markdown-body h3&#123;font-size:1.1em&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:2em&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;padding-left:.2em&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:10px&#125;.markdown-body li::marker&#123;color:#a862ea&#125;.markdown-body li,.markdown-body p&#123;opacity:.9;vertical-align:baseline;transition:all .1s ease&#125;.markdown-body li:hover,.markdown-body p:hover&#123;opacity:1&#125;.markdown-body a&#123;display:inline-block;color:#a862ea;cursor:pointer;padding-bottom:2px;text-decoration:none;position:relative&#125;.markdown-body a:after&#123;content:"";position:absolute;width:98%;height:2px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out&#125;.markdown-body a:hover:after&#123;transform:scaleX(1);transform-origin:bottom left&#125;.markdown-body a:active,.markdown-body a:link&#123;color:#a862ea&#125;.markdown-body img&#123;max-width:100%;user-select:none;margin:1em 0;box-shadow:0 0 20px 0 #e7daff;transition:transform .2s ease 0s;background-color:#f8f5ff&#125;.markdown-body img:hover&#123;opacity:1;transform:translateY(-2px)&#125;.markdown-body blockquote&#123;padding:.5em 1em;margin:15px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:4px solid #a862ea;background-color:#f8f5ff&#125;.markdown-body blockquote>p&#123;margin:0&#125;.markdown-body code&#123;padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff&#125;.markdown-body pre&#123;margin:2em 0;box-shadow:0 0 20px #e7daff&#125;.markdown-body pre>code&#123;display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:22.5px;color:#383838;border-radius:3px;scroll-behavior:smooth&#125;.markdown-body pre>code::-webkit-scrollbar&#123;height:6px;background-color:#f8f5ff&#125;.markdown-body pre>code::-webkit-scrollbar-thumb&#123;background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px&#125;.markdown-body hr&#123;margin:2em 0;border-top:1px solid #a862ea&#125;.markdown-body table&#123;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse;border:1px solid #e7daff&#125;.markdown-body thead&#123;color:#a862ea;background:#f8f5ff&#125;.markdown-body td,.markdown-body th&#123;padding:1em .5em&#125;.markdown-body tr&#123;background-color:#fcfcfc&#125;@media (max-width:720px)&#123;.markdown-body&#123;font-size:12px&#125;&#125;</style><h1 data-id="heading-0">前言</h1>
<p>经过许久的深思熟虑与探索，同时也借鉴了行业内不错的产品（如：<a href="https://www.youzan.com/" target="_blank" rel="nofollow noopener noreferrer">有赞</a>，<a href="http://h5.dooring.cn/" target="_blank" rel="nofollow noopener noreferrer">H5-Dooring</a>等），但跟列举的产品还是有区别的（先卖个关子，后面再讲有哪些区别）。其实这种功能在零售系统（目前我所在公司是零售行业的领头羊）和电商系统应该很常见，很多应用场景都会用到，像产品营销页面、企业/个人微官网、H5活动页面等移动端页面，通过可视化配置快速搭建H5页面，且提供丰富的页面组件，更方便的为使用者搭建更强大的H5页面。</p>
<p>PC端界面如下：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8bd9f2bc1d344f8e9c83a042663da1bc~tplv-k3u1fbpfcp-watermark.image" alt="PC端界面" loading="lazy" referrerpolicy="no-referrer"></p>
<p>移动端（H5和小程序）界面如下：</p>
<div align="center">
    <img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8036b4f378464dfc8796fd953ed52c27~tplv-k3u1fbpfcp-watermark.image" width="60%" loading="lazy" referrerpolicy="no-referrer">
</div>
<h1 data-id="heading-1">技术方案</h1>
<p>PC端 <a href="https://reactjs.org/" target="_blank" rel="nofollow noopener noreferrer">React</a> 技术栈，移动端 <a href="https://uniapp.dcloud.io/" target="_blank" rel="nofollow noopener noreferrer">UniApp</a> 跨平台框架，功能的设计结构图如下：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fc8254b353c449af9a72a15d3f5c6ae2~tplv-k3u1fbpfcp-watermark.image" alt="装修页面前端设计模式.png" loading="lazy" referrerpolicy="no-referrer"></p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-comment">/*
 * @description: DecoratePage Context交互
 * @version: 分支号 20210629
 * @author: xuchao
 */</span>
<span class="hljs-keyword">import</span> React, &#123; PureComponent &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> &#123; withRouter, router &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'umi'</span>;
<span class="hljs-keyword">import</span> &#123; Layout, Modal, Button &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'antd'</span>;
<span class="hljs-keyword">import</span> &#123; isEmpty, findIndex, isArray, find, every, cloneDeep &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'lodash'</span>;
<span class="hljs-keyword">import</span> &#123; DndProvider &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dnd'</span>;
<span class="hljs-keyword">import</span> &#123; HTML5Backend &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dnd-html5-backend'</span>;
<span class="hljs-keyword">import</span> &#123; showMsg &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'@/global'</span>;
<span class="hljs-keyword">import</span> Component <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/Component'</span>;
<span class="hljs-keyword">import</span> Preview <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/Preview'</span>;
<span class="hljs-keyword">import</span> Compiler <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/Compiler'</span>;
<span class="hljs-keyword">import</span> &#123; DecorateContext, components &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'./utilities'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'./style.less'</span>;

<span class="hljs-keyword">const</span> &#123; Header &#125; = Layout;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Decorate</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">PureComponent</span> </span>&#123;
    state = &#123;
        <span class="hljs-attr">compiler</span>: <span class="hljs-string">'PageSetting'</span>,
        <span class="hljs-attr">pagename</span>: <span class="hljs-string">'页面标题'</span>,
        <span class="hljs-attr">selectIndex</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">previewData</span>: [],
    &#125;;

    <span class="hljs-function"><span class="hljs-title">getChildContext</span>(<span class="hljs-params"></span>)</span> &#123;
        <span class="hljs-keyword">return</span> &#123;
            ...this.state,
            ...this.props,
            <span class="hljs-attr">setState</span>: <span class="hljs-function"><span class="hljs-params">state</span> =></span> <span class="hljs-built_in">this</span>.setState(state),
        &#125;;
    &#125;

    <span class="hljs-function"><span class="hljs-title">render</span>(<span class="hljs-params"></span>)</span> &#123;
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag"><<span class="hljs-name">DecorateContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;this.getChildContext()&#125;</span>></span>
                <span class="hljs-tag"><<span class="hljs-name">Layout</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"decorate"</span>></span>
                    <span class="hljs-tag"><<span class="hljs-name">Header</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"header"</span>></span>
                        <span class="hljs-tag"><<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"hand"</span>></span>
                            返回首页装修
                        <span class="hljs-tag"></<span class="hljs-name">span</span>></span>
                        <span class="hljs-tag"><<span class="hljs-name">Button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"fr"</span>></span>
                            发布
                        <span class="hljs-tag"></<span class="hljs-name">Button</span>></span>
                        <span class="hljs-tag"><<span class="hljs-name">Button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"fr mr10"</span>></span>
                            保存
                        <span class="hljs-tag"></<span class="hljs-name">Button</span>></span>
                        <span class="hljs-tag"><<span class="hljs-name">Button</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"fr mr10"</span>></span>
                            预览
                        <span class="hljs-tag"></<span class="hljs-name">Button</span>></span>
                    <span class="hljs-tag"></<span class="hljs-name">Header</span>></span>
                    <span class="hljs-tag"><<span class="hljs-name">DndProvider</span> <span class="hljs-attr">backend</span>=<span class="hljs-string">&#123;HTML5Backend&#125;</span>></span>
                        <span class="hljs-tag"><<span class="hljs-name">Layout</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"container"</span>></span>
                            <span class="hljs-tag"><<span class="hljs-name">Component</span> /></span>
                            <span class="hljs-tag"><<span class="hljs-name">Preview</span> /></span>
                            <span class="hljs-tag"><<span class="hljs-name">Compiler</span> /></span>
                        <span class="hljs-tag"></<span class="hljs-name">Layout</span>></span>
                    <span class="hljs-tag"></<span class="hljs-name">DndProvider</span>></span>
                <span class="hljs-tag"></<span class="hljs-name">Layout</span>></span>
            <span class="hljs-tag"></<span class="hljs-name">DecorateContext.Provider</span>></span></span>
        );
    &#125;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<h2 data-id="heading-2">数据</h2>
<p>前面说到与列举的产品有哪些区别，区别在于PC端与移动端的数据交互，它们都是通过 iframe 嵌套 H5 的页面，通过 postmessage API 来做数据交互，而是我没有这样做，原因是项目特别紧，加上人员分配问题，所以采用数据定义模式。</p>
<p>通过上面的设计结构图可以看出PC端最后会生成一份 <strong>schema</strong> 数据存储服务端，移动端从服务端获取到 <strong>schema</strong> 数据进行解析。数据格式如下：</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-comment">// 图片广告</span>
&#123;
    <span class="hljs-attr">component</span>: <span class="hljs-string">'ImageTextAd'</span>,
    <span class="hljs-attr">options</span>: &#123;
        <span class="hljs-attr">template</span>: <span class="hljs-string">'image'</span>, <span class="hljs-comment">// image：一行一个 carousel：轮播海报 slide：大图横向滑动 zone：绘制热区</span>
        <span class="hljs-attr">image</span>: [
            &#123;
                <span class="hljs-attr">id</span>: <span class="hljs-string">''</span>,
                <span class="hljs-attr">url</span>: <span class="hljs-string">''</span>,
                <span class="hljs-attr">title</span>: <span class="hljs-string">''</span>,
                <span class="hljs-attr">linkCode</span>: <span class="hljs-string">''</span>,
                <span class="hljs-attr">linkName</span>: <span class="hljs-string">''</span>,
                <span class="hljs-comment">// 热区</span>
                <span class="hljs-attr">zones</span>: [
                    &#123;
                        <span class="hljs-attr">x</span>: <span class="hljs-number">178</span>,
                        <span class="hljs-attr">y</span>: <span class="hljs-number">91</span>,
                        <span class="hljs-attr">width</span>: <span class="hljs-number">158</span>,
                        <span class="hljs-attr">height</span>: <span class="hljs-number">132</span>,
                        <span class="hljs-attr">code</span>: <span class="hljs-string">'123'</span>,
                        <span class="hljs-attr">text</span>: <span class="hljs-string">'测试链接2'</span>,
                    &#125;
                ],
            &#125;,
            &#123;
                <span class="hljs-attr">id</span>: <span class="hljs-string">''</span>,
                <span class="hljs-attr">url</span>: <span class="hljs-string">''</span>,
                <span class="hljs-attr">title</span>: <span class="hljs-string">''</span>,
                <span class="hljs-attr">linkCode</span>: <span class="hljs-string">''</span>,
                <span class="hljs-attr">linkName</span>: <span class="hljs-string">''</span>,
                <span class="hljs-comment">// 热区</span>
                <span class="hljs-attr">zones</span>: [
                    &#123;
                        <span class="hljs-attr">x</span>: <span class="hljs-number">436</span>,
                        <span class="hljs-attr">y</span>: <span class="hljs-number">97</span>,
                        <span class="hljs-attr">width</span>: <span class="hljs-number">170</span>,
                        <span class="hljs-attr">height</span>: <span class="hljs-number">168</span>,
                        <span class="hljs-attr">code</span>: <span class="hljs-string">''</span>,
                        <span class="hljs-attr">text</span>: <span class="hljs-string">''</span>,
                    &#125;
                ],
            &#125;,
        ],
        <span class="hljs-attr">indicator</span>: <span class="hljs-string">'dotted'</span>, <span class="hljs-comment">// 指示器</span>
        <span class="hljs-attr">style</span>: &#123;
            <span class="hljs-attr">boxShadow</span>: <span class="hljs-string">'none'</span>,
            <span class="hljs-attr">borderRadius</span>: <span class="hljs-string">'none'</span>,
            <span class="hljs-attr">padding</span>: <span class="hljs-string">'0'</span>,
        &#125;,
    &#125;,
&#125;,
<span class="hljs-comment">// 公告</span>
&#123;
    <span class="hljs-attr">component</span>: <span class="hljs-string">'Notice'</span>,
    <span class="hljs-attr">options</span>: &#123;
        <span class="hljs-attr">content</span>: <span class="hljs-string">'公告内容'</span>,
        <span class="hljs-attr">style</span>: &#123;
            <span class="hljs-attr">background</span>: <span class="hljs-string">'rgb(255, 248, 233)'</span>,
            <span class="hljs-attr">color</span>: <span class="hljs-string">'rgb(100, 101, 102)'</span>,
        &#125;,
    &#125;,
&#125;,
<span class="hljs-comment">// 图文导航</span>
&#123;
    <span class="hljs-attr">component</span>: <span class="hljs-string">'ImageTextNav'</span>,
    <span class="hljs-attr">options</span>: &#123;
        <span class="hljs-attr">template</span>: <span class="hljs-string">'image-nav'</span>, <span class="hljs-comment">// image-nav：图片导航 text-nav：文字导航</span>
        <span class="hljs-attr">images</span>: [&#123;
            <span class="hljs-attr">url</span>: <span class="hljs-string">''</span>,
            <span class="hljs-attr">title</span>: <span class="hljs-string">''</span>,
            <span class="hljs-attr">link</span>: <span class="hljs-string">''</span>,
        &#125;],
        <span class="hljs-attr">style</span>: &#123;
            <span class="hljs-attr">background</span>: <span class="hljs-string">'rgb(255, 248, 233)'</span>,
            <span class="hljs-attr">color</span>: <span class="hljs-string">'rgb(100, 101, 102)'</span>,
        &#125;,
    &#125;,
&#125;,
<span class="hljs-comment">// 标题栏</span>
&#123;
    <span class="hljs-attr">component</span>: <span class="hljs-string">'Title'</span>,
    <span class="hljs-attr">options</span>: &#123;
        <span class="hljs-attr">style</span>: &#123;
            <span class="hljs-attr">textAlign</span>: <span class="hljs-string">'left'</span>,
            <span class="hljs-attr">background</span>: <span class="hljs-string">'#FFFFFF'</span>,
        &#125;,
        <span class="hljs-attr">title</span>: &#123;
            <span class="hljs-attr">text</span>: <span class="hljs-string">''</span>,
            <span class="hljs-attr">style</span>: &#123;
                <span class="hljs-attr">fontSize</span>: <span class="hljs-string">'16px'</span>,
                <span class="hljs-attr">fontWeight</span>: <span class="hljs-string">'bold'</span>,
                <span class="hljs-attr">color</span>: <span class="hljs-string">'#323233'</span>,
            &#125;,
        &#125;,
        <span class="hljs-attr">content</span>: &#123;
            <span class="hljs-attr">text</span>: <span class="hljs-string">''</span>,
            <span class="hljs-attr">style</span>: &#123;
                <span class="hljs-attr">fontSize</span>: <span class="hljs-string">'12px'</span>,
                <span class="hljs-attr">fontWeight</span>: <span class="hljs-string">'400'</span>,
                <span class="hljs-attr">color</span>: <span class="hljs-string">'#969799'</span>,
            &#125;,
        &#125;,
    &#125;,
&#125;,
<span class="hljs-comment">// 文本模块</span>
&#123;
    <span class="hljs-attr">component</span>: <span class="hljs-string">'RichText'</span>,
    <span class="hljs-attr">options</span>: &#123;
        <span class="hljs-attr">content</span>: <span class="hljs-string">'<html></html>'</span>,
        <span class="hljs-attr">style</span>: &#123;
            <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'#F9F9F9'</span>,
            <span class="hljs-attr">padding</span>: <span class="hljs-string">'10px 10px 0'</span>,
        &#125;,
    &#125;,
&#125;,
<span class="hljs-comment">// 辅助分割</span>
&#123;
    <span class="hljs-attr">component</span>: <span class="hljs-string">'DivideLine'</span>,
    <span class="hljs-attr">options</span>: &#123;
        <span class="hljs-attr">template</span>: <span class="hljs-string">'block'</span>, <span class="hljs-comment">// block：辅助空白 line：辅助线</span>
        <span class="hljs-attr">style</span>: &#123;
            <span class="hljs-attr">height</span>: <span class="hljs-number">30</span>,
            <span class="hljs-comment">// borderTopWidth: '1px',</span>
            <span class="hljs-comment">// borderTopStyle: 'dashed',</span>
            <span class="hljs-comment">// borderTopColor: '#EBEDF0',</span>
            <span class="hljs-comment">// margin: '10px 0 0',</span>
        &#125;,
    &#125;,
&#125;,
<span class="hljs-comment">// 商品搜索</span>
&#123;
    <span class="hljs-attr">component</span>: <span class="hljs-string">'GoodSearch'</span>,
    <span class="hljs-attr">options</span>: &#123;
        <span class="hljs-attr">style</span>: &#123;
            <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'#FFFFFF'</span>,
        &#125;,
        <span class="hljs-attr">box</span>: &#123;
            <span class="hljs-attr">style</span>: &#123;
                <span class="hljs-attr">borderRadius</span>: <span class="hljs-string">'none'</span>,
                <span class="hljs-attr">textAlign</span>: <span class="hljs-string">'left'</span>,
                <span class="hljs-attr">height</span>: <span class="hljs-number">28</span>,
                <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'#F7F8FA'</span>,
                <span class="hljs-attr">color</span>: <span class="hljs-string">'#c8c9cc'</span>,
            &#125;,
        &#125;,
    &#125;,
&#125;,
<span class="hljs-comment">// 左右图文</span>
&#123;
    <span class="hljs-attr">component</span>: <span class="hljs-string">'LRImageText'</span>,
    <span class="hljs-attr">options</span>: &#123;
        <span class="hljs-attr">template</span>: <span class="hljs-string">'lr'</span>, <span class="hljs-comment">// lr：左图右文 rl：左文右图</span>
        <span class="hljs-attr">content</span>: <span class="hljs-string">''</span>, <span class="hljs-comment">// 内容</span>
        <span class="hljs-attr">image</span>: &#123;
            <span class="hljs-attr">url</span>: <span class="hljs-string">''</span>, <span class="hljs-comment">// 图片地址</span>
            <span class="hljs-attr">linkCode</span>: <span class="hljs-string">''</span>, <span class="hljs-comment">// 跳转页面code</span>
            <span class="hljs-attr">linkName</span>: <span class="hljs-string">''</span>, <span class="hljs-comment">// 跳转页面name</span>
            <span class="hljs-attr">style</span>: &#123;
                <span class="hljs-attr">boxShadow</span>: <span class="hljs-string">'none'</span>,
                <span class="hljs-attr">borderRadius</span>: <span class="hljs-string">'none'</span>,
            &#125;,
        &#125;,
    &#125;,
&#125;,
<span class="hljs-comment">// 图文导航</span>
&#123;
    <span class="hljs-attr">component</span>: <span class="hljs-string">'ImageTextNav'</span>,
    <span class="hljs-attr">options</span>: &#123;
        <span class="hljs-attr">template</span>: <span class="hljs-string">'image'</span>, <span class="hljs-comment">// image：图片导航 text：文字导航</span>
        <span class="hljs-attr">image</span>: [
            &#123;
                <span class="hljs-attr">url</span>: <span class="hljs-string">''</span>,
                <span class="hljs-attr">title</span>: <span class="hljs-string">'导航一'</span>,
                <span class="hljs-attr">linkCode</span>: <span class="hljs-string">''</span>,
                <span class="hljs-attr">linkName</span>: <span class="hljs-string">''</span>,
            &#125;,
            &#123;
                <span class="hljs-attr">url</span>: <span class="hljs-string">''</span>,
                <span class="hljs-attr">title</span>: <span class="hljs-string">'导航二'</span>,
                <span class="hljs-attr">linkCode</span>: <span class="hljs-string">''</span>,
                <span class="hljs-attr">linkName</span>: <span class="hljs-string">''</span>,
            &#125;,
            &#123;
                <span class="hljs-attr">url</span>: <span class="hljs-string">''</span>,
                <span class="hljs-attr">title</span>: <span class="hljs-string">'导航三'</span>,
                <span class="hljs-attr">linkCode</span>: <span class="hljs-string">''</span>,
                <span class="hljs-attr">linkName</span>: <span class="hljs-string">''</span>,
            &#125;,
            &#123;
                <span class="hljs-attr">url</span>: <span class="hljs-string">''</span>,
                <span class="hljs-attr">title</span>: <span class="hljs-string">'导航四'</span>,
                <span class="hljs-attr">linkCode</span>: <span class="hljs-string">''</span>,
                <span class="hljs-attr">linkName</span>: <span class="hljs-string">''</span>,
            &#125;,
            &#123;
                <span class="hljs-attr">id</span>: uuid(),
                <span class="hljs-attr">url</span>: <span class="hljs-string">''</span>,
                <span class="hljs-attr">title</span>: <span class="hljs-string">'导航五'</span>,
                <span class="hljs-attr">linkCode</span>: <span class="hljs-string">''</span>,
                <span class="hljs-attr">linkName</span>: <span class="hljs-string">''</span>,
            &#125;,
        ],
        <span class="hljs-attr">style</span>: &#123;
            <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'#FFFFFF'</span>,
            <span class="hljs-attr">color</span>: <span class="hljs-string">'#333333'</span>,
        &#125;,
    &#125;,
&#125;,
<span class="hljs-comment">// 魔方</span>
&#123;
    <span class="hljs-attr">component</span>: <span class="hljs-string">'Cube'</span>,
    <span class="hljs-attr">options</span>: &#123;
        <span class="hljs-attr">template</span>: <span class="hljs-string">'row-one'</span>, <span class="hljs-comment">// row-one：一行一个 row-two：一行两个 row-four：一行四个 row-col：一大两小</span>
        <span class="hljs-attr">image</span>: [
            &#123;
                <span class="hljs-attr">url</span>: <span class="hljs-string">''</span>,
                <span class="hljs-attr">linkType</span>: <span class="hljs-string">''</span>,
                <span class="hljs-attr">linkName</span>: <span class="hljs-string">''</span>,
            &#125;,
        ],
        <span class="hljs-attr">imageMargin</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">layoutMargin</span>: <span class="hljs-number">0</span>,
    &#125;,
&#125;,
<span class="hljs-comment">// 定位菜单</span>
&#123;
    <span class="hljs-attr">component</span>: <span class="hljs-string">'PositionMenu'</span>,
    <span class="hljs-attr">data</span>: [], <span class="hljs-comment">// 分组信息</span>
    <span class="hljs-attr">options</span>: &#123;
        <span class="hljs-attr">template</span>: <span class="hljs-string">'tab-style-one'</span>, <span class="hljs-comment">// tab-style-one：样式1 tab-style-two：样式2 tab-style-three：样式3</span>
        <span class="hljs-attr">data</span>: [
            &#123;
                <span class="hljs-attr">id</span>: <span class="hljs-string">'9b1deb4d-3b7d-4bad-9bdd-2b0d7b3dcb6d'</span>,
                <span class="hljs-attr">code</span>: <span class="hljs-string">''</span>,
                <span class="hljs-attr">name</span>: <span class="hljs-string">''</span>,
                <span class="hljs-attr">menuName</span>: <span class="hljs-string">''</span>,
                <span class="hljs-attr">comsize</span>: <span class="hljs-number">6</span>,
            &#125;,
            &#123;
                <span class="hljs-attr">id</span>: <span class="hljs-string">'9b1deb4d-3b7d-4bad-9bdd-2b0d7b3dcb6c'</span>,
                <span class="hljs-attr">code</span>: <span class="hljs-string">''</span>,
                <span class="hljs-attr">name</span>: <span class="hljs-string">''</span>,
                <span class="hljs-attr">menuName</span>: <span class="hljs-string">''</span>,
                <span class="hljs-attr">comsize</span>: <span class="hljs-number">6</span>,
            &#125;,
        ],
        <span class="hljs-attr">style</span>: &#123;
            <span class="hljs-attr">borderRadius</span>: <span class="hljs-string">'none'</span>,
            <span class="hljs-attr">fontWeight</span>: <span class="hljs-string">'400'</span>,
            <span class="hljs-attr">paddingLeft</span>: <span class="hljs-string">'5px'</span>,
            <span class="hljs-attr">paddingRight</span>: <span class="hljs-string">'5px'</span>,
        &#125;,
        <span class="hljs-attr">listStyle</span>: <span class="hljs-string">'row-one'</span>, <span class="hljs-comment">// row-one：大图模式 row-two：一行两个 row-three：一行三个 row-col：详细列表</span>
        <span class="hljs-attr">commodityStyle</span>: <span class="hljs-string">'no-border'</span>, <span class="hljs-comment">// no-border：无边白底 shadow：卡片投影 stroke：描边白底 transparent：无边透明底</span>
        <span class="hljs-attr">commodityName</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 商品名称</span>
        <span class="hljs-attr">commodityDesc</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 商品描述</span>
        <span class="hljs-attr">commodityPrice</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 商品价格</span>
        <span class="hljs-attr">originalPrice</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 划线价格</span>
        <span class="hljs-attr">buyButton</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 购买按钮</span>
        <span class="hljs-attr">buyButtonStyle</span>: <span class="hljs-string">'style-1'</span>, <span class="hljs-comment">// 购买按钮样式</span>
        <span class="hljs-attr">buyButtonText</span>: <span class="hljs-string">'马上抢'</span>, <span class="hljs-comment">// 购买按钮文字</span>
        <span class="hljs-attr">commoditySubscript</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 商品角标</span>
        <span class="hljs-attr">commoditySubscriptStyle</span>: <span class="hljs-string">'new'</span>, <span class="hljs-comment">// 商品角标样式</span>
    &#125;,
&#125;,
<span class="hljs-comment">// 普通商品</span>
&#123;
    <span class="hljs-attr">component</span>: <span class="hljs-string">'Goods'</span>,
    <span class="hljs-attr">data</span>: [], <span class="hljs-comment">// 商品信息</span>
    <span class="hljs-attr">options</span>: &#123;
        <span class="hljs-attr">template</span>: <span class="hljs-string">'large'</span>, <span class="hljs-comment">// large：大图模式 small：一行两个 three：一行三个 list：详细列表</span>
        <span class="hljs-attr">data</span>: [], <span class="hljs-comment">// 商品信息</span>
        <span class="hljs-attr">style</span>: &#123;
            <span class="hljs-attr">borderRadius</span>: <span class="hljs-string">'none'</span>,
            <span class="hljs-attr">fontWeight</span>: <span class="hljs-string">'400'</span>,
            <span class="hljs-attr">paddingLeft</span>: <span class="hljs-string">'5px'</span>,
            <span class="hljs-attr">paddingRight</span>: <span class="hljs-string">'5px'</span>,
        &#125;,
        <span class="hljs-attr">listStyle</span>: <span class="hljs-string">'row-one'</span>, <span class="hljs-comment">// row-one：大图模式 row-two：一行两个 row-three：一行三个 row-col：详细列表</span>
        <span class="hljs-attr">commodityStyle</span>: <span class="hljs-string">'no-border'</span>, <span class="hljs-comment">// no-border：无边白底 shadow：卡片投影 stroke：描边白底 transparent：无边透明底</span>
        <span class="hljs-attr">commodityName</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 商品名称</span>
        <span class="hljs-attr">commodityDesc</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 商品描述</span>
        <span class="hljs-attr">commodityPrice</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 商品价格</span>
        <span class="hljs-attr">originalPrice</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 划线价格</span>
        <span class="hljs-attr">buyButton</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 购买按钮</span>
        <span class="hljs-attr">buyButtonStyle</span>: <span class="hljs-string">'style-1'</span>, <span class="hljs-comment">// 购买按钮样式</span>
        <span class="hljs-attr">buyButtonText</span>: <span class="hljs-string">'马上抢'</span>, <span class="hljs-comment">// 购买按钮文字</span>
        <span class="hljs-attr">commoditySubscript</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 商品角标</span>
        <span class="hljs-attr">commoditySubscriptStyle</span>: <span class="hljs-string">'new'</span>, <span class="hljs-comment">// 商品角标样式</span>
    &#125;,
&#125;,
<span class="hljs-comment">// 限时折扣</span>
&#123;
    <span class="hljs-attr">template</span>: <span class="hljs-string">'row-one'</span>,
    <span class="hljs-attr">data</span>: [],
    <span class="hljs-attr">style</span>: &#123;
        <span class="hljs-attr">borderRadius</span>: <span class="hljs-string">'none'</span>,
        <span class="hljs-attr">fontWeight</span>: <span class="hljs-string">'400'</span>,
        <span class="hljs-attr">padding</span>: <span class="hljs-string">'0'</span>,
        <span class="hljs-attr">margin</span>: <span class="hljs-string">'0'</span>,
    &#125;,
    <span class="hljs-attr">comsize</span>: <span class="hljs-number">10</span>,
    <span class="hljs-attr">tag</span>: <span class="hljs-string">'限时折扣'</span>,
    <span class="hljs-attr">commodityStyle</span>: <span class="hljs-string">'no-border'</span>,
    <span class="hljs-attr">commodityName</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">commodityDesc</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">commodityPrice</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">originalPrice</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">lastStock</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">countdown</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">progressBar</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">buyButton</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">buyButtonStyle</span>: <span class="hljs-string">'style-1'</span>,
    <span class="hljs-attr">buyButtonText</span>: <span class="hljs-string">'即将开抢'</span>,
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<h2 data-id="heading-3">拖拽</h2>
<p>拖拽依赖第三方库<a href="https://react-dnd.github.io/react-dnd/about" target="_blank" rel="nofollow noopener noreferrer">react-dnd</a>，提供的Hooks Api特别方便，上面的设计结构图 <strong>Component</strong>组件(DragSource) 和 <strong>Preview</strong>组件(DropTarget) 用到了拖拽，<strong>Preview</strong>组件不仅要支持上下拖拽，而且需要配合<strong>Compiler</strong>组件联动。</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-comment">/*
 * @description: DragSource 拖动组件
 * @version: 分支号 20210629
 * @author: xuchao
 */</span>
<span class="hljs-keyword">import</span> React, &#123; useContext &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> &#123; useDrag &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dnd'</span>;
<span class="hljs-keyword">import</span> &#123; findIndex, some, isUndefined, filter &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'lodash'</span>;
<span class="hljs-keyword">import</span> &#123; v1 <span class="hljs-keyword">as</span> uuid &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'uuid'</span>;
<span class="hljs-keyword">import</span> &#123; DecorateContext &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'../../utilities'</span>;
<span class="hljs-keyword">import</span> schema <span class="hljs-keyword">from</span> <span class="hljs-string">'../Materials/schema'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> (&#123; component, name, icon, max, componentType, fixedIndex &#125;) => &#123;
    <span class="hljs-keyword">const</span> &#123; previewData = [], setState &#125; = useContext(DecorateContext);
    <span class="hljs-keyword">const</span> number = filter(previewData, &#123; component &#125;).length;

    <span class="hljs-keyword">const</span> [, drag] = useDrag(
        <span class="hljs-function">() =></span> (&#123;
            <span class="hljs-attr">type</span>: <span class="hljs-string">'component'</span>,
            <span class="hljs-attr">options</span>: &#123;
                <span class="hljs-attr">dropEffect</span>: <span class="hljs-string">'copy'</span>,
            &#125;,
            <span class="hljs-attr">item</span>: &#123;
                <span class="hljs-attr">type</span>: <span class="hljs-string">'add'</span>,
                component,
                name,
                max,
                componentType,
                fixedIndex,
            &#125;,
            <span class="hljs-attr">end</span>: <span class="hljs-function">(<span class="hljs-params">item, monitor</span>) =></span> &#123;
                <span class="hljs-keyword">const</span> hasPh = some(previewData, &#123; <span class="hljs-attr">component</span>: <span class="hljs-string">'placeholder'</span> &#125;);
                <span class="hljs-keyword">const</span> phIndex = findIndex(previewData, &#123; <span class="hljs-attr">component</span>: <span class="hljs-string">'placeholder'</span> &#125;);

                <span class="hljs-keyword">if</span> (!hasPh) <span class="hljs-keyword">return</span>;

                <span class="hljs-comment">// 组件放置已达上限</span>
                <span class="hljs-keyword">if</span> (number === max) &#123;
                    previewData.splice(phIndex, <span class="hljs-number">1</span>);

                    setState(&#123; <span class="hljs-attr">previewData</span>: [...previewData] &#125;);

                    <span class="hljs-keyword">return</span>;
                &#125;

                <span class="hljs-keyword">if</span> (monitor.didDrop()) &#123;
                    <span class="hljs-comment">// 判断拖拽放入Preview组件中，占位元素替换成组件元素</span>
                    previewData.splice(phIndex, <span class="hljs-number">1</span>, &#123;
                        <span class="hljs-attr">id</span>: uuid(),
                        <span class="hljs-attr">component</span>: item.component,
                        <span class="hljs-attr">options</span>: schema[component].defaultOptions,
                    &#125;);
                &#125; <span class="hljs-keyword">else</span> &#123;
                    <span class="hljs-comment">// 判断拖拽没有放入Preview组件中，删除占位元素</span>
                    previewData.splice(phIndex, <span class="hljs-number">1</span>);
                &#125;

                setState(&#123;
                    <span class="hljs-attr">previewData</span>: [...previewData],
                    <span class="hljs-attr">selectIndex</span>: phIndex,
                    <span class="hljs-attr">compiler</span>: item.component,
                &#125;);
            &#125;,
        &#125;),
        [previewData],
    );

    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@description</span>: 新增组件
     * <span class="hljs-doctag">@author</span>: xuchao
     */</span>
    <span class="hljs-keyword">const</span> handleClick = <span class="hljs-function">() =></span> &#123;
        <span class="hljs-keyword">if</span> (number === max) <span class="hljs-keyword">return</span>;

        previewData.splice(!isUndefined(fixedIndex) ? fixedIndex : previewData.length, <span class="hljs-number">0</span>, &#123;
            <span class="hljs-attr">id</span>: uuid(),
            component,
            <span class="hljs-attr">options</span>: schema[component].defaultOptions,
        &#125;);

        setState(&#123;
            <span class="hljs-attr">previewData</span>: [...previewData],
            <span class="hljs-attr">selectIndex</span>: !isUndefined(fixedIndex) ? fixedIndex : previewData.length - <span class="hljs-number">1</span>,
            <span class="hljs-attr">compiler</span>: component,
        &#125;);
    &#125;;

    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag"><<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;drag&#125;</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"item"</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span>></span>
            <span class="hljs-tag"><<span class="hljs-name">i</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#123;icon&#125;</span>></span><span class="hljs-tag"></<span class="hljs-name">i</span>></span>
            <span class="hljs-tag"><<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"name"</span>></span>&#123;name&#125;<span class="hljs-tag"></<span class="hljs-name">div</span>></span>
            <span class="hljs-tag"><<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"number"</span>></span>
                &#123;number&#125;/&#123;max&#125;
            <span class="hljs-tag"></<span class="hljs-name">div</span>></span>
        <span class="hljs-tag"></<span class="hljs-name">div</span>></span></span>
    );
&#125;;
<span class="copy-code-btn">复制代码</span></code></pre>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-comment">/*
 * @description: DropTarget 放置组件
 * @version: 分支号 20210629
 * @author: xuchao
 */</span>
<span class="hljs-keyword">import</span> React, &#123; useContext, useCallback &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> &#123; useDrop &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dnd'</span>;
<span class="hljs-keyword">import</span> &#123; findIndex, some, isUndefined, filter &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'lodash'</span>;
<span class="hljs-keyword">import</span> update <span class="hljs-keyword">from</span> <span class="hljs-string">'immutability-helper'</span>;
<span class="hljs-keyword">import</span> &#123; DecorateContext &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'../../utilities'</span>;
<span class="hljs-keyword">import</span> Item <span class="hljs-keyword">from</span> <span class="hljs-string">'./Item'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> () => &#123;
    <span class="hljs-keyword">const</span> &#123; previewData = [], selectIndex, setState &#125; = useContext(DecorateContext);

    <span class="hljs-keyword">const</span> [, drop] = useDrop(
        <span class="hljs-function">() =></span> (&#123;
            <span class="hljs-attr">accept</span>: <span class="hljs-string">'component'</span>,
            <span class="hljs-attr">hover</span>: <span class="hljs-function"><span class="hljs-params">item</span> =></span> &#123;
                <span class="hljs-keyword">const</span> limit = filter(previewData, &#123; <span class="hljs-attr">component</span>: item.component &#125;).length;
                <span class="hljs-keyword">const</span> hasPh = some(previewData, &#123; <span class="hljs-attr">component</span>: <span class="hljs-string">'placeholder'</span> &#125;);
                <span class="hljs-keyword">const</span> spliceIndex = !isUndefined(item.fixedIndex)
                    ? item.fixedIndex
                    : previewData.length;

                <span class="hljs-keyword">if</span> (item.type === <span class="hljs-string">'add'</span> && !hasPh) &#123;
                    <span class="hljs-comment">// 判断占位符是否已经存在，若悬停空白处，插入占位符</span>
                    previewData.splice(spliceIndex, <span class="hljs-number">0</span>, &#123;
                        <span class="hljs-attr">component</span>: <span class="hljs-string">'placeholder'</span>,
                        <span class="hljs-attr">limit</span>: item.max === limit ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>,
                    &#125;);

                    setState(&#123; <span class="hljs-attr">previewData</span>: [...previewData] &#125;);
                &#125;
            &#125;,
        &#125;),
        [previewData],
    );

    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@description</span>: move callback
     * <span class="hljs-doctag">@param <span class="hljs-type">&#123;number&#125;</span> <span class="hljs-variable">dragIndex</span></span>
     * <span class="hljs-doctag">@param <span class="hljs-type">&#123;number&#125;</span> <span class="hljs-variable">hoverIndex</span></span>
     * <span class="hljs-doctag">@param <span class="hljs-type">&#123;object&#125;</span> <span class="hljs-variable">item</span></span>
     * <span class="hljs-doctag">@author</span>: xuchao
     */</span>
    <span class="hljs-keyword">const</span> handleMove = useCallback(
        <span class="hljs-function">(<span class="hljs-params">dragIndex, hoverIndex, item</span>) =></span> &#123;
            <span class="hljs-keyword">if</span> (item.type === <span class="hljs-string">'add'</span> && !dragIndex) &#123;
                <span class="hljs-comment">// 判断拖拽是 Component 的组件，则 dragIndex 为 undefined，修改占位符的位置即可</span>
                <span class="hljs-keyword">const</span> limit = filter(previewData, &#123; <span class="hljs-attr">component</span>: item.component &#125;).length;
                <span class="hljs-keyword">const</span> hasPh = some(previewData, &#123; <span class="hljs-attr">component</span>: <span class="hljs-string">'placeholder'</span> &#125;);
                <span class="hljs-keyword">const</span> spliceIndex = !isUndefined(item.fixedIndex) ? item.fixedIndex : hoverIndex;

                <span class="hljs-comment">// 判断占位符是否已经存在，不再重复插入</span>
                <span class="hljs-keyword">if</span> (hasPh) &#123;
                    <span class="hljs-keyword">const</span> phIndex = findIndex(previewData, &#123;
                        <span class="hljs-attr">component</span>: <span class="hljs-string">'placeholder'</span>,
                    &#125;);

                    setState(&#123;
                        <span class="hljs-attr">previewData</span>: update(previewData, &#123;
                            <span class="hljs-attr">$splice</span>: [
                                [phIndex, <span class="hljs-number">1</span>],
                                [
                                    spliceIndex,
                                    <span class="hljs-number">0</span>,
                                    &#123;
                                        <span class="hljs-attr">component</span>: <span class="hljs-string">'placeholder'</span>,
                                        <span class="hljs-attr">limit</span>: item.max === limit ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>,
                                    &#125;,
                                ],
                            ],
                        &#125;),
                    &#125;);

                    <span class="hljs-keyword">return</span>;
                &#125;

                setState(&#123;
                    <span class="hljs-attr">previewData</span>: update(previewData, &#123;
                        <span class="hljs-attr">$splice</span>: [
                            [
                                spliceIndex,
                                <span class="hljs-number">0</span>,
                                &#123;
                                    <span class="hljs-attr">component</span>: <span class="hljs-string">'placeholder'</span>,
                                    <span class="hljs-attr">limit</span>: item.max === limit ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>,
                                &#125;,
                            ],
                        ],
                    &#125;),
                &#125;);
            &#125; <span class="hljs-keyword">else</span> &#123;
                <span class="hljs-comment">// 判断拖拽是 Preview 的组件，则 dragIndex 不为 undefined，替换 dragIndex 和 hoverIndex 位置的元素即可</span>
                setState(&#123;
                    <span class="hljs-attr">previewData</span>: update(previewData, &#123;
                        <span class="hljs-attr">$splice</span>: [
                            [dragIndex, <span class="hljs-number">1</span>],
                            [hoverIndex, <span class="hljs-number">0</span>, previewData[dragIndex]],
                        ],
                    &#125;),
                    <span class="hljs-attr">selectIndex</span>: dragIndex === selectIndex ? hoverIndex : dragIndex,
                &#125;);
            &#125;
        &#125;,
        <span class="hljs-comment">// eslint-disable-next-line react-hooks/exhaustive-deps</span>
        [previewData],
    );

    <span class="hljs-comment">/**
     * description: delete callback
     * param &#123;object&#125; event
     * param &#123;number&#125; index
     * author: xuchao
     */</span>
    <span class="hljs-keyword">const</span> handleDelete = <span class="hljs-function">(<span class="hljs-params">event, index</span>) =></span> &#123;
        event.stopPropagation();

        previewData.splice(index, <span class="hljs-number">1</span>);

        setState(&#123;
            <span class="hljs-attr">previewData</span>: [...previewData],
            <span class="hljs-attr">compiler</span>: selectIndex === previewData.length ? <span class="hljs-literal">undefined</span> : previewData[index].compiler,
        &#125;);
    &#125;;

    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag"><<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;drop&#125;</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"content"</span>></span>
            &#123;previewData.map((item, index) => &#123;
                return (
                    <span class="hljs-tag"><<span class="hljs-name">Item</span>
                        <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;item.id&#125;</span>
                        <span class="hljs-attr">index</span>=<span class="hljs-string">&#123;index&#125;</span>
                        <span class="hljs-attr">selectIndex</span>=<span class="hljs-string">&#123;selectIndex&#125;</span>
                        &#123;<span class="hljs-attr">...item</span>&#125;
                        <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;()</span> =></span> setState(&#123; selectIndex: index, compiler: item.component &#125;)&#125;
                        onMove=&#123;handleMove&#125;
                        onDelete=&#123;handleDelete&#125;
                    />
                );
            &#125;)&#125;
        <span class="hljs-tag"></<span class="hljs-name">div</span>></span></span>
    );
&#125;;
<span class="copy-code-btn">复制代码</span></code></pre>
<h1 data-id="heading-4">总结</h1>
<p>开发耗费时间比较长的地方是怎么设计与移动端同步数据和拖拽功能，最后还是迎刃而解。如果大家有什么疑问可以交流一下🤝</p></div>  
</div>
            