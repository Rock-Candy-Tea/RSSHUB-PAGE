
---
title: '带你探索神秘的_幽灵空白节点_'
categories: 
 - 编程
 - 掘金
 - 分类
headimg: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5f73382a85c94a52904274658a1746ab~tplv-k3u1fbpfcp-zoom-1.image'
author: 掘金
comments: false
date: Mon, 19 Jul 2021 00:46:45 GMT
thumbnail: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5f73382a85c94a52904274658a1746ab~tplv-k3u1fbpfcp-zoom-1.image'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><p>在日常开发编写 CSS 代码的时候，时常会遇到一些奇怪的现象。比如以下几个场景</p>
<div align="center">
    <img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5f73382a85c94a52904274658a1746ab~tplv-k3u1fbpfcp-zoom-1.image" loading="lazy" referrerpolicy="no-referrer">
    <div align="center">图1</div>
</div>
<div align="center">
    <img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3fec0ee7ab8c4f5d8f49f09a1480f395~tplv-k3u1fbpfcp-zoom-1.image" loading="lazy" referrerpolicy="no-referrer">
    <div align="center">图2</div>
</div>
<p>图 1 中，图片下面为什么会出现一段空白高度？ 在我们正常的认知中，块级元素的<code>height</code>在不设置具体值的时候，默认为<code>0</code>，高度靠内容撑开。图 2 中<code><div></code>标签的<code>22px</code>的高度是哪里来的？这究竟是 html 的标签的扭曲，还是 css 属性的沦丧？接下来就让我们一起去揭开这“幽灵空白节点”背后的秘密。</p>
<h3 data-id="heading-0">前情提要</h3>
<p>首先我们需要了解一个概念，叫做基线，在所有内联相关模型中，凡是涉及到垂直方向的排版或者对齐的，都离不开最最基本的基线（base-line），那么基线是怎么定义的呢？在维基百科中有这么一个示意图:</p>
<div align="center">
    <img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/32a0a7d238fa4a0cbca850e71e227e82~tplv-k3u1fbpfcp-zoom-1.image" loading="lazy" referrerpolicy="no-referrer">
    <div align="center">图3</div>
</div>
<p>根据图片中标示，字母 x 的下边缘（线）就是基线。</p>
<p>在 CSS 中有两个重要属性，<code>line-height</code>和<code>vertical-align</code>都与基线有关，<code>line-height</code>行高的定义就是两个基线之间的距离，<code>vertical-align</code>的默认值就<code>baseline</code>，也就是基线对齐。对于内联元素，我们要认识到，虽然<code>vertical-align</code>与<code>line-height</code>看不见，但实际上<strong>到处都是</strong>！</p>
<p>那么标签元素的基线如何确认呢？在 CSS2 的可视化格式模型文档中有这样一段话：</p>
<blockquote>
<p>The baseline of an ‘inline-block’ is the baseline of its last line box in the normal flow, unless it has either no in-flow line boxes or if its ‘overflow’ property has a computed value other than ‘visible’, in which case the baseline is the bottom margin edge.”</p>
</blockquote>
<p>也就是说：一个<code>inline-block</code>元素，如果里面没有<code>inline</code>内联元素，或者<code>overflow</code>不是<code>visible</code>，则该元素的基线就是其<code>margin</code>底边缘，否则，其基线就是元素里面最后一行内联元素的基线。</p>
<p>其次我们还需要理解一个概念叫做<code>line boxes</code>模型，下面是一段简单的代码：</p>
<pre><code class="hljs language-html copyable" lang="html"> <span class="hljs-tag"><<span class="hljs-name">p</span>></span>这是一行普通的文字，这里有个 <span class="hljs-tag"><<span class="hljs-name">em</span>></span>em<span class="hljs-tag"></<span class="hljs-name">em</span>></span> 标签。<span class="hljs-tag"></<span class="hljs-name">p</span>></span>
<span class="copy-code-btn">复制代码</span></code></pre>
<p>在这段代码中涉及到 4 个<code>boxes</code>：</p>
<ul>
<li>
<p>1、首先是<code><p></code>标签所在的<code>containing block</code>（包含块）</p>
</li>
<li>
<p>2、然后是<code>inline box</code>（内联盒子），如下图标注，<code>inline boxes</code>不会让内容成块显示，而是排成一行</p>
</li>
</ul>
<div align="center">
    <img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/68db720a805e4593a04566dda6462405~tplv-k3u1fbpfcp-zoom-1.image" loading="lazy" referrerpolicy="no-referrer">
    <div align="center">图4</div>
</div>
<ul>
<li>
<p>3、<code>line box</code>（行框盒子)，在<code>containing boxes</code>里面，一个一个的<code>inline boxes</code>组成了<code>line boxes</code>，</p>
</li>
<li>
<p>4、<code>content area</code>（内容区域），内容区域指一种围绕文字看不见的盒子，其大小仅受字符本身特性控制，本质上是一个字符盒子(<code>character box</code>)，但是有些元素，如图片这样的替换元素，其内容显然不是文字，不存在字符盒子之类的，因此，对于这些元素，内容区域可以看成元素自身。</p>
</li>
</ul>
<p>在 line box 模型中，<code>inline boxes</code>的高度直接受<code>line-height</code>控制，而真正的高度表现则是由每行众多的<code>inline boxes</code>（等于内部最高的<code>inline box</code>的高度），而这些<code>line boxes</code>的高度垂直堆叠形成了<code>containing box</code>的高度，也就是我们见到的<code><p></code>或者<code><div></code>标签的高度。</p>
<h3 data-id="heading-1">寻找“幽灵空白节点”</h3>
<p>我们对图 1 中的代码稍作修改，如下：</p>
<div align="center">
    <img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3e75ddb7a755444389d0386c43baf765~tplv-k3u1fbpfcp-zoom-1.image" loading="lazy" referrerpolicy="no-referrer">
    <div align="center">图5</div>
</div>
<p>对于内联元素，<code>vertical-align</code>的默认值是<code>baseline</code>，也就是基线对齐，所以我们看到<code><div></code>标签中图片和<code>span</code>中的元素都是以字母<code>x</code>的下边缘对齐的</p>
<div align="center">
    <img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7598125ff7f84a43abac3396139d7582~tplv-k3u1fbpfcp-zoom-1.image" loading="lazy" referrerpolicy="no-referrer">
    <div align="center">图6</div>
</div>
<p>字符 x 的自身是有高度的（由 font-size 属性决定）</p>
<div align="center">
    <img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1b2c83aa3dcb4e04b9e005914622bf88~tplv-k3u1fbpfcp-zoom-1.image" loading="lazy" referrerpolicy="no-referrer">
    <div align="center">图7</div>
</div>
<p>视图中<code>sxx</code>行框盒子的高度由<code>line-height</code>属性决定。</p>
<p>根据上面三次改动，我们可以发现，由于<code>vertical-align</code>的默认对齐属性和<code>line-height</code>导致图片需要和其他元素对齐时会导致出现图片下面的空隙。可是在图 1 中，<code><div></code>中只有<code><img></code>一个标签，却依然会出现底部的空隙，它是究竟在和谁对齐呢？所谓的“幽灵空白节点”究竟藏在了哪里？</p>
<p>莫着急，我们继续看 2 中的代码，并对其进行修改，如下图：</p>
<div align="center">
    <img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2899bfecf80d4a909fe19735108281e3~tplv-k3u1fbpfcp-zoom-1.image" loading="lazy" referrerpolicy="no-referrer">
    <div align="center">图8</div>
</div>
<div align="center">
    <img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f173815816294ab09cb71d886790bfa2~tplv-k3u1fbpfcp-zoom-1.image" loading="lazy" referrerpolicy="no-referrer">
    <div align="center">图9</div>
</div>
<div align="center">
    <img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/336939b3b32c44adbb4d8df05cca2ccf~tplv-k3u1fbpfcp-zoom-1.image" loading="lazy" referrerpolicy="no-referrer">
    <div align="center">图10</div>
</div>
<p>对比上面三次代码改动，我们发现，当<code><span></code>中空白并且为<code>inline box</code>的时候，<code>div</code>中似乎依然有一个和类似 x 字符的空白节点，来撑起<code>line box</code>的高度。为了帮助我们理解，在这里我们可以把字符 x 看作为“幽灵空白节点”具像，它不占任何宽度，看不见也无法通过任何方式获取，但又似乎真实存在，它的大小会受<code>font-size</code>的影响。这就是我们一直寻找的“空白幽灵节点”。虽然隐藏的这么深，还是被我们一步一步给找了出来。</p>
<h3 data-id="heading-2">认识“幽灵空白节点”</h3>
<p>在 HTML5 规范中有这样一句话：</p>
<blockquote>
<p>"Each line box starts with a zero-width inline box with the element's font and line height properties. We call that imaginary box a 'strut'."</p>
<p>每个行框盒子都以一个具有元素的字体和行高属性的零宽度行内框开始。我们称这个假想的盒子为"支柱"。</p>
</blockquote>
<p>在<strong>HTML5 文档声明</strong>中，内联元素的所有解析和渲染表现就如同每个行框盒子的前面有一个“空白节点”一样。这个“空白节点”永远透明，不占据任何宽度，看不见也无法通过脚本获取，就好像幽灵一样，但又确确实实地存在，表现如同文本节点一样，因此，在张鑫旭大佬的《CSS 世界》一书中根据特点，将其称之为“幽灵空白节点”，也就是官方规范中的“<code>strut</code>”。</p>
<h3 data-id="heading-3">消除“幽灵空白节点”的影响</h3>
<p>终于找到并认识了“幽灵空白节点”，那么对于这种无法获取却又真实影响我们样式的“节点”，我们应该如何消除它带来的影响？</p>
<ul>
<li>1、让<code>vertical-align</code>失效：<code>vertical-align</code>属性对于块级元素是无感的，因此我们只需要为元素设置<code>dispaly</code>为<code>block</code>即可;</li>
<li>2、修改<code>vertical-align</code>属性值：修改其默认值<code>baseline</code>值为其他属性值，使其不再相对基线对齐;</li>
<li>3、修改<code>line-height</code>的值：上面我们说过<code>line-height</code>的定义是两基线之间的距离，因此在上面例子中，图片下面的空隙，实际上是“幽灵空白节点”计算后的行高值和基线的距离，因此，只要<code>line-height</code>足够小，便可以消除图片下面的空隙。（注意这里是要在<code>div</code>上设置<code>line-heght</code>，然后让<code>div</code>的<code>inline boxes</code>继承<code>line-height</code>属性）</li>
</ul>
<h3 data-id="heading-4">结束语</h3>
<p>CSS 世界看似简单，却隐藏了无数“奥秘”，在工作学习的过程中，去发现挖掘其中的奥秘，不仅可以让我们对其认知更加清晰，同时在我们编程的过程中可以更灵活的使用 CSS 去丰富我们的页面，让我们的页面更加血肉丰满，呈现更多的精彩。</p></div>  
</div>
            