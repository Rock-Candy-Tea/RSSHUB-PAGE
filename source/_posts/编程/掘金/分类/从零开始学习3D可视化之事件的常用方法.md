
---
title: '从零开始学习3D可视化之事件的常用方法'
categories: 
 - 编程
 - 掘金
 - 分类
headimg: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fd5535ffdcb04792ae733e9baaaf51f6~tplv-k3u1fbpfcp-zoom-1.image'
author: 掘金
comments: false
date: Wed, 30 Jun 2021 21:53:13 GMT
thumbnail: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fd5535ffdcb04792ae733e9baaaf51f6~tplv-k3u1fbpfcp-zoom-1.image'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><p>1、 绑定事件并添加条件</p>
<p>2、 同一个事件注册多个回调</p>
<p>3、 tag 标签</p>
<p>4、 设置事件优先级</p>
<p>5、 注册单次事件</p>
<p>事件不会自己执行，需要触发(即事件被触发之后才可执行)。审视任何JavaScript代码的核心，你会发现正是事件是把所有东西融合在一起。下面我学习了一些在数字孪生可视化场景中事件的常用方法。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fd5535ffdcb04792ae733e9baaaf51f6~tplv-k3u1fbpfcp-zoom-1.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<h2 data-id="heading-0">1、 绑定事件并添加条件</h2>
<p>事件添加了条件，只有在符合该条件的数字孪生可视化物体上 click 才会触发，无论是已经存在的 Thing 对象，还是后面新创建的 Thing 对象都会生效。</p>
<pre><code class="copyable">app.on("click", ".Thing", function(ev) &#123;
 console.log("you click " + ev.object.id);
&#125;);
obj.on("click", ".Marker", function(ev) &#123;
 console.log(ev.object.name);
&#125;);
<span class="copy-code-btn">复制代码</span></code></pre>
<p>上面的例子，当这个数字孪生可视化物体子孙里有 Marker 物体，当它被点击就会触发。同全局绑定 Marker 物体，绑定后 obj 的子孙里新创建的 Marker 也响应这个事件。</p>
<h2 data-id="heading-1">2、 同一个事件注册多个回调</h2>
<p>试想一下，如果有一个模块在数字孪生可视化物体 click 时，改变物体颜色，另外一个模块需要在物体 click 时，放大物体。两个模块又是不同人写的，那该如何注册事件呢？</p>
<pre><code class="copyable">// 事件1：
obj.on("click", function(ev) &#123;
 ev.object.style.color = "#FF0000";
&#125;);
// 事件2：
obj.on("click", function(ev) &#123;
 ev.object.scale = [2, 2, 2];
&#125;);
// 卸载 obj 全部的 click 事件
obj.off("click");
<span class="copy-code-btn">复制代码</span></code></pre>
<p>这两个事件，都会在 obj 被点击后触发。但使用 off() 卸载事件时，两个事件都会同时被卸载。因此我更推荐使用[tag]的方式。</p>
<h2 data-id="heading-2">3、 tag 标签</h2>
<p>如果取消或者暂停事件，都要知道原回调函数，在大部分时候会比较麻烦，可以给数字孪生可视化场景中每个事件打上 tag，在删除或者暂停时，可用 tag 直接指定你要操作的回调。</p>
<pre><code class="copyable">//模块1中：
obj.on("click",function(ev) &#123;
 ev.object.style.color = "#FF0000";
&#125;,"模块1");
 
//模块2中：
obj.on("click",function(ev) &#123;
 ev.object.scale = [2, 2, 2];
&#125;,"模块2");
//取消"模块1"的事件回调，不影响“模块2”的回调
obj.off("click",null ,"模块1");
<span class="copy-code-btn">复制代码</span></code></pre>
<h2 data-id="heading-3">4、 设置事件优先级</h2>
<p>两个都是 click 事件，如果希望保证模块 2 的事件先于模块 1 触发，则需要添加一个参数 priority,一般事件默认的优先级是 50，设置的越大，越优先触发。</p>
<pre><code class="copyable">//模块1：
obj.on("click",function(ev) &#123;
 ev.object.style.color = "#FF0000";
&#125;,"模块1");
 
//模块2：
obj.on("click",function(ev) &#123;
 ev.object.scale = [2, 2, 2];
&#125;,"模块2",51);
<span class="copy-code-btn">复制代码</span></code></pre>
<h3 data-id="heading-4">5、 注册单次事件</h3>
<p>在数字孪生可视化场景中如果需要一个事件只执行一次，就需要卸载掉，你可以使用 one 这个接口代替 on，参数和 on 是一样的。</p>
<p>提供 priority 的能力：</p>
<pre><code class="copyable">// 下例中是给每个楼层的注册了一次 EnterLevel 事件，即 每个楼层第一次进入时 都会响应
app.one(THING.EventType.EnterLevel, '.Floor', function (ev) &#123;
 console.log(ev.object.id);
&#125;)
 
// 如果只给某个楼层注册 如下
var floor = app.query('.Floor')[0];
floor.one(THING.EventType.EnterLevel, function (ev) &#123;
 console.log(ev.object.id);
&#125;)
<span class="copy-code-btn">复制代码</span></code></pre>
<p>—————————————————</p>
<p>数字孪生可视化：thingjs.com/</p></div>  
</div>
            