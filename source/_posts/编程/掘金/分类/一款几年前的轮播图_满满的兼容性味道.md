
---
title: '一款几年前的轮播图_满满的兼容性味道'
categories: 
 - 编程
 - 掘金
 - 分类
headimg: 'https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/084df3f2aa1442a09aa4df3e5beeedf0~tplv-k3u1fbpfcp-watermark.image'
author: 掘金
comments: false
date: Wed, 30 Jun 2021 00:16:34 GMT
thumbnail: 'https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/084df3f2aa1442a09aa4df3e5beeedf0~tplv-k3u1fbpfcp-watermark.image'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><p>最近整理电脑偶然发现自己几年前的学习笔记，那时我才是刚入前端不久，每当看到新奇的js效果都忍不住惊叹，记得当时写过很多的练习作品，现在大多尘封在我的D盘，和岛国爱情片共享天伦之乐。</p>
<p>这是一个当年很流行的js轮播效果，那时候css3.0还不允许用，所以动画都是采用js的setTimeout来写的。</p>
<p>默认效果长这样，图片如有侵权请联系，立即就删。</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/084df3f2aa1442a09aa4df3e5beeedf0~tplv-k3u1fbpfcp-watermark.image" alt="屏幕快照 2021-06-30 15.39.33.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>滚动效果是这个样子的，现在看起来好像也挺好看的。</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/68f8e8fafe794f32807a3054df982602~tplv-k3u1fbpfcp-watermark.image" alt="未命名.gif" loading="lazy" referrerpolicy="no-referrer"></p>
<p>记得去年好像在酷我音乐里面还见到了这样的滚动效果。</p>
<p>页面的布局很简单，一个div里面包裹了要滚动的内容和向前向后的操作按钮。由于刚学前端还不懂什么react，vue，代码都是写死的，写一句手动刷新一下浏览器，手动欢乐。</p>
<pre><code class="hljs language-html copyable" lang="html"><span class="hljs-tag"><<span class="hljs-name">body</span>></span>
<span class="hljs-tag"><<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"content"</span>></span>
<span class="hljs-tag"><<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"prev_div"</span>></span><span class="hljs-tag"></<span class="hljs-name">div</span>></span>
<span class="hljs-tag"><<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"next_div"</span>></span><span class="hljs-tag"></<span class="hljs-name">div</span>></span>
<span class="hljs-tag"><<span class="hljs-name">ul</span>></span>
<span class="hljs-tag"><<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"item_0"</span>></span>
<span class="hljs-tag"><<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://img.zcool.cn/community/01cc635cbdecbca801214168c7fa83.png@1280w_1l_2o_100sh.png"</span>></span>
<span class="hljs-tag"></<span class="hljs-name">li</span>></span>
<span class="hljs-tag"><<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"item_1"</span>></span>
<span class="hljs-tag"><<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://img.zcool.cn/community/018b535cbdecbca801214168fe547d.png@1280w_1l_2o_100sh.png"</span>></span>
<span class="hljs-tag"></<span class="hljs-name">li</span>></span>
<span class="hljs-tag"><<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"item_2"</span>></span>
<span class="hljs-tag"><<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://img.zcool.cn/community/01231d5cbdf17aa801214168294a22.jpg@1280w_1l_2o_100sh.jpg"</span>></span>
<span class="hljs-tag"></<span class="hljs-name">li</span>></span>
<span class="hljs-tag"><<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"item_3"</span>></span>
<span class="hljs-tag"><<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://img.zcool.cn/community/01f4a05cbdecbca8012141689f5b58.png@1280w_1l_2o_100sh.png"</span>></span>
<span class="hljs-tag"></<span class="hljs-name">li</span>></span>
<span class="hljs-tag"><<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"item_4"</span>></span>
<span class="hljs-tag"><<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://img.zcool.cn/community/01df655cbdf29aa801214168b005b6.jpg@1280w_1l_2o_100sh.jpg"</span>></span>
<span class="hljs-tag"></<span class="hljs-name">li</span>></span>
<span class="hljs-tag"><<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"item_5"</span>></span>
<span class="hljs-tag"><<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://img.zcool.cn/community/0166c35cbdf29ba801208f8ba065df.jpg@1280w_1l_2o_100sh.jpg"</span>></span>
<span class="hljs-tag"></<span class="hljs-name">li</span>></span>
<span class="hljs-tag"><<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"item_6"</span>></span>
<span class="hljs-tag"><<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://img.zcool.cn/community/013cdc5cbdecbda801208f8bc572cc.png@1280w_1l_2o_100sh.png"</span>></span>
<span class="hljs-tag"></<span class="hljs-name">li</span>></span>
<span class="hljs-tag"></<span class="hljs-name">ul</span>></span>
<span class="hljs-tag"></<span class="hljs-name">div</span>></span>
<span class="hljs-tag"></<span class="hljs-name">body</span>></span>
<span class="copy-code-btn">复制代码</span></code></pre>
<p>style样式也是随手就写，哪天什么less，sass。第一句肯定是这个。先重置样式</p>
<pre><code class="hljs language-css copyable" lang="css"><span class="hljs-selector-tag">html</span>, <span class="hljs-selector-tag">body</span>, <span class="hljs-selector-tag">ul</span>, <span class="hljs-selector-tag">li</span>, <span class="hljs-selector-tag">img</span>, <span class="hljs-selector-tag">a</span>, <span class="hljs-selector-tag">p</span> &#123; <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>; &#125;
<span class="hljs-selector-tag">li</span> &#123; <span class="hljs-attribute">list-style</span>: none; &#125;
<span class="hljs-selector-tag">img</span> &#123; <span class="hljs-attribute">border</span>: none; <span class="hljs-attribute">width</span>: <span class="hljs-number">680px</span>; <span class="hljs-attribute">height</span>: <span class="hljs-number">344px</span>;&#125;
<span class="hljs-selector-tag">body</span> &#123; <span class="hljs-attribute">background</span>: <span class="hljs-number">#ececec</span>; <span class="hljs-attribute">padding-top</span>: <span class="hljs-number">50px</span>; &#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>然后样式都是手动一级一级的向后写，最多的时候能写个五六级，而且特别容易出错，莫名其妙样式就被覆盖了。</p>
<pre><code class="hljs language-css copyable" lang="css"><span class="hljs-selector-id">#content</span> &#123; <span class="hljs-attribute">width</span>: <span class="hljs-number">970px</span>; <span class="hljs-attribute">height</span>: <span class="hljs-number">344px</span>; <span class="hljs-attribute">position</span>: relative; <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto; <span class="hljs-attribute">overflow</span>: hidden; &#125;

<span class="hljs-selector-class">.prev_div</span> &#123; <span class="hljs-attribute">width</span>: <span class="hljs-number">130px</span>; <span class="hljs-attribute">height</span>: <span class="hljs-number">72px</span>; <span class="hljs-attribute">position</span>: absolute; <span class="hljs-attribute">top</span>: <span class="hljs-number">128px</span>; <span class="hljs-attribute">left</span>: <span class="hljs-number">92px</span>; <span class="hljs-attribute">z-index</span>: <span class="hljs-number">5</span>; <span class="hljs-attribute">background</span>: red; <span class="hljs-attribute">filter</span>: <span class="hljs-built_in">alpha</span>(opacity=<span class="hljs-number">0</span>); <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">cursor</span>: pointer; &#125;
<span class="hljs-selector-class">.next_div</span> &#123; <span class="hljs-attribute">width</span>: <span class="hljs-number">130px</span>; <span class="hljs-attribute">height</span>: <span class="hljs-number">72px</span>; <span class="hljs-attribute">position</span>: absolute; <span class="hljs-attribute">top</span>: <span class="hljs-number">128px</span>; <span class="hljs-attribute">right</span>: <span class="hljs-number">92px</span>; <span class="hljs-attribute">z-index</span>: <span class="hljs-number">5</span>; <span class="hljs-attribute">background</span>: red; <span class="hljs-attribute">filter</span>: <span class="hljs-built_in">alpha</span>(opacity=<span class="hljs-number">0</span>); <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">cursor</span>: pointer; &#125;

<span class="hljs-selector-id">#content</span> <span class="hljs-selector-tag">ul</span> &#123; <span class="hljs-attribute">width</span>: <span class="hljs-number">970px</span>; <span class="hljs-attribute">height</span>: <span class="hljs-number">344px</span>; <span class="hljs-attribute">position</span>: absolute; <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">z-index</span>: <span class="hljs-number">1</span>; &#125;
<span class="hljs-selector-id">#content</span> <span class="hljs-selector-tag">li</span> &#123; <span class="hljs-attribute">position</span>: absolute; &#125;

<span class="hljs-selector-id">#content</span> <span class="hljs-selector-class">.line</span> &#123; <span class="hljs-attribute">border</span>: <span class="hljs-number">4px</span> solid <span class="hljs-number">#fff</span>; <span class="hljs-attribute">width</span>: <span class="hljs-number">672px</span>; <span class="hljs-attribute">height</span>: <span class="hljs-number">336px</span>; <span class="hljs-attribute">position</span>: absolute; <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">left</span>: <span class="hljs-number">50%</span>; <span class="hljs-attribute">margin-left</span>: -<span class="hljs-number">340px</span>; <span class="hljs-attribute">z-index</span>: <span class="hljs-number">3</span>; &#125;

<span class="hljs-selector-id">#content</span> <span class="hljs-selector-class">.item_0</span> &#123; <span class="hljs-attribute">top</span>: -<span class="hljs-number">104px</span>; <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">z-index</span>: <span class="hljs-number">1</span>; <span class="hljs-attribute">filter</span>: <span class="hljs-built_in">alpha</span>(opacity=<span class="hljs-number">0</span>); <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>; &#125;
<span class="hljs-selector-id">#content</span> <span class="hljs-selector-class">.item_1</span> &#123; <span class="hljs-attribute">top</span>: <span class="hljs-number">104px</span>; <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">z-index</span>: <span class="hljs-number">2</span>; <span class="hljs-attribute">filter</span>: <span class="hljs-built_in">alpha</span>(opacity=<span class="hljs-number">60</span>); <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.6</span>; &#125;
<span class="hljs-selector-id">#content</span> <span class="hljs-selector-class">.item_2</span> &#123; <span class="hljs-attribute">top</span>: <span class="hljs-number">43px</span>; <span class="hljs-attribute">left</span>: <span class="hljs-number">50px</span>; <span class="hljs-attribute">z-index</span>: <span class="hljs-number">3</span>; <span class="hljs-attribute">filter</span>: <span class="hljs-built_in">alpha</span>(opacity=<span class="hljs-number">80</span>); <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.8</span>; &#125;
<span class="hljs-selector-id">#content</span> <span class="hljs-selector-class">.item_3</span> &#123; <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">left</span>: <span class="hljs-number">145px</span>; <span class="hljs-attribute">z-index</span>: <span class="hljs-number">4</span>; &#125;
<span class="hljs-selector-id">#content</span> <span class="hljs-selector-class">.item_4</span> &#123; <span class="hljs-attribute">top</span>: <span class="hljs-number">43px</span>; <span class="hljs-attribute">right</span>: <span class="hljs-number">50px</span>; <span class="hljs-attribute">z-index</span>: <span class="hljs-number">3</span>; <span class="hljs-attribute">filter</span>: <span class="hljs-built_in">alpha</span>(opacity=<span class="hljs-number">80</span>); <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.8</span>; &#125;
<span class="hljs-selector-id">#content</span> <span class="hljs-selector-class">.item_5</span> &#123; <span class="hljs-attribute">top</span>: <span class="hljs-number">104px</span>; <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">z-index</span>: <span class="hljs-number">2</span>; <span class="hljs-attribute">filter</span>: <span class="hljs-built_in">alpha</span>(opacity=<span class="hljs-number">60</span>); <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.6</span>; &#125;
<span class="hljs-selector-id">#content</span> <span class="hljs-selector-class">.item_6</span> &#123; <span class="hljs-attribute">top</span>: -<span class="hljs-number">104px</span>; <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">z-index</span>: <span class="hljs-number">1</span>; <span class="hljs-attribute">filter</span>: <span class="hljs-built_in">alpha</span>(opacity=<span class="hljs-number">0</span>); <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>; &#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>细心的你肯定发现了filter: alpha，这还是兼容IE浏览器的代码，我的青春。</p>
<p>接着就是js了，首先第一句就是这个，真的持续了好长一段时间，做梦都是这样写。那时候面试也很喜欢问这个问题，为什么要这么写。</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-built_in">window</span>.onload = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;

&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>onload里面就开始操作dom啦，首先获取左右两个操作按钮，并且给他们绑定事件。对了要用var，哪有什么const和let，必须得是var。</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">var</span> oPrevDiv = <span class="hljs-built_in">document</span>.getElementsByClassName(<span class="hljs-string">'prev_div'</span>)[<span class="hljs-number">0</span>];
<span class="hljs-keyword">var</span> oNextDiv = <span class="hljs-built_in">document</span>.getElementsByClassName(<span class="hljs-string">'next_div'</span>)[<span class="hljs-number">0</span>];
<span class="copy-code-btn">复制代码</span></code></pre>
<p>绑定事件都是这样写的。</p>
<pre><code class="hljs language-js copyable" lang="js">oPrevDiv.onclick = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;  <span class="hljs-comment">//左</span>

&#125;

oNextDiv.onclick = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;  <span class="hljs-comment">//右</span>

&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>这个效果的原理实现起来还是很简单的，这里有六张图片，布局完成之后记住每一张图片的位置数据, 宽高啊，透明度啊，将每一组定义为一个对象存储在数组中。当点击前一张的时候就把数组中的最后一个元素放在数组第一位，点击后一个就把第一个元素放在数组最后一位。</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/084df3f2aa1442a09aa4df3e5beeedf0~tplv-k3u1fbpfcp-watermark.image" alt="屏幕快照 2021-06-30 15.39.33.png" loading="lazy" referrerpolicy="no-referrer"></p>
<p>首先定义一个数组把没涨图片的布局数据存起来。</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-keyword">var</span> aLi = <span class="hljs-built_in">document</span>.getElementsByTagName(<span class="hljs-string">'li'</span>);

<span class="hljs-keyword">var</span> arr = [];

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i < aLi.length; i++) &#123;

    <span class="hljs-keyword">var</span> oImg = aLi[i].getElementsByTagName(<span class="hljs-string">'img'</span>)[<span class="hljs-number">0</span>];

    arr.push([
        <span class="hljs-built_in">parseInt</span>(getStyle(aLi[i], <span class="hljs-string">'left'</span>)),
        <span class="hljs-built_in">parseInt</span>(getStyle(aLi[i], <span class="hljs-string">'top'</span>)), 
        getStyle(aLi[i], <span class="hljs-string">'opacity'</span>) * <span class="hljs-number">100</span>, 
        getStyle(aLi[i], <span class="hljs-string">'zIndex'</span>), 
        oImg.width
    ]);
&#125;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getStyle</span>(<span class="hljs-params">obj, attr</span>) </span>&#123;
    <span class="hljs-keyword">if</span> (obj.currentStyle) &#123;
        <span class="hljs-keyword">return</span> obj.currentStyle[attr];
    &#125;
    <span class="hljs-keyword">else</span> &#123;
        <span class="hljs-keyword">return</span> getComputedStyle(obj, <span class="hljs-literal">false</span>)[attr];
    &#125;
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>getStyle这个封装太有年代感了，DOM编程必备的，之所以封装也是为了解决兼容性问题。</p>
<p>接着点击按钮的时候只需要切换数组中元素的顺序就可以啦。点击想做的时候，将数组的第一个元素放在了数组尾部，并且删除了第一个，来实现交换位置。</p>
<p>然后还得循环来修正每一个标签对应的样式。这里还封装了一个move方法来实现运行效果。那时候基本都是先写代码，写完之后找相似的功能封装函数，再替换，效率真的低。</p>
<pre><code class="hljs language-js copyable" lang="js">oPrevDiv.onclick = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;  <span class="hljs-comment">//左</span>

arr.push(arr[<span class="hljs-number">0</span>]);
arr.shift();

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i < aLi.length; i++) &#123;

<span class="hljs-keyword">var</span> oImg = aLi[i].getElementsByTagName(<span class="hljs-string">'img'</span>)[<span class="hljs-number">0</span>];
<span class="hljs-comment">// 当前li的index属性修改，index是不支持做动画的。</span>
aLi[i].style.zIndex = arr[i][<span class="hljs-number">3</span>];
<span class="hljs-comment">// 处理</span>
move(aLi[i], &#123; <span class="hljs-attr">left</span>: arr[i][<span class="hljs-number">0</span>], <span class="hljs-attr">top</span>: arr[i][<span class="hljs-number">1</span>], <span class="hljs-attr">opacity</span>: arr[i][<span class="hljs-number">2</span>] &#125;);
<span class="hljs-comment">// 处理img</span>
move(oImg, &#123; <span class="hljs-attr">width</span>: arr[i][<span class="hljs-number">4</span>] &#125;);

&#125;

&#125;;

oNextDiv.onclick = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;  <span class="hljs-comment">//右</span>
arr.unshift(arr[arr.length - <span class="hljs-number">1</span>]);
arr.pop();

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i < aLi.length; i++) &#123;

<span class="hljs-keyword">var</span> oImg = aLi[i].getElementsByTagName(<span class="hljs-string">'img'</span>)[<span class="hljs-number">0</span>];

aLi[i].style.zIndex = arr[i][<span class="hljs-number">3</span>];

move(aLi[i], &#123; <span class="hljs-attr">left</span>: arr[i][<span class="hljs-number">0</span>], <span class="hljs-attr">top</span>: arr[i][<span class="hljs-number">1</span>], <span class="hljs-attr">opacity</span>: arr[i][<span class="hljs-number">2</span>] &#125;);
move(oImg, &#123; <span class="hljs-attr">width</span>: arr[i][<span class="hljs-number">4</span>] &#125;);
&#125;
&#125;;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>move函数接收两个参数，第一个是要操作的DOM元素，第二个是要操作的的属性。</p>
<p>进入函数的时候我们首先会清空一次定时器，避免重复调用，然后再定义一个定时器setInterval，那时候真的很喜欢setInterval直到后来清楚了他的问题才慢慢转向setTimeout, 也没有什么requestAnimationFrame。</p>
<p>定时器里面就是改变每个属性的值，每次改动一点，直到改动完成，通过这样的方式来实现动画。</p>
<pre><code class="hljs language-js copyable" lang="js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">move</span>(<span class="hljs-params">obj, json</span>) </span>&#123;

<span class="hljs-built_in">clearInterval</span>(obj.timer);

obj.timer = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;

<span class="hljs-keyword">var</span> bBtn = <span class="hljs-literal">true</span>;

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> attr <span class="hljs-keyword">in</span> json) &#123;

<span class="hljs-keyword">var</span> iCur = <span class="hljs-number">0</span>;

<span class="hljs-keyword">if</span> (attr == <span class="hljs-string">'opacity'</span>) &#123;
<span class="hljs-keyword">if</span> (<span class="hljs-built_in">Math</span>.round(<span class="hljs-built_in">parseFloat</span>(getStyle(obj, attr)) * <span class="hljs-number">100</span>) == <span class="hljs-number">0</span>) &#123;
iCur = <span class="hljs-built_in">Math</span>.round(<span class="hljs-built_in">parseFloat</span>(getStyle(obj, attr)) * <span class="hljs-number">100</span>);

&#125; <span class="hljs-keyword">else</span> &#123;
iCur = <span class="hljs-built_in">Math</span>.round(<span class="hljs-built_in">parseFloat</span>(getStyle(obj, attr)) * <span class="hljs-number">100</span>) || <span class="hljs-number">100</span>;
&#125;
&#125; <span class="hljs-keyword">else</span> &#123;
iCur = <span class="hljs-built_in">parseInt</span>(getStyle(obj, attr)) || <span class="hljs-number">0</span>;
&#125;

<span class="hljs-keyword">var</span> iSpeed = (json[attr] - iCur) / <span class="hljs-number">8</span>;
iSpeed = iSpeed > <span class="hljs-number">0</span> ? <span class="hljs-built_in">Math</span>.ceil(iSpeed) : <span class="hljs-built_in">Math</span>.floor(iSpeed);
<span class="hljs-keyword">if</span> (iCur != json[attr]) &#123;
bBtn = <span class="hljs-literal">false</span>;
&#125;

<span class="hljs-keyword">if</span> (attr == <span class="hljs-string">'opacity'</span>) &#123;
obj.style.filter = <span class="hljs-string">'alpha(opacity='</span> + (iCur + iSpeed) + <span class="hljs-string">')'</span>;
obj.style.opacity = (iCur + iSpeed) / <span class="hljs-number">100</span>;

&#125; <span class="hljs-keyword">else</span> &#123;
obj.style[attr] = iCur + iSpeed + <span class="hljs-string">'px'</span>;
&#125;
&#125;
<span class="hljs-keyword">if</span> (bBtn) &#123;
<span class="hljs-built_in">clearInterval</span>(obj.timer);
&#125;
&#125;, <span class="hljs-number">30</span>);
&#125;
<span class="copy-code-btn">复制代码</span></code></pre>
<p>move函数是单独写在一个js文件里的，然后在html里面直接script进来，所有的变量都是全局变量才行，不然真的找不到，哈哈哈哈，根本没有什么模块化的概念。</p>
<p>满满的回忆，时间太快了，前端变化也太快了，我的青春啊！</p>
<p>自取链接: <a href="https://github.com/xiaoyindong/demo/tree/main/banner" target="_blank" rel="nofollow noopener noreferrer">github.com/xiaoyindong…</a></p></div>  
</div>
            