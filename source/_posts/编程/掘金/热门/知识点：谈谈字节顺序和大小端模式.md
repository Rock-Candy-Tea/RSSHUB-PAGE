
---
title: '知识点：谈谈字节顺序和大小端模式'
categories: 
 - 编程
 - 掘金
 - 热门
headimg: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fc7a76dba46042818d56579e301426d1~tplv-k3u1fbpfcp-zoom-1.image'
author: 掘金
comments: false
date: Mon, 07 Jun 2021 22:10:07 GMT
thumbnail: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fc7a76dba46042818d56579e301426d1~tplv-k3u1fbpfcp-zoom-1.image'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><h2 data-id="heading-0">一、什么是字节序</h2>
<p>字节顺序，是指数据在内存中的存放顺序</p>
<ul>
<li>举例说明什么是字节顺序</li>
</ul>
<p>使用16进制表示两个数：0x12345678和0x11223344。在内存中有两种方法存储这两个数字，分别为：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fc7a76dba46042818d56579e301426d1~tplv-k3u1fbpfcp-zoom-1.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e68f0bc103ab4c2094b1ce6f9614c347~tplv-k3u1fbpfcp-zoom-1.image" alt loading="lazy" referrerpolicy="no-referrer"></p>
<p>从上图看，两种方案虽有不同，但也有共识，即依次存储每一个数字，即先存0x12345678，再存0x11223344。大家的不同在于，对于某一个要表示的值，是把值的低位存到低地址，还是把值的高位存到低地址。</p>
<h2 data-id="heading-1">二、字节顺序的分类</h2>
<p>字节的排列方式有两种。例如，将一个多字节对象的低位放在较小的地址处，高位放在较大的地址处，则称<strong>小端序</strong>；反之则称<strong>大端序</strong>。</p>
<p>在几乎所有的机器上，多字节对象都被存储为连续的字节序列。例如在C语言中，一个类型为<code>int</code>的变量<code>x</code>地址为<code>0x100</code>，那么其对应地址表达式<code>&x</code>的值为<code>0x100</code>。且<code>x</code>的四个字节将被存储在电脑内存的<code>0x100, 0x101, 0x102, 0x103</code>位置。</p>
<ul>
<li>
<p>大端、小端模式的区别</p>
<p>例如假设变量<code>x</code>类型为<code>int</code>，位于地址<code>0x100</code>处，它的值为<code>0x01234567</code>，地址范围为<code>0x100~0x103</code>字节，其内部排列顺序依赖于机器的类型。大端法从首位开始将是：<code>0x100: 0x01, 0x101: 0x23,..</code>。而小端法将是：<code>0x100: 0x67, 0x101: 0x45,..</code>。</p>
</li>
<li>
<p>不同处理器体系</p>
<ul>
<li>x86，MOS Technology 6502，Z80，VAX，PDP-11等处理器为Little endian。</li>
<li>Motorola 6800，Motorola 68000，PowerPC 970，System/370，SPARC（除V9外）等处理器为Big endian。</li>
<li>ARM, PowerPC (除PowerPC 970外), DEC Alpha, SPARC V9, MIPS, PA-RISC and IA64的字节序是可配置的。</li>
</ul>
</li>
</ul>
<h2 data-id="heading-2">三、网络字节序</h2>
<p>对于搞网络通信应用（比如IM、消息推送、实时音视频）开发的程序员来说，自已写通信底层的话是一定会遇到大小端问题，上面所说的大小端字节序都是在说计算机自己，也被称作主机字节序。同型号计算机上写的程序，在相同的系统上面运行是没有问题的。</p>
<p>但计算机网络的出现让大小端问题变的复杂化了，因为每个计算机都有自己的主机字节序。不同计算机之间通过网络通信时：我“说”的你听不懂，你“说”我也听不懂，这可怎么办？这时候就需要约定俗成的协议来解决问题。</p>
<p>TCP/IP协议很好的解决了这个问题，<strong>TCP/IP协议规定使用“大端”字节序作为网络字节序。</strong></p>
<p>这样不管计算机采用哪种字节序，发送数据的时候必须将自己的主机字节序转换为网络字节序（即“大端”字节序），对接收到的数据转换为自己的主机字节序。这样一来，也就达到了与CPU、操作系统无关，实现了网络通信的标准化。</p>
<ul>
<li>
<p>主机字节序到网络字节序的转换</p>
<p>为了程序的兼容，网络通信过程中每次发送和接受数据都要进行转换，这样做的目的是保证代码在任何计算机上执行时都能达到预期的效果。</p>
<p>通信时的这种常用的操作，Socket API这一层，一般都提供了封装好的转换函数，方便程序员使用。比如从主机字节序到网络字节序的转换函数：htons、htonl（C语言中常用），从网络字节序到主机字节序的转换函数：ntohs、ntohl（C语言中常用）。当然，明白了原理后也可以编写自己的转换函数。</p>
</li>
</ul>
<h2 data-id="heading-3">四、大小端（endian）的来源</h2>
<p>“<strong>endian</strong>”一词来源于十八世纪爱尔兰作家<a href="https://zh.wikipedia.org/wiki/%E4%B9%94%E7%BA%B3%E6%A3%AE%C2%B7%E6%96%AF%E5%A8%81%E5%A4%AB%E7%89%B9" target="_blank" rel="nofollow noopener noreferrer">乔纳森·斯威夫特</a>（Jonathan Swift）的小说《<a href="https://zh.wikipedia.org/wiki/%E6%A0%BC%E5%88%97%E4%BD%9B%E9%81%8A%E8%A8%98" target="_blank" rel="nofollow noopener noreferrer">格列佛游记</a>》（<em>Gulliver's Travels</em>）。小说中，小人国为水煮蛋该从大的一端（Big-End）剥开还是小的一端（Little-End）剥开而争论，争论的双方分别被称为“大端派”和“小端派”。以下是1726年关于大小端之争历史的描述：</p>
<blockquote>
<p>我下面要告诉你的是，Lilliput和Blefuscu这两大强国在过去36个月里一直在苦战。战争开始是由于以下的原因：我们大家都认为，吃鸡蛋前，原始的方法是打破鸡蛋较大的一端，可是当今皇帝的祖父小时候吃鸡蛋，一次按古法打鸡蛋时碰巧将一个手指弄破了。因此他的父亲，当时的皇帝，就下了一道敕令，命令全体臣民吃鸡蛋时打破鸡蛋较小的一端，违令者重罚。老百姓们对这项命令极其反感。历史告诉我们，由此曾经发生过6次叛乱，其中一个皇帝送了命，另一个丢了王位。这些叛乱大多都是由Blefuscu的国王大臣们煽动起来的。叛乱平息后，流亡的人总是逃到那个帝国去寻求避难。据估计，先后几次有11000人情愿受死也不肯去打破鸡蛋较小的一端。关于这一争端，曾出版过几百本大部著作，不过大端派的书一直是受禁的，法律也规定该派任何人不得做官。”</p>
</blockquote>
<p>1980年，丹尼·科恩（Danny Cohen），一位网络协议的早期开发者，在其著名的论文"On Holy Wars and a Plea for Peace"中，为平息一场关于字节该以什么样的顺序传送的争论，而第一次引用了该词。</p>
<h2 data-id="heading-4">总结</h2>
<p>引用维基百科的一段话：在哪种字节顺序更合适的问题上，人们表现得非常情绪化，实际上，就像鸡蛋的问题一样，没有技术上的原因来选择字节顺序规则，因此，有关大小端的争论沦为关于社会政治问题的争论，<strong>只要选择了一种规则并且始终如一地坚持，其实对于哪种字节排序的选择是任意的。</strong></p>
<h2 data-id="heading-5">参考资料</h2>
<ul>
<li>
<p><a href="https://zh.wikipedia.org/wiki/%E5%AD%97%E8%8A%82%E5%BA%8F" target="_blank" rel="nofollow noopener noreferrer">字节顺序</a></p>
</li>
<li>
<p><a href="https://zhuanlan.zhihu.com/p/182923960" target="_blank" rel="nofollow noopener noreferrer">详解大小端</a></p>
</li>
</ul></div>  
</div>
            