
---
title: 'ğŸ» iOSè‡ªåŠ¨åŒ–æ–¹æ¡ˆé™„è„šæœ¬'
categories: 
 - ç¼–ç¨‹
 - æ˜é‡‘
 - çƒ­é—¨
headimg: 'https://picsum.photos/400/300?random=5038'
author: æ˜é‡‘
comments: false
date: Tue, 06 Apr 2021 18:41:48 GMT
thumbnail: 'https://picsum.photos/400/300?random=5038'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><h2 data-id="heading-0">ç»Ÿä¸€å¼€å‘ç¯å¢ƒ</h2>
<p>ç»Ÿä¸€å¼€å‘ç¯å¢ƒï¼Œå‡å°‘å› ç¯å¢ƒä¸åŒå¯¼è‡´æ–‡ä»¶å†²çªã€‚</p>
<p>å…·ä½“å®ç°ï¼šå®‰è£…rbenvï¼Œç®¡ç†rubyç¯å¢ƒï¼›å®‰è£…Bundlerï¼Œç®¡ç†cocoapodsã€cocoapodsæ’ä»¶ã€fastlaneç­‰ã€‚</p>
<h3 data-id="heading-1">ç¯å¢ƒæ­å»ºè€…éœ€è¦é…ç½®ä»¥ä¸‹å†…å®¹ï¼š</h3>
<p>å®‰è£… Homebrew</p>
<pre><code class="copyable">/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)"
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>å®‰è£… rbenv</p>
<pre><code class="copyable">brew install rbenv ruby-build rbenv-vars
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>æ”¾åˆ°ä½ çš„ Shell é…ç½®æ–‡ä»¶é‡Œé¢</p>
<pre><code class="copyable">export PATH="$HOME/.rbenv/bin:$PATH" 
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<pre><code class="copyable">eval "$(rbenv init -)"
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>å®‰è£…å’Œè®¾ç½®é¡¹ç›®çš„ Ruby ç¯å¢ƒ</p>
<pre><code class="copyable">rbenv install 2.7.1
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<pre><code class="copyable">rbenv local 2.7.1
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>rbenv ä¼šå¸®æˆ‘ä»¬å»ºç«‹ ä¸€ä¸ªå«ä½œ.ruby-version çš„æ–‡ä»¶</p>
<h3 data-id="heading-2">å…¶ä»–äººå‘˜æ‰§è¡Œä»¥ä¸‹è„šæœ¬ï¼š</h3>
<pre><code class="copyable"># åœ¨rbenv ä¸‹å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„ Ruby å¼€å‘ç¯å¢ƒ

ruby_version=`cat .ruby-version`
if [[ ! -d "$HOME/.rbenv/versions/$ruby_version" ]]; then
  rbenv install $ruby_version;
fi

# é€šè¿‡ RubyGems å®‰è£… Bunlder

gem install bundler

# ä½¿ç”¨ Bundler å®‰è£… CocoaPods å’Œ fastlane ç­‰ä¾èµ–åŒ…

bundle install

# å®‰è£…å„ä¸ª Pod

bundle exec pod install

<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>è‡³æ­¤ç»Ÿä¸€çš„ç¯å¢ƒæ­å»ºç»“æŸï¼Œå¯¹äºxcodeï¼Œåªè¦ä¸æ˜¯å·®åˆ«å¾ˆå¤§å°±è¡Œï¼Œä¿æŒåœ¨ä¸€ä¸ªå¤§ç‰ˆæœ¬ä¸­å°±è¡Œï¼Œå¦‚ï¼šXCode12</p>
<p>å‘½åè¯¥è„šæœ¬ä¸ºï¼šsetup.sh</p>
<h2 data-id="heading-3">é…ç½®fastlane</h2>
<p>Gemfile ä¸­æ·»åŠ ï¼š</p>
<pre><code class="copyable"># frozen_string_literal: true
source "https://rubygems.org"

gem 'cocoapods', '1.10.1'

# è‡ªåŠ¨éƒ¨ç½²
gem 'fastlane', '2.179.0'

plugins_path = File.join(File.dirname(__FILE__), 'fastlane', 'Pluginfile')

eval_gemfile(plugins_path) if File.exist?(plugins_path)

<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>å†æ¬¡æ‰§è¡Œä¸Šè¿°è„šæœ¬ setup.sh</p>
<h2 data-id="heading-4">å®ç”¨lane</h2>
<p>æ‰§è¡Œï¼Œåˆ›å»ºè‡ªå®šä¹‰Fastlaneæ–‡ä»¶</p>
<pre><code class="copyable">bundle exec fastlane init
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>fastlane æ‰§è¡Œæ—¶ï¼Œæ¯”è¾ƒå›°éš¾çš„æ˜¯è¯ä¹¦é…ç½®ã€‚</p>
<h3 data-id="heading-5">ä½¿ç”¨machæ¥ç®¡ç†è¯ä¹¦</h3>
<p>é¦–å…ˆï¼Œåœ¨githubæˆ–è€…å…¶ä»–gitå¹³å°ï¼Œæ–°å»ºä¸€ä¸ªç§æœ‰ä»“åº“ã€‚</p>
<pre><code class="copyable">  desc "æ‹‰å–è¯ä¹¦" 
  lane :mach_pp do
    # è¯ä¹¦ç®¡ç†
    match(
        git_url: "https://github.com/xxx/xxx.git",
        type: "adhoc" ,
        app_identifier:["com.xxx.xxx","com.xxx.xxx.push"],
        username:"xxx@163.com",
        team_id: "xxx"
        )
    match(
        git_url: "https://github.com/xxx/xxx.git",
        type: "appstore" ,#can be appstore,adhoc, development,enterprise
        app_identifier:["com.xxx.xxx","com.xxx.xxx.push"],
        username:"xxx@163.com",
        team_id: "xxx"
    )
  end 
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>å¡«å…¥ä»¥ä¸Šä¿¡æ¯ï¼šgit_urlã€typeã€app_identifierã€usernameã€team_id</p>
<p>å…¶ä¸­ï¼štypeåˆ†ä¸ºadhocã€appstore</p>
<h3 data-id="heading-6">gym æ‰“åŒ…</h3>
<pre><code class="copyable"> desc "å‘æ­£å¼åŒ…åˆ°appstore"
  lane :ipa2apple do
    # gymç”¨æ¥ç¼–è¯‘ipa
    gym(
        scheme: 'XXX',
        configuration: "Release",
        export_method: "app-store", # æŒ‡å®šæ‰“åŒ…æ–¹å¼
        xcargs: "-allowProvisioningUpdates",
        archive_path: '../appstore',
        output_directory: './appstore',
        output_name: 'XXX.ipa'
    )
  end

<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<h3 data-id="heading-7">Pluginfile ç®¡ç†æ’ä»¶</h3>
<h4 data-id="heading-8">å®‰è£…firæ’ä»¶</h4>
<pre><code class="copyable">fastlane add_plugin fir_cli
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>ä½¿ç”¨</p>
<pre><code class="copyable">firim(firim_api_token: "56d42c7266586d43dccad86730555c78")  # token åœ¨fir ä¸ŠæŸ¥çœ‹ã€‚
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<h4 data-id="heading-9">ä¸Šä¼ ç¬¦å·è¡¨</h4>
<p>å®‰è£…firebaseæ’ä»¶</p>
<pre><code class="copyable">fastlane add_plugin firebase_app_distribution

<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<p>ä½¿ç”¨</p>
<pre><code class="copyable">  # fir çš„ release åŒ… Crash report symbols
  desc 'Upload symbols to Crashlytics for Release app'
  lane :upload_symbols_to_crashlytics_release do
    upload_symbols_to_crashlytics(
      dsym_path: "./fir_release/xxx.app.dSYM.zip",
      gsp_path: "./xxx/GoogleService-Info_Beta.plist",
      api_token: ENV["FIREBASE_API_TOKEN"]
    )
  end
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<h4 data-id="heading-10">å…¶ä»–</h4>
<pre><code class="copyable">desc "å‡†å¤‡å·¥ä½œ install"
  lane :ready do

    # æ‹‰ä»£ç 
    git_pull

    # å…¨å±€å˜é‡
    time = Time.new

    # build å·
    build_number = time.strftime("%Y%m%d%H%M%S")
    increment_build_number(&#123;
      build_number: build_number
    &#125;)

    git_commit(path:".", message:"[robot][auto build to #&#123;build_number&#125;]")
    sh 'git push origin main'    
  end
<span class="copy-code-btn">å¤åˆ¶ä»£ç </span></code></pre>
<h2 data-id="heading-11">æ³¨æ„äº‹é¡¹</h2>
<ul>
<li>
<p>ä½¿ç”¨undlerå·¥å…·ç®¡ç†åï¼Œä»¥åæ‰§è¡Œpod éœ€è¦åœ¨å‰è¾¹åŠ ä¸Š bundle exec</p>
</li>
<li>
<p>sync_code_signingå‘½ä»¤ï¼Œå…¶å®æ˜¯matchå‘½ä»¤çš„å¦å¤–ä¸€ç§å†™æ³•</p>
</li>
<li>
<p>build_appå‘½ä»¤å…¶å®æ˜¯gymçš„åˆ«å</p>
</li>
<li>
<p>fastlane å¸¸ç”¨çš„actionä»¥åŠå‚æ•° <a href="https://juejin.cn/post/6844903813262901255#heading-7" target="_blank">juejin.cn/post/684490â€¦</a></p>
</li>
<li>
<p>zsh: permission deniedé—®é¢˜çš„è§£å†³åŠæ³•  sudo chmod u+x *.sh</p>
</li>
<li>
<p>sudoæ“ä½œï¼Œå¦‚æœé‡åˆ°ä¸æ˜åŸå› çš„é”™è¯¯ï¼Œå¯èƒ½æ˜¯æƒé™é—®é¢˜ï¼Œä½¿ç”¨chmod 777 è·¯å¾„ å°è¯•è§£å†³</p>
</li>
</ul></div> <div class="image-viewer-box" data-v-78c9b824><!----></div>  
</div>
            