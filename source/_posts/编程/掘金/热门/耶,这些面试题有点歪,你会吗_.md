
---
title: '耶,这些面试题有点歪,你会吗_'
categories: 
 - 编程
 - 掘金
 - 热门
headimg: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fdc2981777f0480ebcbf89f22a1d5b6d~tplv-k3u1fbpfcp-zoom-1.image'
author: 掘金
comments: false
date: Sun, 25 Apr 2021 22:00:39 GMT
thumbnail: 'https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fdc2981777f0480ebcbf89f22a1d5b6d~tplv-k3u1fbpfcp-zoom-1.image'
---

<div>   
<div class="markdown-body"><style>.markdown-body&#123;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333&#125;.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6&#123;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px&#125;.markdown-body h1&#123;font-size:30px;margin-bottom:5px&#125;.markdown-body h2&#123;padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec&#125;.markdown-body h3&#123;font-size:18px;padding-bottom:0&#125;.markdown-body h4&#123;font-size:16px&#125;.markdown-body h5&#123;font-size:15px&#125;.markdown-body h6&#123;margin-top:5px&#125;.markdown-body p&#123;line-height:inherit;margin-top:22px;margin-bottom:22px&#125;.markdown-body img&#123;max-width:100%&#125;.markdown-body hr&#123;border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px&#125;.markdown-body code&#123;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em&#125;.markdown-body code,.markdown-body pre&#123;font-family:Menlo,Monaco,Consolas,Courier New,monospace&#125;.markdown-body pre&#123;overflow:auto;position:relative;line-height:1.75&#125;.markdown-body pre>code&#123;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8&#125;.markdown-body a&#123;text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff&#125;.markdown-body a:active,.markdown-body a:hover&#123;color:#275b8c&#125;.markdown-body table&#123;display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6&#125;.markdown-body thead&#123;background:#f6f6f6;color:#000;text-align:left&#125;.markdown-body tr:nth-child(2n)&#123;background-color:#fcfcfc&#125;.markdown-body td,.markdown-body th&#123;padding:12px 7px;line-height:24px&#125;.markdown-body td&#123;min-width:120px&#125;.markdown-body blockquote&#123;color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8&#125;.markdown-body blockquote:after&#123;display:block;content:""&#125;.markdown-body blockquote>p&#123;margin:10px 0&#125;.markdown-body ol,.markdown-body ul&#123;padding-left:28px&#125;.markdown-body ol li,.markdown-body ul li&#123;margin-bottom:0;list-style:inherit&#125;.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item&#123;list-style:none&#125;.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul&#123;margin-top:0&#125;.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul&#123;margin-top:3px&#125;.markdown-body ol li&#123;padding-left:6px&#125;.markdown-body .contains-task-list&#123;padding-left:0&#125;.markdown-body .task-list-item&#123;list-style:none&#125;@media (max-width:720px)&#123;.markdown-body h1&#123;font-size:24px&#125;.markdown-body h2&#123;font-size:20px&#125;.markdown-body h3&#123;font-size:18px&#125;&#125;</style><p>这次给大家分享一些面试题,你知道答案吗?</p>
<h3 data-id="heading-0">第一道面试题:</h3>
<p>请看下面的代码,请问输出的结果是什么?</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fdc2981777f0480ebcbf89f22a1d5b6d~tplv-k3u1fbpfcp-zoom-1.image" alt loading="lazy" referrerpolicy="no-referrer"><img alt title="点击并拖拽以移动" loading="lazy" src="https://juejin.cn/post/undefined" referrerpolicy="no-referrer">​</p>
<h3 data-id="heading-1">第二道面试题:</h3>
<p>请看下面的代码,请问输出的结果是什么?</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c5226d1d1c864a08877ff1e06c6167d6~tplv-k3u1fbpfcp-zoom-1.image" alt loading="lazy" referrerpolicy="no-referrer"><img alt title="点击并拖拽以移动" loading="lazy" src="https://juejin.cn/post/undefined" referrerpolicy="no-referrer">​</p>
<h3 data-id="heading-2">第三道面试题:</h3>
<p>请看下面的代码,请问输出的结果是什么?</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8cbcb6b93e934519978aff10e2913132~tplv-k3u1fbpfcp-zoom-1.image" alt loading="lazy" referrerpolicy="no-referrer"><img alt title="点击并拖拽以移动" loading="lazy" src="https://juejin.cn/post/undefined" referrerpolicy="no-referrer">​</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d6e6bea059ee458eaca4179cec060fb7~tplv-k3u1fbpfcp-zoom-1.image" alt loading="lazy" referrerpolicy="no-referrer"><img alt title="点击并拖拽以移动" loading="lazy" src="https://juejin.cn/post/undefined" referrerpolicy="no-referrer">​</p>
<h3 data-id="heading-3">第四道面试题:</h3>
<p>请看下面的代码,请问着2块代码会发生什么事?</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/83928c6b475b4272980879d4e03072b0~tplv-k3u1fbpfcp-zoom-1.image" alt loading="lazy" referrerpolicy="no-referrer"><img alt title="点击并拖拽以移动" loading="lazy" src="https://juejin.cn/post/undefined" referrerpolicy="no-referrer">​</p>
<h2 data-id="heading-4">面试题答案</h2>
<p><strong>1.第一道:</strong></p>
<p>相信我们心中都是已经有答案了,现在我们一个一个来看看每一道面试题,其实考察的还是我们的基础的问题,涉及的都是某一个知识点,首先第一道.这样我们先看一下运行结果:1和3</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/951b7f2b942d42dc9f6ce19b3c8a297e~tplv-k3u1fbpfcp-zoom-1.image" alt loading="lazy" referrerpolicy="no-referrer"><img alt title="点击并拖拽以移动" loading="lazy" src="https://juejin.cn/post/undefined" referrerpolicy="no-referrer">​</p>
<p>结果是1和3,而test2方法并没有执行,这时候我换一种写法,如下:我们再看一下结果.</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8dd6a6dc62c04e139eb395b7e208a656~tplv-k3u1fbpfcp-zoom-1.image" alt loading="lazy" referrerpolicy="no-referrer"><img alt title="点击并拖拽以移动" loading="lazy" src="https://juejin.cn/post/undefined" referrerpolicy="no-referrer">​</p>
<p>afterDelay去掉以后立刻就会输出1,2,3.首先我们要知道[<strong>self</strong> performSelector:<strong>@selector</strong>(test2) withObject:<strong>nil</strong>];这里的执行本质就是objc_msgSend(self,<strong>@selector</strong>(test2))就是这种,再说白点就是[self test2];(这里可以查看objc源码的实现,直接查找performSelector的方法实现就能找到).</p>
<p>而[<strong>self</strong> performSelector:<strong>@selector</strong>(test2) withObject:<strong>nil</strong> afterDelay:.0];就有点不一样的,大家可以把上面的异步线程的里面的代码全部拿到主线程来操作,你会发现都是有输出的.会输出1,2,3(顺序可能不一样,但都会输出).这时候你可以点击进去看里面的定义,你会发现它是属于RunLoop里面的模块,而且在objc里面你是找不到源码的.这时候我们就可以参照上个博客说的GNUstep的源码(GNUstep上个博客有介绍),我们看源码如下:</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c5693888c8c84f07a5a57f8174d7e6d3~tplv-k3u1fbpfcp-zoom-1.image" alt loading="lazy" referrerpolicy="no-referrer"><img alt title="点击并拖拽以移动" loading="lazy" src="https://juejin.cn/post/undefined" referrerpolicy="no-referrer">​</p>
<p>所以很明显,它的底层是用了NSTimer定时器.比如时间我写2.0就是2秒以后做事情.而我们知道定时器是要加在Runloop里面.这下就很清楚了,为什么主线程可以,因为我们知道主线程的Runloop是默认开启的,子线程是默认没有Runloop的,所以会出现这种情况.定时器没法工作,它那段代码是往runloop中添加了一个定时器任务.如果想让它工作,我们只要添加runloop即可.</p>
<p><strong>2.第二道:</strong></p>
<p>我们先看一下第二道面试题的输出结果</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d42efb1ef27b447bb872cd3368a1b1f1~tplv-k3u1fbpfcp-zoom-1.image" alt loading="lazy" referrerpolicy="no-referrer"><img alt title="点击并拖拽以移动" loading="lazy" src="https://juejin.cn/post/undefined" referrerpolicy="no-referrer">​</p>
<p>输出1以后,执行performSelector任务的时候,直接崩溃了,因为我们知道,调用start,它就会执行block任务,执行完以后,线程的任务就算完成了,线程自动会退出,这时候你去让一个已经退出的线程安排任务,肯定会出问题.</p>
<p><strong>3.第三道:</strong></p>
<p>第三道也可以说是第二道的升华,因为有些人可能会想,既然thread会退出,那我就用一个强指针指着,不让它退出,不就行了吗?真的可以吗?我们试试.</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e89ffd20968c4aeaaf41ef5bea7bfd4e~tplv-k3u1fbpfcp-zoom-1.image" alt loading="lazy" referrerpolicy="no-referrer"><img alt title="点击并拖拽以移动" loading="lazy" src="https://juejin.cn/post/undefined" referrerpolicy="no-referrer">​</p>
<p>你会发现这样写还是一样,还是会崩溃,这是为什么呢?</p>
<p>这是因为,强指针只是让它不销毁,让这个线程对象还是在内存中,但是它不能做事情了,它已经没有用了,而只有添加RunLoop才是保证线程处于激活的状态,保证它的生命周期不结束,还能继续在这个线程中执行线程任务.所以必须使用RunLoop才能保住线程的生命周期.</p>
<p>而第三道面试题,我是加了runloop,所以就能正常执行,而第三道面试题,第一块是只执行了1次performSelector,它是不会崩溃正常执行的.这样,我还是截图代码运行结果吧,请看下面:</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/90bfbcdfa5104ebb8646d62686f6de09~tplv-k3u1fbpfcp-zoom-1.image" alt loading="lazy" referrerpolicy="no-referrer"><img alt title="点击并拖拽以移动" loading="lazy" src="https://juejin.cn/post/undefined" referrerpolicy="no-referrer">​</p>
<p>正常运行</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c566e2dcd3d24f6bbfd6bac40eb741d8~tplv-k3u1fbpfcp-zoom-1.image" alt loading="lazy" referrerpolicy="no-referrer"><img alt title="点击并拖拽以移动" loading="lazy" src="https://juejin.cn/post/undefined" referrerpolicy="no-referrer">​</p>
<p>崩溃</p>
<p>为什么会有上面的结果呢?原因它还是关于Runloop的一个线程保活的问题(也就是控制线程的生命周期),这里就不细说了,之前的博客都有介绍,有兴趣的可以看一下.<a href="https://juejin.cn/post/6951397884264710151" target="_blank">你了解RunLoop线程保活吗?已封装好,2句代码直接使用</a>里面详细介绍run和runMode区别,知道这个就能很清楚解答这道面试题</p>
<p><strong>4.第四道:</strong></p>
<p>这个是涉及tagged pointer的知识点,如果你了解,这道面试题就相对来说简单些,这样我们先看运行结果:</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c1679993d4544cc1bdb5d81f5f796954~tplv-k3u1fbpfcp-zoom-1.image" alt loading="lazy" referrerpolicy="no-referrer"><img alt title="点击并拖拽以移动" loading="lazy" src="https://juejin.cn/post/undefined" referrerpolicy="no-referrer">​</p>
<p>有问题的运行崩溃</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/577c4b98487c4eb487714925433dcfc5~tplv-k3u1fbpfcp-zoom-1.image" alt loading="lazy" referrerpolicy="no-referrer"><img alt title="点击并拖拽以移动" loading="lazy" src="https://juejin.cn/post/undefined" referrerpolicy="no-referrer">​</p>
<p>没问题的运行</p>
<p>我们可以看到上面的2张图,第一张直接崩溃了,第二张图的运行结果没有什么问题,要解答这个面试题,你要知道tagged pointer这个东西:(这里大致说一下,因为我后面的博客会详细介绍这个<strong>tagged pointer</strong>)</p>
<p><strong>tagged pointer:</strong> 从 64bit 开始，苹果引入了 tagged pointer 计数，用于优化 NSNumber ， NSDate ， NSString 等小对象的存储，没有这个数据之前，NSNumber 等对象需要动态分配内存，维护引用计数，NSNumber 指针存储的是堆中NSNumber对象的地址值，而引入了这个计数之后，NSNumber 指针里面存储的数据是 ： tag + data ，也就是直接将数据存储在指针中。这样做特别节省空间。如果这个数据特别大，指针存储不下这个数，那么会恢复之前的方式，存储在堆区，然后指针存放堆区的地址。</p>
<p>我们知道存在堆区的话,给TestStr赋值内部会类似下面的访问:</p>
<p>-(void)setTestStr:(NSString *)TestStr&#123;</p>
<p>if (_TestStr != TestStr) &#123;</p>
<p>[_TestStr release];</p>
<p>_TestStr = [TestStr copy];</p>
<p>&#125;</p>
<p>&#125;</p>
<p>这样的话就可能有多个线程同时去 [_TestStr release],如果_TestStr已经释放了,又去访问就会直接崩溃.为了避免这个问题,我们可以使用线程同步技术,我上个博客写了好多种技术,我们随便用一个即可解决.</p>
<p>而<strong>self</strong>.TestStr = [NSString stringWithFormat:@"abc"]这个就是使用了<strong>tagged pointer</strong>技术,所以不会涉及到释放,就不会出现崩溃的问题.(<strong>tagged pointer</strong>后面的博客我会详细介绍)</p>
<h3 data-id="heading-5">接下来我会继续努力编写其他博客,您的支持就是我最大的动力!</h3>
<h2 data-id="heading-6">如果觉得我写得对您有所帮助，请点赞关注我，我会持续更新😄</h2>
<h1 data-id="heading-7">感谢支持🙏🙏🙏!</h1>
<h1 data-id="heading-8">我是GDCoder,我们下期见!</h1></div>  
</div>
            