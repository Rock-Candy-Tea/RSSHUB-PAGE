
---
title: '春色满园关不住，带你体验阿里云 Knative'
categories: 
 - 编程
 - segmentfault
 - 用户
headimg: 'https://segmentfault.com/img/bVcRmhU'
author: segmentfault
comments: false
date: 2021-04-19 12:10:41
thumbnail: 'https://segmentfault.com/img/bVcRmhU'
---

<div>   
<p>简介：Knative 是基于 Kubernetes 的开源 Serverless 应用编排框架。阿里云 Knative 在社区Knative基础之上，与阿里云产品进行了深度的融合，给你带来最纯粹的容器化 Serverless 体验。<br>Knative 是基于 Kubernetes 的开源 Serverless 应用编排框架。阿里云 Knative 在社区Knative基础之上，与阿里云产品进行了深度的融合，给你带来最纯粹的容器化 Serverless 体验。<br><strong>章程</strong><br>• 关于 Knative<br>• Serverless 服务引擎 - Serving<br>• Serverless 事件驱动 - Eventing<br>• 阿里云 Knative<br>• 阿里云产品融合<br>• 阿里云 K8s 生态集成<br>• 一个例子<br><strong>关于Knative</strong><br>Knative 是基于 Kubernetes 的开源 Serverless 应用编排框架。实际上 Knative 包含的不单单是 Workload，它还有 Kubernetes 原生的流程编排引擎和完备的事件系统。 Knative 目标是基于 Kubernetes 提供应用 Serverless 工作负载编排的标准化。Knative 核心模块主要包括事件驱动框架 Eventing 和部署工作负载的 Serving。<br>Serverless 服务引擎 - Serving<br>Knative Serving 核心能力就是其简洁、高效的应用托管服务，这也是其支撑Serverless 能力的基础。当然作为SeverlesssFramework 就离不开按需分配资源的能力，Knative 可以根据您应用的请求量在高峰时期自动扩容实例数，当请求量减少以后自动缩容实例数，可以非常自动化的帮助您节省成本。Serving 还提供了的流量管理能力和灵活的灰度发布能力。流量管理能力可以根据百分比切分流量，灰度发布能力可以根据流量百分比进行灰度<br><strong>简单的应用模型</strong><br>提供了极简的应用模型 - Knative Service，同时满足服务部署、服务访问以及灰度发布的能力。可以用下面的公式表述：Knative Service = 工作负载（Deployment）+服务访问(service)+灰度流量(Ingress)。应用模型如图：<br>• Service: 对 Serverless 应用模型的抽象，通过Service 管理应用的生命<strong>周期</strong><br>• configuration: 用于配置应用期望的信息。每次更新Service 就会更新Configuration<br>• revision: configuration的每次更新都会创建一个快照，用来做版本管理<br>• route: 将请求路由到Revision，并可以向不同的Revision 转发不同比例的<strong>流量</strong><br>• 应用托管<br>• Kubernetes 是面向 IaaS 管理的抽象，通过 Kubernetes 直接部署应用需要维护的资源比较多<br>• 通过 Knative Service 一个资源就能定义应用的托管<br>• 流量管理<br>• Knative 通过 Gateway 结果应用流量，然后可以对流量按百分比进行分割，这为弹性、灰度等基础能力做好了基础<br>• 灰度发布<br>• 支持多版本管理，应用同时有多个版本在线提供服务很容易实现<br>• 不同版本可以设置不同的流量百分比，对灰度发布等功能实现起来很容易<br>• 弹性<br>• Knative 帮助应用节省成本的核心能力是弹性，在流量增加的时候自动扩容，流量下降的时候自动缩容<br>• 每一个灰度的版本都有自己的弹性策略，并且弹性策略和分配到当前版本的流量是相关联的。Knative 会根据分配过来的流量多少进行扩容或者缩容的决策<br>丰富的弹性策略<br>作为 Serverless 框架，其核心能力就是自动弹性，Knative中提供了丰富的弹性策略：<br>• 基于流量请求的自动扩缩容-KPA<br>• 基于CPU、Memory的自动扩缩容-HPA<br>• 支持定时 + HPA的自动扩缩容策略<br>• 事件网关，提供请求与Pod 1对1处理能力<br>Serverless 事件驱动框架 - Eventing<br>事件驱动是Serverless的标配，在Knative 同样提供了事件驱动框架-Eventing。<br>Knative 的 Eventing 提供了完整的事件模型，可以很容易地接入各个外部系统的事件。事件接入以后通过 CloudEvent 标准在内部流转。<br>在Knative Eventing提供两种事件转发方式：<br>• 事件源直接转发到服务<br>• 事件源转发到Broker/Trigger，然后通过过滤转发到服务<br><span class="img-wrap"><img class="lazy" src="https://segmentfault.com/img/bVcRmhU" alt="image.png" title="image.png" referrerpolicy="no-referrer"></span></p><p>对于在使用过程中究竟应该使用哪种方式进行转发呢？其实很简单，broker/trigger模型是基于底层消息系统实现的，对于像github、gitlab、k8s apiserver这样的事件源来说，需要对消息事件进行缓冲处理、保证消息传输可靠性，那么我们建议通过事件源转发到Broker/Trigger进行事件流转。<br>对于事件源本身就是消息系统来说，像mns、kafka、rocketmq来说，使用事件源直接转发到服务更为高效。<br>讲到这里，就不得不提Knative的事件源。我把它比喻成事件驱动引擎，Knative Eventing正是通过这些事件源驱动事件流转。<br>Knative社区提供了丰富的事件源，如Kafka、GitHub等。此外还接入消息云产品事件源，如MNS、RocketMQ等。<br><strong>阿里云Knative </strong><br>阿里云 Knative 在社区原生的 Knative 之上，与阿里云资源体系进行了全方位的整合，提供了更为丰富的能力以及云产品级别的支持。<br><span class="img-wrap"><img class="lazy" src="https://segmentfault.com/img/bVcRmh1" alt="image.png" title="image.png" referrerpolicy="no-referrer"></span></p><p><strong>与阿里云产品融合</strong><br>• 丰富的消息云产品事件源：Kafka、MNS、RocketMQ<br>• 服务访问：SLB<br>• 存储：NAS、云盘等<br>• 可观测性：日志服务、ARMS<br>• IaaS资源：ECS、ECI<br>天然集成阿里云k8s生态<br>• 支持阿里云标准版 Kubernentes，专有版Kubernentes<br>• 支持阿里云Serverless Kubernetes（ASK）， 并且在ASK中将 Knative 管控组件全托管, 为用户节省了资源以及运维成本。<br><strong>一个例子</strong><br>接下来以一个发送弹幕的示例来介绍一下如何玩转阿里云Knative。先看一下效果：<br><span class="img-wrap"><img class="lazy" src="https://segmentfault.com/img/bVcRmh3" alt="image.png" title="image.png" referrerpolicy="no-referrer"></span></p><p><strong>架构示意图</strong><br><span class="img-wrap"><img class="lazy" src="https://segmentfault.com/img/bVcRmh8" alt="image.png" title="image.png" referrerpolicy="no-referrer"></span></p><p><strong>流程说明：</strong><br>• 用户通过弹幕web服务发送弹幕到阿里云kafka<br>• Kafka Source事件源监听到弹幕消息，然后发送到弹幕消息处理服务<br>• 弹幕消息处理服务接收到消息，然后自动弹性扩容实例进行消息处理，并将处理完成的消息发送给弹幕服务<br>• 最后弹幕通过web服务界面展示给用户<br>具体实践活动（密透：完成有机会拿Cherry机械键盘）：<a href="https://developer.aliyun.com/adc/series/ask?accounttraceid=82456b2a764b48bfa05663576c3025e8xihe" rel="nofollow">https://developer.aliyun.com/...</a><br><strong>总结</strong><br>最后我们总结一下阿里云 Knative 能给我们带来哪些能力：<br>• 服务部署低门槛、易上手<br>• Serverless 按需使用资源<br>• 事件驱动与消息云产品无缝对接<br>• 天然集成阿里云 K8s 生态<br>• 与阿里云产品打通<br>希望这些能力能给你带来真正的按需使用，降低运维、资源使用成本的诉求，这也是 serverless 思想理念所追求的目标。<br><a href="https://developer.aliyun.com/article/783581?utm_content=g_1000264002" rel="nofollow">原文链接</a><br>本文为阿里云原创内容，未经允许不得转载。</p>  
</div>
            