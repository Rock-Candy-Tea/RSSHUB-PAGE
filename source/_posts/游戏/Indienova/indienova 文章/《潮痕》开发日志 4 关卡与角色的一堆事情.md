
---
title: '《潮痕》开发日志 #4 关卡与角色的一堆事情'
categories: 
 - 游戏
 - Indienova
 - indienova 文章
headimg: 'https://hive.indienova.com/farm/blog/2022/09/u-3407802391650L2R.png'
author: Indienova
comments: false
date: 2022-09-13 11:09:40
thumbnail: 'https://hive.indienova.com/farm/blog/2022/09/u-3407802391650L2R.png'
---

<div>   
<p>又挺长时间没写开发日志了嘿 时间过得好快诶，所以这篇日志会有亿点点长。</p><p>这段时间学了一些东西，在设计与实际开发方面都有一点进展。</p><p>再提一嘴，目前还是一个人在搞事情，依然在寻求合伙人。如果有对游戏有兴趣的大大请尽管联系我</p><p>进入进入正题：</p><h4>这段时间整了点啥活</h4><p><strong>1. 游戏设计方面</strong></p><p>在设计方面，这段时间最大的收获就是在群内大佬的强烈安利下，投入了一些时间把顽皮狗首席设计师 Em Schatz 的课程刷了一遍，系统性地学习了游戏关卡设计的方法论，收益良多。</p><p>之前也会去分析玩过的游戏的关卡设计，但是总结的都是比较零碎的概念，现在看来并没有形成一个完备的系统，实际上手搭关卡白模的时候还是比较懵逼。刷完课程之后再回过头看有种豁然开朗的感觉。</p><p>这个是 <a href="https://www.bilibili.com/video/BV1yQ4y1h7rV" rel="nofollow" target="_blank">B 站上录屏的链接</a>，强烈安利一波</p><p>（怎么有种打软广的感觉..）</p><p>另外，如果你有兴趣的话，以下是个人在听课过程中整理的笔记，浏览器点开就可以，仅供参考：</p><p><a href="https://app.heptabase.com/w/e0f8eb9b8f77ba627a2eccfcd2632030183b81a87d10452f4f32e1cc0375a1be" rel="nofollow" target="_blank">第一周</a> | <a href="https://app.heptabase.com/w/ae92ce6c01bffc0a2d740767eb010553c6a9710210fb70856576fcea6d349735" rel="nofollow" target="_blank">第二周</a> | <a href="https://app.heptabase.com/w/daba020cc72c0038375853a70f6544544d4137a39db682538b5e64f925d16663" rel="nofollow" target="_blank">第三周</a> | <a href="https://app.heptabase.com/w/cc92da43f565f0f83bbae2705643f764f20328790eeee3bce57b3e88bc377587" rel="nofollow" target="_blank">第四周</a> | <a href="https://app.heptabase.com/w/d2c5a65d3cca45e23e8ca075376df940008dc5b7d57af50bec3f1a08830f287e" rel="nofollow" target="_blank">第五周</a> | <a href="https://app.heptabase.com/w/2f43b3dfb12ba75f00e933853617d75126580daa8a925319c8edc74a5ce55408" rel="nofollow" target="_blank">第六周</a> | <a href="https://app.heptabase.com/w/26fd0bafafe8d53a6263fad0236f9e9c9112235076a614059093d64b4ec41d02" rel="nofollow" target="_blank">第七周</a> | <a href="https://app.heptabase.com/w/94a93aba84243462a01f743801ac7870a89a223e3610a68ee58e80323e377d13" rel="nofollow" target="_blank">第八周</a> | 第九周讲纯 3D 视角射击战斗的所以我先跳了 | <a href="https://app.heptabase.com/w/f8e283aeafffb597b513d5ec67d90a289743b60d6229d37c4846ab3c3ef08fac" rel="nofollow" target="_blank">第十周</a> | </p><p><img class="fr-fin fr-dib" src="https://hive.indienova.com/farm/blog/2022/09/u-3407802391650L2R.png" referrerpolicy="no-referrer"></p><p>（对了，录屏是机翻字幕，课程里面会涉及到一些建筑学或者心理学的专业名词，笔记里面基本上就是自己凭感觉瞎翻了。不准确的可能性极大，如有错漏还请指正）</p><p>另外，在跟其他大佬聊天的时候，他们也指出了当前设计的一些问题，个人回去也仔细思考了一番，对整体设计也进行了一些比较大的迭代。这方面没什么好写的，还是等 Demo 出来之后亲自体验比较好一些。</p><p><br></p><p><strong>2. 开发方面</strong></p><p><strong>2.1 关卡体验向机制</strong></p><p>在系统地摸完一遍关卡设计理论之后，发现有一些功能对于营造更好的关卡体验具有很高的重要性。而对于以探索作为核心机制之一的游戏来说更是如此，所以就围绕着这个进行了一些功能的开发。</p><p><strong>如何藏东西：</strong></p><p>也就是关卡设计理论中“遮蔽”的概念。</p><p>对于越肩或者第一人称视角的纯 3D 游戏来说，实现遮蔽是自然而然的事情。</p><p>但是对于俯视角的正交场景来说就没这么简单了，因为视角本身以及场景物体之间的遮挡关系并不会随着角色位置而变化，玩家能将整个场景尽收眼底，能够获得的信息太多了。因此需要额外开发功能来支持。</p><p>目前，我将需要利用到遮蔽的地点分为了三种类型：</p><ul><li><strong> 区域揭示 </strong><ul><li>适用于一整片具有探索价值的秘密区域。玩家在踏入区域时，整片区域会一下子向玩家揭露。</li><li>实现方式也比较简单：给材质 Shader 添加一个新功能，在角色身上挂上脚本，利用射线检测触发，再将这一材质的透明度调整至设定值即可。</li><li>由于像素化材质不能为透明材质，所以用了一下 Bayer 抖动做假透明。<br><img class="fr-fin fr-dib" src="https://hive.indienova.com/farm/blog/2022/09/u-3407802391458CZT.gif" referrerpolicy="no-referrer"><br></li></ul></li><li><strong>挖洞</strong><ul><li>适用于不想让玩家一目了然看到被遮蔽的结构的情况。</li><li>角色被遮挡时，会在材质上挖出一个洞来让玩家看到角色周身范围的结构。</li><li>实现逻辑上其实与区域揭示比较类似，区别就是射线检测的方向是由角色到摄像机的，材质 Shader 上也需要在屏幕空间进行挖洞的运算。<img class="fr-fin fr-dib" src="https://hive.indienova.com/farm/blog/2022/09/u-3407802391492CIx.gif" referrerpolicy="no-referrer">  </li></ul></li><li><strong>完全遮挡</strong><ul><li>就完全挡住了呗。也许可以用于藏一些非常深的秘密…</li><li>这个做的处理就是角色脚下的方位显示环。利用 URP 的 Render Object 将这一圆环所在的渲染层显示在所有层之上，来在完全遮挡的情况下标记角色所在的位置。<img class="fr-fin fr-dib" src="https://hive.indienova.com/farm/blog/2022/09/u-3407802391529oVT.gif" referrerpolicy="no-referrer">  </li></ul></li></ul><p><strong>室内空间的处理：</strong></p><p>依然是正交俯视角的锅：空间之间的划分不太够明显。</p><p>这一缺点在进入室内空间时会很突出：屏幕上可以同时看到室内的视觉焦点与室外的视觉焦点，玩家的注意力会被分散的很严重。</p><p>常用的祖传解决方法是将室内作为独立场景读条加载，同时用黑色的背景来聚焦室内的场景。但是每次进出室内都要读个条总是不太爽。</p><p>要不还是再写个新功能 8</p><p><img class="fr-fin fr-dib" src="https://hive.indienova.com/farm/blog/2022/09/u-340780239175073o.gif" referrerpolicy="no-referrer"></p><p>基本原理是再用一个摄像机让其渲染室内场景的 Layer，写入 Render Texture，并在着色器中简单将其处理为一个挖洞蒙版材质。在 UI 层把这个蒙版显示出来，就能让这个蒙版把室外的场景“遮住”，实现类似的效果。</p><p>不过也可以看出边缘干干巴巴麻麻癞癞的。之后再优化吧。</p><p><strong>突出“有效的”地图区域：</strong></p><p>角色的机动性太强了，有胳膊有腿的哪都想去，跳着跳着就跳到设计好的游戏关卡外面去了。</p><p>空气墙当然还少不了，但是重点是怎么通过设计让玩家不想去到关卡外面。</p><p>这里的解决思路是利用黑暗，将关卡外部变为一个更强，也更加具有危险感的负空间。</p><p><img class="fr-fin fr-dib" src="https://hive.indienova.com/farm/blog/2022/09/u-3407802391800f7n.png" width="489" referrerpolicy="no-referrer"></p><div class="text-center image-caption"><small>应用前</small></div><p><img class="fr-fin fr-dib" src="https://hive.indienova.com/farm/blog/2022/09/u-34078023918243j0.png" width="487" referrerpolicy="no-referrer"></p><div class="text-center image-caption"><small>应用后</small></div><p>事前的准备工作有点笨，基本思路是将关卡的有效区域用 Pro Builder 的多边形建模扣出来，再来一个垂直的摄像机用来渲染关卡有效区域的 RT，得到黑白蒙版。之后再将这张蒙版用工具生成一张边缘非常模糊的有向距离场。</p><p><img class="fr-fin fr-dib" src="https://hive.indienova.com/farm/blog/2022/09/u-3407802391913JDr.png" width="326" referrerpolicy="no-referrer"></p><p>不过准备完成之后就比较简单了。有了这一贴图之后，就可以在 Shader 中利用世界坐标采样与加工这张距离场贴图，调整想要的渐变颜色与过渡宽度。</p><p><br></p><p><strong>2.2 角色相关</strong></p><ul><li>收拾了一下之前的烂摊子。解决了角色的旋转轴和 100 倍缩放的问题，典型的力气活</li><li>提灯挥动机制的实现： 动作方面利用了 IK 让手臂追踪目标，利用物理绳索插件为提灯运动增加随机感。 做了一个固定方向的动作混合树，加上脚本逻辑之类的 balabala。<ul><li>计划将这一机制作为基石之一，在游戏流程中衍生很多功能。<br> <img class="fr-fin fr-dib" src="https://hive.indienova.com/farm/blog/2022/09/u-3407802435179492.png" width="352" referrerpolicy="no-referrer"><br><img class="fr-fin fr-dib" src="https://hive.indienova.com/farm/blog/2022/09/u-3407802437444bsM.gif" width="356" referrerpolicy="no-referrer"><br></li><li>GIF 太糊了，详见视频</li><li>还有这物理插件的参数是真的难调。  </li></ul></li><li>    迭代了（换了一些从 mixamo 上扒的）动作与效果表现</li></ul><p><br></p><p><strong>2.3 其他</strong></p><ul><li>扣了扣树木和植被的模型<ul><li>用了 Blender 自带的 Tree Gen 生成器，效果还可以，面数不少但是它快啊，先用着再说<br><img class="fr-fin fr-dib" src="https://hive.indienova.com/farm/blog/2022/09/u-34078024352640g0.png" width="622" referrerpolicy="no-referrer"></li><li>给树叶传递球壳的法线来平滑树叶的光照效果。这个属于老生常谈了。<br><img class="fr-fin fr-dib" src="https://hive.indienova.com/farm/blog/2022/09/u-3407802435280m2P.png" width="615" referrerpolicy="no-referrer"></li></ul></li><li>添加了体积雾效果<ul><li>直接用的插件，没什么特别好说的</li><li>这个插件对于目前的游戏来说有好多功能都是冗余的，性能消耗也不算小。</li><li>倒是想自己写，但是事太多。之后可能会自己实现一个换掉。</li><li>这个效果也可以作为实现“遮蔽”的手段之一。将场景的一些部分隐藏起来，营造一点神秘的感觉。<br><img class="fr-fin fr-dib" src="https://hive.indienova.com/farm/blog/2022/09/u-3407802436210sWr.png" width="620" referrerpolicy="no-referrer"></li></ul></li></ul><h4>之后要整点啥活</h4><p>本来计划是，如果找到愿意合伙的程序与场景美术大佬之后就可以将全部精力放在 Demo 的剧情与关卡设计上面了。</p><p>现在看来暂时还是要设计开发雨露均沾着呐..</p><p>如果您有兴趣的话，依然请尽管联系我。</p><h4>视频演示</h4><div class="embed-responsive embed-responsive-4by3 bottommargin-sm"><span class="f-video-editor fr-fvn fr-tnv" contenteditable="false"><iframe src="https://player.bilibili.com/player.html?bvid=12t4y1778T" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" class="embed-responsive-item"> </iframe></span></div><h4>参考链接</h4><ul><li><a href="https://www.bilibili.com/video/BV1yQ4y1h7rV" rel="nofollow" target="_blank">Em Schatz 关卡设计课程 B 站录屏（感谢搬运 man）</a></li><li><a href="https://assetstore.unity.com/packages/vfx/shaders/fullscreen-camera-effects/volumetric-fog-mist-2-162694" rel="nofollow" target="_blank">体积雾插件</a></li><li><a href="https://assetstore.unity.com/packages/tools/physics/obi-rope-55579" rel="nofollow" target="_blank">物理绳索插件</a></li><li><a href="https://assetstore.unity.com/packages/tools/utilities/sdf-toolkit-free-50191" rel="nofollow" target="_blank">有向距离场生成工具</a></li></ul>
              
</div>
            