
---
title: '【教程】无需公网IP！zerotier内网穿透+chiaki远程串流PS5'
categories: 
 - 游戏
 - 小黑盒
 - 游戏新闻
headimg: 'https://imgheybox.max-c.com/bbs/2021/08/14/59e9f2833173ff6d7901ecb3be2a8d41/thumb.png'
author: 小黑盒
comments: false
date: Sun, 15 Aug 2021 19:01:18 GMT
thumbnail: 'https://imgheybox.max-c.com/bbs/2021/08/14/59e9f2833173ff6d7901ecb3be2a8d41/thumb.png'
---

<div>   
<ul></ul><h2>前言</h2><p>PS5吃灰许久，想利用午休时间在公司远程串流，也试了不少方案，分享下目前比较适合的串流方式，方便日后上班摸鱼(bushi)<span data-emoji="cube_doge" class="hb-emoji"></span></p><p>之前试过使用官方的远程串流软件（PS Remote Play），奈何码率低无法调整，最新的版本只支持win10，连接至少需要NAT2类型等等原因故放弃。</p><p>后来发现一款开源免费的串流软件--chiaki，支持MacOS/Windows/Android/Linux/Switch平台，码率可调，还支持远程唤醒，键盘映射，兼容Xbox手柄~个人感觉比官方的好用不少<span data-emoji="cube_并不简单" class="hb-emoji"></span></p><p>不过串流软件的连接都需要在同一个网内，如果想在不同的网连接只能靠公网ip，这就需要内网穿透软件来“搭桥”组成虚拟网，让我们的设备都处在同一个网里，这样就能通过内部的ip连接了~</p><hr><h2>内网穿透</h2><p>在做内网穿透前网络情况如下：</p><p><img class="lazy" data-height="470" src="https://imgheybox.max-c.com/bbs/2021/08/14/59e9f2833173ff6d7901ecb3be2a8d41/thumb.png" data-width="687" referrerpolicy="no-referrer"></p><h4 class="img-desc">网络情况</h4><p>pc、ps5均无公网ip，家里是华数的宽带，NAT类型常年NAT3，网络状况可谓是极差<span data-emoji="cube_捂脸哭" class="hb-emoji"></span>。</p><p>下面就准备开始进行内网穿透。<br></p><p>我使用的是Zerotier，有经验的小伙伴也可以使用其他软件，能达到同样的效果即可~</p><h3>1.Zerotier安装设置</h3><p>zerotier官网 https://www.zerotier.com/<br></p><p>Zerotier支持Windows/MacOS/Android/iOS/Linux/FreeBSD/NAS平台，免费版本支持50台主机，足够个人用户使用了。</p><p>Zerotier的服务器设在国外，不过软件主要起到握手的作用，两台主机在同一子网内实现直连后，数据便是P2P传输，不会再经过Zerotier的服务器。一开始的时候如果连接服务器有困难，有条件的小伙伴可以搭建一个MOON服务器来解决，这里就不赘述了。</p><ol><li>首先在zerotier官网上注册一个账号。</li><li>注册完毕后在官网登录。会出现以下界面</li></ol><p><img class="lazy" data-height="305" src="https://imgheybox.max-c.com/bbs/2021/08/15/095f9b84eece46900b1ac367c48bdb42/thumb.png" data-width="1908" referrerpolicy="no-referrer"></p><h4 class="img-desc">创建新的网络</h4><p>点击Create A Network来创建一个网络</p><p><img class="lazy" data-height="380" src="https://imgheybox.max-c.com/bbs/2021/08/15/0403c9bb70c9609db8722bf1c9ef5836/thumb.png" data-width="1911" referrerpolicy="no-referrer"></p><h4 class="img-desc">刚创建的网络</h4><p>点击进入新创建的网络，进入网络设置界面</p><p><img class="lazy" data-height="823" src="https://imgheybox.max-c.com/bbs/2021/08/15/61947601b367ae4bbb910878074a8a52/thumb.png" data-width="1226" referrerpolicy="no-referrer"></p><h4 class="img-desc">基础网络配置</h4><p>主要注意创建网络模式是PRIVATE模式还是PUBLIC模式。PRIVATE模式下，新设备加入网络后需要额外确认，可以长期存在。PUBLIC模式不用额外确认，设备30天未登录后会自动删除。这里我用的是PRIVATE模式，为了安全也建议使用PRIVATE模式。</p><p><img class="lazy" data-height="903" src="https://imgheybox.max-c.com/bbs/2021/08/15/9b21458c4603a742115194cab8698b78/thumb.png" data-width="1261" referrerpolicy="no-referrer"></p><h4 class="img-desc">进阶设置</h4><p>下面可以设置网络内路由及ip池，ip池根据自己喜好选择即可，<b>但要保证和自己各个路由器下的子网不是同一个网段</b>。</p><h3>2.路由器设置</h3><p>2.1插件安装</p><p>想要能够通过zerotier访问ps5，<b>需要支持安装zerotier插件的路由器。</b></p><p>如果路由器不支持，那就只能在同一路由器下的PC上用虚拟机装openwrt当软路由，再在openwrt内使用zerotier插件，个人不是很推荐。</p><p>我用的是华硕的RT-AX86U，刷了梅林固件后在软件中心下直接安装zerotier插件即可。</p><p><img class="lazy" data-height="193" src="https://imgheybox.max-c.com/bbs/2021/08/15/1f9fec5377982e3c2850b2390e65a3b5/thumb.png" data-width="501" referrerpolicy="no-referrer"></p><h4 class="img-desc">路由插件</h4><p>2.2网络设置<br></p><p>安装好插件后进入插件，打开开关，自动允许客户端NAT的框√上（重要）。</p><p><img class="lazy" data-height="374" src="https://imgheybox.max-c.com/bbs/2021/08/15/015360d422a59ded8612f3827f64f690/thumb.png" data-width="755" referrerpolicy="no-referrer"></p><h4 class="img-desc">加入网络</h4><p>在join network栏输入之前在zerotier创建的网络ID，点击＋尝试加入网络。</p><p><img class="lazy" data-height="349" src="https://imgheybox.max-c.com/bbs/2021/08/15/8470ae0b5c9a6f7c7eb3cc9df6c55f5c/thumb.png" data-width="728" referrerpolicy="no-referrer"></p><h4 class="img-desc">尝试加入网络</h4><p>第一次加入网络需要在zerotier网页上授权设备。在zerotier网页的Members栏里会出现刚才连接的设备，将设备前面的Auth框√上就授权成功了。</p><p><img class="lazy" data-height="679" src="https://imgheybox.max-c.com/bbs/2021/08/15/db9c9f88a4849ad8c89bc82e7b7875a6/thumb.png" data-width="1859" referrerpolicy="no-referrer"></p><h4 class="img-desc">设备授权</h4><p>设备授权成功后，再次尝试联网应该就能顺利连上zerotier的网络了</p><p><img class="lazy" data-height="80" src="https://imgheybox.max-c.com/bbs/2021/08/15/850f9859bf9cf4d7d06b14f552c2e9db/thumb.png" data-width="1845" referrerpolicy="no-referrer"></p><h4 class="img-desc">连接成功</h4><p>连接上zerotier网络后，zerotier会给设备分配一个ip地址，我们需要通过这个ip去访问路由器下的ps5设备，需要设置路由<br></p><p><img class="lazy" data-height="349" src="https://imgheybox.max-c.com/bbs/2021/08/15/a6db0f6cd3da495a4d89e1fa7e5fe461/thumb.png" data-width="912" referrerpolicy="no-referrer"></p><h4 class="img-desc">路由设置</h4><p>在网页上找到Managed Routes，Destination栏填上ps5所在的子网（我这里是192.168.50.x网段，网页上就填写192.168.50.0/24），via栏填刚才zerotier给路由器分配的ip，Submit提交一下就完成路由的配置了~<br></p><p>2.3端口转发设置</p><p>为了保证能够顺利串流和远程开机的功能，需要在路由器上设置端口转发。</p><p>ps5远程串流的端口为<b>987、1935、3074、3478、3479、3480、9295、9296、9297、9302、9304</b>（网上找的，不一定准确，保险起见就都加上了）。</p><p>嫌麻烦也可以直接设置DMZ指向PS5。</p><h3>3.电脑设置</h3><p>电脑上下载zerotier客户端，安装好后在菜单栏小图标点击右键，选择join network，输入zerotier的网络id，尝试加入网络。</p><p><img class="lazy" data-height="112" src="https://imgheybox.max-c.com/bbs/2021/08/15/82c4d5208e505b73c2fff35bc03f4c52/thumb.png" data-width="311" referrerpolicy="no-referrer"></p><h4 class="img-desc">客户端加入网络</h4><p>此时电脑上会安装一个虚拟网卡，如果弹出来选项框都点是。第一次连接同样需要网页上授权。授权成功后在网页上查看是否正常分配到了ip。</p><p>*Android和IOS操作也是类似，安装好对应的客户端后加入网络即可。</p><h3>4.检查连接状态</h3><p>打开电脑的cmd命令，输入zerotier-cli peers可以查看zerotier网络下的设备连接情况。</p><p><img class="lazy" data-height="222" src="https://imgheybox.max-c.com/bbs/2021/08/15/906227b15fc9163b36b646bc4c985d5a/thumb.png" data-width="629" referrerpolicy="no-referrer"></p><h4 class="img-desc">用zerotier命令查看连接状态</h4><p>找到ps5所在路由的设备，可以查看连接状态，如果是DIRECT就是设备直连模式，数据直接P2P传输，延迟低，理论上能够跑满上行带宽。如果是RELAY则是转发模式，数据会经过Zerotier的服务器进行转发，延迟高，不适合进行远程串流，可以等待一会，设备之间会自动握手调整至直连模式。</p><p>使用ping命令检查和ps5的网络延时，正常直连状态下，同一运营商的延迟在10ms内，不同运营商之间的延迟在30ms左右,4G网络下到电信网络延迟在70ms左右。</p><p><img class="lazy" data-height="122" src="https://imgheybox.max-c.com/bbs/2021/08/15/0e27d16c94a651b1f4e909294bfcdf5d/thumb.png" data-width="434" referrerpolicy="no-referrer"></p><h4 class="img-desc">家里华数网至ps5的ping值</h4><p><img class="lazy" data-height="505" src="https://imgheybox.max-c.com/bbs/2021/08/14/b82b0e3bed1e5bdcbc43b538c23fb84a/thumb.png" data-width="1013" referrerpolicy="no-referrer"></p><h4 class="img-desc">内网穿透后网络情况</h4><hr><h2>Chiaki串流</h2><p>chiaki项目地址 https://git.sr.ht/~thestr4ng3r/chiaki </p><p>chiaki下载页面 https://git.sr.ht/~thestr4ng3r/chiaki/refs/v2.1.1</p><p><img class="lazy" data-height="687" src="https://imgheybox.max-c.com/bbs/2021/08/14/e6a3ebf7e16b67d2caca0e88902453f0/thumb.png" data-width="632" referrerpolicy="no-referrer"></p><h4 class="img-desc">chiaki各个版本下载</h4><h2>1.电脑串流</h2><p>在进行远程串流之前需要获取psn账号的串流id码。</p><p>如果电脑上有python环境，可以直接使用作者的脚本原版获取串流id</p><p>https://git.sr.ht/~thestr4ng3r/chiaki/tree/master/scripts/psn-account-id.py<br></p><p>没有python环境的小伙伴可以尝试用网页版本的网页版获取串流id</p><p>https://trinket.io/python3/85eea04996<br></p><p>使用方法：在sony账号登录页面登录成功后会自动跳转到显示redirect的网页，将这个网页的地址粘贴到网页版本控制台上回车运行即可，最后一行AccountID的内容就是串流id码。</p><p>或者使用网上大佬整的exe文件<a href="https://pan.baidu.com/s/1GtOs4Oq8ar0y56ScX8zlaw" target="_blank">exe获取串流id</a>，提取码：PSNS</p><p>https://pan.baidu.com/s/1GtOs4Oq8ar0y56ScX8zlaw<br></p><p>接下来在电脑上下载解压后打开chiaki软件。点击右上角的齿轮进入设置</p><p><img class="lazy" data-height="750" src="https://imgheybox.max-c.com/bbs/2021/08/15/d46d1c2094b6a8e11911af31666a04cb/thumb.png" data-width="784" referrerpolicy="no-referrer"></p><h4 class="img-desc">chiaki设置界面</h4><p>点击Register New开始注册新串流ps主机。</p><p><img class="lazy" data-height="281" src="https://imgheybox.max-c.com/bbs/2021/08/15/f4cbc76e0b872619a4324b68ec5b992c/thumb.png" data-width="451" referrerpolicy="no-referrer"></p><h4 class="img-desc">注册新串流ps5主机</h4><p>Account-ID输入之前获得的串流id码，PIN填写主机上远程游玩提供的8位数字，注册成功后主界面上就出现刚才注册的新主机了。</p><p><img class="lazy" data-height="230" src="https://imgheybox.max-c.com/bbs/2021/08/15/1da2eb5440021a554daf3bd12c3ff824/thumb.png" data-width="228" referrerpolicy="no-referrer"></p><h4 class="img-desc">ps5注册成功</h4><p>如果主机处于开机状态，直接双击就能开始远程串流了。如果主机处于待机状态，需要右键选择Send Wakeup Packet发送唤醒操作，然后再双击进行远程串流。主机完全关机的状态下无法使用噢~</p><p><img class="lazy" data-height="1036" src="https://imgheybox.max-c.com/bbs/2021/08/15/96ef027e275ddd5bbfdeafd74605cef0/thumb.png" data-width="1917" referrerpolicy="no-referrer"></p><h4 class="img-desc">电脑串流成功</h4><p>退出串流可以直接右上角关闭，会弹出提示框询问是否让主机进入待机状态。可以在设置里面Action On Disconnect进行默认项设置来关闭提示框。</p><p>可能遇到的情况：</p><p>1.画面一下清晰一下模糊，偶尔花屏。</p><p>网络不稳定或者网络带宽不足，可以尝试降低码率来获得更流畅的体验，经常花屏可能是两个网络的运营商不同，受运营商影响，限制了UDP上传导致偶尔断流。</p><p>2.声音不正常，爆音/卡顿等。</p><p>网上看有许多人也有类似情况，我自己也遇到了，可以通过以下方式来尝试解决：</p><p>①删除chiaki目录下audio文件夹内的qtaudio_windows.dll文件</p><p>②安装win10音频补丁<a href="https://www.microsoft.com/en-us/download/details.aspx?id=53356" target="_blank">音频补丁地址</a></p><p>https://www.microsoft.com/en-us/download/details.aspx?id=53356<br></p><p>③在设置里调整Audio Buffer Size值</p><h3>2.手机串流</h3><p>手机串流操作流程基本相同。手机连接上zerotier后，在chiaki app内注册串流主机成功后连接即可，还有虚拟按键可以使用。</p><p><img class="lazy" data-height="3835" src="https://imgheybox.max-c.com/bbs/2021/08/15/647373c6c26db5f8aaa0d372191e8aa7/thumb.jpeg" data-width="1440" referrerpolicy="no-referrer"></p><h4 class="img-desc">安卓新串流主机注册界面</h4><p><br></p><h2></h2><h2></h2><p><img class="lazy" data-height="1440" src="https://imgheybox.max-c.com/bbs/2021/08/15/5abbdda62ccbd8adff2bb8af375e7527/thumb.jpeg" data-width="3120" referrerpolicy="no-referrer"></p><h4 class="img-desc">手机串流成功</h4><p>※只有第一次注册串流的时候需要输入信息，后面就能直接连接了~enjoy~</p><hr><h2>总结</h2><p>这个方案下的远程串流总体体验还是不错的，低延迟+不错的流畅性+多平台加持，但还是牺牲了部分画质，不在同一网络下连接也很难做到非常稳定，更适合玩玩操作不多的游戏，或者用来挂机的游戏~</p>  
</div>
            