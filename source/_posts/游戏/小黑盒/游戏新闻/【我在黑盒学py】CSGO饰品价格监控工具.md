
---
title: '【我在黑盒学py】CSGO饰品价格监控工具'
categories: 
 - 游戏
 - 小黑盒
 - 游戏新闻
headimg: 'https://cdn.max-c.com/heybox/game/header/730_5pHpo.jpg'
author: 小黑盒
comments: false
date: Sat, 19 Mar 2022 18:03:27 GMT
thumbnail: 'https://cdn.max-c.com/heybox/game/header/730_5pHpo.jpg'
---

<div>   
<h2>0x00 前因</h2><p>由于最近的股市起伏比较大(亏得比较多)，发现某平台可以出租CSGO的皮肤后就把买的鸡精都卖出买了皮肤挂着租，虽然租金不算很高，但是再怎么也比鸡精稳定(白酒狗都不买)。</p><p><img data-gameid="730" src="https://cdn.max-c.com/heybox/game/header/730_5pHpo.jpg" referrerpolicy="no-referrer"></p><p><img class="lazy" data-height="1782" src="https://imgheybox.max-c.com/web/2022/03/19/2c5dfeb9f0a9919d259f590ded83183f/thumb.jpeg" data-width="1080" referrerpolicy="no-referrer"></p><h4 class="img-desc">蚊子腿也是肉</h4><p>由于资金有限，大多数皮肤都收的是酒精的，但是又想收低磨的，直接挂求购指不定给丢一个底磨的不太好，之前一直是没事就刷一刷市场看看有没有合适的可以收。今天闲着就寻思写一个监控脚本丢<b>云函数</b>定时运行，就不用一直盯着市场了。我设置好需要的磨损区间和心理价位，工具每半小时进行一次扫描，如果有符合条件的饰品就推送信息到微信，然后就可以直接去买。</p><hr><h2>0x01 原理简介</h2><blockquote><p>根据以往经历，这玩意儿不能写太细，不然发不出来。大家有兴趣可以移步52Pojie，我会在上面发布详细说明版，下面仅从思路上简单介绍一下。</p></blockquote><p>我使用的租皮肤的平台和本工具监控的饰品市场不是同一个APP，大家可以自行想象，这里不便明说。</p><p>我们在电脑上打开这个饰品平台，随便打开一个饰品的购买页面，先单独请求一下这个购买页面，发现并没有我们想要的饰品数据，可以认为数据在数据包中发送到浏览器。</p><p><img class="lazy" data-height="362" src="https://imgheybox.max-c.com/web/2022/03/19/6da9ee0b9bfcc0675df91fd2ae2b9d9b/thumb.png" data-width="1922" referrerpolicy="no-referrer"></p><h4 class="img-desc">小龙狙~</h4><p>那么就进行一个抓包，按F12打开控制台，点击网络的选项，勾选“<b>Fetch/XHR</b>”，进行分析。</p><p><img class="lazy" data-height="898" src="https://imgheybox.max-c.com/web/2022/03/19/46771d115ec3dbeeb00c9a59c8f4e1ef/thumb.png" data-width="1374" referrerpolicy="no-referrer"></p><h4 class="img-desc">找到这个sell开头的包</h4><p>发现返回的数据有很多，高度怀疑这个包是我们想要的。</p><p>点开data前面的小按钮，发现出现了很多数据，这就是我们想要的数据，接下来对这些数据进行仔细分析。</p><p><img class="lazy" data-height="325" src="https://imgheybox.max-c.com/web/2022/03/19/05e5db7035007dcecd993676b4eabff1/thumb.png" data-width="1033" referrerpolicy="no-referrer"></p><h4 class="img-desc">找到你了</h4><p>首先看看这个包的请求链接长啥样（已删除链接前的域名，仅分析链接的构成参数）</p><blockquote><p>api/market/goods/sell_order?game=csgo&amp;goods_id=871801&amp;page_num=1&amp;sort_by=default&amp;mode=&amp;allow_tradable_cooldown=1&amp;_=1647677447842</p></blockquote><p>从这个链接里面我们可以发现有很多的参数，先由小学英语学到的单词进行阅读并删除一些空参数，得到这样一条简化链接，篇幅限制我删掉了用于排序的参数，仅保留两项最基本的参数</p><blockquote><p>api/market/goods/sell_order?game=csgo&amp;goods_id=<b>good_id</b>&amp;page_num=1&amp;_=<b>time</b></p></blockquote><p>可见一个是good_id和一个time，也就是时间戳。简单观察一下不难发现相关饰品的页面链接就有这个good_id，并且我们切换不同的磨损（指从崭新出厂到酒精的这种变化，不是同阶的磨损变化）这个good_id也会跟着发生变化，所以我们监控饰品就可以通过输入这个goodid找到想要的商品，第二个参数time也比较好理解，就是当前时间的时间戳，这个可以直接生成。</p><p>首先看goods_info，不难发现这里面主要是当前请求的饰品的一些参数，但不是我们想要的，再看看别的数据</p><p><img class="lazy" data-height="321" src="https://imgheybox.max-c.com/web/2022/03/19/164a5e7ec230aa4372f24a466b03670a/thumb.png" data-width="841" referrerpolicy="no-referrer"></p><h4 class="img-desc">码掉的是对应的logo链接</h4><p>打开items，发现是一个列表，高度怀疑这就是在售饰品的数据，点开第一个，果然是，利用小学英语学到的知识简单的读一下</p><p><img class="lazy" data-height="535" src="https://imgheybox.max-c.com/web/2022/03/19/3e5fe58ab9db887cec80f1a32da022c2/thumb.png" data-width="852" referrerpolicy="no-referrer"></p><h4 class="img-desc">码掉了商家的uid</h4><p>可以发现在这里面有当前饰品的标价，并且这个表格里面返回的饰品是按照价格低到高排序的，那么当前这个价格就是该饰品在售列表里最低价，如果在前面的请求链接中设置了磨损区间等也同理。<br></p><p>目前为止我们就已经找到了最低售价的商品了，但是我想更进一步，直接在推送中附上该底价商品的购买页面，由于PC端没有单独的购买页面，所以在手机应用中找到一个该类型的商品，点击分享，并复制他的链接，然后我们就得到了以下链接</p><blockquote><p>market/m/item_detail?classid=4578724378&amp;instanceid=519977179&amp;game=csgo&amp;assetid=24916944078</p></blockquote><p>这里我们发现需要的参数有点多，但是不要慌，肯定都是能够找得到的；继续看数据，在asset_info中找到了构造上面商品链接所需要的参数</p><p><img class="lazy" data-height="284" src="https://imgheybox.max-c.com/web/2022/03/19/7cd40601e35b1dd0667896e9c4e7d626/thumb.png" data-width="975" referrerpolicy="no-referrer"></p><h4 class="img-desc">有手就行</h4><p>自此我们就已经完成了对该饰品网站的分析，接下来进行程序的编写。篇幅有限这里我就不贴完整代码了，简单讲解一下思路，有兴趣的同学可以下载源码自己看，一共也就不到八十行。</p><p>首先是数据储存，我这里用了一个在线数据库<b>Bmob</b>，这玩意儿我高三就在用了，给一些小玩具放一下需要联网的数据还是挺方便的，也不担心他跑路。</p><p>在里面新建一个表，并设置好这些列“good_id”，“name”，“except_price”，“lowest_price”</p><p><img class="lazy" data-height="137" src="https://imgheybox.max-c.com/web/2022/03/19/708a275395bd58f623faceddabd7c41e/thumb.png" data-width="824" referrerpolicy="no-referrer"></p><h4 class="img-desc">务必按照上面的列名进行设置，否则将无法运行</h4><p>通过Bmob官方提供的包可以很方便的对Bmob在线数据库进行操作，每次运行获取good_id和except_price，接着利用requests模块对构造好的饰品链接发起请求并解析返回的数据，利用json模块对数据进行格式化处理，通过获取到的最低价与数据库中设置的except_price进行比较，如果低于期望价格，则推送微信消息进行提示，如下图</p><p><img class="lazy" data-height="589" src="https://imgheybox.max-c.com/web/2022/03/19/449e3ab5a9ecc28315b7db9bcbedbf8b/thumb.png" data-width="638" referrerpolicy="no-referrer"></p><h4 class="img-desc">芜湖~</h4><p>以上就是整个监控工具的思路，具体代码可以下载文末附件</p><hr><p>0x02 云函数部署<br></p><h3>①Bmob</h3><p>首先去注册一个Bmob的账号，百度搜索<b>“Bmob”</b>即可，注册完成之后好像要给一块钱实明认证一下，接着进入控制台新建一个数据库，选择第一个免费的开发版即可。</p><p><img class="lazy" data-height="652" src="https://imgheybox.max-c.com/web/2022/03/19/b5e94f2bb9fd5161eeeb3d7859b15d1b/thumb.png" data-width="749" referrerpolicy="no-referrer"></p><h4 class="img-desc">记得选应用类型，否则没法创建</h4><p>新建好数据库后默认只有一个“_User”表，点击<b>“添加表”按钮</b>，新建一个表，就叫他<b>“Buff</b></p><p><b>”</b>吧，意为赚钱buff；注意大小写，也可以改为自己喜欢的名字，但需在代码中对应的位置进行修改。</p><p><img class="lazy" data-height="172" src="https://imgheybox.max-c.com/web/2022/03/19/38dfa4debf6fb1dc810ddfca629c9118/thumb.png" data-width="226" referrerpolicy="no-referrer"></p><p><br></p><p><img class="lazy" data-height="359" src="https://imgheybox.max-c.com/web/2022/03/19/06e0bfe92e33a3c59ed3f9dbe73cd921/thumb.png" data-width="750" referrerpolicy="no-referrer"></p><p>新建好一个表后，我们给他添加对应的列，点击添加列，进行新增。</p><p>务必按照<b>“good_id”，“name”，“except_price”，“lowest_price”</b>的名字进行命名，顺序无所谓，可以左右拖拽调整，列类型都用默认的String型即可</p><p><img class="lazy" data-height="625" src="https://imgheybox.max-c.com/web/2022/03/19/a386b444e9ca81a176c9656cb223b487/thumb.png" data-width="993" referrerpolicy="no-referrer"></p><p>设置好后，点击左侧工具栏最低侧的设置按钮，点击“<b>应用秘钥</b>”，复制Application ID和REST API Key，后面有用</p><p><img class="lazy" data-height="809" src="https://imgheybox.max-c.com/web/2022/03/19/1f54a7d88c586d27644a934a566d9bad/thumb.png" data-width="682" referrerpolicy="no-referrer"></p><h3>②微信推送</h3><p>我用的是Server酱，有能力的同学可以自行接入其他的推送方法。百度搜索“<b>Server酱</b>”即可</p><p>Server酱是一个免费的微信信息推送工具，网站里面也有很详细的使用方法，本文不再赘述。注册并设置好Server酱后，点击上方工具栏的SendKey，复制自己的SendKey，后续有用。</p><p><img class="lazy" data-height="339" src="https://imgheybox.max-c.com/web/2022/03/19/d06b3d6279f1133738346a68f4803ec3/thumb.png" data-width="925" referrerpolicy="no-referrer"></p><h4 class="img-desc">复制你的SendKey</h4><h3>③云函数<br></h3><blockquote><p>我使用的是疼讯云函数，其他的云服务商也有功能相近的服务，本工具仅保证可以在疼讯云正常使用，其他的云平台没有进行测试。</p></blockquote><p>首先百度“腾讯云”，进入官网后注册一个账号，完成实明认证，接着进入控制台，点击左上角的云产品按钮，找到云函数（大概在左侧靠近中间的位置），点击进入</p><p><img class="lazy" data-height="684" src="https://imgheybox.max-c.com/web/2022/03/19/8b353a32bb4b6d2f11a9a74d69aed306/thumb.png" data-width="507" referrerpolicy="no-referrer"></p><h4 class="img-desc">云函数</h4><p>进入页面点击新建按钮，选择<b>“从头开始”</b>，设置Python版本为<b>3.6</b></p><p><img class="lazy" data-height="596" src="https://imgheybox.max-c.com/web/2022/03/19/1e0e0f00148ff58696a1021521415f5c/thumb.png" data-width="1001" referrerpolicy="no-referrer"></p><h4 class="img-desc">请选择Python3.6</h4><p>往下滑动，点击文件夹上传，将文末的代码下载解压后，选择解压出来的文件夹，进行上传；将执行方法修改为如图所示，注意大小写</p><blockquote><p>Main.main</p></blockquote><p><img class="lazy" data-height="327" src="https://imgheybox.max-c.com/web/2022/03/19/4aaff40baa0333844b1beab6885dc14a/thumb.png" data-width="781" referrerpolicy="no-referrer"></p><p>点击完成等待部署，点击函数管理，进入函数代码页面，在右侧代码编辑区域中设置Server酱和Bmob的key</p><p><img class="lazy" data-height="836" src="https://imgheybox.max-c.com/web/2022/03/19/7acbe507c4a947691f62fa24f4d3f44d/thumb.png" data-width="1626" referrerpolicy="no-referrer"></p><p>将SendKey替换为你的SendKey即可，Bmob的两条Key记得<b>加上引号</b>，形如</p><blockquote><p>Bmob(<b>'</b>efg123<b>'</b>,<b>'</b>abc456<b>'</b>)</p></blockquote><p>填写好参数后，设置完成之后点击代码编辑区域右上角的部署按钮，接着点击左侧的触发管理，新建一个触发器</p><p><img class="lazy" data-height="459" src="https://imgheybox.max-c.com/web/2022/03/19/1de9577d9446398be9b8cd1ccff33cd5/thumb.png" data-width="506" referrerpolicy="no-referrer"></p><p><img class="lazy" data-height="416" src="https://imgheybox.max-c.com/web/2022/03/19/f490c40919fc606f83ecca1990994f15/thumb.png" data-width="609" referrerpolicy="no-referrer"></p><p>触发方式选择定时触发，触发周期推荐设置为每半小时，过快的请求会导致饰品市场BanIP。</p><p>要验证是否设置好参数，可以先在Bmob的数据库中添加一个饰品，except_price设置高于市场均价，确保有比他低价的视频，进入云函数，点击代码编辑区域右上角的测试按钮，如果手机能够正常收到推送则说明工具已经成功配置好。</p><hr><h2>0x03 小结</h2><p>本工具仅作市场价格监控及推送作用，并未要求用户登录齐饰品交易网站账号，也没用收集任何敏感信息，代码完全开源，仅做学习交流使用，请在下载后24小时内删除，谢谢！</p><p>下载链接：mrdeng.lanzouj.康姆/iSznF01p6cdi</p><p><a href="heybox://open_subject" target="_blank">#神来之作第十期#</a><br></p><p>如果觉得本文对你有帮助的话，请来一个三连叭~</p><p><img class="lazy" data-height="419" src="https://imgheybox.max-c.com/web/2022/03/19/cb6b107a1a055e6d1d076b9c1c485fb6.gif" data-width="960" referrerpolicy="no-referrer"></p>  
</div>
            