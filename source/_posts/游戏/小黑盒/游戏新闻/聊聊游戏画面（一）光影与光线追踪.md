
---
title: '聊聊游戏画面（一）光影与光线追踪'
categories: 
 - 游戏
 - 小黑盒
 - 游戏新闻
headimg: 'https://imgheybox.max-c.com/bbs/2021/07/30/11f4b058897b04b9beaa435e51b462a0/thumb.jpeg'
author: 小黑盒
comments: false
date: Fri, 30 Jul 2021 18:35:01 GMT
thumbnail: 'https://imgheybox.max-c.com/bbs/2021/07/30/11f4b058897b04b9beaa435e51b462a0/thumb.jpeg'
---

<div>   
<p>开坑个小科普系列给大伙聊聊画质好到底好在哪。想起来什么说什么<span data-emoji="cube_滑稽" class="hb-emoji"></span>这期先从光影开始</p><p>为啥这个世代那么吹捧光线追踪呢，追光为了什么？</p><p><img class="lazy" data-height="2160" src="https://imgheybox.max-c.com/bbs/2021/07/30/11f4b058897b04b9beaa435e51b462a0/thumb.jpeg" data-width="3840" referrerpolicy="no-referrer"></p><h4 class="img-desc">地铁离去山姆故事dlc截图</h4><p>人对光感知是与生俱来的，通过明暗、阴影关系人脑可以瞬间感受到物品的立体感和场景层次感，所以作为平面画面带给人空间感受的游戏，在建模和铺设场景基础上，光影就是最重要的一步。</p><p><br></p><p>早年机能有限时候，德军总部3D为了实现3D画面id software怎么处理的呢？他们使用了“光线追踪”<span data-emoji="cube_doge" class="hb-emoji"></span></p><p>他们让屏幕上每列纵向像素发射一排光线，感知地图的纵深感来得知周围墙壁角度、方位，最终实现3D画面。这个思路也是目前光线追踪的核心（并且游戏画面发展史完全可以用id他们制作DOOM系列发展直接概括，结尾时候还会再说）</p><p>时间快进到ps3年代，那会机器已经足够性能解决模型多边形数量，基本画面不会因为模型限制画面观感，因而开发者逐渐转向光影。但是游戏光影的塑造跟绘画、摄影、影视特效类似是最耗费人力物力性能的步骤，尤其是动态光照。开发者想到的是，反正光照和阴影都是表现在物品和场景表面，为何不直接作为贴图一部分制作进去呢<span data-emoji="cube_滑稽" class="hb-emoji"></span>，因此那个时期，阴影贴图（shadow map）和光照贴图（lighting map）大量使用，就是说游戏制作者根据预先后台光照运算结果的阴影或者光的位置直接粘贴图表面，比如DOOM3里，有阴影的地方就一黑贴图在那</p><p><img class="lazy" data-height="698" src="https://imgheybox.max-c.com/bbs/2021/07/30/4f1dabf81cf6d72262731f52de701097/thumb.png" data-width="925" referrerpolicy="no-referrer"></p><p>实际上这种技术一直延续至今，好处就是占点内存（某些占显存）为代价节省大量运行消耗资源，比如美末二为啥能在ps4上实现那种级别画面，最重要的基础就是shadow map</p><p>就比如下面这个场景</p><p><img class="lazy" data-height="2160" src="https://imgheybox.max-c.com/bbs/2021/07/30/661522c46bc750e9e328cc9e636f6462/thumb.png" data-width="3840" referrerpolicy="no-referrer"></p><p>墙上的亮区域与暗部阴影就是shadow map 和lighting map的效果，甚至下面的水面反射也是cube map（涉及反射时候再细说<span data-emoji="cube_滑稽" class="hb-emoji"></span>）</p><p>这种方式坏处一个是制作时候需要耗费美术人员大量时间，还一个是很难做到动态效果，因为光源如果改变为了不出戏必须重新制作一次贴图，再一个就是上面贴图分辨率如果做的很高反而会耗费太多资源得不偿失</p><p><img class="lazy" data-height="2160" src="https://imgheybox.max-c.com/bbs/2021/07/30/561a10aa548bd22cdc06a7ebbda5c5ed/thumb.png" data-width="3840" referrerpolicy="no-referrer"></p><h4 class="img-desc">阴影分辨率细看其实很低</h4><p><img class="lazy" data-height="2160" src="https://imgheybox.max-c.com/bbs/2021/07/30/5d17a831ebffdf1d436e1477293b81c6/thumb.png" data-width="3840" referrerpolicy="no-referrer"></p><h4 class="img-desc">应该是因为失误左边箱子背光面露在前方</h4><p>所以说同样发售在ps3上的gta4和gta5，不仅在场景规模和模型细节上进行提升，最重要的r星在ps3那么小内存上实现了开放世界动态光影（不是动态光照）城市会随着时间改变发生明显的照明变化视觉效果。相比gta4天气效果更加明显，场景色调更多元化</p><p>死亡搁浅优化好的基础也是静态世界预渲染好的各处阴影，尤其是远景的山峰阴影和近处小石块背光面阴影</p><p>而且死亡搁浅pc版不管画质设置如何，第一次载入游戏总会载入一个预设画面设置版本，再根据玩家自定义选项进一步改动</p><p><img class="lazy" data-height="2160" src="https://imgheybox.max-c.com/bbs/2021/07/30/350e784d3495f7022059ba07f9e42883/thumb.png" data-width="3840" referrerpolicy="no-referrer"></p><h4 class="img-desc">可能也是失误，短的阴影长 长的阴影短</h4><p>静态渲染还一个问题在于，传统光栅渲染方式没法得知接触物品之间的阴影关系，很多场景中各个模块都是单独呈现预设shadow map 制作组想再次给细节丰富的区域一点一点烘焙小阴影显然太浪费时间了，为了提升观感势必要对shadow map进行改善。于是ps3时代晚期和ps4时代早起才大量应用的辅助性阴影技术来了，环境光遮蔽</p><p>（注：所有说到什么什么时代的技术是普及应用在游戏业的时间，实际在影视渲染行业可能很早就有了只是硬件限制很难利用在游戏上）。比较常见利用这个技术的游戏有前后左右关系的物品周围会有黑边阴影（比如战地1和战地5，一墙前面物品往往是一圈阴影包围住）现在比较消耗性能的屏幕空间环境光遮蔽（SSAO）就是基于crytek开发的实时环境光照贴图技术，那段时间游戏黑边数量更是恐怖，可以看看育碧孤岛惊魂3</p><p><img class="lazy" data-height="412" src="https://imgheybox.max-c.com/bbs/2021/07/30/58d1e4192eb1046a210c56fd0c7dba0b/thumb.png" data-width="223" referrerpolicy="no-referrer"></p><h4 class="img-desc">上面每个球的明暗就是预设的阴影贴图但是物品之间没有任何投影和遮蔽效果</h4><p><img class="lazy" data-height="659" src="https://imgheybox.max-c.com/bbs/2021/07/30/dc842327fb87a43b49f5a7bab4276342/thumb.png" data-width="1264" referrerpolicy="no-referrer"></p><p><img class="lazy" data-height="179" src="https://imgheybox.max-c.com/bbs/2021/07/30/807e271b176d1021f5ccc64d294cca63/thumb.png" data-width="615" referrerpolicy="no-referrer"></p><p>美末一里也是大量使用这种技术，还有只狼开启后场景黑边处处可见，虽然增加了立体感，但是看久了场景越发不写实 反而像美漫风<span data-emoji="cube_喷水" class="hb-emoji"></span></p><p>但是更高级环境光遮蔽也能塑造好的光影效果 别用恶魔之魂重制版</p><p><img class="lazy" data-height="2160" src="https://imgheybox.max-c.com/bbs/2021/07/30/cf3a5667670ec8d812b8bbe8c88d6349/thumb.jpeg" data-width="3840" referrerpolicy="no-referrer"></p><p><img class="lazy" data-height="2160" src="https://imgheybox.max-c.com/bbs/2021/07/30/96e872a931f9dcf8beb3546b6fd69664/thumb.jpeg" data-width="3840" referrerpolicy="no-referrer"></p><p><img class="lazy" data-height="2160" src="https://imgheybox.max-c.com/bbs/2021/07/30/4379cfcaa577340bedb7b78d8b4eb44d/thumb.jpeg" data-width="3840" referrerpolicy="no-referrer"></p><p><img class="lazy" data-height="750" src="https://imgheybox.max-c.com/bbs/2021/07/30/d0c4003b7db08e6b01fccf3892da005b/thumb.jpeg" data-width="1333" referrerpolicy="no-referrer"></p><p>然后，18年时候R星又出面了，在同时代的ps4平台发售荒野大镖客：救赎2，这游戏虽然看似和以前游戏没太大区别，但是这游戏在同时代实现了两大进步</p><p>1：实现野外场景全局动态光影视觉效果</p><p>2：第一次把各种光影特效设置区分为前景近景和远景空间</p><p>第一点可以彻底改善野外景色场景总体感，就好比画画时候整体一看给人的“光感” 很难让人找到出戏的地方（室内场景没啥办法还是老的技术SSAO拉满黑边依旧）</p><p><img class="lazy" data-height="1080" src="https://imgheybox.max-c.com/bbs/2021/07/30/f740d291767a96f87914fa38fae2643b/thumb.png" data-width="1920" referrerpolicy="no-referrer"></p><p><img class="lazy" data-height="2160" src="https://imgheybox.max-c.com/bbs/2021/07/30/57534af6c927816607833cc3c47ded87/thumb.jpeg" data-width="3840" referrerpolicy="no-referrer"></p><h4 class="img-desc">室内SSAO</h4><p><img class="lazy" data-height="1440" src="https://imgheybox.max-c.com/bbs/2021/07/30/e9ec17673b6559a58f08d74b057e274a/thumb.jpeg" data-width="3440" referrerpolicy="no-referrer"></p><h4 class="img-desc">野外整个场景共享一个光源</h4><p>第二点可以让光线特效更有层次感，平时社区看到的荒野大镖客截图往往会有所谓“丁达尔效应”的光柱，游戏画面选项长阴影，或者叫god ray</p><p><img class="lazy" data-height="2160" src="https://imgheybox.max-c.com/bbs/2021/07/30/e7eb86b61075da80146511cac98da5a9/thumb.jpeg" data-width="2880" referrerpolicy="no-referrer"></p><h4 class="img-desc">推特偷的图👀</h4><p>2年后美末二也大量利用了有体积感的god ray</p><p><img class="lazy" data-height="2160" src="https://imgheybox.max-c.com/bbs/2021/07/30/3f7e1124c968baf87a0666a256cb4ddf/thumb.jpeg" data-width="3840" referrerpolicy="no-referrer"></p><p><img class="lazy" data-height="2160" src="https://imgheybox.max-c.com/bbs/2021/07/30/6965309fc4584160716894f5d08b735b/thumb.jpeg" data-width="3840" referrerpolicy="no-referrer"></p><p><img class="lazy" data-height="2160" src="https://imgheybox.max-c.com/bbs/2021/07/30/9e03bb1ff50f88c0bdb981a73d575800/thumb.jpeg" data-width="3840" referrerpolicy="no-referrer"></p><p>这种光影特效往往配合另一个吃性能的连春晚技术组都吹的“次世代“体积雾气</p><p><img class="lazy" data-height="2160" src="https://imgheybox.max-c.com/bbs/2021/07/30/98cbae3609dd8c47f3c6543a3347d052/thumb.jpeg" data-width="3840" referrerpolicy="no-referrer"></p><p><img class="lazy" data-height="2160" src="https://imgheybox.max-c.com/bbs/2021/07/30/541c5b2e3636d45beb026d8f623ec4f7/thumb.jpeg" data-width="3840" referrerpolicy="no-referrer"></p><p><img class="lazy" data-height="2160" src="https://imgheybox.max-c.com/bbs/2021/07/30/09fda894f9e2ce5353c2144a7ae98690/thumb.jpeg" data-width="3840" referrerpolicy="no-referrer"></p><p><img class="lazy" data-height="2160" src="https://imgheybox.max-c.com/bbs/2021/07/30/3d6bce0552cee25b4bac18358d42cbb0/thumb.jpeg" data-width="3840" referrerpolicy="no-referrer"></p><p><img class="lazy" data-height="2160" src="https://imgheybox.max-c.com/bbs/2021/07/30/3f65ae40fbdd8fe78d4e0cb17d42986b/thumb.jpeg" data-width="3840" referrerpolicy="no-referrer"></p><p><img class="lazy" data-height="2160" src="https://imgheybox.max-c.com/bbs/2021/07/30/7de0355a2d49b8c0b1b2a3d47ec3f5cf/thumb.png" data-width="3840" referrerpolicy="no-referrer"></p><p>就是雾气显出的亮度是根据周围环境深度进行渐变，增加场景层次感，结合剧情也能更好塑造气氛</p><p>这些云雾效果还有各种空间粒子效果因为不可控所以容易造成优化灾难，但是又对气氛塑造有很多帮助，也就ps4时代末期才大量使用</p><p>为了进一步满足动态光影还有正确阴影表现，时间到了真正光照技术进步的时代</p><p>就是实时光线追踪</p><p>光追用LSP的话来说就是屏幕上每个像素（注意有别与德军总部那个纵向一列像素）都射出一个小蝌蚪，小蝌蚪在场景里面不断碰撞反射去找麻麻（光源）找到麻麻后记录下自己经历的过程运算出应有的颜色，毕竟光路有可逆性，按照这个方案一定可以实现更加真实的光照效果。但是光追一开始被人知道是因为光线追踪反射，今天重点说的是光线追踪全局光照（ray  tracing global illumination）这种技术重点在于可以不仅可以实现光打在物品产生的阴影（比如COD的光追）还能实现光打在一个表面后进一步的漫反射效果</p><p><img class="lazy" data-height="875" src="https://imgheybox.max-c.com/bbs/2021/07/30/7ba84993fcae79ff00a5980f22841a5b/thumb.png" data-width="1573" referrerpolicy="no-referrer"></p><h4 class="img-desc">我个人觉得最适合给人介绍全局光照效果的对比图 投进屋内地面的光再次照亮屋内其他部分</h4><p><img class="lazy" data-height="1080" src="https://imgheybox.max-c.com/bbs/2021/07/30/8d0a9a5ad0b922301f4bacedb6f91dc0/thumb.jpeg" data-width="2340" referrerpolicy="no-referrer"></p><h4 class="img-desc">这个是一老外拿吸收光线99.999%的材料涂满一间房子并且头顶开启一盏灯，所以周围墙壁纯黑，但是他手中的纸下表面因为漫反射效果部分光照亮了上表面</h4><p>因此有了全局光照的游戏光影真实感达到历史顶峰</p><p><img class="lazy" data-height="2160" src="https://imgheybox.max-c.com/bbs/2021/07/30/0d3f342a38f9676eab7f1fa16b3b62f5/thumb.jpeg" data-width="3840" referrerpolicy="no-referrer"></p><h4 class="img-desc">无光追 传统渲染方式，各个表面自己享受自己的shadow map，仔细看很多地方明暗有割裂感注意车顶</h4><p><img class="lazy" data-height="2160" src="https://imgheybox.max-c.com/bbs/2021/07/30/b4e58e6aa76f5857c1d6c2dc46aeccd4/thumb.jpeg" data-width="3840" referrerpolicy="no-referrer"></p><h4 class="img-desc">开启光追后 各个表面有漫反射影响，画面有了整体性</h4><p><img class="lazy" data-height="2160" src="https://imgheybox.max-c.com/bbs/2021/07/30/2f82f40ab04bb956b8e7269dd79981a6/thumb.png" data-width="3840" referrerpolicy="no-referrer"></p><h4 class="img-desc">无光追情况下，瓶子只知道背光面应该全黑</h4><p><img class="lazy" data-height="2160" src="https://imgheybox.max-c.com/bbs/2021/07/30/5949283de80f8d8ea6357ce4a857704f/thumb.jpeg" data-width="3840" referrerpolicy="no-referrer"></p><h4 class="img-desc">有光追情况下背光面得知旁边罐子的反射还有周围墙壁漫反射，层次感增加</h4><p><img class="lazy" data-height="2160" src="https://imgheybox.max-c.com/bbs/2021/07/30/8b7b7087cfe3cb2c2b26569f5f102b1f/thumb.jpeg" data-width="3840" referrerpolicy="no-referrer"></p><h4 class="img-desc">光洒进机舱下表面又反射给上表面</h4><p>其实少量漫反射可以人为模拟，比如美末一和美末二的手电筒找到墙壁都可以根据墙壁颜色再次反射给其他部分</p><p>而且美末二也加入了部分外部场景漫反射</p><p><img class="lazy" data-height="2160" src="https://imgheybox.max-c.com/bbs/2021/07/30/1dcfe4a1669aeabb997081703b81d589/thumb.jpeg" data-width="3840" referrerpolicy="no-referrer"></p><h4 class="img-desc">注意右下角的楼梯，水泥阶梯被旁边墙壁映出粉色</h4><p><img class="lazy" data-height="2160" src="https://imgheybox.max-c.com/bbs/2021/07/30/b4e14c5671d915f5739a67ed44c3dd94/thumb.jpeg" data-width="3840" referrerpolicy="no-referrer"></p><h4 class="img-desc">二楼房顶 有地毯的漫反射</h4><p><img class="lazy" data-height="2160" src="https://imgheybox.max-c.com/bbs/2021/07/30/39ee3e560113aad3a13395a2d744fa2e/thumb.jpeg" data-width="3840" referrerpolicy="no-referrer"></p><h4 class="img-desc">车门有旁边草地绿色光</h4><p>但是人力总归有限，只能依靠美术工作者不断打磨才能实现，光追可以说是一次性全部场景打包实现<span data-emoji="cube_滑稽" class="hb-emoji"></span></p><p><img class="lazy" data-height="2160" src="https://imgheybox.max-c.com/bbs/2021/07/30/dc26567306c0d666ee0ee73bd3ca3d75/thumb.jpeg" data-width="3840" referrerpolicy="no-referrer"></p><h4 class="img-desc">过几天epic送的瘟疫传说貌似也给右边短墙加了点反射效果</h4><p><img class="lazy" data-height="2160" src="https://imgheybox.max-c.com/bbs/2021/07/30/3432f4bbe6f5829e7e0417edd0fdee2c/thumb.png" data-width="3840" referrerpolicy="no-referrer"></p><h4 class="img-desc">机八超“大”的大厅 大可能还没跟过来</h4><p><img class="lazy" data-height="2160" src="https://imgheybox.max-c.com/bbs/2021/07/30/88041bf1d4ca981e6e41654666037a59/thumb.png" data-width="3840" referrerpolicy="no-referrer"></p><h4 class="img-desc">右下有个高亮 就是因为反射</h4><p>平时天天看到的世界可能已经习以为常，通过游戏或者绘画的视觉手法重新认识周围世界光影的美增加不少生活情趣</p><p>在这用一下一盒友的自拍图<span data-emoji="cube_doge" class="hb-emoji"></span></p><p><img class="lazy" data-height="4000" src="https://imgheybox.max-c.com/bbs/2021/07/30/02303aecd1927c7bc9e1bd1516784148/thumb.jpeg" data-width="3000" referrerpolicy="no-referrer"></p><h4 class="img-desc">地面亮起的部分照亮侧面隧道效果</h4><p><img class="lazy" data-height="1080" src="https://imgheybox.max-c.com/bbs/2021/07/30/9fa612cf9cd1f904917f079c9d1e61d3/thumb.png" data-width="1920" referrerpolicy="no-referrer"></p><h4 class="img-desc">打了光影mod的gta sa 看雕像在干啥</h4><p>总之，游戏界不断提升光照技术，这是开发人员对玩家审美水平上升的认可，说明开发者认为有玩家可以感受到他们的工作成果，写这个帖子的目的也是让更多人提高审美 了解技术进步（花更多钱）具体视觉上提升在哪，也对得起不断打磨游戏的有工匠精神的美术人员的劳作 </p><p><img class="lazy" data-height="2160" src="https://imgheybox.max-c.com/bbs/2021/07/30/0ff9704023ce5822b7564d8343b76a45/thumb.png" data-width="3840" referrerpolicy="no-referrer"></p><h4 class="img-desc">封面</h4><p>下期聊聊关于反射的事<span data-emoji="cube_晕" class="hb-emoji"></span></p><p><img class="lazy" data-height="2160" src="https://imgheybox.max-c.com/bbs/2021/07/30/9667d77a30ae40b2b96c18ab6ac451a8/thumb.jpeg" data-width="3840" referrerpolicy="no-referrer"></p><p><a href="heybox://open_subject" target="_blank">#创作漫游指南#</a>  <a href="heybox://open_subject" target="_blank">#单机游戏#</a> <br></p>  
</div>
            