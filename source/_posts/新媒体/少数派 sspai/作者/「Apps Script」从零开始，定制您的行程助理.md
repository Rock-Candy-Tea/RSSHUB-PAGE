
---
title: '「Apps Script」从零开始，定制您的行程助理'
categories: 
 - 新媒体
 - 少数派 sspai
 - 作者
headimg: 'https://cdn.sspai.com/editor/u_/c4r13hdb34t8ar53fieg.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
author: 少数派 sspai
comments: false
date: Mon, 06 Sep 2021 13:09:50 GMT
thumbnail: 'https://cdn.sspai.com/editor/u_/c4r13hdb34t8ar53fieg.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
---

<div>   
<div class="articleWidth-content" data-v-0b37afcb><div class="update-wrap" data-v-0b37afcb></div><div class="content wangEditor-txt minHeight" data-v-0b37afcb><h2>前言</h2><blockquote><p>Google Apps Script 是一个快速的应用程序开发平台，可以快速、轻松地创建与 Google Workspace 集成的商业应用。你可以用现代的 JavaScript 编写代码，并可以访问最喜欢的 Google Workspace 应用程序的内置库，如 <strong>Gmail</strong>、日历、Drive 等。没有任何东西需要安装--我们在你的浏览器中给你一个代码编辑器，而你的脚本在谷歌的服务器上运行。</p></blockquote><p>上述引用来自于 <a href="https://developers.google.com/apps-script/overview" target="_blank">Google Apps Script 引导页</a>。根据描述，用户可以通过编写 JavaScript 代码，对 Google 家的部分应用进行操作。</p><p>例如<strong>读取 Gmail 的邮件、日历的日程、表格的单元格等</strong>。也可以<strong>实现发送邮件</strong>等操作。</p><p>看到可以读取 Gmail 和发送邮件，突然来了点子💡</p><p><strong>我们是不是可以自动提取行程信息</strong>，根据自己需求，定制自己的行程助理？例如火车票、机票预定、酒店预定等信息，收到邮件后，由脚本处理再转发到 GTD 软件，到了时间后自动提醒，可以完美执行 GTD 理念中的 <strong>“记录，然后忘掉”</strong> 的原则～既然想到了，那就开始做！</p><blockquote><p>当然，可以操作 Google 家数据 ，哪只能实现这点需求，故本文将是 App Script 分享的第一篇，之后还会折腾，实现各种需求～也可以在评论区中添加您的需求，我会尽力而为。</p></blockquote><h3>效果</h3><p>解锁，右滑，一目了然。「右上+下方小组件」</p><p>PS: 自动添加到 Google 日历已实现，待优化后补充在评论区</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/editor/u_/c4r13hdb34t8ar53fieg.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/editor/u_/c4r13hdb34t8ar53fieg.png" referrerpolicy="no-referrer"></figure><h3><strong>为啥有这个需求?</strong></h3><p><strong>问</strong>：明明携程的小组件显示效果不错，为啥你要自己做一个？</p><p><strong>答</strong>：每回买票时候，我只记一个出发时间，到了车站之后才开始看车次、检票口、座位等信息。如果打开 12306 需要验证，还要多点几步等待加载，比较麻烦。前段时间携程推出的小组件做的挺直观的，但它显示信息不全啊😡，想看检票口还要进入 App 才能看到。什么启动速度它自己没点数吗？啊？！为什么不能在小组件里一并显示呢？「注: 携程的小组件显示效果如上图左上角所示」</p><h3>遗憾</h3><p>但也有遗憾的事，发送到滴答清单的邮件不适用滴答的自然语法。</p><p>例如文本为“2021年08月18日18:18提前15分钟D1818号,18车18A,检票口18A~提醒事项#12306”</p><p>在滴答清单的 App 中输入，将会被识别为标题为 <strong>"D1818号,18车18A,检票口18A"</strong>，提醒时间为2021年8月18日18点18分并且提前十五分钟提醒，所在的列表为“提醒事项”，标签为“12306”的任务。</p><p>但通过邮件发送，将会被识别为标题为 <strong>“2021年08月18日18:18提前15分钟D1818号,18车18A,检票口18A~提醒事项#12306”</strong>，提醒时间为2021年8月18日18点18分的任务。</p><p>文本中带的时间不会被自动抹除📅，无法指定标签🏷️，无法设置提前提醒时间⏰，总归还是需要进入 App 多操作几步，就有点不太舒心…「此处偷偷@滴答官方人员，自然语法为啥不能套用在邮件添加中呢…」</p><p>还有… 我这边 12306 的邮件发送不到 Gmail 里面，找了半天没找到为啥(´Д` )</p><p>哎… 最后舍近求远，由 QQ 邮箱转发所有 12306 的邮件到 Gmail …</p><p> </p><p>如果有知道为啥的朋友，可以帮忙在评论区解解惑😂</p><p>废话说了不少，下面正式开始讲解实现逻辑。</p><hr><h2>如何实现匹配与转发</h2><blockquote><p>仅做抛砖引玉，相信各位大佬能做的比我更好。更能开发出更多信息的聚合。</p></blockquote><p>相关代码详见<a href="https://github.com/sunshinenny/awesome_google_apps_script" target="_blank">此 GitHub 仓库</a>。<s>(粘代码有凑字数嫌疑</s></p><h3>使用到的服务与软件</h3><ul><li><a href="https://script.google.com/" target="_blank">Google Apps Script</a></li><li><a href="https://dida365.com/" target="_blank">滴答清单</a></li></ul><h3>项目准备</h3><ul><li>登陆 Apps Script</li><li>新建项目</li></ul><h3>实现思路详解</h3><ol><li>获取到需要处理的邮件。</li><li>初步匹配“出发时间、车次、座位、检票口等”相关信息「作为后续匹配的基础」。</li><li>精确匹配“出发时间”、“车次”、“座位”、“检票口”，作为独立变量为拼接文本做准备。</li><li>根据自身需求，拼接成任务文本</li><li>发送邮件到滴答清单提供的邮箱中</li><li>执行测试</li></ol><h3>脚本何时触发</h3><p>最好的触发器应该是收到邮件就触发一次脚本。<strong>但是仅支持时间驱动和日历驱动…</strong></p><p>所以此处用了时间驱动的形式触发脚本。</p><p>因为一般来说买车票都是提前好几天就买好了，对及时性要求不高。所以我把时间设为每15分钟读取一次。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/editor/u_/c4r13hlb34t893up9cv0.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/editor/u_/c4r13hlb34t893up9cv0.png" referrerpolicy="no-referrer"></figure><h3>滴答清单设置</h3><p>根据当前脚本添加的任务如下图所示</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/editor/u_/c4r13hlb34t8amojc8n0.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/editor/u_/c4r13hlb34t8amojc8n0.png" referrerpolicy="no-referrer"></figure><p>重新修改标题，添加标签。</p><p>设置小组件到负一屏，设置过滤规则</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/editor/u_/c4r13htb34t897udggag.jpeg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/editor/u_/c4r13htb34t897udggag.jpeg" referrerpolicy="no-referrer"></figure><h2>尾巴</h2><p>操作步骤偏多，还需要编写代码，结果完了之后还要再重新编辑。</p><p> </p><p>好像距自动化理念相差甚远。甚至写代码、调试的时间，够我接下来一年自行编辑出差任务用。</p><p>那为什么还要折腾呢？</p><p> </p><p>但是如果想想，通过这一次，<strong>从今往后的 Gmail ，它收到什么，您想要它做什么，您想让它成为什么？</strong>您都能自定，全权掌控。这不是一件很 Cool 的事情吗？</p><p> </p><p>就如标题所说，“从零开始，定制您的行程助理”。将来，您也可以定制您的生活助理、提醒助理…</p><p> </p><p>让工具更好的服务于自身🚗</p><p>那这一切都物超所值。</p><hr><p>感谢您读到这，下次再见～</p><h2>相关链接</h2><ul><li><a href="https://script.google.com/" target="_blank">Google Apps Script</a></li><li><a href="https://dida365.com/" target="_blank">滴答清单</a></li><li><a href="https://github.com/contributorpw/google-apps-script-awesome-list" target="_blank">Google Apps Script Awesome List - Github</a></li><li><a href="https://github.com/sunshinenny/awesome_google_apps_script" target="_blank">笔者的 GitHub 仓库</a></li><li>题图来自 <a href="https://unsplash.com/photos/ZWD3Dx6aUJg">person writing on white paper photo – Unsplash</a></li></ul><p style="margin-left:0px;"> </p><p> </p></div><div class="update-details-wrap" data-v-0b37afcb></div><!----></div><div style="border:1px solid transparent;" data-v-0b37afcb></div><div class="article-side sideTop" style="display:none;left:0;" data-v-7be936cf data-v-0b37afcb><div class="download-guide-container" data-v-14f9065e data-v-7be936cf><div class="btn-wrapper" data-v-14f9065e><!----><button class="btn btn-view" data-v-14f9065e><i class="iconfont iconfont-phone" data-v-14f9065e></i></button></div><a href="https://sspai.com/s/JYjP" target="_blank" data-v-14f9065e><!----></a></div><div class="item-wrapper" data-v-7be936cf><button class="btn btn-charge" data-v-7be936cf><i class="iconfont" data-v-7be936cf></i></button><span class="count" data-v-7be936cf>2</span></div><div class="item-wrapper" data-v-7be936cf><button class="btn-mini btn-comment" data-v-7be936cf><i class="iconfont iconfont-comment" data-v-7be936cf></i></button><span class="count" data-v-7be936cf>0</span></div><div class="item-wrapper" data-v-7be936cf><span data-v-7be936cf><div role="tooltip" id="el-popover-9001" aria-hidden="true" class="el-popover el-popper popper-share right ss-popper-dark-border" style="width:undefinedpx;display:none;"><!----><div class="article-side-share-btn"><a href="https://service.weibo.com/share/share.php?url=null?ref=weibo&title=%E3%80%90%E3%80%8CApps%20Script%E3%80%8D%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%EF%BC%8C%E5%AE%9A%E5%88%B6%E6%82%A8%E7%9A%84%E8%A1%8C%E7%A8%8B%E5%8A%A9%E7%90%86%E3%80%91%E5%89%8D%E8%A8%80GoogleAppsScript%E6%98%AF%E4%B8%80%E4%B8%AA%E5%BF%AB%E9%80%9F%E7%9A%84%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%BF%AB%E9%80%9F%E3%80%81%E8%BD%BB%E6%9D%BE%E5%9C%B0%E5%88%9B%E5%BB%BA%E4%B8%8EGoogleWorkspace%E9%9B%86%E6%88%90%E7%9A%84%E5%95%86%E4%B8%9A%E5%BA%94%E7%94%A8%E3%80%82%E4%BD%A0%E5%8F%AF%E4%BB%A5%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&pic=https%3A%2F%2Fcdn.sspai.com%2Feditor%2Fu_%2Fc4r1315b34t897udgga0.jpg%3FimageMogr2%2Fauto-orient%2Fquality%2F95%2Fthumbnail%2F!1420x708r%2Fgravity%2FCenter%2Fcrop%2F1420x708%2Finterlace%2F1&appkey=3196502474#" target="_blank"><i class="iconfont iconfont-weibo-simple right-16"></i></a><span><div role="tooltip" id="el-popover-3748" aria-hidden="true" class="el-popover el-popper" style="width:undefinedpx;display:none;"><!----><div style="text-align:center;"><div id="qr-code"></div><small class="qr-small">扫码分享</small></div></div><span class="el-popover__reference-wrapper"><i class="iconfont iconfont-wechat-simple right-16"></i></span></span><a href="https://twitter.com/share?text=%E3%80%90%E3%80%8CApps%20Script%E3%80%8D%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%EF%BC%8C%E5%AE%9A%E5%88%B6%E6%82%A8%E7%9A%84%E8%A1%8C%E7%A8%8B%E5%8A%A9%E7%90%86%E3%80%91%E5%89%8D%E8%A8%80GoogleAppsScript%E6%98%AF%E4%B8%80%E4%B8%AA%E5%BF%AB%E9%80%9F%E7%9A%84%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91%E5%B9%B3%E5%8F%B0%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%BF%AB%E9%80%9F%E3%80%81%E8%BD%BB%E6%9D%BE%E5%9C%B0%E5%88%9B%E5%BB%BA%E4%B8%8EGoogleWorkspace%E9%9B%86%E6%88%90%E7%9A%84%E5%95%86%E4%B8%9A%E5%BA%94%E7%94%A8%E3%80%82%E4%BD%A0%E5%8F%AF%E4%BB%A5%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&url=null" target="_blank" class="twitter"><i class="iconfont iconfont-twitter-simple right-16"></i></a></div></div><span class="el-popover__reference-wrapper"><button class="btn-mini btn-share" data-v-7be936cf><i class="iconfont iconfont-share" data-v-7be936cf></i></button></span></span></div><div class="item-wrapper" data-v-7be936cf><button class="btn-mini btn-collect" data-v-7be936cf><i class="iconfont iconfont-collect" data-v-7be936cf></i></button></div><!----></div><!---->  
</div>
            