
---
title: '每个 Android 玩家都不可错过的神器（二）：保留 Magisk 进行「无痛 OTA」'
categories: 
 - 新媒体
 - 少数派 sspai
 - 专题内文章更新
headimg: 'https://cdn.sspai.com/2019/02/26/1efd3d6a9eb66f6f441e8695aa0c2a0f.jpg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
author: 少数派 sspai
comments: false
date: Tue, 26 Feb 2019 04:02:52 GMT
thumbnail: 'https://cdn.sspai.com/2019/02/26/1efd3d6a9eb66f6f441e8695aa0c2a0f.jpg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
---

<div>   
<div class="articleWidth-content" data-v-6f469055><div class="content wangEditor-txt minHeight" data-v-6f469055><p>无论从我平时接触到的 Android 用户还是从此前与 root 相关的讨论来看，很多人在要不要 root 这件事情上反复纠结的最大原因在于 OTA。</p><p>对移动平台操作系统而言，OTA 更新也许是最为常见也最为方便的系统升级方式，以 Google 自家的 Pixel 设备为例，一次没有太多功能更新的月度安全补丁推送也许只需要下载几十兆大小的更新包，与之形成对比的则是以 GB 为单位计算的全量工厂镜像。</p><p>因此无论从便利性还是从带宽、流量角度出发，为 OTA 而放弃 root 的行为都值得理解了：<strong>大部分 root 工具都会直接对系统分区内的文件进行修改，经过修改的系统文件显然是过不了 OTA 流程中「系统完整性验证」这一关的</strong>。</p><p>而我们在 <a href="https://sspai.com/post/53043" target="_blank">上一篇</a> 中已经提到，得益于 systemless 特性，能够无痛 OTA 更新也是 Magisk 的一大优点。本文就将介绍如何在安装了 Magisk 的前提下进行无痛 OTA 系统更新。</p><h2><div>确认 A/B 系统分区支持状态</div></h2><p>A/B 系统分区是 Google 在 Android 7.0 时代引入的新机制，顾名思义，采用这个机制的设备拥有 A、B 两套系统分区，用户数据则能够在这两套系统分区之间共用。</p><p>这种分区机制带来的最大好处，在于让无缝系统更新（seemless updates）成为了可能——举个例子，当我们在 A 系统中进行 OTA 更新时，接受更新的很有可能是当前并未启用的 B 系统。这样一来，OTA 更新的过程可以在不干扰当前使用的前提下顺利完成，手机重启后，系统分区从 A 切换到 B，用户自然也就用上了新系统。</p><figure tabindex="0" draggable="false" class="ss-img-wrapper" contenteditable="false"><img src="https://cdn.sspai.com/2019/02/26/1efd3d6a9eb66f6f441e8695aa0c2a0f.jpg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2019/02/26/1efd3d6a9eb66f6f441e8695aa0c2a0f.jpg" referrerpolicy="no-referrer"><figcaption class="ss-image-caption">A/B 分区的系统更新流程</figcaption></figure><p>此外，采用 A/B 系统分区的设备在遭遇 OTA 事故时，还能在系统启动失败后自动切换回更新前能够正常工作的系统分区。得益于这些便利，Android 7.0 正式推出后的主流 Android 设备很多都已经支持了 A/B 系统分区方式。</p><p>A/B 分区同样也是安装了 Magisk 状态下进行无痛 OTA 系统更新的前提条件，<strong>那么该如何确定自己的设备支持这种分区方式呢？</strong></p><p>首先，如果你已经在电脑端正确配置好了 ADB 环境，不妨在手机端打开 USB 调试后将手机连上电脑，然后在电脑端按照下列步骤检查设备是否采用了支持无缝系统更新的 A/B 分区：</p><ol><li>运行 CMD 命令行工具或终端</li><li>执行 adb shell 指令，此处应返回 设备代号:/$</li><li>随后执行 getprop ro.build.ab_update 指令</li></ol><p>返回结果为 true 则表示你的设备采用了 A/B 系统分区。</p><figure tabindex="0" draggable="false" class="ss-img-wrapper" contenteditable="false"><img src="https://cdn.sspai.com/2019/02/26/7da9cffc4d86e47edbbc61bca4996bff.jpg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2019/02/26/7da9cffc4d86e47edbbc61bca4996bff.jpg" referrerpolicy="no-referrer"><figcaption class="ss-image-caption">使用 CMD 鉴定 A/B 分区兼容性</figcaption></figure><p>当然，你也可以通过 <a href="https://play.google.com/store/apps/details?id=com.kevintresuelo.treble" target="_blank">Treble Check</a> 这款小应用来检测 Project Treble 和 A/B 系统分区的兼容性，这款工具无需 root，下载安装后直接运行即可看到结果。</p><figure tabindex="0" draggable="false" class="ss-img-wrapper custom-width" contenteditable="false"><img src="https://cdn.sspai.com/2019/02/26/ca1602c05fdaa145d6a92eb0d290f891.jpg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt width="400" data-original="https://cdn.sspai.com/2019/02/26/ca1602c05fdaa145d6a92eb0d290f891.jpg" referrerpolicy="no-referrer"></figure><p>确认设备支持 A/B 系统分区后，我们就可以接着进行下一步了。</p><p><span app-id="14430" contenteditable="false" class="ss-loading"></span><br></p><h2><div>做好准备工作</div></h2><p>由于 A/B 分区在系统更新过程中几乎不会对用户造成打扰，一些 OEM 厂商也顺势将 OTA 更新做成了一个可以在后台自动完成的任务。</p><p>但问题在于，伴随着自动完成 OTA 更新后系统分区的切换，我们在更新前借助 Magisk 获取的 root 权限和已经安装过的 Magisk 模块都会一一失效。鉴于本文要讨论的 OTA 更新特指<strong>既能通过 OEM 官方通道进行 OTA 更新，又能在 OTA 更新后保留 Magisk 的 root 权限和已安装模块</strong>。如果你想在安装了 Magisk 后的使用过程中均采用本文介绍的 OTA 方式，就必须做好一些事前准备，</p><p>首先，找到并关闭自动系统更新选项。这个选项位于开发者选项的第一部分设置当中，因此还算好找。</p><figure tabindex="0" draggable="false" class="ss-img-wrapper" contenteditable="false"><img src="https://cdn.sspai.com/2019/02/26/1d30e9f6d787c9f115f9bc4815f9f0ac.jpg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2019/02/26/1d30e9f6d787c9f115f9bc4815f9f0ac.jpg" referrerpolicy="no-referrer"><figcaption class="ss-image-caption">关闭自动更新并还原原厂件镜像</figcaption></figure><p>然后，在厂商发布系统更新或确认能检测到 OTA 更新后，点击进入 Magisk Manager 应用，找到位于主界面的「卸载 Magisk」选项，然后点击「还原原厂镜像」。</p><p>注意，如果你在此时遇到了 <code>stock backup does not exist</code> 这样的提示，则表明 Magisk 未能在安装时成功创建 boot 分区的备份（自然也就无法还原原厂镜像），此时建议使用我们在<a href="https://sspai.com/post/53043" target="_blank" class="insert-link"> 第一篇 </a>文章中提到的 boot 镜像修补法来重新安装 Magisk，这样就能保证原厂镜像得到正确备份了。</p><p>另外，和第一步操作不同的是，自动系统更新选项我们建议保持长期关闭，<strong>还原原厂镜像操作在每次进行 OTA 更新操作前都要执行</strong>。</p><h2><div>科学的 OTA 更新流程</div></h2><p>接下来我们要做的就是执行正常的 OTA 更新流程了。</p><p>在执行完毕「还原原厂镜像」操作后，大部分机型在系统设置中应该都能成功检测并安装来自 OEM 厂商的 OTA 更新了。</p><p>正如上文所言，OTA 更新流程结束后，系统应该会提示我们重启，重启后系统就自动切换到了更新过的另一个系统分区上。只是此时另一个系统分区并没有保留 Magisk 的安装和 root 状态，相关模块也无从启用。</p><p><strong>因此在安装完 OTA 更新后，请先不要重启</strong>。</p><p>无视系统的重启提示，直接打开 Magisk Manager 应用，找到「安装」选项，然后在点击后的弹出菜单中选择「安装到未使用的槽位（Install to Inactive Slot）」。</p><figure tabindex="0" draggable="false" class="ss-img-wrapper" contenteditable="false"><img src="https://cdn.sspai.com/2019/02/26/dcce1cda2e7fcff5adec87cc2c39e52a.jpg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2019/02/26/dcce1cda2e7fcff5adec87cc2c39e52a.jpg" referrerpolicy="no-referrer"><figcaption class="ss-image-caption">跳过重启并安装 Magisk 到另一分区</figcaption></figure><p>随后，Magisk 就会在已经顺利进行过 OTA 更新的另一系统分区中进行安装。安装完成后直接点击安装界面右下角的「重启」按钮，即可重启到既保留了 Magisk，又应用了 OTA 更新的另一系统分区了。</p><p><strong>关联阅读：</strong></p><ul><li><a href="https://source.android.com/devices/tech/ota/ab" target="_blank">A/B (Seamless) System Updates</a></li></ul><ul><li><a href="https://topjohnwu.github.io/Magisk/tutorials.html#ota-installation" target="_blank">Magisk Tutorials - OTA Installation</a></li></ul><ul><li><a href="https://www.xda-developers.com/how-to-check-android-device-supports-seamless-updates/" target="_blank">How to check if your Android device supports Seamless Updates</a></li></ul><ul><li><a href="https://sspai.com/post/40737" target="_blank">无需重新 Root，让已 Root 的设备轻松升级 Android 8.0</a></li></ul><ul><li><a href="https://sspai.com/post/53043" target="_blank">每个 Android 玩家都不可错过的神器（一）：Magisk 初识与安装</a></li></ul><p>> 下载少数派 <a href="https://sspai.com/page/client"><u>客户端</u></a>、关注 <a href="http://sspai.com/s/KEPQ"><u>少数派公众号</u></a> ，发现更多 Android 玩机技巧 😃</p><p></p><p>> 特惠、好用的硬件产品，尽在 <a href="https://shop549593764.taobao.com/?spm=a230r.7195193.1997079397.2.2ddc7e0bPqKQHc"><u>少数派sspai官方店铺</u></a> 🛒</p><p><br></p></div><!----></div><div style="border:1px solid transparent;" data-v-6f469055></div><div class="article-side sideTop" style="display:none;left:0;" data-v-7be936cf data-v-6f469055><div class="download-guide-container" data-v-14f9065e data-v-7be936cf><div class="btn-wrapper" data-v-14f9065e><!----><button class="btn btn-view" data-v-14f9065e><i class="iconfont iconfont-phone" data-v-14f9065e></i></button></div><a href="https://sspai.com/s/JYjP" target="_blank" data-v-14f9065e><!----></a></div><div class="item-wrapper" data-v-7be936cf><button class="btn btn-charge" data-v-7be936cf><i class="iconfont" data-v-7be936cf></i></button><span class="count" data-v-7be936cf>194</span></div><div class="item-wrapper" data-v-7be936cf><button class="btn-mini btn-comment" data-v-7be936cf><i class="iconfont iconfont-comment" data-v-7be936cf></i></button><span class="count" data-v-7be936cf>30</span></div><div class="item-wrapper" data-v-7be936cf><span data-v-7be936cf><div role="tooltip" id="el-popover-8444" aria-hidden="true" class="el-popover el-popper popper-share right ss-popper-dark-border" style="width:undefinedpx;display:none;"><!----><div class="article-side-share-btn"><a href="https://service.weibo.com/share/share.php?url=null?ref=weibo&title=%E3%80%90%E6%AF%8F%E4%B8%AA%20Android%20%E7%8E%A9%E5%AE%B6%E9%83%BD%E4%B8%8D%E5%8F%AF%E9%94%99%E8%BF%87%E7%9A%84%E7%A5%9E%E5%99%A8%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9A%E4%BF%9D%E7%95%99%20Magisk%20%E8%BF%9B%E8%A1%8C%E3%80%8C%E6%97%A0%E7%97%9B%20OTA%E3%80%8D%E3%80%91%E5%BE%88%E5%A4%9A%E4%BA%BA%E5%9C%A8%E8%A6%81%E4%B8%8D%E8%A6%81%20root%20%E8%BF%99%E4%BB%B6%E4%BA%8B%E6%83%85%E4%B8%8A%E5%8F%8D%E5%A4%8D%E7%BA%A0%E7%BB%93%E7%9A%84%E6%9C%80%E5%A4%A7%E5%8E%9F%E5%9B%A0%E5%9C%A8%E4%BA%8E%20OTA%EF%BC%8CMagisk%20%E5%88%99%E4%B8%BA%E6%88%91%E4%BB%AC%E6%8F%90%E4%BE%9B%E4%BA%86%E4%B8%80%E7%A7%8D%E6%97%A2%E8%83%BD%E4%BF%9D%E7%95%99%20Magisk%20%E5%AE%89%E8%A3%85%E5%92%8C%20root%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&pic=https%3A%2F%2Fcdn.sspai.com%2Farticle%2F4516949e-bede-de4a-9c38-1c10b3b4d1ce.jpg%3FimageMogr2%2Fauto-orient%2Fquality%2F95%2Fthumbnail%2F!1420x708r%2Fgravity%2FCenter%2Fcrop%2F1420x708%2Finterlace%2F1&appkey=3196502474#" target="_blank"><i class="iconfont iconfont-weibo-simple right-16"></i></a><span><div role="tooltip" id="el-popover-9081" aria-hidden="true" class="el-popover el-popper" style="width:undefinedpx;display:none;"><!----><div style="text-align:center;"><div id="qr-code"></div><small class="qr-small">扫码分享</small></div></div><span class="el-popover__reference-wrapper"><i class="iconfont iconfont-wechat-simple right-16"></i></span></span><a href="https://twitter.com/share?text=%E3%80%90%E6%AF%8F%E4%B8%AA%20Android%20%E7%8E%A9%E5%AE%B6%E9%83%BD%E4%B8%8D%E5%8F%AF%E9%94%99%E8%BF%87%E7%9A%84%E7%A5%9E%E5%99%A8%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9A%E4%BF%9D%E7%95%99%20Magisk%20%E8%BF%9B%E8%A1%8C%E3%80%8C%E6%97%A0%E7%97%9B%20OTA%E3%80%8D%E3%80%91%E5%BE%88%E5%A4%9A%E4%BA%BA%E5%9C%A8%E8%A6%81%E4%B8%8D%E8%A6%81%20root%20%E8%BF%99%E4%BB%B6%E4%BA%8B%E6%83%85%E4%B8%8A%E5%8F%8D%E5%A4%8D%E7%BA%A0%E7%BB%93%E7%9A%84%E6%9C%80%E5%A4%A7%E5%8E%9F%E5%9B%A0%E5%9C%A8%E4%BA%8E%20OTA%EF%BC%8CMagisk%20%E5%88%99%E4%B8%BA%E6%88%91%E4%BB%AC%E6%8F%90%E4%BE%9B%E4%BA%86%E4%B8%80%E7%A7%8D%E6%97%A2%E8%83%BD%E4%BF%9D%E7%95%99%20Magisk%20%E5%AE%89%E8%A3%85%E5%92%8C%20root%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&url=null" target="_blank" class="twitter"><i class="iconfont iconfont-twitter-simple right-16"></i></a></div></div><span class="el-popover__reference-wrapper"><button class="btn-mini btn-share" data-v-7be936cf><i class="iconfont iconfont-share" data-v-7be936cf></i></button></span></span></div><div class="item-wrapper" data-v-7be936cf><button class="btn-mini btn-collect" data-v-7be936cf><i class="iconfont iconfont-collect" data-v-7be936cf></i></button></div><!----></div><!---->  
</div>
            