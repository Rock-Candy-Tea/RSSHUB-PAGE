
---
title: '从零开始搭建一个免费的个人博客数据统计系统（umami + Vercel + Heroku）'
categories: 
 - 新媒体
 - 少数派 sspai
 - Matrix
headimg: 'https://cdn.sspai.com/2022/05/21/b02e5a611c29c82b00d118b9f6448741.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
author: 少数派 sspai
comments: false
date: Mon, 23 May 2022 03:17:58 GMT
thumbnail: 'https://cdn.sspai.com/2022/05/21/b02e5a611c29c82b00d118b9f6448741.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
---

<div>   
<div class="articleWidth-content" data-v-6dd0eb6a><div class="update-wrap" data-v-6dd0eb6a></div><div class="content wangEditor-txt minHeight" data-v-6dd0eb6a><h2>前言</h2><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/05/21/b02e5a611c29c82b00d118b9f6448741.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/05/21/b02e5a611c29c82b00d118b9f6448741.png" referrerpolicy="no-referrer"><figcaption>umami 看板</figcaption></figure><p>之前写了一篇《<a href="https://www.pseudoyu.com/zh/2022/03/24/free_blog_deploy_using_hugo_and_cusdis/">免费的个人博客系统搭建及部署解决方案（Hugo + GitHub Pages + Cusdis）</a>》，讲述了一下我使用 Serverless 和一些开源项目搭建的博客系统，也开了个系列来记录搭建过程。</p><p>前几天看到 <a href="https://reorx.com/">Reorx</a> 写的一篇 《<a href="https://reorx.com/blog/deploy-umami-for-personal-website/">搭建 umami 收集个人网站统计数据</a>》，他介绍了 <a href="https://umami.is/">umami</a> 这个项目，并使用 <a href="https://railway.app/">Railway</a> 进行无服务搭建部署。</p><p>只不过我因为之前部署 <a href="https://cusdis.com/">Cusdis</a> 的时候使用的是 <a href="https://www.heroku.com/">Heroku</a> 提供的免费 Postgres 数据库服务并用 <a href="http://vercel.com/">Vercel</a> 进行部署，于是在部署 umami 的时候还是想沿用原来的平台，减少搭建和维护成本。</p><p>下文会对具体搭建部署流程做个记录，因为官方支持一键部署方式，整个搭建流程很顺畅。</p><h2>搭建部署说明</h2><h3>使用 Heroku 创建 Postgres 数据库</h3><h4>创建 POSTGRES 数据库</h4><p>首先注册一个 Heroku 账号，登录成功后，点击右上角按钮创建一个新的应用。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/05/21/00c58ec210934a1ff986607cd939a43f.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/05/21/00c58ec210934a1ff986607cd939a43f.png" referrerpolicy="no-referrer"></figure><p>输入实例名称，地区可以自行选择，我选择的是 United States，点击创建。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/05/21/31d50c1a233160df032b1f69dd4c30f0.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/05/21/31d50c1a233160df032b1f69dd4c30f0.png" referrerpolicy="no-referrer"></figure><p>创建完成后，在 Resources Tab 的 Adds-on 中搜索选择 Postgres 数据库。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/05/21/b5296f6e7fb77e162cf9df36785fae43.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/05/21/b5296f6e7fb77e162cf9df36785fae43.png" referrerpolicy="no-referrer"></figure><p>选择 Free Plan 即可，Heroku 中的 Postgres 数据库是免费的，可以持续使用，免去了搭建维护成本。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/05/21/eac59525d37516aaa42c62b992c7bb43.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/05/21/eac59525d37516aaa42c62b992c7bb43.png" referrerpolicy="no-referrer"></figure><p>创建完成后，在 Setting 中查看 <code>DATABASE_URL</code>，后面部署要用到。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/05/21/2124482d2077482e70561313de6269ec.jpeg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/05/21/2124482d2077482e70561313de6269ec.jpeg" referrerpolicy="no-referrer"></figure><p>点击新增的 Postgres add-on 跳转进行设置。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/05/21/e2d929e74bf32675d04437a9d3bbb7ca.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/05/21/e2d929e74bf32675d04437a9d3bbb7ca.png" referrerpolicy="no-referrer"></figure><p>进入后，选择 Setting 页面的 View Credentials，并且记录配置参数。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/05/21/9a0075c2ce4cfd7312a42313b0ac9750.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/05/21/9a0075c2ce4cfd7312a42313b0ac9750.png" referrerpolicy="no-referrer"></figure><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/05/21/c77b33de63996f91256990fecf6ff586.jpeg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/05/21/c77b33de63996f91256990fecf6ff586.jpeg" referrerpolicy="no-referrer"></figure><h4><strong>初始化 POSTGRES 数据库</strong></h4><p>因为需要初始化数据库，我使用的是 DataGrip 数据库管理工具进行连接，比较方便，也可以通过 Heroku CLI 进行连接和配置。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/05/21/02e021f63a50b80386f707d7fdfb2a68.jpeg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/05/21/02e021f63a50b80386f707d7fdfb2a68.jpeg" referrerpolicy="no-referrer"></figure><p>umami 需要通过官方提供的 <a href="https://github.com/mikecao/umami/blob/master/sql/schema.postgresql.sql">umami/sql/schema.postgresql.sql</a> 脚本进行初始化。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/05/21/b855898c87f5c2ccfe0ac9e3350d55c7.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/05/21/b855898c87f5c2ccfe0ac9e3350d55c7.png" referrerpolicy="no-referrer"></figure><p>执行完成后，数据库有了五张表与初始化数据，可以进行后续部署工作。</p><h3>使用 Vercel 一键部署 umami 服务</h3><h4>部署 UMAMI 服务</h4><p>创建好数据库实例之后，可以通过 Vercel 一键部署 umami 服务了。</p><p>访问 <a href="https://umami.is/">umami 官方文档</a> 的 <a href="https://umami.is/docs/running-on-vercel">Running on Vercel</a> 模块，有操作说明与一键部署脚本。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/05/21/be9b5388392ab547ade649bce103dfdf.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/05/21/be9b5388392ab547ade649bce103dfdf.png" referrerpolicy="no-referrer"></figure><p>点击一键部署按钮后，会跳转至 Vercel 的一键部署页面，创建 umami 的 Github 仓库。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/05/21/3689a9e76d1469acda73b7175e0beffd.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/05/21/3689a9e76d1469acda73b7175e0beffd.png" referrerpolicy="no-referrer"></figure><p>接下来需要填入之前在部署 Heroku Postgres 实例时记录到 <code>DATABASE_URL</code> 参数地址，并且需要填写一个自定义字符串 <code>HASH_SLAT</code>。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/05/21/4b484f2aa85179507aea3bb8f66f4f14.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/05/21/4b484f2aa85179507aea3bb8f66f4f14.png" referrerpolicy="no-referrer"></figure><p>点击 Deploy 进行部署，等待几分钟后部署完成即可。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/05/21/1f5497759225615486e1fe38fe9d663a.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/05/21/1f5497759225615486e1fe38fe9d663a.png" referrerpolicy="no-referrer"></figure><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/05/21/9e8321b29d7ae60d2ff58290c95b7e60.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/05/21/9e8321b29d7ae60d2ff58290c95b7e60.png" referrerpolicy="no-referrer"></figure><h4>访问 UMAMI 服务</h4><p>部署完成后，点击 Dashboard 或分配的 Vercel 域名访问服务，可以看到 umami 的登录界面。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/05/21/41810e2d83dee64a2d5f97a226d42fd1.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/05/21/41810e2d83dee64a2d5f97a226d42fd1.png" referrerpolicy="no-referrer"></figure><p>初次登录输入默认用户名 <code>admin</code> 与默认密码 <code>umami</code>，登录成功后，会跳转至 umami 的管理页面，登录后可以点击右上角头像自行修改密码。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/05/21/68e3450e0837775276d54571b2f57837.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/05/21/68e3450e0837775276d54571b2f57837.png" referrerpolicy="no-referrer"></figure><h4>配置个人网站至 UMAMI 服务</h4><p>完成基础帐号配置后，点击侧边栏网站 Tab，点击添加网站。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/05/21/c5f90d0f5e3d14b235f155c7302edd8e.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/05/21/c5f90d0f5e3d14b235f155c7302edd8e.png" referrerpolicy="no-referrer"></figure><p>填写网站基本信息，如果勾选共享链接可以生成一个可公开访问的网址，我把它添加了一个书签放在 iPad 主屏幕上，作为一个数据看板也很不错。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/05/21/9371539d67ee916cc6484c1c325217b4.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/05/21/9371539d67ee916cc6484c1c325217b4.png" referrerpolicy="no-referrer"></figure><h4>配置 UMAMI 脚本至个人博客网站</h4><p>网站创建完成，获取 umami 脚本。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/05/21/e8211be8046005137ac8111c381d8ee8.jpeg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/05/21/e8211be8046005137ac8111c381d8ee8.jpeg" referrerpolicy="no-referrer"></figure><p>获取后，在个人网站添加 umami 脚本。我使用的是静态博客 Hugo，在主题中的 <code><head></code> 标签内添加。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/05/21/28a2d79a705d9ce508b891bcb4ec1792.jpeg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/05/21/28a2d79a705d9ce508b891bcb4ec1792.jpeg" referrerpolicy="no-referrer"></figure><p>配置完成部署，即可开始追踪网站数据。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/05/21/7c7fbee6abe220246aacad3d4f77efb6.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/05/21/7c7fbee6abe220246aacad3d4f77efb6.png" referrerpolicy="no-referrer"></figure><h4>配置自定义脚本名称</h4><p>使用官方的 <code>umami.js</code> 脚本名称，可能会被一些过滤规则拦截，因此我们可以自定义脚本名称，实现更准确地网站数据追踪。</p><p>官方也提供了便捷的修改方式，可以在 Vercel 中已经部署的 umami 服务中增加 <code>TRACKER_SCRIPT_NAME</code> 环境变量，配置为自定义名称。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/05/21/433ccdcf175f1aa173e0ef8dbb217779.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/05/21/433ccdcf175f1aa173e0ef8dbb217779.png" referrerpolicy="no-referrer"></figure><p>配置完成后重新部署，再在个人网站脚本中更改脚本名称即可。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/05/21/0efbef3cd34d6a4f5566b0ee0a8fa08d.jpeg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/05/21/0efbef3cd34d6a4f5566b0ee0a8fa08d.jpeg" referrerpolicy="no-referrer"></figure><h4>配置自定义域名</h4><p>如果不想要使用 Vercel 提供的 <code>vercel.app</code> 域名，可以在 Vercel 中添加自定义域名，按照 Vercel 官方指引对域名提供商进行 <code>CANME</code> 等配置。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/05/21/4bb0f41db560b78788913de3d62b8b78.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/05/21/4bb0f41db560b78788913de3d62b8b78.png" referrerpolicy="no-referrer"></figure><p>例如，我使用的是 <a href="https://www.cloudflare.com/">Cloudflare</a> 托管的域名，需要先添加一下域名解析。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/05/21/6d538d5cd73d8b71deac06c6a0db266e.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/05/21/6d538d5cd73d8b71deac06c6a0db266e.png" referrerpolicy="no-referrer"></figure><p>根据官方说明，Cloudflare 还需要添加一个页面规则，配置完成后即可完成自定义域名配置。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/05/21/b2eadeb20c5f1a5b47426f187b90d54f.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/05/21/b2eadeb20c5f1a5b47426f187b90d54f.png" referrerpolicy="no-referrer"></figure><h2>总结</h2><p>以上就是我们为网站添加 umami 网站统计服务的全流程，配置完成后无需后续维护，可以便捷地通过看板来进行网站数据追踪。这是我的博客搭建部署系列教程之一，请持续关注，希望能对大家有所参考。</p><h2>参考资料</h2><ol><li><a href="https://umami.is/">umami</a></li><li><a href="https://reorx.com/blog/deploy-umami-for-personal-website/">搭建 umami 收集个人网站统计数据</a></li><li><a href="http://vercel.com/">Vercel 官方网站</a></li><li><a href="https://www.heroku.com/">Heroku 官方网站</a></li></ol></div><div class="update-details-wrap" data-v-6dd0eb6a></div><!----></div><div style="border:1px solid transparent;" data-v-6dd0eb6a></div><div class="article-side sideTop" style="display:none;left:0;" data-v-7be936cf data-v-6dd0eb6a><div class="download-guide-container" data-v-14f9065e data-v-7be936cf><div class="btn-wrapper" data-v-14f9065e><!----><button class="btn btn-view" data-v-14f9065e><i class="iconfont iconfont-phone" data-v-14f9065e></i></button></div><a href="https://sspai.com/s/JYjP" target="_blank" data-v-14f9065e><!----></a></div><div class="item-wrapper" data-v-7be936cf><button class="btn btn-charge" data-v-7be936cf><i class="iconfont" data-v-7be936cf></i></button><span class="count" data-v-7be936cf>3</span></div><div class="item-wrapper" data-v-7be936cf><button class="btn-mini btn-comment" data-v-7be936cf><i class="iconfont iconfont-comment" data-v-7be936cf></i></button><span class="count" data-v-7be936cf>0</span></div><div class="item-wrapper" data-v-7be936cf><span data-v-7be936cf><div role="tooltip" id="el-popover-6601" aria-hidden="true" class="el-popover el-popper popper-share right ss-popper-dark-border" style="width:undefinedpx;display:none;"><!----><div class="article-side-share-btn"><a href="https://service.weibo.com/share/share.php?url=null?ref=weibo&title=%E3%80%90%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%85%8D%E8%B4%B9%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E6%95%B0%E6%8D%AE%E7%BB%9F%E8%AE%A1%E7%B3%BB%E7%BB%9F%EF%BC%88umami%20%2B%20Vercel%20%2B%20Heroku%EF%BC%89%E3%80%91%E5%89%8D%E8%A8%80umami%E7%9C%8B%E6%9D%BF%E4%B9%8B%E5%89%8D%E5%86%99%E4%BA%86%E4%B8%80%E7%AF%87%E3%80%8A%E5%85%8D%E8%B4%B9%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F%E6%90%AD%E5%BB%BA%E5%8F%8A%E9%83%A8%E7%BD%B2%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%EF%BC%88Hugo%2BGitHubPages%2BCusdis%EF%BC%89%E3%80%8B%EF%BC%8C%E8%AE%B2%E8%BF%B0%E4%BA%86%E4%B8%80%E4%B8%8B%E6%88%91%E4%BD%BF%E7%94%A8S%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&pic=https%3A%2F%2Fcdn.sspai.com%2F2022%2F05%2F21%2F0f18329b855862e026f1ba35663cebaa.png%3FimageMogr2%2Fauto-orient%2Fquality%2F95%2Fthumbnail%2F!1420x708r%2Fgravity%2FCenter%2Fcrop%2F1420x708%2Finterlace%2F1&appkey=3196502474#" target="_blank"><i class="iconfont iconfont-weibo-simple right-16"></i></a><span><div role="tooltip" id="el-popover-9822" aria-hidden="true" class="el-popover el-popper" style="width:undefinedpx;display:none;"><!----><div style="text-align:center;"><div id="qr-code"></div><small class="qr-small">扫码分享</small></div></div><span class="el-popover__reference-wrapper"><i class="iconfont iconfont-wechat-simple right-16"></i></span></span><a href="https://twitter.com/share?text=%E3%80%90%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%85%8D%E8%B4%B9%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E6%95%B0%E6%8D%AE%E7%BB%9F%E8%AE%A1%E7%B3%BB%E7%BB%9F%EF%BC%88umami%20%2B%20Vercel%20%2B%20Heroku%EF%BC%89%E3%80%91%E5%89%8D%E8%A8%80umami%E7%9C%8B%E6%9D%BF%E4%B9%8B%E5%89%8D%E5%86%99%E4%BA%86%E4%B8%80%E7%AF%87%E3%80%8A%E5%85%8D%E8%B4%B9%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F%E6%90%AD%E5%BB%BA%E5%8F%8A%E9%83%A8%E7%BD%B2%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%EF%BC%88Hugo%2BGitHubPages%2BCusdis%EF%BC%89%E3%80%8B%EF%BC%8C%E8%AE%B2%E8%BF%B0%E4%BA%86%E4%B8%80%E4%B8%8B%E6%88%91%E4%BD%BF%E7%94%A8S%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&url=null" target="_blank" class="twitter"><i class="iconfont iconfont-twitter-simple right-16"></i></a></div></div><span class="el-popover__reference-wrapper"><button class="btn-mini btn-share" data-v-7be936cf><i class="iconfont iconfont-share" data-v-7be936cf></i></button></span></span></div><div class="item-wrapper" data-v-7be936cf><button class="btn-mini btn-collect" data-v-7be936cf><i class="iconfont iconfont-collect" data-v-7be936cf></i></button></div><!----></div><!---->  
</div>
            