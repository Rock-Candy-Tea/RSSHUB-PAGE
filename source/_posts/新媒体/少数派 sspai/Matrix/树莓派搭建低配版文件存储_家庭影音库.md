
---
title: '树莓派搭建低配版文件存储_家庭影音库'
categories: 
 - 新媒体
 - 少数派 sspai
 - Matrix
headimg: 'https://cdn.sspai.com/2021/09/29/a54e3e4cd2c2a2a820dcf8832ff0e6a5.jpg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
author: 少数派 sspai
comments: false
date: Wed, 29 Sep 2021 15:44:39 GMT
thumbnail: 'https://cdn.sspai.com/2021/09/29/a54e3e4cd2c2a2a820dcf8832ff0e6a5.jpg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
---

<div>   
<div class="articleWidth-content" data-v-6a669db8><div class="content wangEditor-txt minHeight" data-v-6a669db8><p style="margin-left:0px;">家里有个 Raspberry Pi 4B 只装了 HomeBridge 来接入家电感觉有点浪费，正好又有简单的家庭影音库需求，所以就有了这篇文章。</p><p style="margin-left:0px;">Raspberry Pi 4B 这代搭配千兆网口和 USB3.0 ，终于换掉了一直令人诟病的 USB2.0 ，至此速度理论上可以跑满千兆带宽，基本上能满足我的日常需求。</p><p style="margin-left:0px;">需要设备材料：</p><ul><li>Raspberry Pi 4B 搭载 Raspberry Pi OS（其他OS的也可以）</li><li>TF卡（做系统盘）</li><li>千兆路由器</li><li>CAT6网线</li><li>一个硬盘</li></ul><h2>硬盘挂载</h2><h3>手动挂载硬盘</h3><p>毕竟TF卡做系统盘也存不了多少数据，所以第一件事就是把准备好的磁盘挂载上，我用的是旧电脑拆下来西数机械硬盘，买了个硬盘盒让它发挥余热。</p><p>首先插上硬盘通过<code>sudo fdisk -l</code>查看以下硬盘状态：</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/09/29/a54e3e4cd2c2a2a820dcf8832ff0e6a5.jpg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/09/29/a54e3e4cd2c2a2a820dcf8832ff0e6a5.jpg" referrerpolicy="no-referrer"><figcaption>sudo fdisk -l</figcaption></figure><p>这个就是我们插上的硬盘，此时我们可以挂载到指定目录下：</p><p><code>sudo mount Devide名称  自定义的指定目录</code></p><p>举例： <code>sudo mount /dev/sda1  /media/pi/O</code></p><p>记得先创建一下storage文件夹<code>sudo mkdir /media/pi/O</code></p><p>再次查看硬盘状态<code>df -h</code>，此时/dev/sda1已经挂载上去了。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/09/29/8b62e0088512820fcc6b7dc9ccda04bd.jpg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/09/29/8b62e0088512820fcc6b7dc9ccda04bd.jpg" referrerpolicy="no-referrer"><figcaption><code>df -h</code></figcaption></figure><p>以上就是手动挂载的方式，但是迫于断电重启的问题，每次挂载有点麻烦，所以设置启动时自动挂载硬盘是个不错的办法。</p><h3>自动挂载硬盘</h3><p>在系统开机时会主动读取/etc/fstab这个文件中的内容，根据文件里面的配置挂载磁盘。<br>所以我们只需在/etc/fstab加入我们硬盘信息即可。<br>首先编辑文件：<code>sudo vi /etc/fstab</code><br>加入<code>UUID 指定目录 硬盘文件系统格式 defaults 0 0</code></p><p>当你不知道硬盘文件系统格式时，可以通过<code>sudo blkid</code>查看硬盘的UUID和TYPE<br> </p><figure class="image ss-img-wrapper"><img src="https://i.loli.net/2021/09/10/S4ovtXGLNCs87Mx.jpg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt="S4ovtXGLNCs87Mx" data-original="https://i.loli.net/2021/09/10/S4ovtXGLNCs87Mx.jpg" referrerpolicy="no-referrer"><figcaption><code>sudo blkid</code></figcaption></figure><p><br>举例：<code> UUID="34D58C3DFA562624" /media/pi/O ntfs defaults 0 0</code></p><h2>smb文件共享</h2><h3>安装</h3><p>首先安装一下samba服务：</p><p><code>sudo apt-get update</code></p><p><code>sudo apt-get install samba</code></p><h3>配置</h3><p>Samba配置文件通常在<code>/etc/samba/</code>路径下，编辑Samba配置文件：</p><p><code>sudo vi /etc/samba/smb.conf</code></p><p>在配置文件底部添加如下配置：</p><pre class="language-shell"><code>[NAS]
comment = NAS
browseable = yes
path = /media/pi/O
valid users = pi
browseable = yes
public = yes
read only = no
writeable = yes
create mask = 0777
directory mask = 0777</code></pre><p>配置参数：</p><p>[NAS] 表示这是一组共享设置。在 Samba 中通过中括号 [xxx] 的形式来标识区分。</p><p>comment = "xxxx" 表示对该共享的描述信息。</p><p>path = "xxxx" 表示对该共享路径。默认情况下不设置 path 的话，就是当前账户的Home目录。</p><p>valid users = pi 表示允许访问该共享的用户，如果是多个用户可以通过逗号 , 来分隔；也可以通过 @+组名 的方式来设置可访问的群组。</p><p>browseable = yes/no 表示该共享是否可以浏览。</p><p>public = yes/no 表示该共享是否允许 guest 账户访问。</p><p>read only = yes/no 表示是否可读写。</p><p>writable = yes/no 表示是否可写。</p><p>create mask = 0777 表示客户端上传文件的默认权限</p><p>directory mask = 0777 表示客户端创建目录的默认权限</p><h3>设置账户</h3><p>配置完毕后执行<code>sudo smbpasswd -a pi</code> （这里的pi是我设置的用户名，可以自行设置）来设置用户名密码，设置完毕后重启samba服务<code>sudo systemctl restart smbd</code></p><p>注：关于Samba账户，Samba 需要 Linux 账户才能使用，可以使用 已有账户 或 创建新用户。虽然用户名可以和 Linux 系统共享，但 Samba 使用的是单独的密码管理。</p><h3>macOS访问</h3><p>只需要打开 Finder ，选择 菜单栏 –> 前往 –> 连接服务器 (或者直接command + K )，在弹出的窗口中输入<code>smb://树莓派的IP地址</code> 后选择 连接 – 输入设置的账户和密码后就能访问了。<br> </p><figure class="image ss-img-wrapper"><img src="https://i.loli.net/2021/09/28/1WwiET5QnfpoFYV.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt="1WwiET5QnfpoFYV" data-original="https://i.loli.net/2021/09/28/1WwiET5QnfpoFYV.png" referrerpolicy="no-referrer"></figure><h2>qbittorrent下载器</h2><h3>通过docker安装</h3><h4>安装docker</h4><p>下载一键安装脚本<code>curl -fsSL get.docker.com -o get-docker.sh</code><br>执行安装：</p><p><code>sudo sh get-docker.sh</code></p><p>把当前用户添加到docker组，就不用每次执行docker时sudo了：</p><p><code>sudo usermod -aG docker pi</code></p><h4>拉取镜像和安装</h4><p><code>docker pull linuxserver/qbittorrent:arm32v7-latest</code></p><p>其中<code>arm32v7-latest</code>这个tag仅适用于树莓派这种ARM架构的，启动容器：</p><pre class="language-shell"><code>docker run -d \
--name=qbittorrent \
-e PUID=1000 \
-e PGID=1000 \
-e TZ=Asia/Shanghai \
-e WEBUI_PORT=8181 \
-p 6881:6881 \
-p 6881:6881/udp \
-p 8181:8181 \
-v /config
-v /media/pi/0/qBittorrent/config:/config \
-v /media/pi/0/qBittorrent/downloads:/downloads \
--restart unless-stopped \
linuxserver/qbittorrent:arm32v7-latest</code></pre><p>最后在浏览器输入`树莓派IP地址:8181`，输入默认用户名和密码就可以登陆了：</p><p>用户名：admin</p><p>密码：adminadmin</p><p>在上面的命令中，我们自己常设置的，也就下面几处：</p><ol><li>设置WEBUI端口号，可以按需设置：</li></ol><pre class="language-shell"><code>-e WEBUI_PORT=8181
-p 8181:8181 </code></pre><ol><li>设置qBittorrent的下载路径和配置路径，也可按需设置：</li></ol><pre class="language-shell"><code>-v /media/pi/0/qBittorrent/config
-v /media/pi/0/qBittorrent/downloads</code></pre><p>2.设置qBittorrent的下载路径和配置路径，也可按需设置：</p><p>这里推荐下<a href="https://weibo.com/waylybaye" target="_blank">wayl</a><a href="https://weibo.com/waylybaye">ybaye</a>的<a href="https://servercat.app/">ServerCat</a>这个软件，可以很方便查看服务器状态，部署docker等<br> </p><figure class="ss-imgRows" figcaption="ServerCat"><img src="https://cdn.sspai.com/2021/09/29/1828e21709657ec3e897a99df4ba9b25.jpg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2021/09/29/1828e21709657ec3e897a99df4ba9b25.jpg" referrerpolicy="no-referrer"><img src="https://cdn.sspai.com/2021/09/29/286c8da0ff9af80a7cef2d7b15ac2c6a.jpg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2021/09/29/286c8da0ff9af80a7cef2d7b15ac2c6a.jpg" referrerpolicy="no-referrer"></figure><p> </p><h3>自行编译</h3><p>当docker安装无法满足你时可以考虑自行编译，qBittorrent的Wiki有<a href="https://github.com/qbittorrent/qBittorrent/wiki/Compilation:-Raspberry-Pi-OS-and-DietPi">详细编译步骤</a>可以进行参考，这里不再赘述了。</p><h3>qBittorrent主题</h3><p>qBittorrent的Wiki有列出一些<a href="https://github.com/qbittorrent/qBittorrent/wiki/List-of-known-alternate-WebUIs">非官方WebUI</a><br>这里推荐两个我用过的：</p><p><a href="https://github.com/CzBiX/qb-web">CzBiX/qb-web</a></p><p><a href="https://github.com/CzBiX/qb-web">WDaan/VueTorrent</a></p><h2>结语</h2><p>得益于<a href="https://www.raspberrypi.org/products/raspberry-pi-4-model-b/" target="_blank">Raspberry Pi 4</a>新增的USB3.0接口使其获得了更多玩法，已经可以满足轻度的局域网文件存储，实现局域网文件多端访问；以及Big Sur现已支持直接通过 SMB 使用时间机器进行无线备份<sup class="ss-footnote" href="https://support.apple.com/zh-cn/guide/mac-help/mh15139/mac" title="在 Mac 上可以与时间机器配合使用的磁盘类型" footnote-id="1">1</sup>，或是搭配Infuse、Nplayer、Plex等软件 可以制作低配版本的家庭影音库。</p></div><!----></div><div style="border:1px solid transparent;" data-v-6a669db8></div><div class="article-side sideTop" style="display:none;left:0;" data-v-7be936cf data-v-6a669db8><div class="download-guide-container" data-v-14f9065e data-v-7be936cf><div class="btn-wrapper" data-v-14f9065e><!----><button class="btn btn-view" data-v-14f9065e><i class="iconfont iconfont-phone" data-v-14f9065e></i></button></div><a href="https://sspai.com/s/JYjP" target="_blank" data-v-14f9065e><!----></a></div><div class="item-wrapper" data-v-7be936cf><button class="btn btn-charge" data-v-7be936cf><i class="iconfont" data-v-7be936cf></i></button><span class="count" data-v-7be936cf>5</span></div><div class="item-wrapper" data-v-7be936cf><button class="btn-mini btn-comment" data-v-7be936cf><i class="iconfont iconfont-comment" data-v-7be936cf></i></button><span class="count" data-v-7be936cf>8</span></div><div class="item-wrapper" data-v-7be936cf><span data-v-7be936cf><div role="tooltip" id="el-popover-25" aria-hidden="true" class="el-popover el-popper popper-share right ss-popper-dark-border" style="width:undefinedpx;display:none;"><!----><div class="article-side-share-btn"><a href="https://service.weibo.com/share/share.php?url=null?ref=weibo&title=%E3%80%90%E6%A0%91%E8%8E%93%E6%B4%BE%E6%90%AD%E5%BB%BA%E4%BD%8E%E9%85%8D%E7%89%88%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8%2F%E5%AE%B6%E5%BA%AD%E5%BD%B1%E9%9F%B3%E5%BA%93%E3%80%91%E5%AE%B6%E9%87%8C%E6%9C%89%E4%B8%AARaspberryPi4B%E5%8F%AA%E8%A3%85%E4%BA%86HomeBridge%E6%9D%A5%E6%8E%A5%E5%85%A5%E5%AE%B6%E7%94%B5%E6%84%9F%E8%A7%89%E6%9C%89%E7%82%B9%E6%B5%AA%E8%B4%B9%EF%BC%8C%E6%AD%A3%E5%A5%BD%E5%8F%88%E6%9C%89%E7%AE%80%E5%8D%95%E7%9A%84%E5%AE%B6%E5%BA%AD%E5%BD%B1%E9%9F%B3%E5%BA%93%E9%9C%80%E6%B1%82%EF%BC%8C%E6%89%80%E4%BB%A5%E5%B0%B1%E6%9C%89%E4%BA%86%E8%BF%99%E7%AF%87%E6%96%87%E7%AB%A0%E3%80%82Ras%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&pic=https%3A%2F%2Fcdn.sspai.com%2F2021%2F09%2F29%2Fb209830f2777fb0423e46c765bad0240.png%3FimageMogr2%2Fauto-orient%2Fquality%2F95%2Fthumbnail%2F!1420x708r%2Fgravity%2FCenter%2Fcrop%2F1420x708%2Finterlace%2F1&appkey=3196502474#" target="_blank"><i class="iconfont iconfont-weibo-simple right-16"></i></a><span><div role="tooltip" id="el-popover-984" aria-hidden="true" class="el-popover el-popper" style="width:undefinedpx;display:none;"><!----><div style="text-align:center;"><div id="qr-code"></div><small class="qr-small">扫码分享</small></div></div><span class="el-popover__reference-wrapper"><i class="iconfont iconfont-wechat-simple right-16"></i></span></span><a href="https://twitter.com/share?text=%E3%80%90%E6%A0%91%E8%8E%93%E6%B4%BE%E6%90%AD%E5%BB%BA%E4%BD%8E%E9%85%8D%E7%89%88%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8%2F%E5%AE%B6%E5%BA%AD%E5%BD%B1%E9%9F%B3%E5%BA%93%E3%80%91%E5%AE%B6%E9%87%8C%E6%9C%89%E4%B8%AARaspberryPi4B%E5%8F%AA%E8%A3%85%E4%BA%86HomeBridge%E6%9D%A5%E6%8E%A5%E5%85%A5%E5%AE%B6%E7%94%B5%E6%84%9F%E8%A7%89%E6%9C%89%E7%82%B9%E6%B5%AA%E8%B4%B9%EF%BC%8C%E6%AD%A3%E5%A5%BD%E5%8F%88%E6%9C%89%E7%AE%80%E5%8D%95%E7%9A%84%E5%AE%B6%E5%BA%AD%E5%BD%B1%E9%9F%B3%E5%BA%93%E9%9C%80%E6%B1%82%EF%BC%8C%E6%89%80%E4%BB%A5%E5%B0%B1%E6%9C%89%E4%BA%86%E8%BF%99%E7%AF%87%E6%96%87%E7%AB%A0%E3%80%82Ras%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&url=null" target="_blank" class="twitter"><i class="iconfont iconfont-twitter-simple right-16"></i></a></div></div><span class="el-popover__reference-wrapper"><button class="btn-mini btn-share" data-v-7be936cf><i class="iconfont iconfont-share" data-v-7be936cf></i></button></span></span></div><div class="item-wrapper" data-v-7be936cf><button class="btn-mini btn-collect" data-v-7be936cf><i class="iconfont iconfont-collect" data-v-7be936cf></i></button></div><!----></div><!---->  
</div>
            