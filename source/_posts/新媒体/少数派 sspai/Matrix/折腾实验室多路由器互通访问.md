
---
title: '折腾实验室多路由器互通访问'
categories: 
 - 新媒体
 - 少数派 sspai
 - Matrix
headimg: 'https://cdn.sspai.com/editor/u_cugxuan/16207121119772.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
author: 少数派 sspai
comments: false
date: Tue, 11 May 2021 05:52:25 GMT
thumbnail: 'https://cdn.sspai.com/editor/u_cugxuan/16207121119772.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
---

<div>   
<div class="articleWidth-content" data-v-e1f0100a><div class="content wangEditor-txt minHeight" data-v-e1f0100a><p>在上次实验室购入了一台高性能服务器后，我们申请了服务器的公网 ip，这次又购入了两台高性能服务器。由于实验室有两台路由器，配置了两个网络环境之间的互通（其实就写了一条路由表），学了那么多网络知识，正好实践一下。</p><h2>问题背景</h2><p>上次实验室购入高性能服务器后，跟博士学长一起折腾了一下多用户远程登录桌面的功能，写了一篇<a href="https://blog.cugxuan.cn/2020/12/20/Linux/ubuntu-remote-desktop-by-multi-users/">实验室有一台高性能服务器是一种什么样的体验？</a>。通过路由器来解决多个设备上网的需求，写了一篇<a href="https://blog.cugxuan.cn/2020/09/12/Mood/try-openwrt-for-AC2100/">初探 AC2100 刷 openwrt</a>，在实验室也用 AC2100 路由器来给大家提供上网服务。这次的调整算是两次博客的后续延伸。</p><p>原本的服务器称为 PC1，新购入的两台服务器称为 PC2 和 PC3。大致的网络拓扑模型如下。现在出现的问题是<strong>在 PC2 可以访问到 PC1，但是 PC1 不能访问 PC2</strong>，也就是说电脑在连接路由器 1 的情况下无法访问 PC2、PC3 这几台服务器了。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/editor/u_cugxuan/16207121119772.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt="network-topology" data-original="https://cdn.sspai.com/editor/u_cugxuan/16207121119772.png" referrerpolicy="no-referrer"><figcaption>network-topology</figcaption></figure><h2>配置校园网访问</h2><p>实验室的上网方式经历了两个阶段。</p><ol><li>通过路由器上配置 mentohust 程序登录校园网账号上网。（可以看下上面提到的 AC2100 刷 openwrt）</li><li>在有服务器之后，申请了一个公网 ip，连接到校园网，该公网 ip 不需要账号可以直接联网。</li></ol><p>现在使用的是第二个阶段的方式，在路由器 1 上按照学校提供的网络信息配置 WAN 接口（WAN 表示外网访问的接口），具体修改 IP 和 MAC 等内容。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/editor/u_cugxuan/16207121119794.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt="WAN" data-original="https://cdn.sspai.com/editor/u_cugxuan/16207121119794.png" referrerpolicy="no-referrer"><figcaption>WAN</figcaption></figure><p>配置好之后路由器 1 下的所有设备就可以正常上网了，为了提供其他电脑在校园网环境下可以直接访问 PC1，还设置了 PC1 的端口映射，可以将 PC1 的端口暴露出去。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/editor/u_cugxuan/16207121119807.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt="virtual-server" data-original="https://cdn.sspai.com/editor/u_cugxuan/16207121119807.png" referrerpolicy="no-referrer"><figcaption>virtual-server</figcaption></figure><p>还给 PC1、PC2 和 PC3 设置了静态地址，避免以后重启后 ip 地址会发生变化，配置方式就不多赘述了。</p><h2>分析问题</h2><p>介绍完上网和服务器的配置方法，就该分析一下现在的问题，为什么 PC2 能访问到 PC1 而 PC1 无法访问 PC2。当前网络状态如图所示，解释一下 <code>192.168.1.0</code> 表示 <code>192.168.1.x</code> 这个网络。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/editor/u_cugxuan/16207121119818.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt="network-info" data-original="https://cdn.sspai.com/editor/u_cugxuan/16207121119818.png" referrerpolicy="no-referrer"><figcaption>network-info</figcaption></figure><p>我一般以五层结构来看待网络，路由器是第三层的设备，所以当 PC1 无法访问 PC2 的第一想法就是看 PC1 的路由表。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/editor/u_cugxuan/16207121119829.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt="no-router" data-original="https://cdn.sspai.com/editor/u_cugxuan/16207121119829.png" referrerpolicy="no-referrer"><figcaption>no-router</figcaption></figure><p>果不其然，在四条路由表中并没有目的地址为 192.168.2.0 的路由表，当时下意识认为<strong>解决方案就是配置路由表就完事</strong>。</p><h2>配置路由表</h2><p>在路由器 1 的路由表配置中添加静态路由配置，如图所示。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/editor/u_cugxuan/16207121119840.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt="static-router" data-original="https://cdn.sspai.com/editor/u_cugxuan/16207121119840.png" referrerpolicy="no-referrer"><figcaption>static-router</figcaption></figure><p>配置完成之后从 PC1 向 Router2 发起指令请求。从<code>192.168.1.105</code>发起请求，发现可以找到下一跳的位置是<code>192.168.1.153</code>发到了路由器 2，说明路由表配置已经生效。但显示<code>Destination Unreachable</code>目的不可达，百思不得其解。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/editor/u_cugxuan/16207121119851.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt="ping-test" data-original="https://cdn.sspai.com/editor/u_cugxuan/16207121119851.png" referrerpolicy="no-referrer"><figcaption>ping-test</figcaption></figure><h2>修改防火墙</h2><p>找了一上午配置，发现是路由器 2 的防火墙设置没开放，经验太重要了。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/editor/u_cugxuan/16207121119861.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt="firewall" data-original="https://cdn.sspai.com/editor/u_cugxuan/16207121119861.png" referrerpolicy="no-referrer"><figcaption>firewall</figcaption></figure><p>将其中的转发和入站数据设置为接受，保存设置就解决问题了。配置完成后可以在 <code>192.168.1.105</code> 访问 <code>192.168.2.217</code>。</p><h2>后记</h2><p>基本解决了实验室里面使用服务器的问题，远程连接确实很方便，但满载的噪音却挺令人头疼。三台服务器都放在实验室，开放式的空间在多块显卡同时工作的情况下，一直会发出嗡嗡的声音，晚上关机断电的时候会感觉到世界都清净了。</p><p>感觉这个问题不太好解决，学院和学校没有提供统一的服务器管理服务，这样看来显卡太多了好像也不太好，这算是新服务器带来强劲性能后的一个主要槽点吧。</p></div><!----></div><div style="border:1px solid transparent;" data-v-e1f0100a></div><div class="article-side sideTop" style="display:none;left:0;" data-v-7be936cf data-v-e1f0100a><div class="download-guide-container" data-v-14f9065e data-v-7be936cf><div class="btn-wrapper" data-v-14f9065e><!----><button class="btn btn-view" data-v-14f9065e><i class="iconfont iconfont-phone" data-v-14f9065e></i></button></div><a href="https://sspai.com/s/JYjP" target="_blank" data-v-14f9065e><!----></a></div><div class="item-wrapper" data-v-7be936cf><button class="btn btn-charge" data-v-7be936cf><i class="iconfont" data-v-7be936cf></i></button><span class="count" data-v-7be936cf>4</span></div><div class="item-wrapper" data-v-7be936cf><button class="btn-mini btn-comment" data-v-7be936cf><i class="iconfont iconfont-comment" data-v-7be936cf></i></button><span class="count" data-v-7be936cf>0</span></div><div class="item-wrapper" data-v-7be936cf><span data-v-7be936cf><div role="tooltip" id="el-popover-5897" aria-hidden="true" class="el-popover el-popper popper-share right ss-popper-dark-border" style="width:undefinedpx;display:none;"><!----><div class="article-side-share-btn"><a href="https://service.weibo.com/share/share.php?url=null?ref=weibo&title=%E3%80%90%E6%8A%98%E8%85%BE%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%A4%9A%E8%B7%AF%E7%94%B1%E5%99%A8%E4%BA%92%E9%80%9A%E8%AE%BF%E9%97%AE%E3%80%91%E5%9C%A8%E4%B8%8A%E6%AC%A1%E5%AE%9E%E9%AA%8C%E5%AE%A4%E8%B4%AD%E5%85%A5%E4%BA%86%E4%B8%80%E5%8F%B0%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%90%8E%EF%BC%8C%E6%88%91%E4%BB%AC%E7%94%B3%E8%AF%B7%E4%BA%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E5%85%AC%E7%BD%91ip%EF%BC%8C%E8%BF%99%E6%AC%A1%E5%8F%88%E8%B4%AD%E5%85%A5%E4%BA%86%E4%B8%A4%E5%8F%B0%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E3%80%82%E7%94%B1%E4%BA%8E%E5%AE%9E%E9%AA%8C%E5%AE%A4%E6%9C%89%E4%B8%A4%E5%8F%B0%E8%B7%AF%E7%94%B1%E5%99%A8%EF%BC%8C%E9%85%8D%E7%BD%AE%E4%BA%86%E4%B8%A4%E4%B8%AA%E7%BD%91%E7%BB%9C%E7%8E%AF%E5%A2%83%E4%B9%8B%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&pic=https%3A%2F%2Fcdn.sspai.com%2F2021%2F05%2F11%2F44d235332942eac2cd4603f000b0c5b3.png%3FimageMogr2%2Fauto-orient%2Fquality%2F95%2Fthumbnail%2F!1420x708r%2Fgravity%2FCenter%2Fcrop%2F1420x708%2Finterlace%2F1&appkey=3196502474#" target="_blank"><i class="icon icon-article_weibo right-16"></i></a><span><div role="tooltip" id="el-popover-4274" aria-hidden="true" class="el-popover el-popper" style="width:undefinedpx;display:none;"><!----><div style="text-align:center;"><div id="qr-code"></div><small class="qr-small">扫码分享</small></div></div><i class="icon icon-article_weixin right-16"></i></span><a href="https://twitter.com/share?text=%E3%80%90%E6%8A%98%E8%85%BE%E5%AE%9E%E9%AA%8C%E5%AE%A4%E5%A4%9A%E8%B7%AF%E7%94%B1%E5%99%A8%E4%BA%92%E9%80%9A%E8%AE%BF%E9%97%AE%E3%80%91%E5%9C%A8%E4%B8%8A%E6%AC%A1%E5%AE%9E%E9%AA%8C%E5%AE%A4%E8%B4%AD%E5%85%A5%E4%BA%86%E4%B8%80%E5%8F%B0%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%90%8E%EF%BC%8C%E6%88%91%E4%BB%AC%E7%94%B3%E8%AF%B7%E4%BA%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E5%85%AC%E7%BD%91ip%EF%BC%8C%E8%BF%99%E6%AC%A1%E5%8F%88%E8%B4%AD%E5%85%A5%E4%BA%86%E4%B8%A4%E5%8F%B0%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E3%80%82%E7%94%B1%E4%BA%8E%E5%AE%9E%E9%AA%8C%E5%AE%A4%E6%9C%89%E4%B8%A4%E5%8F%B0%E8%B7%AF%E7%94%B1%E5%99%A8%EF%BC%8C%E9%85%8D%E7%BD%AE%E4%BA%86%E4%B8%A4%E4%B8%AA%E7%BD%91%E7%BB%9C%E7%8E%AF%E5%A2%83%E4%B9%8B%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&url=null" target="_blank" class="twitter"><i class="icon icon-article_twitter right-16"></i></a></div></div><button class="btn-mini btn-share" data-v-7be936cf><i class="iconfont iconfont-share" data-v-7be936cf></i></button></span></div><div class="item-wrapper" data-v-7be936cf><button class="btn-mini btn-collect" data-v-7be936cf><i class="iconfont iconfont-collect" data-v-7be936cf></i></button></div><!----></div><!---->  
</div>
            