
---
title: '用快捷指令实现自动记账的一天'
categories: 
 - 新媒体
 - 少数派 sspai
 - Matrix
headimg: 'https://cdn.sspai.com/2021/04/17/80fa602eef182eabc360afa53b3ea104.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
author: 少数派 sspai
comments: false
date: Sun, 18 Apr 2021 07:50:24 GMT
thumbnail: 'https://cdn.sspai.com/2021/04/17/80fa602eef182eabc360afa53b3ea104.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
---

<div>   
<div class="articleWidth-content" data-v-e1f0100a><div class="content wangEditor-txt minHeight" data-v-e1f0100a><h2>一. 接触自动化 & Activator</h2><p>我最早接触自动化操作的概念，来源 iOS 越狱插件 <a href="https://cydia.saurik.com/package/libactivator/" target="_blank">Activator</a>。这是一款由 Ryan Petrich 开发的插件，通过这一款插件，你可以获取 iPhone 或者 iPad 设备的硬件状态变化，然后根据这种变化，做出各种动作，当然你也可以随意篡改各种硬件的响应，例如双击音量键打开闪光灯。我早些年很喜欢这个功能，因为回家的时候，小区的灯会比较暗。</p><figure class="image ss-img-wrapper image_resized" style="width:253px;"><img src="https://cdn.sspai.com/2021/04/17/80fa602eef182eabc360afa53b3ea104.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/04/17/80fa602eef182eabc360afa53b3ea104.png" referrerpolicy="no-referrer"><figcaption>Activator</figcaption></figure><p>这听起来很像快捷指令的升级版本。这种随心应手的感觉一直很让我喜欢，不过我很多年没有折腾越狱插件了。事实上，我会觉得在非越狱设备上实现自动化，是一件更有实际意义的事情。</p><h2>二. 记账 & 周期入账</h2><p>当我开发 <a href="https://apps.apple.com/cn/app/id1484262528" target="_blank">iCost</a> 的时候，我有陆续收到一些用户反馈，要求我做周期入账这个功能。当然了，这个功能其实不很复杂，在使用的时候，用户会配置记账类型与记账价格，再设置一个重复周期，然后应用只需要在每个周期为用户记录这一笔账单就可以。</p><figure class="image ss-img-wrapper image_resized" style="width:410px;"><img src="https://cdn.sspai.com/2021/04/17/e6ca2a728e682bc8a6a0b683e3475168.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/04/17/e6ca2a728e682bc8a6a0b683e3475168.png" referrerpolicy="no-referrer"><figcaption>产品设计图（有部分省略）</figcaption></figure><p>产品的设计逻辑不复杂，如果我按照这个方式，在应用内部嵌入这样的一个功能，是保险的选择。</p><p>但是这种配置重复周期的方式，让我觉得和系统快捷指令应用提供的“自动化”功能有十分相似的地方，那为何不直接用快捷指令实现呢？（当然了，这并不是说意味着放弃在应用内部嵌入这样的一个功能，两种实现其实并不冲突）</p><h2>三. 使用快捷指令实现周期入账</h2><p>如果说，现在操作一个快捷指令的时候，弹出一个框，让你选择记账类型和填入记账金额，那我想，又为何不直接打开应用记上一笔呢？</p><p>所以如果要实现自动化，前提要尽量减少记账过程中所需要的用户干预。而为了实现这一点，我先做了一个记账模板。</p><figure class="image ss-img-wrapper image_resized" style="width:247px;"><img src="https://cdn.sspai.com/2021/04/17/d20428cd6221ab33a5ca3a0f15e5fbf8.jpeg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/04/17/d20428cd6221ab33a5ca3a0f15e5fbf8.jpeg" referrerpolicy="no-referrer"><figcaption>记账模板</figcaption></figure><p>在这个模板功能里面，可以配置记账分类和记账价格，也可以配置入账账户和报销属性。而在创建完这样的一个模板之后，应用会将这个模板注册为一个快捷指令的动作。用户使用这个动作（Action），可以创建出一个自动化流程。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/04/17/28ca43da315dda737155b3664bbaaa2b.jpg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/04/17/28ca43da315dda737155b3664bbaaa2b.jpg" referrerpolicy="no-referrer"><figcaption>配置流程</figcaption></figure><p>那么现在可以来想一下，作为一个上班族，我该怎么使用这个功能来实现自动记账了。</p><h2>四. 用快捷指令实现自动记账（上班族版本）</h2><p>作为一个上班族，以我个人的经验，基本的行动轨迹，就是下面的一个流程：</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/04/17/37bdc0945e0deb531b4a42a5a78fc48d.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/04/17/37bdc0945e0deb531b4a42a5a78fc48d.png" referrerpolicy="no-referrer"><figcaption>行动轨迹</figcaption></figure><h3>4.1 早餐账单记录</h3><p>首先要解决的是早餐，我的早餐一般有下面的选择：</p><ul><li>牛奶 + 面包/肠粉/小笼包</li></ul><p>针对这几种固定的搭配，可以创建对应的模板：</p><figure class="image ss-img-wrapper image_resized" style="width:337px;"><img src="https://cdn.sspai.com/2021/04/18/d8c82061f0ec0fc22fb0c73979e0c735.jpeg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/04/18/d8c82061f0ec0fc22fb0c73979e0c735.jpeg" referrerpolicy="no-referrer"><figcaption>早餐模板配置</figcaption></figure><p>因为早餐种类不是完全固定的，所以我会希望在早上购买完早餐之后，手机会提示我，并辅助我去完成这一笔记账，所以我创建了下面的这个自动化：</p><figure class="ss-imgRows" figcaption><img src="https://cdn.sspai.com/2021/04/18/e82288df194b23595a8d62b7b3a77df5.jpeg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2021/04/18/e82288df194b23595a8d62b7b3a77df5.jpeg" referrerpolicy="no-referrer"><img src="https://cdn.sspai.com/2021/04/18/bc4acf42c12231670d107a22c9b7aa12.gif" alt data-original="https://cdn.sspai.com/2021/04/18/bc4acf42c12231670d107a22c9b7aa12.gif" referrerpolicy="no-referrer"></figure><p>这个自动化的内容，就是每天在9点30分的时候会提醒我记录早餐账单，并同时提供选择，点击某一个选择的同时，这个账单也就根据预先设置的模板进行了记录。</p><h3>4.2 上班交通费用账单记录</h3><p>因为住的地方离地铁站很远（租金便宜），每次去地铁站都需要骑共享单车，所以我个人的情况单车通勤和地铁通勤的费用是可以直接合并的。</p><figure class="image ss-img-wrapper image_resized" style="width:431px;"><img src="https://cdn.sspai.com/2021/04/18/4e0952e8fa55dcf4009706ce922b084e.jpeg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/04/18/4e0952e8fa55dcf4009706ce922b084e.jpeg" referrerpolicy="no-referrer"><figcaption>交通模板配置</figcaption></figure><p>而且通勤费用的配置相对早餐，要更自动化一些，因为情况更为单一，可以直接以周期入账的逻辑来进行配置：</p><figure class="ss-imgRows" figcaption><img src="https://cdn.sspai.com/2021/04/18/bbf5cacbbd4cfe56b7fbe39b81406599.PNG?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2021/04/18/bbf5cacbbd4cfe56b7fbe39b81406599.PNG" referrerpolicy="no-referrer"><img src="https://cdn.sspai.com/2021/04/18/8b7e3db8eb9d96e44f542314dec56c1f.jpeg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2021/04/18/8b7e3db8eb9d96e44f542314dec56c1f.jpeg" referrerpolicy="no-referrer"></figure><p>这也就完成了包括上班和下班的所有费用的自动记录。而如果有实际需要的话，也可以<strong>以地理位置为触发条件来进行记录</strong>，配置方式也是相似的。</p><h3>4.3 午餐账单记录</h3><p>午餐实际上是无法进行自动记录的，也不应该这么做，如果可以的话，尽量做到食物的多样化，这个只能手动打开应用进行记账。</p><h3>4.4 下午茶账单记录（NFC）</h3><p>下午茶的其中一种自动记录方式，就是类似早餐那样，配置多个选项，然后再在实际完成消费的时候使用快捷指令进行记录。这种方式不再赘述。</p><p>但是这里有另外一种方式想要推荐一下。就是使用 NFC 标签配合快捷指令实现自动记账。</p><p><code>NFC 是一种近距离无线通信技术，在 iOS 13 中，iPhone 支持了读取 NFC 标签，并且支持在快捷指令内创建 NFC 规则，再配合 iPhone XS 和 XR 系列支持后台读取，我们不需要打开快捷指令应用，甚至不需要解锁手机，只需要轻碰一下粘在桌面上的 NFC 标签，就能自动运行快捷指令动作。</code></p><p>现在我们准备这样的几个贴纸</p><figure class="image ss-img-wrapper image_resized" style="width:303px;"><img src="https://cdn.sspai.com/2021/04/18/466b2d51a50a7bc1ec792b3bd0f1dd98.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/04/18/466b2d51a50a7bc1ec792b3bd0f1dd98.png" referrerpolicy="no-referrer"><figcaption>NFC 贴纸</figcaption></figure><p>然后将其贴在自己的办公桌上，并分别进行备注：</p><figure class="image ss-img-wrapper image_resized" style="width:279px;"><img src="https://cdn.sspai.com/2021/04/18/a9c3dd98bbb95028946b6308049493f8.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/04/18/a9c3dd98bbb95028946b6308049493f8.png" referrerpolicy="no-referrer"><figcaption>添加备注</figcaption></figure><p>使用模板功能创建对应的模板，然后在快捷指令中录入对应的 NFC 标签：</p><figure class="ss-imgRows" figcaption><img src="https://cdn.sspai.com/2021/04/18/32d8bfcf55daa41172184bf86aca018d.jpeg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2021/04/18/32d8bfcf55daa41172184bf86aca018d.jpeg" referrerpolicy="no-referrer"><img src="https://cdn.sspai.com/2021/04/18/5ca483df6eca06d4b970392a11afdca9.jpg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2021/04/18/5ca483df6eca06d4b970392a11afdca9.jpg" referrerpolicy="no-referrer"></figure><p>再然后，效果是这样的：</p><figure class="ss-imgRows" figcaption><img src="https://cdn.sspai.com/2021/04/18/ee384dba385bbdfe00203fe5d50298b0.PNG?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2021/04/18/ee384dba385bbdfe00203fe5d50298b0.PNG" referrerpolicy="no-referrer"><img src="https://cdn.sspai.com/2021/04/18/ef1afcfd189ab674e8fe7db8064a653b.gif" alt data-original="https://cdn.sspai.com/2021/04/18/ef1afcfd189ab674e8fe7db8064a653b.gif" referrerpolicy="no-referrer"></figure><p>（如果取消了每次询问的选项，是不需要点击回应的）。</p><h2>五. 总结</h2><p>可以说，每一天的记账，除非基本没有规律可循，不然配合快捷指令，可以把记账的效率提高很多，同时也有一些小的乐趣。</p><p>另外简单讨论一下几个问题：</p><h3>5.1 使用 URL Scheme 来实现类似的需求，会有什么问题？</h3><p>首先 URL Scheme 的优势在于，通过 URL Scheme 来调用目标应用（iCost）的对象不一定是快捷指令这个 APP，其他的应用也可以通过 openURL 的方式来实现类似的功能。</p><p>但是缺点要更明显，URL Scheme 要求打开应用，因为真正的操作指令是在打开应用的时候传递过去的，所以这也意味着，如果手机处于休眠或者关闭屏幕的状态下的时候，自动操作是无法生效的。</p><p>而 Shortcut 指令是由 Extension 实现的，可以在不开启目标应用（iCost）的前提下，执行对应指令，与手机当前的状态没有太大关系。</p><h3>5.2 为什么不先做应用内部的周期入账？</h3><p>这首先其实是由一开始的设计决定的，因为在 iCost 的设计中，是不需要服务器参与的，用户的所有个人数据存储在自己的 iCloud 空间内，所以没有服务器可以用来运行这样的周期任务。</p><p>而如果选择不依赖服务器来实现类似的功能，该怎么做？基本只能通过记录用户两次打开应用的时间，计算这段时间的时间差，然后插入对应的数据。</p><p>这是一个基本可行的方案，但却存在一个挺有趣的问题。</p><p>假如用户的设备时间出现了问题，切换成1年之后的时间，然后进入了记账应用，在计算了时间差之后，此时应用可能会大量写入周期数据，而且这个数据很难清除（因为你无法和用户解释，为什么会出现这样错误的数据，并提供对应的交互去做清理）。</p><p><code>当然，这里同样要解释，这个问题是有很多方法可以避免的，在这里不做赘述。如果目前在使用的记账应用有这个周期入账功能的，在做好备份的前提下，可以尝试一下这种情况。</code></p><h2>六. 最重要的放最后</h2><span class="ss-application" app-id="16027"> </span></div><!----></div><div style="border:1px solid transparent;" data-v-e1f0100a></div><div class="article-side sideTop" style="display:none;left:0;" data-v-7be936cf data-v-e1f0100a><div class="download-guide-container" data-v-14f9065e data-v-7be936cf><div class="btn-wrapper" data-v-14f9065e><!----><button class="btn btn-view" data-v-14f9065e><i class="iconfont iconfont-phone" data-v-14f9065e></i></button></div><a href="https://sspai.com/s/JYjP" target="_blank" data-v-14f9065e><!----></a></div><div class="item-wrapper" data-v-7be936cf><button class="btn btn-charge" data-v-7be936cf><i class="iconfont" data-v-7be936cf></i></button><span class="count" data-v-7be936cf>5</span></div><div class="item-wrapper" data-v-7be936cf><button class="btn-mini btn-comment" data-v-7be936cf><i class="iconfont iconfont-comment" data-v-7be936cf></i></button><span class="count" data-v-7be936cf>2</span></div><div class="item-wrapper" data-v-7be936cf><span data-v-7be936cf><div role="tooltip" id="el-popover-8594" aria-hidden="true" class="el-popover el-popper popper-share right ss-popper-dark-border" style="width:undefinedpx;display:none;"><!----><div class="article-side-share-btn"><a href="https://service.weibo.com/share/share.php?url=null?ref=weibo&title=%E3%80%90%E7%94%A8%E5%BF%AB%E6%8D%B7%E6%8C%87%E4%BB%A4%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E8%AE%B0%E8%B4%A6%E7%9A%84%E4%B8%80%E5%A4%A9%E3%80%91%E4%B8%80.%E6%8E%A5%E8%A7%A6%E8%87%AA%E5%8A%A8%E5%8C%96%26Activator%E6%88%91%E6%9C%80%E6%97%A9%E6%8E%A5%E8%A7%A6%E8%87%AA%E5%8A%A8%E5%8C%96%E6%93%8D%E4%BD%9C%E7%9A%84%E6%A6%82%E5%BF%B5%EF%BC%8C%E6%9D%A5%E6%BA%90iOS%E8%B6%8A%E7%8B%B1%E6%8F%92%E4%BB%B6Activator%E3%80%82%E8%BF%99%E6%98%AF%E4%B8%80%E6%AC%BE%E7%94%B1RyanPetrich%E5%BC%80%E5%8F%91%E7%9A%84%E6%8F%92%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&pic=https%3A%2F%2Fcdn.sspai.com%2F2021%2F04%2F17%2F9a48f40733e8a8ef137912729c8b5e8a.jpg%3FimageMogr2%2Fauto-orient%2Fquality%2F95%2Fthumbnail%2F!1420x708r%2Fgravity%2FCenter%2Fcrop%2F1420x708%2Finterlace%2F1&appkey=3196502474#" target="_blank"><i class="icon icon-article_weibo right-16"></i></a><span><div role="tooltip" id="el-popover-8676" aria-hidden="true" class="el-popover el-popper" style="width:undefinedpx;display:none;"><!----><div style="text-align:center;"><div id="qr-code"></div><small class="qr-small">扫码分享</small></div></div><i class="icon icon-article_weixin right-16"></i></span><a href="https://twitter.com/share?text=%E3%80%90%E7%94%A8%E5%BF%AB%E6%8D%B7%E6%8C%87%E4%BB%A4%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E8%AE%B0%E8%B4%A6%E7%9A%84%E4%B8%80%E5%A4%A9%E3%80%91%E4%B8%80.%E6%8E%A5%E8%A7%A6%E8%87%AA%E5%8A%A8%E5%8C%96%26Activator%E6%88%91%E6%9C%80%E6%97%A9%E6%8E%A5%E8%A7%A6%E8%87%AA%E5%8A%A8%E5%8C%96%E6%93%8D%E4%BD%9C%E7%9A%84%E6%A6%82%E5%BF%B5%EF%BC%8C%E6%9D%A5%E6%BA%90iOS%E8%B6%8A%E7%8B%B1%E6%8F%92%E4%BB%B6Activator%E3%80%82%E8%BF%99%E6%98%AF%E4%B8%80%E6%AC%BE%E7%94%B1RyanPetrich%E5%BC%80%E5%8F%91%E7%9A%84%E6%8F%92%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&url=null" target="_blank" class="twitter"><i class="icon icon-article_twitter right-16"></i></a></div></div><button class="btn-mini btn-share" data-v-7be936cf><i class="iconfont iconfont-share" data-v-7be936cf></i></button></span></div><div class="item-wrapper" data-v-7be936cf><button class="btn-mini btn-collect" data-v-7be936cf><i class="iconfont iconfont-collect" data-v-7be936cf></i></button></div><!----></div><!---->  
</div>
            