
---
title: '跟着操作，50元创造属于你的智能家居'
categories: 
 - 新媒体
 - 少数派 sspai
 - Matrix
headimg: 'https://cdn.sspai.com/2022/04/03/12353fcac8bc3df387b9533d39ffd432.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
author: 少数派 sspai
comments: false
date: Fri, 16 Sep 2022 08:13:13 GMT
thumbnail: 'https://cdn.sspai.com/2022/04/03/12353fcac8bc3df387b9533d39ffd432.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
---

<div>   
<div class="articleWidth-content" data-v-557a067a><div class="update-wrap" data-v-557a067a></div><div class="content wangEditor-txt minHeight" data-v-557a067a><p>智能家居。我的理解是：智能的、易用的，能给生活提供极大便利的，才能称之为「智能家居」。</p><p>大家好，我是少数派新晋 Martix 作者，目前从事主要以政府项目为主的运营。作为我在少数派潜水多年后的第一篇内容，就是如何利用极低的成本打造属于你的智能家居。</p><h2>内容背景</h2><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/03/12353fcac8bc3df387b9533d39ffd432.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/03/12353fcac8bc3df387b9533d39ffd432.png" referrerpolicy="no-referrer"></figure><p>本文将以「<a target="_blank" rel="noopener noreferrer" href="https://www.home-assistant.io/">Home Assistant</a>」智能家居平台（简称 「<a target="_blank" rel="noopener noreferrer" href="https://www.home-assistant.io/">Home Assistant</a>」，下同），开展工作，并通过 iOS 的 HomeKit 及 Android 自身的设备管理器来控制智能家居配件。关于「<a target="_blank" rel="noopener noreferrer" href="https://www.home-assistant.io/">Home Assistant</a>」的详细介绍，如何部署及安装插件的教学，少数派已有前辈进行了详细说明，这里不再赘述。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/03/6ef55f3d8c18e4a47264ffb33ea1fe28.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/03/6ef55f3d8c18e4a47264ffb33ea1fe28.png" referrerpolicy="no-referrer"></figure><p>需强调的是，笔者通过 Debian 10 进行部署，版本是 2022.3.8，预装插件与其他方法略有出入。</p><p>由于系统过于老旧，「Home Assistant」的 Home Assistant Supervisor 不再支持 Debian 10 ，但使用下来，似乎实际上没有影响。</p><h3>重复造轮子？</h3><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/03/dca976c07209fb4c91b5012ab4e5ac6f.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/03/dca976c07209fb4c91b5012ab4e5ac6f.png" referrerpolicy="no-referrer"></figure><p>既然前辈已经在少数派中发表了基于「<a target="_blank" rel="noopener noreferrer" href="https://www.home-assistant.io/">Home Assistant</a>」构建的「智能家居」内容，为何笔者仍然要以此作为在少数派的第一篇内容？不是前辈撰写的内容不好，只是内容方向不同，本文将基于 YAML 语言来定制属于自己的「智能家居」。</p><p>本文将尽可能使用通俗的语言，力求做到即使每一位读者未曾接触也不能理解 YAML 语言的情况下能码出自己想要的配置文件，但由于笔者对 YAML 语法也未能做到了然于胸，更多地是一边学习一边进行，涉及到变量的部分无可奉告。</p><h3>自身情况及案例</h3><h4>自身情况</h4><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/03/723354ac3ca6fa3041ff169ca1e8ef61.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/03/723354ac3ca6fa3041ff169ca1e8ef61.png" referrerpolicy="no-referrer"></figure><p>笔者家中由于入网设备较多，以及需要多网合并带宽等需求，传统路由器性能已无法达到笔者需求，因此家中有一台低功耗服务器作为软路由使用，部署在 VMware 虚拟机中。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/03/45d209fc7d861c6c21f4e14792144650.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/03/45d209fc7d861c6c21f4e14792144650.png" referrerpolicy="no-referrer"></figure><p>所使用网络基于中国电信，配备有公网非固定 IP 和动态域名。</p><h4>自身案例</h4><figure class="image ss-img-wrapper image_resized" style="width:664px;"><img src="https://cdn.sspai.com/2022/04/03/4c4f9298a9aa281f4eecdd3c3fe12ecc.jpg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/03/4c4f9298a9aa281f4eecdd3c3fe12ecc.jpg" referrerpolicy="no-referrer"></figure><p>以往，每天开车出门以及回家都需要经过好几条钥匙及遥控器。现在通过「<a target="_blank" rel="noopener noreferrer" href="https://www.home-assistant.io/">Home Assistant</a>」，实现车库和楼宇门禁开关智能家居化，只动口不动手。</p><h2>动手准备</h2><blockquote><p>感谢你耐心看完以上内容，也是为了让读者更好地了解笔者的实际情况，并贴合自身实际情况进行开展。</p></blockquote><p>在安装「<a target="_blank" rel="noopener noreferrer" href="https://www.home-assistant.io/">Home Assistant</a>」后，我们需要安装「<a target="_blank" rel="noopener noreferrer" href="https://www.home-assistant.io/">E</a>SPHome」插件和「HomeKit」集成。无需理解插件与集成的区别，只需要按部就班去进行即可。</p><h3>关于 ESPHome</h3><p>「ESPHome」是一个通过简单而强大的配置文件控制来ESP8266/ESP32开发板，并通过家庭自动化系统远程控制它们的插件。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/03/29533ff5ceb4dccb36320a4732474574.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/03/29533ff5ceb4dccb36320a4732474574.png" referrerpolicy="no-referrer"></figure><p>你可以在左侧栏找到「配置」按钮，在主页面看到「加载项、备份与 Supervisor」设置</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/03/6859ea3e5ad18caea149024f6f7bf6be.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/03/6859ea3e5ad18caea149024f6f7bf6be.png" referrerpolicy="no-referrer"></figure><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/03/05cf0557308ec0690b23304535a523c3.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/03/05cf0557308ec0690b23304535a523c3.png" referrerpolicy="no-referrer"></figure><p>在右下方点击「加载项商店」，搜索 「ESPHome」并安装，勾选「在侧边栏显示」选项。</p><h3>关于「HomeKit」</h3><p>这里的「HomeKit」指的是「Home Assistant」中的 HomeKit 集成。用于让「Home Assistant」能够控制以及让非 HomeKit 配件支持 HomeKit 功能。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/03/e59dd10e67f8ead6b0a88422e43180c3.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/03/e59dd10e67f8ead6b0a88422e43180c3.png" referrerpolicy="no-referrer"></figure><p>你可以在左侧栏找到「配置」按钮，在主页面看到「集成与服务」设置</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/03/21862beb0bf916e385fab68fda4d242e.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/03/21862beb0bf916e385fab68fda4d242e.png" referrerpolicy="no-referrer"></figure><p>在右下方点击「添加集成」，搜索 「HomeKit」并安装。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/03/9fe52f6d1b8a174709d2c41ea7924a55.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/03/9fe52f6d1b8a174709d2c41ea7924a55.png" referrerpolicy="no-referrer"></figure><p>勾选「要包含的域」（想要使用的设备）选项，选择提交即可。</p><p>列表参考如下表，本案例仅使用 Binary sensor （传感器）、Switch（开关）</p><p>你也可以从  <a target="_blank" rel="noopener noreferrer" href="https://www.home-assistant.io/integrations/homekit/">「Home Assistant」的 「HomeKit」官方文档</a> 中看到完整的列表及详细说明。</p><figure class="table"><table><thead><tr><th style="text-align:center;">设备类型</th><th style="text-align:center;">设备名称</th><th style="text-align:center;">设备说明</th></tr></thead><tbody><tr><td style="background-color:rgb(255, 255, 255);border-bottom-color:rgb(229, 229, 229);border-bottom-width:1px;border-right-color:rgb(229, 229, 229);border-right-width:1px;border-style:solid;height:40px;padding:0.4em;text-align:center;">Binary sensor</td><td style="background-color:rgb(255, 255, 255);border-bottom-color:rgb(229, 229, 229);border-bottom-width:1px;border-right-color:rgb(229, 229, 229);border-right-width:1px;border-style:solid;height:40px;padding:0.4em;text-align:center;">传感器</td><td style="background-color:rgb(255, 255, 255);border-bottom-color:rgb(229, 229, 229);border-bottom-width:1px;border-right-color:rgb(229, 229, 229);border-right-width:1px;border-style:solid;height:40px;padding:0.4em;text-align:center;">用于检测和反馈车库门开闭状态</td></tr><tr><td style="background-color:rgb(255, 255, 255);border-bottom-color:rgb(229, 229, 229);border-bottom-width:1px;border-right-color:rgb(229, 229, 229);border-right-width:1px;border-style:solid;height:40px;padding:0.4em;text-align:center;">Switch</td><td style="background-color:rgb(255, 255, 255);border-bottom-color:rgb(229, 229, 229);border-bottom-width:1px;border-right-color:rgb(229, 229, 229);border-right-width:1px;border-style:solid;height:40px;padding:0.4em;text-align:center;">开关</td><td style="background-color:rgb(255, 255, 255);border-bottom-color:rgb(229, 229, 229);border-bottom-width:1px;border-right-color:rgb(229, 229, 229);border-right-width:1px;border-style:solid;height:40px;padding:0.4em;text-align:center;">用于控制车库门与楼宇门禁的开关</td></tr></tbody></table></figure><h4>补充</h4><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/04/d690d19ee60dc29547b60080395af4a3.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/04/d690d19ee60dc29547b60080395af4a3.png" referrerpolicy="no-referrer"></figure><p><strong>「HomeKit」与「HomeKit 控制器」的区别在于：</strong></p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/04/7c636e17b4b2bdf81ec6ed217319e31e.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/04/7c636e17b4b2bdf81ec6ed217319e31e.png" referrerpolicy="no-referrer"></figure><p>前者是让<strong>非 HomeKit 配件转变成 HomeKit 配件。</strong>即米家等非 HomeKit 设备转 HomeKit 配件；</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/04/8d8b595884f6e2fd41041e4617a91d27.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/04/8d8b595884f6e2fd41041e4617a91d27.png" referrerpolicy="no-referrer"></figure><p>后者是<strong>让 HomeKit 配件转变成 「Home assistant」配件。</strong>即 HomeKit 设备也能让非 iOS 设备兼容。</p><h3>购买设备</h3><p>为了防止你买了设备后却无法完成上述步骤造成浪费资金，因此所需购买的设备在这里才写出来。</p><p>接下来，你需要购买的设备包括：</p><h4>必须</h4><ol><li>ESP8266 或 ESP32 开发板（简称开发板，下同）</li><li>ESP 继电器模块（简称继电器模块，下同）</li><li>CH341 编程器（简称烧录器，下同）</li></ol><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/03/a3d0059507b4c41b59cb52ad4f0c5d35.jpg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/03/a3d0059507b4c41b59cb52ad4f0c5d35.jpg" referrerpolicy="no-referrer"><figcaption>ESP8266</figcaption></figure><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/03/2a875f3619632683f9d513211b66142d.jpg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/03/2a875f3619632683f9d513211b66142d.jpg" referrerpolicy="no-referrer"><figcaption>继电器（图中是 ESP8266 和 三路继电器的组合）</figcaption></figure><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/03/6de4e5ddb12ec9d1958399ec6fa420ad.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/03/6de4e5ddb12ec9d1958399ec6fa420ad.png" referrerpolicy="no-referrer"><figcaption>烧录器及杜邦线</figcaption></figure><p>部分卖家提供以上三个设备的套装购买。</p><h4>可选</h4><ol><li>闲置的、长期在家中的 iPad<sup class="ss-footnote" href="https://t.cj.sina.com.cn/articles/view/7747334877/1cdc6f2dd00101b3nk" title="iPad 于 iPadOS 16中不再支持作为中枢使用" footnote-id="1">1</sup> 或 HomePod 及 Apple TV 用作 iOS / iPad OS 设备能在 4G/5G 下控制配件的中枢系统。</li><li>门磁传感器（常闭或常开均可），用于反馈配件情况。</li></ol><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/03/b93338cb70e0fa303291b76251d17a25.jpg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/03/b93338cb70e0fa303291b76251d17a25.jpg" referrerpolicy="no-referrer"><figcaption>iPad 用作中枢</figcaption></figure><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/03/685bb7eda27363cb9aaee5127b6cc0b6.jpg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/03/685bb7eda27363cb9aaee5127b6cc0b6.jpg" referrerpolicy="no-referrer"><figcaption>门磁传感器</figcaption></figure><h4>说明</h4><p> </p><ol><li>笔者所使用的开发板为基于 ESP8266 系列的 ESP01 以及 ESP-12F，继电器模块分别为具有一路（用于控制楼宇门禁）和三路（用于控制车库门）的继电器模块。</li><li>关于 ESP8266开发板的详细信息，可以参考 <a target="_blank" rel="noopener noreferrer" href="https://docs.ai-thinker.com/esp8266">安信可</a> 关于 ESP8266 系列官方文档，尽管该系列开发板有不同的型号，但主要体现在于性能，本文所需要的性能即使是最基础的型号 ESP01 也能做到。</li><li>需要注意的是，ESP01S 与 ESP01 不同之处在于前款型号电阻进行了内部上拉，但由于笔者自身案例与电阻是否上拉和下拉均无关系。</li><li>常见用于「<a target="_blank" rel="noopener noreferrer" href="https://www.home-assistant.io/">Home Assistant</a>」的开发板有 ESP8266 和 ESP32 ，他们的区别可以在<a target="_blank" rel="noopener noreferrer" href="https://docs.ai-thinker.com/esp8266"> 安信可</a> 官网中找得到，但需要注意的是，由于引脚的定义不同，在「ESPHome」配置页面中<strong>务必</strong>选择正确，否则可能造成开发板烧毁乃至配件损坏。像一些二次开发的开发板，例如 Sonoff 易微联 这些也应当选择对应设备类型。</li><li>选择强电（220V）输入的继电器模块请在有电气专业人士的陪同下和断电下进行操作，否则可能造成触电危险。</li></ol><h3>开始动手</h3><h3>设备准备</h3><p>当你的开发板以及烧录器到手后，此时你的开发板与 「ESPHome」没有任何的联系，你需要编写 YAML 配置来让你的开发板与「ESPHome」携手合作。</p><p>关于开发板与「ESPHome」的逻辑关系，可以通过下图来理解</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/03/7eec731924e3c12e0a808ea08d4bcaae.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/03/7eec731924e3c12e0a808ea08d4bcaae.png" referrerpolicy="no-referrer"><figcaption>作者：XCary ，出处：<a target="_blank" rel="noopener noreferrer" href="https://bbs.hassbian.com/thread-14382-1-1.html">玩ESPHome必须明白的基本逻辑关系，再看不懂就趁早别玩了！</a></figcaption></figure><p>其原理通过文字描述就是：</p><ol><li>通过「ESPHome」给开发板「刷机」，让开发板与「ESPHome」之间能够沟通</li><li>「ESPHome」反馈信息给「<a target="_blank" rel="noopener noreferrer" href="https://www.home-assistant.io/">Home Assistant</a>」和，告诉「<a target="_blank" rel="noopener noreferrer" href="https://www.home-assistant.io/">Home Assistant</a>」我这里有一块开发板设备可以通过「ESPHome」来联动「<a target="_blank" rel="noopener noreferrer" href="https://www.home-assistant.io/">Home Assistant</a>」</li><li>用户通过手机、平板等设备连接「Home Assistant」控制「ESPHome」的配件</li></ol><p>理解以上的内容和完成相应步骤后，即可开始关键步骤。</p><h4>第一步：创建设备</h4><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/03/df4f9835f90ffedfa71e91b891684c72.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/03/df4f9835f90ffedfa71e91b891684c72.png" referrerpolicy="no-referrer"></figure><p>回到「<a target="_blank" rel="noopener noreferrer" href="https://www.home-assistant.io/">Home Assistant</a>」页面，在左侧栏找到「ESPHome」，在右上方，有一个「Secrets」按钮，用于配置开发板需要连接的 Wi-Fi </p><p>请注意，根据 <a target="_blank" rel="noopener noreferrer" href="https://docs.ai-thinker.com/esp8266">安信可</a> 关于 ESP8266 系列官方文档得知，该系列仅支持连接 2.4Ghz 的Wi-Fi。内容按照下方的格式进行填写即可。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/03/f7d46b3a4ddca468226265164efa901a.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/03/f7d46b3a4ddca468226265164efa901a.png" referrerpolicy="no-referrer"></figure><p>点击「Save」 来保存你的 Wi-Fi 配置。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/03/8dfdfbeb8fa6ebf3327f821f4124e886.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/03/8dfdfbeb8fa6ebf3327f821f4124e886.png" referrerpolicy="no-referrer"></figure><p>随后点击右下方的「NEW DEVICE」按钮，点击「Continue」进入为设备命名步骤，命名规则是只允许英文 a~z、数字0~9以及横杠「-」，输入名称后，点击「NEXT」进入设备型号选择。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/03/5e5869d1c5e9e51bcdb8361ae0e5d781.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/03/5e5869d1c5e9e51bcdb8361ae0e5d781.png" referrerpolicy="no-referrer"></figure><p>笔者的 ESP-12F 开发板尽管同属 ESP8266 系列，但其部分参数与常规 ESP8266 系列开发板略有出入，需要点击 「Pick specific board」来选择设备型号。尽管列表中没有 ESP-12F 型号，但从 <a target="_blank" rel="noopener noreferrer" href="https://docs.ai-thinker.com/esp8266">安信可</a> 关于 ESP8266 系列官方文档得知，ESP-12F 与 ESP-12E 的参数是相似的，同时也是「ESPHome」<a target="_blank" rel="noopener noreferrer" href="https://www.esphome-devices.com/devices/ESP-12F-Relay-X4">推荐的替代选择</a>。</p><p>此时，页面提示你完成了创建设备的步骤，但实际上还需要修改配置才能给 ESP8266 刷入固件。</p><p>为了让开发板支持 OTA 升级、在线读取日志等功能，你还需要进行以下修改。代码的下方为注释。</p><p><code>esphome:</code></p><p><code> name: 设备名称</code></p><p><code>#在命名步骤为设备命名的名称，无需修改。</code></p><p><code>esp8266:</code></p><p><code> board: esp12e</code></p><p><code>#开发板型号，无需修改，若要更换型号，例如 ESP8266 系列更改为 ESP32 系列，一定要修改为 ESP32 ，否则可能会因针脚引用错误导致设备损坏。</code></p><p><code>api:</code></p><p><code>#设备接口，留空，无需修改。</code></p><p><code>ota:</code></p><p><code>#让设备支持 OTA 功能</code></p><p><code> password: "*"</code></p><p><code># OTA 的密码，保持自动生成，无需修改。</code></p><p><code>wifi:</code></p><p><code> ssid: !secret wifi_ssid</code></p><p><code> password: !secret wifi_password</code></p><p><code># Wi-Fi 的 SSID 及 密码，这里的「!secret wifi_ssid」和「!secret wifi_password」表示自动引用刚才在 Security.yaml 填写的 Wi-Fi SSID 和密码，无需修改。</code></p><p><code>logger:</code></p><p><code> level: DEBUG</code></p><p><code>#开启日志输出功能，输出内容级别为 Debug 模式。</code></p><p><code>web_server:</code></p><p><code> port: 80</code></p><p><code>#让设备开启网页功能</code></p><p><code> css_url: https://esphome.io/_static/webserver-v1.min.css</code></p><p><code> js_url: https://esphome.io/_static/webserver-v1.min.js</code></p><p><code># Enable Home Assistant API</code></p><p><code>captive_portal:</code></p><p>自此你就可以进行点击 Save 来保存配置文件，随后进行烧录器和开发板的连接，并插入到电脑的 USB 接口中。</p><p>因为是基于网页刷入的，连接的电脑无须是 「Home Assistant」宿主机。这个过程只需要浏览器安装烧录插件，并且将烧录器插入实际操作的电脑 USB 端口当中即可。</p><h4>烧录器与开发板的连接</h4><figure class="ss-imgRows" figcaption="ESP01S 与 烧录器"><img src="https://cdn.sspai.com/2022/04/04/8db7810e4ea1e8aeed9a5f27fe8b09f2.jpg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2022/04/04/8db7810e4ea1e8aeed9a5f27fe8b09f2.jpg" referrerpolicy="no-referrer"><img src="https://cdn.sspai.com/2022/04/04/3824d6d8605390715416bae25f1b0e45.jpg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2022/04/04/3824d6d8605390715416bae25f1b0e45.jpg" referrerpolicy="no-referrer"></figure><p>如果你的开发板是只有针脚，那么直接将开发板插入烧录器即可；</p><figure class="ss-imgRows" figcaption="开发板没有直接插入烧录器的引脚"><img src="https://cdn.sspai.com/2022/04/04/ce088fca34fb22a084ff2d7e33e1bea1.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2022/04/04/ce088fca34fb22a084ff2d7e33e1bea1.png" referrerpolicy="no-referrer"><img src="https://cdn.sspai.com/2022/04/04/f507bd97b0724d3a45aa60561342655f.jpg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2022/04/04/f507bd97b0724d3a45aa60561342655f.jpg" referrerpolicy="no-referrer"></figure><p> </p><p>但有些开发板与继电器合为一体，可能没有直接引出的针脚，这时候需要在开发板与烧录器之间使用杜邦线来辅助连接。</p><p>由于笔者手上没有<strong>引脚的继电器</strong>已经部署在车库门中，这里只能文字解释，实际上并不难理解。</p><p>我们从开发板背面上能看到，从上至下分别是 RXD（接收端）、TXD（发送端）、RST（重置端）、引脚01（GPIO 01）、正极 3.3V、GND（接地）。同样，这样的接口在烧录器上也能看得到，我们只需要使用杜邦线按照同样的顺序，如开发板上的 3.3V 接在 烧录器上的 3.3V 即可。</p><p>给开发板烧录固件所需连接的端口分别是：3.3V、GND、RST、引脚01、TXD、RXD。</p><p>但<strong>需要注意的是： </strong>部分的烧录器 <strong>TXD </strong>与<strong> RXD </strong>需要反接，即开发板上的 TXD 接在 烧录器的 RXD 上，你可以询问卖家是否需要这么做，<strong> </strong>但笔者手上的烧录器由于已经出厂时默认反接，无需由笔者进行反接。</p><h3>代码部分</h3><p>下面，我们可以在配置文件中针对自己的内容进行配置了</p><p>关于针脚的位置，通常开发板背面会标注。</p><figure class="ss-imgRows" figcaption="三路继电器"><img src="https://cdn.sspai.com/2022/04/03/f62c520283c38ace34308610e336ba2c.jpg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2022/04/03/f62c520283c38ace34308610e336ba2c.jpg" referrerpolicy="no-referrer"><img src="https://cdn.sspai.com/2022/04/03/02f6b615748140d0aff7ef0670f1c660.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2022/04/03/02f6b615748140d0aff7ef0670f1c660.png" referrerpolicy="no-referrer"></figure><p> </p><p>从图中得知，这是一个三路继电器，其继电器的针脚分别是：</p><p>1号继电器对应 GPIO 04 针脚</p><p>2号继电器对应 GPIO 13 针脚</p><p>3号继电器对应 GPIO 15 针脚</p><p>这里以笔者的车库门案例作为示例。</p><p><code>switch:</code></p><p><code>#继电器的设备类型定义为 Switch 开关，关于设备类型请参考代码后的引用。</code></p><p><code> - platform: gpio</code></p><p><code>#接口类型为 GPIO （大多数都是）</code></p><p><code>   pin: 04</code></p><p><code>#定义需要用到的针脚为04</code></p><p><code>   name: "Garage Door Open Switch"</code></p><p><code>#赋予该开关名称为： Garage Door Open Switch</code></p><p><code>   id: open_switch</code></p><p>#定义该开关的ID，需要唯一</p><p><code>   on_turn_on:</code></p><p><code>#表示执行A操作后，自动执行B操作。</code></p><p><code>#贴近案例地说明也就是：</code></p><p><code>#通常情况下，以往按下车库门的遥控器的任何开关操作都只需要短按一次</code></p><p><code>#车库门的开启和关闭不可能同时执行。</code></p><p><code>#在按下开启按钮后，并不需要「开启车库门」一直保持短接状态</code></p><p><code>#需要的是「开启车库门」短接后，自动关闭</code></p><p><code>   - delay: 0.1s</code></p><p><code>#按下「开启车库门」后，自动进行下一条代码的操作</code></p><p><code>   - switch.turn_off: open_switch</code></p><p><code>#执行「开启的继电器」操作后，自动关闭「开启的继电器」</code></p><p><code>#至此，定义Switch的页面结束</code></p><p><code>cover:</code></p><p><code>#Cover的定义开始，告诉「Home Assistant」它是什么设备，想要怎样的控制组件。</code></p><p><code> - platform: template</code></p><p><code>#平台从模板中选择</code></p><p><code>   device_class: Garage</code></p><p><code>#表示该设备是车库门，关于Device Class设备类型可以参考代码后的引用。</code></p><p><code>#需要注意的是，如果需要在 CarPlay 中控制车库门的关闭，需要定义为 Garage</code></p><p><code>#若定义为诸如 Door 或者 Lock 等设备类型，无法在 CarPlay 中显示，其图标也有错误</code></p><p><code>   name: "Garage Door"</code></p><p><code>#定义该设备的名称为 Garage Door</code></p><p><code>   open_action:</code></p><p><code>#打开动作的定义</code></p><p><code>     - switch.turn_off: close_switch</code></p><p><code>#重置继电器的状态</code></p><p><code>     - switch.turn_on: open_switch</code></p><p><code>#告诉「Home Assistant」的车库门控制组件，打开车库门的指令对应 Switch 的哪一个动作</code></p><p><code>     - delay: 0.1s</code></p><p><code># 0.1 秒后执行某个动作</code></p><p><code>     - switch.turn_off: open_switch</code></p><p><code># 0.1 秒后恢复 打开动作 的状态为关闭</code></p><p>以上是所需用到的 Switch （开关）和 Cover（控制组件） 代码解释，由于 Switch 代码中开、关、停是近乎一样的，只需要略作修改（具体请看完整代码部分）</p><p>完整代码如下</p><p><code>esphome:</code></p><p><code> name: sspai-test</code></p><p><code>esp8266:</code></p><p><code> board: esp12e</code></p><p><code># Enable Home Assistant API</code></p><p><code>api:</code></p><p><code>ota:</code></p><p><code> password: "*"</code></p><p><code>wifi:</code></p><p><code> ssid: !secret wifi_ssid</code></p><p><code> password: !secret wifi_password</code></p><p><code> # Enable fallback hotspot (captive portal) in case wifi connection fails</code></p><p><code>switch:</code></p><p><code> - platform: gpio</code></p><p><code>   pin: 04</code></p><p><code>   name: "Garage Door Open Switch"</code></p><p><code>   id: open_switch</code></p><p><code>   on_turn_on:</code></p><p><code>   - delay: 0.1s</code></p><p><code>   - switch.turn_off: open_switch</code></p><p><code> - platform: gpio</code></p><p><code>   pin: 15</code></p><p><code>   name: "Garage Door Close Switch"</code></p><p><code>   id: close_switch</code></p><p><code>   on_turn_on:</code></p><p><code>   - delay: 0.1s</code></p><p><code>   - switch.turn_off: close_switch</code></p><p><code> - platform: gpio</code></p><p><code>   pin: 13</code></p><p><code>   name: "Garage Door Stop Switch"</code></p><p><code>   id: stop_switch</code></p><p><code>   on_turn_on:</code></p><p><code>   - delay: 0.1s</code></p><p><code>   - switch.turn_off: stop_switch</code></p><p><code>cover:</code></p><p><code> - platform: template</code></p><p><code>   device_class: Garage</code></p><p><code>   name: "Garage Door"</code></p><p><code>   open_action:</code></p><p><code>     # Cancel any previous action</code></p><p><code>     - switch.turn_off: close_switch</code></p><p><code>     # Turn the OPEN switch on briefly</code></p><p><code>     - switch.turn_on: open_switch</code></p><p><code>     - delay: 0.1s</code></p><p><code>     - switch.turn_off: open_switch</code></p><p><code>   close_action:</code></p><p><code>     - switch.turn_off: open_switch</code></p><p><code>     - switch.turn_on: close_switch</code></p><p><code>     - delay: 0.1s</code></p><p><code>     - switch.turn_off: close_switch</code></p><p><code>   stop_action:</code></p><p><code>     - switch.turn_off: open_switch</code></p><p><code>     - switch.turn_off: close_switch</code></p><p><code>     - switch.turn_on: stop_switch</code></p><p><code>     - delay: 0.1s</code></p><p><code>     - switch.turn_off: stop_switch</code></p><p><code>   optimistic: true</code></p><p><code>   assumed_state: true</code></p><p><code>   #inverted: True</code></p><p><code># Enable logging</code></p><p><code>logger:</code></p><p><code> level: DEBUG</code></p><p><code>web_server:</code></p><p><code> port: 80</code></p><p><code> css_url: https://esphome.io/_static/webserver-v1.min.css</code></p><p><code> js_url: https://esphome.io/_static/webserver-v1.min.js</code></p><p><code># Enable Home Assistant API</code></p><p><code>captive_portal:</code></p><p>如果你不需要车库门停止按钮（或是具备4路继电器），可以考虑将停止按钮（<code>Garage Door Stop Switch</code>部分）作为门磁传感器设备使用。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/04/fb5452c460e1f208542b05055a719c80.jpg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/04/fb5452c460e1f208542b05055a719c80.jpg" referrerpolicy="no-referrer"></figure><p>门磁传感器的原理是：当磁铁与感应器接触时，传感器电路导通，否则处于非导通状态。具体的代码如下：</p><p><code>binary_sensor:</code></p><p><code>#定义继电器设备类型为传感器</code></p><p><code> - platform: gpio</code></p><p><code>#接口类型为 GPIO （大多数都是）</code></p><p><code>   pin: 13</code></p><p><code>#使用的继电器针脚是13</code></p><p><code>   device_class: Garage_door</code></p><p><code>#定义设备类型为车库门，这样可以与车门开关进行联动</code></p><p><code>   filters:</code></p><p><code>#使用过滤器配置</code></p><p><code>   - delayed_on: 500ms</code></p><p><code>#如果门磁传感器处于导通，且导通时长超过 500 毫秒的话就视为确实导通状态</code></p><p><code>   name: "车库门状态传感器"</code></p><p><code>#定义该传感器名称为 车库门状态传感器</code></p><p>具有车库门开关以及车库门状态反馈完整代码如下</p><p><code>esphome:</code></p><p><code> name: cheku2</code></p><p><code>esp8266:</code></p><p><code> board: esp12e</code></p><p><code># Enable Home Assistant API</code></p><p><code>api:</code></p><p><code>ota:</code></p><p><code> password: "*"</code></p><p><code>wifi:</code></p><p><code> ssid: !secret wifi_ssid</code></p><p><code> password: !secret wifi_password</code></p><p> </p><p><code> # Enable fallback hotspot (captive portal) in case wifi connection fails</code></p><p><code>switch:</code></p><p><code> - platform: gpio</code></p><p><code>   pin: 04</code></p><p><code>   name: "Garage Door Open Switch"</code></p><p><code>   id: open_switch</code></p><p><code>   on_turn_on:</code></p><p><code>   - delay: 0.1s</code></p><p><code>   - switch.turn_off: open_switch</code></p><p><code> - platform: gpio</code></p><p><code>   pin: 15</code></p><p><code>   name: "Garage Door Close Switch"</code></p><p><code>   id: close_switch</code></p><p><code>   on_turn_on:</code></p><p><code>   - delay: 0.1s</code></p><p><code>   - switch.turn_off: close_switch</code></p><p><code> - platform: gpio</code></p><p><code>   pin: 13</code></p><p><code>   name: "garage door status sensor"</code></p><p><code>   id: status_sensor</code></p><p><code>cover:</code></p><p><code> - platform: template</code></p><p><code>   device_class: Garage</code></p><p><code>   name: "Garage Door"</code></p><p><code>   open_action:</code></p><p><code>     # Cancel any previous action</code></p><p><code>     - switch.turn_off: close_switch</code></p><p><code>     # Turn the OPEN switch on briefly</code></p><p><code>     - switch.turn_on: open_switch</code></p><p><code>     - delay: 0.1s</code></p><p><code>     - switch.turn_off: open_switch</code></p><p><code>   close_action:</code></p><p><code>     - switch.turn_off: open_switch</code></p><p><code>     - switch.turn_on: close_switch</code></p><p><code>     - delay: 0.1s</code></p><p><code>     - switch.turn_off: close_switch</code></p><p><code>   optimistic: true</code></p><p><code>   assumed_state: true</code></p><p><code>   #inverted: True</code></p><p><code>binary_sensor:</code></p><p><code>- platform: gpio</code></p><p><code>  pin: 13</code></p><p><code>  device_class: Garage_door</code></p><p><code>  filters:</code></p><p><code>  - delayed_on: 500ms</code></p><p><code>  name: "车库门状态传感器"</code></p><p><code># Enable logging</code></p><p><code>logger:</code></p><p><code> level: DEBUG</code></p><p> </p><p><code>web_server:</code></p><p><code> port: 80</code></p><p><code> css_url: https://esphome.io/_static/webserver-v1.min.css</code></p><p><code> js_url: https://esphome.io/_static/webserver-v1.min.js</code></p><p><code># Enable Home Assistant API</code></p><p><code>captive_portal:</code></p><p>这时候你就可以点击 Save 来保存了</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/04/58cee8c90d19e210b67a8924ff7084c0.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/04/58cee8c90d19e210b67a8924ff7084c0.png" referrerpolicy="no-referrer"><figcaption>保存成功提醒</figcaption></figure><p>看到 Saved 配置名称.yaml 即为成功保存，否则你应该检查一下配置文件在语法上或代码配置出现了问题。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/04/6a82a5e3feb139cd39739d918abb4e82.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/04/6a82a5e3feb139cd39739d918abb4e82.png" referrerpolicy="no-referrer"><figcaption>因大小写不一致导致报错</figcaption></figure><p>像符号错误，id 值和对应的引用值的英文大小写不一致都会出现报错。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/04/de6beb26645f7cb76a42c8051870d6e0.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/04/de6beb26645f7cb76a42c8051870d6e0.png" referrerpolicy="no-referrer"></figure><p>现在，你可以点击生成的配件的右侧按钮进行开始编译开发板固件了</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/04/ae5c52bc927c681ca8f326439a238cf8.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/04/ae5c52bc927c681ca8f326439a238cf8.png" referrerpolicy="no-referrer"></figure><p>点击 Install</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/04/7b55f7afacd410a996de2f3d5684b706.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/04/7b55f7afacd410a996de2f3d5684b706.png" referrerpolicy="no-referrer"></figure><p>选择 Manual download </p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/04/59e1781ebac9586eab6c0b686cb9bdc9.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/04/59e1781ebac9586eab6c0b686cb9bdc9.png" referrerpolicy="no-referrer"></figure><p>选择 Modern format，对开发板固件进行编译。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/04/f38c3c6c943695683802f28bea0e274a.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/04/f38c3c6c943695683802f28bea0e274a.png" referrerpolicy="no-referrer"></figure><p>编译时长大约 1-3 分钟，视 Home Assistant 宿主机的配置决定。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/04/13239bffa91a958073d886c86380f4dd.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/04/13239bffa91a958073d886c86380f4dd.png" referrerpolicy="no-referrer"></figure><p>编译完成后，浏览器会自动下载 Bin 固件文件。</p><figure class="ss-imgRows" figcaption><img src="https://cdn.sspai.com/2022/04/04/7fc69bda672b268f6562709d723fa743.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2022/04/04/7fc69bda672b268f6562709d723fa743.png" referrerpolicy="no-referrer"><img src="https://cdn.sspai.com/2022/04/04/18ff732e520ab2140d519b08653e3197.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2022/04/04/18ff732e520ab2140d519b08653e3197.png" referrerpolicy="no-referrer"></figure><p> </p><p>再次点击配件右侧按钮，选择 Install </p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/04/06ec5cc93e78fe7b715747472fe75a85.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/04/06ec5cc93e78fe7b715747472fe75a85.png" referrerpolicy="no-referrer"></figure><p>选择 Manual download</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/04/7f74461cf2e5efeba822df67bfe6ca7e.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/04/7f74461cf2e5efeba822df67bfe6ca7e.png" referrerpolicy="no-referrer"></figure><p>选择 Open ESPHome Web 进入网页刷写固件模式</p><p>首次刷入给开发板刷入固件需要安装 CH341 烧录器驱动。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/04/aea9ba49e83134935310b4a7a8a06411.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/04/aea9ba49e83134935310b4a7a8a06411.png" referrerpolicy="no-referrer"></figure><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/04/406f92c24df8ad99e13cf110bbcd7b28.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/04/406f92c24df8ad99e13cf110bbcd7b28.png" referrerpolicy="no-referrer"><figcaption>由于我已经安装了 CH341 烧写器的驱动，因此可以成功显示</figcaption></figure><p>点击 Connect 按钮，弹出选择 USB 端口，然后直接按键盘上的 ESC 按键取消选择。</p><p>此时会提示没有连接到支持的端口，下方会<a target="_blank" rel="noopener noreferrer" href="https://github.com/nodemcu/nodemcu-devkit/tree/master/Drivers">列出 CH341 烧写器驱动的下载链接</a>。 你也可以点击超链接直接进入下载。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/04/104ce66257f52481927c3d4c5b2b3e6c.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/04/104ce66257f52481927c3d4c5b2b3e6c.png" referrerpolicy="no-referrer"></figure><p>跳转到 Github 后，选择对应的操作系统即可下载驱动，按照安装向导进行安装即可。</p><p>重新刷新Open ESPHome Web 固件刷入页面，按照前部分连接烧录器即可。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/04/2c906eca3488af7bb01a318a824171bf.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/04/2c906eca3488af7bb01a318a824171bf.png" referrerpolicy="no-referrer"><figcaption>Open ESPHome Web 固件刷入页面与烧录器连接成功后，右上角会标注 Connected</figcaption></figure><p>单击 INSTALL 选择 BIN 固件</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/04/7c7998828ff1d7b60477c168b6c016a1.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/04/7c7998828ff1d7b60477c168b6c016a1.png" referrerpolicy="no-referrer"></figure><p>选择固件后，单击 INSTALL 进行安装。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/04/6e356633a457e98b78f02e2372bd9c7b.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/04/6e356633a457e98b78f02e2372bd9c7b.png" referrerpolicy="no-referrer"><figcaption>刷写过程</figcaption></figure><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/04/21f424752d3206bcf6f77c91b389b3e9.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/04/21f424752d3206bcf6f77c91b389b3e9.png" referrerpolicy="no-referrer"><figcaption>刷入成功提示</figcaption></figure><p>刷写完成后，会弹出窗口提示已经刷入成功。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/04/2609e73cc33a176b7ce1f804d98e7041.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/04/2609e73cc33a176b7ce1f804d98e7041.png" referrerpolicy="no-referrer"><figcaption>这里以我正在使用的开发板作示例</figcaption></figure><p>这时候，回到 ESPHome 页面，我们会发现刚刚刷写的开发板已经成功被 ESPHome 所识别并连接。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/04/04/c9d2410be499ef68df71da45c2af2ed4.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/04/04/c9d2410be499ef68df71da45c2af2ed4.png" referrerpolicy="no-referrer"><figcaption>Home Assistant 主页</figcaption></figure><p>在 Home Assistant 的主页中，点击右侧的开关按钮，继电器发出声音时，即表示电路成功导通，如果身边有万用表，也可以通过导通模式测量是否导通。</p><p>最后，只需要将<strong>开发板</strong>与<strong>继电器</strong>断开，独立给<strong>继电器</strong>供电。</p><h2>实装部分</h2><h4>勘测线路</h4><p>笔者的住宅是建于千禧年前后，其楼宇门禁是老式门禁，只具备贴片编码功能，开门的操作，仅仅是短接其中两条线即可。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/16/c2ab6bc045862e87e82f265e398c289f.jpg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/16/c2ab6bc045862e87e82f265e398c289f.jpg" referrerpolicy="no-referrer"><figcaption>笔者的楼宇门禁线路板</figcaption></figure><p>经过万用表测量，红线为 +12V 、黑色为负极、绿色与黄色线为通话线，其中红线与绿色为开门键，那么只需要短接红、绿即可<strong>（这里必须强调的是笔者的线路仅仅作为参考）</strong>。</p><figure class="ss-imgRows" figcaption><img src="https://cdn.sspai.com/2022/09/16/79e40d607ffcb1dfcf89aa3937e6e903.jpg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2022/09/16/79e40d607ffcb1dfcf89aa3937e6e903.jpg" referrerpolicy="no-referrer"><img src="https://cdn.sspai.com/2022/09/16/b7d3192318810d1b8ea39a1dd5db0271.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2022/09/16/b7d3192318810d1b8ea39a1dd5db0271.png" referrerpolicy="no-referrer"></figure><p>假设在编写 YAML 配置过程中，定义开关的线路为 GPIO4 ，那么只需要将门禁的开门键线路接入到 GPIO4 对应的 继电器1号的常闭即可。</p><h4> 配置 HomeKit</h4><p><a target="_blank" rel="noopener noreferrer" href="https://sspai.com/post/70089">在配置 HomeKit 实现 iDevices 控制设备的文章</a>已经由前辈说明，这里不再赘述。</p><h2>小结</h2><ol><li>在部署 Home Assistant 的过程中，踩过不少坑，感谢来自各位大佬的视频教学；</li><li>作为在少数派的第一篇 Martix 文章，代码部分少许晦涩，希望大家多多提出文章编写意见；</li><li>成本大小并非重点，重要的是通过这种折腾来提升自己的动手能力。</li></ol></div><div class="update-details-wrap" data-v-557a067a></div><!----></div><div style="border:1px solid transparent;" data-v-557a067a></div><div class="article-side sideTop" style="display:none;left:0;" data-v-cb5db094 data-v-557a067a><div class="download-guide-container" data-v-12d5b4c4 data-v-cb5db094><div class="btn-wrapper" data-v-12d5b4c4><!----><button class="btn btn-view" data-v-12d5b4c4><i class="iconfont iconfont-phone" data-v-12d5b4c4></i></button></div><a href="https://sspai.com/s/JYjP" target="_blank" data-v-12d5b4c4><!----></a></div><div class="item-wrapper" data-v-cb5db094><button class="btn btn-charge" data-v-cb5db094><i class="iconfont" data-v-cb5db094></i></button><span class="count" data-v-cb5db094>18</span></div><div class="item-wrapper" data-v-cb5db094><button class="btn-mini btn-comment" data-v-cb5db094><i class="iconfont iconfont-comment" data-v-cb5db094></i></button><span class="count" data-v-cb5db094>2</span></div><div class="item-wrapper" data-v-cb5db094><span data-v-cb5db094><div role="tooltip" id="el-popover-7618" aria-hidden="true" class="el-popover el-popper popper-share right ss-popper-dark-border" style="width:undefinedpx;display:none;"><!----><div class="article-side-share-btn"><a href="https://service.weibo.com/share/share.php?url=null?ref=weibo&title=%E3%80%90%E8%B7%9F%E7%9D%80%E6%93%8D%E4%BD%9C%EF%BC%8C50%E5%85%83%E5%88%9B%E9%80%A0%E5%B1%9E%E4%BA%8E%E4%BD%A0%E7%9A%84%E6%99%BA%E8%83%BD%E5%AE%B6%E5%B1%85%E3%80%91%E6%99%BA%E8%83%BD%E5%AE%B6%E5%B1%85%E3%80%82%E6%88%91%E7%9A%84%E7%90%86%E8%A7%A3%E6%98%AF%EF%BC%9A%E6%99%BA%E8%83%BD%E7%9A%84%E3%80%81%E6%98%93%E7%94%A8%E7%9A%84%EF%BC%8C%E8%83%BD%E7%BB%99%E7%94%9F%E6%B4%BB%E6%8F%90%E4%BE%9B%E6%9E%81%E5%A4%A7%E4%BE%BF%E5%88%A9%E7%9A%84%EF%BC%8C%E6%89%8D%E8%83%BD%E7%A7%B0%E4%B9%8B%E4%B8%BA%E3%80%8C%E6%99%BA%E8%83%BD%E5%AE%B6%E5%B1%85%E3%80%8D%E3%80%82%E5%A4%A7%E5%AE%B6%E5%A5%BD%EF%BC%8C%E6%88%91%E6%98%AF%E5%B0%91%E6%95%B0%E6%B4%BE%E6%96%B0%E6%99%8BMartix%E4%BD%9C%E8%80%85%EF%BC%8C%E7%9B%AE%E5%89%8D%E4%BB%8E%E4%BA%8B%E4%B8%BB%E8%A6%81%E4%BB%A5%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&pic=&appkey=3196502474#" target="_blank"><i class="iconfont iconfont-weibo-simple right-16"></i></a><span><div role="tooltip" id="el-popover-1185" aria-hidden="true" class="el-popover el-popper" style="width:undefinedpx;display:none;"><!----><div style="text-align:center;"><div id="qr-code"></div><small class="qr-small">扫码分享</small></div></div><span class="el-popover__reference-wrapper"><i class="iconfont iconfont-wechat-simple right-16"></i></span></span><a href="https://twitter.com/share?text=%E3%80%90%E8%B7%9F%E7%9D%80%E6%93%8D%E4%BD%9C%EF%BC%8C50%E5%85%83%E5%88%9B%E9%80%A0%E5%B1%9E%E4%BA%8E%E4%BD%A0%E7%9A%84%E6%99%BA%E8%83%BD%E5%AE%B6%E5%B1%85%E3%80%91%E6%99%BA%E8%83%BD%E5%AE%B6%E5%B1%85%E3%80%82%E6%88%91%E7%9A%84%E7%90%86%E8%A7%A3%E6%98%AF%EF%BC%9A%E6%99%BA%E8%83%BD%E7%9A%84%E3%80%81%E6%98%93%E7%94%A8%E7%9A%84%EF%BC%8C%E8%83%BD%E7%BB%99%E7%94%9F%E6%B4%BB%E6%8F%90%E4%BE%9B%E6%9E%81%E5%A4%A7%E4%BE%BF%E5%88%A9%E7%9A%84%EF%BC%8C%E6%89%8D%E8%83%BD%E7%A7%B0%E4%B9%8B%E4%B8%BA%E3%80%8C%E6%99%BA%E8%83%BD%E5%AE%B6%E5%B1%85%E3%80%8D%E3%80%82%E5%A4%A7%E5%AE%B6%E5%A5%BD%EF%BC%8C%E6%88%91%E6%98%AF%E5%B0%91%E6%95%B0%E6%B4%BE%E6%96%B0%E6%99%8BMartix%E4%BD%9C%E8%80%85%EF%BC%8C%E7%9B%AE%E5%89%8D%E4%BB%8E%E4%BA%8B%E4%B8%BB%E8%A6%81%E4%BB%A5%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&url=null" target="_blank" class="twitter"><i class="iconfont iconfont-twitter-simple right-16"></i></a></div></div><span class="el-popover__reference-wrapper"><button class="btn-mini btn-share" data-v-cb5db094><i class="iconfont iconfont-share" data-v-cb5db094></i></button></span></span></div><div class="item-wrapper" data-v-cb5db094><button class="btn-mini btn-collect" data-v-cb5db094><i class="iconfont iconfont-collect" data-v-cb5db094></i></button></div><!----></div><!---->  
</div>
            