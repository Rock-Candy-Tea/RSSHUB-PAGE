
---
title: '一日一技 _ 集中管理与备份 Windows 分散各处的应用配置文件'
categories: 
 - 新媒体
 - 少数派 sspai
 - Matrix
headimg: 'https://cdn.sspai.com/2021/07/22/article/29a1dccc0be7e157abdb9601270e7b06?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
author: 少数派 sspai
comments: false
date: Wed, 21 Jul 2021 07:03:46 GMT
thumbnail: 'https://cdn.sspai.com/2021/07/22/article/29a1dccc0be7e157abdb9601270e7b06?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
---

<div>   
<div class="articleWidth-content" data-v-e1f0100a><div class="content wangEditor-txt minHeight" data-v-e1f0100a><p>如果你使用 Chrome 或者 VScode，就一定能体会到自动同步设置和插件的幸福，可惜这种幸福并不常有。每一次更换环境，我都得花一大把世界伺候 Typora、ShareX、Everything 等应用，只为将它们配置成我熟悉的样子。</p><p>直到我听闻一位 Linux 开发者，他将 Linux 系统和应用的关键设置文件使用拷贝下来，这样不论在去哪儿工作，不多时就能让系统变成自己熟悉的样子。而 Windows 中的一部分应用也由可迁移的配置文件控制，只要有方法集中管理和备份这些文件，就能一劳永逸地解决应用设置问题。实现这个目标需要解决三个问题：</p><ol><li>去哪找 Windows 应用的配置文件？</li><li>如果它们分散在多个文件夹中，怎么统一管理和备份？</li><li>使用什么工具备份这些文件？又怎么处理文件夹里面不需要同步的东西？</li></ol><h2>相关知识</h2><h3>找到配置文件：三个重要文件夹</h3><p>Windows 是一个多用户的操作系统，从注册表，到文件目录都严格遵循系统 - 用户的两级排列方式，配置文件也不例外，它们被设计在存放以下两个文件夹中：</p><ul><li>系统盘根目录隐藏文件夹：ProgramData。存放以管理员权限安装的各类应用的默认设置，如 Microsoft OneDrive。</li><li>用户目录隐藏文件夹：AppData\Roaming。存放适用于此用户的应用配置。如 Office。</li></ul><p>此外：</p><ul><li>命令行工具，如 Git，Nodejs 的包，其配置文件一般在用户目录，可能被隐藏。</li></ul><p>绿色软件配置文件在自己的文件夹内，UWP 软件被严格隔离在沙盒内，用户正常无法访问其目录。也有特殊的应用，配置文件可以自定义位置，我们能在应用内设置中发现其路径。</p><h3>将文件们集中起来：硬链接和目录链接</h3><p>为了更方便的管理和备份，需要创建一个包含所有配置文件的目录，但为了实时同步用户的更改，又不能用复制的方式。因此我们选择硬链接和目录链接。</p><p>关联阅读：<a href="https://sspai.com/post/66834" target="_blank">符号链接、硬链接及其在 Windows 上的应用举例</a></p><p>将要使用的硬链接，我已经在上面文章简单说明了其原理和特性。硬链接只能指向同一卷已经存在的文件。这意味着，我们必须把配置文件集中在<strong>系统盘内的一个目录</strong>。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/07/22/article/29a1dccc0be7e157abdb9601270e7b06?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/07/22/article/29a1dccc0be7e157abdb9601270e7b06" referrerpolicy="no-referrer"></figure><p>目录链接和符号链接类似，但只能用于目录。之所以使用目录链接而不是符号链接，是因为目录链接经微软调优过，Windows 系统自身各类目录的跳转也都使用目录链接，它具有更高的跳转效率以及同源目录更高的相似度，这样能避免一些奇怪问题。</p><p><strong>遇到文件就使用硬链接，遇到目录就使用目录链接</strong>，创建的工具建议使用我在文中提到的 Link Shell Extension。</p><p>至于是把链接放在同步目录，还是将真正的文件放在里面，我习惯采用后面的方案，这样似乎更有安全感。如果发现移动配置文件夹后应用出错，则选用前面的方案。</p><h3>管理工具和选择性同步：Git 与 .gitignore</h3><p>OneDrive 等云盘并非为了同步多而小的文件设计：像是坚果云有秘而不宣的同步频率限制，同步这类小文本有概率丢失文件。很多配置文件一旦打开相应的应用，就是被占用状态，云盘无法同步。另外，这些云盘也无法做到精确的选择性同步。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/07/22/article/e79242f799cf1a8510b1d832e8f33cc8?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/07/22/article/e79242f799cf1a8510b1d832e8f33cc8" referrerpolicy="no-referrer"><figcaption>OneDrive 遭遇文件被占用问题</figcaption></figure><p>因此我们使用天生为文本文件而设计的 Git，再使用 .gitignore 忽略掉无需跟踪的二进制文件。.gitignore 创建在 Git 库的根目录时，对所有文件生效，创建在子文件夹时，仅对该文件夹生效。</p><h2>操作步骤</h2><p>接下来我以用户根目录下 Git 的配置文件 .gitconfig、Roaming 下 Everything 的设置文件夹以及配置目录在文档中的 ShareX 为例，展示具体操作步骤。</p><h3>移动配置文件（夹）</h3><p>在系统盘的用户目录的任意位置创建一个文件夹 Settings，作为集中管理这些配置文件的地方。用 <code>git init</code> 初始化。</p><p>然后，打开文件管理器设置中的「显示隐藏文件」。找到 Git、Everything 和 ShareX 的配置文件，在关闭这些应用的情况下，将文件或目录移动至 Settings 文件夹中。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/07/22/article/b7bdf94fcee957e069ceceef82e24b44?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/07/22/article/b7bdf94fcee957e069ceceef82e24b44" referrerpolicy="no-referrer"></figure><h3>创建链接</h3><p>因为 .gitconfig 是一个文件，我们使用 Link Shell Extension 的中键拖拽功能，为它在原来的位置创建一个硬链接。</p><p>同样的道理，给 ShareX 和 Everything 创建目录链接。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/07/22/5b90e21f2c78497951a8403f33d2b46c.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/07/22/5b90e21f2c78497951a8403f33d2b46c.png" referrerpolicy="no-referrer"></figure><p>此时，可以打开这些应用检验一下功能是不是正常，配置文件应该会继续生效。</p><h3>忽略非关键文件</h3><p>在这三个例子中，Git 和 Everything 配置文件夹中没有什么好忽略的，我们可以观察 ShareX 的文件夹结构以及文件内容：</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/07/22/article/4e8cda9fc020a704adaf2bbfb91c1926?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/07/22/article/4e8cda9fc020a704adaf2bbfb91c1926" referrerpolicy="no-referrer"></figure><p>不难发现，Logs、Backup 文件夹中记录的是运行的日志和定时保存的无用文件，无需备份。因此在 ShareX 目录创建 .gitignore 写入下面内容：</p><pre class="language-"><code>/Logs 
/Backup</code></pre><p>提交到远程仓库并设置定时任务</p><p>一切准备就绪后，便能链接到远程仓库并提交了，在 GitHub 等处新建私人仓库后：</p><pre class="language-"><code>git add .
git commit -m "Settings 2021-07-21"
git remote add origin https://github.com/example/example.git
git push -u origin master
</code></pre><p>要设置定时提交，则可通过 Windows 任务计划程序和脚本，示例脚本如下：</p><pre class="language-"><code>$date = Get-Date -Format 'yyyy-MM-dd HH:mm'
cd $home/Settings
git add .
git commit -m "Autobackup $date"
git push -q</code></pre><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/07/22/article/1973d7a7bda27f5f5fab94950926a2b7?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/07/22/article/1973d7a7bda27f5f5fab94950926a2b7" referrerpolicy="no-referrer"></figure><h2>小结</h2><p>在 Windows 中，用户在 GUI 上对应用设置的更改会以文本文件或二进制文件的形式被保存在特定的几个文件夹中，只要存留了应用配置文件，只需一次配置，就能在重装系统、更换电脑后让应用们恢复如初。</p><p>本文提供的方法是将所有需要备份的配置文件搬到同一个文件夹中，再用目录链接 & 硬链接的方式将他们链接到原位置。此配置文件夹使用 Git 做版本管理和备份工具，不需要上传的文件用 .gitignore 来精确控制。只要能在本文提到的文件夹中发现配置文件的，包括 Windows 自己的一些设置，都可以试试本文的方法。</p><p>希望能给你以启发。</p><p>题图：<a href="https://www.freepik.com/vectors/abstract" target="_blank">Abstract vector created by vectorjuice</a></p></div><!----></div><div style="border:1px solid transparent;" data-v-e1f0100a></div><div class="article-side sideTop" style="display:none;left:0;" data-v-7be936cf data-v-e1f0100a><div class="download-guide-container" data-v-14f9065e data-v-7be936cf><div class="btn-wrapper" data-v-14f9065e><!----><button class="btn btn-view" data-v-14f9065e><i class="iconfont iconfont-phone" data-v-14f9065e></i></button></div><a href="https://sspai.com/s/JYjP" target="_blank" data-v-14f9065e><!----></a></div><div class="item-wrapper" data-v-7be936cf><button class="btn btn-charge" data-v-7be936cf><i class="iconfont" data-v-7be936cf></i></button><span class="count" data-v-7be936cf>4</span></div><div class="item-wrapper" data-v-7be936cf><button class="btn-mini btn-comment" data-v-7be936cf><i class="iconfont iconfont-comment" data-v-7be936cf></i></button><span class="count" data-v-7be936cf>0</span></div><div class="item-wrapper" data-v-7be936cf><span data-v-7be936cf><div role="tooltip" id="el-popover-7756" aria-hidden="true" class="el-popover el-popper popper-share right ss-popper-dark-border" style="width:undefinedpx;display:none;"><!----><div class="article-side-share-btn"><a href="https://service.weibo.com/share/share.php?url=null?ref=weibo&title=%E3%80%90%E4%B8%80%E6%97%A5%E4%B8%80%E6%8A%80%20%7C%20%E9%9B%86%E4%B8%AD%E7%AE%A1%E7%90%86%E4%B8%8E%E5%A4%87%E4%BB%BD%20Windows%20%E5%88%86%E6%95%A3%E5%90%84%E5%A4%84%E7%9A%84%E5%BA%94%E7%94%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E3%80%91%E5%9C%A8Windows%E4%B8%AD%EF%BC%8C%E7%94%A8%E6%88%B7%E5%9C%A8GUI%E4%B8%8A%E5%AF%B9%E5%BA%94%E7%94%A8%E8%AE%BE%E7%BD%AE%E7%9A%84%E6%9B%B4%E6%94%B9%E4%BC%9A%E4%BB%A5%E6%96%87%E6%9C%AC%E6%96%87%E4%BB%B6%E6%88%96%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6%E7%9A%84%E5%BD%A2%E5%BC%8F%E8%A2%AB%E4%BF%9D%E5%AD%98%E5%9C%A8%E7%89%B9%E5%AE%9A%E7%9A%84%E5%87%A0%E4%B8%AA%E6%96%87%E4%BB%B6%E5%A4%B9%E4%B8%AD%E3%80%82%E5%8D%B8%E8%BD%BD%E5%BA%94%E7%94%A8%E5%90%8E%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%80%E8%88%AC%E4%B8%8D%E4%BC%9A%E6%B6%88%E5%A4%B1%EF%BC%8C%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&pic=https%3A%2F%2Fcdn.sspai.com%2F2021%2F07%2F21%2Fd62ed815dbf07b23206391a24d1c3adc.jpg%3FimageMogr2%2Fauto-orient%2Fquality%2F95%2Fthumbnail%2F!1420x708r%2Fgravity%2FCenter%2Fcrop%2F1420x708%2Finterlace%2F1&appkey=3196502474#" target="_blank"><i class="icon icon-article_weibo right-16"></i></a><span><div role="tooltip" id="el-popover-4143" aria-hidden="true" class="el-popover el-popper" style="width:undefinedpx;display:none;"><!----><div style="text-align:center;"><div id="qr-code"></div><small class="qr-small">扫码分享</small></div></div><span class="el-popover__reference-wrapper"><i class="icon icon-article_weixin right-16"></i></span></span><a href="https://twitter.com/share?text=%E3%80%90%E4%B8%80%E6%97%A5%E4%B8%80%E6%8A%80%20%7C%20%E9%9B%86%E4%B8%AD%E7%AE%A1%E7%90%86%E4%B8%8E%E5%A4%87%E4%BB%BD%20Windows%20%E5%88%86%E6%95%A3%E5%90%84%E5%A4%84%E7%9A%84%E5%BA%94%E7%94%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E3%80%91%E5%9C%A8Windows%E4%B8%AD%EF%BC%8C%E7%94%A8%E6%88%B7%E5%9C%A8GUI%E4%B8%8A%E5%AF%B9%E5%BA%94%E7%94%A8%E8%AE%BE%E7%BD%AE%E7%9A%84%E6%9B%B4%E6%94%B9%E4%BC%9A%E4%BB%A5%E6%96%87%E6%9C%AC%E6%96%87%E4%BB%B6%E6%88%96%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6%E7%9A%84%E5%BD%A2%E5%BC%8F%E8%A2%AB%E4%BF%9D%E5%AD%98%E5%9C%A8%E7%89%B9%E5%AE%9A%E7%9A%84%E5%87%A0%E4%B8%AA%E6%96%87%E4%BB%B6%E5%A4%B9%E4%B8%AD%E3%80%82%E5%8D%B8%E8%BD%BD%E5%BA%94%E7%94%A8%E5%90%8E%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%80%E8%88%AC%E4%B8%8D%E4%BC%9A%E6%B6%88%E5%A4%B1%EF%BC%8C%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&url=null" target="_blank" class="twitter"><i class="icon icon-article_twitter right-16"></i></a></div></div><span class="el-popover__reference-wrapper"><button class="btn-mini btn-share" data-v-7be936cf><i class="iconfont iconfont-share" data-v-7be936cf></i></button></span></span></div><div class="item-wrapper" data-v-7be936cf><button class="btn-mini btn-collect" data-v-7be936cf><i class="iconfont iconfont-collect" data-v-7be936cf></i></button></div><!----></div><!---->  
</div>
            