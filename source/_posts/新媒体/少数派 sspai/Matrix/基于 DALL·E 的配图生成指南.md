
---
title: '基于 DALL·E 的配图生成指南'
categories: 
 - 新媒体
 - 少数派 sspai
 - Matrix
headimg: 'https://cdn.sspai.com/2022/07/01/article/f1ad82b0b79a72aed004fc77757a53b3?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
author: 少数派 sspai
comments: false
date: Mon, 04 Jul 2022 03:03:44 GMT
thumbnail: 'https://cdn.sspai.com/2022/07/01/article/f1ad82b0b79a72aed004fc77757a53b3?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
---

<div>   
<div class="articleWidth-content" data-v-557a067a><div class="update-wrap" data-v-557a067a></div><div class="content wangEditor-txt minHeight" data-v-557a067a><p>找不到合适的配图，一直以来是我对写作心存畏惧的原因之一。正所谓「一图胜千言」，很多时候写好了的文字，总差一张恰到好处的配图画龙点睛。</p><p>另一方面，中文环境下比文字版权状况更糟糕的，可能就是图片版权了。不少新媒体 / 自媒体不能恰当地引用图片并标注来源，其实累积了不小的法律风险<sup class="ss-footnote" href="https://pixabay.com/zh/" title="虽然有 Pixabay 等免费正版图片素材库，但相比商业素材库的丰富内容，实在是不够用。" footnote-id="1">1</sup>。</p><p>所幸少数派的大部分作者专注于软硬件分享，可以或截图、或自拍、或借用官方商业图片（毕竟通常是正面宣传，没有太大的风险），从而规避了上述问题<sup class="ss-footnote" href title="个人博客就没有这么好运了。我关注的不少作者，相当部分都靠自己手绘来解决上述问题。" footnote-id="2">2</sup>。</p><p>所以今天分享的内容，可能只适用于少数派了吧 : )</p><h2>什么是 DALL · E？</h2><p>2021年1月，致力于「用通用人工智能造福全人类」的 OpenAI 公司基于其 GPT-3 模型发布了划时代的 DALL·E，实现了从文本生成图像。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/07/01/article/f1ad82b0b79a72aed004fc77757a53b3?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/07/01/article/f1ad82b0b79a72aed004fc77757a53b3" referrerpolicy="no-referrer"><figcaption>来自 DALL·E 论文的 Figure 3，第一行图片是正对照，第二行图片是由 DALL·E 基于每列标题自动生成的图片，剩余三行奇奇怪怪的图片由其他对比算法生成。</figcaption></figure><p>DALL·E 的弱鸡版（mini）去年 4 月公开，完全版（mega）一直拖到今年 5 月，DALL·E 2 都正式发布了<sup class="ss-footnote" href title="是的，DALL · E 2 都出了，效果比 DALL · E 强很多，但是需要排队才能获得预览。" footnote-id="3">3</sup>，才趁大家都在排队时偷偷放出。</p><p>所以我们在指南中建议如下策略，并在后文提供每个策略的具体步骤：</p><ol><li>只是想测试看看效果，可以直接使用 Hugging Face 上的 dalle-mini；</li><li>需要程序化频繁调用，可以考虑在 Google Colab 部署一份私有的 mini；</li><li>追求更好的生成效果，有条件的同学可以尝试一下 mega。</li></ol><h2>直接使用 mini 版</h2><ol><li>访问 <a href="https://huggingface.co/spaces/dalle-mini/dalle-mini">dalle-mini 模型在 Hugging Face 上的页面</a>；</li><li>在文本输入框填入语句，点击 Run 运行；</li><li>等待 20-60s 就能看到结果了，就这么简单！</li></ol><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/07/01/article/e0ee2342ac9ec71ce3bf1b274e3ad2b1?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/07/01/article/e0ee2342ac9ec71ce3bf1b274e3ad2b1" referrerpolicy="no-referrer"><figcaption>为了方便对比效果，我们统一使用官方案例「an armchair in the shape of an avocado（牛油果形状的扶手椅）」作为输入</figcaption></figure><p>你可能会问为什么图片只有 256 x 256 这么大，抱歉忘记在上一节中说了，DALL · E 的能力就是如此设计的，二代在这方面有明显改善。如果想基于一代生成更高清的图片，可以尝试专门用于图片高清放大的 AI 模型，这里就不展开啦~</p><h2>云上部署 mini 版</h2><ol><li><a href="https://colab.research.google.com/github/saharmor/dalle-playground/blob/main/backend/dalle_playground_backend.ipynb">在 Google Colab 打开 DALL · E 的代码</a>；</li><li>按顺序运行各代码块（如果有任何提示记得点击 <code>run anyway</code>）：</li></ol><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/07/01/article/e461f595acc6393480d4f3dbde363b94?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/07/01/article/e461f595acc6393480d4f3dbde363b94" referrerpolicy="no-referrer"><figcaption>安装依赖</figcaption></figure><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/07/01/article/8dab8cb8ce48b4ede1995f8525c813b8?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/07/01/article/8dab8cb8ce48b4ede1995f8525c813b8" referrerpolicy="no-referrer"><figcaption>选择 mini 模型（付费大佬可以选择 mega 或 mega_full）</figcaption></figure><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/07/01/article/67ddd37048d978745b02e5387050a8d7?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/07/01/article/67ddd37048d978745b02e5387050a8d7" referrerpolicy="no-referrer"><figcaption>运行后端服务并等待</figcaption></figure><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/07/01/article/722cfae40d12a6fda6a3a5d43ffb8e23?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/07/01/article/722cfae40d12a6fda6a3a5d43ffb8e23" referrerpolicy="no-referrer"><figcaption>等到提示服务运行在 8000 端口，拷贝上面红框处的地址</figcaption></figure><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/07/01/article/505a7980c8e5bb3eed77ca7eccc4a399?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/07/01/article/505a7980c8e5bb3eed77ca7eccc4a399" referrerpolicy="no-referrer"><figcaption>访问 <a href="https://saharmor.github.io/dalle-playground/?backendUrl=https://xxxxxx.trycloudflare.com" target="_blank"><code>https://saharmor.github.io/dalle-playground/</code></a>，填入刚才的地址，在文本输入框填入描述后回车运行即可。相比 Hugging Face 上的 mini 版本，感觉 Google Colab 是「多核版」的。</figcaption></figure><h2>本地部署 mega 版</h2><p>有勇气在本地（或服务器上）自己运行 mega 版的话，应该不太需要我描述具体步骤，一句话带过：从 <a href="https://github.com/saharmor/dalle-playground" target="_blank">代码仓库</a> clone 下来后，用 <code>docker compose</code> 方式运行起 backend 和 interface 即可。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/07/01/article/6253fe33201ba556d5c6d56f76d5ec89?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/07/01/article/6253fe33201ba556d5c6d56f76d5ec89" referrerpolicy="no-referrer"><figcaption>说实话没感觉与 mini 有太大的区别，考虑心理作用的话，勉强可以说画质有那么一丢丢的提高。值得注意的是，左下图是以上 27 张图中最接近官方宣传效果的（见下图）</figcaption></figure><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/07/01/article/17bbb52384befc7782bee70bf3065e6b?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/07/01/article/17bbb52384befc7782bee70bf3065e6b" referrerpolicy="no-referrer"><figcaption>官方在介绍 DALL · E 的博客文章中给出的样例输出 <a href="https://openai.com/blog/dall-e/" target="_blank">https://openai.com/blog/dall-e/</a></figcaption></figure><p>我在本地跑 mega_full 时（对的，其实还有 mega_full，如果 GPU 显存够 12G 就可一试），遇到了一些问题，在此列出以便大家避坑：</p><ol><li>本地 build dalle-backend image 时，特别容易因为网络问题失败，在 Dockerfile 中利用 ENV 语句加上 proxy 会好很多；</li><li>类似的，build dalle-interface image 时，可以在 <code>RUN npm install</code> 后面补上一个 <code>--registry=https://registry.npmmirror.com</code>；</li><li>跑 interface 的时候可能会报 eslint 的 warning，修改一下 <i>package.json</i> 跳过：</li><li>初次启动 backend 时会从 wandb 下载模型参数，按道理应该会有一个进度条，但在我的环境中经常不予显示，这个时候可以通过检查 <i>~/.cache/wandb</i> 下面的文件大小的变化来确认进程没有挂……</li></ol><h2>最后的 FAQs</h2><h3>DALL · E 是不是有点过时了？</h3><p>从算法模型上来说是的，但它仍然是普通用户能够直接、免费体验的最先进的文本到图像生成器了。</p><h3>能否再给一些生成案例？</h3><figure class="ss-imgRows" figcaption="「a picture worth a thousand words」&「people mountain people sea」"><img src="https://cdn.sspai.com/2022/07/04/0504175ccabe0d947933cb48ab72768a.jpeg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2022/07/04/0504175ccabe0d947933cb48ab72768a.jpeg" referrerpolicy="no-referrer"><img src="https://cdn.sspai.com/2022/07/04/74b5ccbc87ff6039aeb9c6a7bfa3497e.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2022/07/04/74b5ccbc87ff6039aeb9c6a7bfa3497e.png" referrerpolicy="no-referrer"></figure><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/07/01/ef15402cdc4101196910374d79d09da4.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/07/01/ef15402cdc4101196910374d79d09da4.png" referrerpolicy="no-referrer"><figcaption>「logo of pi」</figcaption></figure><h3>为什么 Hugging Face 的版本有点奇怪？</h3><p>本文初版发布后，我突然从社交平台上得知了一个令人震惊的事实：原来 Hugging Face 上的 DALL · E Mini（见前文「直接使用 Mini 版」一节）是一个叫 <a href="https://www.craiyon.com/" target="_blank">craiyon.com</a> 的团队盗版的。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/07/04/article/68b65b4b9fb72ad00f562049c0826037?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/07/04/article/68b65b4b9fb72ad00f562049c0826037" referrerpolicy="no-referrer"><figcaption>在 OpenAI 的要求下，模型已改名为 craiyon 但 Hugging Face 页面上没有修改标题，只是加了一行小字</figcaption></figure><p>craiyon 用了一个更简单的模型（BART）搭配更少的训练数据，在 Hugging Face 上构建了一个易于体验的文本-图片生成器。从前面的案例图其实也能够看出来，craiyon 生成的牛油果椅的外形其实比较类似，远不如正版 DALL · E 那么千奇百怪。而且在一些 edge case 中，比如上面案例中的「people mountain people sea」，craiyon 的生成结果明显不如 DALL · E。</p><p>据 Hugging Face 的 CEO 说，craiyon 刚上线的第一个晚上他们的工程师一夜未睡。现在这个模型每天被大家调用数万次以上，已成为互联网上最受欢迎的 meme 生成器<sup class="ss-footnote" href title="从这个案例上可以看出来，一个爆款成功的背后技术和非技术原因都不可或缺：在技术方面 craiyon 用取巧的方式构建了一个可以跑在 Hugging Face 上的轻量版本，在非技术方面 craiyon 直接盗用了更受到大家关注的 DALL · E 的名字。" footnote-id="4">4</sup>。数万次调用看上去不多，但直接导致现在想直接体验 craiyon 平均需要等待 60 秒以上，而我刚开始写这篇文章时只需要 20 秒。</p><p><strong>突然感觉本文更有价值了 : )</strong></p></div><div class="update-details-wrap" data-v-557a067a></div><!----></div><div style="border:1px solid transparent;" data-v-557a067a></div><div class="article-side sideTop" style="display:none;left:0;" data-v-7be936cf data-v-557a067a><div class="download-guide-container" data-v-14f9065e data-v-7be936cf><div class="btn-wrapper" data-v-14f9065e><!----><button class="btn btn-view" data-v-14f9065e><i class="iconfont iconfont-phone" data-v-14f9065e></i></button></div><a href="https://sspai.com/s/JYjP" target="_blank" data-v-14f9065e><!----></a></div><div class="item-wrapper" data-v-7be936cf><button class="btn btn-charge" data-v-7be936cf><i class="iconfont" data-v-7be936cf></i></button><span class="count" data-v-7be936cf>7</span></div><div class="item-wrapper" data-v-7be936cf><button class="btn-mini btn-comment" data-v-7be936cf><i class="iconfont iconfont-comment" data-v-7be936cf></i></button><span class="count" data-v-7be936cf>9</span></div><div class="item-wrapper" data-v-7be936cf><span data-v-7be936cf><div role="tooltip" id="el-popover-5019" aria-hidden="true" class="el-popover el-popper popper-share right ss-popper-dark-border" style="width:undefinedpx;display:none;"><!----><div class="article-side-share-btn"><a href="https://service.weibo.com/share/share.php?url=null?ref=weibo&title=%E3%80%90%E5%9F%BA%E4%BA%8E%20DALL%C2%B7E%20%E7%9A%84%E9%85%8D%E5%9B%BE%E7%94%9F%E6%88%90%E6%8C%87%E5%8D%97%E3%80%91%E6%89%BE%E4%B8%8D%E5%88%B0%E5%90%88%E9%80%82%E7%9A%84%E9%85%8D%E5%9B%BE%EF%BC%8C%E4%B8%80%E7%9B%B4%E4%BB%A5%E6%9D%A5%E6%98%AF%E6%88%91%E5%AF%B9%E5%86%99%E4%BD%9C%E5%BF%83%E5%AD%98%E7%95%8F%E6%83%A7%E7%9A%84%E5%8E%9F%E5%9B%A0%E4%B9%8B%E4%B8%80%E3%80%82%E6%AD%A3%E6%89%80%E8%B0%93%E3%80%8C%E4%B8%80%E5%9B%BE%E8%83%9C%E5%8D%83%E8%A8%80%E3%80%8D%EF%BC%8C%E5%BE%88%E5%A4%9A%E6%97%B6%E5%80%99%E5%86%99%E5%A5%BD%E4%BA%86%E7%9A%84%E6%96%87%E5%AD%97%EF%BC%8C%E6%80%BB%E5%B7%AE%E4%B8%80%E5%BC%A0%E6%81%B0%E5%88%B0%E5%A5%BD%E5%A4%84%E7%9A%84%E9%85%8D%E5%9B%BE%E7%94%BB%E9%BE%99%E7%82%B9%E7%9D%9B%E3%80%82%E5%8F%A6%E4%B8%80%E6%96%B9%E9%9D%A2%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&pic=https%3A%2F%2Fcdn.sspai.com%2F2022%2F07%2F04%2Ff104f6d35ccf7456d157885b1821ffcc.jpg%3FimageMogr2%2Fauto-orient%2Fquality%2F95%2Fthumbnail%2F!1420x708r%2Fgravity%2FCenter%2Fcrop%2F1420x708%2Finterlace%2F1&appkey=3196502474#" target="_blank"><i class="iconfont iconfont-weibo-simple right-16"></i></a><span><div role="tooltip" id="el-popover-1417" aria-hidden="true" class="el-popover el-popper" style="width:undefinedpx;display:none;"><!----><div style="text-align:center;"><div id="qr-code"></div><small class="qr-small">扫码分享</small></div></div><span class="el-popover__reference-wrapper"><i class="iconfont iconfont-wechat-simple right-16"></i></span></span><a href="https://twitter.com/share?text=%E3%80%90%E5%9F%BA%E4%BA%8E%20DALL%C2%B7E%20%E7%9A%84%E9%85%8D%E5%9B%BE%E7%94%9F%E6%88%90%E6%8C%87%E5%8D%97%E3%80%91%E6%89%BE%E4%B8%8D%E5%88%B0%E5%90%88%E9%80%82%E7%9A%84%E9%85%8D%E5%9B%BE%EF%BC%8C%E4%B8%80%E7%9B%B4%E4%BB%A5%E6%9D%A5%E6%98%AF%E6%88%91%E5%AF%B9%E5%86%99%E4%BD%9C%E5%BF%83%E5%AD%98%E7%95%8F%E6%83%A7%E7%9A%84%E5%8E%9F%E5%9B%A0%E4%B9%8B%E4%B8%80%E3%80%82%E6%AD%A3%E6%89%80%E8%B0%93%E3%80%8C%E4%B8%80%E5%9B%BE%E8%83%9C%E5%8D%83%E8%A8%80%E3%80%8D%EF%BC%8C%E5%BE%88%E5%A4%9A%E6%97%B6%E5%80%99%E5%86%99%E5%A5%BD%E4%BA%86%E7%9A%84%E6%96%87%E5%AD%97%EF%BC%8C%E6%80%BB%E5%B7%AE%E4%B8%80%E5%BC%A0%E6%81%B0%E5%88%B0%E5%A5%BD%E5%A4%84%E7%9A%84%E9%85%8D%E5%9B%BE%E7%94%BB%E9%BE%99%E7%82%B9%E7%9D%9B%E3%80%82%E5%8F%A6%E4%B8%80%E6%96%B9%E9%9D%A2%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&url=null" target="_blank" class="twitter"><i class="iconfont iconfont-twitter-simple right-16"></i></a></div></div><span class="el-popover__reference-wrapper"><button class="btn-mini btn-share" data-v-7be936cf><i class="iconfont iconfont-share" data-v-7be936cf></i></button></span></span></div><div class="item-wrapper" data-v-7be936cf><button class="btn-mini btn-collect" data-v-7be936cf><i class="iconfont iconfont-collect" data-v-7be936cf></i></button></div><!----></div><!---->  
</div>
            