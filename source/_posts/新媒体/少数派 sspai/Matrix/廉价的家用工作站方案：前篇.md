
---
title: '廉价的家用工作站方案：前篇'
categories: 
 - 新媒体
 - 少数派 sspai
 - Matrix
headimg: 'https://cdn.sspai.com/2021/07/02/0caa53e98957a3ee70ef3c0d7a3e8a35.jpg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
author: 少数派 sspai
comments: false
date: Fri, 02 Jul 2021 13:40:13 GMT
thumbnail: 'https://cdn.sspai.com/2021/07/02/0caa53e98957a3ee70ef3c0d7a3e8a35.jpg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
---

<div>   
<div class="articleWidth-content" data-v-e1f0100a><div class="content wangEditor-txt minHeight" data-v-e1f0100a><p>在 2021 年第三个季度开始，我又下单了一台设备，作为已有资源的补充。在新设备到来之前，正好对已经运行了一个季度时间的“老设备”做下总结和分享。</p><p>分享下我是如何以相对低的成本解决平时学习、研究等常规需求的。希望能帮到有类似需求的同学。</p><h2>写在前面</h2><p>和我相熟的朋友都知道，我折腾过不少设备，并将其中的一些笔记记录在了 GitHub 的 <a href="https://github.com/soulteary/Home-Network-Note">Home-Network-Note</a> 中。</p><p>在 2021 年第一个季度末，我将搭载 Intel CPU 的 HP EliteDesk 小型服务器换成了基于 AMD Ryzen 7 PRO 4750U 的 ThinkPad，没错，我将一台“台式机”换成了“笔记本”，并将这台笔记本作为“家用服务器”使用。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/07/02/0caa53e98957a3ee70ef3c0d7a3e8a35.jpg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/07/02/0caa53e98957a3ee70ef3c0d7a3e8a35.jpg" referrerpolicy="no-referrer"><figcaption>目前孤单的笔记本</figcaption></figure><p>之所以会做这样的选择，除了因为这个方案具备一定的性价比，以及额外的体验加成之外，还因为我曾经在不同的时间段使用不同的设备，7x24 小时的跑过类似的事情，对于这个方案有一定的信任：</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/07/02/f2de97604cc91c4a72a67a6dcaf41d10.jpg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/07/02/f2de97604cc91c4a72a67a6dcaf41d10.jpg" referrerpolicy="no-referrer"><figcaption>2015～2016 年，使用神舟笔记本、MacBook Pro</figcaption></figure><p>2015～2016 年，我使用过 神舟笔记本、MacBook Pro 作为家庭工作站，跑一些小服务。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/07/02/770a938c00ff99b09b318cf6f2b6d537.jpg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/07/02/770a938c00ff99b09b318cf6f2b6d537.jpg" referrerpolicy="no-referrer"><figcaption>2018 年，使用 MacBook Pro、ThinkPad</figcaption></figure><p>2018 年，在公司办公网，我使用过一台 MacBook Pro 和一台 ThinkPad 低端设备，为公司跑过至少半年以上的门禁服务和一个办公区域的共享网盘。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/07/02/952b093c4594553f618099b3772c2f79.jpg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/07/02/952b093c4594553f618099b3772c2f79.jpg" referrerpolicy="no-referrer"><figcaption>2020 年，使用了一年的 ThinkPad</figcaption></figure><p>2020年，在公司办公网，我曾使用过一台 ThinkPad E 系列低端设备，为单位跑过一套数据网关，每秒处理十几万条以上数据，从年初跑到接近年末，笔记本除了脏了一些外，安然无恙。</p><p>所以，<strong>拿笔记本当服务器用，我算是有过一定浅显的使用经验，对这个方案有一定的信任</strong>。</p><p>一般情况下，只要做好数据备份，处理好电源备份，目前没有遇到过有啥问题，更何况学习、研究场景下，突发的峰值计算那点计算量，对于笔记本来说完全没有压力。遇到持续性的计算压力，只要电源没有问题，也问题不大，比如编译个路由器、编译个 Chrome 扔一边等着就好了，当然，使用按量计费的云服务器可能够更快的拿到结果。在<a href="https://soulteary.com/2021/06/22/nuc-notes-install-esxi7.html">NUC 折腾笔记 - 安装 ESXi 7</a>一文中，我有提到过，感兴趣的同学可以自行翻阅。</p><p>在继续分享这个方案的体验优势和缺点之前，先来介绍一下这个机器的主要配置，以及和之前台式服务器的对比。</p><h2>机器配置</h2><p>我目前运行了一个多季度的笔记本配置如下：</p><ul><li>设备型号：ThinkPad L14</li><li>处理器：AMD Ryzen 7 PRO 4750U (8C / 16T, 1.7 / 4.1GHz, 4MB L2 / 8MB L3) / 15W TDP</li><li>内存配置：64G / 2667</li><li>磁盘位：1个磁盘位，NGFF</li><li>详细产品规格：<a href="https://psref.lenovo.com/Detail/ThinkPad/ThinkPad_L14_Gen_1_AMD?M=20U50000AT">官方网站</a></li></ul><p>而之前的台式服务器的配置则是：</p><ul><li>设备型号：Elite Desk 800 G4</li><li>处理器 Intel Core i7-8700 （6C / 12T, 3.2 / 4.6 GHz，1.5MB L2/ 12MB L3） / 65W TDP</li><li>内存配置：64GB / 2400</li><li>磁盘位：至少两块 NGFF 磁盘位，两块以上 SATA SDD 接入。</li><li>详细产品规格：<a href="https://support.hp.com/hk-zh/document/c06053607">官方网站</a></li></ul><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/07/02/ac5d208bffe155b7d1bbff72dac5f6ff.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/07/02/ac5d208bffe155b7d1bbff72dac5f6ff.png" referrerpolicy="no-referrer"><figcaption>两个设备 CPU 直观的性能差异</figcaption></figure><p>在了解了两个设备的差异之后，我们来看看体验上和场景上的区别。</p><h2>体验差别：“有舍有得”</h2><p>凡是有舍有得，我们先来看看相比较传统的服务器（Mirco）、小型服务器（SFF）来说，我舍弃了哪些东西，其实不多：</p><ol><li>首先是更高的 CPU 主频。</li><li>其次是扩展性：更大的机箱空间、丰富的硬件插槽、以及更多的硬盘盘位。</li><li>最后是配件上，尤其是内存条，相比较笔记本内存，台式机的内存价格会实惠一些。</li></ol><p>再来看看得到的了些什么：</p><ol><li>一台核心数更多，突发性能不低，但是成本不高的计算设备，虚拟化体验良好，能够满足突发的数据分析需求。</li><li>CPU TDP 功耗明显降低，整机功耗不过 45w，非常适合 7x24 小时运行，节能环保。</li><li>一台体积更小的设备，不论是日常运行，还是偶尔携带出行，都很方便。</li><li>一台自带显示器的设备，避免了有时调试设备还需要扯线，准备键盘鼠标等麻烦事。</li><li>以及因为制程更先进，使用过程中发热会比以往机器更少，对于机柜其他设备的影响也更小，平时风扇也没有声音，屋内感知也更“薄弱”了，也减少了维护清理灰尘等麻烦事情的频率和次数。</li></ol><p>是不是感觉失去的不多，得到了不少，还挺划算的？客观来说，这里其实有一些沉默成本，如果你可以投入类似的成本，或者可以忽略以下成本，那么这个方案，或许也适合你。</p><h2>关于“沉默成本”</h2><p>下面聊聊各种沉默成本。</p><p>首先，不论是家用还是企业场景，降低设备成本的第一奥义就是<strong>存储和计算分离</strong>，不要追求“既A好又B好”的方案，除非你需求如此，或者完全不差钱。我使用 NAS 来解决存储问题，所以在设备本地磁盘上可以做一些妥协，放弃绝对的盘位数，追求质量，选择更高带宽和持续吞吐的 SSD。</p><p>其次，我不希望在家里运行的设备出现任何明显的声音影响我和家里人日常写字、学习，这也是我对本地磁盘尽可能选型是 SSD 的原因，包括给 NAS 添加 SSD 缓存，减少传统硬盘发出的声音的频率和次数等等。</p><p>然后，我偶尔有带着设备出去的需求，以往对于网络的需求还是比较高的，至少需要联网回家，有了这台设备之后，我只需要行李箱或者书包里带着这两台设备就好了，后续把 MacBook Pro 完全优化成 Pad 后，重量上的体验也会更好。</p><p>接着，我完全不介意笔电的屏幕、键盘体验，因为我基本买回家之后就把它扔机柜，关了显示器当服务器使用，平时交互只使用 SSH 或者 网络协议进行交互。</p><p>最后，使用类似“互联网”思路，控制总成本，使用尽可能多的设备，形成冗余，提高性能和整体可用性，而不是类似传统企业，搞高性能、大单点机器资源。这里对于机器在软件、网络上的管理成本会比使用“单体”资源要高一些。</p><p>接下来我们来进一步，了解下这个方案的性价比。</p><h2>关于性价比</h2><p>先来聊聊自购硬件场景下的成本问题，这里主要涉及到“台式机”（包含微型、小型服务器）和笔记本的价格差异。</p><p>一般情况下，选择和笔电相同系列、甚至相同型号的CPU 的台式机，价格可以更加低廉。但是在当前的时代，如果你选择的是不带显卡的纯计算设备，你会发现台式机“更贵”。</p><p>相比较各种笔记本品牌而言，出货量少的可怜。这意味着台式机的产品型号选择会更少，最终产品售后和价格可能不尽如意；其次，上文提到的能耗和噪音问题，在实际使用过程中，是逃避不开的问题；最后，台式机普遍还是追求更高的绝对性能，以及会追逐带显卡的配置，所以整体价格一般会高于只包含 CPU 的计算设备的价格。</p><p>在产品选择上，一般建议是选择次旗舰款的 CPU，或者往季期间 CPU，以获得更好的性价比。但是在笔电产品上，为了追求使用体验，还需要关注几个点：</p><ol><li>CPU 功率释放限制是多少，能否通过 BIOS 设置解锁。</li><li>机器散热能力如何，风道、散热片是否偷工减料。</li><li>是否存在精准刀法，使用板载内存，软强迫升级换代时间。</li><li>是否存在某产品型号模具普遍缺陷，网上有许多用户爆料产品质量或品控存在问题。</li></ol><p>这里不存在完美的设备，一定需要在某一点上做出妥协，比如操作体验、比如内存扩展性、磁盘扩展性、CPU功耗、外置接口等等。</p><p>接着，我们再来看看云服务器的成本，可以看到不论是阿里云还是腾讯云，不纠结带宽和磁盘问题，仅勾选 “16核心64GB内存” 规格，一年的成本都在两万元左右，即使不考虑笔记本的8个超线程，降配勾选“8核心64GB内存”，一年成本也需要一万四千元左右，而上文中提到的笔记本，包含1T高速 SSD 磁盘，一次性投入也不过 6800 块左右。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/07/02/860e0f07e1da0e30f6da996d830761ef.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/07/02/860e0f07e1da0e30f6da996d830761ef.png" referrerpolicy="no-referrer"><figcaption>阿里云 16cores 64g 服务器一年成本</figcaption></figure><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/07/02/61b13258a929c2ac8076ad98ebebf766.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/07/02/61b13258a929c2ac8076ad98ebebf766.png" referrerpolicy="no-referrer"><figcaption>腾讯云 16cores 64g 服务器一年成本</figcaption></figure><p>当然，这样的对比是不够客观的。云服务器的磁盘、甚至机器包含多副本、拥有更多的自动化运维方案保障可维护性，也不存在电费消耗，自然成本更高。</p><p>但是对于学习、研究场景而言，本地硬件一次性投入 4000～7000 ，能够连续使用 3 年至 5 年，显然均摊成本更低，甚至还能够出二手配件或者整机回血，进一步降低成本，而电费一个月不过20块，还没有一份快餐贵，至于网络成本，购置一条 300～1000M 下行的宽带其实并不贵，而且也并不是这台设备专用，平时生活中也得用是不？</p><p>所以，如果你有类似的需求，不妨试试看，或许对喜欢折腾的你来说，也是一个性价比颇高的方案。</p><h2>最后：使用上的“坑”</h2><p>在设备到手后，我先使用自带的 Windows 系统对系统硬件做了基础的检测，确定设备硬件没有明显的问题后，便将 Ubuntu Server 20.04 LTS 版本安装到了这台机器上。</p><p>但是在体验了几天后，发觉移动场景下，并不是哪里都有网线，以及需要切换 Wi-Fi 的时候，Server 版本会特别麻烦，于是又切到了 Desktop 版本。</p><p>起初使用的过程中，发现特别容易出现“花屏”，在网上查询一通发现 Linux 老 Kernel 对于新的 CPU 和网卡支持并不好，最简单的解决方案是自己下载 Kernel 编译或者安装。在升级 Kernel 之后，机器就稳定的运行到现在啦。</p><p>关于这点，我会放在下一台设备到来后一起分享。</p><p>--EOF</p></div><!----></div><div style="border:1px solid transparent;" data-v-e1f0100a></div><div class="article-side sideTop" style="display:none;left:0;" data-v-7be936cf data-v-e1f0100a><div class="download-guide-container" data-v-14f9065e data-v-7be936cf><div class="btn-wrapper" data-v-14f9065e><!----><button class="btn btn-view" data-v-14f9065e><i class="iconfont iconfont-phone" data-v-14f9065e></i></button></div><a href="https://sspai.com/s/JYjP" target="_blank" data-v-14f9065e><!----></a></div><div class="item-wrapper" data-v-7be936cf><button class="btn btn-charge" data-v-7be936cf><i class="iconfont" data-v-7be936cf></i></button><span class="count" data-v-7be936cf>2</span></div><div class="item-wrapper" data-v-7be936cf><button class="btn-mini btn-comment" data-v-7be936cf><i class="iconfont iconfont-comment" data-v-7be936cf></i></button><span class="count" data-v-7be936cf>1</span></div><div class="item-wrapper" data-v-7be936cf><span data-v-7be936cf><div role="tooltip" id="el-popover-9738" aria-hidden="true" class="el-popover el-popper popper-share right ss-popper-dark-border" style="width:undefinedpx;display:none;"><!----><div class="article-side-share-btn"><a href="https://service.weibo.com/share/share.php?url=null?ref=weibo&title=%E3%80%90%E5%BB%89%E4%BB%B7%E7%9A%84%E5%AE%B6%E7%94%A8%E5%B7%A5%E4%BD%9C%E7%AB%99%E6%96%B9%E6%A1%88%EF%BC%9A%E5%89%8D%E7%AF%87%E3%80%91%E5%9C%A82021%E5%B9%B4%E7%AC%AC%E4%B8%89%E4%B8%AA%E5%AD%A3%E5%BA%A6%E5%BC%80%E5%A7%8B%EF%BC%8C%E6%88%91%E5%8F%88%E4%B8%8B%E5%8D%95%E4%BA%86%E4%B8%80%E5%8F%B0%E8%AE%BE%E5%A4%87%EF%BC%8C%E4%BD%9C%E4%B8%BA%E5%B7%B2%E6%9C%89%E8%B5%84%E6%BA%90%E7%9A%84%E8%A1%A5%E5%85%85%E3%80%82%E5%9C%A8%E6%96%B0%E8%AE%BE%E5%A4%87%E5%88%B0%E6%9D%A5%E4%B9%8B%E5%89%8D%EF%BC%8C%E6%AD%A3%E5%A5%BD%E5%AF%B9%E5%B7%B2%E7%BB%8F%E8%BF%90%E8%A1%8C%E4%BA%86%E4%B8%80%E4%B8%AA%E5%AD%A3%E5%BA%A6%E6%97%B6%E9%97%B4%E7%9A%84%E2%80%9C%E8%80%81%E8%AE%BE%E5%A4%87%E2%80%9D%E5%81%9A%E4%B8%8B%E6%80%BB%E7%BB%93%E5%92%8C%E5%88%86%E4%BA%AB%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&pic=https%3A%2F%2Fcdn.sspai.com%2F2021%2F07%2F02%2F0388a696ad1baeea922cc2f395eb4728.jpg%3FimageMogr2%2Fauto-orient%2Fquality%2F95%2Fthumbnail%2F!1420x708r%2Fgravity%2FCenter%2Fcrop%2F1420x708%2Finterlace%2F1&appkey=3196502474#" target="_blank"><i class="icon icon-article_weibo right-16"></i></a><span><div role="tooltip" id="el-popover-6022" aria-hidden="true" class="el-popover el-popper" style="width:undefinedpx;display:none;"><!----><div style="text-align:center;"><div id="qr-code"></div><small class="qr-small">扫码分享</small></div></div><span class="el-popover__reference-wrapper"><i class="icon icon-article_weixin right-16"></i></span></span><a href="https://twitter.com/share?text=%E3%80%90%E5%BB%89%E4%BB%B7%E7%9A%84%E5%AE%B6%E7%94%A8%E5%B7%A5%E4%BD%9C%E7%AB%99%E6%96%B9%E6%A1%88%EF%BC%9A%E5%89%8D%E7%AF%87%E3%80%91%E5%9C%A82021%E5%B9%B4%E7%AC%AC%E4%B8%89%E4%B8%AA%E5%AD%A3%E5%BA%A6%E5%BC%80%E5%A7%8B%EF%BC%8C%E6%88%91%E5%8F%88%E4%B8%8B%E5%8D%95%E4%BA%86%E4%B8%80%E5%8F%B0%E8%AE%BE%E5%A4%87%EF%BC%8C%E4%BD%9C%E4%B8%BA%E5%B7%B2%E6%9C%89%E8%B5%84%E6%BA%90%E7%9A%84%E8%A1%A5%E5%85%85%E3%80%82%E5%9C%A8%E6%96%B0%E8%AE%BE%E5%A4%87%E5%88%B0%E6%9D%A5%E4%B9%8B%E5%89%8D%EF%BC%8C%E6%AD%A3%E5%A5%BD%E5%AF%B9%E5%B7%B2%E7%BB%8F%E8%BF%90%E8%A1%8C%E4%BA%86%E4%B8%80%E4%B8%AA%E5%AD%A3%E5%BA%A6%E6%97%B6%E9%97%B4%E7%9A%84%E2%80%9C%E8%80%81%E8%AE%BE%E5%A4%87%E2%80%9D%E5%81%9A%E4%B8%8B%E6%80%BB%E7%BB%93%E5%92%8C%E5%88%86%E4%BA%AB%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&url=null" target="_blank" class="twitter"><i class="icon icon-article_twitter right-16"></i></a></div></div><span class="el-popover__reference-wrapper"><button class="btn-mini btn-share" data-v-7be936cf><i class="iconfont iconfont-share" data-v-7be936cf></i></button></span></span></div><div class="item-wrapper" data-v-7be936cf><button class="btn-mini btn-collect" data-v-7be936cf><i class="iconfont iconfont-collect" data-v-7be936cf></i></button></div><!----></div><!---->  
</div>
            