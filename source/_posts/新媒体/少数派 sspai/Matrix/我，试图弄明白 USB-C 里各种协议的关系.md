
---
title: '我，试图弄明白 USB-C 里各种协议的关系'
categories: 
 - 新媒体
 - 少数派 sspai
 - Matrix
headimg: 'https://cdn.sspai.com/2022/03/05/article/5dcf2555fc192f4b7f184601fc00c61d?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
author: 少数派 sspai
comments: false
date: Sat, 05 Mar 2022 15:34:34 GMT
thumbnail: 'https://cdn.sspai.com/2022/03/05/article/5dcf2555fc192f4b7f184601fc00c61d?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
---

<div>   
<div class="articleWidth-content" data-v-0b37afcb><div class="update-wrap" data-v-0b37afcb></div><div class="content wangEditor-txt minHeight" data-v-0b37afcb><p>起因是今天看到一条微博吐槽某品牌显示器通过 USB-C 连接，设置为 USB 3.0 后，4K 分辨率下只能达到 30Hz。于是我花了一点时间查了点资料，试图搞明白这其中的关系。</p><p>众所周知，USB-C 是一种支持正反插的连接器。但实际上，它内部的走线并不完全是对称的 —— 不然就太浪费了。具体来说，除了用于供电的 VBUS、公共地 GND 和 CC、SBU 等辅助性的接线、以及 USB 2.0 的 D+/D- 外，USB-C 里一共有 4 对独立的高速差分信号信号 (TX1+/TX1-, RX1+/RX1-, TX2+/TX2-, RX2+/RX2-，总共 8 根线)。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/03/05/article/5dcf2555fc192f4b7f184601fc00c61d?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/03/05/article/5dcf2555fc192f4b7f184601fc00c61d" referrerpolicy="no-referrer"><figcaption>USB Type-C 引脚定义图，来源：<a href="https://www.anandtech.com/show/8558/displayport-alternate-mode-for-usb-typec-announced" target="_blank">AnandTech</a></figcaption></figure><p>为什么这里要排除 USB 2.0 呢？因为 USB 2.0 是在一对差分信号 (D+/D-) 上以半双工方式工作的，与 USB 3.0 以及后续其它全双工协议的工作方式非常不同，因此职责单一，并没有特殊情况需要讨论。所以，对于 USB-C 上 USB 3.0 和 DisplayPort 共存的问题，本质上就是这 4 对高速差分信号的分配问题。下面我们就来展开说说。</p><h3>首先来说说 USB 3.X</h3><p>对于 USB 3.X 来说，因为要全双工地同时发送 (TX) 和接收 (RX)，因此对于这 4 对高速差分信号，要么用 2 对 (1 lane)，要么用完 4 对 (2 lane)。剩下的才是可以分配给 DP Alt Mode 使用的数据线。</p><p>列举来说：</p><ul><li>USB 3.2 Gen 1 带宽为 5 Gb/s，需要用到 1 对 TX 和 RX (共 4 根线)</li><li>USB 3.2 Gen 2 带宽为 10 Gb/s，采用了不一样的传输编码方式，同样也仅需 1 对 TX 和 RX (共 4 根线)</li><li>USB 3.2 Gen 1×2、2×2，带宽分别为 10 Gbps 和 20 Gb/s，需要用到 2 对 TX 和 RX，共 8 根线 (后者与前者同样也只是传输编码的区别)</li></ul><p>也就是说，USB-C 是通过「接线」的方式来同时传输 USB 和 DP 信号的。如果你需要高规格的 DP 传输，就得减少 USB 3.0 可用的 lane 数，反之亦然。</p><h3>再来说说 DisplayPort (DP)</h3><p>之所以我们可以通过一根 USB-C 线缆连接显示器输出视频的同时也能接通显示器的 USB 口，其实是利用了 USB-C 规范中一个称之为 Alt Mode 的做法，从前面所说的 4 对差分信号中借用 2 对乃至全部 4 对来传输 DP 信号。</p><p>而 DP 截止至 1.4 版本，总共有 RBR、HBR、HBR2、HBR3 四种传输模式。根据<a href="https://en.wikipedia.org/wiki/DisplayPort#Main_link" target="_blank">资料</a>，它们的带宽分别如下：</p><ul><li>RBR 和 HBR，自 DP 1.0 开始支持，单个 lane 的带宽分别为 1.62 Gb/s 和 2.70 Gb/s</li><li>HBR2，自 DP 1.2 开始支持，单个 lane 的带宽为 5.40 Gb/s</li><li>HBR3，自 DP 1.3 开始支持，单个 lane 的带宽为 8.10 Gb/s</li></ul><h3>那么回到开头的问题</h3><p>到底什么情况下一根 USB-C 线上才能同时拥有 USB 3.0 和 4K 60Hz 的 DP 输出呢？首先排除全部 4 对差分信号全部用作 USB 或者全部用作 DP 传输的分配方式。因此剩下一种情况。</p><p>首先，正如前面提到，USB 3.0 需要占用 2 对差分信号，分别用于发送 (TX) 和接收 (RX)。对于 USB 来说，就是一个 lane。也就是 USB 3.2 Gen 1 (5 Gb/s) 或者 USB 3.2 Gen 2 (10 Gb/s)。</p><p>剩下 2 对差分信号，由于 DP 只需要发送，因此对于 DP 来说，它就是两个 lane。也就是说，HBR2 和 HBR3 模式下分别可达到 10.80 Gb/s 和 16.20 Gb/s 的带宽。</p><p>同样根据<a href="https://en.wikipedia.org/wiki/DisplayPort#Resolution_and_refresh_frequency_limits" target="_blank">资料</a>，4K 分辨率下几种模式的数据速率需求：</p><figure class="table"><table><tbody><tr><td>规格</td><td>SDR (24 bit)</td><td>HDR (32 bit)</td></tr><tr><td>4K 30Hz</td><td>6.18 Gb/s</td><td>7.73 Gb/s</td></tr><tr><td>4K 60Hz</td><td>12.54 Gb/s</td><td>15.68 Gb/s</td></tr></tbody></table></figure><p>综上所述，如果需要在一根 USB-C 上同时实现 USB 3.0 和 4K 60Hz DP 的传输，那么，显示器和主机都需要支持 HBR3 才行。</p><h3>还有别的方案吗</h3><p>有，那就是 Thunderbolt (TB)。</p><p>和 USB 3.X 直接将数据线分配给不同协议的粗暴做法不同，Thunderbolt 是一个更高层次的协议。它将所有数据编码打包进自己的协议里传输，两端通过专用芯片进行编解码。总带宽 40 Gb/s。只要在这个带宽之下，里面的各家协议的带宽是按需分配使用的，不怕 USB 那种占了线没用满、没线可用的情况。</p><p>当然，控制芯片不便宜。所以 TB 协议的产品基本上会比 USB 贵几个档次。</p><h3>补充：关于 USB 3.X 的协议命名</h3><p>也是刚刚查资料的时候才知道。USB 3.X 每更新一个小版本，都会把前一小版本纳入进来，并且更名为当前版本的命名格式。</p><p>比如说，USB 3.2 Gen 1，也就是 USB 3.1 Gen 1，乃至 USB 3.0，都是同一个东西。</p><p>而 USB 3.2 Gen 2 和 USB 3.1 Gen 2，也是同一个东西。</p></div><div class="update-details-wrap" data-v-0b37afcb></div><!----></div><div style="border:1px solid transparent;" data-v-0b37afcb></div><div class="article-side sideTop" style="display:none;left:0;" data-v-7be936cf data-v-0b37afcb><div class="download-guide-container" data-v-14f9065e data-v-7be936cf><div class="btn-wrapper" data-v-14f9065e><!----><button class="btn btn-view" data-v-14f9065e><i class="iconfont iconfont-phone" data-v-14f9065e></i></button></div><a href="https://sspai.com/s/JYjP" target="_blank" data-v-14f9065e><!----></a></div><div class="item-wrapper" data-v-7be936cf><button class="btn btn-charge" data-v-7be936cf><i class="iconfont" data-v-7be936cf></i></button><span class="count" data-v-7be936cf>23</span></div><div class="item-wrapper" data-v-7be936cf><button class="btn-mini btn-comment" data-v-7be936cf><i class="iconfont iconfont-comment" data-v-7be936cf></i></button><span class="count" data-v-7be936cf>1</span></div><div class="item-wrapper" data-v-7be936cf><span data-v-7be936cf><div role="tooltip" id="el-popover-1718" aria-hidden="true" class="el-popover el-popper popper-share right ss-popper-dark-border" style="width:undefinedpx;display:none;"><!----><div class="article-side-share-btn"><a href="https://service.weibo.com/share/share.php?url=null?ref=weibo&title=%E3%80%90%E6%88%91%EF%BC%8C%E8%AF%95%E5%9B%BE%E5%BC%84%E6%98%8E%E7%99%BD%20USB-C%20%E9%87%8C%E5%90%84%E7%A7%8D%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%85%B3%E7%B3%BB%E3%80%91%E8%B5%B7%E5%9B%A0%E6%98%AF%E4%BB%8A%E5%A4%A9%E7%9C%8B%E5%88%B0%E4%B8%80%E6%9D%A1%E5%BE%AE%E5%8D%9A%E5%90%90%E6%A7%BD%E6%9F%90%E5%93%81%E7%89%8C%E6%98%BE%E7%A4%BA%E5%99%A8%E9%80%9A%E8%BF%87USB-C%E8%BF%9E%E6%8E%A5%EF%BC%8C%E8%AE%BE%E7%BD%AE%E4%B8%BAUSB3.0%E5%90%8E%EF%BC%8C4K%E5%88%86%E8%BE%A8%E7%8E%87%E4%B8%8B%E5%8F%AA%E8%83%BD%E8%BE%BE%E5%88%B030Hz%E3%80%82%E4%BA%8E%E6%98%AF%E6%88%91%E8%8A%B1%E4%BA%86%E4%B8%80%E7%82%B9%E6%97%B6%E9%97%B4%E6%9F%A5%E4%BA%86%E7%82%B9%E8%B5%84%E6%96%99%EF%BC%8C%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&pic=&appkey=3196502474#" target="_blank"><i class="iconfont iconfont-weibo-simple right-16"></i></a><span><div role="tooltip" id="el-popover-404" aria-hidden="true" class="el-popover el-popper" style="width:undefinedpx;display:none;"><!----><div style="text-align:center;"><div id="qr-code"></div><small class="qr-small">扫码分享</small></div></div><span class="el-popover__reference-wrapper"><i class="iconfont iconfont-wechat-simple right-16"></i></span></span><a href="https://twitter.com/share?text=%E3%80%90%E6%88%91%EF%BC%8C%E8%AF%95%E5%9B%BE%E5%BC%84%E6%98%8E%E7%99%BD%20USB-C%20%E9%87%8C%E5%90%84%E7%A7%8D%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%85%B3%E7%B3%BB%E3%80%91%E8%B5%B7%E5%9B%A0%E6%98%AF%E4%BB%8A%E5%A4%A9%E7%9C%8B%E5%88%B0%E4%B8%80%E6%9D%A1%E5%BE%AE%E5%8D%9A%E5%90%90%E6%A7%BD%E6%9F%90%E5%93%81%E7%89%8C%E6%98%BE%E7%A4%BA%E5%99%A8%E9%80%9A%E8%BF%87USB-C%E8%BF%9E%E6%8E%A5%EF%BC%8C%E8%AE%BE%E7%BD%AE%E4%B8%BAUSB3.0%E5%90%8E%EF%BC%8C4K%E5%88%86%E8%BE%A8%E7%8E%87%E4%B8%8B%E5%8F%AA%E8%83%BD%E8%BE%BE%E5%88%B030Hz%E3%80%82%E4%BA%8E%E6%98%AF%E6%88%91%E8%8A%B1%E4%BA%86%E4%B8%80%E7%82%B9%E6%97%B6%E9%97%B4%E6%9F%A5%E4%BA%86%E7%82%B9%E8%B5%84%E6%96%99%EF%BC%8C%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&url=null" target="_blank" class="twitter"><i class="iconfont iconfont-twitter-simple right-16"></i></a></div></div><span class="el-popover__reference-wrapper"><button class="btn-mini btn-share" data-v-7be936cf><i class="iconfont iconfont-share" data-v-7be936cf></i></button></span></span></div><div class="item-wrapper" data-v-7be936cf><button class="btn-mini btn-collect" data-v-7be936cf><i class="iconfont iconfont-collect" data-v-7be936cf></i></button></div><!----></div><!---->  
</div>
            