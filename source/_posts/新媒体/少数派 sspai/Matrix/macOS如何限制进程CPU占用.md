
---
title: 'macOS如何限制进程CPU占用'
categories: 
 - 新媒体
 - 少数派 sspai
 - Matrix
headimg: 'https://cdn.sspai.com/2021/06/19/27a4c9274d4763ad515acd0e4e79e4d2.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
author: 少数派 sspai
comments: false
date: Sat, 19 Jun 2021 16:03:58 GMT
thumbnail: 'https://cdn.sspai.com/2021/06/19/27a4c9274d4763ad515acd0e4e79e4d2.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
---

<div>   
<div class="articleWidth-content" data-v-e1f0100a><div class="content wangEditor-txt minHeight" data-v-e1f0100a><blockquote><p>很早之前大家就发现，macOS的活动监视器真的就只是一个监视器，并不能像Windows的任务管理器那样可由用户手动设置进程的优先级。但当我们真的有这样的需求时，该怎么办呢？</p></blockquote><p>我们知道，其实苹果的macOS是一个半开半闭源的操作系统，大致来讲，GUI部分是闭源的，这也是macOS的精髓；核心系统部分（<a href="https://github.com/apple/darwin-xnu">darwin-xnu</a>）是开源的。这使得用户或者说开发者依然有机会进行系统调用，以实现需求——限制某个进程的CPU资源占用。</p><p>也许你会好奇，什么人会有这种需求呢？当某些公司强制要求员工们安装“xx安全软件”并且时不时还在后台疯狂扫描文件吃CPU，还不准你关闭和卸载的时候，你就有这个需求了。</p><h3>方案一：cputhrottle</h3><p>这个小工具没有GUI，是个很轻便的命令行工具。从介绍便知：</p><blockquote><p>cputhrottle is a small OS X command-line utility designed to limit the CPU usage of a process to which it attaches.</p></blockquote><p>作者在其官方页面提供了源码下载和编译好的二进制执行文件。原本我以为这种OS X时代的软件已经不适用于现在版本的系统了，结果仍然可用，这估计得益于稳定的内核带来的良好兼容性（基本不会有哪个OS内核经常改系统调用的）。</p><p>在下载<a href="http://www.willnolan.com/cputhrottle/cputhrottle.gz">cputhrottle.gz</a>解压后，我们需要先给予执行权限：</p><pre class="language-bash"><code>chmod +x cputhrottle</code></pre><p>然后就可以直接使用了，第1个参数是进程的pid，第2个参数是最大CPU占用百分比，假设某安全软件进程id为2333，你只准它最多吃你1%的CPU：</p><pre class="language-bash"><code>sudo ./cputhrottle 2333 1

# 一般来说，你可以用ps命令来查看进程的pid
ps -ef
# 如果太多了不好找，可以筛选一下，前提是你要知道它可能的名字
ps -ef | grep "xx安全软件或者它的英文名"</code></pre><p>这样就能保证它又不被杀死，还不拖慢你的电脑，可谓“求死不得，求生不能”。为了使用方便，我们可以把执行文件放到 <code>/usr/local/bin</code> 目录下面，以后就可以在任意目录下直接执行了：</p><pre class="language-bash"><code>mv cputhrottle /usr/local/bin
# 以后可作为全局命令使用
sudo cputhrottle 2333 1</code></pre><p>然而，在执行命令后，由于程序内部是死循环逻辑，所以会占用当前终端。更优雅的做法当然是让它到后台去执行，不影响我们终端的继续使用：</p><pre class="language-bash"><code>sudo cputhrottle 2333 1
# 执行命令后按下control和Z，以挂起进程，终端会提示如下
# ^Z
# [1]  + 12345 suspended  sudo cputhrottle 2333 1

# 然后接着在终端输入bg，会提示进程继续执行，这样就到后台
bg
# [1]  + 12345 continued  sudo cputhrottle 2333</code></pre><p>如果觉得bg这种方式比较麻烦，也可直接用nohup命令：</p><pre class="language-bash"><code>sudo nohup cputhrottle 2333 1 &</code></pre><p>上述12345是举例，它是你执行cputhrottle命令的进程id，当你不再需要限制2333进程的CPU占用时，可以kill掉它：</p><pre class="language-bash"><code>sudo kill 12345</code></pre><h3>方案二：AppPolice</h3><p>上面的方案一比较原始，比较熟悉终端的同学可以试试，适合喜欢自己写命令脚本的配合使用。后面的方案都是带GUI的软件了，适合普通用户。</p><p>AppPolice和cputhrottle一样，也是开源的，2016年的老古董软件了，亲测也可用。在其GitHub仓库<a href="https://github.com/AppPolice/AppPolice/releases/tag/v1.1">下载dmg</a>后，安装就能用了。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/06/19/27a4c9274d4763ad515acd0e4e79e4d2.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/06/19/27a4c9274d4763ad515acd0e4e79e4d2.png" referrerpolicy="no-referrer"></figure><p>（图标还挺有趣的……红蓝应该是Police的配色）运行后可以直接控制每个应用进程的CPU占用，最大就是无限制，相比命令工具，的确还是很方便的。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/06/19/d4d0922786f67ebaee1880e460e31831.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/06/19/d4d0922786f67ebaee1880e460e31831.png" referrerpolicy="no-referrer"></figure><h3>方案三：App Tamer</h3><p>此软件不是开源的，并且是付费软件，亲测也可用，从UI和功能上面看起来比方案二更成熟一点。安装之后首次打开会提示安装必须的附属工具。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/06/19/7ff396879063f03b5517b892bbb1bce4.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/06/19/7ff396879063f03b5517b892bbb1bce4.png" referrerpolicy="no-referrer"></figure><p>首次使用还有引导页面，做了一些基本功能的介绍。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/06/19/3c7289b8a8038bef7d21d028473ecf88.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/06/19/3c7289b8a8038bef7d21d028473ecf88.png" referrerpolicy="no-referrer"></figure><p>其实使用起来和上述的AppPolice差不多，都是可以手动限制每一个进程的CPU最大占用。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/06/19/cd073760957706a6ac0394f672bf1f8f.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/06/19/cd073760957706a6ac0394f672bf1f8f.png" referrerpolicy="no-referrer"></figure><p>并且还提供了全局开关，在不用退出的情况下关闭限制，需要的时候再打开。各种功能也是要丰富得多，但基本上我这一张截图也就体现完了。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/06/19/abe32ad957d84e9155344520b038795a.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/06/19/abe32ad957d84e9155344520b038795a.png" referrerpolicy="no-referrer"></figure><p>总体来说要比前面两个方案完美很多。不过正版的价格也不菲呢，14.95刀。</p><h3>方案四：Turbo Boost Switcher</h3><p>这个软件严格意义上来说和上面三者不是一个意思，它主要是开关Intel处理器的Turbo Boost的（<code>Enable / Disable Turbo Boost feature on demand.</code>），后者即英特尔的睿频技术（简单理解为自动超频），关它说白了也是为了省电，让CPU处于低频状态。</p><p>所以不是用来限制进程CPU占用的，而是全局节能的。我觉得挺神奇的，就放到这里了，看来用户的需求真是千奇百怪呢。</p><h3>资源</h3><p><a href="http://www.willnolan.com/cputhrottle/cputhrottle.html">cputhrottle</a></p><p><a href="https://github.com/AppPolice/AppPolice">AppPolice</a></p><p><a href="https://www.stclairsoft.com/AppTamer/">App Tamer</a></p><p><a href="http://tbswitcher.rugarciap.com/">Turbo Boost Switcher</a></p><h3>探索</h3><p>由于cputhrottle的源码比较少，我就稍微看了看，发现核心逻辑还是不复杂的，会根据指定进程的CPU使用时间来采样，计算出需要控制的占比，最终通过系统调用（Mach内核task相关的接口，这个task在macOS的内核中相当于进程的概念）来挂起task，并休眠一定的时间，达到让出CPU资源的目的。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/06/19/67388dc4e7fc24b22503d0993b8e0999.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/06/19/67388dc4e7fc24b22503d0993b8e0999.png" referrerpolicy="no-referrer"></figure></div><!----></div><div style="border:1px solid transparent;" data-v-e1f0100a></div><div class="article-side sideTop" style="display:none;left:0;" data-v-7be936cf data-v-e1f0100a><div class="download-guide-container" data-v-14f9065e data-v-7be936cf><div class="btn-wrapper" data-v-14f9065e><!----><button class="btn btn-view" data-v-14f9065e><i class="iconfont iconfont-phone" data-v-14f9065e></i></button></div><a href="https://sspai.com/s/JYjP" target="_blank" data-v-14f9065e><!----></a></div><div class="item-wrapper" data-v-7be936cf><button class="btn btn-charge" data-v-7be936cf><i class="iconfont" data-v-7be936cf></i></button><span class="count" data-v-7be936cf>7</span></div><div class="item-wrapper" data-v-7be936cf><button class="btn-mini btn-comment" data-v-7be936cf><i class="iconfont iconfont-comment" data-v-7be936cf></i></button><span class="count" data-v-7be936cf>2</span></div><div class="item-wrapper" data-v-7be936cf><span data-v-7be936cf><div role="tooltip" id="el-popover-4124" aria-hidden="true" class="el-popover el-popper popper-share right ss-popper-dark-border" style="width:undefinedpx;display:none;"><!----><div class="article-side-share-btn"><a href="https://service.weibo.com/share/share.php?url=null?ref=weibo&title=%E3%80%90macOS%E5%A6%82%E4%BD%95%E9%99%90%E5%88%B6%E8%BF%9B%E7%A8%8BCPU%E5%8D%A0%E7%94%A8%E3%80%91%E5%BE%88%E6%97%A9%E4%B9%8B%E5%89%8D%E5%A4%A7%E5%AE%B6%E5%B0%B1%E5%8F%91%E7%8E%B0%EF%BC%8CmacOS%E7%9A%84%E6%B4%BB%E5%8A%A8%E7%9B%91%E8%A7%86%E5%99%A8%E7%9C%9F%E7%9A%84%E5%B0%B1%E5%8F%AA%E6%98%AF%E4%B8%80%E4%B8%AA%E7%9B%91%E8%A7%86%E5%99%A8%EF%BC%8C%E5%B9%B6%E4%B8%8D%E8%83%BD%E5%83%8FWindows%E7%9A%84%E4%BB%BB%E5%8A%A1%E7%AE%A1%E7%90%86%E5%99%A8%E9%82%A3%E6%A0%B7%E5%8F%AF%E7%94%B1%E7%94%A8%E6%88%B7%E6%89%8B%E5%8A%A8%E8%AE%BE%E7%BD%AE%E8%BF%9B%E7%A8%8B%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7%E3%80%82%E4%BD%86%E5%BD%93%E6%88%91%E4%BB%AC%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&pic=https%3A%2F%2Fcdn.sspai.com%2F2021%2F06%2F20%2F36c5dd2634f620f5ade1749dfef1682c.jpg%3FimageMogr2%2Fauto-orient%2Fquality%2F95%2Fthumbnail%2F!1420x708r%2Fgravity%2FCenter%2Fcrop%2F1420x708%2Finterlace%2F1&appkey=3196502474#" target="_blank"><i class="icon icon-article_weibo right-16"></i></a><span><div role="tooltip" id="el-popover-1084" aria-hidden="true" class="el-popover el-popper" style="width:undefinedpx;display:none;"><!----><div style="text-align:center;"><div id="qr-code"></div><small class="qr-small">扫码分享</small></div></div><i class="icon icon-article_weixin right-16"></i></span><a href="https://twitter.com/share?text=%E3%80%90macOS%E5%A6%82%E4%BD%95%E9%99%90%E5%88%B6%E8%BF%9B%E7%A8%8BCPU%E5%8D%A0%E7%94%A8%E3%80%91%E5%BE%88%E6%97%A9%E4%B9%8B%E5%89%8D%E5%A4%A7%E5%AE%B6%E5%B0%B1%E5%8F%91%E7%8E%B0%EF%BC%8CmacOS%E7%9A%84%E6%B4%BB%E5%8A%A8%E7%9B%91%E8%A7%86%E5%99%A8%E7%9C%9F%E7%9A%84%E5%B0%B1%E5%8F%AA%E6%98%AF%E4%B8%80%E4%B8%AA%E7%9B%91%E8%A7%86%E5%99%A8%EF%BC%8C%E5%B9%B6%E4%B8%8D%E8%83%BD%E5%83%8FWindows%E7%9A%84%E4%BB%BB%E5%8A%A1%E7%AE%A1%E7%90%86%E5%99%A8%E9%82%A3%E6%A0%B7%E5%8F%AF%E7%94%B1%E7%94%A8%E6%88%B7%E6%89%8B%E5%8A%A8%E8%AE%BE%E7%BD%AE%E8%BF%9B%E7%A8%8B%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7%E3%80%82%E4%BD%86%E5%BD%93%E6%88%91%E4%BB%AC%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&url=null" target="_blank" class="twitter"><i class="icon icon-article_twitter right-16"></i></a></div></div><button class="btn-mini btn-share" data-v-7be936cf><i class="iconfont iconfont-share" data-v-7be936cf></i></button></span></div><div class="item-wrapper" data-v-7be936cf><button class="btn-mini btn-collect" data-v-7be936cf><i class="iconfont iconfont-collect" data-v-7be936cf></i></button></div><!----></div><!---->  
</div>
            