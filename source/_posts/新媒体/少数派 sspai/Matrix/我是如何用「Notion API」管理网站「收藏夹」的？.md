
---
title: '我是如何用「Notion API」管理网站「收藏夹」的？'
categories: 
 - 新媒体
 - 少数派 sspai
 - Matrix
headimg: 'https://cdn.sspai.com/2022/03/18/a385cb183483695ee06ad9455887e0af.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
author: 少数派 sspai
comments: false
date: Wed, 16 Mar 2022 08:55:14 GMT
thumbnail: 'https://cdn.sspai.com/2022/03/18/a385cb183483695ee06ad9455887e0af.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
---

<div>   
<div class="articleWidth-content" data-v-0b37afcb><div class="update-wrap" data-v-0b37afcb></div><div class="content wangEditor-txt minHeight" data-v-0b37afcb><h2 style="margin-left:0px;">前言</h2><p>大家好，我是Graham。</p><p>这是我在少数派发表的第一篇文章。甚至，这是我在所有平台发表的第一篇文章。作为一名长期潜水员，一直都在学习大家是如何利用各种工具提升效率的。依稀记得当初申请成为「Matrix」创作者的时候，是想分享一些「LaunchBar」的小技巧，后来因为那段时间忙着学习就不了了之了。</p><p>Anyway，今天想跟大家分享的是我如何使用 <strong>「Notion API」</strong> 来管理我在各个网站收藏夹的小方法。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/03/18/a385cb183483695ee06ad9455887e0af.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/03/18/a385cb183483695ee06ad9455887e0af.png" referrerpolicy="no-referrer"><figcaption>最终的效果</figcaption></figure><hr><h3>关于Notion API</h3><p>在几个月前，我浏览少数派才知道了 Notion 开放了自己的 API，方便用户通过编程的方式丰富自己的 Notion。关于 Notion API 的介绍和使用方式，这里推荐少数派上的两篇文章：<a href="https://sspai.com/post/68140">当 Python + Notion API，你就可以用「Notion 助手」轻松调试自己的小机器人</a> 和 <a href="https://sspai.com/post/66658">以全新的 Notion API，尝试全新的记账方式</a> 。我正是从这两篇文章中学到了如何操作 Notion API。</p><p>但是这两篇文章提到的关于 Notion API 的应用，一个是关于吃药，一个是关于记账，都不符合我使用 Notion 的习惯。这些生活琐事我还是倾向于使用一些提醒事项软件（Due，2Do，Things等等），所以一直都没有怎么重视 Notion API 的应用。直到前不久，我突然发现一个困扰我很久的痛点可以很方便的通过 Notion API 来解决。这个痛点就是「收藏夹管理」</p><h3>收藏夹管理</h3><p>作为一名仓鼠星人，浏览少数派、知乎等软件时，看到一篇喜欢的文章就毫不犹豫地加入收藏夹。久而久之，日渐臃肿的收藏夹整理起来就特别费劲。</p><p>而且，几乎所有的软件收藏夹都没有提供「标签」功能。知乎可以选择收藏到一个自己创建的收藏夹，而少数派、什么值得买、小红书等网站甚至只能收藏到默认收藏夹。B站可能是最能满足我所说的标签功能的软件了，收藏视频的时候可以选择收藏到多个自己创建的收藏夹。那么有没有一种方法能给少数派等网站加上「标签」功能呢？（这里期待少数派官方能够上线这个功能哟～</p><p>有些人可能会将一些喜欢的文章集中发送到一个信息处理中心然后添加标签，例如 Flomo。但是我还是喜欢在各个软件里一秒点击收藏的快感，而不是每次看到喜欢的文章，还需要点击分享，等半天加载，然后发送到 Flomo 中（<s>当然不是因为我没钱买 Flomo Pro</s>）。</p><p>话不多说，现在就介绍一下我具体的工作流程。接下来的内容可能会有点硬核，如果想要完全看懂，需要掌握以下一些相关知识：<code>爬虫</code>，<code>Mongo数据库</code> 以及<code>Notion API </code>。</p><p><strong>整体思路是：</strong>通过爬虫获取自己的收藏夹内容并保存到数据库中，然后将这些内容通过 Noiton API 发送到自己的 Notion 中，然后在 Notion 中手动添加标签，以此来达到我们的目的。</p><hr><h2>获取收藏夹内容</h2><p>我们遇到的第一个挑战，就是<strong>如何获取自己的收藏夹内容？</strong></p><p>由于之前我有写过一些小爬虫，所以自然而然就想到了利用爬虫来获取收藏夹的方式。由于各个网站的爬虫方式各不相同，以下的爬虫我们就以「什么值得买」为例。</p><h3>抓包</h3><p>我使用的手机是 iPhone XR，使用「Thor」这个软件进行抓包后（具体怎么抓包建议自行搜索，不方便展开细说），我们可以发现 什么值得买 的获取收藏夹链接为 </p><figure class="image ss-img-wrapper image_resized" style="width:229px;"><img src="https://cdn.sspai.com/2022/03/16/b281e85fd0fa1d5e042fc3cb0d9382a8.jpeg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/03/16/b281e85fd0fa1d5e042fc3cb0d9382a8.jpeg" referrerpolicy="no-referrer"></figure><p>其中 <strong>cookies</strong> 是网站用来鉴别你是否为用户的关键。通过「Thor」，我们可以将这个访问链接的过程复制为 <strong>curl</strong> 命令，这个命令包含了你要访问的网站以及传输的数据。接下来我们可以访问 <a href="https://curl.trillworks.com/">这个网站</a> 将刚刚复制的 <strong>curl </strong>命令转换成 <strong>python </strong>代码。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/03/16/2808f7f25bb0501b94662df46ad6768f.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/03/16/2808f7f25bb0501b94662df46ad6768f.png" referrerpolicy="no-referrer"></figure><p>到这里有过爬虫经验的小伙伴应该就能很轻易地写出完整的程序了。访问这个什么值得买的 api 我们可以获取到你收藏的所有文章标题、链接、图片等信息。具体的代码如果大家有需要我可以在评论区发布出来，这里就不方便展开了。</p><h3>保存到数据库</h3><p>其实获取到收藏夹信息之后我们就可以直接通过 Notion API 发送给 Notion 了。这里我多此一举保存到数据库其实只是为了方便日后的迁移工作，毕竟谁也不能保证 Notion 的在线服务会一直很「保险」。如果你觉得你并不需要保存到数据库中，那么这一节的内容完全可以略过。</p><p>我选用的数据库是「Mongo」。之所以没有采用常用的「MySQL」是因为「Mongo」是一种非关系型数据库，里面的数据是以 json 的形式存储的，对每一个字段的类型并没有严格的限制，很方便作为爬虫的数据库（因为爬虫经常会遇到一些莫名其妙的数据）。</p><p>这里我推荐通过 Docker 来创建 Mongo 服务。Docker 的容器技术可以快速地部署各种服务，而不用去担心各种环境的配置。而且部署 Mongo 服务也特别简单，只需要一行命令即可：<code>docker run -itd --name mongo -p 27017:27017 mongo --auth</code>。具体的操作可以参考<a href="https://www.runoob.com/docker/docker-install-mongodb.html">这个教程</a>。</p><p>部署好 Mongo 服务后，我们创建一个 <code>favorites</code> 数据库，然后创建一个 <code>smzdm</code> 集合（类似于MySQL的表）作为我们存储什么值得买收藏夹的目的地。</p><p>接下来就是在代码中进行修改，将从 api 获取到的数据保存到 Mongo 中。具体存储哪些字段可以自己控制，不过我个人建议只需要存储文章标题、链接、图片等基础信息就好，我们存到 Notion 中的只是一个书签，具体查看文章最好还是通过文章链接来访问。毕竟 Notion 并不能很好地渲染 html 的所有内容。而保存图片则是为了方便在 Notion 的 Board 视图里查找文章。</p><figure class="image ss-img-wrapper image_resized" style="width:664px;"><img src="https://cdn.sspai.com/2022/03/16/c397a440b9bc5ef02dddc3f00cf8669b.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/03/16/c397a440b9bc5ef02dddc3f00cf8669b.png" referrerpolicy="no-referrer"><figcaption>Mongo 中的数据</figcaption></figure><h2>保存到 Notion</h2><p>终于讲到了 Notion API ！现在我们的数据库里已经有了所有的收藏夹信息，那么如何发送到 Noion 呢</p><h3>准备工作</h3><p>首先我们要在 Notion 中创建一个 Database 用于保存收藏夹内容，具体的字段根据数据库中的内容动态调整。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/03/16/513f5ee7cd8fad7eb8796b1d5139befc.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/03/16/513f5ee7cd8fad7eb8796b1d5139befc.png" referrerpolicy="no-referrer"></figure><p>然后点击右上角的 <strong>Share - copy link</strong> ，复制出来的链接是一串形如<code>https://www.notion.so/ab****cd?v=12****34</code>的链接，其中的<code>ab****cd</code>就是这个 database 的 id 。</p><p>除此之外，我们还需要一个机器人。创建 Notion 机器人的方法强烈建议参考<a href="https://sspai.com/post/66658"> 以全新的 Notion API，尝试全新的记账方式</a> 一文，讲述的非常详细，我就不重复造轮子了（<s>不是因为懒</s>）。</p><p>创建完机器人之后，别忘了将它 invite 到刚刚创建的 database 中，只有这样这个机器人才可以帮助你实现各种指令。</p><h3>调用 Notion API</h3><p>从 Mongo 数据库中读取数据之后，我们通过 POST 方式向 Notion 发送我们的数据。</p><pre class="language-python"><code>data = &#123;
    "parent": &#123;
        "database_id": "ab****cd"
    &#125;,
    'properties': &#123;
        "Name": &#123;"title": [&#123;"type": "text", "text": &#123;"content": smzdm['article_title']&#125;&#125;]&#125;,
        "URL": &#123;"url": smzdm['article_url']&#125;,
        "img": &#123;"files": [
            &#123;
                "external": &#123;
                    "url": smzdm['article_img']
                &#125;,
                "name": smzdm['article_id'],
                "type": "external"
            &#125;
        ]&#125;,
        "收藏时间": &#123;"date": &#123;"start": smzdm['fav_time']&#125;&#125;,
        "评论数": &#123;"number": int(smzdm['article_comment'])&#125;,
        "收藏数": &#123;"number": int(smzdm['article_collection'])&#125;,
        "article id": &#123;"number": int(smzdm['article_id'])&#125;,
    &#125;
&#125;

response = requests.request("POST", "https://api.notion.com/v1/pages", json=data, headers=headers)</code></pre><p>将所有的数据组装成这个格式。其中<code>parent</code>里的<code>database_id</code>就是在前文中提到的<code>ab****cd</code>，这代表了要向哪个 <code>databse </code>插入数据。而 <code>properties</code> 中则是各个字段，每个字段需要与 Notion 中对应的字段属性相匹配。例如我设置的 <code>URL </code>字段是url属性，那么在这里我们就需要在外面套上一个<code>url</code>的大括号。</p><p>值得一提的是，<code>img</code>字段我设置成了 <code>Files & Medias</code> 格式，这种格式既支持自己上传的图片，也支持图床链接。恰好 什么值得买 返回的图片链接可以用在这里。由于是图床链接，所以需要像上面的 <code>data</code> 一样组装格式，否则可能无法正确上传照片。</p><p>组装完数据后运行代码，我们就可以将数据库中的所有内容发送到 Notion 中啦，最终的效果如下图所示</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/03/16/12840873b5753f2fcb547ef7c5b1529e.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/03/16/12840873b5753f2fcb547ef7c5b1529e.png" referrerpolicy="no-referrer"></figure><p>其中<code>tag</code>字段是我添加的，我们可以很方便的使用 Notion 来给我们收藏夹里的文章打标签啦，大功告成！你可以添加一个<code>status</code>字段来标识这篇文章你是否已经看完，有什么感想也可以写在 Notion 对应的页面中。</p><p>不止如此，我们还可以添加一个 <code>board</code> 视图来更直观的看到每篇文章以及它们对应的标签。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/03/16/4b523ddcf95663e61dee9ceefc553892.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/03/16/4b523ddcf95663e61dee9ceefc553892.png" referrerpolicy="no-referrer"></figure><h3>定时任务 & 拓展</h3><p>我们肯定不希望每次同步到 Notion 都需要手动执行代码，一个定时任务是最好的选择。</p><p>我使用的是 Mac ，Unix 的设计可以方便地使用 <code>crontab</code>来创建定时服务。如果你使用的是 Windows， 那么<code>计划任务</code>也可以满足我们的需求。</p><p>通过向<code>crontab</code>中添加一条运行<code>python</code>的命令，我们就可以将收藏夹定时更新到 Notion 啦。<code>crontab</code>的具体用法也请自行查阅哦～</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/03/16/0ce4dc5fed4d6ac7fd01402db536e28e.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/03/16/0ce4dc5fed4d6ac7fd01402db536e28e.png" referrerpolicy="no-referrer"><figcaption>crontab 设置</figcaption></figure><p>目前我将什么值得买、小红书、少数派三个网站的收藏夹都搬运到了我的 Notion。通过在 Notion 里给它们打标签能让我快速找到我想要的信息。</p><p>你还可以使用<code><strong>钉钉机器人</strong></code>服务，每次有数据插入 Notion 的时候都会钉钉提醒你有新的文章被加入 Notion，方便提醒你给新文章打标签。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/03/16/d9e391a2bae9ab86ceb48ac6ed53e4ac.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/03/16/d9e391a2bae9ab86ceb48ac6ed53e4ac.png" referrerpolicy="no-referrer"><figcaption>钉钉机器人通知（忽略机器人头像）</figcaption></figure><h2>总结</h2><p>这篇文章向大家介绍了 Notion API 的一种应用——管理你的收藏夹。通过这种方式，极大方便了我管理各个网站的收藏夹。如果大家有更好的应用场景，欢迎在评论区提出意见，谢谢大家观看啦～</p></div><div class="update-details-wrap" data-v-0b37afcb></div><!----></div><div style="border:1px solid transparent;" data-v-0b37afcb></div><div class="article-side sideTop" style="display:none;left:0;" data-v-7be936cf data-v-0b37afcb><div class="download-guide-container" data-v-14f9065e data-v-7be936cf><div class="btn-wrapper" data-v-14f9065e><!----><button class="btn btn-view" data-v-14f9065e><i class="iconfont iconfont-phone" data-v-14f9065e></i></button></div><a href="https://sspai.com/s/JYjP" target="_blank" data-v-14f9065e><!----></a></div><div class="item-wrapper" data-v-7be936cf><button class="btn btn-charge" data-v-7be936cf><i class="iconfont" data-v-7be936cf></i></button><span class="count" data-v-7be936cf>14</span></div><div class="item-wrapper" data-v-7be936cf><button class="btn-mini btn-comment" data-v-7be936cf><i class="iconfont iconfont-comment" data-v-7be936cf></i></button><span class="count" data-v-7be936cf>7</span></div><div class="item-wrapper" data-v-7be936cf><span data-v-7be936cf><div role="tooltip" id="el-popover-8127" aria-hidden="true" class="el-popover el-popper popper-share right ss-popper-dark-border" style="width:undefinedpx;display:none;"><!----><div class="article-side-share-btn"><a href="https://service.weibo.com/share/share.php?url=null?ref=weibo&title=%E3%80%90%E6%88%91%E6%98%AF%E5%A6%82%E4%BD%95%E7%94%A8%E3%80%8CNotion%20API%E3%80%8D%E7%AE%A1%E7%90%86%E7%BD%91%E7%AB%99%E3%80%8C%E6%94%B6%E8%97%8F%E5%A4%B9%E3%80%8D%E7%9A%84%EF%BC%9F%E3%80%91%E5%89%8D%E8%A8%80%E5%A4%A7%E5%AE%B6%E5%A5%BD%EF%BC%8C%E6%88%91%E6%98%AFGraham%E3%80%82%E8%BF%99%E6%98%AF%E6%88%91%E5%9C%A8%E5%B0%91%E6%95%B0%E6%B4%BE%E5%8F%91%E8%A1%A8%E7%9A%84%E7%AC%AC%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E3%80%82%E7%94%9A%E8%87%B3%EF%BC%8C%E8%BF%99%E6%98%AF%E6%88%91%E5%9C%A8%E6%89%80%E6%9C%89%E5%B9%B3%E5%8F%B0%E5%8F%91%E8%A1%A8%E7%9A%84%E7%AC%AC%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E3%80%82%E4%BD%9C%E4%B8%BA%E4%B8%80%E5%90%8D%E9%95%BF%E6%9C%9F%E6%BD%9C%E6%B0%B4%E5%91%98%EF%BC%8C%E4%B8%80%E7%9B%B4%E9%83%BD%E5%9C%A8%E5%AD%A6%E4%B9%A0%E5%A4%A7%E5%AE%B6%E6%98%AF%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&pic=https%3A%2F%2Fcdn.sspai.com%2F2022%2F03%2F17%2Fd79f8dbc1e0f30fcae09456f28c1a383.png%3FimageMogr2%2Fauto-orient%2Fquality%2F95%2Fthumbnail%2F!1420x708r%2Fgravity%2FCenter%2Fcrop%2F1420x708%2Finterlace%2F1&appkey=3196502474#" target="_blank"><i class="iconfont iconfont-weibo-simple right-16"></i></a><span><div role="tooltip" id="el-popover-2724" aria-hidden="true" class="el-popover el-popper" style="width:undefinedpx;display:none;"><!----><div style="text-align:center;"><div id="qr-code"></div><small class="qr-small">扫码分享</small></div></div><span class="el-popover__reference-wrapper"><i class="iconfont iconfont-wechat-simple right-16"></i></span></span><a href="https://twitter.com/share?text=%E3%80%90%E6%88%91%E6%98%AF%E5%A6%82%E4%BD%95%E7%94%A8%E3%80%8CNotion%20API%E3%80%8D%E7%AE%A1%E7%90%86%E7%BD%91%E7%AB%99%E3%80%8C%E6%94%B6%E8%97%8F%E5%A4%B9%E3%80%8D%E7%9A%84%EF%BC%9F%E3%80%91%E5%89%8D%E8%A8%80%E5%A4%A7%E5%AE%B6%E5%A5%BD%EF%BC%8C%E6%88%91%E6%98%AFGraham%E3%80%82%E8%BF%99%E6%98%AF%E6%88%91%E5%9C%A8%E5%B0%91%E6%95%B0%E6%B4%BE%E5%8F%91%E8%A1%A8%E7%9A%84%E7%AC%AC%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E3%80%82%E7%94%9A%E8%87%B3%EF%BC%8C%E8%BF%99%E6%98%AF%E6%88%91%E5%9C%A8%E6%89%80%E6%9C%89%E5%B9%B3%E5%8F%B0%E5%8F%91%E8%A1%A8%E7%9A%84%E7%AC%AC%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E3%80%82%E4%BD%9C%E4%B8%BA%E4%B8%80%E5%90%8D%E9%95%BF%E6%9C%9F%E6%BD%9C%E6%B0%B4%E5%91%98%EF%BC%8C%E4%B8%80%E7%9B%B4%E9%83%BD%E5%9C%A8%E5%AD%A6%E4%B9%A0%E5%A4%A7%E5%AE%B6%E6%98%AF%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&url=null" target="_blank" class="twitter"><i class="iconfont iconfont-twitter-simple right-16"></i></a></div></div><span class="el-popover__reference-wrapper"><button class="btn-mini btn-share" data-v-7be936cf><i class="iconfont iconfont-share" data-v-7be936cf></i></button></span></span></div><div class="item-wrapper" data-v-7be936cf><button class="btn-mini btn-collect" data-v-7be936cf><i class="iconfont iconfont-collect" data-v-7be936cf></i></button></div><!----></div><!---->  
</div>
            