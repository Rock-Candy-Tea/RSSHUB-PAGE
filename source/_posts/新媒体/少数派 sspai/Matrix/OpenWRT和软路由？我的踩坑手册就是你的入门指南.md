
---
title: 'OpenWRT和软路由？我的踩坑手册就是你的入门指南'
categories: 
 - 新媒体
 - 少数派 sspai
 - Matrix
headimg: 'https://cdn.sspai.com/2022/09/07/article/66d9350b6fe04dc880f99b5502330eb5?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
author: 少数派 sspai
comments: false
date: Wed, 07 Sep 2022 14:22:46 GMT
thumbnail: 'https://cdn.sspai.com/2022/09/07/article/66d9350b6fe04dc880f99b5502330eb5?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
---

<div>   
<div class="articleWidth-content" data-v-557a067a><div class="update-wrap" data-v-557a067a></div><div class="content wangEditor-txt minHeight" data-v-557a067a><p style="margin-left:0px;">大部分的官方路由固件是功能、驱动固化后编译出来的，那自然缺点也很明显，很多第三方插件能提供的内容就不能用；饿，个人如果想要通过路由器实现更多功能和玩法，就只能借助于类似OpenWRT、Padavan这些第三方开源固件了。OpenWRT的框架化设计和包管理模式使用户有了完全的定制能力，国内很多软路由固件也都是基于OpenWRT深度开发的。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/66d9350b6fe04dc880f99b5502330eb5?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/66d9350b6fe04dc880f99b5502330eb5" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">为了解决内网设备的各种需求，就需要这些插件来支持了。我们有两种方法：第一个是主路由更换为软路由或者支持开源固件的硬路由；另一个就是添加一台支持开源固件的路由器，将其作为旁路路由使用。不过现在是千兆接入，一个支持2.5G及以上WAN口的旗舰硬路由，价格完全够搞台软路由的价格了，所以添置旁路路由是更合算过渡方案。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/7b4bade459b5ca654d59d39a4018166a?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/7b4bade459b5ca654d59d39a4018166a" referrerpolicy="no-referrer"></figure><h2 style="margin-left:0px;"><strong>1.第一次升级：两台硬路由的旁路由化尝试</strong></h2><p style="margin-left:0px;">这次选择了GL.inet的两台支持OpenWRT的小路由：MT1300和SFT1200。SFT1200算是MT1300的SoC国产化后的一个低配版，二者使用了同样的模具设计，仅有颜色不同。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/e89558a32b3f74b210182b36ceca3aaf?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/e89558a32b3f74b210182b36ceca3aaf" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">所以二者的一致性还是很高的，同样都是一个千兆WAN口、两个千兆LAN口，有一个USB-A接口，同样都通过USB-C接口供电。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/95abeddfa37fe67f1b134ae0a288812b?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/95abeddfa37fe67f1b134ae0a288812b" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">不过SFT1200精简掉了网口的指示灯，并且USB-A的规格也降到了2.0，供电接口同样是使用的USB-C。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/215b9f02bdb1566b82ebc6db8d8690c5?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/215b9f02bdb1566b82ebc6db8d8690c5" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">另外就是SFT1200取消了TF卡槽，只能够通过USB接口进行存储扩展。MT1300的插槽标注支持128G，实测200G的卡的还是可以正确识别的。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/af1876a83726f6d7c40283884b7584e4?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/af1876a83726f6d7c40283884b7584e4" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">另一侧的模式选择与Reset按键，没有进行改动，二者这侧没有区别。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/37a16e8f3ba3e1fba773c5bb264b96dc?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/37a16e8f3ba3e1fba773c5bb264b96dc" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">在外观以外，MT1300的处理器是联发科MT7261A，32+256MB配置；SFT1200的处理器是矽昌SF19A2890，双128配置。不过二者差价在百元左右，这些差异倒也可以接受。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/97d625955e491a0f05542dcb0d3730b8?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/97d625955e491a0f05542dcb0d3730b8" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">上电待路由器完全启动后，我们就可以连接对应的Wi-Fi了。MT1300的SSID是GL-MT1300f57（-5G），SFT1200的SSID是GL-SFT1200-057（-5G）,默认密码则是goodlife。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/08c69a066169263dba25c1219dd1ec23?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/08c69a066169263dba25c1219dd1ec23" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">性能测试基于原版固件，首先来看无线测试。MT1300的无线传输速度基本都在300Mbps以上，而且可以看到2.4GHz与5GHz频段的信号强度都没什么问题。如果家里是300Mbps及以下的网络接入的小户型和租房，这台MT1300足够当作主路由使用。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/c163d05f3f6574bbd001ab0fb51bf7d0?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/c163d05f3f6574bbd001ab0fb51bf7d0" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">到了SFT1200，无线传输速度一度达到了500Mbps以上，而且可以看到2.4GHz与5GHz频段的信号强度都没什么问题。还是同样的结论，如果家里是300Mbps及以下的网络接入的小户型和租房，这台SFT1200足够当作主路由使用。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/28fa47037471bd600d55e4a7c86fea7e?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/28fa47037471bd600d55e4a7c86fea7e" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">MT1300的U盘读取速度在15-20MB/s范围内，整体下来还是很稳定的。对于将视频存储在挂载设备上观看而言是够了，不过还是没有达到USB3.0应有的传输速度。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/a57e0cf0784190a66baa7d1aca03e9fe?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/a57e0cf0784190a66baa7d1aca03e9fe" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">SFT1200的U盘读取则是只有10MB/s左右，应该是接口降级的限制，这个速度只能说堪用。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/22223df211f713df782db550390b4625?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/22223df211f713df782db550390b4625" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">MT1300还有TF槽，官方标注最高支持128G的TF卡，实测闪迪Ultra那张200G的卡能够正确识别读写的。实测读写速度也是在10MB/s左右。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/3a7ca61ee08805bea0b6df2e8e7e96d9?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/3a7ca61ee08805bea0b6df2e8e7e96d9" referrerpolicy="no-referrer"></figure><h3 style="margin-left:0px;"><strong>1.1.对OpenWRT固件的配置</strong></h3><p style="margin-left:0px;">Gl-inet的固件是在OpenWRT的基础上开发的，如果你需要自行调整更多的设置，就需要先安装Luci界面，点击「更多设置」-「高级功能」后点击「安装Luci」即可。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/3a0b970a17d7a5c51dc30684136b15f4?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/3a0b970a17d7a5c51dc30684136b15f4" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">待安装完成后点击对应链接即可进入Web管理界面Luci，登录密码就是初始化时设置的密码。只是界面不同，底层逻辑与设置是完全一致的。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/1f1841262319c8377c01b1a6c1aa1a3f?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/1f1841262319c8377c01b1a6c1aa1a3f" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">笔者使用中将这台路由器设置为旁路由，这样一个是为了不改变原有拓扑，如果配置或使用过程中出了问题也不会影响原有网络的使用；第二个是并不是所有设备都需要经过这台旁路由，有需求的设备单独配置即可。以下的操作都需要将OpenWRT设备的IP固定，避免因为IP地址变动影响实际配置。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/55fbf24ec548a6ad1c39448b015589df?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/55fbf24ec548a6ad1c39448b015589df" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">笔者加的路由覆盖是由三台MX4200完成的，但是领势的固件中不能够单独修改网关。不过这样的需求并不需要进行网关互映和修改防火墙，只需要把需求设备的网关设置为这台OpenWRT的IP即可。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/7642b309b77bbf16730d038cfa7542af?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/7642b309b77bbf16730d038cfa7542af" referrerpolicy="no-referrer"></figure><h3 style="margin-left:0px;"><strong>1.2.插件安装方式与推荐设置</strong></h3><p style="margin-left:0px;">OpenWRT的优势就在于其有极为丰富的可供选择插件，只有你想不到而没有它做不到的功能。当然配置的过程随着设备的不同都会有差异，而且配置过程中会出现很多的问题。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/fa406b4e232e74aa2f6d5b1233f000ac?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/fa406b4e232e74aa2f6d5b1233f000ac" referrerpolicy="no-referrer"></figure><h4 style="margin-left:0px;"><strong>软件中心安装</strong></h4><p style="margin-left:0px;">那么话不多说，我们第一个推荐的自然是AdGuardHome，其作为一款全网广告拦截与反跟踪软件，可以说是十足的简单粗暴了：局域网直接部署，所有客户端全部生效，不占用本地设备资源；兼容其他代理服务；这里我们选择第一种方法安装插件，即在进入软件管理更新后直接搜索对应包名，点击安装即可。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/453ad8beafea5f27248ff80f8c347d21?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/453ad8beafea5f27248ff80f8c347d21" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">AdGuardHome的默认端口是3000，所以应该是输入192.168.8.1:3000进入管理界面，但这样尝试的结果是直接拒绝访问。其实这是因为现在并没有开启AdGuardHome的服务，需要开启对应的服务。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/92b0ecda94647db656c421ff472a4c82?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/92b0ecda94647db656c421ff472a4c82" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">OpendWRT上插件Web端管理，需要安装对应的软件包用户界面，一般对应的管理包名为luci-app-软件包名。但事情就有例外不是，需要与AdGuardHome一并安装的是gl-agh-stats，直接在软件中心搜索安装即可。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/602ccb043237fb7fdb5a88b79c3cd39c?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/602ccb043237fb7fdb5a88b79c3cd39c" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">安装gl-agh-stat后，我们就能够在官方界面的「应用程序」中找到并开启AdGuardHome服务，并对相关的设置进行改动了。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/72289c33460c7ad3abf6e5c4e6c9dcc3?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/72289c33460c7ad3abf6e5c4e6c9dcc3" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">AdGuardHome只能够屏蔽网页广告，视频广告是无法屏蔽掉的。所以笔者只选择了Easylist China+Easylist与AdAway两条订阅。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/464bac488bdc439913a4743f14a5d858?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/464bac488bdc439913a4743f14a5d858" referrerpolicy="no-referrer"></figure><h4 style="margin-left:0px;"><strong>OPKG在线安装</strong></h4><p style="margin-left:0px;">另外一个重要的功能则是网络打印服务，可以将不支持网络打印的普通打印机改造为网络打印机。使局域网内的设备都能够直接选择其打印，而不是原来的抱着电脑过去或者用U盘来回倒腾需要打印的文件，从而提高打印机的利用率。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/6b4216058a361e644d4b8b37b2f4eeb9?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/6b4216058a361e644d4b8b37b2f4eeb9" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">当然，你要先确认好打印机的接口，不管何种接口现在都要通过USB线缆连接到路由器上，但Type-B接口需要安装的是kmod-usb-printer，而LPT并口需要安装的是kmod-lp，这两个插件是不同的。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/c95aeaa4c58353d8ccd50bf2737825ca?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/c95aeaa4c58353d8ccd50bf2737825ca" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">确认好接口之后，我们使用第二种方法来安装插件，不需要借助任何软件。如果你是Windows端请打开CMD，如果你是mac OS或Linux请打开Terminal。输入</p><blockquote><p>ssh root@192.168.2.146</p></blockquote><p style="margin-left:0px;">后回车，再输入之前设置的密码就能登录了。注意网络位置需要改为你路由器的对应IP，而且输入密码时没有具体提示需要完全盲操。成功登录后就能看到如图的字符串，就能开始我们的下一步操作了。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/a79da80cbbf0576ed1f3fbdb5b68f605?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/a79da80cbbf0576ed1f3fbdb5b68f605" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">如果你的打印机是USB Type-B接口，依次输入以下内容</p><blockquote><p>opkg update<br>opkg install kmod-usb-printer</p></blockquote><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/5f362a21639a580320fcf95b608725d7?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/5f362a21639a580320fcf95b608725d7" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">如果你的打印机是LPT并口，依次输入以下内容</p><blockquote><p>opkg update<br>opkg install kmod-lp</p></blockquote><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/fbf4ce42fda5f901ecdcd432385261e0?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/fbf4ce42fda5f901ecdcd432385261e0" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">安装完后就能开始路由器端的设置了，但是拉到「Service」也没有对应的设置。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/5958a3b09c84957c016b3a908311a6f7?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/5958a3b09c84957c016b3a908311a6f7" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">这是因为我们没有安装插件对应的Luci软件包用户支持界面插件，尤其在硬路由跑OpenWRT就经常会出现这种问题。解决方法也很简单，继续在CMD页面输入后回车。</p><blockquote><p>opkg install luci-app-p910nd<br> </p></blockquote><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/20fafb859aa7e6cdf89d1c63e7ecf1b7?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/20fafb859aa7e6cdf89d1c63e7ecf1b7" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">这会再进入Luci界面拉到「Service」，就能够开始相应的设置了。直接勾选enable后，按需选择接口和端口值即可。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/46b2fbc71ba94bb6164781fe395a7767?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/46b2fbc71ba94bb6164781fe395a7767" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">设置完成后按照网络打印机的安装方法逐步添加即可。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/ea986793508e037e4b2c3f1677442de9?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/ea986793508e037e4b2c3f1677442de9" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">最后就可以打印测试页，查看打印机是否正确驱动起来了。当然很多时候会各种报错，这个与打印机的品牌型号有关系，建议按相关型号搜索解决方法。不过像笔者这台EPSON的问题就没有解决只能搁置了，笔者分析应该是上电加载的问题，应该写个执行脚本保证打印机接入就能挂载传递驱动。实测下软路由方案基本没有什么大问题，通用问题已经解决差不多了。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/b24ad989f2f31253c8e6afdb4f23b0dc?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/b24ad989f2f31253c8e6afdb4f23b0dc" referrerpolicy="no-referrer"></figure><h4 style="margin-left:0px;"><strong>上传安装IPK文件</strong></h4><p style="margin-left:0px;">因为SoC不同，所以各个路由器的各种设置都会有差异，软件中心自然也就不是什么插件都有、什么都能安装。那就不免需要手动下载ipk进行安装，首先我们需要根据官方的安装要求，将所需的依赖依次安装到位。没有所需的依赖，对应的插件是无法安装或者开启相应功能的。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/772b4b0ba3bf0c48a1dddb7c05c1e73d?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/772b4b0ba3bf0c48a1dddb7c05c1e73d" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">同样也是不需要通过第三方软件，直接通过scp指令就能够将ipk文件直接拷贝到需要的路径，根据自身文件位置和网络设置后，输入下列代码后回车</p><blockquote><p>scp文件路径\IPK文件全名 root@192.168.8.1:/tmp</p></blockquote><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/38c30af5d9c6967a13a986522fda71ea?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/38c30af5d9c6967a13a986522fda71ea" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">但是这里可以看到无法传输文件，这是因为我们之前已经建立过SSH链接，对应的配置信息自然是无法匹配的，所以我们需要删除「C:\Users\79173\.ssh」路径下的known_hosts，这一步是为了删除之前已经建立的SSH链接的信息，在下一步的拷贝中就完全是一个新开链接了。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/e01744f2d7741be957916ace3ab91a18?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/e01744f2d7741be957916ace3ab91a18" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">继续执行之前的指令，就能够看到让你输入相关确认和密码的提示，最后就能够将文件直接拷贝到路由器上了。然后我们就可以通过「opkg install」命令安装对应的插件了，一定要把相关依赖安装完毕后，再输入如下代码安装对应插件。</p><blockquote><p>opkg install /tmp/插件全名</p></blockquote><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/ff228191105ff9e9b647c8df9a750377?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/ff228191105ff9e9b647c8df9a750377" referrerpolicy="no-referrer"></figure><h4 style="margin-left:0px;"><strong>编译并刷入固件</strong></h4><p style="margin-left:0px;">可以看到前面上传固件时，各种依赖的缺失和无法安装才是更为主要的问题，毕竟官方的版本和内核有很多版本，针对这类硬路由适配自然不如软路由。我们不可能为了一个插件的安装来反反复复调试好几天，那么选择已经编译好的固件或者自行编译固件反而是更为高效的做法。关于自行编译固件的教程很多，根据设备不同要有不同的配置，建议有条件和余力的用户自行尝试。推荐先按X-WRT的教程学习如何编译，能够对实际的编译工作有一个整体的认知。</p><p><a target="_blank" rel="noopener noreferrer" href="https://link.zhihu.com/?target=https%3A//blog.x-wrt.com/docs/build/">编译教程​blog.x-wrt.com/docs/build/</a></p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/03abfcb1c7423746304679bba47ad094?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2022/09/07/article/03abfcb1c7423746304679bba47ad094" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">当然官方在github也有image-builder，能够完全保留Gl-inet的操作界面。如果是为了远程访问的话还是，建议优先考虑官方的教程和编译器，用起来更加简单。</p><p><a target="_blank" rel="noopener noreferrer" href="https://link.zhihu.com/?target=https%3A//github.com/gl-inet/gl-infra-builder">https://github.com/gl-inet/gl-infra-builder​github.com/gl-inet/gl-infra-builder</a></p><p style="margin-left:0px;">话说回来，恩山已经有大佬自行制作了适配MT1300的固件，觉得折腾起来麻烦的用户可以下载这个插件并根据自身需求进行配置使用。账户默认用户名root，密码toor，固件在文中的链接，需要登录GitHub后才能点击下载。</p><p><a target="_blank" rel="noopener noreferrer" href="https://link.zhihu.com/?target=https%3A//www.right.com.cn/forum/thread-7085123-1-1.html">glinet mt1300 定制稳定21.02固件​www.right.com.cn/forum/thread-7085123-1-1.html</a></p><p style="margin-left:0px;">第三方固件MD5无法与官方固件值匹配，无法直接烧写，不建议通过官方的路由界面进行烧写固件的操作，请进入Luci界面后选择「系统」-「备份/升级安装」后，上传固件完成再开始烧写。现在的固件升级都简单化、傻瓜化了，不需要像以前一样还要线刷卡刷了。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/d7437be73ee37b0548e73216a7c31925?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/d7437be73ee37b0548e73216a7c31925" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">这版固件集成了加速服务、动态DNS、Aria2下载和网络共享功能。去除了4G上网卡功能支持，仅保留了SD卡槽和USB的存储功能，和与之配套的Aria2离线下载和SMB文件服务器功能。也基本能够满足大多数用户的需求了，更多的需求可以参照笔者上面的方法自行安装插件。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/d3ed6809e03dc0849f9afe6d6151a9eb?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/d3ed6809e03dc0849f9afe6d6151a9eb" referrerpolicy="no-referrer"></figure><h3 style="margin-left:0px;"><strong>1.3.使用效果</strong></h3><p style="margin-left:0px;">笔者的下载任务都是直接部署到NAS上，或者在电脑下载完毕后再归档。所以这版固件的下载与文件共享功能就没有尝试，仅尝试了游戏加速功能。笔者家的网是联通千兆光纤接入，直连的效果倒是还可以能到百兆，但是真要预载和下载游戏的话就有些慢了。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/d79bdf58b6a0d7bb022742b6b77223d8?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/d79bdf58b6a0d7bb022742b6b77223d8" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">设置完成后再次进行测试，连接速度能够达到200Mbps以上，相比直连直接翻了一番。而且延迟和网络稳定性更好了，联机游戏的体验上升了一个层次。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/a3a29e4ef41ead8fe6b31fa7b180abef?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/a3a29e4ef41ead8fe6b31fa7b180abef" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">国内电视想要使用网飞只能通过另购外贸版机顶盒的方式解决，作为最传统的智能机顶盒，PS和XBOX自然是当仁不让的能完成这个功能。PS端的网飞除了和电视输入一样的蹩脚、还有一如既往的无法通过内置设置调节音量外，观看使用的效果还是相当不错的，基本上30秒左右视频就能够加载到最高的码率。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/5d8e72e522cc7b31e5e1e8f445631ea5?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/5d8e72e522cc7b31e5e1e8f445631ea5" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">另外这版固件还集成了网络唤醒功能，现在大部分的NAS都能够支持有线网络唤醒，如果想按需再开启NAS设备就可以配置路由器的网络唤醒功能。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/8d6a4eebf9c5429f933d858196f5151e?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/8d6a4eebf9c5429f933d858196f5151e" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">QNAP TS-451D在「ControlPanel」-「系统」-「电源」中的「网络唤醒(WOL)」标签页中选择开启，就能够开启网络唤醒功能了。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/8fe13e10f430090e3d7ad805e9bf5bad?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/8fe13e10f430090e3d7ad805e9bf5bad" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">设置完成后我们就可以查看其MAC与IP了，记得把这两个值记下，后续配置需要使用。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/461757284d8ec6828b297e7b2ca79c63?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/461757284d8ec6828b297e7b2ca79c63" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">MT1300这台设备作为旁路由是通过WAN口连接到MX4200子节点，TS-451D也是连接到子节点。实现网络唤醒的功能，首先需要在「选择要唤醒的主机」中查找到或者手动输入对应设备的信息。如果是非同网段的地址的话，则需要勾选发送到广播地址，选择对应网段设备进行网络唤醒。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/82b92c45aad9c3c6a94dda7d44f16b1d?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/82b92c45aad9c3c6a94dda7d44f16b1d" referrerpolicy="no-referrer"></figure><h2 style="margin-left:0px;"><strong>2.第二次升级-软路由的主路由化尝试，N5105四口2.5G工控主机使用体验</strong></h2><p style="margin-left:0px;">旁路由的整体使用效果虽然还不错，但在某些应用场景下还是有些力不从心。加考虑软路由系统和硬路由覆盖的后续升级，必须要降低二者的耦合程度。所以就成了现在软路由承担路由功能，硬路由承担无线覆盖与有线扩展的现有拓扑。现在这个院子修建的时间太早，也没法重新穿线，必须借助无线MESH完成两套院子三百多平的覆盖。最开始是三只MX4200加一只AC1300负责了整体的无线覆盖，受限于东西两个院子的实际格局，仅能保证主要范围内的网络覆盖。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/e3d01a0a02c2c39adc77fdc07e8d5cbd?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/e3d01a0a02c2c39adc77fdc07e8d5cbd" referrerpolicy="no-referrer"></figure><h3 style="margin-left:0px;"><br><strong>2.1.软路由平台选择</strong></h3><p style="margin-left:0px;">常见的软路由系统有：OpenWrt、LEDE、PandoraBox、Koolshare、Padavan、iKuai、Router OS等。非企业用户主要选择OpenWRT，LEDE和iKuai这些固件。</p><h4 style="margin-left:0px;"><strong>N5095软路由专用主板使用案例</strong></h4><p style="margin-left:0px;">这台准系统购于四月初，买回来之后也是各种事前后脚地赶一块，到了五月底才有时间试机。试机发现无法点亮后，又寄回去返修。卖家用装好系统的盘和我一块寄过去的内存测试后，说没有任何问题最后又寄回来了。最后到了七月才有时间继续调试，把升级新笔记本替换下来的固态装上去就好了。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/ce363b3fb71dd32e792cc470d4caf9cb?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/ce363b3fb71dd32e792cc470d4caf9cb" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">不过在实际使用中发现，这台机器虽然全身鳍片，但温度也还是挺高的。表面最热的位置能有47℃左右，内部温度可想而知。之前拆机时2.5G网口基本都是通过Intel i225v这颗芯片转接转接，发热还是比较高的。而且替换的这块固态温度也挺高，整个机器的每个元件都在源源不断的散发热量。考虑到实际使用情况，建议选择工作温度较低的固态硬盘，或者给硬盘安装合适的导热贴。避免因为硬盘的发热影响处理器与网卡芯片的正常工作。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/b5399201aaad7f323ae19311eefc9a4c?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/b5399201aaad7f323ae19311eefc9a4c" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">如果是直接使用爱快或者OpenWRT作为物理机的话，一根4G的笔记本DDR4内存就完全足够。不过大部分人都是为了虚拟化和All in One，才会搞N5095/5105这个级别的处理器。以笔者的实际使用经验来说，对于ESXi单个虚拟机的内存上限需要低于其开启时剩余内存的一半，所以要根据自身需求选择内存。所以笔者直接入手了Kingston 金士顿 FURY Impact 3200MHz 8G*2的套装，多跑几个虚拟机也完全够用了。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/fa1231969671feaf213085fd81a89348?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/fa1231969671feaf213085fd81a89348" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">如果只需要一台高性能路由器的话，把OpenWRT固件烧录进去就够了。不管是ARM还是X86的软路由都有大量配置编译好的固件，根据自身需求选择后，按照相应的教程完成写盘操作即可使用。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/84790d78ce68c63300b06c8a7aa5264d?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/84790d78ce68c63300b06c8a7aa5264d" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">虽然这台机器全金属外壳还布满了散热鳍片，但它还是很热。为了保证机器的散热，建议搞个风扇对着吹。笔者的风扇是原来Antec那台机器拆机取下的，需要单独购买一条USB转3针的线来供电。家中没有富余风扇的话，也可以直接买带风扇的成品支架，价格小几十也不算贵，但是降温效果确实好了很多。为了保证机器的稳定性，不想上机柜的话就搞个这种风扇支架吧。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/1396e82fcfbd6f70abad3f1eff32557d?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/1396e82fcfbd6f70abad3f1eff32557d" referrerpolicy="no-referrer"></figure><h3 style="margin-left:0px;"><strong>2.2.软路由搭建与配置</strong></h3><p style="margin-left:0px;">软路由常用的虚拟化平台有EXSi，PVE和unRaid，EXSi的界面清晰易用，但硬件兼容性较差。x86软路由卖家基本都会自己卖配套的硬件和刷机服务，所以EXSi的教程比较多。关于固件，可以在<a target="_blank" rel="noopener noreferrer" href="https://link.zhihu.com/?target=https%3A//www.vmware.com/products/esxi-and-esx.html">VMWare官网直接下载</a>，不过下载前需要进行注册，建议不要填写真实信息。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/f9b3d139caa38b03c14b213379e4653a?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/f9b3d139caa38b03c14b213379e4653a" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">下载好img文件后，就该安装虚拟化平台了。首先制作安装U盘，有条件的话来个USB 3.0的硬盘，能够有效的提升安装速度。软件的话，建议选择Ultra ISO进行烧录。除了部分迷你主机的处理器和主板BIOS比较老，需要调整启动顺序外，Intel四代酷睿Core i及更新的处理器和Ryzen锐龙都不需要单独设置。另外提一句，便携屏对于各种路由和不方便移动位置的机器来说，确实足够方便。调试的时候再连接行了，平常不需要占地方。Ehomewei Q3这块屏是mini HDMI接口，需要用附带的线缆进行图像传输。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/c698445ec5fae711620ccb0290a0f34c?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/c698445ec5fae711620ccb0290a0f34c" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">安装只需要一路下一步，只是速度取决于U盘的速度和软路由自身的速度，而且即便这两者都没有短板，安装也还是挺慢的。默认账户名为root，不需要自己输入；密码可以自设，但是要求比较多，需要包含大小写字母、数字和特殊符号。其他都操作完成后，我们就需要进入设置并在IPv4 Configuration输入对应的参数了，通过空格选择最后一项Static IPv4 adress后，机器的IP修改为192.168.1.10，子网掩码设置为255.255.255.0，然后将网关设置为192.168.1.1。这部分请根据自身的需求设置，这里的设置仅用于网络登录EXSi进行下一步设置。像如果只使用OpenWRT的话，也可以设置为192.168.5.X。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/7d62ddfac8b0cc540e2dd74613c8847e?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/7d62ddfac8b0cc540e2dd74613c8847e" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">之后就需要将你的电脑接入到这台软路由主机上，记得多备一根网线。我们需要手动修改适配器IP设置，与你之前的IP设置在同一个网段即可。完成本地的IP修改后，在浏览器中输入之前给软路由设置的IP，就能够通过网络登入EXSi的管理界面。所需的虚拟机都在这里配置管理，不管是路由器的固件还是单独的系统，安装设置方式基本一致。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/942e8e5533bca8eb52844b27aeee714a?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/942e8e5533bca8eb52844b27aeee714a" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">固件获取方式有三种：</p><ul><li>第一个方式是，直接下载其他人做好的vmdk文件，国内的话恩山和其他一些论坛会有比较多的选择。</li><li>第二个方法是，自行拉取Github的相关代码后，自行编译出img文件i后，在通过虚拟机安装后导出，转化为需转化为vmdk文件。</li><li>第三个方法是，直接下载官方镜像后通过虚拟机安装后，完成OpenWRT与相关插件的配置后，导出vmdk文件。</li></ul><p style="margin-left:0px;">如果你只是想用着舒服，那完全不用考虑后两种方法，直接去论坛翻大佬们制作好的固件即可。里面会有img文件、虚拟机平台需要的vmdk文件以及各种写盘软件。完完全全是保姆级的，别想自己琢磨太多别的就好了。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/60b0181bd94cb6a127ebb4fafc12faa3?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/60b0181bd94cb6a127ebb4fafc12faa3" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">为了保证断电重新上点后也能够正常使用，我们需要对自动启动进行设置。启动延迟需要根据机器自身性能决定，建议设置为20秒即可。如果软路由的性能稍差，也可再将时间放宽一些。这里的时间设置，是指EXSi完全启动后，才开始计时。日常重启软路由的话，一般都要等个3-5分钟，待系统与虚拟机完全上线才能有网。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/a7d3dbe59b83c3e8cede458d0585e785?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/a7d3dbe59b83c3e8cede458d0585e785" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">在管理中可以切换网卡直通，要注意的是，当前连接的这个网口是不能切换为直通的，如果你的设备接口较多，建议将其他接口全部修改。如果你仅仅是个双网口甚至单网口的机器，就完全不需要考虑这个问题了。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/0aa86080c3efe34385bf5af97368dee0?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/0aa86080c3efe34385bf5af97368dee0" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">创建虚拟机很简单，机器名称需要唯一，按照个人命名方式命名即可；兼容性选择最高的版本；客户机操作系统选择Linux，系统版本选择其他Linux（64位），如果安装其他Windows的话就选择对应的Window相关选项。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/63319cd776fe0f721d6770497aab2c45?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/63319cd776fe0f721d6770497aab2c45" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">自定义设置这里，根据你的需求选择CPU和内存大小。要注意EXSi的内存预留很迷，所以请保证当前虚拟机的内存设置要低于可用内存的一半。使用vmdk镜像，需要将自动加入的硬盘删除，然后点击添加硬盘后，选择相关的文件。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/f4cde19fee45e37f18a9d8da0f9ac993?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/f4cde19fee45e37f18a9d8da0f9ac993" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">不过我们之前没有上传，所以需要设置好文件夹后再上传镜像。在外面下载的镜像都会有两个文件，需要保证两个镜像都上传才能识别安装。上传也可以在存储部分直接选择确认，同样地建立文件夹、上传镜像即可。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/2c4ec9b0c1d84de8f8d5a9879e0ef2ba?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/2c4ec9b0c1d84de8f8d5a9879e0ef2ba" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">上传完成后一路下一步就OK了，顶多再修改一下硬盘分配的容量。之前已经设置好了网卡直通，点击添加其他设备后选择添加新PCI设备即可自动将网口绑定到机器上。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/188223889ac3957310cf1b51a28b81e8?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/188223889ac3957310cf1b51a28b81e8" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">单纯跑OP的话，基本分个单核1G就够了。如果需要跑更多的服务，尤其是需要通过Docker跑各种服务，可以给虚拟机配置按需加量。记得完成后，同样需要在虚设置中，将当前需用的这个OpenWRT虚拟机修改为自动启动，与机器自动启动的设置相同即可。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/57457faee6fdd33b25af10d43563061c?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/57457faee6fdd33b25af10d43563061c" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">完成OpenWRT安装后，我们需要进行对WAN口和LAN口进行设置。WAN口就是根据你的网络链接情况，由于之前光猫已经调整为桥接模式，一直都是主路由拨号，所以选择PPPoE填写完账号密码信息后，点击WAN口设置的连接即可。LAN口的情况相对复杂，接口的实际情况确认。一般你用于上传的这个接口（此处为ETH0），一直被占用，所以直接就是可用的。其他两个接口ETH2、ETH3需要在LAN接口设置中自行勾选。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/33962c241dd8eb7a6dc9c1857f0b8ab6?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/33962c241dd8eb7a6dc9c1857f0b8ab6" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">查看接口速率可以发现，作为WAN口的ETH1协议速率是千兆。毕竟现在的10Gpon光猫只有光纤进线是万兆，向下的四个LAN口则都是千兆。ETH0则是接入了笔记本，自然协议速率也是千兆。ETH2是接到了2.5G交换机上，所以协议速率已经是2.5G了，后续的高速设备和原有的主路由都是接入交换机。为之后全屋2.5G内网和替换光猫做好了准备。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/d4d6c719a0d2974f5639e3c72ac4de99?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/d4d6c719a0d2974f5639e3c72ac4de99" referrerpolicy="no-referrer"></figure><h3 style="margin-left:0px;"><strong>2.3.Open WRT插件推荐与相关配置</strong></h3><p style="margin-left:0px;">镜像中自带多拨的功能，支持单线多拨和多线多拨。不过具体能否使用多拨需要根据所在地运营商的情况确认，有的地区多拨后没有任何效果，有的地区无法多拨。笔者实测北京联通是可以多拨的，不过因为已经拉了千兆接入，多线多拨还是放在了两台物理机，没有单台设备多拨的经验。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/0234d6c5c866fc46bbdefd210a8b72af?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/0234d6c5c866fc46bbdefd210a8b72af" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;"><br>使用软路由还有个很重要的需求就是去广告，各个去广告的插件从原理上类似，接管流量后通过订阅和手工加入的规则来匹配客户机的解析申请，从而将网页广告的申请全部屏蔽，达到去广告的效果。这里选择了DNS filter，过滤规则选Easylist+Easylistchina即可。开启过滤后会影响网页载入速度，待整体稳定使用后能有所缓解，具体如何平衡还需自己尝试调试。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/3a079b46555f49f670628b0ac53da24d?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/3a079b46555f49f670628b0ac53da24d" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;"><br>Turbo ACC网络加速设置没有太多可讲的，流量分载尽量不要开，部分情况下其会影响到需要长连接多跳的应用，如果你是果子全家桶建议关闭；家用使用肯定是开启全锥形NAT，尤其是有游戏需求的用户；BBR拥塞控制算法就无所谓了，家庭都是高带宽光纤接入，现在开关与否感受不到区别；DNS缓存一定要开，配合DNS Filter这些应用的规则，越用越快。<br> </p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/c7ece2db08fdeb6df72b67aceda4c795?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/c7ece2db08fdeb6df72b67aceda4c795" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;"><br>Docker是一个开源的应用容器引擎，让开发者可以打包他们的应用以及依赖包到一个可移植的镜像中，然后在Linux或Windows的系统中部署使用。你能想到的绝大部分问题和需求，都能通过拉个现成的镜像部署解决。不过如果需要的镜像特别多，还是给OpenWRT多分配点内存吧，对于那些不需要介入整体流控的应用，也可以在EXSi上开一个Debian或者Ubuntu的虚拟机用于弹性部署。<br> </p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/6bb84a97e270391a4666c7ebc5c9dc0f?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/6bb84a97e270391a4666c7ebc5c9dc0f" referrerpolicy="no-referrer"></figure><h3 style="margin-left:0px;"><br><strong>2.4.原有硬路由完成W-iFi覆盖的设置选择</strong></h3><p style="margin-left:0px;">为了更多功能，将软路由作为主路由使用后，同样将MX4200降级成了次级路由使用。通过MX12600+MX2001完成的无线Mesh覆盖，在设置上就有了两个选择：静态IP/自动分配DHCP和桥接模式，两类方式的本质区别在于NAT转发是否开启，实际使用则是各有优劣。</p><p style="margin-left:0px;"><strong>采用静态IP/自动分配DHCP的优缺点</strong></p><ul><li>无线MESH完全可用，没有区别</li><li>即便配置了静态路由表，部分只扫IP段的应用也无法搜索到上一级的设备</li><li>替换入户软路由/主路由更简单</li></ul><p style="margin-left:0px;"><strong>采用桥接桥接模式的优缺点</strong></p><ul><li>无需调整主路由原有IP段，无需设计静态路由</li><li>默认.1的IP设置，在替换主路由会产生冲突</li><li>原主路由大部分功能无法使用</li></ul><p style="margin-left:0px;">因为OpenWRT运行在EXSi平台上，而且并不是最终的稳定版本。所以为了保证整体网络的正常运行，还是选择了Linksys MX4200作为二级路由的使用方式，二级子网的DHCP权限还是在领势这套无线Mesh组这里，方便之后的调试工作。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/9138076b3885613b76253083ae8acde0?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/9138076b3885613b76253083ae8acde0" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">以前东小院只有库房，平常也没人在，所以只买了个AC1300做覆盖。毕竟两堵院墙隔着，之前也就是有个网能凑活用罢了。今年收拾出一间办公室，一堆设备加上摄像头还得用网，正好再入一支MX2000完成两个院的整体覆盖。从左到右依次为MX4200、MX2000和AC1300，路由器个头基本一套娃一样，除了MX2000更换了Linksys领势的最新LOGO之外，设计语言可以说是一脉相承了。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/1fc29626e44b2cabfc8249acf11632dc?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/1fc29626e44b2cabfc8249acf11632dc" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">各家的无线Mesh配置都要繁琐一些，尤其是都需要在无线状态下添加、识别和认证。不过领势Linksys家的设备有一个简便设置的方法，就是通电后连续五次按下RESET键，MX2001这些Velop设备就能够自动加入已有的Mesh网络。不过这种方式设置的节点不会更改在Mesh网络中的设备名，需要自己手动在APP中修改，所以建议配置完一台就修改一台，并且将其布置到需要位置后再配置下一台。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/1b292a5d060e00c345366e2e9b96a375?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/1b292a5d060e00c345366e2e9b96a375" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">由于Linksys领势这三支MX4200加上单支的MX2000作为主路由的下级子网铺开，在保留无线覆盖这个最主要功能的情况下还保留了DHCP功能，所以现阶段整体拓扑的鲁棒性很好。Ethernet Header、 IP Header、TCP Header、ATM Header这些帧头占用是定死的，所以千兆接口的实际传输速率不会高于945Mbps，这也是大家为什么都想破千兆，毕竟更高规格的接口下，能差不多再有不到300Mbps的带宽提升。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/cbf897cadb5ffbe6c5490f961c02d2c8?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/cbf897cadb5ffbe6c5490f961c02d2c8" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">无线传输不像有线传输就是照着跑满来的，收到其他广播的影响，总归是会有一些损失的。我们在MX4200主节点下进行无线测速，以下行速率看，传输速率是能跑到877Mbps。基本上是全千兆接入的上限了，信号强度也是各个够高，拉倒了-23dB。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/c7b098d19321f9ec695f08429c6711c1?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/c7b098d19321f9ec695f08429c6711c1" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">西厢房的MX4200节点，要通过客厅的主节点连接到工作室的主节点，就是个两跳的开销。穿墙穿玻璃穿门好几道，这个情况下无线测速的传输速度也能保持在500Mbps。基本上主院这边，正房完成了有线无线全千兆、部分内网2.5G有线覆盖，厢房则是达到了500Mbps级别的无线覆盖。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/85706d8b0be9b4bd9e632ded2aa4a496?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/85706d8b0be9b4bd9e632ded2aa4a496" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">而MX2001的位置确实是偏，路径上需要借助另一台次节点链式接入，总共在无线Mesh下经过两跳，其中第一跳还要经过一堵13cm的砖墙，第二跳需要经过一堵12cm和一堵37cm的砖墙。位置也不是完全正对，存在角度和高度差。可以在测试结果中看到，依旧能有-53dB的信号强度和170Mbps的传输速率</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/d585dfed80f7603efb6afe161438ee2e?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/d585dfed80f7603efb6afe161438ee2e" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">厢房和东小院还能保证两个较高的速度，而且还是Mesh无线回程情况下达到的效果。说明只要能够合理地选择设备和布置节点，即便家中不具备有线布网的条件，也能够有相当不错的覆盖效果。当然如果能够进行有线布网的话，就不用这么大费周章，直接拉线完成多点覆盖即可。</p><h2 style="margin-left:0px;"><strong>3.关于软路由的完整教程与PCDN应用</strong></h2><p style="margin-left:0px;">后续应该是单开一台物理机去跑一些PCDN应用，将从EXSi镜像制作、虚拟机vmdk文件制作和各种PCDN应用配置逐步讲解，将使用过程与实际收益供大家参考。网心云这类PCDN已用已经做进了iStore中，而像甜糖这些应用则需要部署到Docker中。具体的部署和使用情况，后续完成这部分的软路由教程后就可以更新了。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/afea6fff2380c317993c7236525eb2c7?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/afea6fff2380c317993c7236525eb2c7" referrerpolicy="no-referrer"></figure><h2 style="margin-left:0px;"><br><strong>4.总结</strong></h2><p style="margin-left:0px;">现在家庭的网络接入速度越来越快，随着而言的自然也是各种花样越来越多。官方硬路由固件追求的是稳定，一定要保证基本的路由与无线功能，对于非关键的功能基本都不会支持。当然受限于自身的开发实力，某些厂商的固件是真不行。想要追求更多的功能，要么给原路由刷第三方固件 、要么安排个软路由做主路由、要么使用刷好固件的其他软硬路由作旁路由。不过要注意，硬路由刷机基本都需要烧一个<a target="_blank" rel="noopener noreferrer" href="https://link.zhihu.com/?target=https%3A//breed.hackpascal.net/">Breed控制台</a>，避免后续有烧录失败，只能通过串口刷进的情况。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/3d028d288847a59a57afe0d198d126bb?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/3d028d288847a59a57afe0d198d126bb" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">而软路由作为主路由的方案，得益于其升级难度低、综合性能表现好，只需要付出微乎其微到根本无法感知的带宽和时间消耗，就能得到远超其他两种方式的效果。尤其是在主路由崩溃后的依旧能通过无线网接入调试，还有后续的设备升级调整只需调整完后直接替换，都比直接桥接同一子网的更为方便。另外更多人的关心的是测速破千兆的问题，由于笔者家需要使用IPTV和固话功能，所以无法采用猫棒+收发器的方案。那就只有多拨和后续更换2.5G LAN光猫两种解决方法，等后面光猫降价再说吧。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/09/07/article/497ca2a8d66380ace642cdff0bba0a80?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/09/07/article/497ca2a8d66380ace642cdff0bba0a80" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;"><strong>如果觉得此篇文章对您有帮助的话，还请多多点赞、收藏评论。这里是老锅，我们下期再见！</strong></p></div><div class="update-details-wrap" data-v-557a067a></div><!----></div><div style="border:1px solid transparent;" data-v-557a067a></div><div class="article-side sideTop" style="display:none;left:0;" data-v-cb5db094 data-v-557a067a><div class="download-guide-container" data-v-12d5b4c4 data-v-cb5db094><div class="btn-wrapper" data-v-12d5b4c4><!----><button class="btn btn-view" data-v-12d5b4c4><i class="iconfont iconfont-phone" data-v-12d5b4c4></i></button></div><a href="https://sspai.com/s/JYjP" target="_blank" data-v-12d5b4c4><!----></a></div><div class="item-wrapper" data-v-cb5db094><button class="btn btn-charge" data-v-cb5db094><i class="iconfont" data-v-cb5db094></i></button><span class="count" data-v-cb5db094>22</span></div><div class="item-wrapper" data-v-cb5db094><button class="btn-mini btn-comment" data-v-cb5db094><i class="iconfont iconfont-comment" data-v-cb5db094></i></button><span class="count" data-v-cb5db094>2</span></div><div class="item-wrapper" data-v-cb5db094><span data-v-cb5db094><div role="tooltip" id="el-popover-186" aria-hidden="true" class="el-popover el-popper popper-share right ss-popper-dark-border" style="width:undefinedpx;display:none;"><!----><div class="article-side-share-btn"><a href="https://service.weibo.com/share/share.php?url=null?ref=weibo&title=%E3%80%90OpenWRT%E5%92%8C%E8%BD%AF%E8%B7%AF%E7%94%B1%EF%BC%9F%E6%88%91%E7%9A%84%E8%B8%A9%E5%9D%91%E6%89%8B%E5%86%8C%E5%B0%B1%E6%98%AF%E4%BD%A0%E7%9A%84%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97%E3%80%91%E5%A4%A7%E9%83%A8%E5%88%86%E7%9A%84%E5%AE%98%E6%96%B9%E8%B7%AF%E7%94%B1%E5%9B%BA%E4%BB%B6%E6%98%AF%E5%8A%9F%E8%83%BD%E3%80%81%E9%A9%B1%E5%8A%A8%E5%9B%BA%E5%8C%96%E5%90%8E%E7%BC%96%E8%AF%91%E5%87%BA%E6%9D%A5%E7%9A%84%EF%BC%8C%E9%82%A3%E8%87%AA%E7%84%B6%E7%BC%BA%E7%82%B9%E4%B9%9F%E5%BE%88%E6%98%8E%E6%98%BE%EF%BC%8C%E5%BE%88%E5%A4%9A%E7%AC%AC%E4%B8%89%E6%96%B9%E6%8F%92%E4%BB%B6%E8%83%BD%E6%8F%90%E4%BE%9B%E7%9A%84%E5%86%85%E5%AE%B9%E5%B0%B1%E4%B8%8D%E8%83%BD%E7%94%A8%EF%BC%9B%E9%A5%BF%EF%BC%8C%E4%B8%AA%E4%BA%BA%E5%A6%82%E6%9E%9C%E6%83%B3%E8%A6%81%E9%80%9A%E8%BF%87%E8%B7%AF%E7%94%B1%E5%99%A8%E5%AE%9E%E7%8E%B0%E6%9B%B4%E5%A4%9A%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&pic=https%3A%2F%2Fcdn.sspai.com%2F2022%2F09%2F07%2F10e54f861ed12d9e102f625ab45ccec0.jpg%3FimageMogr2%2Fauto-orient%2Fquality%2F95%2Fthumbnail%2F!1420x708r%2Fgravity%2FCenter%2Fcrop%2F1420x708%2Finterlace%2F1&appkey=3196502474#" target="_blank"><i class="iconfont iconfont-weibo-simple right-16"></i></a><span><div role="tooltip" id="el-popover-926" aria-hidden="true" class="el-popover el-popper" style="width:undefinedpx;display:none;"><!----><div style="text-align:center;"><div id="qr-code"></div><small class="qr-small">扫码分享</small></div></div><span class="el-popover__reference-wrapper"><i class="iconfont iconfont-wechat-simple right-16"></i></span></span><a href="https://twitter.com/share?text=%E3%80%90OpenWRT%E5%92%8C%E8%BD%AF%E8%B7%AF%E7%94%B1%EF%BC%9F%E6%88%91%E7%9A%84%E8%B8%A9%E5%9D%91%E6%89%8B%E5%86%8C%E5%B0%B1%E6%98%AF%E4%BD%A0%E7%9A%84%E5%85%A5%E9%97%A8%E6%8C%87%E5%8D%97%E3%80%91%E5%A4%A7%E9%83%A8%E5%88%86%E7%9A%84%E5%AE%98%E6%96%B9%E8%B7%AF%E7%94%B1%E5%9B%BA%E4%BB%B6%E6%98%AF%E5%8A%9F%E8%83%BD%E3%80%81%E9%A9%B1%E5%8A%A8%E5%9B%BA%E5%8C%96%E5%90%8E%E7%BC%96%E8%AF%91%E5%87%BA%E6%9D%A5%E7%9A%84%EF%BC%8C%E9%82%A3%E8%87%AA%E7%84%B6%E7%BC%BA%E7%82%B9%E4%B9%9F%E5%BE%88%E6%98%8E%E6%98%BE%EF%BC%8C%E5%BE%88%E5%A4%9A%E7%AC%AC%E4%B8%89%E6%96%B9%E6%8F%92%E4%BB%B6%E8%83%BD%E6%8F%90%E4%BE%9B%E7%9A%84%E5%86%85%E5%AE%B9%E5%B0%B1%E4%B8%8D%E8%83%BD%E7%94%A8%EF%BC%9B%E9%A5%BF%EF%BC%8C%E4%B8%AA%E4%BA%BA%E5%A6%82%E6%9E%9C%E6%83%B3%E8%A6%81%E9%80%9A%E8%BF%87%E8%B7%AF%E7%94%B1%E5%99%A8%E5%AE%9E%E7%8E%B0%E6%9B%B4%E5%A4%9A%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&url=null" target="_blank" class="twitter"><i class="iconfont iconfont-twitter-simple right-16"></i></a></div></div><span class="el-popover__reference-wrapper"><button class="btn-mini btn-share" data-v-cb5db094><i class="iconfont iconfont-share" data-v-cb5db094></i></button></span></span></div><div class="item-wrapper" data-v-cb5db094><button class="btn-mini btn-collect" data-v-cb5db094><i class="iconfont iconfont-collect" data-v-cb5db094></i></button></div><!----></div><!---->  
</div>
            