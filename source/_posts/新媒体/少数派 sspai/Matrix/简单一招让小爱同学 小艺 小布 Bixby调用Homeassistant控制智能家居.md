
---
title: '简单一招让小爱同学 小艺 小布 Bixby调用Homeassistant控制智能家居'
categories: 
 - 新媒体
 - 少数派 sspai
 - Matrix
headimg: 'https://cdn.sspai.com/2022/01/15/article/6ac0125d6ca47bdb1ff1bfacd49533fb?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
author: 少数派 sspai
comments: false
date: Sat, 15 Jan 2022 07:36:40 GMT
thumbnail: 'https://cdn.sspai.com/2022/01/15/article/6ac0125d6ca47bdb1ff1bfacd49533fb?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
---

<div>   
<div class="articleWidth-content" data-v-d534f82e><div class="update-wrap" data-v-d534f82e></div><div class="content wangEditor-txt minHeight" data-v-d534f82e><p style="margin-left:0px;">如今,智能家居给我们的生活带来了很多便利，对我来说完全是不用不知道，一用回不去的产品，不少家电的操控我现在都是用嘴完成或者是设置条件自动化执行的。目前自己米家APP、Homeassistant同时都在使用，Homeassistant主要用来弥补米家的一些不足，也避免自己被米家生态困住。但是根据网上的不少案例发现Homeassistant下要实现语音控制，似乎非常麻烦，除了要安置一台诸如天猫精灵之类的接入设备，后台的设置也不简单，于是我一番摸索之后想到用手机自带的语音助手实现操控Homeassistant来执行动作。这么一来只需要一台旧手机（<strong>无论什么品牌，甚至没有自带语音助手都行</strong>）作为语音接入，甚至连天猫精灵、小米蓝牙音箱都省了。但是，需要通过语音助手实现的每一条动作，我都必须单独创建一条自动化。</p><h2 style="margin-left:0px;">工作原理</h2><p style="margin-left:0px;">需要的工具：</p><ol><li>一部旧手机/平板。</li><li>FV悬浮球APP（免费）  或者  <a href="https://www.baidu.com/link?url=FboR5FtHMahInZanVpio2H8OLFTDV7hCzjy76prb3mfg4B_C2n9c6n3QNqYoMbsCSu3iawkUtIw1W5P48hR_FK" target="_blank">通知滤盒</a>APP（付费）</li><li>一台安装了Homeassistant的设备。（只要你会折腾甚至连Homeassistant也可以一同装在旧手机中）</li></ol><p style="margin-left:0px;">执行步骤：</p><ol><li>Homeassistant中预先创建自动化，触发条件设置为webhook</li><li>手机通过语音助手识别我的语音命令</li><li>根据我的语音命令创建一条通知</li><li>通过FV悬浮球的自动任务（或者通知滤盒）获取该通知</li><li>通过FV悬浮球的自动任务（或者通知滤盒）根据通知内容发送对应http请求到Homeassistant</li><li>Homeassistant收到发送的请求，并执行对应自动化。</li></ol><p>如果你是用的是IOS设备，那只需要用Homeassistant安装Home Bridge 插件，就能接入 HomeKit用siri来控制智能家居了。另外IOS的捷径可以直接进行SSH连接安装了Homeassistant的设备执行shell命令。通过shell命令，不仅可以实现远程唤醒/关机之类的操作，甚至也可以执行curl命令来发送http请求给任意设备。这里就不展开讲了，有需要的可以在评论区留言。</p><h2>操作步骤</h2><p>Homeassistant平台的安装，以及如何将米家设备接入，我这里就直接略过了，网上有很多简单的教程。直接进入正题，这里直接以这个Gousund智能插座为例（我的备注是床头灯）来操作。</p><p>Gousund智能插座接入Homeassistant平台后，可以直接从网页端控制。</p><figure class="image ss-img-wrapper image_resized" style="width:720px;"><img src="https://cdn.sspai.com/2022/01/15/article/6ac0125d6ca47bdb1ff1bfacd49533fb?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2022/01/15/article/6ac0125d6ca47bdb1ff1bfacd49533fb" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;"> </p><h3 style="margin-left:0px;">Homeassistant中创建自动化</h3><p style="margin-left:0px;">首先，创建一条自动化，当触发条件时自动执行动作。</p><figure class="image ss-img-wrapper image_resized" style="width:720px;"><img src="https://cdn.sspai.com/2022/01/15/article/8c5eaa42bac70817f0784070ffd006e8?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2022/01/15/article/8c5eaa42bac70817f0784070ffd006e8" referrerpolicy="no-referrer"></figure><figure class="image ss-img-wrapper image_resized" style="width:720px;"><img src="https://cdn.sspai.com/2022/01/15/article/5b069a5037e5facacc18afc093eba5f3?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2022/01/15/article/5b069a5037e5facacc18afc093eba5f3" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">这里我创建一条自动化操作，名称自己随便写，然后触发条件我选择webhook，webhook ID我就填入chuangtoudeng(记住这个 webhook ID 后面要用)，动作就是切换床头灯开关。这条自动化的含义就是：当Homeassistant接受到正确的http请求后就会执行切换智能插座开关状态的动作。到这里Homeassistant端设置完成，接下去是手机端配置。</p><h3 style="margin-left:0px;">语音助手配置</h3><p style="margin-left:0px;">手机端，我以我的华为平板为(实际上任何Android4.4+设备都可以实现类似操作)例：打开智慧生活APP，在场景中添加一条：</p><figure class="image ss-img-wrapper image_resized" style="width:720px;"><img src="https://cdn.sspai.com/2022/01/15/article/7568f6c6777e7e6f8854acc6bb8b4a86?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2022/01/15/article/7568f6c6777e7e6f8854acc6bb8b4a86" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">如此，当我呼出语音助手，对小艺说打开床头灯后，系统会自动创建一条通知，内容就是：打开床头灯。</p><h3 style="margin-left:0px;">FV悬浮球APP 配置</h3><p style="margin-left:0px;">接着打开平板上的fv悬浮球，创建一条自动任务：</p><figure class="image ss-img-wrapper image_resized" style="width:720px;"><img src="https://cdn.sspai.com/2022/01/15/article/a168dd2dcd507cf30743504666226dcd?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2022/01/15/article/a168dd2dcd507cf30743504666226dcd" referrerpolicy="no-referrer"></figure><figure class="image ss-img-wrapper image_resized" style="width:720px;"><img src="https://cdn.sspai.com/2022/01/15/article/be635516408f93396ec069def2246c4a?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2022/01/15/article/be635516408f93396ec069def2246c4a" referrerpolicy="no-referrer"></figure><figure class="image ss-img-wrapper image_resized" style="width:720px;"><img src="https://cdn.sspai.com/2022/01/15/article/f192eea801dc9a0a658d7b25895f1f87?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2022/01/15/article/f192eea801dc9a0a658d7b25895f1f87" referrerpolicy="no-referrer"></figure><figure class="image ss-img-wrapper image_resized" style="width:720px;"><img src="https://cdn.sspai.com/2022/01/15/article/6f712da98fea827e02a6382c4ccc9a06?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2022/01/15/article/6f712da98fea827e02a6382c4ccc9a06" referrerpolicy="no-referrer"></figure><p>创建好触发条件后，下面是执行的任务内容:</p><figure class="image ss-img-wrapper image_resized" style="width:720px;"><img src="https://cdn.sspai.com/2022/01/15/article/90af3527fe84e35145994bc515faa656?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2022/01/15/article/90af3527fe84e35145994bc515faa656" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">03是获取通知的标题（通知的标题参数是：android.title），04是获取通知的内容（通知的内容参数是：android.text）。05是将04获取的通知内容作为参数传递给子任务《任务识别》。（有一些语音助手创建的通知内容会在标题里，有的则是放在内容里，这里根据不同情况选择将03还是04作为参数传递到子任务）</p><p style="margin-left:0px;">然后创建子任务《任务识别》</p><figure class="image ss-img-wrapper image_resized" style="width:720px;"><img src="https://cdn.sspai.com/2022/01/15/article/053977c621a9cb787f04a1346244ade9?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2022/01/15/article/053977c621a9cb787f04a1346244ade9" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">任务中创建一个分支，内容为获取外部分享到任务的内容（也就是获取主任务传递过来的参数），然后分支1设置成打开床头灯，动作为执行http请求，请求方式为post。这样只要主任务传递过来的参数是“打开床头灯”（和分支的内容相同1），那就执行动作http请求，将http请求发送给homeassistant。注意：Homeassistant的webhook触发只支持post请求，所以请求方式必须选择post，而请求的内容是：<code>http://[Homeassistant的ip地址]:[部署Homeassistant的端口号]/api/webhook/[webhook ID]</code><br><br>这里的webhook ID 就是之前Homeassistant配置中自己填写的。</p><p style="margin-left:0px;">这样只要当我对语音助手说出"打开床头灯" 语音助手就会创建一条通知,内容为"打开床头灯" FV悬浮球自动任务获取该通知后就会进行http请求,触发Homeassistant的自动化来打开智能插座了。至于其他任何想用语音助手执行的动作，只要对应添加好：1、Homeassistant里的自动化2、语音助手的通知动作3、fv自动任务中第二个子任务中添加一个分支。就可以了。</p><h3 style="margin-left:0px;">通知滤盒APP 配置</h3><p style="margin-left:0px;">通知滤盒的设置就更为简单了，先配置好语音助手，然后触发一次，到通知滤盒里就能看到对应通知，然后自定义一个规则，进入webhook配置，选择对应的app，输入对应的通知内容，然后URL这里一样填写：<code>http://[Homeassistant的ip地址]:[部署Homeassistant的端口号]/api/webhook/[webhook ID]</code></p><p style="margin-left:0px;">另外，这里默认就是post方法发送HTTP请求。</p><figure class="image ss-img-wrapper image_resized" style="width:460px;"><img src="https://cdn.sspai.com/2022/01/15/256c7abd37c16c9bb56845a6f64f712e.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/01/15/256c7abd37c16c9bb56845a6f64f712e.png" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;"> </p><h3 style="margin-left:0px;">其他语音助手设置</h3><p style="margin-left:0px;">同理其他手机平台我就不详细介绍了（主要我也没那么多手机 = =），在三星手机上，打开bixby日常，如果里就选手动启动，则里面就设置创建通知。</p><figure class="image ss-img-wrapper image_resized" style="width:720px;"><img src="https://cdn.sspai.com/2022/01/15/article/a72a14907e77b1a7c7a7b31426b76f84?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2022/01/15/article/a72a14907e77b1a7c7a7b31426b76f84" referrerpolicy="no-referrer"></figure><p>然后再到bixby里面添加一条语音命令来调用，内容就写开始XXX日常程序，对应上面日常里的名称。（我这里用的网图，我自己的S9无法更新到one ui3.X 心塞）</p><figure class="image ss-img-wrapper image_resized" style="width:414px;"><img src="https://cdn.sspai.com/2022/01/15/article/40d790f61ec520bc59e5b81c11f2bc68?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2022/01/15/article/40d790f61ec520bc59e5b81c11f2bc68" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">同样的，oppo平台下则是到小布指令里添加一个提醒，然后点到小布训练里面添加语音命令。</p><figure class="image ss-img-wrapper image_resized" style="width:239px;"><img src="https://cdn.sspai.com/2022/01/15/article/ab87dfe41e45db1a16cb4f3e4c71a181?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2022/01/15/article/ab87dfe41e45db1a16cb4f3e4c71a181" referrerpolicy="no-referrer"></figure><h2 style="margin-left:0px;">没有语音助手，那就装个小爱同学吧</h2><p style="margin-left:0px;">小米还是比较良心的，无论你是不是小米手机，都可以安装小爱同学。只是非miui的手机功能上有所欠缺。另外，小爱同学创建通知的方法有点点特别，要实现这个操作不是打开小爱同学，而是打开米家app，在米家app里设置手动执行则给手机发送通知，并且打开用小爱来控制。</p><figure class="image ss-img-wrapper image_resized" style="width:371px;"><img src="https://cdn.sspai.com/2022/01/15/article/c54564a7dfc6e78b025ee32a4537c63a?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2022/01/15/article/c54564a7dfc6e78b025ee32a4537c63a" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">如此一来，在米家中手动点击任务或者用小爱同学都可以自动触发通知。</p><p style="margin-left:0px;">不过最近米家APP更新了，通过米家创建场景生成的通知内容，之前是在通知的标题里，更新后变成在通知的内容里了。。。。这就是为啥我在FV自动任务里同时获取通知的标题和内容，就是方便这种时候修改。</p><h2 style="margin-left:0px;">最后，米家不香么？为什么非要用到Homeassistant？</h2><p style="margin-left:0px;">看到这里其实很多人已经发现，如果家里买的都是支持米家的产品，大部分动作只要通过小米蓝牙音箱+米家app就都能实现，那为啥我要弄这么复杂呢？</p><ol><li>通过这个方案，我连小米蓝牙音箱都能省了。。。。一部旧手机就能替代。</li><li>我不想被小米捆绑，通过这个方案，只要能接入homeassistant的，我都可以控制，无需考虑是否兼容米家app。</li><li>通过Homeassistant弥补米家app自身一些不足，这也是最主要的原因。我自己就遇到米家场景中间隔1秒的动作执行有问题的情况：家里爸妈一直要看iptv，而电信给的iptv机顶盒只能用红外遥控器控制，我想用语音控制小米的万能红外遥控器来调频道，于是红外对码完成后，在米家的场景中设置执行动作按下频道1》间隔1秒》按下频道0》间隔一秒》按下频道7(对应频道107)。实际执行的时候就经常变成170,或者先按10,等频道都跳转了才按7。而不设间隔时间，顺序就会乱，间隔2秒就又太长，怎么试都没用。最后我把小米红外遥控器接入了Homeassistant，Homeassistant自动化中的间隔1秒执行非常准确，一次都没翻过车。</li><li>Homeassistant的功能更多，让我可以制定更多自定义自动任务。比如通过webhook触发动作执行shell命令来远程唤醒/关机等等。</li></ol></div><div class="update-details-wrap" data-v-d534f82e></div><!----></div><div style="border:1px solid transparent;" data-v-d534f82e></div><div class="article-side sideTop" style="display:none;left:0;" data-v-7be936cf data-v-d534f82e><div class="download-guide-container" data-v-14f9065e data-v-7be936cf><div class="btn-wrapper" data-v-14f9065e><!----><button class="btn btn-view" data-v-14f9065e><i class="iconfont iconfont-phone" data-v-14f9065e></i></button></div><a href="https://sspai.com/s/JYjP" target="_blank" data-v-14f9065e><!----></a></div><div class="item-wrapper" data-v-7be936cf><button class="btn btn-charge" data-v-7be936cf><i class="iconfont" data-v-7be936cf></i></button><span class="count" data-v-7be936cf>3</span></div><div class="item-wrapper" data-v-7be936cf><button class="btn-mini btn-comment" data-v-7be936cf><i class="iconfont iconfont-comment" data-v-7be936cf></i></button><span class="count" data-v-7be936cf>0</span></div><div class="item-wrapper" data-v-7be936cf><span data-v-7be936cf><div role="tooltip" id="el-popover-5174" aria-hidden="true" class="el-popover el-popper popper-share right ss-popper-dark-border" style="width:undefinedpx;display:none;"><!----><div class="article-side-share-btn"><a href="https://service.weibo.com/share/share.php?url=null?ref=weibo&title=%E3%80%90%E7%AE%80%E5%8D%95%E4%B8%80%E6%8B%9B%E8%AE%A9%E5%B0%8F%E7%88%B1%E5%90%8C%E5%AD%A6%20%E5%B0%8F%E8%89%BA%20%E5%B0%8F%E5%B8%83%20Bixby%E8%B0%83%E7%94%A8Homeassistant%E6%8E%A7%E5%88%B6%E6%99%BA%E8%83%BD%E5%AE%B6%E5%B1%85%E3%80%91%E5%A6%82%E4%BB%8A%2C%E6%99%BA%E8%83%BD%E5%AE%B6%E5%B1%85%E7%BB%99%E6%88%91%E4%BB%AC%E7%9A%84%E7%94%9F%E6%B4%BB%E5%B8%A6%E6%9D%A5%E4%BA%86%E5%BE%88%E5%A4%9A%E4%BE%BF%E5%88%A9%EF%BC%8C%E5%AF%B9%E6%88%91%E6%9D%A5%E8%AF%B4%E5%AE%8C%E5%85%A8%E6%98%AF%E4%B8%8D%E7%94%A8%E4%B8%8D%E7%9F%A5%E9%81%93%EF%BC%8C%E4%B8%80%E7%94%A8%E5%9B%9E%E4%B8%8D%E5%8E%BB%E7%9A%84%E4%BA%A7%E5%93%81%EF%BC%8C%E4%B8%8D%E5%B0%91%E5%AE%B6%E7%94%B5%E7%9A%84%E6%93%8D%E6%8E%A7%E6%88%91%E7%8E%B0%E5%9C%A8%E9%83%BD%E6%98%AF%E7%94%A8%E5%98%B4%E5%AE%8C%E6%88%90%E6%88%96%E8%80%85%E6%98%AF%E8%AE%BE%E7%BD%AE%E6%9D%A1%E4%BB%B6%E8%87%AA%E5%8A%A8%E5%8C%96%E6%89%A7%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&pic=https%3A%2F%2Fcdn.sspai.com%2F2022%2F01%2F15%2Fa3971b3d2b034fab1432fe677108e7a8.jpeg%3FimageMogr2%2Fauto-orient%2Fquality%2F95%2Fthumbnail%2F!1420x708r%2Fgravity%2FCenter%2Fcrop%2F1420x708%2Finterlace%2F1&appkey=3196502474#" target="_blank"><i class="iconfont iconfont-weibo-simple right-16"></i></a><span><div role="tooltip" id="el-popover-3178" aria-hidden="true" class="el-popover el-popper" style="width:undefinedpx;display:none;"><!----><div style="text-align:center;"><div id="qr-code"></div><small class="qr-small">扫码分享</small></div></div><span class="el-popover__reference-wrapper"><i class="iconfont iconfont-wechat-simple right-16"></i></span></span><a href="https://twitter.com/share?text=%E3%80%90%E7%AE%80%E5%8D%95%E4%B8%80%E6%8B%9B%E8%AE%A9%E5%B0%8F%E7%88%B1%E5%90%8C%E5%AD%A6%20%E5%B0%8F%E8%89%BA%20%E5%B0%8F%E5%B8%83%20Bixby%E8%B0%83%E7%94%A8Homeassistant%E6%8E%A7%E5%88%B6%E6%99%BA%E8%83%BD%E5%AE%B6%E5%B1%85%E3%80%91%E5%A6%82%E4%BB%8A%2C%E6%99%BA%E8%83%BD%E5%AE%B6%E5%B1%85%E7%BB%99%E6%88%91%E4%BB%AC%E7%9A%84%E7%94%9F%E6%B4%BB%E5%B8%A6%E6%9D%A5%E4%BA%86%E5%BE%88%E5%A4%9A%E4%BE%BF%E5%88%A9%EF%BC%8C%E5%AF%B9%E6%88%91%E6%9D%A5%E8%AF%B4%E5%AE%8C%E5%85%A8%E6%98%AF%E4%B8%8D%E7%94%A8%E4%B8%8D%E7%9F%A5%E9%81%93%EF%BC%8C%E4%B8%80%E7%94%A8%E5%9B%9E%E4%B8%8D%E5%8E%BB%E7%9A%84%E4%BA%A7%E5%93%81%EF%BC%8C%E4%B8%8D%E5%B0%91%E5%AE%B6%E7%94%B5%E7%9A%84%E6%93%8D%E6%8E%A7%E6%88%91%E7%8E%B0%E5%9C%A8%E9%83%BD%E6%98%AF%E7%94%A8%E5%98%B4%E5%AE%8C%E6%88%90%E6%88%96%E8%80%85%E6%98%AF%E8%AE%BE%E7%BD%AE%E6%9D%A1%E4%BB%B6%E8%87%AA%E5%8A%A8%E5%8C%96%E6%89%A7%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&url=null" target="_blank" class="twitter"><i class="iconfont iconfont-twitter-simple right-16"></i></a></div></div><span class="el-popover__reference-wrapper"><button class="btn-mini btn-share" data-v-7be936cf><i class="iconfont iconfont-share" data-v-7be936cf></i></button></span></span></div><div class="item-wrapper" data-v-7be936cf><button class="btn-mini btn-collect" data-v-7be936cf><i class="iconfont iconfont-collect" data-v-7be936cf></i></button></div><!----></div><!---->  
</div>
            