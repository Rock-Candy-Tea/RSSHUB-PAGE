
---
title: '简单一招让小爱同学 小艺 小布 Bixby调用Homeassistant控制智能家居'
categories: 
 - 新媒体
 - 少数派 sspai
 - Matrix
headimg: 'https://cdn.sspai.com/2022/01/15/article/6ac0125d6ca47bdb1ff1bfacd49533fb?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
author: 少数派 sspai
comments: false
date: Sat, 15 Jan 2022 07:36:40 GMT
thumbnail: 'https://cdn.sspai.com/2022/01/15/article/6ac0125d6ca47bdb1ff1bfacd49533fb?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
---

<div>   
<div class="articleWidth-content" data-v-d534f82e><div class="update-wrap" data-v-d534f82e></div><div class="content wangEditor-txt minHeight" data-v-d534f82e><p style="margin-left:0px;">如今,智能家居给我们的生活带来了很多便利，真是不用不知道，一用回不去。不少家电的操控都是用嘴就能完成，甚至还能设置条件自动化执行。目前自己米家APP、Homeassistant同时在使用，Homeassistant主要用来弥补米家的一些不足，也避免自己被米家生态困住。但是在Homeassistant下要实现语音控制却非常麻烦，除了要安置诸如天猫精灵之类的接入设备，后台的设置也不简单，于是我一番摸索之后想到用手机自带的语音助手实现操控Homeassistant来执行动作。这么一来只需要一台旧手机（<strong>无论什么品牌，甚至没有自带语音助手都行</strong>）作为语音接入就能对智能家居进行控制，连天猫精灵、小米蓝牙音箱都省了。但是，需要通过语音助手实现的每一条动作，我都必须单独创建一条自动化。</p><h2 style="margin-left:0px;">工作原理</h2><p style="margin-left:0px;">需要的工具：</p><ol><li>一部旧手机/平板。</li><li>FV悬浮球APP（免费）  或者  <a href="https://www.baidu.com/link?url=FboR5FtHMahInZanVpio2H8OLFTDV7hCzjy76prb3mfg4B_C2n9c6n3QNqYoMbsCSu3iawkUtIw1W5P48hR_FK" target="_blank">通知滤盒</a>APP（付费）</li><li>一台安装了Homeassistant的设备。（只要你会折腾甚至连Homeassistant也可以一同装在旧手机中）</li></ol><p style="margin-left:0px;">执行步骤：</p><ol><li>Homeassistant中预先创建自动化，触发条件设置为webhook</li><li>手机通过语音助手识别我的语音命令</li><li>根据我的语音命令创建一条通知</li><li>通过FV悬浮球的自动任务（或者通知滤盒）获取该通知</li><li>通过FV悬浮球的自动任务（或者通知滤盒）根据通知内容发送对应http请求到Homeassistant</li><li>Homeassistant收到发送的请求，并执行对应自动化。</li></ol><p>如果你是用的是IOS设备，那只需要用Homeassistant安装Home Bridge 插件，就能接入 HomeKit用siri来控制智能家居了。另外IOS的捷径可以直接进行SSH连接安装了Homeassistant的设备执行shell命令。通过shell命令，不仅可以实现远程唤醒/关机之类的操作，甚至也可以执行curl命令来发送http请求给任意设备。这里就不展开讲了，有需要的可以在评论区留言。</p><h2>操作步骤</h2><p>Homeassistant平台的安装，以及如何将米家设备接入，我这里就直接略过了，网上有很多简单的教程。直接进入正题，这里直接以这个Gousund智能插座为例（我的备注是床头灯）来操作。Gousund智能插座接入Homeassistant平台后，可以直接从网页端控制。</p><figure class="image ss-img-wrapper image_resized" style="width:720px;"><img src="https://cdn.sspai.com/2022/01/15/article/6ac0125d6ca47bdb1ff1bfacd49533fb?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2022/01/15/article/6ac0125d6ca47bdb1ff1bfacd49533fb" referrerpolicy="no-referrer"></figure><h3 style="margin-left:0px;">Homeassistant中创建自动化</h3><p style="margin-left:0px;">Homeassistant中可以自行创建自动化项目，配置触发条件（比如时间、温度、地点等等）及执行动作（比如开关灯具、空调等等）。这样当条件满足时，执行动作就会自己执行，也就是if  then。而这个项目以webhook（收到对应的http请求）作为触发条件来执行自定义的动作。创建自动化的方法如下：</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/01/18/7f001d9e457e04ae20236183118fe756.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/01/18/7f001d9e457e04ae20236183118fe756.png" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">自动化的名称可以随便写，然后触发条件我选择webhook，webhook ID我就填入chuangtoudeng(记住这个 webhook ID 后面要用)，动作就是切换床头灯开关。这条自动化的含义就是：当Homeassistant接受到正确的http请求后就会执行切换智能插座开关状态的动作。</p><p style="margin-left:0px;">注意：Homeassistant的webhook触发只支持post请求，所以请求方式必须选择post，而请求的内容是：<code>http://[Homeassistant的ip地址]:[部署Homeassistant的端口号]/api/webhook/[webhook ID]</code></p><figure class="image ss-img-wrapper image_resized" style="width:347px;"><img src="https://cdn.sspai.com/2022/01/18/c741ec12de79cca34aff26f9664442ee.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/01/18/c741ec12de79cca34aff26f9664442ee.png" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">关于http请求的具体的使用方法后文会有详细介绍，到这里Homeassistant端设置完成，接下去是手机端配置。</p><h3 style="margin-left:0px;">语音助手配置</h3><p style="margin-left:0px;">语音助手在这项目用到的功能就是根据我说出的语音创建对应的通知。这里以华为平板为例（非华为系手机操作方法见后文）：打开智慧生活APP，在场景中添加一条：</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/01/18/86c205cd3df4d6903af46992220d8bc4.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/01/18/86c205cd3df4d6903af46992220d8bc4.png" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">如此，当我呼出语音助手，对小艺说：<code>打开床头灯</code>，系统会自动创建一条通知，内容就是：<code>打开床头灯</code>。</p><p style="margin-left:0px;">因为手上没有那么多其他品牌手机，这里只能简单介绍一下非华为系手机的解决方案：</p><p style="margin-left:0px;">三星：在三星手机上，打开bixby日常，添加一条，<code>如果</code>里就选手动启动，<code>则</code>里面就设置创建通知。</p><figure class="image ss-img-wrapper image_resized" style="width:720px;"><img src="https://cdn.sspai.com/2022/01/15/article/a72a14907e77b1a7c7a7b31426b76f84?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2022/01/15/article/a72a14907e77b1a7c7a7b31426b76f84" referrerpolicy="no-referrer"></figure><p>然后再到bixby里面添加一条语音命令来调用，内容就写开始XXX日常程序，对应上面日常里的名称。（我这里也是用的网图，我自己的S9无法更新到one ui3.X 没法这样操作）</p><figure class="image ss-img-wrapper image_resized" style="width:222px;"><img src="https://cdn.sspai.com/2022/01/15/article/40d790f61ec520bc59e5b81c11f2bc68?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2022/01/15/article/40d790f61ec520bc59e5b81c11f2bc68" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">oppo：oppo平台下则是到小布指令里添加一个提醒，然后点到小布训练里面添加语音命令。</p><figure class="image ss-img-wrapper image_resized" style="width:239px;"><img src="https://cdn.sspai.com/2022/01/15/article/ab87dfe41e45db1a16cb4f3e4c71a181?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2022/01/15/article/ab87dfe41e45db1a16cb4f3e4c71a181" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">小米手机或者是根本没有自带语音助手的手机：首先，下载并安装小爱同学APP和米家APP。（小米还是比较良心的，无论你是不是小米手机，都可以安装小爱同学，只是非miui的手机功能上有所欠缺。）然后打开米家APP，并在米家APP的场景页中创建一条手动场景，执行动作就选择向手机发送通知。然后可以点开用小唉来控制页面，可以添加自己喜欢的语音命令。</p><figure class="image ss-img-wrapper image_resized" style="width:301px;"><img src="https://cdn.sspai.com/2022/01/18/f1f31eeeca058a6838df178899c78903.jpg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/01/18/f1f31eeeca058a6838df178899c78903.jpg" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">如此一来，在米家中手动点击任务或者用小爱同学都可以自动触发通知。</p><h3 style="margin-left:0px;">FV悬浮球APP / 通知滤盒APP  配置</h3><p style="margin-left:0px;">FV悬浮球/通知滤盒在这项目的功能就是当语音助手创建通知后，自动获取通知，并根据通知内容发送对应的http请求给到Homeassistant。这里先介绍FV悬浮球：</p><p style="margin-left:0px;">打开fv悬浮球，创建一条自动任务：</p><figure class="image ss-img-wrapper image_resized" style="width:720px;"><img src="https://cdn.sspai.com/2022/01/15/article/a168dd2dcd507cf30743504666226dcd?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2022/01/15/article/a168dd2dcd507cf30743504666226dcd" referrerpolicy="no-referrer"></figure><figure class="image ss-img-wrapper image_resized" style="width:720px;"><img src="https://cdn.sspai.com/2022/01/15/article/be635516408f93396ec069def2246c4a?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2022/01/15/article/be635516408f93396ec069def2246c4a" referrerpolicy="no-referrer"></figure><figure class="image ss-img-wrapper image_resized" style="width:720px;"><img src="https://cdn.sspai.com/2022/01/15/article/f192eea801dc9a0a658d7b25895f1f87?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2022/01/15/article/f192eea801dc9a0a658d7b25895f1f87" referrerpolicy="no-referrer"></figure><p>注意:如果用的不是华为系手机，这里需要选择对应发出通知的APP，比如三星就是bixby相关的app，如果不确定具体是那个，可以勾选多个。</p><figure class="image ss-img-wrapper image_resized" style="width:720px;"><img src="https://cdn.sspai.com/2022/01/15/article/6f712da98fea827e02a6382c4ccc9a06?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2022/01/15/article/6f712da98fea827e02a6382c4ccc9a06" referrerpolicy="no-referrer"></figure><p>创建好触发条件后，下面是执行的任务内容:</p><figure class="image ss-img-wrapper image_resized" style="width:720px;"><img src="https://cdn.sspai.com/2022/01/15/article/90af3527fe84e35145994bc515faa656?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2022/01/15/article/90af3527fe84e35145994bc515faa656" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">03是获取通知的标题（通知的标题参数是：android.title），04是获取通知的内容（通知的内容参数是：android.text）。05是将04获取的通知内容作为参数传递给子任务《任务识别》。（有一些语音助手创建的通知内容会在标题里，有的则是放在内容里，这里需要根据不同情况选择将03还是04作为参数传递到子任务。比如米家APP就非常奇葩，通过米家APP场景生成的通知内容，之前是在通知的标题里，7.0版本开始变成在通知的内容里了。。。。）</p><p style="margin-left:0px;">然后创建子任务《任务识别》</p><figure class="image ss-img-wrapper image_resized" style="width:720px;"><img src="https://cdn.sspai.com/2022/01/15/article/053977c621a9cb787f04a1346244ade9?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt data-original="https://cdn.sspai.com/2022/01/15/article/053977c621a9cb787f04a1346244ade9" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">任务中创建一个分支，内容为获取外部分享到任务的内容（也就是获取主任务传递过来的参数），然后分支1设置成打开床头灯，动作为执行http请求，请求方式为post。这样只要主任务传递过来的参数是“打开床头灯”（和分支的内容相同1），那就执行动作http请求，将http请求发送给homeassistant。注意：Homeassistant的webhook触发只支持post请求，所以请求方式必须选择post，而请求的内容是：<code>http://[Homeassistant的ip地址]:[部署Homeassistant的端口号]/api/webhook/[webhook ID]</code><br><br>这里的webhook ID 就是之前Homeassistant配置中自己填写的。这样只要当我对语音助手说出"打开床头灯" 语音助手就会创建一条通知,内容为"打开床头灯" FV悬浮球自动任务获取该通知后就会进行http请求,触发Homeassistant的自动化来打开智能插座了。至于其他任何想用语音助手执行的动作，只要对应添加好：1、Homeassistant里的自动化2、语音助手的通知动作3、fv自动任务中第二个子任务中添加一个分支。就可以了。</p><p> </p><p>通知滤盒APP 配置：</p><p style="margin-left:0px;">通知滤盒的设置就更为简单了，安装通知滤盒并配置好语音助手后，先对语音助手来一句：打开床头灯，再打开通知滤盒就能看到通知的相关信息：</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/01/18/6a3245a82568d4bb0ba6da6bd83686e8.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/01/18/6a3245a82568d4bb0ba6da6bd83686e8.png" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">然后退出，手动添加规则，这里点到增强页面，就可以添加webhook相关规则：</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/01/18/a32dbbc96175919d21bfa51c3eb1c7e0.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/01/18/a32dbbc96175919d21bfa51c3eb1c7e0.png" referrerpolicy="no-referrer"></figure><p style="margin-left:0px;">这里默认就是post方法发送HTTP请求，然后URL这里一样填写：<code>http://[Homeassistant的ip地址]:[部署Homeassistant的端口号]/api/webhook/[webhook ID]</code></p><h2 style="margin-left:0px;">最后，米家不香么？为什么非要用到Homeassistant？</h2><p style="margin-left:0px;">看到这里其实很多人已经发现，如果家里买的都是支持米家的产品，大部分动作只要通过小米蓝牙音箱+米家app就都能实现，那为啥我要弄这么复杂呢？</p><ol><li>通过这个方案，我连小米蓝牙音箱都能省了。。。。一部旧手机就能替代。</li><li>我不想被小米捆绑，通过这个方案，只要能接入homeassistant的，我都可以控制，无需考虑是否兼容米家app。</li><li>通过Homeassistant弥补米家app自身一些不足，这也是最主要的原因。我自己就遇到米家场景中间隔1秒的动作执行有问题的情况：家里爸妈一直要看iptv，而电信给的iptv机顶盒只能用红外遥控器控制，我想用语音控制小米的万能红外遥控器来调频道，于是红外对码完成后，在米家的场景中设置执行动作按下频道1》间隔1秒》按下频道0》间隔一秒》按下频道7(对应频道107)。实际执行的时候就经常变成170,或者先按10,等频道都跳转了才按7。而不设间隔时间，顺序就会乱，间隔2秒就又太长，怎么试都没用。最后我把小米红外遥控器接入了Homeassistant，Homeassistant自动化中的间隔1秒执行非常准确，一次都没翻过车。</li><li>Homeassistant的功能更多，让我可以制定更多自定义自动任务。比如通过webhook触发动作执行shell命令来远程唤醒/关机等等。</li></ol></div><div class="update-details-wrap" data-v-d534f82e></div><!----></div><div style="border:1px solid transparent;" data-v-d534f82e></div><div class="article-side sideTop" style="display:none;left:0;" data-v-7be936cf data-v-d534f82e><div class="download-guide-container" data-v-14f9065e data-v-7be936cf><div class="btn-wrapper" data-v-14f9065e><!----><button class="btn btn-view" data-v-14f9065e><i class="iconfont iconfont-phone" data-v-14f9065e></i></button></div><a href="https://sspai.com/s/JYjP" target="_blank" data-v-14f9065e><!----></a></div><div class="item-wrapper" data-v-7be936cf><button class="btn btn-charge" data-v-7be936cf><i class="iconfont" data-v-7be936cf></i></button><span class="count" data-v-7be936cf>5</span></div><div class="item-wrapper" data-v-7be936cf><button class="btn-mini btn-comment" data-v-7be936cf><i class="iconfont iconfont-comment" data-v-7be936cf></i></button><span class="count" data-v-7be936cf>0</span></div><div class="item-wrapper" data-v-7be936cf><span data-v-7be936cf><div role="tooltip" id="el-popover-5356" aria-hidden="true" class="el-popover el-popper popper-share right ss-popper-dark-border" style="width:undefinedpx;display:none;"><!----><div class="article-side-share-btn"><a href="https://service.weibo.com/share/share.php?url=null?ref=weibo&title=%E3%80%90%E7%AE%80%E5%8D%95%E4%B8%80%E6%8B%9B%E8%AE%A9%E5%B0%8F%E7%88%B1%E5%90%8C%E5%AD%A6%20%E5%B0%8F%E8%89%BA%20%E5%B0%8F%E5%B8%83%20Bixby%E8%B0%83%E7%94%A8Homeassistant%E6%8E%A7%E5%88%B6%E6%99%BA%E8%83%BD%E5%AE%B6%E5%B1%85%E3%80%91%E5%A6%82%E4%BB%8A%2C%E6%99%BA%E8%83%BD%E5%AE%B6%E5%B1%85%E7%BB%99%E6%88%91%E4%BB%AC%E7%9A%84%E7%94%9F%E6%B4%BB%E5%B8%A6%E6%9D%A5%E4%BA%86%E5%BE%88%E5%A4%9A%E4%BE%BF%E5%88%A9%EF%BC%8C%E5%AF%B9%E6%88%91%E6%9D%A5%E8%AF%B4%E5%AE%8C%E5%85%A8%E6%98%AF%E4%B8%8D%E7%94%A8%E4%B8%8D%E7%9F%A5%E9%81%93%EF%BC%8C%E4%B8%80%E7%94%A8%E5%9B%9E%E4%B8%8D%E5%8E%BB%E7%9A%84%E4%BA%A7%E5%93%81%EF%BC%8C%E4%B8%8D%E5%B0%91%E5%AE%B6%E7%94%B5%E7%9A%84%E6%93%8D%E6%8E%A7%E6%88%91%E7%8E%B0%E5%9C%A8%E9%83%BD%E6%98%AF%E7%94%A8%E5%98%B4%E5%AE%8C%E6%88%90%E6%88%96%E8%80%85%E6%98%AF%E8%AE%BE%E7%BD%AE%E6%9D%A1%E4%BB%B6%E8%87%AA%E5%8A%A8%E5%8C%96%E6%89%A7%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&pic=https%3A%2F%2Fcdn.sspai.com%2F2022%2F01%2F15%2Fa3971b3d2b034fab1432fe677108e7a8.jpeg%3FimageMogr2%2Fauto-orient%2Fquality%2F95%2Fthumbnail%2F!1420x708r%2Fgravity%2FCenter%2Fcrop%2F1420x708%2Finterlace%2F1&appkey=3196502474#" target="_blank"><i class="iconfont iconfont-weibo-simple right-16"></i></a><span><div role="tooltip" id="el-popover-6808" aria-hidden="true" class="el-popover el-popper" style="width:undefinedpx;display:none;"><!----><div style="text-align:center;"><div id="qr-code"></div><small class="qr-small">扫码分享</small></div></div><span class="el-popover__reference-wrapper"><i class="iconfont iconfont-wechat-simple right-16"></i></span></span><a href="https://twitter.com/share?text=%E3%80%90%E7%AE%80%E5%8D%95%E4%B8%80%E6%8B%9B%E8%AE%A9%E5%B0%8F%E7%88%B1%E5%90%8C%E5%AD%A6%20%E5%B0%8F%E8%89%BA%20%E5%B0%8F%E5%B8%83%20Bixby%E8%B0%83%E7%94%A8Homeassistant%E6%8E%A7%E5%88%B6%E6%99%BA%E8%83%BD%E5%AE%B6%E5%B1%85%E3%80%91%E5%A6%82%E4%BB%8A%2C%E6%99%BA%E8%83%BD%E5%AE%B6%E5%B1%85%E7%BB%99%E6%88%91%E4%BB%AC%E7%9A%84%E7%94%9F%E6%B4%BB%E5%B8%A6%E6%9D%A5%E4%BA%86%E5%BE%88%E5%A4%9A%E4%BE%BF%E5%88%A9%EF%BC%8C%E5%AF%B9%E6%88%91%E6%9D%A5%E8%AF%B4%E5%AE%8C%E5%85%A8%E6%98%AF%E4%B8%8D%E7%94%A8%E4%B8%8D%E7%9F%A5%E9%81%93%EF%BC%8C%E4%B8%80%E7%94%A8%E5%9B%9E%E4%B8%8D%E5%8E%BB%E7%9A%84%E4%BA%A7%E5%93%81%EF%BC%8C%E4%B8%8D%E5%B0%91%E5%AE%B6%E7%94%B5%E7%9A%84%E6%93%8D%E6%8E%A7%E6%88%91%E7%8E%B0%E5%9C%A8%E9%83%BD%E6%98%AF%E7%94%A8%E5%98%B4%E5%AE%8C%E6%88%90%E6%88%96%E8%80%85%E6%98%AF%E8%AE%BE%E7%BD%AE%E6%9D%A1%E4%BB%B6%E8%87%AA%E5%8A%A8%E5%8C%96%E6%89%A7%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&url=null" target="_blank" class="twitter"><i class="iconfont iconfont-twitter-simple right-16"></i></a></div></div><span class="el-popover__reference-wrapper"><button class="btn-mini btn-share" data-v-7be936cf><i class="iconfont iconfont-share" data-v-7be936cf></i></button></span></span></div><div class="item-wrapper" data-v-7be936cf><button class="btn-mini btn-collect" data-v-7be936cf><i class="iconfont iconfont-collect" data-v-7be936cf></i></button></div><!----></div><!---->  
</div>
            