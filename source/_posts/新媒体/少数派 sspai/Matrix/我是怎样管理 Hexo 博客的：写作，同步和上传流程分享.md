
---
title: '我是怎样管理 Hexo 博客的：写作，同步和上传流程分享'
categories: 
 - 新媒体
 - 少数派 sspai
 - Matrix
headimg: 'https://cdn.sspai.com/2021/11/04/article/d52c67dee251b97acfb7b5e867ccc8be?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
author: 少数派 sspai
comments: false
date: Wed, 03 Nov 2021 17:10:54 GMT
thumbnail: 'https://cdn.sspai.com/2021/11/04/article/d52c67dee251b97acfb7b5e867ccc8be?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
---

<div>   
<div class="articleWidth-content" data-v-6f469055><div class="content wangEditor-txt minHeight" data-v-6f469055><p>再微小的事情只要被不断地重复，终有一天会成就颇为可观的成果。拖沓懒散如我，从 2017 年底放弃 CMS 转投静态网页生成工具 Hexo 以来，小小的博客至今已有百余篇、数十万字的规模。</p><p>Hexo 在这四年中也像其他所有工具一样改造使用者习惯的同时被使用者改造。Hexo 教会了我使用 Markdown，图床，CDN，我则利用 PowerShell 脚本等工具，以 Hexo 为中心逐步构建了一个适合自己的博客写作流程 —— 一个拥有良好的写作体验，数据完全可迁移，部署和访问方便的私人化写作流。</p><h2>「一站式」编辑器</h2><p>传统的 CMS 之所以如此受欢迎，原因之一在于它们提供了新建 - 写作 - 发布三阶段无缝集成的优良体验，用户在一个管理面板上即可完成从后台管理到前端呈现所有的操作。但 Hexo 不行，用户至少需要使用终端、代码编辑器和 Markdown 写作软件三种工具，才能完成站点的编辑以及新建 - 写作 - 发布等流程。</p><p>想要拥有良好的写作体验，不再奔波于终端和编辑器之间，Hexo 需要一个「一站式」编辑器。</p><p>VScode 是候选人之一：它可以在界面中唤起终端，运行自定义命令，借助 Markdown 插件其编辑体验也差强人意。但我的目的是输出文字，输出需要有输入，我的博客内容大多来自于自己的笔记，因此，这个「一站式」编辑器更合适的选择是我正在使用的笔记软件：Obsidian。</p><p>作为知识管理软件，组织和帮助用户输出内容 Obsidian 自然不在话下，而 CodeMirror 等插件则可以让它的 Markdown 编辑体验媲美 Typora。只剩下一个核心问题：如何让 Obsidian 的条目成为 Hexo 博客？答案是硬链接，首先获取正在编辑的 Obsidian 条目的文件路径，再使用计数的方式为 Hexo 的新博客命名，最后使用 New-Item -Type 的方式两者创建硬链接。</p><p>Obsidian 支持 URI 调用，并且能直接复制当前条目的 URI 地址，借助 .NET 的 HTTP Decode 功能，我们就能从 URI 中得到文件路径。生成博客的 PowerShell 脚本 <code>AutoLink-Blog.ps1</code> 核心命令如下。完整版本参考此 <a href="https://gist.github.com/irtle/d2afd58e1cd45a52299b3d18e7f80fa4" target="_blank">gist</a> 条目。</p><pre class="language-shell"><code>[String]$v = get-clipboard -raw # 获取剪贴板

if( $v.Indexof('obsidian://') -eq 0)&#123; # 简单判断文本是否符合要求
    $v = [System.Web.HttpUtility]::UrlDecode($v.Substring(32)) # Decode
    $Source = "$home/Documents/Note/" + "$v" + ".md" 
    $count = (Get-ChildItem -Path $env:Hexo/source/_posts).Length # 计数
    New-Item "$env:Hexo/source/_posts/$count.md" -Type HardLink -Target "$Source" # 生成硬链接</code></pre><p>PowerShell 脚本我习惯使用常驻的 AHK 触发：</p><pre class="language-ahk"><code>; 当按下 Win + Alt + L 时，使用 Powershell 7 不加载配置文件和 Logo 隐藏窗口执行脚本
#!L::
run,pwsh -nop -nologo -file "%USERPROFILE%\Program\AutoLink-Blog.ps1",,hide
return</code></pre><p>依靠这两个小脚本，每当想要写作博客时，我并不用打开终端，而是打开 Obsidian，借助模板新建一篇文章，然后按<code>Ctrl + Shift + C</code>复制此文章的 URI，再按<code>Win + Alt + L</code>，一篇笔记兼博客就创建完成了。</p><figure class="image ss-img-wrapper image_resized" style="width:546px;"><img src="https://cdn.sspai.com/2021/11/04/article/d52c67dee251b97acfb7b5e867ccc8be?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/11/04/article/d52c67dee251b97acfb7b5e867ccc8be" referrerpolicy="no-referrer"></figure><h2>兼容、可迁移的数据</h2><p>摆脱知乎、微信公众号等平台各种无端限制是我自建博客很重要的动机。但我亦明白自由是一把双刃剑 —— Hexo 博客依靠插件能渲染各种各样格式，拥有一些诸如摘要、插入附件等特殊标记，不少主题也以此作为自己的主打功能，而其代价是除了 Hexo，没有其他任何程序读得懂这些标记，不兼容，以后也难以迁移。</p><p>自由的界限由不同主体之间的冲突与妥协划定，利用 Hexo 写作的格式自由则需要遵从「兼容和可迁移」的原则。因此我进行了三项调整：统一 Markdown 格式，使用图床和用 Git 管理。</p><p>前一节已经提到，我使用 Obsidian 作为 Hexo 博客的新建和写作软件，因此于我而言，首要须保证这两个平台 Markdown 格式的统一，兼顾移动端 GitJournal，网页端 GitHub 等处的格式要求。我的具体写作习惯如下：</p><ol><li>绝不使用 Hexo、Obsidian 等平台的独占格式。例如不在文章中使用 Hexo 的本地图片插入语法或 Obsidian 插件所提供的图表语法；</li><li>保持 Markdown 元数据的一致。这一点只需要在 Hexo 的 <code>_config.yml</code> 和 Obsidian 的模板文件夹中稍加配置；</li><li>不使用一级标题：尽管 Obsidian 有使用一级标题作为条目名的使用方式，但 Hexo 官方的文档不建议使用一级标题，这在一些主题上不能正确渲染。</li></ol><p>除了文字部分，图片亦是博客或笔记中的重要角色。于本地图片而言，Hexo 和 Obsidian 插入语法是完全不同并且互不兼容的。在线图床是解决这个问题的最佳选择。我的选择是购买国内厂商的对象存储服务，并绑定的自定义域名。这至少有两个好处：</p><ol><li>访问体验非常优秀，远比公共图床稳定快速；</li><li>方便迁移：不仅指博客数据的迁移，当我从腾讯云将图片搬到七牛云时，由于采用了自定义域名，我的博客文章不需要任何改动。</li></ol><p>不过，在线的服务很难给人以安全感，定期将图片从对象存储上备份到本地可以稍微缓解这种焦虑。备份的方式是厂商给开发者提供的终端工具，例如我利用七牛云提供的 Qshell 工具，写了如下脚本定期取回我的图片以备不测：</p><pre class="language-shell"><code>$var = Read-Host 'Enter 1 ……'
if($var -eq 1)&#123;
    qshell.exe qdownload -c 2 $home\.qshell\dl.conf
&#125;else&#123;
    exit
&#125;
exit</code></pre><p>没有了本地图片这种大文件的压力，使用 Git 管理 Hexo 博客就非常合适了。更何况，Hexo 本身就是一个 Nodejs 项目，Git「专业对口」。将 Hexo 库转换为 Git 库，并创建<code>.gitignore</code>如下：</p><pre class="language-shell"><code>/node_modules
/public
desktop.ini
db.json
debug.*
/git
icon.ico
# /themes</code></pre><p>将此项目和远程库同步，我得到了 Hexo、Obsidian 外的第三个写作平台，GitHub。我可以直接在 GitHub 网页端编辑我的文件，需要在本地编辑时，提前使用插件用快捷键<code>git pull</code>一下即可。 Git 也完美地满足了博客可迁移的要求，无论是 Windows、Linux 还是在线的托管平台，拉取远程库，再<code>yarn</code>一遍，一切环境就恢复如初。</p><h2>发布与部署</h2><p>Hexo 相较于 WordPress 等平台的好处是其灵活方便，成本低廉，生成的静态页面有大把的免费途径托管。这些免费的途径有一个共同特点：在国内访问体验差。例如，很多人使用的 GitHub Pages 在我的网络环境下时常处于断线状态，它们无法满足我发布和部署的需要。</p><p>不过，作用力往往伴随反作用力，以上的情况反过来也成立：国内的一些服务在境外的网络环境下也常常处于断线状态。因而我决定在大陆内外各选择一个服务托管我的博客。</p><p>国内我选择了一些云厂商提供的对象存储 + CDN 服务。静态网页也是文件，上传这些网页到对象存储，配上自定义域名，就是一个访问体验极好的博客平台了。腾讯阿里也为这种用途单独设置了一些开关，甚至把这个功能单独包装成产品拿出来卖，其配置都很简单。唯一需要等待的是域名备案，我将域名备案理解成汽车上路前的驾驶证和行驶证，不光是博客，很多问题在拥有了备案的域名后都变得简单，因而我早早进行了备案操作。</p><p>国外我则选择了 Cloudflare Pages，因为我的域名恰恰在 Cloudflare 上，所以当它们推出这项服务时，我很开心地迁移了过去。</p><p>同样，发布和部署亦由脚本完成。Cloudflare 是通过拉取 GitHub 项目，然后执行<code>yarn run bulid</code>的方式生成网页并自动部署，因此我只要提交 Git Commit 即可。而国内这边，尽管有 GitHub Action 可供采用，但我仍选择了将生成工作放在本地，毕竟本地计算比 GitHub Action 的速度可快多了，上传则通过服务商提供的终端工具。两边还能借助<code>hexo --config</code>命令的方式生成不一样的博客界面。脚本核心命令如下：</p><pre class="language-shell"><code>Set-Location $home/Hexo
hexo clean
hexo g --config ./china.yml
if (test-path $env:Hexo\public\index.html)&#123;
Set-Location $home/Hexo/public
tcb hosting deploy -e blog-xxxxxxxxxxxx
Set-Location $home/Hexo
git add .
git commit -m "$count $date"
git push -q
&#125;</code></pre><p>和第一节一样的道理，可以利用 AHK 将快捷键绑定到此脚本上。</p><h2><strong>总结</strong></h2><p>需求总是不停地冒出来，值不值得花时间去探求实现的方法需要结合个人的情况做决断，但原则是不要舍本逐末。这套由 PowerShell 脚本串联起各个工具的方案并不完美，我有很多很多的想法没有实现，例如我非常想让 Hexo 能正确渲染<code>[[</code>，因为这是我 Obsidian 中最常见也最不能舍弃的一个符号，但当了解到这个想法实现超出了我的能力，可能花去我写好几篇博客的时间时，我也只好退一步默默接受了。</p><p>封面：<a href="http://www.freepik.com/">Designed by slidesgo / Freepik</a></p></div><!----></div><div style="border:1px solid transparent;" data-v-6f469055></div><div class="article-side sideTop" style="display:none;left:0;" data-v-7be936cf data-v-6f469055><div class="download-guide-container" data-v-14f9065e data-v-7be936cf><div class="btn-wrapper" data-v-14f9065e><!----><button class="btn btn-view" data-v-14f9065e><i class="iconfont iconfont-phone" data-v-14f9065e></i></button></div><a href="https://sspai.com/s/JYjP" target="_blank" data-v-14f9065e><!----></a></div><div class="item-wrapper" data-v-7be936cf><button class="btn btn-charge" data-v-7be936cf><i class="iconfont" data-v-7be936cf></i></button><span class="count" data-v-7be936cf>6</span></div><div class="item-wrapper" data-v-7be936cf><button class="btn-mini btn-comment" data-v-7be936cf><i class="iconfont iconfont-comment" data-v-7be936cf></i></button><span class="count" data-v-7be936cf>0</span></div><div class="item-wrapper" data-v-7be936cf><span data-v-7be936cf><div role="tooltip" id="el-popover-7013" aria-hidden="true" class="el-popover el-popper popper-share right ss-popper-dark-border" style="width:undefinedpx;display:none;"><!----><div class="article-side-share-btn"><a href="https://service.weibo.com/share/share.php?url=null?ref=weibo&title=%E3%80%90%E6%88%91%E6%98%AF%E6%80%8E%E6%A0%B7%E7%AE%A1%E7%90%86%20Hexo%20%E5%8D%9A%E5%AE%A2%E7%9A%84%EF%BC%9A%E5%86%99%E4%BD%9C%EF%BC%8C%E5%90%8C%E6%AD%A5%E5%92%8C%E4%B8%8A%E4%BC%A0%E6%B5%81%E7%A8%8B%E5%88%86%E4%BA%AB%E3%80%91%E5%86%8D%E5%BE%AE%E5%B0%8F%E7%9A%84%E4%BA%8B%E6%83%85%E5%8F%AA%E8%A6%81%E8%A2%AB%E4%B8%8D%E6%96%AD%E5%9C%B0%E9%87%8D%E5%A4%8D%EF%BC%8C%E7%BB%88%E6%9C%89%E4%B8%80%E5%A4%A9%E4%BC%9A%E6%88%90%E5%B0%B1%E9%A2%87%E4%B8%BA%E5%8F%AF%E8%A7%82%E7%9A%84%E6%88%90%E6%9E%9C%E3%80%82%E6%8B%96%E6%B2%93%E6%87%92%E6%95%A3%E5%A6%82%E6%88%91%EF%BC%8C%E4%BB%8E2017%E5%B9%B4%E5%BA%95%E6%94%BE%E5%BC%83CMS%E8%BD%AC%E6%8A%95%E9%9D%99%E6%80%81%E7%BD%91%E9%A1%B5%E7%94%9F%E6%88%90%E5%B7%A5%E5%85%B7Hexo%E4%BB%A5%E6%9D%A5%EF%BC%8C%E5%B0%8F%E5%B0%8F%E7%9A%84%E5%8D%9A%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&pic=https%3A%2F%2Fcdn.sspai.com%2F2021%2F11%2F04%2Faa6c98835a4fd93587e7386eb580c910.png%3FimageMogr2%2Fauto-orient%2Fquality%2F95%2Fthumbnail%2F!1420x708r%2Fgravity%2FCenter%2Fcrop%2F1420x708%2Finterlace%2F1&appkey=3196502474#" target="_blank"><i class="iconfont iconfont-weibo-simple right-16"></i></a><span><div role="tooltip" id="el-popover-1682" aria-hidden="true" class="el-popover el-popper" style="width:undefinedpx;display:none;"><!----><div style="text-align:center;"><div id="qr-code"></div><small class="qr-small">扫码分享</small></div></div><span class="el-popover__reference-wrapper"><i class="iconfont iconfont-wechat-simple right-16"></i></span></span><a href="https://twitter.com/share?text=%E3%80%90%E6%88%91%E6%98%AF%E6%80%8E%E6%A0%B7%E7%AE%A1%E7%90%86%20Hexo%20%E5%8D%9A%E5%AE%A2%E7%9A%84%EF%BC%9A%E5%86%99%E4%BD%9C%EF%BC%8C%E5%90%8C%E6%AD%A5%E5%92%8C%E4%B8%8A%E4%BC%A0%E6%B5%81%E7%A8%8B%E5%88%86%E4%BA%AB%E3%80%91%E5%86%8D%E5%BE%AE%E5%B0%8F%E7%9A%84%E4%BA%8B%E6%83%85%E5%8F%AA%E8%A6%81%E8%A2%AB%E4%B8%8D%E6%96%AD%E5%9C%B0%E9%87%8D%E5%A4%8D%EF%BC%8C%E7%BB%88%E6%9C%89%E4%B8%80%E5%A4%A9%E4%BC%9A%E6%88%90%E5%B0%B1%E9%A2%87%E4%B8%BA%E5%8F%AF%E8%A7%82%E7%9A%84%E6%88%90%E6%9E%9C%E3%80%82%E6%8B%96%E6%B2%93%E6%87%92%E6%95%A3%E5%A6%82%E6%88%91%EF%BC%8C%E4%BB%8E2017%E5%B9%B4%E5%BA%95%E6%94%BE%E5%BC%83CMS%E8%BD%AC%E6%8A%95%E9%9D%99%E6%80%81%E7%BD%91%E9%A1%B5%E7%94%9F%E6%88%90%E5%B7%A5%E5%85%B7Hexo%E4%BB%A5%E6%9D%A5%EF%BC%8C%E5%B0%8F%E5%B0%8F%E7%9A%84%E5%8D%9A%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&url=null" target="_blank" class="twitter"><i class="iconfont iconfont-twitter-simple right-16"></i></a></div></div><span class="el-popover__reference-wrapper"><button class="btn-mini btn-share" data-v-7be936cf><i class="iconfont iconfont-share" data-v-7be936cf></i></button></span></span></div><div class="item-wrapper" data-v-7be936cf><button class="btn-mini btn-collect" data-v-7be936cf><i class="iconfont iconfont-collect" data-v-7be936cf></i></button></div><!----></div><!---->  
</div>
            