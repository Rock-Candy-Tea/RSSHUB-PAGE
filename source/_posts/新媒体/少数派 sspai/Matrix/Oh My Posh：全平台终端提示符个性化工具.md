
---
title: 'Oh My Posh：全平台终端提示符个性化工具'
categories: 
 - 新媒体
 - 少数派 sspai
 - Matrix
headimg: 'https://cdn.sspai.com/editor/u_/c678istb34tbn4uc73og.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
author: 少数派 sspai
comments: false
date: Fri, 12 Nov 2021 16:56:56 GMT
thumbnail: 'https://cdn.sspai.com/editor/u_/c678istb34tbn4uc73og.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
---

<div>   
<div class="articleWidth-content" data-v-6f469055><div class="content wangEditor-txt minHeight" data-v-6f469055><p>和终端打过交道的读者应该对每次输入命令前都会出现的提示符（Prompt）不陌生，它们可以承载诸如当前位置、用户名等有用的信息。不管是出于美观还是实用的目的，自定义提示符都能给终端那枯燥的黑白界面添一抹色彩。</p><p>本文的主角 Oh my posh 正是这样一款终端 Prompt 个性化工具，虽然肇始于同类工具 Oh My Zsh，但当更新到 5.0 版本时，重新设计的 Oh my posh 已经摆脱平台的桎梏，支持了 Windows、GNU/Linux（WSL）、macOS 三个系统上的 PowerShell、bash、zsh 等终端。</p><p>下文将展示 Oh my posh 的效果，然后介绍它在不同系统和终端上的安装配置方式。</p><h2>效果</h2><p>Oh my posh 预置了数十款主题，项目官网有这些主题的 <a href="https://ohmyposh.dev/docs/themes" target="_blank">预览</a>。安装并配置好工具后，打开终端即可看到效果。其中既有以文字为主的简约主题，例如 wopian、material：</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/editor/u_/c678istb34tbn4uc73og.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/editor/u_/c678istb34tbn4uc73og.png" referrerpolicy="no-referrer"></figure><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/editor/u_/c678it5b34tbn7jiseag.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/editor/u_/c678it5b34tbn7jiseag.png" referrerpolicy="no-referrer"></figure><p>也有辅以彩色背景和字体的醒目主题，例如 jandedobbeleer 和 craver：</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/editor/u_/c678it5b34tbn7jiseb0.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/editor/u_/c678it5b34tbn7jiseb0.png" referrerpolicy="no-referrer"></figure><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/editor/u_/c678itdb34tbn1vv5e10.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/editor/u_/c678itdb34tbn1vv5e10.png" referrerpolicy="no-referrer"></figure><p>若不满意现有的主题，工具也支持加载自定义主题，其语法相较于 PowerShell 等终端默认提供的语法要简单不少。而除了能讨好用户的视觉，Oh my posh 的一些主题增加的 Git 项目状态预览等信息也比较实用。</p><h2>安装</h2><p>主题多姿多彩并没有让 Oh my posh 的安装变得复杂。它在各个平台上的安装方式流程是大致一致的，分为三步：按需安装字体 > 安装 Oh my posh > 修改终端配置文件。</p><p>如果之前以 Module 的方式安装过低版本 Oh my posh（键入<code>Get-Module Oh*</code> 判断），笔者建议用<code>Uninstall-Module oh-my-posh</code>卸载模块，并按下面的方式重装。不采用升级的方式的理由会在后文提到。</p><h3>按需安装字体</h3><p>正如第一章中效果图展示的那样，部分 Oh my posh 主题有一些特殊的字符，例如表示系统类型的徽标、GitHub 标志，这些字符需要特殊的字体支持。如果读者看上了一款有这些字符的主题，必须提前下载安装合适的字体，并将它们设置为终端显示的字体。</p><p>这里推荐使用 <a href="https://www.nerdfonts.com/" target="_blank">Nerd Fonts</a> 系列字体，它们在支持各种特殊字符的同时，设计也比较养眼。访问 Nerd Fonts 的 <a href="https://www.nerdfonts.com/font-downloads" target="_blank">下载界面</a>，从中任意选择一个心仪的字体包，下载压缩包后解压，再安装进系统即可。笔者使用的是 Agave Nerd Font，Oh my posh 官方推荐 Meslo LGM NF。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/editor/u_/c678itlb34tbn4uc73p0.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/editor/u_/c678itlb34tbn4uc73p0.png" referrerpolicy="no-referrer"></figure><p>之后，在终端的设置界面中将显示字体设置为刚刚安装的 Nerd Fonts。以 Windows Terminal 为例，进入设置 > 配置文件 > 默认值 & 子配置文件 > 外观，设定字体为 Nerd Fonts。这一设置对 WSL 和远程主机都生效。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/editor/u_/c678itlb34tbnhlo57og.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/editor/u_/c678itlb34tbnhlo57og.png" referrerpolicy="no-referrer"></figure><h3>安装 Oh my posh</h3><p>目前版本的 Oh my posh 为了适配多平台，推出了新的安装方式，即首先安装 Oh my posh 程序，再利用此程序处理主题文件，这也意味着管理和升级它变得更加简单。因而相比于作为模块安装，笔者更推荐这种安装方式。</p><p>安装 Oh my posh 和安装其他程序没有什么不同，为了之后升级更加方便，笔者建议首先考虑各个平台的软件包管理程序：</p><ul><li>在 Windows 上任选其一，适用于 Windows 和 WSL：<ul><li><a href="https://scoop.sh/" target="_blank">Scoop</a>：<code>scoop install https://github.com/JanDeDobbeleer/oh-my-posh/releases/latest/download/oh-my-posh.json</code></li><li><a href="https://chocolatey.org/" target="_blank">Chocolatey</a>：<code>cinst oh-my-posh -y</code></li><li>Winget：<code>winget install JanDeDobbeleer.OhMyPosh</code></li></ul></li><li>macOS 使用 <a href="https://brew.sh/" target="_blank">Homebrew</a>：<code>brew tap jandedobbeleer/oh-my-posh && brew install oh-my-posh</code></li><li>GNU/Linux ：</li></ul><pre class="language-"><code># 这是安装程序
sudo wget https://github.com/JanDeDobbeleer/oh-my-posh/releases/latest/download/posh-linux-amd64 -O /usr/local/bin/oh-my-posh
sudo chmod +x /usr/local/bin/oh-my-posh
# 下载主题文件
mkdir ~/.poshthemes
wget https://github.com/JanDeDobbeleer/oh-my-posh/releases/latest/download/themes.zip -O ~/.poshthemes/themes.zip
unzip ~/.poshthemes/themes.zip -d ~/.poshthemes
chmod u+rw ~/.poshthemes/*.json
rm ~/.poshthemes/themes.zip</code></pre><p>如果不使用包管理程序，读者需要自行下载必要文件：进入项目的 <a href="https://github.com/JanDeDobbeleer/oh-my-posh/releases">Release</a> 界面，从最新的发布版本中下载适用于自己系统的文件以及包含主题的压缩包 <code>themes.zip</code>，解压到合适的位置。</p><h3>修改终端配置文件</h3><p>确定 Oh my posh 已经安装成功后，读者可以提前到项目官网的 <a href="https://ohmyposh.dev/docs/themes">主题页面</a> 预览内置主题的效果，记下需要使用的主题在本地的路径。以 wopian 主题为例，使用不同安装方式得到的主题路径参考下表：</p><figure class="table"><table><tbody><tr><td><strong>安装方式</strong></td><td><strong>路径</strong></td></tr><tr><td style="vertical-align:top;">Windows Scoop</td><td style="vertical-align:top;"><code>~\scoop\apps\oh-my-posh\current\themes\wopian.omp.json</code></td></tr><tr><td style="vertical-align:top;">Windows Choco/Winget</td><td style="vertical-align:top;"><code>~\AppData\Local\Programs\oh-my-posh\themes\wopian.omp.json</code></td></tr><tr><td style="vertical-align:top;">macOS Brew</td><td style="vertical-align:top;"><code>~/.poshthemes/wopian.omp.json</code></td></tr><tr><td style="vertical-align:top;">GNU/Linux 命令行</td><td style="vertical-align:top;"><code>~/.poshthemes/wopian.omp.json</code></td></tr><tr><td style="vertical-align:top;">自行下载</td><td style="vertical-align:top;">Oh my Posh 和 Themes 需要填完整的自定义路径</td></tr></tbody></table></figure><p>万事俱备，下面我们需要修改终端的配置文件。不同的终端配置文件位置不同。如果你不知道自己使用的是什么终端，可以键入<code>oh-my-posh --print-shell</code>获得答案。</p><p>三大系统上的 PowerShell 配置文件有内置的变量<code>$Profile</code>。键入<code>$Profile</code> 终端会显示配置文件的路径。编辑此文件，若没有，则新建一个。新增如下代码，重启终端就能看到效果。</p><pre class="language-"><code>oh-my-posh --init --shell pwsh --config 主题路径 | Invoke-Expression</code></pre><p>Bash 的配置文件一般是<code>~/.bashrc</code> 或者<code>~/.profile</code>，同上文一样，编辑对应的文件，若没有，则新建一个，新增下面一行代码并重启终端<sup class="ss-footnote" href title="若 Linux 终端重启后显示异常，请修改 $TERM 为 xterm-256color" footnote-id="1">1</sup>：</p><pre class="language-"><code>eval "$(oh-my-posh --init --shell bash --config 主题路径)"</code></pre><p>Zsh 的配置文件为<code>~/.zshrc</code>，需要新增的代码需要将<code>bash</code>改为<code>zsh</code>：</p><pre class="language-"><code>eval "$(oh-my-posh --init --shell zsh --config 主题路径)"</code></pre><p>在 Windows 的 Linux 子系统中使用 Oh my posh 无需像一般 GNU/Linux 那样另外安装，可以采用 <code>oh-my-posh-wsl</code>命令。需要注意，WSL 上同一文件的路径和 Windows 是不一样的，<code>c:/</code> 应该写成<code>/mnt/c/</code>，例如，WSL 上的 Ubuntu .bashrc 文件应该添加：</p><pre class="language-"><code>eval "$(oh-my-posh-wsl --init --shell bash --config /mnt/c/users/用户名/AppData/Local/Programs/oh-my-posh/themes/wopian.omp.json)"</code></pre><p>fish 和 nu 用户可以参阅 <a href="https://ohmyposh.dev/docs/linux">官方文档</a>。</p><h2>修改主题</h2><p>从上一章的最后一节给出的代码可以看出，更改主题只需要提供主题路径。我们自己写的主题也可以使用 Oh my posh 加载。它使用的主题文件格式为 JSON，对预置主题不满意的用户可以参考 <a href="https://ohmyposh.dev/docs/configure">配置文档</a> 修改或者重写主题。</p><p>具体语法本文不做展开，需要注意的是如果直接在预置主题基础上进行了修改，下一次程序更新会用官方的主题覆盖掉用户的修改文件。因此，保险的做法是将修改后的主题移动到系统的其他位置。</p><h2>参考资料</h2><ul><li>GitHub，<a href="https://github.com/jandedobbeleer/oh-my-posh">Oh my posh 项目地址</a></li><li>Ohmyposh.dev，<a href="https://ohmyposh.dev/docs/">官方文档 </a></li></ul></div><!----></div><div style="border:1px solid transparent;" data-v-6f469055></div><div class="article-side sideTop" style="display:none;left:0;" data-v-7be936cf data-v-6f469055><div class="download-guide-container" data-v-14f9065e data-v-7be936cf><div class="btn-wrapper" data-v-14f9065e><!----><button class="btn btn-view" data-v-14f9065e><i class="iconfont iconfont-phone" data-v-14f9065e></i></button></div><a href="https://sspai.com/s/JYjP" target="_blank" data-v-14f9065e><!----></a></div><div class="item-wrapper" data-v-7be936cf><button class="btn btn-charge" data-v-7be936cf><i class="iconfont" data-v-7be936cf></i></button><span class="count" data-v-7be936cf>8</span></div><div class="item-wrapper" data-v-7be936cf><button class="btn-mini btn-comment" data-v-7be936cf><i class="iconfont iconfont-comment" data-v-7be936cf></i></button><span class="count" data-v-7be936cf>5</span></div><div class="item-wrapper" data-v-7be936cf><span data-v-7be936cf><div role="tooltip" id="el-popover-6795" aria-hidden="true" class="el-popover el-popper popper-share right ss-popper-dark-border" style="width:undefinedpx;display:none;"><!----><div class="article-side-share-btn"><a href="https://service.weibo.com/share/share.php?url=null?ref=weibo&title=%E3%80%90Oh%20My%20Posh%EF%BC%9A%E5%85%A8%E5%B9%B3%E5%8F%B0%E7%BB%88%E7%AB%AF%E6%8F%90%E7%A4%BA%E7%AC%A6%E4%B8%AA%E6%80%A7%E5%8C%96%E5%B7%A5%E5%85%B7%E3%80%91%E5%92%8C%E7%BB%88%E7%AB%AF%E6%89%93%E8%BF%87%E4%BA%A4%E9%81%93%E7%9A%84%E8%AF%BB%E8%80%85%E5%BA%94%E8%AF%A5%E5%AF%B9%E6%AF%8F%E6%AC%A1%E8%BE%93%E5%85%A5%E5%91%BD%E4%BB%A4%E5%89%8D%E7%9A%84%E6%8F%90%E7%A4%BA%E7%AC%A6%EF%BC%88Prompt%EF%BC%89%E4%B8%8D%E9%99%8C%E7%94%9F%EF%BC%8C%E5%AE%83%E4%BB%AC%E5%8F%AF%E4%BB%A5%E6%89%BF%E8%BD%BD%E8%AF%B8%E5%A6%82%E5%BD%93%E5%89%8D%E4%BD%8D%E7%BD%AE%E3%80%81%E7%94%A8%E6%88%B7%E5%90%8D%E7%AD%89%E6%9C%89%E7%94%A8%E7%9A%84%E4%BF%A1%E6%81%AF%E3%80%82%E4%B8%8D%E7%AE%A1%E6%98%AF%E5%87%BA%E4%BA%8E%E7%BE%8E%E8%A7%82%E8%BF%98%E6%98%AF%E5%AE%9E%E7%94%A8%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&pic=https%3A%2F%2Fcdn.sspai.com%2F2021%2F11%2F13%2Fc687d14cbaba66d3d44069e581ee4fba.png%3FimageMogr2%2Fauto-orient%2Fquality%2F95%2Fthumbnail%2F!1420x708r%2Fgravity%2FCenter%2Fcrop%2F1420x708%2Finterlace%2F1&appkey=3196502474#" target="_blank"><i class="iconfont iconfont-weibo-simple right-16"></i></a><span><div role="tooltip" id="el-popover-4727" aria-hidden="true" class="el-popover el-popper" style="width:undefinedpx;display:none;"><!----><div style="text-align:center;"><div id="qr-code"></div><small class="qr-small">扫码分享</small></div></div><span class="el-popover__reference-wrapper"><i class="iconfont iconfont-wechat-simple right-16"></i></span></span><a href="https://twitter.com/share?text=%E3%80%90Oh%20My%20Posh%EF%BC%9A%E5%85%A8%E5%B9%B3%E5%8F%B0%E7%BB%88%E7%AB%AF%E6%8F%90%E7%A4%BA%E7%AC%A6%E4%B8%AA%E6%80%A7%E5%8C%96%E5%B7%A5%E5%85%B7%E3%80%91%E5%92%8C%E7%BB%88%E7%AB%AF%E6%89%93%E8%BF%87%E4%BA%A4%E9%81%93%E7%9A%84%E8%AF%BB%E8%80%85%E5%BA%94%E8%AF%A5%E5%AF%B9%E6%AF%8F%E6%AC%A1%E8%BE%93%E5%85%A5%E5%91%BD%E4%BB%A4%E5%89%8D%E7%9A%84%E6%8F%90%E7%A4%BA%E7%AC%A6%EF%BC%88Prompt%EF%BC%89%E4%B8%8D%E9%99%8C%E7%94%9F%EF%BC%8C%E5%AE%83%E4%BB%AC%E5%8F%AF%E4%BB%A5%E6%89%BF%E8%BD%BD%E8%AF%B8%E5%A6%82%E5%BD%93%E5%89%8D%E4%BD%8D%E7%BD%AE%E3%80%81%E7%94%A8%E6%88%B7%E5%90%8D%E7%AD%89%E6%9C%89%E7%94%A8%E7%9A%84%E4%BF%A1%E6%81%AF%E3%80%82%E4%B8%8D%E7%AE%A1%E6%98%AF%E5%87%BA%E4%BA%8E%E7%BE%8E%E8%A7%82%E8%BF%98%E6%98%AF%E5%AE%9E%E7%94%A8%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&url=null" target="_blank" class="twitter"><i class="iconfont iconfont-twitter-simple right-16"></i></a></div></div><span class="el-popover__reference-wrapper"><button class="btn-mini btn-share" data-v-7be936cf><i class="iconfont iconfont-share" data-v-7be936cf></i></button></span></span></div><div class="item-wrapper" data-v-7be936cf><button class="btn-mini btn-collect" data-v-7be936cf><i class="iconfont iconfont-collect" data-v-7be936cf></i></button></div><!----></div><!---->  
</div>
            