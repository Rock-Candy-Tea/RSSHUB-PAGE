
---
title: '玩客云折腾记录（一）：编译 ArmBian 系统'
categories: 
 - 新媒体
 - 少数派 sspai
 - Matrix
headimg: 'https://cdn.sspai.com/2021/11/10/article/fd05e8b0d5106960b2e69fb8e52f6992?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
author: 少数派 sspai
comments: false
date: Wed, 10 Nov 2021 10:40:08 GMT
thumbnail: 'https://cdn.sspai.com/2021/11/10/article/fd05e8b0d5106960b2e69fb8e52f6992?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
---

<div>   
<div class="articleWidth-content" data-v-6f469055><div class="content wangEditor-txt minHeight" data-v-6f469055><p style="margin-left:0;">本文将介绍如何从零到一编译 Armbian 系统，适配这台设备的代码来源，并对玩客云小设备进行刷机。为之后的折腾做一个前置准备。</p><h2><strong>写在前面</strong></h2><p style="margin-left:0;">最近有几个有趣的小想法想实践一下，希望使用低功耗、低成本的硬件跑一些持续性的独立的服务。最初的想法是入手一个树莓派得了，开发板尺寸小巧，资源丰富。然而搜索价格的时候发现最新版的树莓派，如果搭配上一些常用配件，加一个定制外壳，算下来成本几乎能和我之前的 NUC 裸机价格一较高下。</p><p style="margin-left:0;">那么，有没有性价比更高的方案呢？</p><h2><strong>为什么选择搭载 Amlogic S805 的玩客云</strong></h2><p style="margin-left:0;">于是，目光就锁定到了同为 ARM 架构的廉价 SoC 上，前一阵群里有同学推荐过“玩客云”，搜索了一番，发现<strong>虽然芯片其实是几年前的款，但是性能并不差，拥有一个千兆网口，并且机器自带一个金属外壳</strong> 。因为我<strong>不需要使用 GPIO 接口</strong> ，所以相比较树莓派而言，一套 50 元左右的小主机，性价比高非常多。</p><figure class="image ss-img-wrapper image_resized" style="width:100%;"><img src="https://cdn.sspai.com/2021/11/10/article/fd05e8b0d5106960b2e69fb8e52f6992?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt="玩客云小设备的外观" data-original="https://cdn.sspai.com/2021/11/10/article/fd05e8b0d5106960b2e69fb8e52f6992" referrerpolicy="no-referrer"><figcaption>玩客云小设备的外观</figcaption></figure><p> </p><p style="margin-left:0;">而且设备因为使用了廉价的 ARM 芯片，不光运行过程中的温度不算高，日常功耗也非常低。</p><figure class="image ss-img-wrapper image_resized" style="width:100%;"><img src="https://cdn.sspai.com/2021/11/10/article/cf957325c4333751ca180f7398adcc67?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt="实际使用过程中的功耗也比较低" data-original="https://cdn.sspai.com/2021/11/10/article/cf957325c4333751ca180f7398adcc67" referrerpolicy="no-referrer"><figcaption>实际使用过程中的功耗也比较低</figcaption></figure><p> </p><p style="margin-left:0;">玩客云采用的芯片方案是 Amlogic S805，和著名的 Hard Kernel 几年前推出过的开发板“ODROID-C1+”几乎完全一致。这个板子性能基本是树莓派3B的<a href="https://www.hardkernel.com/blog-2/benchmark-results-for-raspberry-pi-3-model-b-odroid-c1-odroid/"><strong>两倍</strong></a>，前文中提到的玩客云的成本大概是目前二手树莓派3的1/5～1/6。</p><figure class="image ss-img-wrapper image_resized" style="width:100%;"><img src="https://cdn.sspai.com/2021/11/10/article/9bf163cea144fb744af0f6777c95cceb?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt="S805 和树莓派3之间的性能比较" data-original="https://cdn.sspai.com/2021/11/10/article/9bf163cea144fb744af0f6777c95cceb" referrerpolicy="no-referrer"><figcaption>S805 和树莓派3之间的性能比较</figcaption></figure><p> </p><p style="margin-left:0;">如果追求绝对的性能，在价格差不多的情况下，可以考虑入手搭载 S905 芯片的“电视盒子”，性能和最新的树莓派4相比也<a href="https://www.zdnet.com/article/raspberry-pi-alternative-new-odroid-c4-undercuts-4gb-raspberry-pi-4-by-5/"><strong>不落下风</strong></a>，甚至在一些环节中性能高出不少。不过缺点嘛也是有的，目前这类机器受限于成本问题，很少有利于散热的金属外壳；因为性能更高，发热量也会更大。不过即便如此，综合成本也只是树莓派4的十几分之一。</p><h2><strong>系统选择及“源码溯源“</strong></h2><p style="margin-left:0;">相对于硬件而言，软件系统也非常重要。</p><p style="margin-left:0;">拥抱 Linux 让我们的设备有了无穷的可能性，树莓派有 Raspberry Pi OS（Raspbian），玩客云则因为搭载了和 Hard Kernel 之前产品一致的 Soc ，所以可以使用 ArmBian。</p><p style="margin-left:0;">在正式介绍如何为玩客云更换系统，以及编译一份干净的新版镜像之前，我要介绍一下这个系统的由来，因为这里有太多前人的无私贡献。</p><h3 style="margin-left:0;"><strong>Armbian 官方代码</strong></h3><figure class="image ss-img-wrapper image_resized" style="width:100%;"><img src="https://cdn.sspai.com/2021/11/10/article/76be32a2e435292406b780e49d565583?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt="Armbian 主要开源项目状况" data-original="https://cdn.sspai.com/2021/11/10/article/76be32a2e435292406b780e49d565583" referrerpolicy="no-referrer"><figcaption>Armbian 主要开源项目状况</figcaption></figure><p> </p><p style="margin-left:0;">2014年末，<a href="https://github.com/armbian/build"><strong>Armbian 立项</strong></a>，或许是暴风雨来临之前的沉寂，在 GAP一年多之后的2016年，Armbian 开始了每年千万行代码变动的爆发式成长。截止目前为止，官方项目已经支持了<a href="https://github.com/armbian/build/tree/master/config/boards"><strong>接近 150 个</strong></a>不同的硬件设备的适配。</p><h3 style="margin-left:0;"><strong>来自战斗民族的 Armbian TV 分支</strong></h3><blockquote><p style="margin-left:0px;">https://github.com/150balbes/build</p></blockquote><p style="margin-left:0;">在2018年7月的时候，一名网名是<a href="https://github.com/150balbes"><strong>150balbes</strong></a>的战斗民族网友出手了，他开始为各种官方原本并不支持的硬件做适配，过程中吸引了来自全世界有相同硬件折腾需求的网友，他<a href="https://github.com/moham96/Build-Armbian/commit/68b0c7ffd1469921ae9d3fa47967306068603dca#diff-34e069918d9d06cf3053809fb614dbb43dfb9f59bc7aa030de1ccf809d450b3a"><strong>第一个适配</strong></a>的 SoC 就是我们本文的主角同源的 s90x 系列的芯片。</p><p style="margin-left:0;">在2020年的光棍节前，他或许是觉得直接在官方原有的代码文件上进行修改，每次上游代码（Armbian）更新，他需要合并的内容太多了，毕竟Armbian是一个每年千万行代码变更的项目，<strong>于是他删除了原本开发了几个月的代码，在官方原有开发模式上新增了一个只有他自己使用的发布类型（dev），将之前的代码迁移了过来</strong>。随后他开始了专注于将 Armbian 适配到电视盒子上，并且将自己的分支命名为 armbian-tv，持续更新到了现在。</p><h3 style="margin-left:0;"><strong>来自阿拉伯网友 moham96 的分支</strong></h3><blockquote><p style="margin-left:0px;">https://github.com/moham96/Build-Armbian</p></blockquote><p style="margin-left:0;">阿拉伯网友 moham96 很快关注到了俄罗斯小伙子的项目，并立马 fork 了一份，升级了项目使用的 Linux 内核到 4.x 版本，并针对设备 Mac 地址设置方式进行了调整。</p><h3 style="margin-left:0;"><strong>来自国内网友 leo357449107 的分支</strong></h3><blockquote><p style="margin-left:0px;">https://github.com/Leo357449107/Build-Armbian/tree/20.11</p></blockquote><p style="margin-left:0;">前文提到的 150balbes 在春天的时候进行了一次分支的重构，其实这次重构非常“暴力”，原作者直接删除了之前一直在维护的 Build-Armbian 项目，重新 fork 了一份新的 Armbian。</p><p style="margin-left:0;">一般情况问题不大，但是如果有其他开发者正在基于他的代码进行开发的话，就会遇到类似下面的状况：</p><blockquote><p style="margin-left:0px;">2021/01/23 leo357449107 我正在愉快地Dubug的时候，上游把代码删了，我也把代码回滚了，然后，就没有然后了。</p></blockquote><p style="margin-left:0;">估计也是没办法，网友 leo 只好在 GitHub 上寻找了一份原来项目的 fork 版本（上文中的 moham96 的分支），再次进行 fork，并提交了自己的代码变更。</p><p style="margin-left:0;">随后<a href="https://www.right.com.cn/forum/thread-4057492-1-1.html"><strong>网友 leo 的版本</strong></a>也就此停止了更新和维护（Armbian 20.12 Buster with Linux 5.9.0-rc7），不过在停更之前，他为玩客云使用的 Armbian 带来了下面的内容：</p><ul><li>添加了快速将系统刷入 eMMC 的功能，添加了一些方便使用的软件源切换脚本。</li><li>验证了设备两个 USB 端口其实都是正常可用的，调整和关闭都可以根据修改启动分区的 dtb （Device tree）来实现。</li><li>使用了 meson8b-odroidc1t_noHDMI.dtb 替换了 meson8b-odroidc1t.dtb，让硬件作为服务器用途使用的时候，可以更加省电。</li><li>支持关闭默认的 USB 网卡支持，可以节约一些编译时间。</li></ul><h3 style="margin-left:0;"><strong>来自国内网友 witallwang 的分支</strong></h3><blockquote><p style="margin-left:0px;">https://github.com/witallwang/Build-Armbian</p></blockquote><p style="margin-left:0;">今年4月9日，有一位网友在 leo 的基础上继续进行了一些实用的调整。</p><ul><li>将内核版本升级到了 linux-5.10.y</li><li>更新了构建补丁，调整了启动硬件使用的 dtb 文件。</li></ul><p style="margin-left:0;">可惜的是，因为上游的中断，<a href="https://www.right.com.cn/forum/thread-4109200-1-1.html"><strong>这个系统的版本</strong></a>也被停留在了Armbian 的老版本 （Armbian 20.12 Buster, Linux 5.10.28）。</p><h2><strong>品尝最新版本的 Armbian</strong></h2><p style="margin-left:0;"><strong>如果我们将上面的几份代码进行合并，是不是就可以让玩客云的硬件继续使新版本的 Armbian 系统，以及或许更新的 Linux 内核了呢</strong>？在萌生了这个想法之后，我将上面的代码分别溯源和进行了一些整理合并。</p><h3 style="margin-left:0;"><strong>整理“硬分叉”的代码</strong></h3><p style="margin-left:0;">将 150balbes 的老代码以及最新代码提交合并回 armbian，修正时间轴：</p><blockquote><p style="margin-left:0px;"><a href="https://github.com/soulteary/armbian-build-s805/tree/codebase-merge-150balbes"><strong>https://github.com/soulteary/armbian-build-s805/tree/codebase-merge-150balbes</strong></a></p></blockquote><p style="margin-left:0;">将 leo 的代码变更合并到已经合并到 armbian 代码中：</p><blockquote><p style="margin-left:0px;"><a href="https://github.com/soulteary/armbian-build-s805/commits/codebase-merge-leo357449107"><strong>https://github.com/soulteary/armbian-build-s805/commits/codebase-merge-leo357449107</strong></a></p></blockquote><p style="margin-left:0;">将 witallwang 的代码变更合并到 armbian 代码中：</p><blockquote><p style="margin-left:0px;"><a href="https://github.com/soulteary/armbian-build-s805/commits/codebase-merge-witallwang"><strong>https://github.com/soulteary/armbian-build-s805/commits/codebase-merge-witallwang</strong></a></p></blockquote><p style="margin-left:0;">抽取 leo 和 witallwang 的代码变更，合并到 150balbes 的最新代码以及 armbian 最新代码中：</p><blockquote><p style="margin-left:0px;"><a href="https://github.com/soulteary/armbian-build-s805/commits/codebase-on-150balbes"><strong>https://github.com/soulteary/armbian-build-s805/commits/codebase-on-150balbes</strong></a> <a href="https://github.com/soulteary/armbian-build-s805/commits/codebase-on-offical"><strong>https://github.com/soulteary/armbian-build-s805/commits/codebase-on-offical</strong></a></p></blockquote><p style="margin-left:0;">几位作者的代码变更时间轴可以参考下面的日志。</p><pre class="language-shell"><code>| * 82d18dbad (origin/codebase-on-150balbes, codebase-on-150balbes) s805 with kernel 5.10.x
|/  
| * b8a13a355 (origin/codebase-20211107) fix script
| * aa688d0f4 fix filename
| * 27860835d rm build flag
| * 68ec3eac6 (origin/codebase-merge-witallwang, codebase-merge-witallwang) merge part of https://github.com/witallwang/Build-Armbian/commit/1691d4516893363ae2aaa63a2b73a68e780fbff2
| * e15a48946 (origin/codebase-merge-leo357449107, codebase-merge-leo357449107) merge part of https://github.com/Leo357449107/Build-Armbian/commit/5770744a0004740e378b87b86645919ee33fb630
| *   e170397d9 (origin/codebase-merge-150balbes, codebase-merge-150balbes) Merge pull request 
#1 from 150balbes/armbian-tv
| |\  
| | * e7bdaef83 v20210814</code></pre><h3 style="margin-left:0;"><strong>编译过程记录</strong></h3><p style="margin-left:0;">相信上文已经交代清楚了玩客云 S805 Soc 使用的 Armbian 系统代码的来源，所以在编译的时候，你可以根据自己的需求进行选择，以及二次开发。</p><p style="margin-left:0;">编译或者开发 Armbian 系统镜像的方法，其实非常简单。（如果你希望了解完整的细节，可以阅读<a href="https://docs.armbian.com/Developer-Guide_Build-Preparation/"><strong>官方文档</strong></a>。）下文将以合并到最新版本的 150balbes 的源码为基础进行叙述。</p><p style="margin-left:0;">先将代码 clone 到本地或者服务器。</p><pre class="language-shell"><code>git clone https://github.com/soulteary/armbian-build-s805.git --branch=codebase-on-150balbes</code></pre><p style="margin-left:0;">如果你不希望针对系统进行调整，不在意历史提交记录，并且想在国内的机器构建，也可以使用下面的方式加速下载源码：</p><pre class="language-shell"><code>git clone https://github.com.cnpmjs.org/soulteary/armbian-build-s805.git --depth=1 --branch=codebase-on-150balbes</code></pre><p style="margin-left:0;">完整代码差不多接近1个GB，所以下载的时候需要有一些耐心。</p><p style="margin-left:0;">建议使用按量付费的海外云主机进行下载和构建，可以节约不少时间。如果你的硬盘空间比较紧张，可以考虑在 Git Clone 完毕之后，删除根目录的 .git 目录，完整源码尺寸可以降低一半到 500MB 左右。</p><p style="margin-left:0;">此外，折腾 Armbian 系统编译，需要提前预留15G以上的磁盘空间，因为除了代码之外，默认构建选项下，编译后的产物会占用 10G 以上的空间。</p><pre class="language-shell"><code>du -hs armbian-build-s805
13G armbian-build-s805</code></pre><p style="margin-left:0;">开始构建之前，如果你是在国内的话，需要执行下面的命令，将代码中的一些依赖的下载方式切换为国内，避免因为网络问题，导致系统无法构建。</p><pre class="language-shell"><code>find . -type f -name "*.sh" | xargs -I &#123;&#125; sed -i 's/\/\/github.com\//\/\/github.com.cnpmjs.org\//' &#123;&#125;
find . -type f -name "*.conf" | xargs -I &#123;&#125; sed -i 's/\/\/github.com\//\/\/github.com.cnpmjs.org\//' &#123;&#125;
find . -type f -name "*.conf" | xargs -I &#123;&#125; sed -i 's/http:\/\/w1.fi\//git:\/\/w1.fi\//' &#123;&#125;</code></pre><p style="margin-left:0;">命令执行完毕之后，可以继续执行下面的命令进行检查，顺利的话，将不会有任何输出（因为都替换完毕了）：</p><pre class="language-shell"><code>find . -type f -name "*.sh" | xargs -I &#123;&#125; cat &#123;&#125; | grep "//github.com/"
find . -type f -name "*.conf" | xargs -I &#123;&#125; cat &#123;&#125; | grep "http://w1.fi/"</code></pre><p style="margin-left:0;"><code>在构建过程中，你可能会看到一个编译错误：</code></p><pre class="language-shell"><code>fit_image.c:19:10: fatal error: libfdt.h: No such file or directory</code></pre><p style="margin-left:0;">这个错误的原因是 150balbes 的老版本代码对于缺少一个开发依赖，这个问题作者在新版代码中修正了，因为上文提到的历史原因，这个问题被“继承”了下来。不过因为这个问题的触发场景是<a href="https://forum.armbian.com/topic/17387-kernel-bugcrash-when-trying-to-connect-tinker-board-s-as-wifi-ap/"><strong>无线网卡开启热点</strong></a>，所以本身不具备无线能力的玩客云，其实可以忽略掉。当然，如果你需要使用无线网卡，那么可以对此进行一个简单的依赖修复：</p><pre class="language-shell"><code>apt install libfdt-dev</code></pre><p style="margin-left:0;"><code>在上面的步骤就执行完毕之后，便可以通过下面的命令进行构建啦：</code></p><pre class="language-shell"><code>./compile.sh BOARD=设备名称 BRANCH=配置类型 RELEASE=focal BUILD_MINIMAL=yes BUILD_DESKTOP=no KERNEL_ONLY=no KERNEL_CONFIGURE=no COMPRESS_OUTPUTIMAGE=sha,gpg,img DOWNLOAD_MIRROR=china MAINLINE_MIRROR=tuna EXTRAWIFI=no</code></pre><p style="margin-left:0;">这里的“设备名称”，是我们在 config/boards 里存放的文件名称，所以根据分支的不同，我们会使用到的名称有：s805、s812、odroidc1。而“配置类型”则是 config/kernel 中，我们使用的 设备名称-*.conf 的配置文件的具体类型，根据实际分支的不同，我们可以选择使用的名称有：leagcy、edge、current、dev。这里没有好坏，根据自己的实际代码情况来即可。</p><p style="margin-left:0;">第一次执行 complie.sh 会触发安装各种开发依赖，下载各种源码包，耗时会比较长，一般会在十来分钟左右。</p><p style="margin-left:0;">正式进行系统镜像构建，根据硬件规格的不同，时间长度会有变化，以常见的 16核心的笔记或者服务器来说，实际测试的构建时间都在五至十分钟左右。</p><figure class="image ss-img-wrapper image_resized" style="width:100%;"><img src="https://cdn.sspai.com/2021/11/10/article/e34dea33bf20f297becfd19d73c19ad0?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt="编译过程火力全开的机器" data-original="https://cdn.sspai.com/2021/11/10/article/e34dea33bf20f297becfd19d73c19ad0" referrerpolicy="no-referrer"><figcaption>编译过程火力全开的机器</figcaption></figure><p> </p><p style="margin-left:0;">命令完全执行完毕之后，在目录中的 output/images 目录中就能够看到新鲜出炉的镜像啦。</p><h3 style="margin-left:0;"><strong>构建不同代码分支、版本、内核的镜像</strong></h3><p style="margin-left:0;">按照上面的方法，很轻松的就能够得到不同代码基、不同 Linux 内核、不同 Armbian 版本的系统镜像。</p><p style="margin-left:0;">比如：</p><ul><li>Armbian_21.11.0-trunk_Aml-s805_focal_current_5.9.0_minimal.img</li><li>Armbian_21.11.0-trunk_Aml-s805_focal_current_5.10.0_minimal.img</li><li>Armbian_21.08.0-trunk_Aml-s812_focal_current_5.9.0-rc7_minimal.img</li><li>Armbian_20.12_Aml-s812_focal_current_5.9.0-rc7_minimal.img</li></ul><p style="margin-left:0;">如果你的软件对于系统内核有特别的需求，可以考虑使用 <a href="https://github.com/xdarklight/linux"><strong>https://github.com/xdarklight/linux</strong></a> 这个仓库中的内核对 Armbian 官方内核进行替换。不过因为系统依赖的缘故，可以直接升级到的最高版本是“meson-mx-integration-5.10-20201115”。</p><p style="margin-left:0;">在系统镜像构建完毕之后，我们就可以进行刷机这个步骤了。</p><h2><strong>刷机前的准备</strong></h2><p style="margin-left:0;">给这台机器换系统的难度非常低，如果采用我们熟悉的“五星评价”的方式来描述难度的话，我觉得难度只有一颗星，其中大半颗还都在拆卸上面。</p><p style="margin-left:0;">以往不少帖子会建议大家购置 USB 转 TTL 线，以及购买烧录探针以及电烙铁，但是随着网友对于这台设备的开发，其实我们可以用更简单的方式来为这台设备更换系统，而<strong>不需要购置这些装备，以及进行焊接操作</strong>。</p><p style="margin-left:0;">我的刷机模式采用了网友“尉迟申棠”的<a href="https://www.right.com.cn/forum/thread-4095907-1-2.html"><strong>《无TTL线刷机》</strong></a>方案，整个操作流程大体分为四步，整个流程时间大概在十五分钟～二十分钟左右：</p><ol><li>拆机取出 S805 开发板</li><li>短接并通过 S805 刷机工具刷入开放的 UBoot</li><li>使用 U 盘自动刷入网友制作的启动系统作为基础</li><li>借助上面的系统作为跳板，用覆盖的方式刷入我们自己的系统</li></ol><h3 style="margin-left:0;"><strong>拆机过程细节记录</strong></h3><p style="margin-left:0;">设备拆机可以采用我下面这张图片中的工具，把家用的剪指甲刀的受力臂拆下来，塞进玩客云背部 SD 卡上方的贴片缝隙中，然后用螺丝刀或者其他的工具，把这个贴满了双面胶的背板撬下来，扭下6颗螺丝之后，接下来就可以使用短接金属线来进行刷机了。</p><figure class="image ss-img-wrapper image_resized" style="width:100%;"><img src="https://cdn.sspai.com/2021/11/10/article/853dd88b6b67cc6cda3f7e2a398da55d?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt="拆机方法和过程一览" data-original="https://cdn.sspai.com/2021/11/10/article/853dd88b6b67cc6cda3f7e2a398da55d" referrerpolicy="no-referrer"></figure><p><code>拆机方法和过程一览</code></p><p style="margin-left:0;"><code>群里的同学邮寄了一台小设备，顺带一起拆啦，正好凑齐新版和老版两种主板。</code></p><figure class="image ss-img-wrapper image_resized" style="width:100%;"><img src="https://cdn.sspai.com/2021/11/10/article/1b772cec1e4fca2c45bf52501c8c8119?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt="连带群友的机器一起拆了" data-original="https://cdn.sspai.com/2021/11/10/article/1b772cec1e4fca2c45bf52501c8c8119" referrerpolicy="no-referrer"><figcaption>连带群友的机器一起拆了</figcaption></figure><p> </p><h3 style="margin-left:0;"><strong>刷机过程细节记录</strong></h3><p style="margin-left:0;">刷机需要使用短接的方式，来迫使玩客云的主板进入 USB 引导模式。短接的工具可以考虑找一根买电子产品时的绑线，然后把金属线漏出来即可。（上图中图一的线被媳妇称呼为“通往天堂的钥匙”）</p><p style="margin-left:0;">需要注意的是，新旧版本不太一样，v1.3版的新主板短接在前面，而老主板的短接位置在背后。（顺手安装完毕了，忘记拍图了，不过网络上图很容易就能搜到，就不补啦）</p><p style="margin-left:0;">刷机完毕，登陆系统后，顺便看一眼 CPU 信息。</p><pre class="language-shell"><code>root@aml:~# lscpu
Architecture:          armv7l
Byte Order:            Little Endian
CPU(s):                4
On-line CPU(s) list:   0-3
Thread(s) per core:    1
Core(s) per socket:    4
Socket(s):             1
Model:                 1
Model name:            ARMv7 Processor rev 1 (v7l)
BogoMIPS:              2.00
Flags:                 half thumb fastmult vfp edsp thumbee neon vfpv3 tls vfpv4 vfpd32</code></pre><h3 style="margin-left:0;"><strong>常见问题：刷入引导失败</strong></h3><p style="margin-left:0;">此外，如果你采用 MacOS 上的虚拟机进行刷机，很有可能会失败，因为设备在通过 USB 公对公数据线和 USB_Burning_Tool 刷机的过程中，可能会快速重启切换模式，这时如果是使用虚拟机，会因为设备握手重连虚拟机时间过长，导致刷机失败。提示 “Romcode/状态切换/设备识别/命令结果返回错误”。</p><p style="margin-left:0;">如果使用直接安装的 Windows 系统进行 U-Boot 刷入，就不会出现这个问题了，这个设备重连导致失败的情况，至多出现一次。</p><figure class="image ss-img-wrapper image_resized" style="width:100%;"><img src="https://cdn.sspai.com/2021/11/10/article/009db298ff60196045dd7a25d9cc3aa3?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" alt="USB Burning 过程" data-original="https://cdn.sspai.com/2021/11/10/article/009db298ff60196045dd7a25d9cc3aa3" referrerpolicy="no-referrer"><figcaption>USB Burning 过程</figcaption></figure><h3 style="margin-left:0;"><strong>常见问题：为什么要刷两次机</strong></h3><p style="margin-left:0;">第一次是刷入引导，第二次是为了避免折腾 TTL 短接，利用网友构建的自动安装镜像，完成 eMMC (embedded MMC) 刷机，而这个系统的版本和内核都比较旧，所以第三次才是真实的刷机，刷入我们自己的系统。</p><p style="margin-left:0;">如果你愿意的话，也可以对比分析“eMMC刷机包”中的脚本，在构建自己镜像的时候做一些调整，减少一次刷机的过程。</p><h3 style="margin-left:0;"><strong>常见问题：制作的二次刷机镜像不起作用</strong></h3><p style="margin-left:0;">玩客云在引导时，USB 接口存在不能正确挂载 U 盘的情况，所以如果你制作的系统镜像没有被正确的加载，可以断掉电源重新拔插一遍 U 盘再试试引导。</p><p style="margin-left:0;">另外，因为设备供电能力有限（本身低功耗），所以使用的 U 盘也尽量使用传统 U 盘，而不要使用固态硬盘魔改的 U 盘，可能带不动。</p><h2><strong>参考资料</strong></h2><p style="margin-left:0;">上文虽然已经提到了许多来自网友的智慧结晶，但其实在整个过程中，还参考和学习了其他的网友的经验。</p><p style="margin-left:0;">如果你希望更进一步，从 U-Boot 引导开始折腾，或者适配给其他的设备，或许这些资料对你也会有用处，所以我将它们按照话题进行了分类，并列举在了下面。</p><h3 style="margin-left:0;"><strong>如何构建适用于玩客云的引导固件？</strong></h3><ul><li>玩客云的启动模式 <a href="https://www.pigworld.pw/?p=16"><strong>《玩客云Amlogic S805 适配Win10 arm32记录 - 3 》</strong></a> by @pigworld</li><li><a href="https://www.idoremember.com/posts/amlogic-uboot/"><strong>《编译Amlogic S805通用U-Boot关键步骤》</strong></a>by @Couchp95</li><li>如何构建玩客云（ S805 ）适用的 U-Boot：<a href="http://openlinux.amlogic.com/Docs/Common/How_to_build_kernel%2Cuboot%2Candroid_sepatately"><strong>《How to build kernel,uboot,android sepatately》</strong></a> by @cary.wu</li><li><a href="https://www.right.com.cn/forum/forum.php?mod=viewthread&tid=439086&page=1&authorid=30127"><strong>“在玩客云上添加SD卡和USB启动支持”</strong></a> by @jocover</li><li><a href="https://github.com/not-aml/openlinux-amlogic-uboot"><strong>Unofficial mirror of uboot sources</strong></a> by @not-aml</li></ul><h3 style="margin-left:0;"><strong>如何编译构建适用于玩客云的 ARM Linux 操作系统以及内核？</strong></h3><ul><li><a href="https://github.com/takitr/Amlogic_s8xx-kernel/tree/S805"><strong>Kernel Amlogic S802 S805 S812</strong></a> by @takitr</li><li><a href="https://www.right.com.cn/forum/thread-4031529-1-1.html"><strong>《玩客云armbian 高版本内核 Linux 5.7.0 自编译版本 Ubuntu 20.04 LTS》</strong></a> by @suixin2020</li></ul><h3 style="margin-left:0;"><strong>如何为这台小 ARM 设备构建容器镜像</strong></h3><ul><li><a href="https://www.docker.com/blog/multi-arch-images/"><strong>《Building Multi-Arch Images for Arm and x86 with Docker Desktop》</strong></a>by @ ADAM PARCO</li></ul><h3 style="margin-left:0;"><strong>玩客云网卡工作不正常？</strong></h3><ul><li><a href="https://www.idoremember.com/posts/onecloud2/"><strong>《解决玩客云Armbian下千兆网卡无法工作问题》</strong></a> by @Couchp95</li><li><a href="https://github.com/endlessm/linux-meson/blob/master/arch/arm/boot/dts/amlogic/meson8b_m201_1G.dtd"><strong>https://github.com/endlessm/linux-meson</strong></a> by @endlessm</li></ul><h3 style="margin-left:0;"><strong>其他资料</strong></h3><ul><li><a href="http://dn.odroid.com/S805/Datasheet/S805_Datasheet%20V0.8%2020150126.pdf"><strong>《Amlogic S805 Datasheet》</strong></a> by @Hardkernel</li></ul><h2><strong>最后</strong></h2><p style="margin-left:0;">文章至此，玩客云的 Armbian 折腾过程就结束了。后续的文章里，我将展开我想折腾的脑洞，用这台50元成本的设备，做一些有趣的实验：一台能够快速实现异地组网的设备，让你和你的基友快速联网打游戏；一台能够随身携带的电子笔记服务器；一台完善独立的密码记录本；一台低功耗的监控探针。</p><p style="margin-left:0;">--EOF</p><hr><p style="margin-left:0;"><strong>如果你觉得内容还算实用，欢迎点赞分享给你的朋友，在此谢过。</strong></p><hr><p style="margin-left:0;">本文使用「署名 4.0 国际 (CC BY 4.0)」许可协议，欢迎转载、或重新修改使用，但需要注明来源。 <a href="https://creativecommons.org/licenses/by/4.0/deed.zh"><strong>署名 4.0 国际 (CC BY 4.0)</strong></a></p><p style="margin-left:0;">本文作者: 苏洋</p><p style="margin-left:0;">创建时间: 2021年11月10日 统计字数: 11442字 阅读时间: 23分钟阅读 本文链接: https://soulteary.com/2021/11/10/low-power-device-trial-notes-wyk-part-1.html</p></div><!----></div><div style="border:1px solid transparent;" data-v-6f469055></div><div class="article-side sideTop" style="display:none;left:0;" data-v-7be936cf data-v-6f469055><div class="download-guide-container" data-v-14f9065e data-v-7be936cf><div class="btn-wrapper" data-v-14f9065e><!----><button class="btn btn-view" data-v-14f9065e><i class="iconfont iconfont-phone" data-v-14f9065e></i></button></div><a href="https://sspai.com/s/JYjP" target="_blank" data-v-14f9065e><!----></a></div><div class="item-wrapper" data-v-7be936cf><button class="btn btn-charge" data-v-7be936cf><i class="iconfont" data-v-7be936cf></i></button><span class="count" data-v-7be936cf>12</span></div><div class="item-wrapper" data-v-7be936cf><button class="btn-mini btn-comment" data-v-7be936cf><i class="iconfont iconfont-comment" data-v-7be936cf></i></button><span class="count" data-v-7be936cf>6</span></div><div class="item-wrapper" data-v-7be936cf><span data-v-7be936cf><div role="tooltip" id="el-popover-4109" aria-hidden="true" class="el-popover el-popper popper-share right ss-popper-dark-border" style="width:undefinedpx;display:none;"><!----><div class="article-side-share-btn"><a href="https://service.weibo.com/share/share.php?url=null?ref=weibo&title=%E3%80%90%E7%8E%A9%E5%AE%A2%E4%BA%91%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%9A%E7%BC%96%E8%AF%91%20ArmBian%20%E7%B3%BB%E7%BB%9F%E3%80%91%E6%9C%AC%E6%96%87%E5%B0%86%E4%BB%8B%E7%BB%8D%E5%A6%82%E4%BD%95%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E7%BC%96%E8%AF%91Armbian%E7%B3%BB%E7%BB%9F%EF%BC%8C%E9%80%82%E9%85%8D%E8%BF%99%E5%8F%B0%E8%AE%BE%E5%A4%87%E7%9A%84%E4%BB%A3%E7%A0%81%E6%9D%A5%E6%BA%90%EF%BC%8C%E5%B9%B6%E5%AF%B9%E7%8E%A9%E5%AE%A2%E4%BA%91%E5%B0%8F%E8%AE%BE%E5%A4%87%E8%BF%9B%E8%A1%8C%E5%88%B7%E6%9C%BA%E3%80%82%E4%B8%BA%E4%B9%8B%E5%90%8E%E7%9A%84%E6%8A%98%E8%85%BE%E5%81%9A%E4%B8%80%E4%B8%AA%E5%89%8D%E7%BD%AE%E5%87%86%E5%A4%87%E3%80%82%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2%E6%9C%80%E8%BF%91%E6%9C%89%E5%87%A0%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&pic=https%3A%2F%2Fcdn.sspai.com%2F2021%2F11%2F10%2F1e93e41058dbe44d3b3b63ab81cfffd9.jpeg%3FimageMogr2%2Fauto-orient%2Fquality%2F95%2Fthumbnail%2F!1420x708r%2Fgravity%2FCenter%2Fcrop%2F1420x708%2Finterlace%2F1&appkey=3196502474#" target="_blank"><i class="iconfont iconfont-weibo-simple right-16"></i></a><span><div role="tooltip" id="el-popover-2048" aria-hidden="true" class="el-popover el-popper" style="width:undefinedpx;display:none;"><!----><div style="text-align:center;"><div id="qr-code"></div><small class="qr-small">扫码分享</small></div></div><span class="el-popover__reference-wrapper"><i class="iconfont iconfont-wechat-simple right-16"></i></span></span><a href="https://twitter.com/share?text=%E3%80%90%E7%8E%A9%E5%AE%A2%E4%BA%91%E6%8A%98%E8%85%BE%E8%AE%B0%E5%BD%95%EF%BC%88%E4%B8%80%EF%BC%89%EF%BC%9A%E7%BC%96%E8%AF%91%20ArmBian%20%E7%B3%BB%E7%BB%9F%E3%80%91%E6%9C%AC%E6%96%87%E5%B0%86%E4%BB%8B%E7%BB%8D%E5%A6%82%E4%BD%95%E4%BB%8E%E9%9B%B6%E5%88%B0%E4%B8%80%E7%BC%96%E8%AF%91Armbian%E7%B3%BB%E7%BB%9F%EF%BC%8C%E9%80%82%E9%85%8D%E8%BF%99%E5%8F%B0%E8%AE%BE%E5%A4%87%E7%9A%84%E4%BB%A3%E7%A0%81%E6%9D%A5%E6%BA%90%EF%BC%8C%E5%B9%B6%E5%AF%B9%E7%8E%A9%E5%AE%A2%E4%BA%91%E5%B0%8F%E8%AE%BE%E5%A4%87%E8%BF%9B%E8%A1%8C%E5%88%B7%E6%9C%BA%E3%80%82%E4%B8%BA%E4%B9%8B%E5%90%8E%E7%9A%84%E6%8A%98%E8%85%BE%E5%81%9A%E4%B8%80%E4%B8%AA%E5%89%8D%E7%BD%AE%E5%87%86%E5%A4%87%E3%80%82%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2%E6%9C%80%E8%BF%91%E6%9C%89%E5%87%A0%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&url=null" target="_blank" class="twitter"><i class="iconfont iconfont-twitter-simple right-16"></i></a></div></div><span class="el-popover__reference-wrapper"><button class="btn-mini btn-share" data-v-7be936cf><i class="iconfont iconfont-share" data-v-7be936cf></i></button></span></span></div><div class="item-wrapper" data-v-7be936cf><button class="btn-mini btn-collect" data-v-7be936cf><i class="iconfont iconfont-collect" data-v-7be936cf></i></button></div><!----></div><!---->  
</div>
            