
---
title: '如何增强智能家居设备的安全性'
categories: 
 - 新媒体
 - 少数派 sspai
 - Matrix
headimg: 'https://cdn.sspai.com/2021/10/10/dbe78ca3e61287564725c5e0d0df64cc.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
author: 少数派 sspai
comments: false
date: Sun, 10 Oct 2021 12:22:51 GMT
thumbnail: 'https://cdn.sspai.com/2021/10/10/dbe78ca3e61287564725c5e0d0df64cc.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
---

<div>   
<div class="articleWidth-content" data-v-6a669db8><div class="content wangEditor-txt minHeight" data-v-6a669db8><p>智能家居设备，现在已经不是什么「新鲜事物」。在市场上，我们能够看到各种各样的智能家居设备，例如扫地机器人、空气净化器、监控摄像头、智能插座、智能音箱......</p><p>当家中的联网设备越来越多，你是否会想过，这些设备可能会给家庭网络带来安全风险？</p><h2>智能家居设备会带来哪些安全性问题？</h2><p>那么，为什么智能家居设备会给家庭网络带来安全风险？这些设备会带来哪些安全方面的问题？</p><p>首先，设备接入家庭网络后，就有能力做到扫描网络中的所有设备，收集家中手机、电脑、路由器等的品牌、型号，以及家庭的地理位置<sup class="ss-footnote" href="https://sspai.com/post/61223" title="参考：iOS 14 新增的本地网络权限，要开给第三方 App 吗？ - https://sspai.com/post/61223" footnote-id="1">1</sup>，用于<strong>数据分析</strong>，或者<strong>精准推送广告</strong>：</p><ul><li><a href="http://www.nbd.com.cn/articles/2021-04-27/1720873.html">被曝私自采集用户数据 创维电视与勾正数据相继回应 | 每经网</a></li><li><a href="https://www.right.com.cn/forum/thread-1355363-1-1.html">群晖被家里的智能电视尝试登陆SSH和ftp 服务器是什么情况？ - 恩山无线论坛</a></li></ul><p>另外，在软件开发过程中，开发者可能会因为编码疏忽、方便调试等原因，或者引用的第三方 SDK 有问题，有意或者无意地为设备引入<strong>后门或漏洞</strong>。尤其是软件开发流程不规范的小团队，更有可能给设备带来漏洞。</p><p>其中一部分漏洞会使设备绕过 <a href="https://sspai.com/post/68037">NAT</a> 或防火墙的保护，直接<strong>暴露在公网</strong>。例如某品牌手机的「快应用」实现，就通过 UPnP，将 55555 端口映射到公网，导致手机能被 Internet 上的所有设备访问：</p><ul><li><a href="https://bbs.saraba1st.com/2b/thread-2005759-1-1.html">（转）Vivo 手机某系统进程开放 55555 端口 初步确定为快应用 - Stage1st</a></li></ul><p>设备上的漏洞还可能会<strong>被黑客利用</strong>，用来做为跳板，扫描、攻击内网设备，或者用于对外发起 DDoS 攻击：</p><ul><li><a href="https://www.cnbeta.com/articles/tech/1149581.htm">新发现的Mirai Botnet正在操纵各类物联网设备进行DDoS攻击 - cnBeta.COM</a></li></ul><p>还有黑客会利用设备上的漏洞，进行「<strong>挖矿</strong>」等活动，或者将设备作为 PCDN 节点，占用设备的 CPU、存储、带宽等资源，降低设备寿命：</p><ul><li><a href="http://www.360.cn/newslist/sjaq/qqscbfazwkrczndsbkj.html">全球首次爆发安卓挖矿蠕虫 智能电视变“矿机”</a></li></ul><p>对于监控摄像头（包括带摄像头的电视机）、智能音箱等设备，如果存在漏洞，理论上黑客能够利用漏洞，「<strong>偷看」或者「偷听」家中的画面和声音</strong>，严重威胁我们的个人隐私：</p><ul><li><a href="https://mp.weixin.qq.com/s/3BuDgau0xnENalyHu0YyHw">Foscam摄像头设备漏洞分析报告</a></li><li><a href="https://www.freebuf.com/articles/paper/279004.html">烽火三十六技丨谈摄像头安全隐患及网络摄像头资产数据分析 - FreeBuf网络安全行业门户</a></li></ul><p>对于带有存储功能的智能设备，例如摄像头、NVR、NAS，漏洞还可能导致<strong>数据泄漏或丢失</strong>：</p><ul><li><a href="https://www.synology.cn/zh-cn/security/advisory/SynoLocker">SynoLocker: 针对 Synology NAS 的勒索病毒</a></li><li><a href="https://www.qnap.com/static/landing/2021/qlocker/response/zh-cn/">Qlocker: 针对 QNAP NAS 的勒索病毒</a></li><li><a href="https://www.cnbeta.com/articles/tech/1146417.htm">西数：黑客利用远程漏洞抹除My Book用户数据 正研究潜在恢复方案 - 安全 - cnBeta.COM</a></li></ul><p>另外，对于带有云服务的智能硬件，云服务也有可能存在漏洞，或者运维的过程中出现失误，导致隐私泄漏：</p><ul><li><a href="https://www.qbitai.com/2020/01/10472.html">小米摄像头被谷歌紧急封禁！别人的设备，能看到你家现场 | 量子位</a></li><li><a href="https://tech.sina.com.cn/mobile/n/n/2020-01-03/doc-iihnzhha0099434.shtml">小米回应智能摄像头被谷歌停用：解决问题后重新上线|小米|谷歌|智能摄像头_新浪科技_新浪网</a></li></ul><h2>如何提高智能家居设备的安全性？</h2><h3>使用重视安全的厂商的智能家居设备</h3><p>在我们选用智能硬件时，尽量选用大公司、或者重视安全的公司的产品。</p><p>大公司的产品，用户量相对较大，更容易受到安全研究人员的关注。这使得安全漏洞更容易被暴露出来，并得到修复。</p><p>下图是 Apple Product Security 邮件列表中的一封邮件，可以看出，在软件更新中，Apple 解决了一系列第三方研究机构上报的安全问题：</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/10/10/dbe78ca3e61287564725c5e0d0df64cc.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/10/10/dbe78ca3e61287564725c5e0d0df64cc.png" referrerpolicy="no-referrer"><figcaption>Apple Product Security 邮件</figcaption></figure><p>相对来说，大公司的软件开发流程也会更加规范，会有完整的开发、代码审查、测试等步骤，对于安全问题的响应也会更及时<sup class="ss-footnote" href title="当然，这里并不是说读者一定要选择大公司的产品。注重安全的、「小而美」的团队也确实存在，但需要读者自行区分和判断。" footnote-id="2">2</sup>。</p><p>接下来是一些小技巧，通过这些技巧，读者可以粗略判断出一家公司是否重视安全：</p><p>首先，可以观察一下厂商官网上，是否有漏洞反馈页面，或者安全奖励计划页面。虽然有这些页面并不完全代表厂商重视安全，但还是能一定程度上看出厂商对安全问题的态度：</p><ul><li><a href="https://bugbounty.huawei.com/#/home">华为安全奖励计划</a></li><li><a href="https://www.dahuatech.com/service/response.html">大华产品安全事件响应中心 </a></li><li><a href="https://sec.xiaomi.com/#/">小米安全中心</a></li><li><a href="https://mideasrc.vulbox.com/">漏洞盒子 | 美的IoT安全应急响应中心 （MIoTSRC）</a></li><li><a href="https://src.tcl.com/zh/index">TCL安全应急响应中心 </a></li></ul><p>此外，还可以查找厂商是否提供安全白皮书，并阅读白皮书中的内容。重视安全的公司，一般会将自己的产品如何保护用户的安全与隐私，详细在白皮书中描述：</p><ul><li><a href="https://support.apple.com/guide/security/welcome/web">Apple Platform Security - Apple Support</a></li><li><a href="https://cdn.cnbj1.fds.api.mi-img.com/privacy-station/mobile/files/MIUI12%E9%9A%90%E7%A7%81%E7%99%BD%E7%9A%AE%E4%B9%A6.pdf">MIUI12隐私白皮书</a></li><li><a href="https://images.tuyacn.com/rms-static/11031420-c370-11eb-abb3-a73e4985f1bb-1622617165410.pdf?tyName=%E6%B6%82%E9%B8%A6%E6%99%BA%E8%83%BD%E5%AE%89%E5%85%A8%E7%99%BD%E7%9A%AE%E4%B9%A6v4.1.pdf">涂鸦智能安全白皮书</a></li></ul><p>还可以阅读厂商的软件更新日志，观察安全漏洞修复的及时程度。另外，部分厂商还专门提供有安全漏洞更新的邮件列表，或者安全预警邮件，及时通知用户如何解决安全漏洞：</p><ul><li><a href="https://lists.apple.com/mailman/listinfo/security-announce/">Security-announce Info Page</a></li><li><a href="https://www.synology.cn/zh-cn/security/advisory">Synology 产品安全顾问 | 群晖科技 Synology Inc.</a></li></ul><h3>正确设置路由器，避免设备暴露在公网</h3><p>家用路由器中一般运行有 <a href="https://sspai.com/post/68037">NAT</a>，能够避免内网设备被外网访问。这样，攻击者很难从外网直接访问家中的智能家居设备，大大减小了漏洞被利用的可能性。</p><p>但是，如果路由器设置有误，例如将智能家居设备设置为 DMZ 主机，或者错误设置了端口转发规则，仍会有可能让设备暴露在公网。</p><p>建议定期检查路由器中 DMZ、端口转发等设置，并删除错误配置。</p><h3>设置防火墙，阻止设备访问 Internet</h3><p>如果路由器设置正确，不将设备暴露在公网，智能家居设备就难以被外界攻击，安全性大大得到提升。</p><p>但是，智能家居设备仍然可以访问 Internet，连接设备厂商的服务器。阻止智能家居设备访问 Internet，能避免厂商通过智能家居设备收集家庭网络中的隐私数据，也能避免厂商服务器被攻击时，家中的智能家居设备被黑客控制。</p><p>路由器中的「防火墙」或「家长控制」功能，可用于阻止内网设备访问 Internet：</p><ul><li><a href="https://smb.tp-link.com.cn/service/detail%5C_article%5C_74.html">路由器防火墙应用举例—（1）IP地址过滤的使用 - TP-LINK</a></li><li><a href="https://help.ui.com.cn/articles/115000046081/">网络控制（家长控制）：暂停网络连接 - AmpliFi</a></li></ul><p>当然，阻止设备访问 Internet，也会带来一些不便之处，例如不能使用厂商的 App 进行远程控制、无法实现高级自动化功能等。针对这些问题，可考虑控制设备的在线时间：例如对于摄像头，可通过脚本，实现有人在家时禁止联网，只有家中无人时，才允许摄像头联网，从而一定程度上取得安全与便利的平衡。</p><p>也可以考虑使用 HomeKit、Home Assistant 等工具，实现远程访问家庭设备，具体请参考下文中的介绍。</p><h3>使用 HomeKit</h3><p>HomeKit 是来自 Apple 的智能家居平台。与 Google Home、米家等其他厂商的智能家居平台不同，HomeKit 的实现方式比较「另类」，所以在此处单独进行介绍。</p><ul><li><a href="https://sspai.com/post/67784">HomeKit 从零完全入门指南（一）：认识 HomeKit - 少数派</a></li></ul><p>大部分智能家居厂商都提供了「云服务」。智能家居设备和手机 App 连接到厂商服务器，实现了出门在外时，也能通过手机 App 控制智能家居设备。</p><p>但这样的云服务大多没有实现「端到端加密」。也就是说，手机和智能家居设备之间传输的数据，在服务器上是以明文形式存在的。如果设备厂商的内部管理不严格，运维人员就能看到这些数据。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/10/10/c93679740fd47c7f973270289d72e622.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/10/10/c93679740fd47c7f973270289d72e622.png" referrerpolicy="no-referrer"><figcaption>非端到端加密，数据在服务器上以明文形式存在</figcaption></figure><p>而 HomeKit 实现了端到端加密，手机 App 和 HomeKit 家庭中枢之间通信的数据全程保持加密，在服务器上也不会解密 ，安全性更高。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/10/10/eaa96baa6e0333fe36928b00f971cdcb.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/10/10/eaa96baa6e0333fe36928b00f971cdcb.png" referrerpolicy="no-referrer"><figcaption>端到端加密，数据在服务器上保持为密文</figcaption></figure><p>此外，HomeKit 有如下两个功能，能够提升智能家居的安全性：</p><p>其中一个是 <strong>HomeKit Secure Video</strong>。</p><p>当用户购买 <a href="https://support.apple.com/zh-cn/HT201318">iCloud+</a> 后，HomeKit Secure Video 能将能 10 天内的摄像头录像存储在 iCloud，不额外占用 iCloud 存储空间。摄像头录像在 iCloud 中同样受到端到端加密的保护<sup class="ss-footnote" href="https://support.apple.com/en-us/HT202303" title="需要注意的是，在 iCloud 中，并不是所有的数据都受端到端加密的保护。例如 iCloud 中的照片，就没有进行端到端加密：https://support.apple.com/en-us/HT202303" footnote-id="3">3</sup>。</p><ul><li><a href="https://support.apple.com/zh-cn/guide/security/sec525461d19/web">HomeKit 摄像头安全性 - Apple 支持</a></li></ul><p>另一个是<strong>受 HomeKit 保护的路由器</strong>。</p><p>HomeKit 通过一种相对安全的方式，实现了外网访问家中的智能家居设备。所以，使用 HomeKit 之后，就可以按照上文中的介绍，阻止智能家居设备访问 Internet，进一步提升安全性，而不会牺牲太多便利性了。</p><p>如果有支持 HomeKit 的无线路由器，这一步的操作会更加便捷。HomeKit 能自动设置路由器，阻止智能家居设备访问 Internet，无需用户手动修改复杂的防火墙规则。同时，HomeKit 路由器还支持 PPSK 认证，避免泄漏主 Wi-Fi 密码。</p><ul><li><a href="https://support.apple.com/zh-cn/guide/security/seccab60e931/web">使用 HomeKit 保护路由器 - Apple 支持</a></li><li><a href="https://support.apple.com/zh-cn/HT210544">使用受 HomeKit 保护的路由器 - Apple 支持 (中国)</a></li></ul><p>目前，支持 HomeKit 的智能家居设备数量较少，且价格偏贵。可考虑使用 HomeBridge，让更多第三方设备接入 HomeKit：</p><ul><li><a href="https://homebridge.io/">Homebridge</a></li><li><a href="https://sspai.com/post/58905">如何让米家设备轻松接入 HomeKit？</a></li><li><a href="https://sspai.com/post/59636">HomeBridge 操作指南：从零开始，将你的米家设备接入 Homekit</a></li><li><a href="https://sspai.com/post/57780">教你把索尼电视接入 HomeKit 平台</a></li><li><a href="https://sspai.com/post/36617">借助树莓派与 HomeBridge ，将 YeeLight 彩光灯接入 Apple HomeKit | Matrix 精选</a></li></ul><p>当然，HomeKit 并不能保证绝对的安全。不少智能家居设备，除了支持 HomeKit，也提供了自己的 App。通常情况下，设备厂商自己的 App 会提供比 HomeKit 更加丰富的功能，但不一定能提供与 HomeKit 相同等级的安全性。</p><p>另外，HomeKit 是闭源软件，HomeKit 基础设施也由 Apple 控制，而不是由用户控制。理论上 Apple 可以私下改变 HomeKit 的实现方式，而不提前通知用户。至于是否应该信任 Apple，就需要读者自行判断了。</p><ul><li><a href="https://support.apple.com/zh-cn/guide/security/sec49613249e/1/web/1">HomeKit 数据安全性 - Apple 支持</a></li><li><a href="https://sspai.com/post/68212">从 Apple 儿童安全功能的原理出发，聊聊它为什么引发热议 - 少数派</a><ul><li><a href="https://www.cnbeta.com/articles/tech/1167959.htm">Reddit用户发现CSAM检测中使用的苹果NeuralHash算法隐藏在iOS 14.3中 - cnBeta.COM</a>（虽然 Apple 表示在 iOS 15 中启用 CASM检测功能，但是 iOS 14.3 也被发现存在 CASM 检测代码）</li></ul></li></ul><h3>自行搭建 Home Assistant</h3><p>对于不使用 Apple 设备、或者不信任 Apple 的用户，还有另外一种选择：Home Assistant。</p><ul><li><a href="https://www.home-assistant.io/">Home Assistant 官网</a></li><li><a href="https://sspai.com/post/60414">Homeassistant：不仅仅是更优秀的智能家居解决方案</a></li><li><a href="https://sspai.com/post/38849">Home Assistant + 树莓派：强大的智能家居系统 · 安装篇</a></li></ul><p>Home Assistant 是一个开源的智能家居平台，可以搭建在 NAS、Raspberry Pi 或者高性能的无线路由器<sup class="ss-footnote" href title="考虑到家庭网络的稳定性，不建议将 Home Assistant 搭建在家庭路由器上" footnote-id="4">4</sup>上。通过 HomeBridge，可以实现对智能家居设备的集中控制，以及智能家居设备的跨厂商、跨平台自动化。</p><p>将所有智能家居设备接入 Home Assistant 之后，只需要通过安全的方式让 Home Assistant 可被外界访问<sup class="ss-footnote" href title="例如使用 HTTPS + 强密码、HTTPS + 双因素认证，或者通过安全的隧道来访问家中的 Home Assistant" footnote-id="5">5</sup>，就可以阻止智能家居设备访问 Internet，统一使用 Home Assistant 控制智能家居设备了。</p><h3>选购支持 ONVIF 等开放协议的摄像头，并将监控录像存储在本地</h3><p>对于监控摄像头，也有不少厂商提供了云服务，可以将监控录像存储在云端，方便视频回放和远程访问。</p><p>但是，如果厂商的云服务没有采取正确的加密措施，或者存在安全漏洞，可能就会导致监控录像泄漏。如果担心这样的问题，最好的办法，就是将视频存放在本地。</p><p>很多 NAS 都拥有强大的摄像头监控录制软件，例如 Synology 和 QNAP 的 Surveillance Station。可以通过这些工具，将摄像头录像保存在 NAS 上：</p><ul><li><a href="https://www.synology.cn/zh-cn/surveillance">Surveillance Station | 群晖科技 Synology Inc.</a></li><li><a href="https://www.qnap.com/zh-cn/software/surveillance-station">Surveillance Station 安全监控 | NAS 上的 IP 影像监控管理系统 | QNAP</a></li></ul><p>如果想要将视频监控数据和 NAS 上的重要数据分离，还可以考虑使用 NVR 设备：</p><ul><li><a href="https://www.hikvision.com/cn/products/Video-Recorder/Network-hard-disk-recorder/">网络硬盘录像机（NVR） | 后端产品 | Hikvision</a></li><li><a href="https://www.ui.com.cn/camera-security/">Ubiquiti | UniFi | 易于扩展的安防监控系统</a></li></ul><p>对于 NAS 和 NVR，一般使用 <a href="https://www.onvif.org/">ONVIF</a> 协议来连接摄像头。做为一个通用的协议，绝大多数厂商都生产支持 ONVIF 的摄像头，但互联网品牌的家用摄像头（例如小米、Nest 等品牌），也有很多不支持该协议。在选购时需要注意。</p><p>如下两个摄像头均支持 ONVIF，且价格不贵，适合搭配 Surveillance Station 或 Home Assistant 使用：</p><ul><li><a href="https://web.archive.org/web/20200821162719/https://koolshare.cn/thread-169771-1-1.html">169元带云台摄像头实现群晖Surveillance Station高清录像+IPC控制 - KoolShare</a></li><li><a href="https://www.leftso.com/blog/644.html">群晖接入水星（MERCURY）MIPC251C-4网络摄像机-左搜</a></li><li><a href="https://post.smzdm.com/p/a25gz2mq/">伪开箱 - 水星 mipc251c-4 摄像头 + HomeAssistant 迎宾系统搭建_摄像头_什么值得买</a></li></ul><h3>使用单独的 VLAN 和 SSID，将智能家居设备与其他设备隔离</h3><p>家庭网络中的设备，一般位于同一个局域网，设备之间可以相互访问。设备间的相互访问，可能也会带来安全和隐私问题。</p><p>例如前文中提到的，智能家居设备可能会扫描家庭中的所有设备，泄漏设备型号、地理位置等信息。</p><p>再例如，即使在路由器上阻止了家中的摄像头访问 Internet，但是，如果电脑感染恶意软件，电脑也有可能访问摄像头，获取摄像头录制的视频，并发送到恶意网站，导致隐私泄露。</p><p>那么，什么样的措施，能够阻止家庭网络内设备间的相互影响？划分 VLAN，就是其中的一种方法。不同 VLAN 间的设备能够相互隔离，避免直接访问<sup class="ss-footnote" href title="配置路由后，VLAN 之间也是可以实现互通的。可通过附加防火墙规则，进一步提升跨 VLAN 访问智能家居设备的安全性" footnote-id="6">6</sup>。关于 VLAN 的基础知识和实际应用，可通过如下两个链接了解：</p><ul><li><a href="https://sspai.com/post/66801">告别杂乱的弱电箱，用网管交换机布置舒适简洁的家庭网络 - 少数派</a></li><li><a href="https://www.bilibili.com/video/BV1e34y1Q7bj">用最野的路子教你布局家庭网络@第二期——通过VLAN实现单网口软路由网口复用 - 哔哩哔哩</a></li></ul><p>VLAN 是以太网的概念，通常只用于有线网络。对于 Wi-Fi，可以创建多个 SSID，让不同的VLAN 绑定不同的 SSID，使链接 Wi-Fi 的设备也能做到相互隔离：</p><ul><li><a href="https://kb.netgear.com/30611/How-do-I-create-multiple-SSID-s-to-operate-on-multiple-VLAN-s">How do I create multiple SSID's to operate on multiple VLAN's | Answer | NETGEAR Support</a></li><li><a href="https://www.youtube.com/watch?v=nzHu3ALuEFo">Isolating my IOT Devices on a VLAN with the Unifi Dream Machine</a></li><li><a href="https://www.youtube.com/watch?v=p3SfeQTaaxw">Setup IoT VLANs and Firewall Rules with UniFi. ULTIMATE (Smart) Home Network Part Three</a></li><li><a href="https://www.youtube.com/watch?v=vz3u6E3Fxi8&t=1s">Ultimate Home Network 2021</a></li><li><a href="https://www.youtube.com/watch?v=6ElI8QeYbZQ">Secure IoT Network Configuration</a></li></ul><p>创建多个 VLAN 和 SSID 看似复杂，但实际上，路由器上的「访客模式」功能，就是通过自动划分 VLAN 和 SSID，实现访客网络的家庭网络的隔离的。希望后续家用无线路由器厂商能够进一步优化，提供一键创建 IoT 网络的功能。</p><h3>mDNS Proxy</h3><p>划分 VLAN 和 SSID 虽然提升了安全性，但是智能家居和手机等设备处于不同的网络，无法实现 HomeKit、AirPlay、手机 App 控制等功能<sup class="ss-footnote" href title="默认 VLAN 之间不能互通，需要配置 VLAN 间的路由。但是，即使配置了 VLAN 间的路由，由于 IoT 设备和手机处于不同的网络，手机 App 也难以发现 IoT 设备" footnote-id="7">7</sup>。</p><p>不过，大部分智能家居设备，使用了 mDNS 和 DNS-SD 协议。这使得我们有办法实现跨 VLAN 控制智能家居设备。</p><p>mDNS/DNS-SD 协议用于局域网内的服务发现。该协议最早由 Apple 发扬光大：Apple 通过 Bonjour 软件实现了这两个协议，并在 AirPlay、AirPrint、iTunes 家庭共享、AirPort 路由器等产品和服务中得到了广泛应用。</p><ul><li><a href="https://datatracker.ietf.org/doc/html/rfc6762">RFC 6762 - Multicast DNS</a></li><li><a href="https://datatracker.ietf.org/doc/html/rfc6763">RFC 6763 - DNS-Based Service Discovery </a></li><li><a href="https://web.archive.org/web/20080516084243/http://www.apple.com.cn/macosx/features/bonjour/">Apple中国 - Mac OS X - Bonjour</a></li><li><a href="https://developer.apple.com/bonjour/">Bonjour - Apple Developer</a></li></ul><p>在智能家居时代，无论是 Apple 的 HomeKit，还是小米米家，都选择使用 mDNS 来查找和发现局域网内的智能家居设备。</p><p>mDNS 在大部分情况下，仅限在一个局域网内使用。但一部分路由器支持 mDNS Proxy<sup class="ss-footnote" href title="也可能会被叫做「mDNS 代理」、「mDNS 反射器」、「mDNS 网关」、「Bonjour 网关」等" footnote-id="8">8</sup>，能够从一个网络内学习 mDNS 信息，并发布到另一个网络，从而实现跨网络的设备发现。对于不支持 mDNS Proxy 的路由器，也可以使用第三方软件实现：</p><ul><li><a href="https://web.archive.org/web/20210618122824/https://help.ui.com/hc/en-us/articles/360001004034-UniFi-Best-Practices-for-Managing-AirPlay-Chromecast-on-UniFi-Network">UniFi - Best Practices for Managing AirPlay/Chromecast on UniFi Network – Ubiquiti Support and Help Center</a></li><li><a href="https://www.v2ex.com/t/797091#reply0">开源一个自用的 mDNS 反射软件： 解决局域网跨 VLAN 服务发现难题，让你的 IoT 设备可以跨 VLAN 使用 - V2EX</a></li><li><a href="https://support.huawei.com/enterprise/zh/doc/EDOC1100064370/2d02c692">配置Bonjour网关示例（AP与AC间二层转发） - WLAN V200R010C00 典型配置案例集 - 华为</a></li></ul><h3>使用安全的隧道访问内网设备</h3><p>如果将内网设备直接暴露在公网，很有可能带来安全问题。</p><p>当然，我们可以选择使用 Home Assistant，将 Home Assistant 暴露在公网，并添加 HTTPS 等安全措施。但是，这样做也会有几个缺点：</p><ul><li>设置麻烦</li><li>部分设备不支持 Home Assistant</li><li>Home Assistant 拥有 Web 界面，但国内家庭宽带不允许搭建 Web 服务</li></ul><p>所以，可以考虑通过建立安全的隧道，让外部设备与家庭设备形成一个虚拟的局域网，实现在外部访问内网设备。这种方式在本文中不再详细介绍，感兴趣的读者可以自行上网搜索。</p><h3>DIY 智能家居设备</h3><blockquote><p>⚠️ 注意：本方法只适合有经验的读者。如果操作不当，可能会带来危险，包括但不限于导致身体受伤、中毒、触电，或引发火灾。</p></blockquote><p>对于具有嵌入式开发能力的读者，还可以选择 DIY 智能家居。自己制作的智能家居设备，软硬件相对可控，而且与成品设备相比，能够自由组合不同的传感器和各种器件，实现成品设备无法实现的功能。</p><p>一般来说，DIY 智能家居具有较高的门槛。但是，随着开源软件和<a href="https://www.oshwa.org/">开源硬件</a>的流行，<a href="https://www.arduino.cc/">Arduino</a> 生态的逐渐完善，以及像 ESP8266/ESP32 这样的廉价易用的 SoC 的出现，用户可以用类似「搭积木」的方式，方便地制作出自己的智能家居设备。在少数派上，也有作者分享过基于 ESP8266 的优秀项目：</p><ul><li><a href="https://sspai.com/post/54225">如何制作一个 WIFI 像素时钟，只要Lametric十分之一的价格</a></li></ul><p>ESPHome 项目可以让用户使用 ESP8266/ESP32，连接各种传感器和电子模块，制作自己的智能家居设备，并接入 Home Assistant。ESPHome 提供的软件框架，可通过配置文件方便地添加功能，无需编程：</p><ul><li><a href="https://esphome.io/#">ESPHome — ESPHome</a></li></ul><p>虽然可以使用开源软硬件来制作自己的智能家居设备，但是在制作时，还是要尽量自己对代码进行阅读和审计，确认代码是否安全。</p><h2>如何发现智能家居设备正在偷偷「做坏事」？</h2><p>对于已有的智能家居设备，是否有办法看到设备正在做什么？有没有在「做坏事」？在下文中，笔者将介绍几种方法。</p><h3>检查路由器上的 UPnP 端口映射信息</h3><p>部分智能家居设备，会通过 UPnP/NAT-PMP，将端口映射到公网。这样做能方便外网访问，但也会带来安全风险。</p><p>建议定期检查路由器中的 UPnP 表项，观察是否有设备偷偷开放了不必要的端口。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/10/10/3af1ec1577a54cb6388e41ed9fa536c0.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/10/10/3af1ec1577a54cb6388e41ed9fa536c0.png" referrerpolicy="no-referrer"><figcaption>路由器上的 UPnP 表项</figcaption></figure><p>另外，还有一部分路由器，能够统计出通过 UPnP 端口映射转发了多少流量。如果流量过大，则有可能是设备受到了攻击，或者被厂商偷偷用做 PCDN 节点。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/10/10/d904bc5686c2a79eafb6fa854a5bf5ad.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/10/10/d904bc5686c2a79eafb6fa854a5bf5ad.png" referrerpolicy="no-referrer"><figcaption>端口转发统计信息</figcaption></figure><h3>使用 Pi-hole、AdGuard Home 等广告过滤工具</h3><p>想要具体知道设备访问了哪些域名，可以使用 Pi-hole、AdGuard Home 等广告过滤工具。</p><ul><li><a href="https://pi-hole.net/">Pi-hole – Network-wide protection</a></li><li><a href="https://adguard.com/zh%5C_cn/adguard-home/overview.html">AdGuard Home| 适用于任何操作系统（Windows，macOS，Linux）的网络软件</a></li><li><a href="https://sspai.com/post/63088">AdGuard Home 安装及使用指北</a></li><li><a href="https://sspai.com/post/52813">AdGuard Home：用 DNS 巧去广告，所有设备都能用</a></li><li><a href="https://sspai.com/post/58183">基于树莓派的全能广告屏蔽助手 —— Pi-hole</a></li></ul><p>这些工具做为 <a href="https://zh.wikipedia.org/wiki/%E5%9F%9F%E5%90%8D%E7%B3%BB%E7%BB%9F">DNS</a> 服务器运行，能够记录和统计家庭网络中所有设备的 DNS 请求，同时屏蔽广告域名和恶意域名。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/10/10/8853899e2e9e9b5665167d82914ed4f9.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/10/10/8853899e2e9e9b5665167d82914ed4f9.png" referrerpolicy="no-referrer"><figcaption>AdGuard Home 仪表盘界面</figcaption></figure><p>不过，一部分设备可能会使用固定的 DNS 服务器地址，或者使用 DNS-over-TLS、DNS-over-HTTPS 等新型的<a href="https://sspai.com/post/56783">加密 DNS 协议</a>，无法由用户指定 DNS 服务器。对于这样的设备，Pi-hole 等工具就无能为力了。</p><h3>DPI</h3><p><a href="https://baike.baidu.com/item/%E6%B7%B1%E5%BA%A6%E5%8C%85%E6%A3%80%E6%B5%8B%E6%8A%80%E6%9C%AF/623511">DPI</a> 全称为「深度包检测」，能够深入分析经过网络设备的所有数据，以便于对智能家居设备的行为进行分析。</p><p>与 Pi-hole 等基于 DNS 的工具相比，DPI 能监控智能家居设备所产生的所有网络流量，实现更全面的分析。</p><p>一部分路由器自带了 DPI 功能，例如 <a href="https://www.ui.com/edgemax/edgerouter/">Ubiquiti EdgeRouter</a>。对于使用开源操作系统（例如 <a href="https://openwrt.org/">OpenWrt</a> 或 <a href="https://www.pfsense.org/">pfSense</a>）的路由器，可通过安装 ntopng 来实现 DPI 功能：</p><ul><li><a href="https://www.ntop.org/products/traffic-analysis/ntop/">ntopng – ntop</a></li></ul><h3>IDS/IPS</h3><p>IDS 全称为「入侵检测系统」，IPS 全称为「入侵防御系统」。这两者在 DPI 的基础上，增加了安全策略，从而可以实现对恶意行为的检测和拦截。常见的 IDS/IPS 包括 SNORT 和 Suricata：</p><ul><li><a href="https://www.snort.org/">Snort - Network Intrusion Detection & Prevention System</a></li><li><a href="https://suricata.io/">Suricata</a></li></ul><p>在这篇文章中，我们可以看出，通过 SNORT 规则，可以检测网络中是否有利用摄像头漏洞进行攻击的活动：</p><ul><li><a href="https://www.cisco.com/c/dam/m/zh_cn/products/security/talos/pdfs/foscam-multiple-vulns.pdf">漏洞聚焦：Foscam C1 室内高清摄像机存在多个漏洞</a></li></ul><p>IDS/IPS 需要网络设备有较高的性能，在家用路由器里，<a href="https://www.asus.com/Content/AiProtection/">华硕</a>等品牌的部分型号支持 IPS/IDS。对于拥有高性能软路由的读者，可自行安装 SNORT 或 Suricata，其中，<a href="https://www.pfsense.org/">pfSense</a> 和 <a href="https://opnsense.org/">OPNSense</a> 操作系统对 SNORT/Suricata 的支持比较完善。</p><h3>蜜罐</h3><blockquote><p>蜜罐（英语：honeypot）是一个电脑术语，专指用来侦测或抵御未经授权操作或者是黑客攻击的陷阱，因原理类似诱捕昆虫的蜜罐因而得名。 — <a href="https://zh.wikipedia.org/wiki/%E8%9C%9C%E7%BD%90_(%E9%9B%BB%E8%85%A6%E7%A7%91%E5%AD%B8)">Wikipedia</a></p></blockquote><p>之前某品牌电视自动扫描内网、尝试通过 SSH 登录内网设备，通过蜜罐，就可以方便的「抓出」这些行为</p><p>前文中提到的，某些品牌的电视自动扫描内网、尝试通过 SSH 登录内网设备的行为，通过蜜罐，就能非常容易地被发现。</p><p>部分路由器自带蜜罐功能，例如笔者正在使用的 UniFi Dream Machine，就带有一个简单的蜜罐。从截图中可以看到，有内网设备访问了蜜罐上的 21、23、80 端口，可以根据这些信息，确认内网设备是否有恶意行为。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/10/10/f41f03cc1cb8a1a3fc7494b3eb96424b.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/10/10/f41f03cc1cb8a1a3fc7494b3eb96424b.png" referrerpolicy="no-referrer"><figcaption>UniFi Dream Machine 上的蜜罐</figcaption></figure><p>也可以自行在路由器、Raspberry Pi 等设备上安装蜜罐。开源的蜜罐有很多种，可以参考如下链接了解：</p><ul><li><a href="https://github.com/paralax/awesome-honeypots/blob/master/README%5C_CN.md">awesome-honeypots/README_CN.md at master · paralax/awesome-honeypots</a></li></ul><h3>抓包</h3><p>除了上文中介绍的方法，还有一种适合专业的用户的方法：抓包。</p><p>抓包指的是用工具记录下网络中经过的所有报文，以便于后续进行人工分析。常用的抓包工具是 Wireshark，能够通过图形化的界面来捕获和分析报文：</p><ul><li><a href="https://www.wireshark.org/">Wireshark · Go Deep.</a></li></ul><p>tcpdump 则是一款基于命令行界面的抓包工具。一部分基于 Linux 操作系统的路由器，已经内置了 tcpdump 工具：</p><ul><li><a href="https://www.tcpdump.org/">TCPDUMP/LIBPCAP public repository</a></li></ul><p>抓包的结果，需要进行人工分析，才能知道智能家居设备的行为。所以，这种方式只适合专业用户使用。如下链接的博客节目中，有通过抓包方式观察到光猫异常行为的案例，可供大家参考：</p><ul><li><a href="https://pan.icu/61">吟诗的光猫 | 内核恐慌 #61</a></li></ul><h2>那么，这样做是不是太麻烦了？</h2><p>上文中介绍了一系列提高智能家居设备安全性的方法。一部分方法操作较为繁琐，甚至会限制智能家居的部分功能......</p><p>使用智能家居本来是为了<strong>方便</strong>。使用了这些方法，是不是过于复杂，得不偿失了？</p><p>在《<a href="https://sspai.com/post/67797">你的必要隐私手册Android 篇：权限管控与存储空间隔离</a>》一文中，作者 <a href="https://sspai.com/u/pokon548/">pokon548</a> 说到：</p><blockquote><p>隐私与便利是一门平衡的艺术，世上并不存在绝对的隐私。</p></blockquote><p>其实，对于智能家居设备的安全与隐私问题，也是同样的道理。本文列举了提高智能家居安全性的一系列方式，读者可以根据自身情况，选择出最适合自己的方式，来取得安全与便利的平衡。</p><p> </p><p>当然，也不是说采用了本文中的所有措施，就一定能保护好安全和隐私了。最重要的是，做为用户，我们需要逐步提高安全意识。相反，如果安全意识不足，部分采用本文中的方法，可能还会引入新的安全问题：例如使用 Home Assistant 时，如果没有设置强密码、没有及时更新，且 Home Assistant 暴露在公网，可能就会导致家庭网络被入侵。</p><p>另外，对于非常敏感的数据，最好还是尽量保持「离线」。例如摄像头尽量不要放在卧室、智能电视在不用的时候彻底断电、不需要智能功能的设备直接断开网络......</p><hr><p>> 题图来自 <a href="https://unsplash.com/">Unsplash</a>，作者是 <a href="https://unsplash.com/@danlefeb">Dan LeFebvre</a>。本文部分图片素材来自 <a href="https://www.flaticon.com/">Flaticon</a>，作者分别是 <a href="https://www.flaticon.com/authors/xnimrodx">xnimrodx</a>、<a href="https://www.freepik.com/">Freepik</a>、<a href="https://www.flaticon.com/authors/dinosoftlabs">DinosoftLabs</a>。<br>> 想要了解更多关于家庭网络的知识？欢迎在 GitHub 上关注 <a href="https://github.com/blanboom/awesome-home-networking-cn">blanboom/awesome-home-networking-cn</a>。</p><p> </p></div><!----></div><div style="border:1px solid transparent;" data-v-6a669db8></div><div class="article-side sideTop" style="display:none;left:0;" data-v-7be936cf data-v-6a669db8><div class="download-guide-container" data-v-14f9065e data-v-7be936cf><div class="btn-wrapper" data-v-14f9065e><!----><button class="btn btn-view" data-v-14f9065e><i class="iconfont iconfont-phone" data-v-14f9065e></i></button></div><a href="https://sspai.com/s/JYjP" target="_blank" data-v-14f9065e><!----></a></div><div class="item-wrapper" data-v-7be936cf><button class="btn btn-charge" data-v-7be936cf><i class="iconfont" data-v-7be936cf></i></button><span class="count" data-v-7be936cf>10</span></div><div class="item-wrapper" data-v-7be936cf><button class="btn-mini btn-comment" data-v-7be936cf><i class="iconfont iconfont-comment" data-v-7be936cf></i></button><span class="count" data-v-7be936cf>4</span></div><div class="item-wrapper" data-v-7be936cf><span data-v-7be936cf><div role="tooltip" id="el-popover-6115" aria-hidden="true" class="el-popover el-popper popper-share right ss-popper-dark-border" style="width:undefinedpx;display:none;"><!----><div class="article-side-share-btn"><a href="https://service.weibo.com/share/share.php?url=null?ref=weibo&title=%E3%80%90%E5%A6%82%E4%BD%95%E5%A2%9E%E5%BC%BA%E6%99%BA%E8%83%BD%E5%AE%B6%E5%B1%85%E8%AE%BE%E5%A4%87%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7%E3%80%91%E6%99%BA%E8%83%BD%E5%AE%B6%E5%B1%85%E8%AE%BE%E5%A4%87%EF%BC%8C%E7%8E%B0%E5%9C%A8%E5%B7%B2%E7%BB%8F%E4%B8%8D%E6%98%AF%E4%BB%80%E4%B9%88%E3%80%8C%E6%96%B0%E9%B2%9C%E4%BA%8B%E7%89%A9%E3%80%8D%E3%80%82%E5%9C%A8%E5%B8%82%E5%9C%BA%E4%B8%8A%EF%BC%8C%E6%88%91%E4%BB%AC%E8%83%BD%E5%A4%9F%E7%9C%8B%E5%88%B0%E5%90%84%E7%A7%8D%E5%90%84%E6%A0%B7%E7%9A%84%E6%99%BA%E8%83%BD%E5%AE%B6%E5%B1%85%E8%AE%BE%E5%A4%87%EF%BC%8C%E4%BE%8B%E5%A6%82%E6%89%AB%E5%9C%B0%E6%9C%BA%E5%99%A8%E4%BA%BA%E3%80%81%E7%A9%BA%E6%B0%94%E5%87%80%E5%8C%96%E5%99%A8%E3%80%81%E7%9B%91%E6%8E%A7%E6%91%84%E5%83%8F%E5%A4%B4%E3%80%81%E6%99%BA%E8%83%BD%E6%8F%92%E5%BA%A7%E3%80%81%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&pic=https%3A%2F%2Fcdn.sspai.com%2F2021%2F10%2F10%2Fada80a34fedc28750c820e145a26b441.jpg%3FimageMogr2%2Fauto-orient%2Fquality%2F95%2Fthumbnail%2F!1420x708r%2Fgravity%2FCenter%2Fcrop%2F1420x708%2Finterlace%2F1&appkey=3196502474#" target="_blank"><i class="iconfont iconfont-weibo-simple right-16"></i></a><span><div role="tooltip" id="el-popover-3106" aria-hidden="true" class="el-popover el-popper" style="width:undefinedpx;display:none;"><!----><div style="text-align:center;"><div id="qr-code"></div><small class="qr-small">扫码分享</small></div></div><span class="el-popover__reference-wrapper"><i class="iconfont iconfont-wechat-simple right-16"></i></span></span><a href="https://twitter.com/share?text=%E3%80%90%E5%A6%82%E4%BD%95%E5%A2%9E%E5%BC%BA%E6%99%BA%E8%83%BD%E5%AE%B6%E5%B1%85%E8%AE%BE%E5%A4%87%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7%E3%80%91%E6%99%BA%E8%83%BD%E5%AE%B6%E5%B1%85%E8%AE%BE%E5%A4%87%EF%BC%8C%E7%8E%B0%E5%9C%A8%E5%B7%B2%E7%BB%8F%E4%B8%8D%E6%98%AF%E4%BB%80%E4%B9%88%E3%80%8C%E6%96%B0%E9%B2%9C%E4%BA%8B%E7%89%A9%E3%80%8D%E3%80%82%E5%9C%A8%E5%B8%82%E5%9C%BA%E4%B8%8A%EF%BC%8C%E6%88%91%E4%BB%AC%E8%83%BD%E5%A4%9F%E7%9C%8B%E5%88%B0%E5%90%84%E7%A7%8D%E5%90%84%E6%A0%B7%E7%9A%84%E6%99%BA%E8%83%BD%E5%AE%B6%E5%B1%85%E8%AE%BE%E5%A4%87%EF%BC%8C%E4%BE%8B%E5%A6%82%E6%89%AB%E5%9C%B0%E6%9C%BA%E5%99%A8%E4%BA%BA%E3%80%81%E7%A9%BA%E6%B0%94%E5%87%80%E5%8C%96%E5%99%A8%E3%80%81%E7%9B%91%E6%8E%A7%E6%91%84%E5%83%8F%E5%A4%B4%E3%80%81%E6%99%BA%E8%83%BD%E6%8F%92%E5%BA%A7%E3%80%81%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&url=null" target="_blank" class="twitter"><i class="iconfont iconfont-twitter-simple right-16"></i></a></div></div><span class="el-popover__reference-wrapper"><button class="btn-mini btn-share" data-v-7be936cf><i class="iconfont iconfont-share" data-v-7be936cf></i></button></span></span></div><div class="item-wrapper" data-v-7be936cf><button class="btn-mini btn-collect" data-v-7be936cf><i class="iconfont iconfont-collect" data-v-7be936cf></i></button></div><!----></div><!---->  
</div>
            