
---
title: '为 Xperia 开启 Magisk 之路'
categories: 
 - 新媒体
 - 少数派 sspai
 - Matrix
headimg: 'https://cdn.sspai.com/2021/08/10/a0ce34833e4c8d36baa83f22fe13fa1f.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
author: 少数派 sspai
comments: false
date: Tue, 10 Aug 2021 01:04:46 GMT
thumbnail: 'https://cdn.sspai.com/2021/08/10/a0ce34833e4c8d36baa83f22fe13fa1f.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
---

<div>   
<div class="articleWidth-content" data-v-3e67f99b><div class="content wangEditor-txt minHeight" data-v-3e67f99b><p>不同于 Pixel 的简单明了，Google 的合作 OEM 厂商设备取得 Root 权限都是需要经过一番折腾的，刚好前一阵子为 Xperia 1 II 的 Magisk 安装耗费了不少心思，这次就算是记录一下，顺便和大家分享。</p><p>各个设备的安装方式基本上都和《Android 玩家必备神器入门：从零开始安装 Magisk》介绍的一样，都是配置好环境 → 解锁 BL → 安装 Magisk App → 提取镜像 → 使用 App 修改镜像 → 刷入镜像这几个步骤，其中为 Xperia 解锁 BL 等操作在各个论坛上均有很多教程了，这里就不再啰嗦，直接从提取镜像开始吧。</p><h2>提取 boot.image</h2><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/08/10/a0ce34833e4c8d36baa83f22fe13fa1f.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/08/10/a0ce34833e4c8d36baa83f22fe13fa1f.png" referrerpolicy="no-referrer"><figcaption>通过 XperiFirm 下载固件</figcaption></figure><p>和 Pixel 不一样，索尼并没有为旗下设备提供原厂镜像，所以没办法直接获取我们需要的 boot.img，于是就要借用第三方工具——XperiFirm。通过 XperiFirm 直接查询得到机器最新的官方固件，以我手上的 Xperia 1 II 为例，因为是港版机器，所以选择 XQ-AT52，选择对应的香港地区，就能下载固件了。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/08/10/86c341d3666aeea139ea67f36cd5dd52.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/08/10/86c341d3666aeea139ea67f36cd5dd52.png" referrerpolicy="no-referrer"><figcaption>注意设置选项</figcaption></figure><p>需要提醒的是，请在 XperiFirm 设置中勾选「Unpack firmware automatically」，这样 XperiFirm 就会在下载完成后自动进行解压，不需要手动再解压固件。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/08/10/706fbc42b7563a53e98468234163bb4f.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/08/10/706fbc42b7563a53e98468234163bb4f.png" referrerpolicy="no-referrer"><figcaption>一个完整的固件包</figcaption></figure><p>下载并解压完成的固件包基本结构和图中类似，有一个 boot 文件夹，一个 partition 文件夹，以及一堆后缀为 sin 和 ta 的文件。其中名字为「boot_X-FLASH-ALL-xxxx」的 sin 文件就是我们需要的 boot 文件，图中的就是「boot_X-FLASH-ALL-2389.sin」这个文件。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/08/10/fa7e32718c06e46025fdfdb0e8b3f086.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/08/10/fa7e32718c06e46025fdfdb0e8b3f086.png" referrerpolicy="no-referrer"><figcaption>获得 img 格式的镜像文件</figcaption></figure><p>只是索尼提供的这个并不是常见的 img 格式文件，Magisk App 是没办法对这种 sin 文件进行修改的，这时我们就要借助另一个工具 UnSIN。顾名思义，UnSIN 就是将 sin 文件处理成 img 文件，直接将得到的「boot_X-FLASH-ALL-xxxx.sin」拖拽到「unsin.exe」中，我们就能获得一个 img 格式的镜像了。</p><h2>修改 boot.image</h2><p>拿到了镜像，自然就是要开始修改了，直接将这个镜像丢进 Magisk App 进行修改，获得一个以「magisk_patched」开头的镜像，如果你的 Xperia 是 Android 10 以下的系统，恭喜你，你可以准备为机器直接输入这个镜像获得 Root 权限了；但你若是 Android 11 的系统<s>（反正 Xperia 现在都没有 Android 12 beta）</s>，直接刷入会导致机器无限重启，也就是 bootloop 的情况，根据 <a href="https://github.com/topjohnwu/Magisk/issues/3752#issuecomment-769528085" target="_blank">Magisk Github issue</a> 反馈得知，似乎是因为索尼在 Android 11 的固件中加入了「system_ext」相关代码造成的，反正这锅肯定是索尼背了。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/08/10/f62e2840e0fb8cf1e6fd0ee49a2b69d4.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/08/10/f62e2840e0fb8cf1e6fd0ee49a2b69d4.png" referrerpolicy="no-referrer"><figcaption>一行代码搞死人</figcaption></figure><p>知道原因就好处理了，这时需要用到第三个工具——Android Image Kitchen。使用 Android Image Kitchen 将 Magisk App 修改过的镜像进行 unpack，就会得到两个文件夹，一个是「ramdisk」，一个是「split_img」。</p><p>进入「ramdisk」，找到名为「fstab」的文件使用记事本打开，能看到一行以「system_ext」开头的代码，将这行代码删掉并保存。将修改后的「ramdisk」和「split_img」进行 repack，就能得到「image-new」的 img 文件，这就是我们所需要的镜像。</p><h2>刷入 boot.image</h2><p>到这里的话就简单多了，利用解锁 BL 配置好的环境为 Xperia 刷入我们千辛万苦得到的「image-new」镜像就好了。如果是使用命令行的话，按住音量上键通过 USB 数据线连接电脑进行 fastboot Mode（指示灯亮蓝灯），使用以下代码即可：</p><blockquote><p>fastboot flash boot_a image-new.img<br>fastboot flash boot_b image-new.img<br>fastboot reboot</p></blockquote><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/08/10/d4603728ffc19d66dbd9252607cfeec4.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/08/10/d4603728ffc19d66dbd9252607cfeec4.png" referrerpolicy="no-referrer"><figcaption>flashtool 的工具箱真的好用</figcaption></figure><p>不过我倒是比较喜欢用 flashtool 多一些，直接连接上 Xperia，通过 Fastboot Toolbox 的「Reboot into fastboot mode(via ADB)」，再选择「select kernel to flash」刷入内核镜像，最后选择「Reboot device into system」等待开机即可，不用手打命令行舒服多了（笑）。</p><p> </p><p> </p><p>P.S. 题图来自索尼官网。文中所使用的相关工具均可在 XDA 上下载，也已共享在<a href="https://pan.baidu.com/s/1Dg9sOAAxNOKHvG_MbyIlAQ" target="_blank">网盘</a>（提取码：h6uz），有需求可自行下载使用。</p></div><!----></div><div style="border:1px solid transparent;" data-v-3e67f99b></div><div class="article-side sideTop" style="display:none;left:0;" data-v-7be936cf data-v-3e67f99b><div class="download-guide-container" data-v-14f9065e data-v-7be936cf><div class="btn-wrapper" data-v-14f9065e><!----><button class="btn btn-view" data-v-14f9065e><i class="iconfont iconfont-phone" data-v-14f9065e></i></button></div><a href="https://sspai.com/s/JYjP" target="_blank" data-v-14f9065e><!----></a></div><div class="item-wrapper" data-v-7be936cf><button class="btn btn-charge" data-v-7be936cf><i class="iconfont" data-v-7be936cf></i></button><span class="count" data-v-7be936cf>8</span></div><div class="item-wrapper" data-v-7be936cf><button class="btn-mini btn-comment" data-v-7be936cf><i class="iconfont iconfont-comment" data-v-7be936cf></i></button><span class="count" data-v-7be936cf>0</span></div><div class="item-wrapper" data-v-7be936cf><span data-v-7be936cf><div role="tooltip" id="el-popover-8448" aria-hidden="true" class="el-popover el-popper popper-share right ss-popper-dark-border" style="width:undefinedpx;display:none;"><!----><div class="article-side-share-btn"><a href="https://service.weibo.com/share/share.php?url=null?ref=weibo&title=%E3%80%90%E4%B8%BA%20Xperia%20%E5%BC%80%E5%90%AF%20Magisk%20%E4%B9%8B%E8%B7%AF%E3%80%91%E4%B8%8D%E5%90%8C%E4%BA%8EPixel%E7%9A%84%E7%AE%80%E5%8D%95%E6%98%8E%E4%BA%86%EF%BC%8CGoogle%E7%9A%84%E5%90%88%E4%BD%9COEM%E5%8E%82%E5%95%86%E8%AE%BE%E5%A4%87%E5%8F%96%E5%BE%97Root%E6%9D%83%E9%99%90%E9%83%BD%E6%98%AF%E9%9C%80%E8%A6%81%E7%BB%8F%E8%BF%87%E4%B8%80%E7%95%AA%E6%8A%98%E8%85%BE%E7%9A%84%EF%BC%8C%E5%88%9A%E5%A5%BD%E5%89%8D%E4%B8%80%E9%98%B5%E5%AD%90%E4%B8%BAXperia1II%E7%9A%84Mag%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&pic=https%3A%2F%2Fcdn.sspai.com%2F2021%2F08%2F10%2F2225d6193d50ec58d0dc9bfa08c14637.jpeg%3FimageMogr2%2Fauto-orient%2Fquality%2F95%2Fthumbnail%2F!1420x708r%2Fgravity%2FCenter%2Fcrop%2F1420x708%2Finterlace%2F1&appkey=3196502474#" target="_blank"><i class="icon icon-article_weibo right-16"></i></a><span><div role="tooltip" id="el-popover-8144" aria-hidden="true" class="el-popover el-popper" style="width:undefinedpx;display:none;"><!----><div style="text-align:center;"><div id="qr-code"></div><small class="qr-small">扫码分享</small></div></div><span class="el-popover__reference-wrapper"><i class="icon icon-article_weixin right-16"></i></span></span><a href="https://twitter.com/share?text=%E3%80%90%E4%B8%BA%20Xperia%20%E5%BC%80%E5%90%AF%20Magisk%20%E4%B9%8B%E8%B7%AF%E3%80%91%E4%B8%8D%E5%90%8C%E4%BA%8EPixel%E7%9A%84%E7%AE%80%E5%8D%95%E6%98%8E%E4%BA%86%EF%BC%8CGoogle%E7%9A%84%E5%90%88%E4%BD%9COEM%E5%8E%82%E5%95%86%E8%AE%BE%E5%A4%87%E5%8F%96%E5%BE%97Root%E6%9D%83%E9%99%90%E9%83%BD%E6%98%AF%E9%9C%80%E8%A6%81%E7%BB%8F%E8%BF%87%E4%B8%80%E7%95%AA%E6%8A%98%E8%85%BE%E7%9A%84%EF%BC%8C%E5%88%9A%E5%A5%BD%E5%89%8D%E4%B8%80%E9%98%B5%E5%AD%90%E4%B8%BAXperia1II%E7%9A%84Mag%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&url=null" target="_blank" class="twitter"><i class="icon icon-article_twitter right-16"></i></a></div></div><span class="el-popover__reference-wrapper"><button class="btn-mini btn-share" data-v-7be936cf><i class="iconfont iconfont-share" data-v-7be936cf></i></button></span></span></div><div class="item-wrapper" data-v-7be936cf><button class="btn-mini btn-collect" data-v-7be936cf><i class="iconfont iconfont-collect" data-v-7be936cf></i></button></div><!----></div><!---->  
</div>
            