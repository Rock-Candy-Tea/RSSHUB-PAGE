
---
title: '一日一技｜巧用 VLC 下载微信小程序视频'
categories: 
 - 新媒体
 - 少数派 sspai
 - Matrix
headimg: 'https://cdn.sspai.com/2021/08/23/165dd0e2b53c68bd1c2134a7ac4463b9.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
author: 少数派 sspai
comments: false
date: Mon, 23 Aug 2021 02:32:10 GMT
thumbnail: 'https://cdn.sspai.com/2021/08/23/165dd0e2b53c68bd1c2134a7ac4463b9.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
---

<div>   
<div class="articleWidth-content" data-v-6a669db8><div class="content wangEditor-txt minHeight" data-v-6a669db8><blockquote><p>最近有朋友问能不能帮忙下载微信小程序里的视频，这里把方法记录下来，供有需要的人参考</p></blockquote><p>此次需要下载的是一个在微信小程序「票圈vlog」里的视频</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/08/23/165dd0e2b53c68bd1c2134a7ac4463b9.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/08/23/165dd0e2b53c68bd1c2134a7ac4463b9.png" referrerpolicy="no-referrer"><figcaption>微信分享链接</figcaption></figure><p>在微信电脑版打开后显示如下</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/08/23/140673738821d91d506510f4d5eaa161.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/08/23/140673738821d91d506510f4d5eaa161.png" referrerpolicy="no-referrer"></figure><p>使用的是腾讯内置浏览器，既没有F12调试工具，也不能通过常规浏览器打开，无法直接获取视频地址信息；按过往经验，基于http协议的可能性较大，搬出Fiddler分析http流量</p><h2>流量分析</h2><p>Fiddler作为常见的web流量分析工具适用于分析与http协议相关的流量</p><p>Wireshark亦可，但捕获的数据和细节会更多，筛选时需要多花时间</p><h3>工具准备</h3><p><a href="https://www.telerik.com/download/fiddler">下载一个免费版Fiddler</a>「Telerik Fiddler Classic」并安装</p><p><i>如需注册可使用YOPmail匿名邮箱服务绕过</i></p><h3>开始抓包</h3><ol><li>准备待打开的微信小程序视频链接，先不打开，放一边</li><li>「以管理员身份运行」刚刚安装好的Fiddler流量分析工具，开始收集流量信息</li><li>打开待分析的微信小程序视频，视频播放几秒后把整个小程序窗口关掉</li><li>按键盘F12停止Fiddler继续收集流量信息</li></ol><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/08/22/05ff5574b7aa56912284bd1d9486c353.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/08/22/05ff5574b7aa56912284bd1d9486c353.png" referrerpolicy="no-referrer"><figcaption>Capturing表示当前正在收集</figcaption></figure><h3>检出视频地址</h3><p>Fiddler已经为每个会话打上了编号并<a href="https://docs.telerik.com/fiddler/knowledge-base/uiguide" target="_blank">标记</a>其所属类型，注意视频开始加载前的部分</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/08/22/42707bf4362b74cdd85de8a75fc2f2d0.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/08/22/42707bf4362b74cdd85de8a75fc2f2d0.png" referrerpolicy="no-referrer"><figcaption>编号49</figcaption></figure><p>此处可看到第一条与视频有关的会话开始于编号50，编号49和50使用的是同一个Host，检查编号49的会话，发现一个以.m3u8为尾缀的http请求</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/08/22/48bee1128f1205deeaa299339b52f63a.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/08/22/48bee1128f1205deeaa299339b52f63a.png" referrerpolicy="no-referrer"><figcaption>复制会话URL</figcaption></figure><p><a href="https://www.jianshu.com/p/e97f6555a070" target="_blank">m3u8</a> 可归为基于HTTP的流媒体传输协议一类，多见于电视盒子，可以播放但不能直接下载，此时我们需要一个能转录该视频的工具：VLC Media Player</p><h2>下载视频</h2><p><a href="https://www.videolan.org/index.zh.html" target="_blank">VLC Media Player</a> 支持直接播放基于HTTP的音视频流，也支持将视频流内容转换成本地文件</p><h3>兼容性检查</h3><p>并非所有基于HTTP的流媒体VLC都能播放，先尝试播放</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/08/23/066b54c5842b742470c9635384d9e848.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/08/23/066b54c5842b742470c9635384d9e848.png" referrerpolicy="no-referrer"><figcaption>打开网络串流</figcaption></figure><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/08/23/8ef6e241cbce2f048417137a89047e2d.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/08/23/8ef6e241cbce2f048417137a89047e2d.png" referrerpolicy="no-referrer"><figcaption>播放正常</figcaption></figure><p>注意声音和画面是否正常，<strong>结束时间戳</strong>是否和小程序里的一致</p><h3>设置转录</h3><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/08/23/8aacea4222a6e9c84204f21c692665c3.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/08/23/8aacea4222a6e9c84204f21c692665c3.png" referrerpolicy="no-referrer"><figcaption>播放改为「转换」</figcaption></figure><p>VLC内置了几种常见的音视频配置，此处音频和视频内容我们都要，括号内代表转换后的本地视频格式；如果你仅需要音频/视频，可以指定为单纯的音频或视频格式</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/08/23/d8ba286534f946bb992f32ff10dee65d.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/08/23/d8ba286534f946bb992f32ff10dee65d.png" referrerpolicy="no-referrer"><figcaption>设定合适的配置文件</figcaption></figure><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/08/22/b989e9b4473098d2341763ae52721aab.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/08/22/b989e9b4473098d2341763ae52721aab.png" referrerpolicy="no-referrer"><figcaption>选择合适的存储位置和文件名，开始转换</figcaption></figure><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/08/22/da4f5541964ed3dcc04637a045d762bf.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/08/22/da4f5541964ed3dcc04637a045d762bf.png" referrerpolicy="no-referrer"><figcaption>正在下载</figcaption></figure><p>进度条会比正常的播放快一些，此时可以干别的事情，进度条走完即表示视频已全部下载完成</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2021/08/22/e795a9cfd1c572f7243ae86c83b40947.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2021/08/22/e795a9cfd1c572f7243ae86c83b40947.png" referrerpolicy="no-referrer"></figure><h3>脚本化</h3><p>方便下次快速调用VLC</p><p>打开网络串流</p><p><code>"C:\Program Files\VideoLAN\VLC\vlc.exe" URL</code></p><p>转换网络串流为本地MP4文件</p><p><code>C:\Program Files\VideoLAN\VLC>vlc.exe --sout "#transcode&#123;vcodec=h265,acode=mp3,ab=128,channels=2,samplerate=44100&#125;:std&#123;access=file,mux=ts,dst=E:\a.mp4&#125;" URL</code></p><h2>参考材料</h2><p><a href="https://wiki.videolan.org/transcode/" target="_blank">VLC Transcode</a></p><p style="margin-left:0px;"><a href="https://wiki.videolan.org/Documentation:Streaming_HowTo_New/" target="_blank">VLC Documentation - Streaming HowTo</a></p><p style="margin-left:0px;"><a href="https://wiki.videolan.org/Documentation:Streaming_HowTo/Advanced_Streaming_Using_the_Command_Line" target="_blank">VLC Documentation - Advanced Streaming Using the Command Line</a></p></div><!----></div><div style="border:1px solid transparent;" data-v-6a669db8></div><div class="article-side sideTop" style="display:none;left:0;" data-v-7be936cf data-v-6a669db8><div class="download-guide-container" data-v-14f9065e data-v-7be936cf><div class="btn-wrapper" data-v-14f9065e><!----><button class="btn btn-view" data-v-14f9065e><i class="iconfont iconfont-phone" data-v-14f9065e></i></button></div><a href="https://sspai.com/s/JYjP" target="_blank" data-v-14f9065e><!----></a></div><div class="item-wrapper" data-v-7be936cf><button class="btn btn-charge" data-v-7be936cf><i class="iconfont" data-v-7be936cf></i></button><span class="count" data-v-7be936cf>11</span></div><div class="item-wrapper" data-v-7be936cf><button class="btn-mini btn-comment" data-v-7be936cf><i class="iconfont iconfont-comment" data-v-7be936cf></i></button><span class="count" data-v-7be936cf>4</span></div><div class="item-wrapper" data-v-7be936cf><span data-v-7be936cf><div role="tooltip" id="el-popover-8850" aria-hidden="true" class="el-popover el-popper popper-share right ss-popper-dark-border" style="width:undefinedpx;display:none;"><!----><div class="article-side-share-btn"><a href="https://service.weibo.com/share/share.php?url=null?ref=weibo&title=%E3%80%90%E4%B8%80%E6%97%A5%E4%B8%80%E6%8A%80%EF%BD%9C%E5%B7%A7%E7%94%A8%20VLC%20%E4%B8%8B%E8%BD%BD%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E8%A7%86%E9%A2%91%E3%80%91%E6%9C%80%E8%BF%91%E6%9C%89%E6%9C%8B%E5%8F%8B%E9%97%AE%E8%83%BD%E4%B8%8D%E8%83%BD%E5%B8%AE%E5%BF%99%E4%B8%8B%E8%BD%BD%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E9%87%8C%E7%9A%84%E8%A7%86%E9%A2%91%EF%BC%8C%E8%BF%99%E9%87%8C%E6%8A%8A%E6%96%B9%E6%B3%95%E8%AE%B0%E5%BD%95%E4%B8%8B%E6%9D%A5%EF%BC%8C%E4%BE%9B%E6%9C%89%E9%9C%80%E8%A6%81%E7%9A%84%E4%BA%BA%E5%8F%82%E8%80%83%E6%AD%A4%E6%AC%A1%E9%9C%80%E8%A6%81%E4%B8%8B%E8%BD%BD%E7%9A%84%E6%98%AF%E4%B8%80%E4%B8%AA%E5%9C%A8%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E3%80%8C%E7%A5%A8%E5%9C%88vlog%E3%80%8D%E9%87%8C%E7%9A%84%E8%A7%86%E9%A2%91%E5%BE%AE%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&pic=&appkey=3196502474#" target="_blank"><i class="iconfont iconfont-weibo-simple right-16"></i></a><span><div role="tooltip" id="el-popover-6300" aria-hidden="true" class="el-popover el-popper" style="width:undefinedpx;display:none;"><!----><div style="text-align:center;"><div id="qr-code"></div><small class="qr-small">扫码分享</small></div></div><span class="el-popover__reference-wrapper"><i class="iconfont iconfont-wechat-simple right-16"></i></span></span><a href="https://twitter.com/share?text=%E3%80%90%E4%B8%80%E6%97%A5%E4%B8%80%E6%8A%80%EF%BD%9C%E5%B7%A7%E7%94%A8%20VLC%20%E4%B8%8B%E8%BD%BD%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E8%A7%86%E9%A2%91%E3%80%91%E6%9C%80%E8%BF%91%E6%9C%89%E6%9C%8B%E5%8F%8B%E9%97%AE%E8%83%BD%E4%B8%8D%E8%83%BD%E5%B8%AE%E5%BF%99%E4%B8%8B%E8%BD%BD%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E9%87%8C%E7%9A%84%E8%A7%86%E9%A2%91%EF%BC%8C%E8%BF%99%E9%87%8C%E6%8A%8A%E6%96%B9%E6%B3%95%E8%AE%B0%E5%BD%95%E4%B8%8B%E6%9D%A5%EF%BC%8C%E4%BE%9B%E6%9C%89%E9%9C%80%E8%A6%81%E7%9A%84%E4%BA%BA%E5%8F%82%E8%80%83%E6%AD%A4%E6%AC%A1%E9%9C%80%E8%A6%81%E4%B8%8B%E8%BD%BD%E7%9A%84%E6%98%AF%E4%B8%80%E4%B8%AA%E5%9C%A8%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E3%80%8C%E7%A5%A8%E5%9C%88vlog%E3%80%8D%E9%87%8C%E7%9A%84%E8%A7%86%E9%A2%91%E5%BE%AE%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&url=null" target="_blank" class="twitter"><i class="iconfont iconfont-twitter-simple right-16"></i></a></div></div><span class="el-popover__reference-wrapper"><button class="btn-mini btn-share" data-v-7be936cf><i class="iconfont iconfont-share" data-v-7be936cf></i></button></span></span></div><div class="item-wrapper" data-v-7be936cf><button class="btn-mini btn-collect" data-v-7be936cf><i class="iconfont iconfont-collect" data-v-7be936cf></i></button></div><!----></div><!---->  
</div>
            