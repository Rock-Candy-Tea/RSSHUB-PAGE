
---
title: '轻量级开源免费博客评论系统解决方案 （Cusdis + Railway）'
categories: 
 - 新媒体
 - 少数派 sspai
 - Matrix
headimg: 'https://cdn.sspai.com/2022/05/24/ef1a2297932e949c3e141d452cf2e510.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
author: 少数派 sspai
comments: false
date: Wed, 25 May 2022 04:04:59 GMT
thumbnail: 'https://cdn.sspai.com/2022/05/24/ef1a2297932e949c3e141d452cf2e510.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1'
---

<div>   
<div class="articleWidth-content" data-v-6dd0eb6a><div class="update-wrap" data-v-6dd0eb6a></div><div class="content wangEditor-txt minHeight" data-v-6dd0eb6a><h2>前言</h2><p>之前写了一篇《<a href="https://www.pseudoyu.com/zh/2022/03/24/free_blog_deploy_using_hugo_and_cusdis/">免费的个人博客系统搭建及部署解决方案（Hugo + GitHub Pages + Cusdis）</a>》，讲述了一下我使用 Serverless 和一些开源项目搭建的博客系统，也开了个系列来记录搭建过程。</p><p>本篇是关于博客评论系统的解决方案，我最早使用的博客评论系统是<s>万恶的</s> <a href="https://disqus.com/">Disqus</a>，一个笨重且会收集用户隐私的知名评论系统，因为加载比较慢，且免费版本经常会附带一些广告，实在难以忍受，于是换成了另一个基于 GitHub issues 的评论系统 <a href="https://utteranc.es/">utterances</a>，它会为每篇文章生成一个 issue，将，用户通过授权 GitHub 登录来对 issue 发表评论。这种方式的好处是只需要授权一个 <a href="https://github.com/utterances-bot">utterances-bot</a> 来进行管理，无需自己部署服务，维护数据库等。但是用了一段时间后，觉得有几点不足：</p><ol><li>基于 GitHub API 进行评论管理，如之后接口变动或对这类利用 issue 进行评论的方式进行限制，会不太稳定</li><li>读者必须要授权 GitHub 登录，非技术人员或使用移动端阅读的读者使用起来很不方便</li><li>会将 GitHub 仓库弄得较乱，也不方便后续迁移到其他系统</li></ol><p>经过一番调研 <a href="https://lutaonan.com/">Randy</a> 的 <a href="https://cusdis.com/">Cusdis</a> 很合我的心意。Cusdis 是一个注重数据隐私的开源的评论系统，十分轻量，经过 gzipped 后大约只有 5kb，从名字来看也知道开发者也是难以忍受 Disqus，自己做了一个替代版，因此它也是支持 Disqus 历史数据导入的，很贴心。</p><p>虽然这是一个开发早期的项目，但是已经提供了电子邮件通知以及通过 Webhook 联动 Telegram 等方式进行评论提醒，对使用者来说很方便进行管理。Cusdis 提供了免费托管服务与自行部署两种方式，如果不想折腾可以直接用作者提供的服务。自行部署则需要服务器与一个 Postgre SQL 实例，我们主要示范一下自行部署方式。</p><p>因为在上一篇 《<a href="https://www.pseudoyu.com/zh/2022/05/21/free_blog_analysis_using_umami_vercel_and_heroku/">从零开始搭建一个免费的个人博客数据统计系统（umami + Vercel + Heroku）</a>》 中我使用的是 <a href="http://vercel.com/">Vercel</a> 和 <a href="https://www.heroku.com/">Heroku</a> 进行搭建的，作为一个爱折腾的人，这个评论系统我们就用 <a href="https://railway.app/">Railway</a> 来搭建部署。</p><p>Railway 和 Vercel 类似，也是一个 PaaS 平台，能够支持多种语言项目的部署。对于个人项目来说，它每月提供的 5 美元免费额度非常够用，实测了一下，把之前的 <a href="https://www.pseudoyu.com/zh/2022/03/24/free_blog_deploy_using_hugo_and_cusdis/">umami 网站数据统计系统</a> 连同 Postgre SQL 数据库实例部署在 Railway 平台，大约一个月 0.7 美元，对于个人使用来说完全足够。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/05/24/ef1a2297932e949c3e141d452cf2e510.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/05/24/ef1a2297932e949c3e141d452cf2e510.png" referrerpolicy="no-referrer"></figure><p>比起 Vercel，它同时支持部署数据库实例，可以将数据库与实例一起部署在单个项目中，减少搭建维护成本。下文会对具体搭建部署流程做个记录，因为官方支持 Railway 一键部署方式，整个搭建流程很顺畅。</p><h2>搭建部署说明</h2><h3>使用 Railway 一键部署服务与数据库实例</h3><p>首先注册一个 Railway 账号，可以用我的<a href="https://railway.app/?referralCode=J0F5LQ">邀请链接</a>。注册登录完成后，点击右上角 New Project 新建项目。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/05/24/02bd98313a7f15505c7d2110327b2378.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/05/24/02bd98313a7f15505c7d2110327b2378.png" referrerpolicy="no-referrer"></figure><p>然后输入 Cusdis 进行搜索，点击出现的项目即可开始部署。前几步也可以通过点击 <a href="https://github.com/djyde/cusdis">Cusdis 项目仓库</a> 中的 <code>Deploy on Railway</code> 按钮进行一键部署。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/05/24/a888bd39ff822e485712c626a9487473.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/05/24/a888bd39ff822e485712c626a9487473.png" referrerpolicy="no-referrer"></figure><p>开始部署前，需要手动填入三个环境变量：</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/05/24/350509684d2637bf1313a1a355b92615.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/05/24/350509684d2637bf1313a1a355b92615.png" referrerpolicy="no-referrer"></figure><ol><li>USERNAME: 用来登录的账户</li><li>PASSWORD: 用来登录的密码</li><li>JWT_SECRET: 一个随机字符串</li></ol><p>其他一些环境变量已经预先设置默认值，请不要自行修改。</p><ol><li>NEXTAUTH_URL: <code>$&#123;&#123; RAILWAY_STATIC_URL &#125;&#125;</code></li><li>DB_TYPE: <code>pgsql</code></li><li>DB_URL: <code>$&#123;&#123; DATABASE_URL &#125;&#125;</code></li><li>PORT: <code>3000</code></li></ol><p>点击部署后，等待完成即可，会自动部署服务并初始化数据库。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/05/24/dc41901758ec4099548ff466076e0247.jpeg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/05/24/dc41901758ec4099548ff466076e0247.jpeg" referrerpolicy="no-referrer"></figure><h3>配置 CUSDIS 脚本至个人博客</h3><p>部署完成后，点击 cusdis 服务生成的链接，点击访问服务 Dashboard。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/05/24/cbcba7f2c2ef43db582448f134afd0cc.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/05/24/cbcba7f2c2ef43db582448f134afd0cc.png" referrerpolicy="no-referrer"></figure><p>此处输入部署前配置的用户名与密码，点击登录。登录完成后，点击 Dashboard，进入项目配置页面。</p><p>初次登录会弹窗提示需要配置第一个网站，输入网站名称即可完成添加。后续当我们需要添加网站时，点击侧边栏 New Website，填写网站名称即可完成添加。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/05/24/7f1f77526cb626836219a4cfcdad8f00.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/05/24/7f1f77526cb626836219a4cfcdad8f00.png" referrerpolicy="no-referrer"></figure><p>因为我已经配置了自己的网站，所以界面会有之前的评论记录。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/05/24/f051530a9b78c7a60207789de3b05b5a.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/05/24/f051530a9b78c7a60207789de3b05b5a.png" referrerpolicy="no-referrer"></figure><p>下面我们点击上方 Embed Code，复制弹窗中的代码。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/05/24/b445f60a1d768c75e22d601e0b7a2ff6.jpeg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/05/24/b445f60a1d768c75e22d601e0b7a2ff6.jpeg" referrerpolicy="no-referrer"></figure><p>这部份代码需要根据你所用的博客网站类型不同进行部分修改，具体可参考<a href="https://cusdis.com/doc#/">官方文档</a> 的 Integration 模块进行配置。</p><p>我所用的是 <a href="https://gohugo.io/">Hugo</a>，配置如下：</p><pre class="language-htmlembedded"><code><div id="cusdis_thread" 
  data-host="xxx"
  data-app-id="xxx"
  data-page-id="&#123;&#123; .File.UniqueID &#125;&#125;"
  data-page-url="&#123;&#123; .Permalink &#125;&#125;"
  data-page-title="&#123;&#123; .Title &#125;&#125;"
>
</div>

<script defer src="https://cusdis.com/js/widget/lang/zh-cn.js"></script>
<script async defer src="xxx"></script></code></pre><p>其中的 <code>data-host</code>，<code>data-app-id</code> 等都需要以刚复制出的 Embed Code 内容为准。其中 <code><script defer src="https://cusdis.com/js/widget/lang/zh-cn.js"></script></code> 主要实现了汉化，不同语言支持详见<a href="https://cusdis.com/doc#/advanced/i18n">文档 i18n 模块</a>。</p><p>修改后，将其添加到博客的相应位置（一般在最下方），配置部署后，即可看到评论框，呈现效果如下：</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/05/24/ede24757566b103cd72d560d2646a433.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/05/24/ede24757566b103cd72d560d2646a433.png" referrerpolicy="no-referrer"></figure><h3>配置自定义域名</h3><p>Railway 部署自动生成的域名比较长，且有一些字符，不方便记忆。我们可以在 Railway 中为项目配置自定义域名。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/05/24/0c9e8378e9aaa6cc41ce500000b2177d.jpeg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/05/24/0c9e8378e9aaa6cc41ce500000b2177d.jpeg" referrerpolicy="no-referrer"></figure><p>填入想要配置的域名/二级域名后，根据官方提示添加 DNS 解析。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/05/24/417f0ef174ee4e8c842ef69b427f1bea.jpeg?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/05/24/417f0ef174ee4e8c842ef69b427f1bea.jpeg" referrerpolicy="no-referrer"></figure><p>至此，我们的部署已经完成，可以通过域名访问管理后台，进行评论审核管理等。</p><h3>更新项目</h3><p>如前文所述，Cusdis 还是一个正在开发成长的项目，我们想第一时间更新作者发布的新功能。Railway 提供了十分便捷的上游分支管理功能，可以设置项目的父项目，点击即可拉取最新更新，很方便。</p><figure class="image ss-img-wrapper"><img src="https://cdn.sspai.com/2022/05/25/247b2bbc48a0ab6da13cad2fd71edb56.png?imageView2/2/w/1120/q/40/interlace/1/ignore-error/1" data-original="https://cdn.sspai.com/2022/05/25/247b2bbc48a0ab6da13cad2fd71edb56.png" referrerpolicy="no-referrer"></figure><h2>总结</h2><p>以上就是我们为网站添加 Cusdis 评论系统的全流程，配置完成后无需后续维护，可以便捷地通过看板来进行网站管理与评论审核，且数据存储在 Postgre SQL 数据库实例中，方便导出备份与迁移。这是我的博客搭建部署系列教程之一，请持续关注，希望能对大家有所参考。</p><h2>参考资料</h2><ol><li><a href="https://cusdis.com/">Cusdis 项目官网</a></li><li><a href="https://railway.app/">Railway 官方网站</a></li><li><a href="https://reorx.com/blog/deploy-umami-for-personal-website/">搭建 umami 收集个人网站统计数据</a></li></ol></div><div class="update-details-wrap" data-v-6dd0eb6a></div><!----></div><div style="border:1px solid transparent;" data-v-6dd0eb6a></div><div class="article-side sideTop" style="display:none;left:0;" data-v-7be936cf data-v-6dd0eb6a><div class="download-guide-container" data-v-14f9065e data-v-7be936cf><div class="btn-wrapper" data-v-14f9065e><!----><button class="btn btn-view" data-v-14f9065e><i class="iconfont iconfont-phone" data-v-14f9065e></i></button></div><a href="https://sspai.com/s/JYjP" target="_blank" data-v-14f9065e><!----></a></div><div class="item-wrapper" data-v-7be936cf><button class="btn btn-charge" data-v-7be936cf><i class="iconfont" data-v-7be936cf></i></button><span class="count" data-v-7be936cf>2</span></div><div class="item-wrapper" data-v-7be936cf><button class="btn-mini btn-comment" data-v-7be936cf><i class="iconfont iconfont-comment" data-v-7be936cf></i></button><span class="count" data-v-7be936cf>0</span></div><div class="item-wrapper" data-v-7be936cf><span data-v-7be936cf><div role="tooltip" id="el-popover-2878" aria-hidden="true" class="el-popover el-popper popper-share right ss-popper-dark-border" style="width:undefinedpx;display:none;"><!----><div class="article-side-share-btn"><a href="https://service.weibo.com/share/share.php?url=null?ref=weibo&title=%E3%80%90%E8%BD%BB%E9%87%8F%E7%BA%A7%E5%BC%80%E6%BA%90%E5%85%8D%E8%B4%B9%E5%8D%9A%E5%AE%A2%E8%AF%84%E8%AE%BA%E7%B3%BB%E7%BB%9F%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%20%EF%BC%88Cusdis%20%2B%20Railway%EF%BC%89%E3%80%91%E5%89%8D%E8%A8%80%E4%B9%8B%E5%89%8D%E5%86%99%E4%BA%86%E4%B8%80%E7%AF%87%E3%80%8A%E5%85%8D%E8%B4%B9%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F%E6%90%AD%E5%BB%BA%E5%8F%8A%E9%83%A8%E7%BD%B2%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%EF%BC%88Hugo%2BGitHubPages%2BCusdis%EF%BC%89%E3%80%8B%EF%BC%8C%E8%AE%B2%E8%BF%B0%E4%BA%86%E4%B8%80%E4%B8%8B%E6%88%91%E4%BD%BF%E7%94%A8Serverle%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&pic=https%3A%2F%2Fcdn.sspai.com%2F2022%2F05%2F24%2F1257d8663f39aafd927f4df7a42006fb.png%3FimageMogr2%2Fauto-orient%2Fquality%2F95%2Fthumbnail%2F!1420x708r%2Fgravity%2FCenter%2Fcrop%2F1420x708%2Finterlace%2F1&appkey=3196502474#" target="_blank"><i class="iconfont iconfont-weibo-simple right-16"></i></a><span><div role="tooltip" id="el-popover-2606" aria-hidden="true" class="el-popover el-popper" style="width:undefinedpx;display:none;"><!----><div style="text-align:center;"><div id="qr-code"></div><small class="qr-small">扫码分享</small></div></div><span class="el-popover__reference-wrapper"><i class="iconfont iconfont-wechat-simple right-16"></i></span></span><a href="https://twitter.com/share?text=%E3%80%90%E8%BD%BB%E9%87%8F%E7%BA%A7%E5%BC%80%E6%BA%90%E5%85%8D%E8%B4%B9%E5%8D%9A%E5%AE%A2%E8%AF%84%E8%AE%BA%E7%B3%BB%E7%BB%9F%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%20%EF%BC%88Cusdis%20%2B%20Railway%EF%BC%89%E3%80%91%E5%89%8D%E8%A8%80%E4%B9%8B%E5%89%8D%E5%86%99%E4%BA%86%E4%B8%80%E7%AF%87%E3%80%8A%E5%85%8D%E8%B4%B9%E7%9A%84%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F%E6%90%AD%E5%BB%BA%E5%8F%8A%E9%83%A8%E7%BD%B2%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%EF%BC%88Hugo%2BGitHubPages%2BCusdis%EF%BC%89%E3%80%8B%EF%BC%8C%E8%AE%B2%E8%BF%B0%E4%BA%86%E4%B8%80%E4%B8%8B%E6%88%91%E4%BD%BF%E7%94%A8Serverle%EF%BC%88%E6%9D%A5%E8%87%AA%20%40%E5%B0%91%E6%95%B0%E6%B4%BEsspai%EF%BC%89%E5%85%A8%E6%96%87%EF%BC%9A&url=null" target="_blank" class="twitter"><i class="iconfont iconfont-twitter-simple right-16"></i></a></div></div><span class="el-popover__reference-wrapper"><button class="btn-mini btn-share" data-v-7be936cf><i class="iconfont iconfont-share" data-v-7be936cf></i></button></span></span></div><div class="item-wrapper" data-v-7be936cf><button class="btn-mini btn-collect" data-v-7be936cf><i class="iconfont iconfont-collect" data-v-7be936cf></i></button></div><!----></div><!---->  
</div>
            