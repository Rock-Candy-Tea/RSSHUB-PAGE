
---
title: '如何从0-1重构建消息系统：服务端'
categories: 
 - 新媒体
 - PMCAFF
 - 今日推荐 / 精选
headimg: 'https://cors.zfour.workers.dev/?http://img.pmcaff.com/40f3a2168012fe2481f2041784298c6c-picture'
author: PMCAFF
comments: false
date: Sun, 09 Jan 2022 20:27:29 GMT
thumbnail: 'https://cors.zfour.workers.dev/?http://img.pmcaff.com/40f3a2168012fe2481f2041784298c6c-picture'
---

<div>   
<div><style>
#articleCont &#123;
  font-size: 16px;
  line-height: 1.6;
  color: #333;
  word-wrap: break-word;
&#125;
#articleCont :first-child &#123;
  margin-top: 0 !important;
&#125;
#articleCont h1,
#articleCont h2,
#articleCont h3,
#articleCont h4,
#articleCont h5,
#articleCont h6 &#123;
  margin: 40px 0 20px;
&#125;
#articleCont h1 &#123;
  font-size: 24px;
&#125;
#articleCont h2 &#123;
  font-size: 22px;
&#125;
#articleCont h3 &#123;
  font-size: 20px;
&#125;
#articleCont h4 &#123;
  font-size: 18px;
&#125;
#articleCont h5 &#123;
  font-size: 16px;
&#125;
#articleCont i &#123;
  font-style: italic;
&#125;
#articleCont p,
#articleCont div &#123;
  word-wrap: break-word;
  margin: 14px 0;
  text-align: justify;
&#125;
#articleCont blockquote &#123;
  border-left: 6px solid #ddd;
  padding: 5px 0 5px 10px;
&#125;
#articleCont blockquote p:last-child &#123;
  margin-bottom: 0;
&#125;
#articleCont .simditor-body blockquote :last-child &#123;
  margin-bottom: 0;
&#125;
#articleCont a &#123;
  color: #82b64a;
&#125;
#articleCont a:visited &#123;
  color: #82b64a;
&#125;
#articleCont a:hover &#123;
  color: #74a342;
&#125;
#articleCont img &#123;
  max-width: 100%;
  height: auto;
&#125;
#articleCont hr &#123;
  margin: 19px 0;
  border: none;
  border-top: solid 1px #ddd;
&#125;
#articleCont ol &#123;
  list-style-type: decimal;
&#125;
#articleCont ol li &#123;
  list-style-type: decimal;
&#125;
#articleCont ul &#123;
  list-style-type: disc;
  padding-left: 40px;
&#125;
#articleCont ul li &#123;
  list-style-type: disc;
&#125;
#articleCont table &#123;
  width: 100%;
  font-size: 12px;
  border-collapse: collapse;
  line-height: 1.7;
&#125;
#articleCont table thead &#123;
  background: #f9f9f9;
&#125;
#articleCont table th,
#articleCont table td &#123;
  border: solid 1px #ccc;
  text-align: left;
  vertical-align: top;
  padding: 2px 4px;
  height: 30px;
  min-width: 40px;
  box-sizing: border-box;
&#125;
#articleCont pre &#123;
  white-space: pre-wrap;
&#125;
</style><p>在庞大的后台系统中，怎么搭建消息系统的服务端，本文将结合上一篇《如何从0-1重构建消息系统：客户端》简单整理此次重建的流程及功能设计，希望对大家有所帮助；</p><p>在设计和搭建服务端产品时，与客户端产品来说是具有一定的差异性，首先产品在目标用户上有明确的区分，客户端主要是面对普通用户，而服务端主要是公司内部人员使用；产品的功能设计上，客户端的交互设计和视觉体验相对于要求比较高，必须满足品牌传播等很多要求，而客户端要求功能流程清晰，交互简单明确，保障前端业务正常开展，数据流程闭环等要求；</p><h2><span style="color:rgb(0,0,0);">1.重构背景</span></h2><p>此次消息后台的重构，主要需要对APP的应用级的消息渠道push推送、站内信的重构进行业务支撑，明确优化方向后，我们通业务侧的调研得出我们要重构的目标：</p><ol><li> 消息管理-相关权限人可在消息系统后台创建系统自动触发消息和手动推送消息，并且这些消息可以推送给APP客户端、公众号的渠道用户；</li><li>  整合现有公司业务的推送消息类型、系统消息推送机制、消息模版（系统消息模版和手推消息模版）、消息推送，并且消息管理相关权限人可以进行管理操作；</li><li> 可以满足各种场景下的消息推送需求；</li></ol><h2>2.消息系统规划</h2><p>消息系统的重构后，服务端主要由四大模块构成：</p><p>1.消息类型管理；2.消息模版管理；3.系统触发管理；4.手动推送管理；</p><p><img src="https://cors.zfour.workers.dev/?http://img.pmcaff.com/40f3a2168012fe2481f2041784298c6c-picture" alt width="538" height="370" coffee-w="798px" coffee-h="548px" coffee-format="png" referrerpolicy="no-referrer"></p><p>设计具体方案前，我们先来分析一下消息系统服务端的各模块的功能：</p><h3>2.1消息类型管理</h3><p>客户端进行重构的重要原因之一，由于业务的增加，造成消息类型不明确，消息等级错乱，所以我们首先对于消息中心进行了消息类型的划分，并采用了消息分类合并方式；所以在设计后台功能的时候，我们设计了消息类型管理模块了，主要作用：</p><ul><li>为客户端的消息类型字段提供数据支撑；</li><li>随着业务的业务的扩展和合并的，运营可以在后台扩充消息类型，并且可以实现前后端类型的分离，方便管理；</li><li>可以很好的解决业务的扩展和合并的情况，导致前端技术需要重新对前端消息类型代码再次编写；</li></ul><p><span style="color:rgb(102,102,102);">如策略部同事需要新增一个新业务，给用户提供市场上宏观经济信息，则需要添加二级消息「市场解读」，如果后台没有可配置的后台，则需要前端或者客户端技术在前端编写代码，进行发版解决；</span></p><h3>2.2消息模版管理</h3><p>大家可以理解为一个预编的消息池，里面保存了系统触发消息模版和手动推送消息模版，主要作用：</p><ul><li>完整的记录了系统触发的消息的类型、内容等，业务同学可以在此模块中找到在系统中运行的任何一条系统触发消息，不需要技术同学再去扒代码找一条系统消息；</li><li>方便运营的同学在编写手推或者自动触发消息时，省去寻找相似类似业务的消息模版，大大节省了业务方同学在编写消息时的效率；</li></ul><p>需要注意系统触发消息模版如果已经在使用，则不可以随意编辑，以免造成消息发送事故；</p><h3>2.3系统触发管理</h3><p>先解释一下此系统中什么叫做系统触发消息功能，将消息发送的逻辑写在业务流程逻辑代码中，当满足条件时，触发消息发送功能。此模块主要进行系统触发的关键机制的查看，及时的记录每个部门或业务消息触发机制，可以避免随着部门和人员的业务更迭，造成触发机制的信息无法自知的想象，方便每个部门对系统触发消息及消息渠道的查看、记录；</p><p>如运营部门新增了直播业务，我们需要对整个业务流程进行分析，需要系统自动触发的消息机制有哪些，并且推动那种渠道，及推动的的消息类型有哪些；</p><p> </p><p><img src="https://cors.zfour.workers.dev/?http://img.pmcaff.com/215ee72b6f085bc361c4c3a5345dd887-picture" alt width="465" height="324" coffee-w="1274px" coffee-h="888px" coffee-format="png" referrerpolicy="no-referrer"></p><p> </p><p>1.当用户点击已预约以后，则系统会自动发送给用户一条预约成功的「站内信」，则后台记录触发机制为「用户点击预约直播按钮后」，发送的消息类型「站内信」，消息名称为「预约成功」提醒；</p><p>2.当开播前15分钟，系统会自动给成功预约本场直播的用户发送直播开始的「站内信」、「Push消息」，则后台记录的触发机制为「直播开始前15分钟，给所有预约成功用户发送观看开播提醒」，消息名称为「开播提醒」；</p><p> </p><p><img src="https://cors.zfour.workers.dev/?http://img.pmcaff.com/5f4904c126ccf1f11abf56f0e03e8ed5-picture" alt width="453" height="165" coffee-w="1916px" coffee-h="696px" coffee-format="png" referrerpolicy="no-referrer"></p><p> </p><p>这就是一个完整的触发消息机制的记录，需要注意的是，因为系统触发机制都是由技术编写在后台代码中，所以我们新的业务需要增加系统自动触发的机制的时候，需要同步后台技术，需要技术进行代码实现，才可以运行触发条件；</p><h3>2.4手动推送管理</h3><p>此模块为手动推送消息的主要功能模块，运营和各业务部门的同学可以在此模块完成消息内容的编写或选取，消息类型的选择、发送渠道的配置、发送时间的选择、消息接受人的选择等主要推送机制的设置；</p><h2>3.原型规划</h2><p>通过结合对客户端、服务端功能的分析，我们开始对消息系统服务端主要模块的功能进行产品方案设计，以下笔者会一一讲解主要的功能构成：</p><p><img src="https://cors.zfour.workers.dev/?http://img.pmcaff.com/9948a07bc739d886ac4e11f06874612e-picture" alt width="651" height="1119" coffee-w="983px" coffee-h="1689px" coffee-format="jpeg" referrerpolicy="no-referrer"></p><p>功能结构图</p><p> <span style="color:rgb(0,0,0);">3.1消息类型管理设计</span></p><p style="text-align:center;"><img src="https://cors.zfour.workers.dev/?http://img.pmcaff.com/20efa059738c60380af8ab7773e9a509-picture" alt width="561" height="270" coffee-w="1742px" coffee-h="840px" coffee-format="png" referrerpolicy="no-referrer"></p><p style="text-align:center;">消息类型列表</p><p><strong>字段及功能说明</strong></p><ul><li>消息类型：主要对系统中所有消息进行分类整理，如果业务类型层级比较复杂，则可以在某一个业务类型一级消息下，在设计二级分类；并且可以对消息类型进行编辑，如更改消息类型名称、增加或删除消息类型；</li></ul><p>需要注意的是我们在更改消息类型名称后，需要对以往原消息类型的历史消息进行继承，对已经有历史消息的消息类型不能进行删除；</p><p> <span style="color:rgb(0,0,0);">3.2消息模版管理设计</span></p><p style="text-align:center;"><img src="https://cors.zfour.workers.dev/?http://img.pmcaff.com/2e3630d7cb8bfc4f1a3bae35fdcb6ddf-picture" alt width="607" height="216" coffee-w="1660px" coffee-h="590px" coffee-format="png" referrerpolicy="no-referrer"></p><p style="text-align:center;">手动推送消息模版列表</p><p><strong>字段及功能说明</strong></p><p>此模块分为系统触发消息模版管理和手动推送消息模版管理，系统触发模版中含有代码中包含的参数，这个是系统触发模版和手动推送模版需要做成两个管理版块的原因；</p><p>以手动推送消息模版列表为主要列举对象：</p><ul><li>消息标题：显示消息的主标题；</li><li>消息摘要：对于消息内容的概括，根据客户端和渠道内容的要求，后台做字符、样式、位置等限制。</li><li>消息内容：根据客户端的要求，后台做字符、样式、位置等限制，如果渠道内容类型比较多，则可以不显示；</li><li>消息类型：消息在客户端显示归属的消息类型；</li><li>渠道内容推送：显示此条消息包含的消息渠道内容；</li><li>编辑时间：显示最后编辑消息时间；</li><li>消息编辑人：显示最后编辑人姓名；</li></ul><p>需要注意在操作系统触发消息模版的时候，如果此条系统触发模版消息已经和系统触发机制关联，则无法进行删除和编辑；</p><p> <span style="color:rgb(0,0,0);">3.3系统触发管理设计</span></p><p style="text-align:center;"><img src="https://cors.zfour.workers.dev/?http://img.pmcaff.com/adfc96c43655774ff4d30840a6feab5e-picture" alt width="642" height="176" coffee-w="1614px" coffee-h="442px" coffee-format="png" referrerpolicy="no-referrer"></p><p style="text-align:center;">系统触发机制列表</p><p><strong>字段及功能说明</strong></p><ul><li>系统触发机制：将消息发送的逻辑写在业务流程逻辑代码中，当满足条件时，触发消息发送，此时的消息发送逻辑我们称其为系统触发机制，此处把代码中的触发机制反显出来；</li><li>系统触发消息模版：系统消息触发机制对应的消息模版，消息机制可以更换消息模版；</li></ul><p>在禁用消息机制的时候，需要提醒业务方是否取消关联的系统消息模版；</p><h3><strong>3.4手动推送管理</strong></h3><p style="text-align:center;"><img src="https://cors.zfour.workers.dev/?http://img.pmcaff.com/4f9a2b4d9e9cfbbe3c99e1a807e95a5e-picture" alt width="588" height="226" coffee-w="1512px" coffee-h="582px" coffee-format="png" referrerpolicy="no-referrer"></p><p style="text-align:center;">手动推送消息列表</p><p><strong>字段及功能说明</strong></p><ul><li>消息标题、消息摘要、消息内容、消息类型、渠道内容类型和消息模版管理一致，此处省略；</li><li>推送用户群体：此消息推送的用户类型；</li><li>用户数：推送用户的数量；</li><li>推送渠道：消息推送的具体端口及渠道；</li><li>推送人：记录最后发送此消息的人员；</li><li>推送时间：消息发送的时间记录；</li><li>推送状态：分为未发送、已测试发送、已发送三种状态；<br><ol><li>当消息未发送时，需要对消息进行测试发送后，发送按钮才可以被激活进行正式发送；</li><li>当消息测试发送后，则可以进行正式发送；</li><li>当消息发送后，可以对消息进行引用，再次使用此条消息进行发送</li></ol></li></ul><p style="text-align:center;"><img src="https://cors.zfour.workers.dev/?http://img.pmcaff.com/87a69a2e53026b099c6a6bbc874bfa85-picture" alt width="563" height="321" coffee-w="1212px" coffee-h="690px" coffee-format="png" referrerpolicy="no-referrer"></p><p style="text-align:center;">推送机制</p><p>在消息模版管理的时候，我们已经简述了消息的主体部分编辑关键信息，在手动推送消息时，我们还需要对主体消息配置推送机制：</p><ul><li>推送渠道：设计时需要考虑业务所覆盖的所有渠道，在此系统中则是需要针对此条消息的所属渠道内容进行配置；</li><li>推送方式：1）实时推送，点击推送按钮则可以发送；2）定时推送，可以选择具体的日期和时间发送消息；</li><li>推送用户：1）全体用户，2）自定义，主要针对业务方做定制化开发或手动上传用户信息；</li><li>消息发送参数：针对系统发送能力进行合理优化分配发送的机制；</li><li>测试用户：业务方对于新消息的线上测试检查是不可缺少的环节，需要配置的测试用户可以在此设置；</li></ul><h2>4.写在最后的话</h2><p>本文作为「如何从0-1重构建消息系统：客户端」的姊妹篇，简单记录笔者在规划消息系统服务端时的一个思路。服务端除了需要支持现在运行的客户端功能数据展示和数据流转，还需要对未来客户端业务功能扩容做研判，这样才能更好的支持客户端的用户体验和数据流转，提高开发效率。</p><p>以上就是笔者0-1重构消息系统的全部记录，希望对观看此文的诸位有所帮助和借鉴。</p><p style="text-align:center;"><img src="https://cors.zfour.workers.dev/?http://img.pmcaff.com/a35c5507a254492f9133b5ab2126c55a-picture" alt width="607" height="364" coffee-w="1774px" coffee-h="1064px" coffee-format="png" referrerpolicy="no-referrer"></p><p style="text-align:center;">透过结构看世界！我是大大大大浪，一个永远热泪盈眶的产品汪！</p></div>
  
</div>
            