
---
title: '屡次让拳头翻车的ping：作者因车祸英年早逝，千行源码改变世界'
categories: 
 - 新媒体
 - 36kr
 - 资讯
headimg: 'https://img.36krcdn.com/20220519/v2_a3c3bbb31f544d24be8ca0d48a1df815_img_000'
author: 36kr
comments: false
date: Thu, 19 May 2022 04:57:41 GMT
thumbnail: 'https://img.36krcdn.com/20220519/v2_a3c3bbb31f544d24be8ca0d48a1df815_img_000'
---

<div>   
<p>也是没想到，“<strong>ping</strong>”这么个计算机术语，竟然在英雄联盟MSI话题下被讨论上了热搜。</p> 
<p>无论在微博还是<a class="project-link" data-id="1679660102701827" data-name="知乎" data-logo="https://img.36krcdn.com/20220401/v2_8825cd75ab9f4ae39cc609a380d5c12a_img_000" data-refer-type="1" href="https://36kr.com/project/1679660102701827" target="_blank">知乎</a>，不少“ping”相关话题的热度已经过千万甚至上亿。</p> 
<p class="image-wrapper"><img data-img-size-val="1080,305" src="https://img.36krcdn.com/20220519/v2_a3c3bbb31f544d24be8ca0d48a1df815_img_000" referrerpolicy="no-referrer"></p> 
<p>从话题下的讨论来看，不少网友甚至产生了对ping的研究热情：</p> 
<p class="image-wrapper"><img data-img-size-val="1080,327" src="https://img.36krcdn.com/20220519/v2_e084e2c7e96a4022887a84475b701453_img_000" referrerpolicy="no-referrer"></p> 
<p>说起来，经常玩联机游戏的小伙伴，想必对ping都不陌生。</p> 
<p>谁还没感受过几次被<strong>ping值</strong>支配的恐惧呢？（手动狗头）</p> 
<p class="image-wrapper"><img data-img-size-val="652,350" src="https://img.36krcdn.com/20220519/v2_24382a453ad2470d9d198e8a2725dbd1_img_000" referrerpolicy="no-referrer"></p> 
<p label="图片描述" classname="img-desc" class="img-desc" style><strong>△</strong>高ping战士无所畏惧</p> 
<p>ping值越高，代表着打游戏时的网络延迟越高，表现到游戏中，就是延迟低的比延迟高的人更快做出各种（击杀、移动等）动作。</p> 
<p class="image-wrapper"><img data-img-size-val="1080,375" src="https://img.36krcdn.com/20220519/v2_0f58200f937b4e0eb3a1a50c82ce13c7_img_000" referrerpolicy="no-referrer"></p> 
<blockquote> 
 <p>注意，这里的ping值<strong>并不代表</strong>你的网速。</p> 
 <p>这么说吧，如果你的数据包是一份快递的话，网速越高代表卡车吨量越大，而ping值则代表了这辆卡车能跑得多快、路上有多堵。</p> 
 <p>越低的ping值，意味着你的网络越畅通，但和它一次能搬运多少数据并没有什么关系。</p> 
</blockquote> 
<p>但你知道，ping最初是如何被发明出来的吗？</p> 
<p>其实，这个如今在打游戏、开会和测延迟中“无处不在”的计算机技术，当年竟然是被“随手”写出来的。</p> 
<p>故事还要从80年代的时候说起。</p> 
<h2><strong>来自1983年的千行代码</strong></h2> 
<p>这个名叫ping的工具，最初是由一位叫<strong>Michael John Muuss</strong>的老哥搞出来的。</p> 
<p class="image-wrapper"><img data-img-size-val="418,450" src="https://img.36krcdn.com/20220519/v2_b1c6e2fbf2104097badbecbe1e6d126a_img_000" referrerpolicy="no-referrer"></p> 
<p>Muuss出生于1958年，从约翰·霍普金斯大学毕业后，在美国陆军一个名叫“阿伯丁试验场”的兵器试验中心做研究，主要与计算机网络和几何建模等方向有关。</p> 
<p>例如，<strong>光线追踪</strong>在80年代刚火起来那会儿，Muuse老哥就已经在潜心研究相应的技术了。</p> 
<p>期间他做了不少相关成果，但反而是“随手发明”出来的ping，如今成了最著名的网络工具之一。</p> 
<p>ping应用广泛到什么程度？</p> 
<p>从最初的Unix系统，到如今的Windows、macOS和Linux，ping虽然历经好几个版本，但一直在各个操作系统上被广泛使用。</p> 
<p>如今我们在GitHub上随手一搜，能看到不少实现ping的代码，但这些都不是最初的版本了。</p> 
<p class="image-wrapper"><img data-img-size-val="1080,335" src="https://img.36krcdn.com/20220519/v2_fa8d0fda33a346efa1a224a96f8aa597_img_000" referrerpolicy="no-referrer"></p> 
<p>Muuss在自己的主页上提供了ping最初的源代码，然而我们点进去后就会发现，网页跳转了好几次，最终似乎也无法下载：</p> 
<p class="image-wrapper"><img data-img-size-val="712,32" src="https://img.36krcdn.com/20220519/v2_eb636ef928c046878e217ffa48d22308_img_000" referrerpolicy="no-referrer"></p> 
<p class="image-wrapper"><img data-img-size-val="1080,301" src="https://img.36krcdn.com/20220519/v2_6cd5476cc41849d9894038df4e45d7b7_img_000" referrerpolicy="no-referrer"></p> 
<p>事实上，我们还能看到Muuss的主页，本身就已经不寻常了——</p> 
<p>2000年时，Muuss不幸因车祸去世，当时他才刚过完自己的42岁生日：</p> 
<p class="image-wrapper"><img data-img-size-val="1080,452" src="https://img.36krcdn.com/20220519/v2_9ed8e4e1b9614c38b4dfd51690a555f5_img_000" referrerpolicy="no-referrer"></p> 
<p>还好在Web Archive上保存了那个时候的网页，我们得以看见ping的<strong>第一版源代码</strong>。</p> 
<p>这份代码文件名是<strong>ping.shar</strong>，一个非常有年代感的后缀，如今已经基本没有人使用这个文件扩展名了。</p> 
<p>它是一个41KB大小的文件，从编辑器中来看，大约有1600行左右的代码：</p> 
<p class="image-wrapper"><img data-img-size-val="1080,1321" src="https://img.36krcdn.com/20220519/v2_5ea7324519ce4b48a75a691aef5e90bb_img_000" referrerpolicy="no-referrer"></p> 
<p>那么，ping究竟是怎么诞生的，又是如何被普及开来的？</p> 
<h2><strong>ping是如何被普及的？</strong></h2> 
<p>最初编写这份代码的时候，Muuss完全没想过它后来会这么火。</p> 
<p>毕竟最初的ping，只是一个用来排查实验室网络异常的<strong>测试工具</strong>。</p> 
<p>事情源于1983年12月的一天，Muuss在阿伯丁试验场的弹道研究实验室（BRL）中做实验时，突然发现实验室的<strong>IP网络</strong>出现了异常情况。</p> 
<p>这时候，他回忆起几个月前，自己曾参与过一次DARPA在挪威举办的研讨会，会上一位名叫Dave Mills的博士，提到过用ICMP数据包测试延迟的方法。</p> 
<p>Muuss认为，这个工具的原理，就像是发射声波并接收它的回波以计算往返时间一样。</p> 
<p class="image-wrapper"><img data-img-size-val="820,442" src="https://img.36krcdn.com/20220519/v2_d6ddb8b615d74bbeaaad6cc02b8bcc96_img_000" referrerpolicy="no-referrer"></p> 
<p label="图片描述" classname="img-desc" class="img-desc" style><strong>△</strong>声呐，图源维基百科</p> 
<p>刚好Muuss在大学的时候学过不少声呐和雷达系统的建模，他很快写了一个程序，并将之命名为ping，在声呐中指代声音脉冲、也就是信号的意思。</p> 
<p>随后，Muuss<strong>只用了一晚上</strong>，就将ping的程序写了出来。</p> 
<p>虽然写出来的时候，他所在的实验室已经将网络问题解决了，但Muuss还是将它作为一个公<a class="project-link" data-id="1678500529255432" data-name="有领" data-logo="https://img.36krcdn.com/20220331/v2_a3a4a28882024df783211f0407babfe6_img_000" data-refer-type="1" href="https://36kr.com/project/1678500529255432" target="_blank">有领</a>域软件（public domain software，使用时无需许可证）发布了出去。</p> 
<p>很快加州大学伯克利分校的Erick Engelke发现了这份软件，将它改写了一版（遵循GPL开源协议），放入伯克利自己开发的Unix操作系统BSD4.3版本中。</p> 
<p>随后，计算机工程师Tim Crawford又基于MIT开源协议，写了一个ReactOS版本的ping代码。</p> 
<p>再之后，ping被各个计算机大牛写入各种操作系统如macOS、Linux和Windows中，又加入了更多的功能。</p> 
<p class="image-wrapper"><img data-img-size-val="1080,159" src="https://img.36krcdn.com/20220519/v2_06f7b979a9454f4a9325738fa484b51d_img_000" referrerpolicy="no-referrer"></p> 
<p label="图片描述" classname="img-desc" class="img-desc" style><strong>△</strong>Linux系统上的ping.c</p> 
<p>如今我们看到的各个系统中自带的ping工具，早已经不是最初那个ping.shar程序了，其功能和用法都要丰富得多。</p> 
<p>那么，如今的ping放到计算机上来说，究竟是一个怎样的工具呢？</p> 
<h2><strong>ping的基本原理</strong></h2> 
<p>许多计算机发烧友可能会说，自己ping用得贼6。</p> 
<p>不过，大伙儿知道ping是如何工作的吗？</p> 
<p>知其然，不妨也了解一下背后的所以然：</p> 
<p>ping，是网络结构里应用层的一个网络管理命令，是判断<strong>两台主机或路由节点之间网络是否畅通</strong>的重要手段。</p> 
<p>简单来说：如果两台主机“ping”得通，说明它们之间可以建立连接。</p> 
<p class="image-wrapper"><img data-img-size-val="962,498" src="https://img.36krcdn.com/20220519/v2_f301440b1ec64209b316a7220e805f0e_img_000" referrerpolicy="no-referrer"></p> 
<p>一个小知识：公网（因特网）IP地址具有唯一性。</p> 
<p>这就像你在世界范围（公网）内的一栋楼（主机or路由节点等）里工作，这栋楼的地址（IP地址）相对世界来说是唯一的，不过楼里面的其他门牌号（内网IP地址）则不一定是唯一的。</p> 
<p>利用这一特性，我们就能用ping测试两台主机或路由节点中的网络连通性。</p> 
<p>具体来说，就是使用ping命令，先给目标IP地址发送一个遵循ICMP协议的数据包（echo request）。</p> 
<p>然后可以根据返回数据包的情况（丢包、速度等），检查主机或路由节点之间的网络状态。</p> 
<p>Emm…<strong>ICMP</strong>协议又是什么？</p> 
<p>它的全称是：Internet Control Message Protocol，即<strong>因特网控制报文协议</strong>，ICMP报文封装在IP包里。</p> 
<p>所谓“控制”，即在IP主机、路由节点之间传递控制消息，来反映数据包是否成功到达目标端，以及反映网络状况等。</p> 
<p>在IP通信中，当IP包成功到达目标地址并返回时，会收到ping应答；而当IP包因为某原因，未能成功到达目标地址、或未能成功从目标地址返回时，ICMP返回的数据包中将含有具体原因，如：网络不可达、端口不可达等。</p> 
<h2><strong>怎样ping起来</strong></h2> 
<p>下面介绍一下ping的基本操作。</p> 
<p>ping命令在各个常见的操作系统中<strong>通用</strong>，这里以macOS为例：</p> 
<p>从Finder中找到“终端”。</p> 
<p class="image-wrapper"><img data-img-size-val="774,666" src="https://img.36krcdn.com/20220519/v2_3a04d12e3a874b45883907e757b27e61_img_000" referrerpolicy="no-referrer"></p> 
<p>输入ping+IP地址（网址或域名也可以），这里先以百度为例。</p> 
<p>然后，即可查看<strong>每个</strong>数据包，从本电脑对百度的网络服务器发送数据，到接收到服务器反馈数据的延迟时间。</p> 
<p class="image-wrapper"><img data-img-size-val="1080,517" src="https://img.36krcdn.com/20220519/v2_ae647f1b7591439899cdbd44e75dccef_img_000" referrerpolicy="no-referrer"></p> 
<p>由于macOS发送的每个IP数据包默认大小是64个字节，所以返回的数据包大小也是64个字节。</p> 
<p>而这里的延迟时间，就是<strong>ping值</strong>。</p> 
<p>除了输入百度等网址，想要测两台主机之间的ping值也没问题，在一台上输入另一台的IP地址即可：</p> 
<p class="image-wrapper"><img data-img-size-val="1080,384" src="https://img.36krcdn.com/20220519/v2_6b21f5c2c12f4e6f91731306f5e11857_img_000" referrerpolicy="no-referrer"></p> 
<p>所以，在玩网络游戏的时候，如果ping值过高就会感觉操作延迟。</p> 
<p>这个延迟的后果还挺严重的——</p> 
<p>例如，在打王者排位的关键时刻，如果网络连接（可能是自己的无线网，也可能是附近的服务器）卡顿，明明自己已经操作了，但由于敌方的操作反馈时间更快，所以只能眼睁睁得看着自己的英雄挂掉。</p> 
<p class="image-wrapper"><img data-img-size-val="500,460" src="https://img.36krcdn.com/20220519/v2_22e76865ef6849a7aa0d5c484dac687e_img_000" referrerpolicy="no-referrer"></p> 
<p>说到这里，<a class="project-link" data-id="1679788158456580" data-name="量子位" data-logo="https://img.36krcdn.com/20220401/v2_899f079c20ad429d88b47b0eb17d9eb3_img_000" data-refer-type="1" href="https://36kr.com/project/1679788158456580" target="_blank">量子位</a>急忙上号诊断了一下自己的网络。</p> 
<p class="image-wrapper"><img data-img-size-val="1080,495" src="https://img.36krcdn.com/20220519/v2_eb0af9eb9f6f40b2b4a0d28f5c9fa986_img_000" referrerpolicy="no-referrer"></p> 
<p>还好，王者荣耀的延迟低于70ms算正常。</p> 
<p>对于LOL，玩家可打开设置菜单，点击“显示”标签，然后点击“切换FPS显示”按钮，查看自己的ping值。</p> 
<p class="image-wrapper"><img data-img-size-val="1036,564" src="https://img.36krcdn.com/20220519/v2_30db76fb2e3a477aaaa6dd28070198e5_img_000" referrerpolicy="no-referrer"></p> 
<p>至于锁ping（人工延迟）技术要如何实现，目前<strong>拳头游戏</strong>官方给出了一份技术说明：</p> 
<p class="image-wrapper"><img data-img-size-val="1080,841" src="https://img.36krcdn.com/20220519/v2_9c1882d5866e439bae96c0f5fd782b81_img_000" referrerpolicy="no-referrer"></p> 
<p>从说明中来看，拳头表示在线下场馆比赛时加入了一个<strong>人工延迟工具</strong>调整ping值。</p> 
<p>由于人工延迟工具的代码运算出现错误，导致线下ping值过高，目前已通过调节配置修复，但游戏中显示的ping值会因为这一配置调节出现问题。</p> 
<p class="image-wrapper"><img data-img-size-val="1067,787" src="https://img.36krcdn.com/20220519/v2_c80b873fbff9455e93fe6de82a34e6d9_img_000" referrerpolicy="no-referrer"></p> 
<p>具体人工延迟工具（锁ping）的技术代码，目前拳头游戏并未公开。不过GitHub上也已经有人做过人工延迟工具，如下面这个<strong>clumsy</strong>开源模拟器，可以模拟延迟、丢包等bug。感兴趣的小伙伴可以去看看：</p> 
<p class="image-wrapper"><img data-img-size-val="1080,232" src="https://img.36krcdn.com/20220519/v2_bb6c18aafba34e6bbf43727a66e78692_img_000" referrerpolicy="no-referrer"></p> 
<h2><strong>One More Thing</strong></h2> 
<p>在自己的主页上，Muuse还po出了另一个与“ping”相关的小趣事。</p> 
<p>早在<strong>1933年</strong>，美国儿童图画书作家Marjorie Flack就曾经出版过一个绘本：《ping的故事》。</p> 
<p class="image-wrapper"><img data-img-size-val="628,634" src="https://img.36krcdn.com/20220519/v2_60a0e50c792b4db58135cd0c08117767_img_000" referrerpolicy="no-referrer"></p> 
<p>在这里，ping是故事主角小鸭子的名字：</p> 
<blockquote> 
 <p>小鸭子ping和伙伴还有主人一起生活在一条船上，每天最后一只回家的小鸭子要被打屁股。一天傍晚，ping贪玩落在了最后，为了不挨打，它没有回家，由此在长江中开启了一段奇妙冒险，最终平安回到主人的船上。</p> 
</blockquote> 
<p>这看似是一本寻常的儿童读物，但多年后，有读者发现，小鸭子ping的故事与计算机中的ping数据包竟有<strong>异曲同工</strong>之妙！</p> 
<p>一个ping数据包就像一只鸭子，它和其他数据包（更多鸭子）一起，在主机（小船）上度过了一段时期。</p> 
<p>然后，这些数据包（鸭子）通过一个通道（桥）离开主机（船），进入互联网（长江）。</p> 
<p>数据包（鸭子）在另一个主机（另一艘船）上经过短暂的时间后，又回到了原来的主机（船）上。</p> 
<p>所以，今天你的ping值如何？</p> 
<p class="image-wrapper"><img data-img-size-val="406,400" src="https://img.36krcdn.com/20220519/v2_467636de2c994dea904723c79a8b3fd5_img_000" referrerpolicy="no-referrer"></p> 
<p>参考链接：</p> 
<p>[1]https://blog.paessler.com/a-brief-history-of-ping</p> 
<p>[2]https://ftp.arl.army.mil/~mike/ping.html</p> 
<p>[3]https://s.weibo.com/weibo?q=%23MSI%E7%8E%B0%E5%9C%BA%E5%AE%9E%E9%99%85ping%E5%80%BC%23</p> 
<p>[4]https://github.com/iputils/iputils/blob/master/ping/ping.c</p> 
<p>[5]https://en.wikipedia.org/wiki/Mike_Muuss</p> 
<p>[6]https://ngabbs.com/read.php?tid=30095855&rand=196</p> 
<p>[7]https://github.com/jagt/clumsy</p> 
<p>[8]拳头技术博客公告：https://weibo.com/ttarticle/p/show?id=2309404770219460790187</p> 
<p>—<strong>完</strong>—</p> 
<p class="editor-note">本文来自微信公众号<a target="_blank" rel="noopener noreferrer nofollow" href="https://mp.weixin.qq.com/s?__biz=MzIzNjc1NzUzMw==&mid=2247622340&idx=1&sn=202a455efc7d1370527e8980bdbffc2b&chksm=e8d1a9b6dfa620a0075b76c129dfbe42e6889e62c7250eb1ce8a06afafe3c3db193edccd142e#rd">“量子位”（ID:QbitAI）</a>，作者：Alex 萧箫，36氪经授权发布。</p>  
</div>
            