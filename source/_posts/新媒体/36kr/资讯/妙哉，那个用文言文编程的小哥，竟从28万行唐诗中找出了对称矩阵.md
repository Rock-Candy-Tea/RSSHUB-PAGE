
---
title: '妙哉，那个用文言文编程的小哥，竟从28万行唐诗中找出了对称矩阵'
categories: 
 - 新媒体
 - 36kr
 - 资讯
headimg: 'https://img.36krcdn.com/20210329/v2_e424e136c5b045169a285a13b3b92a27_img_000'
author: 36kr
comments: false
date: Mon, 29 Mar 2021 11:03:07 GMT
thumbnail: 'https://img.36krcdn.com/20210329/v2_e424e136c5b045169a285a13b3b92a27_img_000'
---

<div>   
<p>编者按：本文来自<a class="project-link" data-id="3968527" data-name="微信" data-logo="https://img.36krcdn.com/20200916/v2_811751a081924fa9af8741ce120bd7bf_img_png" data-refer-type="2" href="https://36kr.com/projectDetails/3968527" target="_blank">微信</a>公众号<a href="https://mp.weixin.qq.com/s/RMgVslAafkTZIPK7H40ppg">“量子位”（ID:QbitAI）</a>，作者：梦晨 萧箫，36氪经授权发布。</p> 
<p>你能看出来，这首诗妙在哪里吗？</p> 
<p><img src="https://img.36krcdn.com/20210329/v2_e424e136c5b045169a285a13b3b92a27_img_000" data-img-size-val="717,333" referrerpolicy="no-referrer"></p> 
<p>其实，横着读是一首诗，竖着读还是这首诗！</p> 
<p><img src="https://img.36krcdn.com/20210329/v2_0fc4e2731836467c9c93cf3421f51d12_img_000" data-img-size-val="368,360" referrerpolicy="no-referrer"></p> 
<p>而且，这首诗可不是乱编的，其中的诗句都来自《全唐诗》，读起来也颇有意境。</p> 
<p>创造这个奇妙组合的，不是文学研究大师，而是一位程序员小哥。</p> 
<p>他用计算机，找出了所有符合规律的古诗，还在Github上开源了代码。</p> 
<p>就连README文件，也颇具个性：</p> 
<p>余所用之程序，當以gcc編譯之如是gcc -O3 mgsq5.c -o mgsq5</p> 
<p>等一下。这个风格好像很熟悉？</p> 
<p>没错，这位程序员，正是之前开发了火遍全网的文言文编程语言的Huang Lingdong。</p> 
<p><img src="https://img.36krcdn.com/20210329/v2_bb1b20959dbb4d8ab9c90b9155cdb474_img_000" data-img-size-val="1080,245" referrerpolicy="no-referrer"></p> 
<p label="图片描述" classname="img-desc" class="img-desc" style>△ 文言文编程的“Hello，World”</p> 
<p>他用数学中的3阶幻方（九宫格）作比，把符合这种规律的诗命名为“唐诗幻方”。</p> 
<p>然而，这首诗真正的玄妙之处，还不止在这里。</p> 
<h2>玄妙之处</h2> 
<p>这首诗，初看只是横竖都能读，但如果把其中汉字编码成数字再看的话，会发现：</p> 
<p>原来，这是个对称矩阵！</p> 
<p><img src="https://img.36krcdn.com/20210329/v2_5fa1413f582a4a6b9f46ab29eef525e7_img_000" data-img-size-val="800,364" referrerpolicy="no-referrer"></p> 
<p>不过，他遍历了全唐诗里所有五言诗共二十八万七千句后，也只能得出两个这样的幻方。</p> 
<p>除了“风月清江夜”以外，还只有一个，不过意境上差了许多，不能令他满意。</p> 
<p><img src="https://img.36krcdn.com/20210329/v2_bdd14e0d5db740edb27b67b385f22e68_img_000" data-img-size-val="366,360" referrerpolicy="no-referrer"></p> 
<p>在135600行七言唐诗中，符合这个规律的七言“幻方”，更是一个都没有。</p> 
<p>他只能退而求其次，只寻找奇数项对称的，即每句第1、3、5、7个字对称，偶数行用空行代替。</p> 
<p>放宽标准后倒是能找出不少，但再想从其中挑选符合音韵格律、意思上还通顺的，就不多了。</p> 
<p>最后，他选择了其中一个还稍微过得去的做例子，把空行中的字也加上，也能写成对称矩阵：</p> 
<p><img src="https://img.36krcdn.com/20210329/v2_048f5686bc7042849d26860c981e152a_img_000" data-img-size-val="1080,497" referrerpolicy="no-referrer"></p> 
<p>这位小哥，是在研究传统文化时，从古代的洛书和璇玑图中获得的灵感。</p> 
<p><img src="https://img.36krcdn.com/20210329/v2_a1458d426c0443a5ab4acc1ef837db1a_img_000" data-img-size-val="440,440" referrerpolicy="no-referrer"></p> 
<p label="图片描述" classname="img-desc" class="img-desc" style>△洛书</p> 
<p>洛书写成数字就是三阶幻方，特点是每一行、每一列及<a class="project-link" data-id="234729" data-name="对角线" data-logo="https://img.36krcdn.com/20201107/v2_ddfa9038966947f3b166ca10d9cfa64a_img_000" data-refer-type="2" href="https://36kr.com/projectDetails/234729" target="_blank">对角线</a>中的数字之和都相等。</p> 
<p><img src="https://img.36krcdn.com/20210329/v2_7bd706a5051840dea4c6963517ce0617_img_000" data-img-size-val="208,206" referrerpolicy="no-referrer"></p> 
<p>文字没有求和这种操作，如果按照程序员思维，那就是字符串拼接起来相等。</p> 
<p>就这样，得出了要寻找的目标：第n行和第n列的文字相同。</p> 
<p>璇玑图中共841个字，按顺读、逆读、横读、斜读、蛇行读、交叉读、换行读、换列读、间句读都能成诗，总共包含了7958首诗。</p> 
<p><img src="https://img.36krcdn.com/20210329/v2_6ca4a9a3c4b643aea641a2ab799d8bf5_img_000" data-img-size-val="1080,979" referrerpolicy="no-referrer"></p> 
<p>其中的关键之处在于，按照不同顺序读，其文字都能组成有意义的诗句。他自认没有古人作诗的才华，就想到从唐诗中寻找符合条件的诗句。</p> 
<p>而且是用现代人的方法——编程来解决。</p> 
<h2>以“暴力”治之</h2> 
<p>这位小哥，先是想到了用“八皇后问题”的计算机解法，来找出符合要求的唐诗。</p> 
<p>八皇后问题，简单来说是这样的：</p> 
<p>8×8的国际象棋棋盘上，摆放8个不同的皇后，使其不能互相攻击，即处在同一行、同一列、同一斜线上，求解摆放方法。</p> 
<p><img src="https://img.36krcdn.com/20210329/v2_63a3bd4484a24bfa8d39c17fdc87d938_img_000" data-img-size-val="880,890" referrerpolicy="no-referrer"></p> 
<p>这个问题，可以用到一种名为“回溯法”的算法来求解，原理如图：</p> 
<p><img src="https://img.36krcdn.com/20210329/v2_d944b57abdfc4daf90c9695ca9648a9a_img_000" data-img-size-val="844,526" referrerpolicy="no-referrer"></p> 
<p>如果用回溯法来找“幻方”，计算机需要先随机“找出半句诗”，再挨个儿往后面搜索合适的诗句。</p> 
<p>例如，计算机先从13万行唐诗中，随机找出诗句“风月清江夜”：</p> 
<p><img src="https://img.36krcdn.com/20210329/v2_e8b4a01b5fad444886e96a957ce0387b_img_000" data-img-size-val="914,158" referrerpolicy="no-referrer"></p> 
<p>根据对称矩阵的原理，第二句诗的开头，就应该以“月”为首：</p> 
<p><img src="https://img.36krcdn.com/20210329/v2_24331ca373e949628b4b69828ff7db87_img_000" data-img-size-val="992,270" referrerpolicy="no-referrer"></p> 
<p>（以月开头的诗句，应该还是有不少的，像月上柳梢头）</p> 
<p>以此类推，第三句诗的开头，就应该以“清夜”为首：</p> 
<p><img src="https://img.36krcdn.com/20210329/v2_d30ce494518346a58554989cf41a2d4f_img_000" data-img-size-val="1014,384" referrerpolicy="no-referrer"></p> 
<p>（以清夜开头的诗句，就少了许多）</p> 
<p>而第四句诗的开头，就应该以“江山归”打头：</p> 
<p><img src="https://img.36krcdn.com/20210329/v2_19a0393f6d854257b8e265581b2f2df0_img_000" data-img-size-val="1012,480" referrerpolicy="no-referrer"></p> 
<p>（江山归开头的诗……可选范围应该更少了）</p> 
<p>最后一句诗的开头，就必须与前4句诗的结尾完全一致，“夜深<a class="project-link" data-id="41024" data-name="来客" data-logo="https://img.36krcdn.com/20210327/v2_9107702a643c4b9cab0e642c222d7b7d_img_000" data-refer-type="1" href="https://www.36dianping.com/space/4346001234" target="_blank">来客</a>”：</p> 
<p><img src="https://img.36krcdn.com/20210329/v2_73eea741716d488781183a5f1d496837_img_000" data-img-size-val="1044,610" referrerpolicy="no-referrer"></p> 
<p>难度逐渐变成地狱级……</p> 
<p>在这几步操作中，要是有任何一步无法满足条件，就得全部推倒重来。</p> 
<p>这样的话，最初的第一步，就显得尤为重要：从什么类型的诗句开始遍历，才能最快地找到答案？</p> 
<p>他为此用上了启发式搜索，从已知问题信息入手，对这些空格进行评估，找到限制条件最多、即最容易“下笔”的那个位置，再从这个位置开始找诗。</p> 
<p>具体写成代码求解的话，就是利用递归法的结构。</p> 
<p>同时，用上剪枝法，缩小剩下位置的查找范围。</p> 
<p>也就是说，要用到约束函数，在扩展节点处剪去不满足约束条件的子树；再用限界函数，剪去得不到最优解的子树。</p> 
<p><img src="https://img.36krcdn.com/20210329/v2_86e56991d01e4d7b98f24232bc5b8acf_img_000" data-img-size-val="400,203" referrerpolicy="no-referrer"></p> 
<p>这样一来，就能降低问题复杂度。</p> 
<p>然而在运行代码时，作者却发现，这样做效率并不高。</p> 
<p>这种方法，虽然可以求解“N”皇后问题，却不太适合求汉字矩阵。</p> 
<p>因为，要填进格子里的，可不止8个皇后，每一格可以填的汉字，就有5000+种选择！</p> 
<p><img src="https://img.36krcdn.com/20210329/v2_0dcd8752fc8745eb9f257ddafd658dad_img_000" data-img-size-val="620,378" referrerpolicy="no-referrer"></p> 
<p>采用递归法的话，计算机在填上前面的汉字时，实际上就缩小了剩下汉字可以搜查的范围。</p> 
<p>如果没有找到最初那个合适的字，往往搜到一半后，能用的诗句就没了，又得重新再猜，效率不升反降。</p> 
<p>越想越烦躁，这位小哥干脆一拍大腿：不如暴力搜索！</p> 
<p><img src="https://img.36krcdn.com/20210329/v2_2865eebdecda42e6905997b1bb44118f_img_000" data-img-size-val="875,408" referrerpolicy="no-referrer"></p> 
<p>当然，也不是普通的暴力搜索。</p> 
<p>会有两个搜索条件：</p> 
<p>其一，以五言诗为例，第五列的前4个字，和第五行的前4个字，内容是否完全一样？如果不一样，就扔掉。</p> 
<p><img src="https://img.36krcdn.com/20210329/v2_8ca9a37f2fd8431fb35e5d5e5181c41b_img_000" data-img-size-val="395,398" referrerpolicy="no-referrer"></p> 
<p>△ 第五行和第五列的前4个字</p> 
<p>其二，这首诗是不是对称矩阵？不是的话，就扔掉。</p> 
<p><img src="https://img.36krcdn.com/20210329/v2_7e28da1d87a44b398edadfb54f3320a6_img_000" data-img-size-val="243,244" referrerpolicy="no-referrer"></p> 
<p>利用C语言写好后，不用1小时就能跑出所有的“对称诗”。</p> 
<p>作者表示，自己并非文学研究的专家，也不是算法专家，因此，这种方法可能并不是最好的办法。</p> 
<p>诸君若有更好的求解思路，可以来<a class="project-link" data-id="511479" data-name="找他" data-logo="https://img.36krcdn.com/20201106/v2_b31d77ce4d2c43f2b8517deb87d89a64_img_000" data-refer-type="2" href="https://36kr.com/projectDetails/511479" target="_blank">找他</a>玩耍~</p> 
<h2>作者介绍</h2> 
<p><img src="https://img.36krcdn.com/20210329/v2_0c359cf88a1f4c64a2f1f84cb2a05554_img_000" data-img-size-val="1024,1024" referrerpolicy="no-referrer"></p> 
<p>作者Huang Lingdong，在发布文言文编程语言时还在卡耐基梅隆大学上本科。现在已毕业，在母校的Studio for Creative Inquiry做研究助理，为博物馆和学校等组织开发交互媒体项目。</p> 
<p>这位小哥热爱编程和传统文化，还开发过写诗IDE，能自动检查平仄等格律规则，内置韵书和康熙字典做参考。</p> 
<p>还能通过机器学习分析用户作品，并与《全唐诗》中的诗句做比对，看你写的诗像哪位诗人的风格。</p> 
<p><img src="https://img.36krcdn.com/20210329/v2_91e145b44b1142619bcb6fc170cf8f34_img_000" data-img-size-val="1080,929" referrerpolicy="no-referrer"></p> 
<p>除了诗词古文，他对传统美术也颇有研究，开发过无限生成随机山水画的工具，和多款中文字体。</p> 
<p><img src="https://img.36krcdn.com/20210329/v2_05e17fb753804b63b32ad9fe6eacfa83_img_000" data-img-size-val="1080,538" referrerpolicy="no-referrer"></p> 
<p label="图片描述" classname="img-desc" class="img-desc" style>△就是不知道为什么山水画里有个电线杆</p> 
<p>项目地址：https://github.com/LingDong-/magic-square-poems</p> 
<p>Huang Lingdong主页：https://lingdong.works/</p>  
</div>
            