
---
title: '当腾讯最成功的MMO开始研究开放世界'
categories: 
 - 新媒体
 - 游戏葡萄
 - 文章
headimg: 'https://cors.zfour.workers.dev/?http://cdn.youxiputao.com/attach/news/2021/12/27/1640577697594048.jpeg'
author: 游戏葡萄
comments: false
date: Sun, 26 Dec 2021 04:09:43 GMT
thumbnail: 'https://cors.zfour.workers.dev/?http://cdn.youxiputao.com/attach/news/2021/12/27/1640577697594048.jpeg'
---

<div>   
<p>太多人低估了《天涯明月刀OL》新的年度资料片：「云上之城」。</p><p>先别急着把文章关掉——或许你会觉得，这款已经上线5年的端游MMO玩不出什么新花样。但如果你体验过「云上之城」，你会发现，它向开放世界悄悄迈出了一小步。</p><p>这个资料片的地图将达到8X8的大小，而且采用了制作流程向影视看齐的实景扫描技术。这样的生产管线，是生产开放世界所需海量资源的基础。</p><p style="text-align:center;"><img class="rich_pages wxw-img js_insertlocalimg" src="https://cors.zfour.workers.dev/?http://cdn.youxiputao.com/attach/news/2021/12/27/1640577697594048.jpeg" style="margin:0px;padding:0px;height:auto;vertical-align:bottom;width:578px;" alt="1640577697594048.jpeg" referrerpolicy="no-referrer"></p><p style="text-align:center;"><img class="rich_pages wxw-img js_insertlocalimg" src="https://cors.zfour.workers.dev/?http://cdn.youxiputao.com/attach/news/2021/12/27/1640577697418634.jpeg" style="margin:0px;padding:0px;height:auto;vertical-align:bottom;width:578px;" alt="1640577697418634.jpeg" referrerpolicy="no-referrer"></p><p>与此同时，他们还升级了光线追踪的效果，并实现了全真物理碰撞的模拟。有了这些特性，玩家将与世界产生更多互动，而这是开放世界探索玩法的前提。</p><p><iframe src="//player.bilibili.com/player.html?bvid=BV1rq4y157wf" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" style="width:600px;height:300px;"></iframe></p><p>去年《天刀》制作人杨峰曾表示，他们拆解过不少单机开放世界的玩法，分析在剥离它们的一次性体验之后，能不能找到支持网游长线体验的循环，并计划在新地图做一个开放世界方向的Demo。种种迹象表明，「云上之城」符合这个定义：它拉开了一场大戏的序幕。</p><p>前几天，葡萄君采访了《天刀》研发团队，了解了这个资料片背后的技术突破点和实现过程，以及他们对于开放世界的见解。</p><p><br></p><p></p><h2><span style="color:rgb(0,176,80);"><strong>01  </strong><strong>如何还原足够真实的场景？</strong></span></h2><p>去年年末，北极光通过几个新老项目的开发储备了不少技术。再考虑到社会价值，《天刀》团队设定了一个目标：搞一场文旅联动，把整个张家界搬到游戏里。</p><p>那么问题来了：张家界的山形奇特，植被茂密，地形起伏巨大，要想还原当地的光照情况和自然地理条件，且做出8X8的地图，必须要能量产高品质的资源。于是团队决定效仿影视行业，引入实景扫描的流程——去现场把一切都拍下来，再逐一还原参数。</p><p>听起来很好理解，但这套流程对细节的要求实在太多了。</p><p>第一，拍照似乎很简单，但记录一切可就难了。到底应该用什么相机？什么标准的光圈、快门、镜头和遮光片？如何记录材质、光照和环境数据？又该如何保证捕捉出来的HDR贴图、光照单位的准确，以及在时间上的连续度？即便做了不少功课，美术团队依然跑了两趟，才拿到足够多的原始素材。</p><p style="text-align:center;"><img class="rich_pages wxw-img js_insertlocalimg" src="https://cors.zfour.workers.dev/?http://cdn.youxiputao.com/attach/news/2021/12/27/1640577697638504.jpeg" style="margin:0px;padding:0px;height:auto;vertical-align:bottom;width:578px;" alt="1640577697638504.jpeg" referrerpolicy="no-referrer"></p><p style="text-align:center;"><span style="color:rgb(191,191,191);">真实的张家界</span></p><p>第二，如何保证还原的程度？拿到RAW源文件之后，团队需要用算法复原真实世界的成像规律——在传统流程当中，美术可以直接上手调整做出成品；但如果想追求写实效果，团队必须追求极致「物理正确」的生产管线，所有环节都要遵循流程，不能为了追求好看的结果，就让老师傅随意发挥，省略步骤。</p><p>第三，做出素材之后，团队还要用Look Dev验收——也就是在多种光照环境下，查看和调整各项参数。这要求技术团队真正吃透理论，确保算法完全符合所有公式。"最明和最暗的环境，光照HDR的范围可能差得非常多，你要通过高光管线确定裁掉的部分合理，完整还原从物理光照到曝光成像过程每一步的细节。"</p><p style="text-align:center;"><img class="rich_pages wxw-img" src="https://cors.zfour.workers.dev/?http://cdn.youxiputao.com/attach/news/2021/12/27/1640577698364190.png" style="margin:0px;padding:0px;vertical-align:bottom;width:288px;height:auto;" alt="1640577698364190.png" referrerpolicy="no-referrer"></p><p style="text-align:center;"><span style="color:rgb(191,191,191);">不同天气和场景的光照度</span></p><p>在这个过程中，甚至人的双眼也不太靠谱。引擎负责人刘冰啸举了一个例子：一位负责Look Dev的TA做好了视频，他怎么看都觉得光线有违和感，可仔细一查，又发现参数没有问题。"大自然的光照条件千变万化，只有认真做对Look Dev，才能让玩家感受到真实世界的效果。而平常我们习惯了生活中的人造光，如果只按照我们的认知来调，游戏就会变得没有特色，过于平庸。"</p><p style="text-align:center;"><img class="rich_pages wxw-img js_insertlocalimg" src="https://cors.zfour.workers.dev/?http://cdn.youxiputao.com/attach/news/2021/12/27/1640577698377574.jpeg" style="margin:0px;padding:0px;height:auto;vertical-align:bottom;width:578px;" alt="1640577698377574.jpeg" referrerpolicy="no-referrer"></p><p>第四，上述流程并不是只研究个1-2年就能捋清，它们背后还有对新技术经年累月的关注。比如为了学习理论，团队一直在阅读图形学领域的会议论文和专著，"历年的SIGGRAPH、GDC会议都要跟进，16开的英文资料至少看了300-400页。"即便如此，在实操过程中他们还是会遇到卡点，需要咨询工业光魔等影视公司的朋友。</p><p>现在你应该对于「用实景扫描量产高品质资源」的难度有了了解，但这才刚刚迈出了第一步。想做出真正写实的场景，还要有美术团队的海量投入。</p><p>例如为了制作张家界的山石和植被，场景团队先是恶补了地理知识，弄清楚了侵蚀构造会如何塑造砂岩地貌；又根据张家界的纬度和海拔，列出了上百种植被，从中挑出了武陵松、红豆杉、野芭蕉等二十多种常见植物，思考如何把它们还原出来。</p><p>在常规地图当中，一般只要制作十几种岩石就可以不断复用；但砂岩地貌太过奇特，石柱、石块、悬崖……至少要做四五十种才能还原那种氛围，而且石英砂岩的石质稍软，负责雕高模的外包团队很难平衡细节度，最终每块石头都要经过10次左右的沟通才能完工。</p><p>然而把这些岩石放到场景里，美术团队又发现了新的问题：张家界的岩石量远远高于常规场景，且彼此间隔很小，如果按原样摆放，性能负担实在太大。于是在3-4个月的制作之后，美术又额外花了1个月，重新对模型和细节做了一系列调整，再配合混合材质，最终才保证了性能。</p><p style="text-align:center;"><img class="rich_pages wxw-img js_insertlocalimg" src="https://cors.zfour.workers.dev/?http://cdn.youxiputao.com/attach/news/2021/12/27/1640577698421145.jpeg" style="margin:0px;padding:0px;height:auto;vertical-align:bottom;width:578px;" alt="1640577698421145.jpeg" referrerpolicy="no-referrer"></p><p>不过幸运的是，美术团队在植被方面的工作还算顺利。孙老师说，除了制作工具的升级，引擎性能和底层支持的提升也让美术效果有了质的飞跃：树木从2000-3000面升级到了5000-10000面，AO贴图的烘焙让它们的轮廓造型更加立体，光线照射到叶片的质感也显得更加自然。</p><p style="text-align:center;"><img class="rich_pages wxw-img js_insertlocalimg" src="https://cors.zfour.workers.dev/?http://cdn.youxiputao.com/attach/news/2021/12/27/1640577699750571.jpeg" style="margin:0px;padding:0px;height:auto;vertical-align:bottom;width:578px;" alt="1640577699750571.jpeg" referrerpolicy="no-referrer"></p><p>这也引出了下一个话题：除了新的开发流程和美术团队的努力，《天刀》还在更底层的部分下了不少功夫。正如北极光技术总监安柏霖之前所说，"前面的技术都是招式，但打出来靠的是内功。"</p><p><br></p><h2><span style="color:rgb(0,176,80);"><strong>02  </strong><strong>永无止境的优化，</strong><strong>和更扎实的底层支持</strong></span></h2><p>刘冰啸说，游戏开发有一个很常见的规律：当细节复杂度提升之后，团队要解决的是多项系统之间的乘法关系，这对底层系统的设计会带来极大的影响，也会提出更高的要求。</p><p>一个直观的例子是光线追踪。不同的光照射到不同的材质，都会产生不同的效果。因此光用影视化流程做出更物理的材质还不够，想模拟真实世界，必须实现更好的光线追踪效果。</p><p style="text-align:center;"><img class="rich_pages wxw-img js_insertlocalimg" src="https://cors.zfour.workers.dev/?http://cdn.youxiputao.com/attach/news/2021/12/27/1640577699815146.jpeg" style="margin:0px;padding:0px;height:auto;vertical-align:bottom;width:578px;" alt="1640577699815146.jpeg" referrerpolicy="no-referrer"></p><p style="text-align:center;"><span style="color:rgb(191,191,191);">《天刀》在显卡上运行，对每一个指标都要理解透彻，在算法上发挥充分</span></p><p>由于《天刀》采用了自研引擎QuicksilverX，团队没有采用其他引擎自带的软件光追方案，而是会去研究NVIDIA、AMD等硬件的光追算法。"这样理解最彻底，代码最干净，也会受到更少的限制。"为了达成这些，他们要理解硬件光追背后所有的原理，并始终保持与硬件公司工程师的交流研究，确保每一个细节指标都理解到位。</p><p style="text-align:center;"><img class="rich_pages wxw-img js_insertlocalimg" src="https://cors.zfour.workers.dev/?http://cdn.youxiputao.com/attach/news/2021/12/27/1640577700367804.jpeg" style="margin:0px;padding:0px;height:auto;vertical-align:bottom;width:578px;" alt="1640577700367804.jpeg" referrerpolicy="no-referrer"></p><p>之所以能这么做，是因为QuicksilverX主打的就是性能优化。《天刀》团队内部有一套监控代码行数的系统来严控代码量，以此保证引擎足够轻简，更容易升级管线；他们还开发了不少自动化的工具，在美术提交地图后的第一时间让机器人做AI验证，把地图分割成64X64大小的区域，分区展示性能，记录问题，回放场景，一键输出「体检报告」，以便QA和程序做针对性的调整。</p><p>刘冰啸说，《天刀》有50%以上的程序都在负责优化，而且他们都很资深。"资源和算法合不合理？有没有更好的解决方案？如果全都合理，那它的设计足够合理吗？比如是不是可以按区来做，或者在美术遮挡上做一些效果？这些都需要经验。”</p><p>但即便如此，性能优化也依旧有不少挑战。在贴图、模型规格不断升级，并引入影视级流程之后，团队要把握新的变量。"有点儿像解方程式，这一侧有好多变量，那一侧要有固定的结果，然后计算如何分配。"为此他们既会研究在汇编语言层面（比算法更底层）的改动，也会从产品视角出发和美术沟通，比如野怪会在很远处就被击杀，那就可以适当降低细节，以保证主要角色的精度。</p><p>在流程上，这也要求技术和美术团队之间充分信任。在前期工作的时候，技术会尽量减少对美术的限制，先把效果拉满；但美术也会理解为了保证性能，后面大家还要一起反复调整资源，拼命优化，“而不是听说性能爆了要砍资源，就要杀个程序员祭天。"</p><p style="text-align:center;"><img class="rich_pages wxw-img js_insertlocalimg" src="https://cors.zfour.workers.dev/?http://cdn.youxiputao.com/attach/news/2021/12/27/1640577700342228.jpeg" style="margin:0px;padding:0px;height:auto;vertical-align:bottom;width:578px;" alt="1640577700342228.jpeg" referrerpolicy="no-referrer"></p><p>不过如果只是实现了更好的美术效果，那「云上之城」还称不上拉开了研究开放世界的序幕。更需要注意的是，有些底层能力的建设，还为未来的玩法创新打下了基础。</p><p>正如前文所述，张家界的地貌复杂，高低起伏巨大，如果玩家一直站在地面观赏，显然就差了点儿意思。于是为了实现3D空间之间的移动和观察，团队开始研究更好的物理模拟技术。</p><p>物理的基础是碰撞。之前《天刀》采用的是基于Voxel（体素）的碰撞方式，它会在后台把资源拆分成大量体素再进行计算。这种做法可以节约性能，但不够精确。"比如它会把体素的上表面设定为可行走区域，只有落在这个范围才合法。"</p><p>而在「云上之城」中，团队实现了全真物理碰撞，让侧面也可以被检测，且在后端也支持多人对于整体环境的改变，这增加了玩家的可操作区域的范围，"像是爬山就可以实现了。"在新资料片的单人探索场景，以及生存撤离PvP玩法「馥郁之战」中，地形和物理特性也会发挥更大的影响。团队表示，随着技术实力的提升，后面他们还会尝试更多基于真实物理引擎的创新玩法。在未来一段时间里，这片8X8的区域将成为《天刀》着力研究开放世界的试验场。</p><p style="text-align:center;"><img class="rich_pages wxw-img js_insertlocalimg" src="https://cors.zfour.workers.dev/?http://cdn.youxiputao.com/attach/news/2021/12/27/1640577701675289.jpeg" style="margin:0px;padding:0px;height:auto;vertical-align:bottom;width:578px;" alt="1640577701675289.jpeg" referrerpolicy="no-referrer"></p><p style="text-align:center;"><span style="color:rgb(191,191,191);">馥郁之战原画</span></p><p>说实话，「云上之城」更新的不少特性，放在单机大作里可能不算是特别顶尖——毕竟《天刀》是一款已经上线了6年的多人同屏网游，他们要带着历史包袱，寻找因地制宜的技术解决方向。但在安柏霖看来，「标准化」是工业化的一大要素。而借由「云上之城」，他们朝理想中的目标踏出了关键的一步。</p><p><br></p><p></p><h2><span style="color:rgb(0,176,80);"><strong>03  </strong><strong>结语：日拱一卒</strong></span></h2><p>我们常常认为，国内游戏公司的技术距离3A厂商还有巨大的差距。但安柏霖说，每年大家在GDC或者SIGGRAPH上公布的最新成果，他们团队都有把握在2-4月内实现；就算想追逐超出前人的技术特性，只要愿意付出更高的成本，也不是没有可能，"比如当年《天刀》的云海，以及透明布料的衣服。"</p><p style="text-align:center;"><img class="rich_pages wxw-img js_insertlocalimg" src="https://cors.zfour.workers.dev/?http://cdn.youxiputao.com/attach/news/2021/12/27/1640577701841819.jpeg" style="margin:0px;padding:0px;height:auto;vertical-align:bottom;width:578px;" alt="1640577701841819.jpeg" referrerpolicy="no-referrer"></p><p style="text-align:center;"><span style="color:rgb(191,191,191);">当年《天刀》的云海效果</span></p><p>不过这些局部的突破，只能说是一个开始。刘冰啸讲了一个小故事：之前《天刀》制作人杨峰曾问他，能不能做一张《幽灵行动》那样的，64km X 64km的地图？他评估了一下觉得没问题："我们有Streaming机制，只需要加载玩家身边的地图资源，性能没问题；而且现在基于houdini的过程化生成技术在团队也已经应用得非常纯熟，在生产管线上也能搞定，甚至更大都可以。" </p><p>但在技术因素OK了之后，大家还要做更全盘的考虑：在这么大的地图上面，玩家能不能玩到足够丰富多变的内容？这些内容的设计和生产，将对工具链、美术和策划提出更高难度、更大工作量的要求——做游戏从来不是一个单点突破的任务，而是一个系统性的挑战。</p><p>面对这样的挑战，《天刀》的选择是用稳扎稳打的方式，通过每个版本保持进化。"从新手村的九华地图，到后面出的从龙，再到现在的张家界，画面变化贼大，几乎都不是一款游戏……每出一张地图，我们就往前拱上一步。"</p><p><iframe src="//player.bilibili.com/player.html?bvid=BV1og411w7LB" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" style="width:600px;height:300px;"></iframe></p><p>团队告诉我，未来这样的节奏还会继续下去。当前版本的张家界开放的面积只有计划中的十六分之一，战场玩法也只是试水；明年4月，《天刀》将开放下一个单人探索的版本，后者呈现出来的玩法和实力，会更接近团队对于开放世界的想象；而整张新地图将在2022-2023年内全部完成——听上去是很漫长，但用刘冰啸的话说，"日拱一卒，这是必须经历的过程。"</p>
                      
</div>
            