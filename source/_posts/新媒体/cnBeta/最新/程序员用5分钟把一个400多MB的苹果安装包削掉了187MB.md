
---
title: '程序员用5分钟把一个400多MB的苹果安装包削掉了187MB'
categories: 
 - 新媒体
 - cnBeta
 - 最新
headimg: 'https://static.cnbetacdn.com/thumb/article/2022/0226/b9797e18a5a6909.png'
author: cnBeta
comments: false
date: Sat, 26 Feb 2022 05:08:39 GMT
thumbnail: 'https://static.cnbetacdn.com/thumb/article/2022/0226/b9797e18a5a6909.png'
---

<div>   
前些日子，一个手机QQ安装包就要快900MB的事儿在网上吵得沸沸扬扬：最新安装包又大了，已经924MB。<strong>虽然最后大家发现它主要为了视频通话特效多了一个虚幻引擎，但网友还是感叹：</strong>现在的App真的是越来越大了。<br>
 <p><a target="_blank" href="https://static.cnbetacdn.com/article/2022/0226/b9797e18a5a6909.png"><img data-original="https://static.cnbetacdn.com/article/2022/0226/b9797e18a5a6909.png" src="https://static.cnbetacdn.com/thumb/article/2022/0226/b9797e18a5a6909.png" referrerpolicy="no-referrer"></a></p><p>而就在最近，国外一位程序员也遇到了同样的困惑。</p><p>他乘的一班飞机由于没有机上小<a data-link="1" href="https://c.duomai.com/track.php?site_id=242986&euid=&t=https%3A%2F%2Flist.jd.com%2Flist.html%3Fcat%3D737%2C794%2C798%26ev%3D4155_76344%26sort%3Dsort_rank_asc%26trans%3D1%26JL%3D2_1_0%23J_crumbsBar" target="_blank">电视</a>，只能下载一个叫做“美联航”的App来看视频打发时间。</p><p>小哥一边感叹现在航空公司越来越鸡贼：把成本都加到顾客头上，一边打开了应用商店，结果就很诧异：</p><p>不就用来看个电影啥的吗，一个Netflix都只有101.5MB，这App怎么是它的四倍？</p><p><img src="https://static.cnbetacdn.com/article/2022/0226/fbdec736e19b653.png" referrerpolicy="no-referrer"></p><p>作为一名iOS/Android开发工程师，小哥决定不“坐以待毙”，看看它是否真的需要这么大的空间。</p><p><strong>原来可以省掉187MB</strong></p><p>说干就干，还在飞机上的小哥立刻用ipatool下载了这个App的二进制文件。</p><p>ipatool是GitHub上标星1.<a data-link="1" href="https://c.duomai.com/track.php?site_id=242986&euid=&t=https%3A%2F%2Flist.jd.com%2Flist.html%3Fcat%3D737%2C794%2C798%26ev%3D4155_110018%26sort%3Dsort_rank_asc%26trans%3D1%26JL%3D2_1_0%23J_crumbsBar" target="_blank">4K</a>的开源项目，是一个命令行工具，可以从iOS应用商店搜索和下载应用程序的ipa文件包，用这个包可以进行开发内容的一些检查等功能。</p><p><a target="_blank" href="https://static.cnbetacdn.com/article/2022/0226/a8ce29d2429062c.png"><img data-original="https://static.cnbetacdn.com/article/2022/0226/a8ce29d2429062c.png" src="https://static.cnbetacdn.com/thumb/article/2022/0226/a8ce29d2429062c.png" referrerpolicy="no-referrer"></a></p><p>下好以后需要把ipa扩展名改为zip，解压之后可以看到下面这样的目录：</p><p><a target="_blank" href="https://static.cnbetacdn.com/article/2022/0226/98692417f5d0c36.png"><img data-original="https://static.cnbetacdn.com/article/2022/0226/98692417f5d0c36.png" src="https://static.cnbetacdn.com/thumb/article/2022/0226/98692417f5d0c36.png" referrerpolicy="no-referrer"></a></p><p>可以发现Frameworks就占了414.8MB，小哥解释：应用程序的主要内存来源就是Frameworks，现在的最佳实践都是把代码push到这里面，还是挺正常的。</p><p>接下来进入该目录：</p><p><a target="_blank" href="https://static.cnbetacdn.com/article/2022/0226/db250fd3cb8f93b.png"><img data-original="https://static.cnbetacdn.com/article/2022/0226/db250fd3cb8f93b.png" src="https://static.cnbetacdn.com/thumb/article/2022/0226/db250fd3cb8f93b.png" referrerpolicy="no-referrer"></a></p><p>以UAL开头的框架是核心架构、NodeMobile框架跟NodeJS功能有关、LocusLab<a data-link="1" href="https://c.duomai.com/track.php?site_id=242986&euid=&t=https://list.jd.com/list.html?cat=670,677,11303" target="_blank">SSD</a>K和Mapbox是供应地图的，还有一些是负责身份验证、客户反馈的……</p><p>而视频播放相关的框架相反其实占内存并不多：</p><p><a target="_blank" href="https://static.cnbetacdn.com/article/2022/0226/ce4b67ada8a1f56.png"><img data-original="https://static.cnbetacdn.com/article/2022/0226/ce4b67ada8a1f56.png" src="https://static.cnbetacdn.com/thumb/article/2022/0226/ce4b67ada8a1f56.png" referrerpolicy="no-referrer"></a></p><p>接着进入占空间最大的UALAppCore.framework。</p><p>经过层层探索，小哥终于在这里锁定了最大占存的UALAppCore。</p><p><a target="_blank" href="https://static.cnbetacdn.com/article/2022/0226/610262470dce98a.png"><img data-original="https://static.cnbetacdn.com/article/2022/0226/610262470dce98a.png" src="https://static.cnbetacdn.com/thumb/article/2022/0226/610262470dce98a.png" referrerpolicy="no-referrer"></a></p><p>按照他的工作经验，77MB这个数字还是有点反常的，他打算用nm命令深入看看这个框架的符号表（symbol）文件（nm用于显示二进制目标文件的符号表，格式如下）。</p><p><a target="_blank" href="https://static.cnbetacdn.com/article/2022/0226/fa3252aed6b31b6.png"><img data-original="https://static.cnbetacdn.com/article/2022/0226/fa3252aed6b31b6.png" src="https://static.cnbetacdn.com/thumb/article/2022/0226/fa3252aed6b31b6.png" referrerpolicy="no-referrer"></a></p><p>很快他就想起来，Swift的符号需要剥离（strip，iOS框架中的术语），Objective-C则不需要。</p><p>那就查Swift的，结果还真就发现：</p><p>没有一个Swift框架的符号被剥离过。</p><p>而这些都没有用，白白耗内存：</p><p><a target="_blank" href="https://static.cnbetacdn.com/article/2022/0226/c79f8ac7061abf9.png"><img data-original="https://static.cnbetacdn.com/article/2022/0226/c79f8ac7061abf9.png" src="https://static.cnbetacdn.com/thumb/article/2022/0226/c79f8ac7061abf9.png" referrerpolicy="no-referrer"></a></p><p>那接下来就简单了，写一个bash脚本运行一下该框架就可以OK：</p><p><a target="_blank" href="https://static.cnbetacdn.com/article/2022/0226/b023c28615b3178.png"><img data-original="https://static.cnbetacdn.com/article/2022/0226/b023c28615b3178.png" src="https://static.cnbetacdn.com/thumb/article/2022/0226/b023c28615b3178.png" referrerpolicy="no-referrer"></a></p><p>最后，可以看到原始框架从350MB减到了163M！</p><p><a target="_blank" href="https://static.cnbetacdn.com/article/2022/0226/724d77ed7597d9b.png"><img data-original="https://static.cnbetacdn.com/article/2022/0226/724d77ed7597d9b.png" src="https://static.cnbetacdn.com/thumb/article/2022/0226/724d77ed7597d9b.png" referrerpolicy="no-referrer"></a></p><p>小哥表示，这一顿操作只花了不到5分钟，没想到可削减空间这么大，整整省掉了187MB。</p><p>等于现在的安装包只有原来的不到60%了。</p><p>他猜测该安装包仍有削减空间，不过这个结果他已经很满意了。</p><p><strong>你，学废了吗？</strong></p><p><strong>“开发商才不关心呢”</strong></p><p>就在小哥发出这个博客之后，有网友评论道，还有很多安装包其实都可以再缩减15%到30%甚至更高的空间，就比如Gmail、Outlook这些很常见的应用。</p><p>但似乎现在很多开发商不是很关心这个问题，他们只想赶紧不停更新应用：</p><p>给不给用户省掉这几百M的流量都一样赚钱，为啥还要费功夫呢？</p><p><a target="_blank" href="https://static.cnbetacdn.com/article/2022/0226/a7112e3ecaa1263.png"><img data-original="https://static.cnbetacdn.com/article/2022/0226/a7112e3ecaa1263.png" src="https://static.cnbetacdn.com/thumb/article/2022/0226/a7112e3ecaa1263.png" referrerpolicy="no-referrer"></a></p><p>有一位嵌入式工程师就表示：当我跟同事提起要注意这方面的优化时，他们总是给我一个茫然的眼神。</p><p>有网友认为：除非各应用商店开始管这事儿，开发商是不会做出改变的。就单说<a data-link="1" href="https://c.duomai.com/track.php?site_id=242986&euid=&t=https://shouji.jd.com/" target="_blank">手机</a>厂商就很乐意看到这一场面，内存不够就可以去他们那买新手机了。</p><p><a target="_blank" href="https://static.cnbetacdn.com/article/2022/0226/534aaea57a467c5.png"><img data-original="https://static.cnbetacdn.com/article/2022/0226/534aaea57a467c5.png" src="https://static.cnbetacdn.com/thumb/article/2022/0226/534aaea57a467c5.png" referrerpolicy="no-referrer"></a></p><p>他还发现谷歌Play Store好像就不显示应用程序大小。</p><p>而一些银行App在这个问题上尤其严重，因为他们知道你不会轻易换银行。</p><p>你怎么看？</p>   
</div>
            