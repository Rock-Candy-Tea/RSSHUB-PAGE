
---
title: 'Facebook大规模服务中断事件调查：BGP与DNS服务器离线所致'
categories: 
 - 新媒体
 - cnBeta
 - 最新
headimg: 'https://static.cnbetacdn.com/article/2021/1005/f399be462186cc5.png'
author: cnBeta
comments: false
date: Tue, 05 Oct 2021 09:30:28 GMT
thumbnail: 'https://static.cnbetacdn.com/article/2021/1005/f399be462186cc5.png'
---

<div>   
BGP 是“边界网关协议”的缩写，<strong>作为一套允许在互联网上的自治系统（AS）之间交换路由信息的机制，其在刚刚过去的 Facebook 大规模服务中断事件中也扮演了重要的角色。</strong>Cloudflare 指出，BGP 使得互联网上工作的大型路由器能够拥有庞大的、不断更新的可能路由列表，从而将各个挽留过数据包送达最终的目的地。<br>
<p><img src="https://static.cnbetacdn.com/article/2021/1005/f399be462186cc5.png" alt="1.png" referrerpolicy="no-referrer"></p><p style="text-align: center;">（图自：<a href="https://blog.cloudflare.com/october-2021-facebook-outage/" target="_self">Cloudflare</a>）</p><p>若缺乏 BGP，互联网<a data-link="1" href="https://c.duomai.com/track.php?site_id=242986&euid=&t=https://list.jd.com/list.html?cat=670,699,700" target="_blank">路由器</a>将不知如何正确工作。毕竟 Internet 的本意，就是在 BGP 绑定之下、一个套着另一个的网络。</p><p>以社交媒体巨头 Facebook 为例，BGP 使之能够向构成互联网的其它网络通告自身的存在。</p><p><a href="https://static.cnbetacdn.com/article/2021/1005/c9373eebf07a3af.png" target="_blank"><img src="https://static.cnbetacdn.com/thumb/article/2021/1005/c9373eebf07a3af.png" alt="2.png" referrerpolicy="no-referrer"></a></p><p style="text-align: center;">BGP / SAN 简图</p><p>然而在周一的服务大中断事件中，Facebook 却乌龙般地没有宣告自身的存在，最终导致互联网服务提供商（ISP）和其它网络无法与之建立正确的连接。</p><p><a href="https://www.theverge.com/2021/10/4/22709260/what-is-bgp-border-gateway-protocol-explainer-internet-facebook-outage" target="_self">TheVerge</a> 编辑 Alex Castro 指出，BGP 又被称作互联网上的“邮局系统”或“空中交通管制员”，但他更喜欢将之看成一幅众人参与制作和更新的地图，以引导用户正确访问油管或脸书等网络服务。</p><p><a href="https://static.cnbetacdn.com/article/2021/1005/fa2d85076159fe1.png" target="_blank"><img src="https://static.cnbetacdn.com/thumb/article/2021/1005/fa2d85076159fe1.png" alt="3.png" referrerpolicy="no-referrer"></a></p><p>Tom Strickx 与 Celso Martinho 在 Cloudflare 专栏文章中写道：每个单独的网络，都有一个被称作 ASN 的自治系统编号，而自治系统（AS）是具有统一内部路由策略的单个网络。</p><p><a href="https://static.cnbetacdn.com/article/2021/1005/da9243a7ac1ceef.png" target="_blank"><img src="https://static.cnbetacdn.com/thumb/article/2021/1005/da9243a7ac1ceef.png" alt="4.png" referrerpolicy="no-referrer"></a></p><p>AS 能够产生前缀（比如其控制的一组 IP 地址）并传输，以让互联网知晓如何将信息送达特定的 IP 地址组，而 Cloudflare 的 ASN 编号就是 AS13335 。</p><p><a href="https://static.cnbetacdn.com/article/2021/1005/9f837ac04dac063.png" target="_blank"><img src="https://static.cnbetacdn.com/thumb/article/2021/1005/9f837ac04dac063.png" alt="5.png" referrerpolicy="no-referrer"></a></p><p>然后每个 ASN 都需要借助 BGP 向互联网通告其前缀路由，否则将无人知晓该如何与之取得连接、以及在哪里找到它们。</p><p>在 UTC 协调世界时的 16:58，Cloudflare 开始留意到 Facebook 已停止公布其 DNS 前缀路由。在最不严重的情况下，这也意味着该公司的域名解析服务（DNS）已不可用。</p><p><a href="https://static.cnbetacdn.com/article/2021/1005/ab37c6c617b4081.png" target="_blank"><img src="https://static.cnbetacdn.com/thumb/article/2021/1005/ab37c6c617b4081.png" alt="6.png" referrerpolicy="no-referrer"></a></p><p>由于 Cloudflare 的 1.1.1.1 DNS 解析器无法再响应询问 facebook.com 或 instagram.com 等网络服务的 IP 地址查询，大规模服务中断也开始变得无法避免。</p><p><a href="https://static.cnbetacdn.com/article/2021/1005/38c9776b8c2845a.png" target="_blank"><img src="https://static.cnbetacdn.com/thumb/article/2021/1005/38c9776b8c2845a.png" alt="7.png" referrerpolicy="no-referrer"></a></p><p>与此同时，尽管仍有其它 Facebook IP 地址在被路由，但它们所能起到的效果也相当有限 —— 毕竟只要 DNS 服务躺下了，与 Facebook 相关的服务也变得实际上无法访问了。</p><p><a href="https://static.cnbetacdn.com/article/2021/1005/43add44544a006c.png" target="_blank"><img src="https://static.cnbetacdn.com/thumb/article/2021/1005/43add44544a006c.png" alt="8.png" referrerpolicy="no-referrer"></a></p><p>Cloudflare 指出，其会跟踪全球网络中观察到的所有 BGP 更新与公告。然而 UTC 时间 15：40 左右，Cloudflare 留意到了 Facebook 的路由变更高峰，麻烦在这个时候开始集中爆发。</p><p><a href="https://static.cnbetacdn.com/article/2021/1005/f559533ae1df2a4.png" target="_blank"><img src="https://static.cnbetacdn.com/thumb/article/2021/1005/f559533ae1df2a4.png" alt="9.png" referrerpolicy="no-referrer"></a></p><p>说到这，本次 Facebook 大规模服务中断的前因后果已基本疏离完成。首先是路由被撤回，接着 Facebook 的 DNS 服务器离线。</p><p><a href="https://static.cnbetacdn.com/article/2021/1005/d1971a6e9fac3dc.png" target="_blank"><img src="https://static.cnbetacdn.com/thumb/article/2021/1005/d1971a6e9fac3dc.png" alt="10.png" referrerpolicy="no-referrer"></a></p><p>问题发生一分钟后，Cloudflare 工程师们开始思考为何 1.1.1.1 无法解析 facebook.com、甚至一度怀疑是自家公司的系统出现了问题。</p>   
</div>
            