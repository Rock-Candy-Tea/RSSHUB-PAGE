
---
title: '微软2022年第一号bug让大量程序员连夜加班 只因日期数据溢出'
categories: 
 - 新媒体
 - cnBeta
 - 最新
headimg: 'https://static.cnbetacdn.com/thumb/article/2022/0102/b4e9a966ff2a0b1.png'
author: cnBeta
comments: false
date: Sun, 02 Jan 2022 12:27:37 GMT
thumbnail: 'https://static.cnbetacdn.com/thumb/article/2022/0102/b4e9a966ff2a0b1.png'
---

<div>   
没想到，2022年的到来，也给微软带来了一个新bug。<strong>随着日期从2021年12月31日跳转到2022年1月1日，不少使用微软Exchange的公司发现，自己写好的新年祝福等邮件，突然发不出去了。</strong><br>
 <p>Exchange Server是微软推出的一套电子邮件服务组件，可用于构建企业、高校或机构的邮件系统。简单来说，用它不止能构建“邮箱工作群”，还能协调内部工作流等。</p><p>这些公司的邮箱服务器内滞留了大量邮件，有些甚至达到数十万封，面临服务器存储不下的问题。</p><p><strong>目前这个bug已经在Reddit热度上千，许多人表示“年都没跨好就在这修bug”：</strong></p><p><a target="_blank" href="https://static.cnbetacdn.com/article/2022/0102/b4e9a966ff2a0b1.png"><img data-original="https://static.cnbetacdn.com/article/2022/0102/b4e9a966ff2a0b1.png" src="https://static.cnbetacdn.com/thumb/article/2022/0102/b4e9a966ff2a0b1.png" referrerpolicy="no-referrer"></a></p><p>新年（哔）快乐！</p><p><a target="_blank" href="https://static.cnbetacdn.com/article/2022/0102/e60ba19fc8c276e.png"><img data-original="https://static.cnbetacdn.com/article/2022/0102/e60ba19fc8c276e.png" src="https://static.cnbetacdn.com/thumb/article/2022/0102/e60ba19fc8c276e.png" referrerpolicy="no-referrer"></a></p><p>我本来还在度假呢，就给我拉回来处理这个玩意了……</p><p><a target="_blank" href="https://static.cnbetacdn.com/article/2022/0102/1f0ed64e6e3eff2.png"><img data-original="https://static.cnbetacdn.com/article/2022/0102/1f0ed64e6e3eff2.png" src="https://static.cnbetacdn.com/thumb/article/2022/0102/1f0ed64e6e3eff2.png" referrerpolicy="no-referrer"></a></p><p>所以到底是怎么回事？</p><p><strong>微软2022版“千年虫”</strong></p><p>据一位Exchange管理员Joseph Roosen表示，这是一个由于“2022年”的到来而导致的bug。</p><p>这个bug的根源，是微软Exchange上面的邮件过滤管理系统（FIP-FS），采用了一种名叫“yymmddHHMM”的有符号变量（Int32，也就是long）来存储日期。</p><p><a target="_blank" href="https://static.cnbetacdn.com/article/2022/0102/0e32ac7dbfd29eb.png"><img data-original="https://static.cnbetacdn.com/article/2022/0102/0e32ac7dbfd29eb.png" src="https://static.cnbetacdn.com/thumb/article/2022/0102/0e32ac7dbfd29eb.png" referrerpolicy="no-referrer"></a></p><p>其中，yymmddHHMM分别指代用两位来存储年（years）、月（months）、日（days）、小时（Hours）、分钟（Minutes）。</p><p><strong>这个数据类型存在一个问题：</strong></p><p>有符号的Int32最多只能存储-2147483647到+2147483647的数据。</p><p>然而，从2022年1月1日0时开始，“yymmddHHMM”的yy就已经变成了“22”，超过了Int32所能存储的数据最大范围：</p><p>2147483647</p><p>22XXXXXXX</p><p><strong>于是，在2022年1月1日这天，所有用Exchange服务器发邮件的公司，都收到了这样一条错误提醒：</strong></p><p>The FIP-FS Scan Process failed initialization. Error: 0x8004005. Error Details: Unspecified Error” or “Error Code: 0x80004005. Error Description: Can’t convert “2201010001” to long.（FIP-FS扫描处理初始化失败……无法将“2201010001”转变为long数据类型）</p><p>它最初被一位名叫@miketheitguy的推特用户发现：</p><p><a target="_blank" href="https://static.cnbetacdn.com/article/2022/0102/34b2499da8741a7.png"><img data-original="https://static.cnbetacdn.com/article/2022/0102/34b2499da8741a7.png" src="https://static.cnbetacdn.com/thumb/article/2022/0102/34b2499da8741a7.png" referrerpolicy="no-referrer"></a></p><p>由于和“千年虫”一样都是日期给计算机带来的bug，这次bug也被一些Exchange管理员命名为Y2K22。</p><p>其中，Y2K指的是著名的“千年虫”问题，由于部分计算机程序只采用两位十进制数表示年份，在跨世纪时就会出现错误的结果；22指的则是2022年。</p><p>这个bug在不少Exchange Server版本中都出现了相同的问题，包括2016和2019等。</p><p><a target="_blank" href="https://static.cnbetacdn.com/article/2022/0102/4c51a93e88616b9.png"><img data-original="https://static.cnbetacdn.com/article/2022/0102/4c51a93e88616b9.png" src="https://static.cnbetacdn.com/thumb/article/2022/0102/4c51a93e88616b9.png" referrerpolicy="no-referrer"></a></p><p><strong>目前，微软的Exchange团队正在紧急修复中。</strong></p><p>他们表示，几天后会发布一个Exchange Server更新，里面将用一个更大的变量类型来保存日期。</p><p><a target="_blank" href="https://static.cnbetacdn.com/article/2022/0102/688b0c7f3646c21.png"><img data-original="https://static.cnbetacdn.com/article/2022/0102/688b0c7f3646c21.png" src="https://static.cnbetacdn.com/thumb/article/2022/0102/688b0c7f3646c21.png" referrerpolicy="no-referrer"></a></p><p>然而在这之前，使用Exchange Server的公司们必须想办法把邮件发出去。</p><p><strong>一些权宜之计</strong></p><p>微软团队表示，如果有非常紧急的邮件需要发送，需要先关掉Exchange中的FIP-FS功能。</p><p>这是个Exchange上的垃圾邮件过滤器，平时会用来扫描邮件中自带的恶意软件、或是垃圾邮件。</p><p>目前微软官方也提供了一些禁用或绕过恶意软件扫描的方法。</p><p>然而，这样操作的后果是公司邮箱“可能收到更多垃圾邮件”。</p><p>对此有网友调侃，如果微软在修复中把有符号变量改成无符号变量，那么数据的表示范围就会变成0~4294967295，Exchange邮箱又可以用到2043年了。</p><p><a target="_blank" href="https://static.cnbetacdn.com/article/2022/0102/b485fa5d964c6b5.png"><img data-original="https://static.cnbetacdn.com/article/2022/0102/b485fa5d964c6b5.png" src="https://static.cnbetacdn.com/thumb/article/2022/0102/b485fa5d964c6b5.png" referrerpolicy="no-referrer"></a></p><p>除此之外，目前Reddit网友还给出了一些其他的解决方案。</p><p>例如，有网友发布了一个非官方的自定义脚本，可以将日期回滚到2021年，但他对此表示，一切风险需要使用者自己承担。</p><p>如果还没想好怎么解决你的Exchange邮箱系统问题，可以先用上面这些方法试一试。</p>   
</div>
            