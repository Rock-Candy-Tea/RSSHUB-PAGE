
---
title: '浏览器版本破百，_千年虫_问题再现？'
categories: 
 - 新媒体
 - 虎嗅
 - 首页资讯
headimg: 'https://img.huxiucdn.com/article/content/202202/18/184007450573.png?imageView2/2/w/1000/format/png/interlace/1/q/85'
author: 虎嗅
comments: false
date: Fri, 18 Feb 2022 12:18:00 GMT
thumbnail: 'https://img.huxiucdn.com/article/content/202202/18/184007450573.png?imageView2/2/w/1000/format/png/interlace/1/q/85'
---

<div>   
<p><span class="text-remarks" label="备注">本文来自微信公众号：</span><a href="https://mp.weixin.qq.com/s/l7181CxNUSPKjmvtJz_jyw" target="_blank" rel="nofollow" style="text-decoration: none;"><span class="text-remarks">CSDN（ID：CSDNnews）</span></a><span class="text-remarks">，作者：郑丽媛，头图来自：视觉中国</span></p><p>不知道有多少人还记得，在时间即将跨入 2000 年的时候，计算机领域曾发生过著名的“千年虫”问题。</p><p>“千年虫”不是病毒、也不是什么神奇生物，它只是计算机系统由于时间紊乱产生的一种 Bug：为了节省昂贵的存储空间，上世纪的计算机系统人员通常会把年份只用后两位数表示，所以等到 2000 年时，计算机无法识别这个“00”是 1900 年还是 2000 年，由此引发大范围系统功能紊乱甚至崩溃。</p><p>本以为这个杀伤力极强的 Bug 不会再轻易出现，不曾想在浏览器版本迭代中，也存在类似“千年虫”的问题。</p><h3 label="大标题" class="text-big-title">一、版本号首次突破个位数，网站：“您的浏览器版本过低”</h3><h3 label="大标题" class="text-big-title"></h3><p>浏览器版本中的“千年虫”不是时间问题，而是版本号位数的突破，因此最初出现这一问题时，是浏览器版本号由个位数升级至“10”的时候。</p><p>2009 年，Opera 浏览器首次更新至版本 10，就在用户高高兴兴升级至最新版本后，访问网站时却被提醒道：“您的浏览器版本过低，请升级…”彼时，许多用户第一反应：什么，难道已经有 Opera 11 了？搜了搜，没有啊！再去看看别的网站…嗯，倒是能访问，但为啥有些功能突然不支持了，网站布局也有些错位？</p><p>在众多用户向 Opera 提出投诉后，Opera 官方给出了解释：<strong>这与 User-Agent 字符串有关，而 Opera 10 是第一个突破十位数的版本号。</strong></p><p>User-Agent，是 Http协议中的一部分，属于头域的组成部分，其中包括有关软件的信息，例如浏览器名称、版本号以及它使用的各种技术。当有人访问网站时，浏览器的 User-Agent 会与网页请求一并发送，便于网站检查访问者的浏览器版本由此提供不同的响应。</p><p>“根据之前浏览器版本的逻辑，我们在发布 Opera 10 alpha 版本时给了它一个 User-Agent 字符串：Opera/10.00 (Macintosh; Intel Mac OS X; U; en) Presto/2.2.0。但很快我们就发现，很多为特定于版本提供不同内容和脚本而部署了浏览器嗅探功能的网站，似乎不能很好地消化 User-Agent 中的‘Opera/10.00’部分。”Opera 如此回应道。</p><h3 label="大标题" class="text-big-title">二、将 Opera 10 认定为 Opera 1</h3><h3 label="大标题" class="text-big-title"></h3><p>在那个时期，浏览器尚未发展很长时间，多数浏览器的版本号一直保持在个位数以内，而Opera 10 是第一个版本号达到两位数的浏览器。因此，相当多的浏览器嗅探脚本似乎并没有对这一变化做好准备，仍习惯于仅检测 User-Agent 字符串的第一个数字——也就是说，<strong>这些网站会错误地将 Opera 10 认定为 Opera 1，从而将 Opera 10 识别为不支持的浏览器，从而破坏服务器以及客户端脚本</strong>。</p><p>Opera 官方承认了 Opera 10 在一些网站上存在 Bug：在部分网站上，Flash 视频的位置处在预期高度的一半，因为 height 参数所依赖的浏览器嗅探脚本将 Opera 10 识别为 Opera 10 1，这就导致了该值不正确和错乱布局。</p><p>这一问题很像当年的“千年虫”问题，因此在经过几个月对站点兼容性影响的仔细分析后，Opera 决定冻结字符串的第一部分“Opera/9.80”，并在最后添加版本号“Version/10.00”或“Version/11.00”等，以此在确保提供真实版本号的同时，避免因两位数版本号引发的相关问题。作为参考，Mac 平台下默认英语的 Opera 10 User-Agent 如下：</p><blockquote><p><code>Opera/9.80 (Macintosh; Intel Mac OS X; U; en) Presto/2.2.15 Version/10.00</code></p></blockquote><p>在 Opera 官方 2009 年对此事的回应中，就曾预言过：“其他浏览器也要注意这个问题，像 IE 距离版本 10 只差两个版本<span class="text-remarks" label="备注">（当时 IE 浏览器更新至 IE 8）</span>，将来可能也会发生类似的问题。”</p><p>如 Opera 所料，三年后 Firefox 10 也遇到了相同问题：</p><p class="img-center-box"><img class="lazyImg" _src="https://img.huxiucdn.com/article/content/202202/18/184007450573.png?imageView2/2/w/1000/format/png/interlace/1/q/85" data-w="894" data-h="251" src="https://img.huxiucdn.com/article/content/202202/18/184007450573.png?imageView2/2/w/1000/format/png/interlace/1/q/85" referrerpolicy="no-referrer"></p><h3 label="大标题" class="text-big-title">三、梅开二度：Chrome、Firefox 版本即将破百</h3><h3 label="大标题" class="text-big-title"></h3><p>两位数的版本号问题这十几年来已完美解决，但与此同时各大浏览器也在快速发展，如今年 2 月，<strong>谷歌推出了 Chrome 98，随后 Mozilla 也发布了 Firefox 97，二者版本号即将突破 100</strong>，那么历史会再度重演吗？</p><p>来自 Mozilla、谷歌的消息显示：<strong>会，但可能不会太严重。</strong></p><p>自去年 8 月起，Mozilla 就已对三位数版本号的“Firefox/100”User-Agent 字符串进行测试，查看其是否会导致网站出现问题，谷歌也紧随其后开始其 Chrome 100 的实验。</p><p>结果他们在测试中发现，果然有少数网站在解析浏览器三位数版本号的 User-Agent 字符串时出现错误，导致出现“网站声明不支持浏览器”、“影响网站部分用户界面”等问题，这些网站包括 HBO Go、Bethesda、Yahoo、Slack 及由 Duda 网站构建器所创建的网站。</p><p>Mozilla 对此解释道：“在没有单一规范可遵循的情况下，不同的浏览器对 User-Agent 字符串和特定于站点的 User-Agent 解析具有不同的格式。有些解析库可能存在硬编码错误，没有考虑到三位数的版本号。”</p><p>同时，Mozilla 还补充道，这次的影响范围不会太严重：“<strong>当初浏览器升级至两位数版本号时，许多库都改进了解析逻辑，因此预计这次版本号达到三位数所导致的问题会较少</strong>。”</p><h3 label="大标题" class="text-big-title">四、网站开发者/管理员需自行检测</h3><h3 label="大标题" class="text-big-title"></h3><p>据外媒 The Register 报道，谷歌计划在今年 4 月初发布 Chrome 100，而 Firefox 100 预计将在 5 月发布。在此之前，Mozilla 和谷歌都将针对已发现的问题进行完善，如若届时尚未完全修复，两家公司也已准备好应对措施：冻结 User-Agent 中的“Firefox/99”或“Chrome/99”部分，在其他部分再附上实际版本。</p><p>但这只是应急措施，不论 Mozilla 还是谷歌，都希望网站开发人员和管理员可以自行测试 Firefox 100 和 Chrome 100 的 User-Agent 是否会对其网站产生破坏。一旦发现问题，可在 webcompat.com 上提交报告。</p><p><span class="text-remarks" label="备注">参考链接：</span></p><p><span class="text-remarks" label="备注">https://www.bleepingcomputer.com/news/software/mozilla-warns-chrome-firefox-100-user-agents-may-break-sites/</span></p><p><span class="text-remarks" label="备注">https://www.theregister.com/2022/02/17/browsers_version_100_websites_bug/</span></p><p><span class="text-remarks" label="备注">https://maqentaer.com/devopera-static-backup/http/dev.opera.com/articles/view/opera-ua-string-changes/index.html</span></p><p><span class="text-remarks" label="备注">本文来自微信公众号：</span><a href="https://mp.weixin.qq.com/s/l7181CxNUSPKjmvtJz_jyw" target="_blank" rel="nofollow" style="text-decoration: none;"><span class="text-remarks">CSDN（ID：CSDNnews）</span></a><span class="text-remarks">，作者：郑丽媛</span></p>  
</div>
            