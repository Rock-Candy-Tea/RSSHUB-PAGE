
---
title: '通俗易懂，揭秘比特币区块的内部结构'
categories: 
 - 新媒体
 - 人人都是产品经理
 - 热门文章
headimg: 'https://cors.zfour.workers.dev/?http://image.woshipm.com/wp-files/img/39.jpg'
author: 人人都是产品经理
comments: false
date: Sat, 12 May 2018 00:00:00 GMT
thumbnail: 'https://cors.zfour.workers.dev/?http://image.woshipm.com/wp-files/img/39.jpg'
---

<div>   
<img data-action="zoom" src="https://cors.zfour.workers.dev/?http://image.woshipm.com/wp-files/img/39.jpg" referrerpolicy="no-referrer"><blockquote><p>我们通过前面几期的学习，基本对区块链网络中各节点的外部协作有了一个宏观认识，接下来将从更加微观的角度开始学习区块链。</p></blockquote>
<p>
</p><p>你有没有思考过区块链中每个区块内部是什么样的呢？全网如此复杂的数据它会怎么去存储的呢？</p>
<p>本期就带你一探究竟！</p>
<h2 id="toc-1">一、区块链的总体结构</h2>
<p>区块链之所以叫做区块链，是因为它真的就是一堆由包含交易信息的区块，通过前后首位相接起来的链式结构，每个区块都是链式结构中的一节。</p>
<p><strong>为什么区块之间能够实现前后连接的呢？</strong></p>
<p>因为每个区块都通过一个数值（父哈希值，下节即将解释）指向前一个区块，以此类推，区块与区块连成一个链条，可以一直追溯到创始区块。</p>
<p>这又是一个大规模协作的例子，每个区块只需执行自己的简单的规则，就能形成一个复杂的系统。</p>
<p><img data-action="zoom" class="aligncenter wp-image-1023465" src="https://cors.zfour.workers.dev/?http://image.woshipm.com/wp-files/2018/05/xbMYHk3xYEx2vvxy6qZj.jpg" alt width="592" height="297" referrerpolicy="no-referrer"></p>
<h2 id="toc-2">二、一个区块的整体结构</h2>
<p>每个区块主要包含了两部分，区块头和区块体。<strong>区块头主要用来存储本区块的一些相关属性，区块体则用来存储真实的交易数据记录。</strong></p>
<p>一个区块前后分别连接了父区块和子区块，如下图：</p>
<p><img data-action="zoom" class="aligncenter wp-image-1023466" src="https://cors.zfour.workers.dev/?http://image.woshipm.com/wp-files/2018/05/AtcMoc9wnwc1hR3elozu.jpg" alt width="709" height="350" referrerpolicy="no-referrer"></p>
<h2 id="toc-3">三、区块体</h2>
<p>我们先从区块体说起，看看它是如何将交易数据进行存储的。</p>
<p>下面是一个区块体的结构图：</p>
<p><img data-action="zoom" class="aligncenter wp-image-1023467" src="https://cors.zfour.workers.dev/?http://image.woshipm.com/wp-files/2018/05/FicMxfyVwluOYzTPPkPS.jpg" alt width="682" height="280" referrerpolicy="no-referrer"></p>
<p>区块体包括当前<strong>区块经过验证的、 区块创建过程中生成的所有交易记录</strong>。这些记录通过默克尔（ Merkle）树的哈希过程生成唯一的默克尔，根并记入区块头。</p>
<p><strong>什么是默克尔根呢？</strong></p>
<p>首先了解一下默克尔（merkle）树，默克尔树是一种哈希二叉树，<strong>它是一种用作快速归纳和校验大规模数据完整性的数据结构</strong>。这种二叉树包含加密哈希值，术语“树”在计算机学科中常被用来描述一种具有分支的数据结构。</p>
<p>在比特币网络中，默克尔树被用来归纳一个区块中的所有交易，同时生成整个交易集合的数字指纹，且提供了一种校验区块是否存在某交易的高效途径。</p>
<p>生成一棵完整的默克尔树需要递归地对哈希节点对进行哈希，并将新生成的哈希节点插入到默克尔树中，直到只剩一个哈希节点，该节点就是默克尔树的根。</p>
<p>说人话，默克尔树可以理解为一颗倒立的树，这棵树<strong>每个树杈只能分两个树枝出来</strong>，最终每个最小树枝上都会挂两片叶子。</p>
<p>这里的每片叶子就是一笔交易记录，每个树杈的<strong>分叉点就是一个哈希值</strong>，每个哈希值都是根据树杈分出的两个树枝的分叉点或者叶子的哈希值计算出来的。</p>
<p>这些这些分叉节点的哈希值向上一级分叉点汇聚，再进行哈希计算生成一个哈希值。以此类推，最终汇聚到树根上，这个树根计算出来的哈希值就是根哈希值。通过这种结构能够快速对其中的某笔交易进行定位。</p>
<p><strong>默克尔树的特点是：底层数据的任何变动，都会传递到其父亲节点，一直到树根</strong>。</p>
<p>理解了默克尔树，相信你会对上图的区块体结构图有一个更加深刻的认识。</p>
<h2 id="toc-4"> 四、区块头</h2>
<p>区块头主要由三组数据组成，第一组是父区块的哈希值，父哈希值用来将该区块与它的前一区块相连接；第二组数据和矿工竞争挖矿有关，即难度、时间戳和Nonce(随机数）；第三组是由刚才我们讲到的区块体中计算出来的根哈希值，即默克尔树根。</p>
<p><img data-action="zoom" class="aligncenter" src="https://cors.zfour.workers.dev/?http://image.woshipm.com/wp-files/2018/05/1ddhY4CrWIlq4l1Kn0Y5.png" alt width="676" height="261" referrerpolicy="no-referrer"></p>
<p>这里要着重了解一个概念，<strong>什么是父哈希值？</strong></p>
<p>对区块中的区块头的数据进行哈希运算会生成一个哈希值，区块头中的任何数据改变都会导致这个哈希值改变，所以<strong>这个哈希值可以作为这个区块独一无二的标志</strong>。</p>
<p>通过这个哈希值就能在区块链中找到对应的区块，而这个哈希值对于连在后面的一个新的区块来说就是父哈希值。</p>
<p>这里需要注意的一点是：<strong>本区块不会存储自身的哈希值，只存储它的父区块的哈希值，自身的哈希值将会存储在子区块中，作为子区块的父哈希值。</strong></p>
<p>因为每个区块的区块头中都包含了它的父哈希值，并且只有一个父哈希值（因为区块链只有一条最长链），所以每个区块通过它的父哈希值就能一直追溯到创世区块（第一个区块）。</p>
<p>引入了父哈希的概念不仅将区块与区块连接到一起，而且还能保证区块链的不可篡改性。</p>
<p>由于区块头里面包含父区块哈希值，所以当前区块的哈希值也受到该数值的影响。如果父区块中的数据发生改变，那它的哈希值必然也会改变，导致子区块就无法再通过原始父哈希值连接到上一个区块。</p>
<p>所以，如果想要改变一个区块的数据，那就要将它后面的所有区块再重新运算一遍。正是因为这样的重新计算需要耗费巨大的计算量几乎是无法实现的，进一步保证了区块链网络的安全性。</p>
<p>区块头中的第二组数据，难度、时间戳和Nonce我会在后面讲解挖矿的时候详细介绍，这里我们只需要知道区块头中包含这些东西就行，方便前期建立整体概念。</p>
<h2 id="toc-5">五、为什么区块要设计成这种结构</h2>
<p>对于区块的内部结构基本剖析完了，但你有没有想过区块设计成这种结构有什么好处吗？</p>
<p>首先我们要知道区块头是80字节，而平均每个交易至少是250字节，而且平均每个区块至少包含超过500个交易。因此，一个包含所有交易的完整区块体比区块头的1000倍还要大。</p>
<p>区块链是一个分布式网络，所以数据需要存储在各个节点当中，但是比特币网络的完整数据加起来可能有几十上百个G，这不是一个普通的终端能够承受的起的，许多比特币客户端被设计成运行在空间和功率受限的设备上。</p>
<p>如：智能电话、平板电脑、嵌入式系统等，它们是没有办法存储比特币网络的所有数据的，该怎么办呢？</p>
<p>这个时候就能看到区块结构的高明之处了，比特币网络中的很多节点主要是用来验证交易的，它们只需要下载区块头，不需要下载包含在每个区块中的交易信息就能完成交易验证。</p>
<p>这样的不含交易信息的区块链，大小只有完整区块链的几千分之1，大大节约了终端的使用空间。</p>
<p>正是因为区块的内部结构才可以实现一个终端，只需要通过区块头的数据就能对某笔交易进行验证，这就是简单支付验证（SPV），这样的节点就叫做SPV节点，具体实现原理将会在下期讲解。</p>
<h2 id="toc-6">六、总结</h2>
<p>区块体和区块头的紧密连接，区块头和父子区块的前后配合，各个节点环环相扣，实现了一个坚不可摧的链条，对比特币研究的越深，越能体会到它的强大之处，各种巧妙的思想让人叹为观止。</p>
<p>我们不研究代码，只是从整体设计思想来观察比特币区块的内部结构，希望这篇文章能让你看明白。</p>
<p> </p>
<p>版权声明：数字签名：<a href="https://press.one/file/v?s=18a698f8b979841e3fdcd332c65355f3c1c0e2fa75e2393853387d6465ba29dd74615343994f8e5e9a62cab3974ca00fb29276e433e35b3d9368a45e901db8ba0&h=ff431ea34701fa9ec3d30cb35f872d0e283f672b4f5003c6c49f312a76319261&a=efcef103a3c33d065af9484050ee38a43e6e2d2f&f=P1&v=2" target="_blank" rel="noopener">Press.one</a></p>
<p>作者：liheng，区块链探索者、互联网产品经理，超级个体修炼中，只创作对用户有价值的内容</p>
<p>本文由 @liheng 原创发布于人人都是产品经理。未经许可，禁止转载</p>
<p>题图来自Pixabay，基于 CC0 协议</p>
<div class="support-author"><div class="support-title">给作者打赏，鼓励TA抓紧创作！</div><button class="button--pay" data-post-id="1022259" data-author="340820" data-avatar="http://image.woshipm.com/wp-files/2018/05/QFVjgzPSbmWGyoEfswKw.jpeg"><svg width="13" height="16" class="svgIcon--use" viewBox="0 0 13 16"><path d="M9.113,4.571 C9.951,3.771 10.895,2.742 10.685,2.057 C10.475,1.485 10.056,0.799 9.427,0.571 C8.903,0.342 8.379,0.456 7.750,0.799 C7.540,0.342 7.016,0.114 6.596,-0.001 C5.863,-0.001 5.234,0.228 4.814,0.914 C4.080,0.571 3.451,0.685 2.927,1.028 C2.613,1.256 2.298,1.713 2.298,2.628 C2.298,3.542 3.137,4.228 3.766,4.685 C2.508,5.599 -0.218,7.885 -0.008,12.228 C-0.218,15.656 2.613,15.999 2.613,15.999 L10.371,15.999 C11.314,15.885 12.991,14.971 12.991,12.571 L12.991,12.228 C13.201,7.771 10.371,5.371 9.113,4.571 L9.113,4.571 ZM8.932,11.835 L6.940,11.835 L6.940,13.207 C6.940,13.435 6.731,13.549 6.521,13.549 C6.311,13.549 6.102,13.435 6.102,13.207 L6.102,11.835 L4.110,11.835 C3.900,11.835 3.795,11.606 3.795,11.378 C3.795,11.149 3.900,10.921 4.110,10.921 L6.102,10.921 L6.102,10.121 L4.949,10.121 C4.739,10.121 4.634,9.892 4.634,9.664 C4.634,9.435 4.739,9.206 4.949,9.206 L5.892,9.206 L4.739,7.950 C4.634,7.835 4.739,7.606 4.949,7.492 C5.158,7.378 5.368,7.264 5.473,7.378 L6.521,8.635 L7.674,7.264 C7.779,7.149 7.989,7.264 8.198,7.378 C8.408,7.492 8.408,7.721 8.408,7.835 L7.150,9.321 L8.094,9.321 C8.303,9.321 8.408,9.549 8.408,9.778 C8.408,10.007 8.303,10.235 8.094,10.235 L6.940,10.235 L6.940,11.035 L8.932,11.035 C9.142,11.035 9.247,11.264 9.247,11.493 C9.247,11.606 9.037,11.835 8.932,11.835 L8.932,11.835 Z"/></svg>
赞赏</button><div class="pay-num">6人打赏</div><div class="donation-list"><div class="donation-item"><img class="avatar" src="https://static.woshipm.com/TTW_USER_R_201706_20170602174856_7219.jpg?imageView2/1/w/80" height="32" width="32" referrerpolicy="no-referrer"></div><div class="donation-item"><img class="avatar" src="https://static.woshipm.com/TTW_USER_R_201706_20170602175120_6191.jpg?imageView2/1/w/80" height="32" width="32" referrerpolicy="no-referrer"></div><div class="donation-item"><img class="avatar" src="https://static.woshipm.com/TTW_USER_R_201706_20170602182447_7871.jpg?imageView2/1/w/80" height="32" width="32" referrerpolicy="no-referrer"></div><div class="donation-item"><img class="avatar" src="https://static.woshipm.com/TTW_USER_R_201706_20170602183415_5446.jpg?imageView2/1/w/80" height="32" width="32" referrerpolicy="no-referrer"></div><div class="donation-item"><img class="avatar" src="https://static.woshipm.com/TTW_USER_R_201706_20170602182728_5484.jpg?imageView2/1/w/80" height="32" width="32" referrerpolicy="no-referrer"></div><div class="donation-item"><img class="avatar" src="https://static.woshipm.com/TTW_USER_R_201706_20170602175113_1988.jpg?imageView2/1/w/80" height="32" width="32" referrerpolicy="no-referrer"></div></div></div>                      
</div>
            