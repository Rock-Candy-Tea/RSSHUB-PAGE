
---
title: '从0搭建品牌专属防伪溯源系统（1）：防伪溯源功能的实现'
categories: 
 - 新媒体
 - 人人都是产品经理
 - 最新文章
headimg: 'https://cors.zfour.workers.dev/?http://image.woshipm.com/wp-files/2021/08/Uwohr9kiYAi6y56MAMQl.jpg'
author: 人人都是产品经理
comments: false
date: Sat, 28 Aug 2021 00:00:00 GMT
thumbnail: 'https://cors.zfour.workers.dev/?http://image.woshipm.com/wp-files/2021/08/Uwohr9kiYAi6y56MAMQl.jpg'
---

<div>   
<blockquote><p>编辑导语：为了区别假货与正品，企业需要思考如何让消费者得以成功鉴别二者的差别，避免上当。其中，防伪溯源码在一定程度上可以帮助消费者进行鉴别。但若遇到真码被复制到假货等情况的发生，企业又应该如何应对？本文作者介绍了防伪溯源系统中的防伪溯源功能实现问题，一起来看一下。</p></blockquote>
<p><img data-action="zoom" class="size-full wp-image-5114519 aligncenter" src="https://cors.zfour.workers.dev/?http://image.woshipm.com/wp-files/2021/08/Uwohr9kiYAi6y56MAMQl.jpg" alt width="900" height="420" referrerpolicy="no-referrer"></p>
<h2 id="toc-1">一、前言</h2>
<p>当公司防伪溯源需求碰撞上微信的一物一码……</p>
<h2 id="toc-2">二、背景</h2>
<p>品牌管理公司需要给终端客户一个查询真伪的工具，用户扫码就可以识别手上商品的真伪。</p>
<h2 id="toc-3">三、分析</h2>
<ul>
<li>表层：给终端客户用，查询真伪。</li>
<li>深层：实际需求是根据防伪码绑定商品和订单，方便品牌方控制市场，例如串货或者乱价。</li>
</ul>
<h2 id="toc-4">四、思考</h2>
<p>假货流入市场，想要以假乱真，也会贴上看上去一样的防伪码。遇到用户扫码时，扫码结果页假货一样会给出正品的反馈。那假货上的防伪码是怎么给出正品的反馈呢？</p>
<ol>
<li>码是真的，但防伪码生成算法被破解了。</li>
<li>造假团伙批量复制了真码贴到假货上。</li>
<li>制造码的工厂流出真的防伪码。</li>
<li>造假团伙搞了个UI界面一模一样的假的防伪系统。</li>
</ol>
<p>针对以上的可能性，我们要想办法一一处理。</p>
<h3>1. 二维码生成算法被破解怎么办？</h3>
<p>采购第三方防伪系统最容易出现的就是这个问题，因为市场上防伪系统基本上都是开放式的，算法类似。所以我们采用纯自研形式。要降低系统被破解的风险，除去技术层面的解法，作为产品，我们只能在方案上增加破解难度。</p>
<p>正好，微信为了流量入口，推出了他们的一物一码功能，可以直接使用微信一物一码做深层次应用处理。微信一物一码算法被破解之前，我们只需要保证我们业务系统的安全性就可以了。</p>
<p><img data-action="zoom" class="aligncenter" src="https://cors.zfour.workers.dev/?http://image.woshipm.com/wp-files/2021/08/5sKaAITWKseIcwGskjc8.jpg" alt width="488" height="693" referrerpolicy="no-referrer"></p>
<p><img data-action="zoom" class="aligncenter" src="https://cors.zfour.workers.dev/?http://image.woshipm.com/wp-files/2021/08/86r4UsopOzT3IjBtS5yF.jpg" alt width="489" height="486" referrerpolicy="no-referrer"></p>
<h3>2. 真码被复制到假货上怎么办？</h3>
<p>真码被复制到假货上，那这个码就会被很多终端客户买到，我们只需要提示用户这个码有没有出现一码多扫就能解决这个问题。如下流程图所示。</p>
<p><img data-action="zoom" class="aligncenter" src="https://cors.zfour.workers.dev/?http://image.woshipm.com/wp-files/2021/08/jAHKOiQQED33VHNgu8Ae.png" alt width="489" height="538" referrerpolicy="no-referrer"></p>
<p>因为一物一码扫码结果是个小程序，这儿我们还能加上小程序订阅消息。哪怕你扫码的时候提示正品了，后面这个码被别的微信扫了，我们一样给你提醒。</p>
<h3>3. 制造码的工厂流出真的防伪码怎么办？</h3>
<p>防伪码是真的，但是我们可以限制仅激活的码才可以查询啊。工厂流出没关系，扫码我一样提醒你无效防伪码。至于什么时候激活，这一步我们安排在了出库发货的时候。这儿就涉及到了和仓库系统的对接。</p>
<h3>4. 造假团伙搞了个UI界面一模一样的假的防伪页面怎么办？</h3>
<p>微信一物一码已经帮我们解决了这个问题，防伪结果页是我们自家小程序，你能仿H5页面（服务器在国外不需要备案，所以抓不住造假人），但是防不了实名的企业认证小程序啊。有本事也去实名一下，我们正愁找不到是谁仿冒的呢。</p>
<p>如果不用一物一码方案，也可以直接绑定公众号，仅限公众号内能扫出来的才是真的链接，或者使用自家小程序。品牌比较大有自己APP的，还能嫁接到APP里面，顺便做一波引流了。</p>
<h2 id="toc-5">五、原材料</h2>
<p>根据上文思路，要搭建这个防伪系统，我们先要准备原材料。</p>
<h3>1. 一物一码</h3>
<p>微信一物一码文档很简单，你有个开通了这个功能的公众号就可以。申请的时候，微信会给你回传一个密钥用于解码。</p>
<p>关于一物一码的原材料就三种：公众号的APPID、SECRET（这两个用于换取ACCESS_TOKEN，调用一物一码接口的凭证）、公众号对应的密钥（用于把微信接口返回的文件BUFFER解码）。</p>
<h3>2. 防伪结果页</h3>
<p>扫码结果要求是小程序，所以我们有个自己的小程序就好了。</p>
<p>顺便拓展一下，扫描的是商品，除了防伪结果以外，这个小程序上我们还可以承载一些附属价值。例如扫码之后，送你个券用于回购，提示关注公众号领红包，提示加企业微信领样品等。或者最简单的，放一些商品使用小tips提升用户体验，增强用户对品牌的记忆也可以。</p>
<p>关于结果页的原材料就两种：小程序APPID和小程序PATH（决定了扫码之后跳转到哪个小程序的哪个页面）。</p>
<h2 id="toc-6">六、简单业务流程图</h2>
<p><img data-action="zoom" class="aligncenter" src="https://cors.zfour.workers.dev/?http://image.woshipm.com/wp-files/2021/08/fUEquQ5y4qSHBxvg6AV9.png" alt width="594" height="610" referrerpolicy="no-referrer"></p>
<h3>关键点</h3>
<p>和微信一物一码系统进行对接，申请完获得文件buffer之后，需要先批量解密获得原始码和点阵码。</p>
<p>点阵码做刮刮乐用的，给打印工厂就可以。原始码是一切业务的关联，理解成外键就好。点阵码只有用户扫码防伪的时候用了一下，去微信那边查询是否激活，如果已经激活了，就找到对应的原始码。后面所有的业务逻辑还是建立在原始码上。</p>
<h2 id="toc-7">七、防伪溯源功能的实现逻辑</h2>
<p><img data-action="zoom" class="aligncenter" src="https://cors.zfour.workers.dev/?http://image.woshipm.com/wp-files/2021/08/wtiXlVRDgC35JYAKmXcW.png" alt width="585" height="794" referrerpolicy="no-referrer"></p>
<h2 id="toc-8">八、尾声</h2>
<p>简易版本的基于微信一物一码的防伪溯源系统到此结束，下面附上核心页面截图。之后等我有空了，会写三篇续文，主要是结合erp箱码说说复杂场景下降低仓库内防伪码操作难度、防伪码的营销场景应用逻辑、防伪码的物理防复制方案。</p>
<p><img data-action="zoom" class="aligncenter" src="https://cors.zfour.workers.dev/?http://image.woshipm.com/wp-files/2021/08/8GPbzZrOTJ6RBP6vucjA.png" alt width="747" height="454" referrerpolicy="no-referrer"></p>
<p> </p>
<p>本文由 @陌小墨 原创发布于人人都是产品经理。未经许可，禁止转载。</p>
<p>题图来自Unsplash，基于 CC0 协议</p>
<div class="support-author"><div class="support-title">给作者打赏，鼓励TA抓紧创作！</div><button class="button--pay" data-post-id="5113715" data-author="337075" data-avatar="https://static.woshipm.com/woshipm_def_head.jpg"><svg width="13" height="16" class="svgIcon--use" viewBox="0 0 13 16"><path d="M9.113,4.571 C9.951,3.771 10.895,2.742 10.685,2.057 C10.475,1.485 10.056,0.799 9.427,0.571 C8.903,0.342 8.379,0.456 7.750,0.799 C7.540,0.342 7.016,0.114 6.596,-0.001 C5.863,-0.001 5.234,0.228 4.814,0.914 C4.080,0.571 3.451,0.685 2.927,1.028 C2.613,1.256 2.298,1.713 2.298,2.628 C2.298,3.542 3.137,4.228 3.766,4.685 C2.508,5.599 -0.218,7.885 -0.008,12.228 C-0.218,15.656 2.613,15.999 2.613,15.999 L10.371,15.999 C11.314,15.885 12.991,14.971 12.991,12.571 L12.991,12.228 C13.201,7.771 10.371,5.371 9.113,4.571 L9.113,4.571 ZM8.932,11.835 L6.940,11.835 L6.940,13.207 C6.940,13.435 6.731,13.549 6.521,13.549 C6.311,13.549 6.102,13.435 6.102,13.207 L6.102,11.835 L4.110,11.835 C3.900,11.835 3.795,11.606 3.795,11.378 C3.795,11.149 3.900,10.921 4.110,10.921 L6.102,10.921 L6.102,10.121 L4.949,10.121 C4.739,10.121 4.634,9.892 4.634,9.664 C4.634,9.435 4.739,9.206 4.949,9.206 L5.892,9.206 L4.739,7.950 C4.634,7.835 4.739,7.606 4.949,7.492 C5.158,7.378 5.368,7.264 5.473,7.378 L6.521,8.635 L7.674,7.264 C7.779,7.149 7.989,7.264 8.198,7.378 C8.408,7.492 8.408,7.721 8.408,7.835 L7.150,9.321 L8.094,9.321 C8.303,9.321 8.408,9.549 8.408,9.778 C8.408,10.007 8.303,10.235 8.094,10.235 L6.940,10.235 L6.940,11.035 L8.932,11.035 C9.142,11.035 9.247,11.264 9.247,11.493 C9.247,11.606 9.037,11.835 8.932,11.835 L8.932,11.835 Z"/></svg>
赞赏</button><div class="pay-num">1人打赏</div><div class="donation-list"><div class="donation-item"><img class="avatar" src="https://image.woshipm.com//wp-files/2015/10/touxiang-7.jpg!/format/webp/lossless/true/both/80x80" height="32" width="32" referrerpolicy="no-referrer"></div></div></div>                      
</div>
            