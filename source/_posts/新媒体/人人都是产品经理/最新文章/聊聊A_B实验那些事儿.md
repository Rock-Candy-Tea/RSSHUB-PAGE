
---
title: '聊聊A_B实验那些事儿'
categories: 
 - 新媒体
 - 人人都是产品经理
 - 最新文章
headimg: 'https://image.yunyingpai.com/wp/2022/01/UyCEVv4AtHwWRMyc2Hxt.png'
author: 人人都是产品经理
comments: false
date: Wed, 19 Jan 2022 00:00:00 GMT
thumbnail: 'https://image.yunyingpai.com/wp/2022/01/UyCEVv4AtHwWRMyc2Hxt.png'
---

<div>   
<blockquote><p>编辑导语：作为一个大部分业务都依赖的重要引擎，在实际使用过程中却发现会遇到各种各样的问题。这篇文章详细介绍了数据驱动的核心引擎——A/B实验，分别从过程、节奏以及结果进行阐述，推荐想要了解A/B实验的童鞋阅读。</p></blockquote>
<p><img data-action="zoom" class="aligncenter size-full wp-image-740427" src="https://image.yunyingpai.com/wp/2022/01/UyCEVv4AtHwWRMyc2Hxt.png" alt referrerpolicy="no-referrer"></p>
<p>A/B实验是数据驱动的核心引擎，目前大部分业务都依赖它进行决策，但在实际运行过程中会遇到各种各样问题。</p>
<p>下面让我一起聊聊A/B实验那些事儿。</p>
<h2 id="toc-1">一、AB实验设计过程</h2>
<p>首先聊聊实验设计过程，实验设计过程包含4个核心问题：</p>
<h3>问题1：随机分桶单元是什么？</h3>
<p>大部分随机分桶是按用户维度，用户维度有登录id、设备id、匿名用户id（cookie），除cookie在时间纵向上不稳定，登录id和设备id均是长期稳定的。</p>
<p>分桶方法：目前有很多A/B实验平台都可以支持分桶，主要通过设备id和层级id使用Hash函数进行分桶，同样也存在按尾号分桶情况，若是尾号分桶需要考虑各个尾号样本数据是否均衡，例如是否会存在某个尾号经常做实验，造成样本不均衡。</p>
<h3>问题2：我们的目标群体是什么？</h3>
<p>思考实验的目标群体是什么，实验的背景和目标是什么，是实验设计的核心问题，若实验是一个以特定群体为目标意味着你只想对具有某一特征下的特定用户运行实验，那么触发条件变得尤为重要，因实验触发条件不同可能会导致幸存者偏差等各类问题，从而导致实验结果不可信。</p>
<h3>问题3：实验需要多大的样本量？</h3>
<p>实验需要多大样本量，涉及到实验功效是否充足情况，对结果的精确度有直接影响。样本量越大，样本的功效越好，实验结果越可信，但同时耗费的资源也越多，如果样本量太小，实验功效不足，结果不可信，那么如何计算最小样本量，可以参考下面公式：</p>
<p><img data-action="zoom" class="aligncenter" src="https://image.yunyingpai.com/wp/2022/01/X6oarzDeRSGySp0QSSwR.png" alt width="347" height="102" referrerpolicy="no-referrer"></p>
<p><img data-action="zoom" class="aligncenter" src="https://image.yunyingpai.com/wp/2022/01/j5AeKb0b5U4g5YMgKw6f.png" alt width="750" height="223" referrerpolicy="no-referrer"></p>
<h3>问题4：实验需要运行多久？</h3>
<p>对于线上实验，用户随之时间进入实验，时间越长，用户数越多，统计功效通常也会随之提高，考虑到用户会反复访问，用户随时间的累计可能是次线性的，即第1天来N人，第2天累计进入实验用户<2N，所以实验运行仅运行1天，则更侧重在高频活跃用户。</p>
<p>同样因周末与工作日用户群体不同，也会有周末效应，季节性也同理。</p>
<p>有些实验在初始阶段有较大或较小的新奇效应，也会影响数据指标，因此建议实验至少运行一周。</p>
<h2 id="toc-2">二、A/B实验放量节奏</h2>
<p>通过逐步放量的流程来控制新功能发布带来的未知风险是很普遍的，我们需要<b>衡量速度、质量和风险。</b></p>
<p><img data-action="zoom" class="aligncenter" src="https://image.yunyingpai.com/wp/2022/01/H281oGKAw7iuvT7dHheC.png" alt width="752" height="177" referrerpolicy="no-referrer"></p>
<p><b>第一阶段目标降低风险</b>：可以建立测试人群，测试实验运行风险，观察实时或近实时结果，尽早了解实验是否有风险，如遇问题可快速回滚。</p>
<p><b>第二阶段目标保证实验质量</b>，我们建议最后保持一周，如有初始或新奇效应，则需要更长时间，若仅运行一天的实验，其结果将倾向于重度用户，根据经验，如果没有发现初始或新奇效应，则一周之后每多运行一天带来的额外收益都会越来越小。</p>
<p><b>第三阶段目标通过实验进行决策</b>，通过分析实验核心指标，确定实验是全量或者放弃。</p>
<p>若实验期间提前达到统计显著，根据经验，是不建议提前全量，通常使用的统计学假设是在实验结束时进行统计测试，而提前提前结束实验违反了假设，会导致一些虚假的成功。</p>
<h2 id="toc-3">三、A/B实验结果分析</h2>
<h3>陷阱1：样本量不均衡</h3>
<p>实验分析第一步检验实验组与对照组样本是否均衡，实验组UV/对照组UV=1代表均衡，如果实验组和对照组样本量不均衡，那可能在实验阶段发生漏洞导致的，那么我们不应该相信任何其他指标。产生样本量不均衡有多种原因，主要是以下原因：</p>
<ul>
<li><b>浏览器跳转</b>，一种常见的ab实验机制是实验组跳转到另一个页面，这通常会导致样本比率不均衡，主要原因：a、性能差异：实验组用户需要接受额外的跳转，跳转过程性能可能快可能慢。b、跳转不对称：实验组跳转新页面后，可以进行收藏、转发、返回等各种动作，而对照组均没有；所以对照组和实验组都需要有跳转页面，让实验组和对照组有相同待遇。</li>
<li><b>残留或滞留效应，</b>新的实验通常会涉及新的代码，所以错误率会比较高，新实验会引发一些意想不到的问题导致实验中止并快速修复上线，重新随机化会打破用户的连贯性，会让用户从一个用户组转到另一个用户组，从而影响样本均衡。</li>
<li><b>用户随机分桶过程有漏洞</b>，有可能在放量过程中出现bug导致实验组和对照组样本不均衡</li>
<li><b>糟糕的触发条件</b>，触发条件应该包含任何可能被影响的用户，触发条件基于可能被实验影响的属性也会让实验样本不均衡</li>
</ul>
<p>那如何识别样本不均衡呢？</p>
<ul>
<li>验证分桶时机点或触发时机点的上游有没有差异；</li>
<li>验证实验样本的分桶设置是否正确；</li>
<li>顺着数据漏斗路径排查是否有任何环节导致样本不均衡；</li>
<li>查看用户细分群体样本比例</li>
<li>查看与其他实验的交集</li>
</ul>
<h3>陷阱2：分析单元不一样</h3>
<p>在分析页面跳转时，有个核心指标CTR，CTR有两种常见计算方法，二者的分析单元是不一样的。</p>
<p>第一种CTR1=总点击数/总曝光数。</p>
<p>第二种CTR2，先计算每个用户的CTR然后平均所有用户的CTR。</p>
<p>如果随机分桶单元是用户层面，那么第一种方法使用了一个与分桶单元不同的分析样本，违背独立性假设，并且让方差计算变得复杂。</p>
<p>例如下面例子，有1W用户，假设每1K人有相同曝光和点击， CTR1=7.4%,CTR2=30.4%,显然CTR1受到了离群点影响。</p>
<p><img data-action="zoom" class="aligncenter" src="https://image.yunyingpai.com/wp/2022/01/UQwCGe7t6FL1pr67LlgP.png" alt width="649" height="443" referrerpolicy="no-referrer"></p>
<p>这两种定义没有对错之分，都是CTR的有用定义。但使用不同的定义会得到不同的结果。一般两个指标都会做成看板。</p>
<h3>陷阱3：稀释效应陷阱</h3>
<p>计算对触发人群的实验效应时，需要将效应稀释到整个用户群，如果在10%的用户上增加3%的收入，那么整体收入是否将提升10%*3%=0.3%？一般并没有，总体效应可能是0–>3%之间任意值！</p>
<p>如果改动针对站用户总体10%的低花费人群（花费为普通用户的10%），且该改动将这部分用户的营收提高3%，那么对整体营收将提高=3%*10%*10%=0.03%。</p>
<p><img data-action="zoom" class="aligncenter" src="https://image.yunyingpai.com/wp/2022/01/VHSiFgsMOQajG0LSqA1o.png" alt width="751" height="369" referrerpolicy="no-referrer"></p>
<h3>陷阱4：样本间信息干扰</h3>
<p>我们假设实验中每一个实验个体是独立的，不会相互影响，但用户个体会因为社交网络，对同一内容的互动信息等导致相互影响。</p>
<p>例如对社交类app有个策略“你可能认识的人”这个功能，实验组更好的推荐策略，会促使用户发送更多的邀请。然而接收到这些邀请的用户可能在对照组，如果评估指标是总邀请量，那么实验组和对照组的邀请都会增加，因此测量出来的实验组和对照组的差异会偏小。同样一个人可能认识的人是有限的，因此新算法在一开始可能会表现更好，但由于供推荐的供应量限制，长期来看可能会达到较低的均衡。</p>
<p>那要如何应对上述问题呢，首先不是所有用户行为都会出现网络效应，我们可以界定特殊行为会造成影响，只有这些行为被影响时，我们观察特殊行为是否影响下游的指标，同时重点分析该行为带来的生态价值，根据行为对生态系统的价值和贡献来考量最终决策。</p>
<h3>陷阱5：混杂因素误导</h3>
<p>混杂因素是指与研究因素（暴露因素）和研究结果(结局因素）均有关、若在比较的人群组中分布不匀，可以歪曲（掩盖或夸大）暴露因素与结局因素的真正联系的因素。</p>
<p><img data-action="zoom" class="aligncenter" src="https://image.yunyingpai.com/wp/2022/01/3Ni6BY19ThfKi5fkXCUX.png" alt width="602" height="343" referrerpolicy="no-referrer"></p>
<p>例如：很多产品有一个现象：看到更多错误的用户通常更少流失！</p>
<p><img data-action="zoom" class="aligncenter" src="https://image.yunyingpai.com/wp/2022/01/lN6L49kF076jpGf692VI.png" alt width="751" height="228" referrerpolicy="no-referrer"></p>
<p>所以，可以尝试显示更多的错误以启迪可以减少用户流失吗？当然是不可以，这种相关性是由一个共同愿意造成的：使用度。重度用户会看到更多错误，同时流失率更低。</p>
<p>如果发现某个新功能可以减少用户流失，需要分析是新功能在起作用，还是因为高活跃用户流失率低，同时更可能使用更多功能？</p>
<p>这种实验就要拆分活跃度进行实验。AB实验是需要控制变量的，但控制的东西过多了，实验变得束手束脚，具体控制哪些变量是非常值得思考的，有时候最终控制你真正想要测量的东西，那样功亏一篑。</p>
<p>有些时候实验结果给不了清晰的答案，但仍然要做出决策。对于这种情况，我们需要明确需要考虑的因素，尤其是这些因素如何影响实验显著和统计显著的边界设定。这些考虑会为为了决策提供基础，而非局限于当前的单一决策。</p>
<p> </p>
<p>本文由@李誓杰 原创发布于人人都是产品经理，未经许可，禁止转载。</p>
<p>题图来自 Unsplash，基于CC0协议</p>
<div class="support-author"><div class="support-title">给作者打赏，鼓励TA抓紧创作！</div><button class="button--pay" data-post-id="5289930" data-author="746495" data-avatar="https://static.woshipm.com/woshipm_def_head.jpg"><svg width="13" height="16" class="svgIcon--use" viewBox="0 0 13 16"><path d="M9.113,4.571 C9.951,3.771 10.895,2.742 10.685,2.057 C10.475,1.485 10.056,0.799 9.427,0.571 C8.903,0.342 8.379,0.456 7.750,0.799 C7.540,0.342 7.016,0.114 6.596,-0.001 C5.863,-0.001 5.234,0.228 4.814,0.914 C4.080,0.571 3.451,0.685 2.927,1.028 C2.613,1.256 2.298,1.713 2.298,2.628 C2.298,3.542 3.137,4.228 3.766,4.685 C2.508,5.599 -0.218,7.885 -0.008,12.228 C-0.218,15.656 2.613,15.999 2.613,15.999 L10.371,15.999 C11.314,15.885 12.991,14.971 12.991,12.571 L12.991,12.228 C13.201,7.771 10.371,5.371 9.113,4.571 L9.113,4.571 ZM8.932,11.835 L6.940,11.835 L6.940,13.207 C6.940,13.435 6.731,13.549 6.521,13.549 C6.311,13.549 6.102,13.435 6.102,13.207 L6.102,11.835 L4.110,11.835 C3.900,11.835 3.795,11.606 3.795,11.378 C3.795,11.149 3.900,10.921 4.110,10.921 L6.102,10.921 L6.102,10.121 L4.949,10.121 C4.739,10.121 4.634,9.892 4.634,9.664 C4.634,9.435 4.739,9.206 4.949,9.206 L5.892,9.206 L4.739,7.950 C4.634,7.835 4.739,7.606 4.949,7.492 C5.158,7.378 5.368,7.264 5.473,7.378 L6.521,8.635 L7.674,7.264 C7.779,7.149 7.989,7.264 8.198,7.378 C8.408,7.492 8.408,7.721 8.408,7.835 L7.150,9.321 L8.094,9.321 C8.303,9.321 8.408,9.549 8.408,9.778 C8.408,10.007 8.303,10.235 8.094,10.235 L6.940,10.235 L6.940,11.035 L8.932,11.035 C9.142,11.035 9.247,11.264 9.247,11.493 C9.247,11.606 9.037,11.835 8.932,11.835 L8.932,11.835 Z"/></svg>
赞赏</button></div>                      
</div>
            