
---
title: 'OMS订单拆单的流程中，要做哪些工作？'
categories: 
 - 新媒体
 - 人人都是产品经理
 - 最新文章
headimg: 'https://image.yunyingpai.com/wp/2021/12/fJ4N0S6grLkCeQVFZn7t.png'
author: 人人都是产品经理
comments: false
date: Tue, 25 Jan 2022 00:00:00 GMT
thumbnail: 'https://image.yunyingpai.com/wp/2021/12/fJ4N0S6grLkCeQVFZn7t.png'
---

<div>   
<blockquote><p>编辑导读：订单拆单的场景并不少见，可这其中的原由与底层逻辑你弄明白了吗？看似微小的系统拆单，实际与用户体验直接关联。本文作者结合行业内的观察，总结出了关于订单管理中的拆单整体逻辑，从订单拆单的基础概念出发，联系实际场景列举了相关可能性及结果。推荐相关领域的从业者阅读学习～</p></blockquote>
<p><img data-action="zoom" class="size-full wp-image-732316 aligncenter" src="https://image.yunyingpai.com/wp/2021/12/fJ4N0S6grLkCeQVFZn7t.png" alt referrerpolicy="no-referrer"></p>
<h2 id="toc-1">一、什么是拆单</h2>
<p>在网上购买商品下单成功后，过一段时间再次浏览时，有时会发现你的订单会变成两个或多个，这就是系统做了拆单而导致的。</p>
<p><strong>拆单，就是将一个大的订单依据某些规则的集合，将其分解成两个或多个子订单的过程，原来的订单称之为父订单。</strong></p>
<h2 id="toc-2">二、拆单的重要性</h2>
<p>通常我们所说的拆单一般情况下是指用户的销售订单，但在实际业务中，拆单情况随处可见，如采购订单的拆分、调拨单的拆分等等。本篇后续都是以销售订单的拆单讲述的，请知悉！</p>
<p>在互联网电商系统中销售订单是与C端用户关联最紧密的，单据量是最大的，是影响用户体验的，且拆单的规则相对来说是比较复杂的。</p>
<p>折单要求数据<strong>准确、及时</strong>，因为拆单后的子订单是需要流入到仓储进行生产作业的，它会进行<strong>拣货、出库、配送</strong>等一系统的流程，<strong>它也是后续财务系统对账或结算、数据分析的重要数据来源</strong>。</p>
<h2 id="toc-3">三、拆单的场景</h2>
<p>用户在APP，电商等平台下单后，由于商品的库存数量不满足，可能在前端进行拆单，即用户自己选择是否需要拆单，可以按<strong>最快送达</strong>或<strong>最小拆单</strong>的规则进行。</p>
<p>现在很少有会出现库存不足的情况，就是拆单系统的功劳了，很多商家为了提升客户体验，对于商品可以多仓发货时。因为单仓缺货而需要拆单时，由用户来选择决定是否购买或者是由系统判定可以拆单的情况下而进行的自动拆单，这应该也是为了<strong>提高转化率</strong>的一种方式。</p>
<p>还有一种场景，订单涉及多商家，需要单独付款的情况下，前端会直接进行拆单，但现在基本上都是合单支付了，因为这种拆单会使用户体验降低。</p>
<p>此外，有的商家既卖国内商品，也卖海淘商品，如果都混在一块，那么在支付前是需要进行拆单的，因为海淘商品要求用户的身份认证等信息的检验。</p>
<p>在多数情况下，都是用户下单完成后，由系统进行在后台进行拆单，拆单是要结合公司业务场景去考虑的。</p>
<h2 id="toc-4">四、用户购买涉及几种拆单</h2>
<p><strong>拆单除了以上几种场景，对于用户下单时系统上还会有什么操作吗？</strong></p>
<p>有一种情况即用户下单时系统要根据用户选择的收货地址、商品等信息，判断是否有库存，订单应该归属哪个仓库，是否可以购买等，这个服务严格来讲应该归属于商品库存服务，但是也可以将其称为<strong>预拆单</strong>。</p>
<p>预拆单一般是调用一定范围内的仓储服务进行库存的判断，同时还要根据促销活动进行一些优惠计算，所有的这些都需要前端系统在处理时对订单商品进行一些标识，以便当用户支付成功后，订单流转到OMS系统进行物理拆单。</p>
<p>前端用户下单成功后，订单经过OMS的拉单服务快速流转到订单中心，便开始订单的再生成过程，订单拆分后的子订单可能会展示给用户，也可能不展示给客户，在退货时由客户统一退到一个仓库方便客户进行退货，子订单会展示到客户原始订单上进行展示，便于用户跟踪和查看。</p>
<p>所以在从用户角度来看，一种是可以直接看到结果的拆单和一种无感知的预拆单过程。</p>
<h2 id="toc-5">五、拆单的时点与地点</h2>
<p>预拆单是伴随着购物流程进行的，这里不多讨论，因为这个究竟是否属于拆单也是要看我们如何定义。正常情况下用户选购商品完成后，系统不会拆单，因为用户有可能取消订单或未支付成功。</p>
<p>拆单的时点是要在 <strong>“订单支付成功”</strong> 后进行，且需要前端订单已经流转到后端生产库，在订单中心进行处理。</p>
<p>在前面有一种场景，如果购物中心不能合并支付时，在购物车中便拆分为几个订单，这时的拆单可以定义为<strong>一次拆单</strong>，也可以归属于购物流程，因为用户不提交就不会生成订单号，不会保存各个订单的数据。</p>
<p>在用户支付成功后，各个订单同样是要向后台流转，经过拆单服务的处理才可以继续进行下面的生产。</p>
<p>在前面讨论拆单场景时提到一种<strong>缺货拆单</strong>，这种场景的拆单是在用户下单支付成功后，订单有可能已经拆分为不同的子订单，但因某种原因仓库无货而导致的拆单。</p>
<p>这时拆单的时点是灵活的，一般是在客服系统中，根据用户的反馈确定是否拆单的。</p>
<p>缺货是影响用户体验的，但是缺货是始终客观存在的。</p>
<h2 id="toc-6">六、拆单分几级</h2>
<p>从上图看，拆单应该为<strong>三级</strong>，即用户创建的订单为父订单，然后经过拆单服务正常的分为多个子订单为第二级，后续因为缺货等原因子订单再次拆分为子（孙）订单。</p>
<p>在数据设计上，一般情况子订单与父订单的关联都通过ParentID来进行关联，但三级以上时，涉及原始订单的查询较麻烦。</p>
<p>具体看数据结构如何设计了，可以再增加一个原始订单号来记录最初的订单号，方便统计查询等，负责拆单服务的同学可以详细讨论下。</p>
<p>为了避免订单的复杂度及系统的查询、统计、分析等数据处理的难度，<strong>订单最好最多到三级，不宜过多</strong>。</p>
<h2 id="toc-7">七、拆单状态</h2>
<p>以前专门梳理过订单状态的文章，详见《订单信息与状态流转看这个应该足够了!》,在拆单过程中也涉及订单状态的变换。</p>
<p><img data-action="zoom" class="aligncenter" src="https://image.yunyingpai.com/wp/2022/01/6o3a3CzH6Dcnta3a2Crc.png" alt width="466" height="154" referrerpolicy="no-referrer"></p>
<ol>
<li>当父订单拆分为子订单后，子订单生效，父订单应该置为无效。</li>
<li>子订单或父订单经过缺货拆单后，原订单状态是无效还是其它？</li>
<li>订单拆单后状态应该置为“待下发”即需要通过下发服务，将订单推送给仓库发货。</li>
<li>如果订单已经下发到仓库后需要缺货拆单，单据状态应保留原状态。</li>
</ol>
<p>这些都属于细节，但不得不考虑，因为订单的状态涉及到其他业务系统的计算和统计。</p>
<p>如：财务系统在应付报表时是根据支付订单进行统计和对账的，如果订单状态是无效的，那么系统如何获取此部分数据。</p>
<p>BI有些统计分析是按状态和订单数量等进行统计的，如客单价、有效订单数等等。</p>
<p>所以针对拆单而导致的订单状态是否应该区分原有的订单状态分别标识，是需要综合考虑的。</p>
<h2 id="toc-8">八、拆单原则</h2>
<p>拆单的原因我们已经清楚，拆单的目的是为了保证履单，拆单的原则是什么？</p>
<ol>
<li><strong>首先是最小拆单原则，</strong>即能拆两单，不能拆成三单，因为多拆一单不仅是单据数量的增加，它会增加系统的复杂度，降低用户体验，加大仓库作业量，增加运费费用等。</li>
<li><strong>最快送达原则，</strong>拆出的子订单要快速生产，快速送达，这个是增加用户体验的最好办法。但是快速送达，依赖于仓储物流的布局，这个在多仓可以发送到一个城市时尤为重要。</li>
</ol>
<p><img data-action="zoom" class="aligncenter" src="https://image.yunyingpai.com/wp/2022/01/K2Ed1ZBt4BIsLz3Ircju.png" alt width="349" height="144" referrerpolicy="no-referrer"></p>
<p>一般情况下，拆单要遵循这两条原则，同时我们也看到拆单服务，是依赖于基础信息配置的，电商系统最复杂的是很多地方都有关联。不过现在也有很多根据最低价格原则，或者是最小拆分原则等，这个需要根据实际业务对应不同的实际场景。</p>
<h2 id="toc-9">九、拆单规则</h2>
<p>拆单的规则因每个公司的业务不同而不同，这里罗列一些常见的规则供参考。</p>
<h3>1. 不同商家的订单需要进行拆分</h3>
<p>这个主要应用于平台型的电商，一般情况用户购买商品都进入不同的店铺，创建的订单也是归属这个商家的。但有的平台采用合单支付，即用户选购不同商家的商品，但支付是一次的。</p>
<p>这个和淘宝有些不同，淘宝上每个商家的收款账号是不同的，所以不能一次支付，但平台商家是平台代收款的，所以可以一次支付后再拆单分摊金额。</p>
<h3>2. 不同仓或不同供应商的商品需要进行拆单</h3>
<p>仓库不同订单需要分开，对于不同的供应商订单主要是指由供应商直接发货的订单即商品不存储在仓库，由供应商直送到用户，这个和平台商家类似。但是区别是签署的合同不同，一个是购销合同，一个是佣金扣点合同，细节不展开了，有兴趣可以留言交流。</p>
<h3>3. 商品类型不同需要拆单</h3>
<p>一般区分奢侈品或有特殊要求的商品，这个需要业务根据商品要求进行设置。因为商品要求不同，后续在物流环节采用的物流产品类型也不同，物流费用也不同。这部分也可以根据商品信息，在仓储进行处理，但最后在上位能够提前区分。</p>
<h3>4. 商品温控属性不同要进行拆单</h3>
<p>此部分一般是指生鲜电商而言，同一个仓库有常温仓、冷藏仓、冷冻仓，存储着不同的商品，商品的拣货、包装等都有不同的要求，所以需要进行拆单。</p>
<h3>5. 大件商品拆单</h3>
<p>大件商品与普通商品不同，它在仓库的存储位置、拣货方式、包装、运输都有所区别，所以大件商品需要每一件都拆单，大件商品一般遵循最快送达，不需要最少拆单原因的限制。</p>
<h3>6. 根据库存拆单</h3>
<p>这个是针对缺货商品进行的拆单，即有库存的一单，无库存的一单，如果是二级订单，则父订单相同，子订单衍生出子订单，子订单1的过程。</p>
<h3>7. 线下门店商品不拆单</h3>
<p>如果是线下门店购买商品，则不需要拆单。</p>
<h3>8. 组合商品不能拆单</h3>
<p>在促销活动中，有时会有一些大礼包等商品的组合销售，即A,B,C等商品经过仓库的组合包装后出库，所以针对此类商品不能拆单。</p>
<p>在拆单服务中需要调用物料单信息，进行判断，具体的要看系统如何设计了。</p>
<p><strong>拆单的规则很多，在系统处理时，要依赖于规则设置的优先级来进行。</strong></p>
<h2 id="toc-10">十、拆单算法</h2>
<h3>1. 稀缺商品算法</h3>
<p>找所有商品在所有库房最稀缺的商品，获取该商品的阶数。</p>
<h3>2. 降阶</h3>
<p>找稀缺商品的都需要仓库组合，这些仓库是必须发货的，把这些仓库计入发货列表，这样就降阶了，剩余仓库再计算组合，减少运算数量。</p>
<h3>3. 抽屉原理算法</h3>
<p>找第一阶的仓库列表（发货量最大的仓库），这个库房的库存是必须要发的，然后再找次发货量最大的仓库，以此类推，用于后面的组合计算。</p>
<h3>4. 找组合</h3>
<p>按照仓库顺序逐渐增加仓库个数找组合。</p>
<p>算法也只是拆单过程中的一个路径参考，且算法依赖于拆单的规则而制定，无论如何要保证拆单的结果准确，拆单的速度要快。</p>
<h2 id="toc-11">十一、拆单服务两步重要工作</h2>
<p>以上一直在讨论拆单是由<strong>1变2</strong>，由<strong>2变4</strong>的一些内容，在具体的拆单服务系统中要考虑哪些内容，<strong>又有哪些工作？</strong></p>
<ol>
<li>前面所说的都应该在设计时考虑，而且最重要的是要依赖规则进行设计，数据的流转，时序等等。</li>
<li>金额分摊是拆单中最重要的一部分工作，也是最复杂的。</li>
</ol>
<p>父订单的拆分，商品的重新组合，生成新的订单是第一步，第二步就是要将父订单的金额合理的，正确的分摊到各个子订单上。</p>
<p>订单一般分为订单主表和订单商品表、订单支付明细表和订单活动表。</p>
<p><strong>订单金额有几个主要的部分</strong>：订单商品金额、折扣金额、礼品卡支付金额、积分支付金额、优惠券支付金额、订单支付金额等几个部分。</p>
<p><strong>运费</strong>是订单表中一个特殊字段，运费如何分摊是要特殊考虑的，一般情况是按金额占比进行。所以生成的子订单中各部分金额，也要保证与父订单金额一致。</p>
<p>订单商品表、支付明细表、活动表属于明细信息，要根据原始订单明细表的数据和标识进行计算分摊。</p>
<p>子订单的金额要保证<strong>横向、纵向</strong>都正确才行，<strong>横向</strong>是指子单的合与父单金额一致，<strong>纵向</strong>是指子单订单主表与明细表金额一致。</p>
<p>此外，在金额分摊计算过程有一项重要规则不可避免，即开票金额的考虑。</p>
<p>这部分金额的分摊与公司缴税息息相关，单据与发票要一致，要考虑商品信息、活动规则等等，非常复杂。</p>
<p><strong>有的拆单服务将金额分摊独立出来，以降低对拆单的影响，提高订单流转速度。</strong></p>
<h2 id="toc-12">十二、拆单的速度要求</h2>
<p>由于拆单后订单才会下发到仓储或商家进行生产，所以对于速度要求就是<strong>快</strong>。</p>
<p>在系统设计时可以依据规则等综合考虑，多线程是最常用的方法，但多线程需要考虑资源竞争和安全性。一般情况，如果下单后已经确定了仓库，那么可以按仓库启动多个服务，这样可以避免程序的难度。</p>
<p>对于拆单和下发在系统上也要有数据监控，不能出现积压的情况。如果拆单有异常时，在定时任务中，很多情况都是依赖一个信息字段的状态来进行循环处理，在服务中要有<strong>容错处理</strong>，不能一直停滞不前。</p>
<h2 id="toc-13">十三、拆单的影响</h2>
<p>什么是拆单？为什么拆单？如何拆单？前面说了很多，<strong>但对于拆单有什么影响呢？</strong></p>
<p>先说一个场景，公司搞促销活动，买A赠B，但A与B商品的温控属性不同，所以用户下单后一定会拆单。</p>
<p>拆单后仓储拣货、发货是根据子订单进行的，很有可能赠品B先发货了，A后发货。用户先收到B签收了，然后A进行拒收或取消。此时，如果在拒收或取消A时不判断关联子订单，那么公司就会损失B。</p>
<p>如果判断关联子订单的状态，那么系统的复杂度将会非常之大，因为实际场景中一个父单拆为多单时是很常见的。</p>
<p>拆单后，子订单数量增加，对于客单价、统计分析等报表需要考虑其影响，维度和统计口径不同，数据结果必然不同，从而会影响到经营分析及决策。</p>
<p>影响，对于不同的业务有不同的理解，作为产品研发应该在拆单设计时还是需要要将利害与业务说清楚，尤其是运营人员(活动方面重点考虑），虽然这属于一个后台服务。</p>
<h2 id="toc-14">十四、总结</h2>
<p>拆单是复杂的，合理的拆单会加快订单的流转，友好的用户体验，过度拆单则会产生冗余的数据，增加订单的复杂关系，统计、计算、售后等各个环节。</p>
<p> </p>
<p>本文由 @梁凤财 原创发布于人人都是产品经理，未经许可，禁止转载</p>
<p>题图来自 Unsplash，基于 CC0 协议</p>
<div class="support-author"><div class="support-title">给作者打赏，鼓励TA抓紧创作！</div><button class="button--pay" data-post-id="5299167" data-author="1151018" data-avatar="https://static.qidianla.com/woshipm_def_head_2.jpg"><svg width="13" height="16" class="svgIcon--use" viewBox="0 0 13 16"><path d="M9.113,4.571 C9.951,3.771 10.895,2.742 10.685,2.057 C10.475,1.485 10.056,0.799 9.427,0.571 C8.903,0.342 8.379,0.456 7.750,0.799 C7.540,0.342 7.016,0.114 6.596,-0.001 C5.863,-0.001 5.234,0.228 4.814,0.914 C4.080,0.571 3.451,0.685 2.927,1.028 C2.613,1.256 2.298,1.713 2.298,2.628 C2.298,3.542 3.137,4.228 3.766,4.685 C2.508,5.599 -0.218,7.885 -0.008,12.228 C-0.218,15.656 2.613,15.999 2.613,15.999 L10.371,15.999 C11.314,15.885 12.991,14.971 12.991,12.571 L12.991,12.228 C13.201,7.771 10.371,5.371 9.113,4.571 L9.113,4.571 ZM8.932,11.835 L6.940,11.835 L6.940,13.207 C6.940,13.435 6.731,13.549 6.521,13.549 C6.311,13.549 6.102,13.435 6.102,13.207 L6.102,11.835 L4.110,11.835 C3.900,11.835 3.795,11.606 3.795,11.378 C3.795,11.149 3.900,10.921 4.110,10.921 L6.102,10.921 L6.102,10.121 L4.949,10.121 C4.739,10.121 4.634,9.892 4.634,9.664 C4.634,9.435 4.739,9.206 4.949,9.206 L5.892,9.206 L4.739,7.950 C4.634,7.835 4.739,7.606 4.949,7.492 C5.158,7.378 5.368,7.264 5.473,7.378 L6.521,8.635 L7.674,7.264 C7.779,7.149 7.989,7.264 8.198,7.378 C8.408,7.492 8.408,7.721 8.408,7.835 L7.150,9.321 L8.094,9.321 C8.303,9.321 8.408,9.549 8.408,9.778 C8.408,10.007 8.303,10.235 8.094,10.235 L6.940,10.235 L6.940,11.035 L8.932,11.035 C9.142,11.035 9.247,11.264 9.247,11.493 C9.247,11.606 9.037,11.835 8.932,11.835 L8.932,11.835 Z"/></svg>
赞赏</button></div>                      
</div>
            