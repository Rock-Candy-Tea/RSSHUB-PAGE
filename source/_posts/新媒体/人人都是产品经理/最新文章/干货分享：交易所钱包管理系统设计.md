
---
title: '干货分享：交易所钱包管理系统设计'
categories: 
 - 新媒体
 - 人人都是产品经理
 - 最新文章
headimg: 'https://image.woshipm.com/wp-files/2022/09/mJYyjco5fTxBA6v2DuSH.jpg'
author: 人人都是产品经理
comments: false
date: Mon, 12 Sep 2022 00:00:00 GMT
thumbnail: 'https://image.woshipm.com/wp-files/2022/09/mJYyjco5fTxBA6v2DuSH.jpg'
---

<div>   
<blockquote><p>作为web3世界的核心枢纽，交易所托管着大量加密资产，它的钱包管理也关系到大量用户的资产安全。本文作者从产品设计的视角，分享了交易所钱包管理系统的组成、业务流程，一起来看一下吧。</p>
</blockquote><p><img data-action="zoom" class="aligncenter size-full wp-image-5599154" src="https://image.woshipm.com/wp-files/2022/09/mJYyjco5fTxBA6v2DuSH.jpg" alt width="900" height="420" referrerpolicy="no-referrer"></p>
<p>交易所作为web3世界的核心枢纽，托管着大量加密资产，其钱包管理关系到大量用户的资产安全，因此很有必要对其钱包管理系统研究学习一番。这里我整理了一篇个人从产品设计者视角的学习笔记，希望能够帮助到大家学习。</p>
<h2 id="toc-1">01 交易所钱包系统组成</h2>
<p>交易所钱包系统设计主要需要考虑到安全性和便捷性。为了兼顾两者，交易所大部分资产用冷钱包管理，以保证资产安全；而少部分资产使用热钱包管理，以方便用户提现资产。</p>
<p>不多说，先放图：</p>
<p><img data-action="zoom" class="aligncenter" src="https://image.woshipm.com/wp-files/2022/09/9AbFMfyRdWOtq8LyXJyH.png" alt width="840" height="806" referrerpolicy="no-referrer"></p>
<h3>1. 热钱包系统</h3>
<p>热钱包系统由用户充值钱包、归集钱包、提现钱包、手续费钱包等组成。</p>
<p><strong>1）用户充值钱包</strong></p>
<p>用户需要向交易所进行代币充值，需要为每一名用户分配一个地址，用于充值代币，其私钥保存在服务端以供后续资金归集时签名。</p>
<p><strong>2）归集钱包</strong></p>
<p>资产分散在各用户充值钱包中不方便管理，因此当充值钱包达到一定规模时需要进行资金归集，将资金统一归集至归集钱包。</p>
<p>大量资金统一管理在一个钱包中是存在比较大的安全风险，所以需要对归集钱包中的资产进行分配并转移。</p>
<p><strong>3）提现钱包</strong></p>
<p>为了方便用户提现和资金安全，一般会将20%资金转移到一个提现钱包（也可能是几个钱包），这个钱包专门用于客户提币使用。</p>
<p>手续费钱包：归集资金、转移资金、用户提现这几个操作均需要交易费，当其他钱包ETH不足抵扣交易费时，由该钱包转入一定的ETH作为交易费。</p>
<h3>2. 冷钱包系统</h3>
<p>冷钱包系统一般包含系统冷钱包和BOSS钱包组成。</p>
<ul>
<li>系统冷钱包：一般会将20%～30%的资金会转移至系统冷钱包，当提现钱包资金不够时才会在系统冷钱包进行划转。</li>
<li>BOSS钱包：一般50%以上资金会转移至boss钱包，由公司一个或多个老板控制。</li>
</ul>
<h2 id="toc-2">02 钱包系统业务流程</h2>
<p>交易所钱包系统和主要涉及业务流程：</p>
<ul>
<li>注册—：生成充值地址</li>
<li>用户充值处理</li>
<li>资金归集</li>
<li>资金分配转移</li>
<li>提现转账</li>
</ul>
<p>不多说，先放图：</p>
<p><img data-action="zoom" class="aligncenter" src="https://image.woshipm.com/wp-files/2022/09/Z54wkVs1HUxLH2CSONoR.jpeg" alt width="6550" height="4506" referrerpolicy="no-referrer"></p>
<h3>1. 注册—：生产充值地址</h3>
<p>当用户注册账户，需要对应创建一个钱包，为用户分配一个单独的充值地址，私钥由保存在服务端以用于资金归集。</p>
<p><img data-action="zoom" class="aligncenter" src="https://image.woshipm.com/wp-files/2022/09/QaH7qr6lhuUu62wtoGcE.png" alt width="678" height="369" referrerpolicy="no-referrer"></p>
<h3>2. 用户充值处理</h3>
<p>我们需要持续监听充值钱包代币入账及区块确认数，一般12个区块确认后才认定为入账成功。入账成功后，需要判断平台是否支持该代币，若支持则增加账户对应代币的余额，至此完成用户充值处理。</p>
<p><img data-action="zoom" class="aligncenter" src="https://image.woshipm.com/wp-files/2022/09/wnmutxORNCREQDjsZ6V7.png" alt width="709" height="448" referrerpolicy="no-referrer"></p>
<h3>3. 资金归集</h3>
<p>用户充值完成后，我们需要判断用户充值钱包该代币资产价值，一般当其价值达到1000U，我们需要将钱包中资金归集到归集钱包。</p>
<p>归集前需要判断预估gas是否过高（超过100 gas），若过高则等待降下来，再进行归集。</p>
<p>另外，需要判断钱包是否有足够ETH以抵扣交易费，若不足则需从手续费钱包转入0.01ETH再进行归集。</p>
<p><img data-action="zoom" class="aligncenter" src="https://image.woshipm.com/wp-files/2022/09/m0kdacZ0z731JgO0JeTY.png" alt width="1006" height="613" referrerpolicy="no-referrer"></p>
<h3>4. 资金分配转移</h3>
<p>归集钱包为热钱包，当大量资产都在一个热钱包是存在极大风险的，因此我们将资产转移。</p>
<p><img data-action="zoom" class="aligncenter" src="https://image.woshipm.com/wp-files/2022/09/NsyNCUZHL2qp6vajU5Dg.png" alt width="591" height="779" referrerpolicy="no-referrer"></p>
<p><strong>1）筛选统计</strong></p>
<p>在进行划转和分配之前，我们需要对归集钱包中资产进行筛选统计，筛选出平台支持且有余额的代币，然后统计筛出代币的余额。</p>
<p><strong>2）资金分配</strong></p>
<p>我们将80%的资产转移至冷钱包地址，20%继续转移至提现热钱包中。这样设计兼顾安全性和便捷性，冷钱包控制相对来说保证了安全性；而大部分玩家都是把大部分资金存放在交易所中，热钱包20%流动资金是足够支撑用户的提币需求，因此也一定保证了便捷性。</p>
<p><strong>3）资金划转</strong></p>
<p>我们一般为固定周期进行分配转移，一般设计为一周划转一次，具体周期和时间可以根据业务和公司情况而定。我们根据代币类型采用不同划转方式，ETH直接根据分配资金转账，ERC-20代币使用合约批量打包转账（节省交易费）。</p>
<h3>5. 提现转账</h3>
<p>用户发起提现后，由于Nonce机制存在，并不直接将交易发送至网络，而使用本地队列排队，接收到上一条成功确认记录后，再获取最新Nonce，进行下一条转账发送。</p>
<p>发送前，判断余额是否充足，若不足则需申请从系统钱包手动转入足够的代币后再进行转账。</p>
<p><img data-action="zoom" class="aligncenter" src="https://image.woshipm.com/wp-files/2022/09/0cbvVQWjZjJkZd7uWDFa.png" alt width="731" height="369" referrerpolicy="no-referrer"></p>
<h2 id="toc-3">03 私钥管理方案</h2>
<h3>1. 多签</h3>
<p>提示：以太坊本身不支持多签，需要使用智能合约实现，合约本身又存在安全风险，因此交易所的以太坊私钥一般采用该方案保存。</p>
<p>普通用户可以将私钥/助记词保存在软件、纸上或者通过大脑记忆保存。但对于拥有巨额资产的交易所而言，普通用户的私钥管理方式根本无法适用，否则将存在单点保存的风险。</p>
<p>为了避免一个私钥的丢失导致地址的资金丢失，达到风险分散的目的，一般会采用多重签名技术。所谓多重签名技术，就是把一个钱包地址的控制权交给多个密钥，这些密钥保存在不同的地点，并分别生成签名。举个简单的例子：</p>
<p>2-3多重签名，表示3个人拥有签名权，而两个人签名就可以支配这个账户里的资金；</p>
<p>1-2多重签名，表示2个人可以签名，两个人拥有私钥，谁都可以来支配这笔资金。</p>
<p>在热钱包方面，一般采用2-3多重签名，需要三个私钥持有人中的两个分别进行授权，才能完成签名。<br>
在冷钱包方面，一般采用的是2-2多重签名，即每个私钥的使用需要两个人双重授权才能进行提币，以保证冷钱包安全。</p>
<h3>2. 备份</h3>
<p>在采用多重签名的同时，为了进一步降低私钥丢失或损坏的风险，还对私钥进行了备份处理：</p>
<p>对于热钱包，备份私钥存储办公室附近的银行保险柜。</p>
<p>对于冷钱包，一般备份两份，一份存在办公室附近的银行保险柜，一份存在异地某一家银行的保险柜；同时，异地银行保险柜必须由两个不同的人掌握，掌握银行保险柜的两个人不得乘坐同一辆交通工具。</p>
<p><strong>参考：</strong></p>
<p>https://cointelegraphcn.com/news/how-do-exchanges-manage-digital-wallets</p>
<p>https://www.jianshu.com/p/3a238354678e</p>
<p>https://www.jianshu.com/p/3a238354678e</p>
<div class="article--copyright"><p>本文由 @nobodyjack 原创发布于人人都是产品经理，未经许可，禁止转载</p>
<p>题图来自Unsplash，基于CC0协议</p>
<p>该文观点仅代表作者本人，人人都是产品经理平台仅提供信息存储空间服务。</p>
</div><div class="support-author"><div class="support-title">给作者打赏，鼓励TA抓紧创作！</div><button class="button--pay" data-post-id="5598976" data-author="1460729" data-avatar="https://static.woshipm.com/APP_U_202209_20220913101626_6866.jpeg"><svg width="13" height="16" class="svgIcon--use" viewBox="0 0 13 16"><path d="M9.113,4.571 C9.951,3.771 10.895,2.742 10.685,2.057 C10.475,1.485 10.056,0.799 9.427,0.571 C8.903,0.342 8.379,0.456 7.750,0.799 C7.540,0.342 7.016,0.114 6.596,-0.001 C5.863,-0.001 5.234,0.228 4.814,0.914 C4.080,0.571 3.451,0.685 2.927,1.028 C2.613,1.256 2.298,1.713 2.298,2.628 C2.298,3.542 3.137,4.228 3.766,4.685 C2.508,5.599 -0.218,7.885 -0.008,12.228 C-0.218,15.656 2.613,15.999 2.613,15.999 L10.371,15.999 C11.314,15.885 12.991,14.971 12.991,12.571 L12.991,12.228 C13.201,7.771 10.371,5.371 9.113,4.571 L9.113,4.571 ZM8.932,11.835 L6.940,11.835 L6.940,13.207 C6.940,13.435 6.731,13.549 6.521,13.549 C6.311,13.549 6.102,13.435 6.102,13.207 L6.102,11.835 L4.110,11.835 C3.900,11.835 3.795,11.606 3.795,11.378 C3.795,11.149 3.900,10.921 4.110,10.921 L6.102,10.921 L6.102,10.121 L4.949,10.121 C4.739,10.121 4.634,9.892 4.634,9.664 C4.634,9.435 4.739,9.206 4.949,9.206 L5.892,9.206 L4.739,7.950 C4.634,7.835 4.739,7.606 4.949,7.492 C5.158,7.378 5.368,7.264 5.473,7.378 L6.521,8.635 L7.674,7.264 C7.779,7.149 7.989,7.264 8.198,7.378 C8.408,7.492 8.408,7.721 8.408,7.835 L7.150,9.321 L8.094,9.321 C8.303,9.321 8.408,9.549 8.408,9.778 C8.408,10.007 8.303,10.235 8.094,10.235 L6.940,10.235 L6.940,11.035 L8.932,11.035 C9.142,11.035 9.247,11.264 9.247,11.493 C9.247,11.606 9.037,11.835 8.932,11.835 L8.932,11.835 Z"/></svg>
赞赏</button></div>                      
</div>
            