
---
title: '详解 _ 关于交易的核心设计指南'
categories: 
 - 新媒体
 - 人人都是产品经理
 - 最新文章
headimg: 'https://cors.zfour.workers.dev/?http://image.woshipm.com/wp-files/2021/04/6U2SO4DtsvZfPU8gyF4j.jpg'
author: 人人都是产品经理
comments: false
date: Sat, 03 Apr 2021 00:00:00 GMT
thumbnail: 'https://cors.zfour.workers.dev/?http://image.woshipm.com/wp-files/2021/04/6U2SO4DtsvZfPU8gyF4j.jpg'
---

<div>   
<blockquote><p>编辑导语：在日常生活中很多时候都会遇到交易的时候，比如日常的买单付款等等都是一种交易方式，交易的步骤比较简单，但每一步都非常的严密谨慎；本文作者分享了关于交易的核心设计指南，我们一起来了解一下。</p></blockquote>
<p><img data-action="zoom" class="aligncenter size-full wp-image-4438263" src="https://cors.zfour.workers.dev/?http://image.woshipm.com/wp-files/2021/04/6U2SO4DtsvZfPU8gyF4j.jpg" alt width="900" height="420" referrerpolicy="no-referrer"></p>
<p>交易？······清晰记得那年冬天，一屋子人吵到不可开交，购物车让订单算应该付多少钱，订单让购物车自己算；我斜眼一看，交易系统同学藏在角落瑟瑟发抖，似乎在祈祷“这不关我的事！！！”</p>
<p>是啊，什么是交易呢？整个体系都可以称为交易，那什么又是交易系统呢？交易核心呢？似乎我也迷茫了，为了要写，那么暂且这么定义吧——“那个夹在订单系统，支付系统和账务系统之间的那个少年，他帮助订单记录了账单，对各支付方式进行支付的加工和请求以及处理，并且将支付系统返回的收银台返给用户端，以及将支付结果告知各方，最后再告诉账务系统要记账了…..。”</p>
<p>我想说“少年您辛苦了”，您还是那个青涩的少年，从来不曾改变！</p>
<p>先看个案例：</p>
<p>陈老师在外卖平台买了一个鸡腿100块，微信支付了60元，用了一张20的代金券，又使用了10元的积分，参与了分享立减10元的活动的权益。</p>
<p><img data-action="zoom" class="rich_pages aligncenter" title="详解|交易核心设计指南" src="https://cors.zfour.workers.dev/?http://image.woshipm.com/wp-files/2021/04/7oA9Bg8CTNJyBuSYIHek.png" alt="详解|交易核心设计指南" referrerpolicy="no-referrer"></p>
<p>陈老师啃了一口发现是个鸭腿，以实物不符为由将骨头退还给商家，申请退货，商家同意退货，但是要罚40元精神损失费，所以只退了20到微信，代金券，积分，立减活动因为不退，所以陈老师最后只收到20元退款。</p>
<p><img data-action="zoom" class="rich_pages aligncenter" title="详解|交易核心设计指南" src="https://cors.zfour.workers.dev/?http://image.woshipm.com/wp-files/2021/04/CrqKRjLgikW6xquZfezb.png" alt="详解|交易核心设计指南" referrerpolicy="no-referrer"></p>
<h2 id="toc-1">01 什么是交易</h2>
<p>就像电影台词里经常说的“今晚码头交易”；我要跟你做一个交易；交易被终止了。</p>
<p>貌似交易不容易被定义，但也可以定义，以下来自百度词条：</p>
<blockquote><p>交易（Transactions）是指双方以货币为媒介的价值的交换。</p></blockquote>
<p>看起来交易是这件事情本身，但是我们今天讲的交易可能是交易这件事情中的一个环节，交易处理。</p>
<h2 id="toc-2">02 什么是交易系统</h2>
<p>交易系统就是在支付体系当中，对交易进行记录和处理的应用系统，而交易我们在开头已经将范围界定在了对各支付方式进行加工处理的范畴了；所以交易的实体是账单和支付流水，核心服务是对各支付方式的请求处理以及支付流水的记录，并推动交易完成的核心模块。</p>
<p><img data-action="zoom" class="rich_pages aligncenter" title="详解|交易核心设计指南" src="https://cors.zfour.workers.dev/?http://image.woshipm.com/wp-files/2021/04/nvwrWpEHgyZ1g1pDR3ml.png" alt="详解|交易核心设计指南" referrerpolicy="no-referrer"></p>
<h2 id="toc-3">03 什么是交易核心</h2>
<p>交易核心我们暂且定义为交易服务的“核心处理引擎”，就是交易核心的部分，对各支付方式的支付加工以及请求，驱动各环节促使交易的完成；以及逆向交易的完成。</p>
<h2 id="toc-4">04 交易在支付体系的位置和作用</h2>
<p>交易处在支付体系的核心位置，就像支付的中央枢纽一样，推动着整个支付流程的进程；一方面接受订单的账单创建请求，另一方对各类支付方式进行加工处理，并完成账务记账推动。</p>
<p><img data-action="zoom" class="rich_pages aligncenter" title="详解|交易核心设计指南" src="https://cors.zfour.workers.dev/?http://image.woshipm.com/wp-files/2021/04/Cv4HFv9sfT8PuXZpkD9G.png" alt="详解|交易核心设计指南" referrerpolicy="no-referrer"></p>
<h2 id="toc-5">05 交易核心的业务实体结构</h2>
<p>一个订单可以创建多条账单，比如一个订单分2次支付则创建2个账单；一个账单又可以进行组合支付，比如三方支付+卡券+活动优惠；分别针对不同支付方式请求各系统完成支付处理；最后基于各渠道的支付结果推动清结算完成费用计算清分以及账务记录。</p>
<p><img data-action="zoom" class="rich_pages aligncenter" title="详解|交易核心设计指南" src="https://cors.zfour.workers.dev/?http://image.woshipm.com/wp-files/2021/04/QdcSPe7gnKlYtt0XHnZK.png" alt="详解|交易核心设计指南" referrerpolicy="no-referrer"></p>
<h2 id="toc-6">06 正向交易流程</h2>
<p><img data-action="zoom" class="rich_pages aligncenter" title="详解|交易核心设计指南" src="https://cors.zfour.workers.dev/?http://image.woshipm.com/wp-files/2021/04/OxqGPltFvj95S4UBPeUw.png" alt="详解|交易核心设计指南" referrerpolicy="no-referrer"></p>
<ul>
<li>用户购物车选好商品后去结算进行订单的填写；</li>
<li>提交订单后完成订单的生成；</li>
<li>用户去支付订单完成账单的创建和支付请求的封装；</li>
<li>交易核心请求支付核心获得收银台链接返回给用户端；</li>
<li>用户完成支付；</li>
<li>交易核心完成各类支付方式的支付结果处理并通知订单支付成功；</li>
<li>交易核心基于支付结果通知清结算进行相关计费和记账；</li>
</ul>
<h2 id="toc-7">07 交易账单的创建</h2>
<p>订单通知交易核心进行账单的创建，我们以一对一为例，以开头的例子为交易场景。</p>
<p>订单信息如下：</p>
<p><img data-action="zoom" class="rich_pages aligncenter" title="详解|交易核心设计指南" src="https://cors.zfour.workers.dev/?http://image.woshipm.com/wp-files/2021/04/9ECYs01tNWByEE3oDdJO.png" alt="详解|交易核心设计指南" referrerpolicy="no-referrer"></p>
<p>生成如下账单记录：</p>
<p><img data-action="zoom" class="rich_pages aligncenter" title="详解|交易核心设计指南" src="https://cors.zfour.workers.dev/?http://image.woshipm.com/wp-files/2021/04/Tknc2bucWIZUSoz5412V.png" alt="详解|交易核心设计指南" referrerpolicy="no-referrer"></p>
<h2 id="toc-8">08 账单支付记录</h2>
<p>账单基于支付方式创建支付请求：</p>
<p><img data-action="zoom" class="rich_pages aligncenter" title="详解|交易核心设计指南" src="https://cors.zfour.workers.dev/?http://image.woshipm.com/wp-files/2021/04/saa2BYlshAXp10M6L0nx.png" alt="详解|交易核心设计指南" referrerpolicy="no-referrer"></p>
<h2 id="toc-9">09 支付请求的处理</h2>
<p>交易核心依托于支付记录向各个系统发起支付请求：</p>
<ul>
<li>微信支付：封装支付参数请求支付系统进行付款，成功后通知交易核心。</li>
<li>代金券：封装券核销参数请求券系统锁定优惠券，待微信支付成功后核销优惠券。</li>
<li>积分和立减通优惠券。</li>
</ul>
<p>交易发生逆向时要控制好处理的顺序，比如部分退款，先退谁；先退微信还是先退券，这只是个策略问题。</p>
<h2 id="toc-10">10 支付流水的生成</h2>
<p>基于各系统返回的支付请求结果，更新支付流水状态；并更新账单为已支付；通知订单用户已完成付款，订单进入待发货或者待服务流程。</p>
<p><img data-action="zoom" class="rich_pages aligncenter" title="详解|交易核心设计指南" src="https://cors.zfour.workers.dev/?http://image.woshipm.com/wp-files/2021/04/gkQzoCe7Tj1YwBGXdFEt.png" alt="详解|交易核心设计指南" referrerpolicy="no-referrer"></p>
<h2 id="toc-11">11 交易信息的封装</h2>
<p>将交易信息封装成整体以后展示给各方使用。</p>
<h2 id="toc-12">12 交易驱动账务</h2>
<p>交易系统基于支付结果通知账务系统进行记账：</p>
<p><img data-action="zoom" class="rich_pages aligncenter" title="详解|交易核心设计指南" src="https://cors.zfour.workers.dev/?http://image.woshipm.com/wp-files/2021/04/150CvUwRgnyQgWoqBYXP.png" alt="详解|交易核心设计指南" referrerpolicy="no-referrer"></p>
<p>后面讲清结算的时候我们再接着细讲账务部分。</p>
<h2 id="toc-13">13 交易后台</h2>
<p>交易后要主要展示这几部分信息，每部分就不细讲了</p>
<ul>
<li>订单信息</li>
<li>账单信息</li>
<li>支付流水信息</li>
<li>记账信息</li>
</ul>
<p>感觉交易系统很薄，又感觉交易系统很厚；其实交易系统如果从后台能看到的部分看是很薄的，比不上其他系统那么多页面，那么多操作。</p>
<p>但是从交易系统的处理服务上去看，是非常复杂的，很多看不到的处理引擎，也印证了那句话“低调的背后永远是实力”。</p>
<p>希望各位读者朋友可以基于这个架子，去深究交易系统更多不为人知的一面！</p>
<p> </p>
<p>作者：陈晓光，一个会弹吉他会算命的产品经理老司机，微信公众号：陈晓光</p>
<p>本文由 @陈天宇宙 原创发布于人人都是产品经理。未经许可，禁止转载</p>
<p>题图来自Unsplash，基于CC0协议</p>
<div class="support-author"><div class="support-title">给作者打赏，鼓励TA抓紧创作！</div><button class="button--pay" data-post-id="4438208" data-author="94217" data-avatar="http://image.woshipm.com/wp-files/2021/02/a84xkWDMu44P1PnVp06z.jpeg"><svg width="13" height="16" class="svgIcon--use" viewBox="0 0 13 16"><path d="M9.113,4.571 C9.951,3.771 10.895,2.742 10.685,2.057 C10.475,1.485 10.056,0.799 9.427,0.571 C8.903,0.342 8.379,0.456 7.750,0.799 C7.540,0.342 7.016,0.114 6.596,-0.001 C5.863,-0.001 5.234,0.228 4.814,0.914 C4.080,0.571 3.451,0.685 2.927,1.028 C2.613,1.256 2.298,1.713 2.298,2.628 C2.298,3.542 3.137,4.228 3.766,4.685 C2.508,5.599 -0.218,7.885 -0.008,12.228 C-0.218,15.656 2.613,15.999 2.613,15.999 L10.371,15.999 C11.314,15.885 12.991,14.971 12.991,12.571 L12.991,12.228 C13.201,7.771 10.371,5.371 9.113,4.571 L9.113,4.571 ZM8.932,11.835 L6.940,11.835 L6.940,13.207 C6.940,13.435 6.731,13.549 6.521,13.549 C6.311,13.549 6.102,13.435 6.102,13.207 L6.102,11.835 L4.110,11.835 C3.900,11.835 3.795,11.606 3.795,11.378 C3.795,11.149 3.900,10.921 4.110,10.921 L6.102,10.921 L6.102,10.121 L4.949,10.121 C4.739,10.121 4.634,9.892 4.634,9.664 C4.634,9.435 4.739,9.206 4.949,9.206 L5.892,9.206 L4.739,7.950 C4.634,7.835 4.739,7.606 4.949,7.492 C5.158,7.378 5.368,7.264 5.473,7.378 L6.521,8.635 L7.674,7.264 C7.779,7.149 7.989,7.264 8.198,7.378 C8.408,7.492 8.408,7.721 8.408,7.835 L7.150,9.321 L8.094,9.321 C8.303,9.321 8.408,9.549 8.408,9.778 C8.408,10.007 8.303,10.235 8.094,10.235 L6.940,10.235 L6.940,11.035 L8.932,11.035 C9.142,11.035 9.247,11.264 9.247,11.493 C9.247,11.606 9.037,11.835 8.932,11.835 L8.932,11.835 Z"/></svg>
赞赏</button></div>                      
</div>
            