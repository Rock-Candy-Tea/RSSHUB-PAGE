
---
title: '加权平均成本计算中，_双O_问题的解决方案'
categories: 
 - 新媒体
 - 人人都是产品经理
 - 最新文章
headimg: 'https://cors.zfour.workers.dev/?http://image.woshipm.com/wp-files/2022/03/zzinQ2UCcflfpPOs24MB.jpg'
author: 人人都是产品经理
comments: false
date: Fri, 25 Mar 2022 00:00:00 GMT
thumbnail: 'https://cors.zfour.workers.dev/?http://image.woshipm.com/wp-files/2022/03/zzinQ2UCcflfpPOs24MB.jpg'
---

<div>   
<blockquote><p>编辑导语：加权平均是一种常见的动态成本算法，在它的算法框架下，当库存=0时，可能会造成“双O”问题，这种情况下要怎么办呢？本文作者就这个问题进行分析，提出了解决办法，一起来看一下吧。</p></blockquote>
<p><img data-action="zoom" class="aligncenter size-full wp-image-5368367" src="https://cors.zfour.workers.dev/?http://image.woshipm.com/wp-files/2022/03/zzinQ2UCcflfpPOs24MB.jpg" alt width="900" height="420" referrerpolicy="no-referrer"></p>
<p>加权平均或移动加权平均，是一种常见的动态成本算法。用每次采购入库成本和在库成本加权平均，更新为新成本。加权平均成本计算公式：</p>
<p style="text-align: center;"><strong>（入库产品的成本+在库产品的成本）/（入库产品数量+在库产品数量）</strong></p>
<p>在此算法框架下，有一些特例。比如：当库存=0时，产品成本价是否也应该=0 ？</p>
<h3>情况1</h3>
<p>如果产品成本价=0，出现了无采购价格的入库时（比如退货入库），会造成入库成本计算=0的问题。</p>
<p>不管是基于算法还是基于常识，我们都很容易发现这个结论并不妥当。但是加权平均和先进先出不同，并不依赖完整的历史出入库流水去获取退货产品的成本价。</p>
<p>所以在这种情况下（库存=0，产品单价不能等于0，而是应该保持加权计算为0之前的非零数值），这样即可合理解决非采购入库的入库成本计算问题。</p>
<h3>情况2</h3>
<p>按照1的推理分析，库存=0时，成本价不应等于0。这时出现另一个特例，采购入库供应商赠送的产品（采购单价=0），这时成本应该等于多少？这种情况就是“双O”问题——加权平均产品，在库存为0时，入库0成本的产品。</p>
<p>注意，这种情况下没有完美解。两种算法：</p>
<ol>
<li>产品成本加权平均计算=0，本次入库产生的加权平均成本正确。但如果这时出现退货入库（无成本价来源的入库），则会造成退货入库产品成本也=0（错误）。</li>
<li>产品成本保持最后的非0值，和本次入库的加权平均计算冲突（错误）。</li>
</ol>
<p>能不能找出一个彻底的方法解决呢？当然可以，只要在加权平均算法基础上增加对历史出入库流水的数据调用，永远避免出现无成本来源的入库，即可解决这个问题。但是这样一来，加权平均算法的逻辑便捷就会消失。</p>
<p>根据各种情况出现的概率，把错误出现概率最低的情况排除掉，然后选定方案。</p>
<p>虽然不完美，但是经过这种分析和比较，咱们距离完美又接近了一步。</p>
<p>一如微积分中引入的极限概念（如果我们想把全体实数视为一条连续的线，这些数字都必须是实数。尽管它们可能只是现实的近似值，但却行之有效），引入一个假定条件，明确问题的边界，把出错概率降至最低，也是业务逻辑中常用的分析方法。</p>
<p>最后的结论，加权平均计算为0的情况，分析：<strong>在库成本=0（库存=0）且入库成本=0（采购单价/成本=0），双0逻辑。</strong></p>
<p>处理方法，目前分为两类：</p>
<ol>
<li>采购入库、直接入库时，直接更新产品表成本字段=0</li>
<li>其他类型：装配入库、sku转化入库、订单退货入库等，不更新产品表成本字段（保持原值）</li>
</ol>
<p> </p>
<p>本文由 @糨酱紫 原创发布于人人都是产品经理。未经许可，禁止转载</p>
<p>题图来自Unsplash，基于CC0协议</p>
<div class="support-author"><div class="support-title">给作者打赏，鼓励TA抓紧创作！</div><button class="button--pay" data-post-id="5366728" data-author="781671" data-avatar="http://image.woshipm.com/wp-files/2022/03/f3DVkiSnMAnthWiKRDWe.png"><svg width="13" height="16" class="svgIcon--use" viewBox="0 0 13 16"><path d="M9.113,4.571 C9.951,3.771 10.895,2.742 10.685,2.057 C10.475,1.485 10.056,0.799 9.427,0.571 C8.903,0.342 8.379,0.456 7.750,0.799 C7.540,0.342 7.016,0.114 6.596,-0.001 C5.863,-0.001 5.234,0.228 4.814,0.914 C4.080,0.571 3.451,0.685 2.927,1.028 C2.613,1.256 2.298,1.713 2.298,2.628 C2.298,3.542 3.137,4.228 3.766,4.685 C2.508,5.599 -0.218,7.885 -0.008,12.228 C-0.218,15.656 2.613,15.999 2.613,15.999 L10.371,15.999 C11.314,15.885 12.991,14.971 12.991,12.571 L12.991,12.228 C13.201,7.771 10.371,5.371 9.113,4.571 L9.113,4.571 ZM8.932,11.835 L6.940,11.835 L6.940,13.207 C6.940,13.435 6.731,13.549 6.521,13.549 C6.311,13.549 6.102,13.435 6.102,13.207 L6.102,11.835 L4.110,11.835 C3.900,11.835 3.795,11.606 3.795,11.378 C3.795,11.149 3.900,10.921 4.110,10.921 L6.102,10.921 L6.102,10.121 L4.949,10.121 C4.739,10.121 4.634,9.892 4.634,9.664 C4.634,9.435 4.739,9.206 4.949,9.206 L5.892,9.206 L4.739,7.950 C4.634,7.835 4.739,7.606 4.949,7.492 C5.158,7.378 5.368,7.264 5.473,7.378 L6.521,8.635 L7.674,7.264 C7.779,7.149 7.989,7.264 8.198,7.378 C8.408,7.492 8.408,7.721 8.408,7.835 L7.150,9.321 L8.094,9.321 C8.303,9.321 8.408,9.549 8.408,9.778 C8.408,10.007 8.303,10.235 8.094,10.235 L6.940,10.235 L6.940,11.035 L8.932,11.035 C9.142,11.035 9.247,11.264 9.247,11.493 C9.247,11.606 9.037,11.835 8.932,11.835 L8.932,11.835 Z"/></svg>
赞赏</button></div>                      
</div>
            