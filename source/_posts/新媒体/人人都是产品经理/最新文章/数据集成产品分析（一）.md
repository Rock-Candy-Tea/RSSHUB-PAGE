
---
title: '数据集成产品分析（一）'
categories: 
 - 新媒体
 - 人人都是产品经理
 - 最新文章
headimg: 'https://cors.zfour.workers.dev/?http://image.woshipm.com/wp-files/2022/05/GbUd3pyLY4baKksNEXDB.jpg'
author: 人人都是产品经理
comments: false
date: Mon, 09 May 2022 00:00:00 GMT
thumbnail: 'https://cors.zfour.workers.dev/?http://image.woshipm.com/wp-files/2022/05/GbUd3pyLY4baKksNEXDB.jpg'
---

<div>   
<blockquote><p>编辑导语：数据集成产品是数据中台建设的第一环节，在构建数据中台或大数据系统时，首先要将企业内部各个业务系统的数据实现互联互通，从物理上打破数据孤岛。本文作者对数据集成产品进行了分析，一起来看一下吧。</p></blockquote>
<p><img data-action="zoom" class="aligncenter size-full wp-image-5430360" src="https://cors.zfour.workers.dev/?http://image.woshipm.com/wp-files/2022/05/GbUd3pyLY4baKksNEXDB.jpg" alt width="900" height="420" referrerpolicy="no-referrer"></p>
<p>数据集成产品致力于异构数据源之间的数据交换与汇聚，该类产品是数据中台建设的第一环节，笔者将通过两篇文章对数据集成产品进行分析。</p>
<p>数据同步，又称为数据集成、数据迁移，主要用于实现不同系统间的数据流转。</p>
<p>为什么会有数据同步这类产品？</p>
<p>在企业中，业务的快速发展产生了大量数据，也催生出多种应用系统，各系统承载不同类型的数据，对应着不同的数据存储方式。</p>
<p>而对于构建数据中台或大数据系统，首先需要将企业内部各个业务系统的数据实现<strong>互联互通</strong>，<strong>从物理上打破数据孤岛</strong>，而这主要通过数据汇聚和同步的能力来实现。</p>
<p>数据同步方式有多种：API接口同步、数据文件同步和数据库日志解析同步，适用于不同的业务场景。</p>
<p>本次分享的数据同步是基于<strong>数据库日志解析</strong>的方式实现，其主要应用场景是：数据从业务系统同步到数仓，和数据从数仓同步到数据应用两个方面。</p>
<h2 id="toc-1">一、数据集成产品简介</h2>
<h3>1. 产品介绍</h3>
<p>数据同步致力于保证数据在<strong>不同数据源之间被高效准确地迁移</strong>。根据数据时效性要求和应用场景，数据同步可分为离线同步和实时同步：</p>
<p><strong>1）离线同步</strong></p>
<p>主要用于<strong>大批量数据的周期性迁移</strong>，对时效性要求不高，一般采用分布式批量数据同步方式，通过连接读取数据，读取数据过程中可以有全量、增量方式，经过统一处理后写入目标存储。</p>
<p>成熟的产品有：Sqoop、DataX、kettle等。</p>
<p><strong>2）实时同步</strong></p>
<p>针对数据时效性要求高的场景，其将源端数据的变化实时同步到目标端数据源中，保证源端数据与目标端数据实时保持一致，就可满足业务实时查询分析使用数据或实时计算等需求。</p>
<p>成熟的产品有：Canal、otter等。</p>
<p>在实际业务场景中，离线同步和实时同步搭配使用，为保证已有的数据表在目标端数据源中可用，会使用离线同步将该表的历史数据全量迁移到目标端数据源中，对于增量数据则通过实时集成来增量迁移。</p>
<h3>2. 核心流程</h3>
<p>数据集成的实现有三个关键步骤：数据读取、数据转换（映射）、数据写入，核心流程如下图所示：</p>
<p><img data-action="zoom" class="rich_pages wxw-img js_insertlocalimg aligncenter" title="数据集成产品分析（一）" src="https://cors.zfour.workers.dev/?http://image.woshipm.com/wp-files/2022/05/Gp9ockrdqoebLbG8FUda.png" alt="数据集成产品分析（一）" referrerpolicy="no-referrer"></p>
<p>具体流程为：数据集成从源端数据源中读取数据，按照建好的映射关系及转换规则，将数据写入到目标数据源中。其中：</p>
<ul>
<li>配置源端数据源和目标端数据源，用于连接数据源，获取数据源的读、写权限等</li>
<li>建立映射关系：源端数据源中数据表及字段对应到目标端数据源中的哪张表和字段。建立映射关系后，数据集成根据映射关系，将源端数据写入到对应的目标端数据</li>
<li>数据转换规则：数据写入时，可能有不同数据格式转换，敏感数据脱敏展示、无用字段过滤、null值处理等需求，可以制定相应的数据转换规则来实现</li>
<li>数据传输通道：可配置任务并发数、数据连接数等任务参数，达到数据集成的任务被高效稳定执行等目的</li>
</ul>
<p>基于上述流程，数据集成产品的核心功能一般会包含以下4个：</p>
<ol>
<li>数据源配置</li>
<li>同步任务配置</li>
<li>任务调度</li>
<li>监控告警</li>
</ol>
<p>数据集成平台在进行异构数据源之间的数据迁移时，需要保证迁移任务被高效完成，被迁入目标端数据源的数据是准确可靠的、实时的，数据传输过程是安全的等，这是用户核心关注点，也是期望平台达到的目标。</p>
<p><img data-action="zoom" class="aligncenter" src="https://cors.zfour.workers.dev/?http://image.woshipm.com/wp-files/2022/05/XgBAArol46vMXVUEQDBc.png" alt width="803" height="819" referrerpolicy="no-referrer"></p>
<h3><strong>3. 其他大数据产品的联系和区别</strong></h3>
<p>在构建数据仓库的场景中，数据加载到数仓后，随后进行数据加工和数据应用，其中涉及的3类大数据产品如下：</p>
<p><strong>1）数据集成：面向数据汇聚与交换</strong></p>
<p>产品流程：配置数据源—创建同步任务—配置调度任务。</p>
<p>核心任务：ETL、校验、补数、合并。</p>
<p><strong>2）数据加工：面向数据分析</strong></p>
<p>产品流程：创建表—编写加工逻辑（insert）—配置调度任务。</p>
<p>数据加工方式：离线计算、实时计算、机器学习等。</p>
<p><strong>3）任务调度：工作流编排</strong></p>
<p>产品流程：创建任务节点—配置节点依赖关系—提交并执行。</p>
<p>任务调度：任务执行、任务调度与运维。</p>
<p><strong>联系：</strong></p>
<ul>
<li>数据集成和数据加工都是数据生命周期中的一环</li>
<li>数据集成任务和数据加工任务其实就是任务调度中的任务节点job，任务调度保证数据被顺序采集和加工出来</li>
</ul>
<p>以用户画像分析为例，oss_数据同步和rds_数据同步两个节点是数据集成任务节点，ods_log_info_d、dws_user_info_all_d、rpy_user_info_d三个节点是数据加工任务节点，绘制各节点间的连线即工作流编排。</p>
<p>提交并执行画布中的流程节点，数据就会按照箭头方向执行各节点，产出最终结果。</p>
<p><img data-action="zoom" class="rich_pages wxw-img aligncenter" title="数据集成产品分析（一）" src="https://cors.zfour.workers.dev/?http://image.woshipm.com/wp-files/2022/05/HqIqKsGMB4S0L0zMhrEU.png" alt="数据集成产品分析（一）" width="390" height="477" referrerpolicy="no-referrer"></p>
<p><strong>区别：</strong>数据集成和数据加工都基于任务执行和调度实现，两者虽然都是ETL，但是各自关注的重点并不相同。</p>
<p>①核心动作</p>
<p>数据集成核心动作是<strong>抽数</strong>（读、写、转换），也就是<strong>数据交换</strong>，转换动作也只是简单的数据清洗。</p>
<p>数据加工的核心动作是<strong>计算逻辑/清洗等加工规则的编写</strong>，加工规则复杂。</p>
<p>②核心目标</p>
<p>数据集成的核心目标，是保证数据被高效准确地迁移到目标端数据源。</p>
<p>数据加工的核心目标，是加工规则编写准确“翻译”业务需求。</p>
<h2 id="toc-2">二、数据集成产品流程</h2>
<p>离线集成与实时集成在实际运行中，关注的侧重点是不同的，对于离线集成，面对的是批数据，更多考虑大规模数据量的迁移效率问题；对于实时集成，面对的是流数据，更多考虑数据准确性问题。</p>
<p>数据同步中一般采用先全量在增量的方式来进行数据的迁移，即先将历史数据全量迁移到目标数据源，完成初始化动作，在进行增量数据的实时同步，这样保证目标端数据的可用性。当然也有不care历史数据的场景，此时就无需进行全量迁移的动作。</p>
<h3><strong>1. 实时集成</strong></h3>
<p>我们主要采用基于日志的CDC方式来实现增量数据的实时同步，CDC即change data capture，捕获数据的变化。</p>
<p>实时集成通过读取源端数据库日志bin_log来捕获数据的变化情况（insert、update、delete），将其传输到kafka topic中，然后通过spark streaming对数据进行转换/清洗，写入到stg增量表中，最后将增量数据与全量数据合并到数仓ods表中。</p>
<p>由于数据库日志抽取一般是获取所有的数据记录的变更（增、删、改），落到目标表时，需要根据主键去重，并按照日志时间倒序排列获取最后状态的变化情况。</p>
<p>具体的实时集成任务执行逻辑及流程如下所示：</p>
<p><img data-action="zoom" class="aligncenter" src="https://cors.zfour.workers.dev/?http://image.woshipm.com/wp-files/2022/05/pwpmPfyiTJHRePDFpiWN.png" alt width="1330" height="194" referrerpolicy="no-referrer"></p>
<p>实时集成有以下特点：</p>
<ul>
<li>源端数据库产生一条记录，数据集成实时同步一条记录</li>
<li>流数据在数据传输过程中可能会被丢失或延迟</li>
</ul>
<p>故相较于离线集成，在数据同步链路上，实时集成会增加<strong>数据校验和数据合并</strong>两个动作。</p>
<ul>
<li>数据校验主要校验源端和目标端的数据量，保证数据没有被丢失</li>
<li>数据合并则是由ods库base表和cdc目标库increment表组成，具体逻辑为：将stg数据按主键去重，取最新一条，根据主键与ods数据表中的T+1数据合并</li>
</ul>
<h3><strong>2. 离线集成</strong></h3>
<p>离线集成分为全量和增量两种方式对大规模数据进行批量迁移。</p>
<ul>
<li>全量迁移是将某些表的全部历史数据同步到目标数据源中</li>
<li>增量迁移，通常需要使用where子句（RDB）或者query子句（MongoDB）等增量配置参数，同时在结合调度参数（定时任务的重复周期：分钟、小时、天、周、月等）可实现增量迁移任意指定日期内的数据。</li>
</ul>
<p>比如，想要实现<strong>每日数据的增量同步</strong>，各参数可配置为：</p>
<ul>
<li>Where子句：配置为<strong>DS=’$&#123;dateformat(yyyy-MM-dd,-1,DAY)&#125;’</strong>，</li>
<li>配置定时任务：重复周期为1天，每天的凌晨0点自动执行作业</li>
</ul>
<p>增量迁移的数据可以对目标端数据源表中数据进行追加、覆盖和更新操作。</p>
<p> </p>
<p>作者：细嗅蔷薇，微信公众号：零号产品er</p>
<p>本文由 @细嗅蔷薇 原创发布于人人都是产品经理，未经许可，禁止转载</p>
<p>题图来自 Unsplash，基于 CC0 协议</p>
<div class="support-author"><div class="support-title">给作者打赏，鼓励TA抓紧创作！</div><button class="button--pay" data-post-id="5429388" data-author="850630" data-avatar="http://image.woshipm.com/wp-files/2021/02/Vlmvco0Qg7yf2b6WVu3X.jpg"><svg width="13" height="16" class="svgIcon--use" viewBox="0 0 13 16"><path d="M9.113,4.571 C9.951,3.771 10.895,2.742 10.685,2.057 C10.475,1.485 10.056,0.799 9.427,0.571 C8.903,0.342 8.379,0.456 7.750,0.799 C7.540,0.342 7.016,0.114 6.596,-0.001 C5.863,-0.001 5.234,0.228 4.814,0.914 C4.080,0.571 3.451,0.685 2.927,1.028 C2.613,1.256 2.298,1.713 2.298,2.628 C2.298,3.542 3.137,4.228 3.766,4.685 C2.508,5.599 -0.218,7.885 -0.008,12.228 C-0.218,15.656 2.613,15.999 2.613,15.999 L10.371,15.999 C11.314,15.885 12.991,14.971 12.991,12.571 L12.991,12.228 C13.201,7.771 10.371,5.371 9.113,4.571 L9.113,4.571 ZM8.932,11.835 L6.940,11.835 L6.940,13.207 C6.940,13.435 6.731,13.549 6.521,13.549 C6.311,13.549 6.102,13.435 6.102,13.207 L6.102,11.835 L4.110,11.835 C3.900,11.835 3.795,11.606 3.795,11.378 C3.795,11.149 3.900,10.921 4.110,10.921 L6.102,10.921 L6.102,10.121 L4.949,10.121 C4.739,10.121 4.634,9.892 4.634,9.664 C4.634,9.435 4.739,9.206 4.949,9.206 L5.892,9.206 L4.739,7.950 C4.634,7.835 4.739,7.606 4.949,7.492 C5.158,7.378 5.368,7.264 5.473,7.378 L6.521,8.635 L7.674,7.264 C7.779,7.149 7.989,7.264 8.198,7.378 C8.408,7.492 8.408,7.721 8.408,7.835 L7.150,9.321 L8.094,9.321 C8.303,9.321 8.408,9.549 8.408,9.778 C8.408,10.007 8.303,10.235 8.094,10.235 L6.940,10.235 L6.940,11.035 L8.932,11.035 C9.142,11.035 9.247,11.264 9.247,11.493 C9.247,11.606 9.037,11.835 8.932,11.835 L8.932,11.835 Z"/></svg>
赞赏</button></div>                      
</div>
            