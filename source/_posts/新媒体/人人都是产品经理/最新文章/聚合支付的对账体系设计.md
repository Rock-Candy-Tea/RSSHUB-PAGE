
---
title: '聚合支付的对账体系设计'
categories: 
 - 新媒体
 - 人人都是产品经理
 - 最新文章
headimg: 'https://image.yunyingpai.com/wp/2022/02/S2psYehouTmFFfNZIg6I.png'
author: 人人都是产品经理
comments: false
date: Thu, 31 Mar 2022 00:00:00 GMT
thumbnail: 'https://image.yunyingpai.com/wp/2022/02/S2psYehouTmFFfNZIg6I.png'
---

<div>   
<blockquote><p>核对账目是商户保证账簿记录的真实性、正确性，对账簿和账户所记录的有关数据进行核对、检查的操作。本文以金融业务为总出发点，阐述不同场景交易情况下的多角度对账方式。结合实例与大家分享支付对账的逻辑、流程、账单和处理方法。推荐相关领域的朋友阅读学习。</p></blockquote>
<p><img data-action="zoom" class="size-full wp-image-749612 aligncenter" src="https://image.yunyingpai.com/wp/2022/02/S2psYehouTmFFfNZIg6I.png" alt referrerpolicy="no-referrer"></p>
<p>对账具有普遍性，已经被应用在金融支付、消费金融、小额贷款、电商零售、现金管理、油卡充值、批量缴税、POS刷卡、ATM业务、外卖平台、酒店预订等场景中。</p>
<p>在金融业务（聚合支付、银联交易、人行往来、大小额支付、转账支出）的交易中，金融企业与与银行对账，实质上就是账实核对、账证核对、账账核对，主要涉及C端用户、B端商户、金融平台、支付渠道之间在订单数据、账单数据、交易流水和资金流水的对账，主要体现在以下几个方面：</p>
<ol>
<li><strong>用户侧对账。</strong>C端用户在订单交易中，金融平台记录的订单数据与支付机构返回的支付流水进行核对，主要涉及用户订单数据的价格、交易时间、数量、交易金额、优惠金额、实付金额、交易状态等。</li>
<li><strong>商户侧对账。</strong>B端商户在订单结算中，金融平台记录的账单数据与支付渠道返回的账单流水进行核对，主要涉及商户的结算账户、订单号、费用类目、实付金额、结算金额、结算时间、提现状态、手续费、结算方式、结算周期等。</li>
<li><strong>平台侧对账。</strong>在充值、消费、提现、转账等业务场景中，金融平台产生的订单数据与支付渠道产生的交易数据进行核对，主要涉及平台备付金户、平台营销户的账户月、动账明细、日终账单等。</li>
<li><strong>渠道侧对账。</strong>通过支付渠道进行代收、代付的支付信息，与支付渠道提供的日终对账文件（信息流文件、资金流文件）进行核对，主要涉及特约商户的商户名称、交易日期、交易流水、借方发生额、贷方发生额、余额、交易凭证、费用科目等。</li>
</ol>
<h2 id="toc-1">一、支付对账逻辑</h2>
<p>对账就是在金融支付（充值、提现、转账、消费、退款）中进行信息流和资金流的核对，主要包括业务对账、交易对账、账单对账、资金对账。</p>
<p>即在金融支付的信息流上，进行业务数据、交易数据的对账；在金融支付的资金流上，进行账单流水、资金流水的对账。</p>
<p>针对不同对账场景、不同对账主体，重点是确保平台对账、商户对账、渠道对账的账务数据和资金流水正确。对账作为金融支付的最后环节，主要关注以下几个维度：</p>
<h3>维度1：对账文件</h3>
<p>大部分支付机构是次日2:00点左右会生产对账文件，且对账文件一般存放在对账系统内，可通过手动或者程序连接sftp获取，文件格式一般是xml、csv或txt。</p>
<h3>维度2：获取方式</h3>
<p>对账首先要确定获取对账文件的获取方式，可以通过商户平台下载，也可以通过渠道接口下载。两者最大的区别是平台下载涉及走申请流程，接口下载涉及做系统对接。</p>
<h3>维度3：会计科目</h3>
<p>会计科目是对账的基础，必须有会计科目才能完成对账。金融平台对账就是很多对应会计科目下的订单数量、交易金额、服务费用是否一致，还涉及支付机构的往来账目是否准确无误。</p>
<h3>维度4：对账维度</h3>
<p>系统解析对账文件后按对账维度逐笔核对交易订单。对账维度主要涉及二级商户入网费、充值金额、充值收单费、消费金额、通道服务费、平台抽佣、提现金额、提现手续费、退款金额、退款手续费等，每笔代收代付的金额或服务费必须与资金流水一致。</p>
<h3>维度5：任务调度</h3>
<p>任务调度就是定时任务基于设定的对账时间（一般为当日22:00~次日6:00之间），按对账批次（对账文件全量覆盖）自动执行对账任务。</p>
<h3>维度6：对账预警</h3>
<p>因金融平台和支付机构两边的业务数据、资金流水不一致导致的差错账、单边账、挂账等进行预警，以便实时修正并处理。</p>
<h2 id="toc-2">二、支付对账流程</h2>
<p>支付对账就是系统根据配置的对账规则发起对账任务，在获取支付机构的对账文件，进行自动解析入库，并与本地的账单数据进行核对，从而完成订单交易对账和资金流水对账。</p>
<p>在完成金融业务的聚合支付后，系统次日发起对账定时任务跑批，对账系统获取金融平台的对账单，并导入支付机构生成的对账文件，根据对账引擎去路由数据源，并试算交易订单和资金流水对比是否一致：若一致则对账成功，若不一致则对账失败，返回失败通知，并生产对账差异文件。</p>
<p>在支付机构完成差错处理和资金划拨后，生成新的对账文件，同步到金融平台的本地账户，并修改对账系统的交易流水，生成新的对账单，再次确认账单一致，就根据对账结果请求对账系统完成记账。</p>
<p><img data-action="zoom" class="rich_pages wxw-img aligncenter" title="聚合支付的对账体系设计" src="https://image.yunyingpai.com/wp/2022/03/edbHgqd86AbFlGoLbBR0.png" alt="聚合支付的对账体系设计" width="430" height="556" referrerpolicy="no-referrer"></p>
<h2 id="toc-3">三、支付对账账单</h2>
<p>根据对账规则将金融交易的业务订单与支付订单生成对账账单，通过匹配订单来核对账户余额和和交易记录。</p>
<p>每一笔余额收支明细都需要记录流水，并记账到商户的资金账户和结算账户，按总分类账簿对余额进行日终对账，主要包括以下几个维度：</p>
<h3>维度1：日终余额核对</h3>
<p>支付业务中的日终余额，是每天日终结账时根据前一天余额加上当日代收、代付科目发生额的累加之和。主要是确保借、贷方本期余额与所属明细分类账的借、贷方本期发生额之和相符。</p>
<p><img data-action="zoom" class="size-full wp-image-780485 aligncenter" src="https://image.yunyingpai.com/wp/2022/03/UvzSIKv0NX5qJQcsKRUy.png" alt referrerpolicy="no-referrer"></p>
<p>按照对账单生成凭证，即银行回单。我们可以凭借银行回单查询相关账户余额。若有交易账单明细核对不一致的情况，银行回单可以作为对账凭证。</p>
<p><img data-action="zoom" class="rich_pages wxw-img aligncenter" title="聚合支付的对账体系设计" src="https://image.yunyingpai.com/wp/2022/03/wadQFDs5xYVrj2YGDVzt.png" alt="聚合支付的对账体系设计" width="611" height="117" referrerpolicy="no-referrer"></p>
<h3>维度2：期末余额核对</h3>
<p>期末余额=期初余额+本期增加发生额-本期减少发生额。主要是确保平台账户的期末余额与支付机构的期末余额核对相符。</p>
<p><img data-action="zoom" class="size-full wp-image-780486 aligncenter" src="https://image.yunyingpai.com/wp/2022/03/IaDkftH4AFMJco0p7xHo.png" alt referrerpolicy="no-referrer"></p>
<h3>维度3：交易明细核对</h3>
<p>根据交易类型对费用科目的所属明细分类进行核对，关键是对交易日期、交易类型、交易流水、借贷关系、余额进行账账核对。主要是确保借、贷方账面余额与所属明细分类账的借、贷方余额之和相符。</p>
<p><img data-action="zoom" class="size-full wp-image-780487 aligncenter" src="https://image.yunyingpai.com/wp/2022/03/svvkvwTHs9FNNcHd1c41.png" alt referrerpolicy="no-referrer"></p>
<h2 id="toc-4">四、支付对账处理</h2>
<p>对账系统根据会计科目处理不同金融业务的业务核对、总分核对、资金核对，一般会从支付机构的对账文件中解析二级商户号、订单号、交易流水、交易类型、支付状态、应付金额、实付金额、借贷关系等关键字段，与内部系统记录的订单数据进行勾兑，根本目的是通过对账处理修正金融平台内部系统的数据不一致。</p>
<p>在金融平台的对账中，主要涉及收单对账、分账对账、结算对账、退款对账、商户对账、银行对账等。</p>
<p>对账处理的关键是确保账证相符、账账相符、账实相符，对账单进行处理主要包括以下几种方式：</p>
<h3>1. 无需处理的平衡账</h3>
<p>平衡账即完成聚合支付后，把各个分类账户的金额与其汇总账户的金额通过平衡试算公式调整为相等，或者说交易账单和对账文件满足平衡试算公式。平衡账一般不需要做处理，只需根据定时任务进行日结和试算平衡即可。</p>
<h3>2. 需要处理的差错账</h3>
<p>差错账即完成聚合支付后，在记账过程中，由于会计核算方面出现重记、漏记、数字颠倒、数字错位、数字记错、科目记错、借贷方向记反等错误，导致两边的账单不一致。差错账的处理方式一般是资金轧差、隔日冲正，通过补单机制更正对账系统中出现的差错，并对差异表中的记录进行勾兑。</p>
<h3>3. 需要处理的单边账</h3>
<p>单边账即完成聚合支付后，交易平台和用户只有一方账面发生相应变化。比如因支付网络超时导致发卡行已扣款但收单行未入账、或发卡行未扣款但收单行已入账等情况都可以称为单边账。单边账的处理方式一般是单边抹账，谁做了收单记账，谁负责原路退回。</p>
<p>在金融行业中，只要涉及三方支付，就会有对账需求。</p>
<p>对账一般是从业务场景出发，结合公司的实际对账需求，去设计一套独立的对账系统，以满足日常金融业务的对账需求，根本目的是实现账务对账的降本增效。</p>
<h3>#专栏作家#</h3>
<p>朱学敏，微信公众号：朱哥聊产品，人人都是产品经理专栏作家。畅销书《产品闭环：重新定义产品经理》作者，8年金融产品人，专注于金融行业（贷款、理财、支付），从0到1负责产品的全过程开发与设计。</p>
<p>本文原创发布于人人都是产品经理，未经作者许可，禁止转载。</p>
<p>题图来自Unsplash，基于CC0协议。</p>
<div class="support-author"><div class="support-title">给作者打赏，鼓励TA抓紧创作！</div><button class="button--pay" data-post-id="5376209" data-author="657972" data-avatar="https://static.woshipm.com/APP_U_202201_20220108000847_2522.jpeg"><svg width="13" height="16" class="svgIcon--use" viewBox="0 0 13 16"><path d="M9.113,4.571 C9.951,3.771 10.895,2.742 10.685,2.057 C10.475,1.485 10.056,0.799 9.427,0.571 C8.903,0.342 8.379,0.456 7.750,0.799 C7.540,0.342 7.016,0.114 6.596,-0.001 C5.863,-0.001 5.234,0.228 4.814,0.914 C4.080,0.571 3.451,0.685 2.927,1.028 C2.613,1.256 2.298,1.713 2.298,2.628 C2.298,3.542 3.137,4.228 3.766,4.685 C2.508,5.599 -0.218,7.885 -0.008,12.228 C-0.218,15.656 2.613,15.999 2.613,15.999 L10.371,15.999 C11.314,15.885 12.991,14.971 12.991,12.571 L12.991,12.228 C13.201,7.771 10.371,5.371 9.113,4.571 L9.113,4.571 ZM8.932,11.835 L6.940,11.835 L6.940,13.207 C6.940,13.435 6.731,13.549 6.521,13.549 C6.311,13.549 6.102,13.435 6.102,13.207 L6.102,11.835 L4.110,11.835 C3.900,11.835 3.795,11.606 3.795,11.378 C3.795,11.149 3.900,10.921 4.110,10.921 L6.102,10.921 L6.102,10.121 L4.949,10.121 C4.739,10.121 4.634,9.892 4.634,9.664 C4.634,9.435 4.739,9.206 4.949,9.206 L5.892,9.206 L4.739,7.950 C4.634,7.835 4.739,7.606 4.949,7.492 C5.158,7.378 5.368,7.264 5.473,7.378 L6.521,8.635 L7.674,7.264 C7.779,7.149 7.989,7.264 8.198,7.378 C8.408,7.492 8.408,7.721 8.408,7.835 L7.150,9.321 L8.094,9.321 C8.303,9.321 8.408,9.549 8.408,9.778 C8.408,10.007 8.303,10.235 8.094,10.235 L6.940,10.235 L6.940,11.035 L8.932,11.035 C9.142,11.035 9.247,11.264 9.247,11.493 C9.247,11.606 9.037,11.835 8.932,11.835 L8.932,11.835 Z"/></svg>
赞赏</button></div>                      
</div>
            