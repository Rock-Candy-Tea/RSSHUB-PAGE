
---
title: '数据仓库，为什么需要分层建设和管理？'
categories: 
 - 新媒体
 - 人人都是产品经理
 - 最新文章
headimg: 'https://image.woshipm.com/wp-files/2022/08/WzMJxxpyCobRxejdDRej.jpg'
author: 人人都是产品经理
comments: false
date: Thu, 25 Aug 2022 00:00:00 GMT
thumbnail: 'https://image.woshipm.com/wp-files/2022/08/WzMJxxpyCobRxejdDRej.jpg'
---

<div>   
<blockquote><p>数据仓库是为企业所有级别的决策制定过程，提供所有类型数据支持的战略集合，为需要业务智能的企业，提供指导业务流程改进、监视时间、成本、质量以及控制。作者提出，数据仓库需要做好分层建设和管理，原因是什么，又有什么分层方法，欢迎感兴趣的伙伴们阅读。</p>
</blockquote><p><img data-action="zoom" class="size-full wp-image-5577587 aligncenter" src="https://image.woshipm.com/wp-files/2022/08/WzMJxxpyCobRxejdDRej.jpg" alt width="900" height="420" referrerpolicy="no-referrer"></p>
<p>数据仓库是数据化运营和数字化转型的底层基础设施，数据仓库不完善或者建设质量差，再好的上层建筑（数据应用产品或工具）也很难牢固地生存下去。在数据仓库建设时，绕不开的话题就是数仓分层。</p>
<h2 id="toc-1">一、为什么要进行数据分层</h2>
<p><strong>1. 降低数据开发成本</strong></p>
<p>基于数据模型的开箱即用的开发成本要远小于每一次的case by case的按需开发。例如要计算产品的DAU指标，直接从加工好的数据表中select一下指标值，不管是SQL代码的复杂程度还是查询性能、耗时都要远比再从源表重新清洗一遍业务逻辑要简单的多。</p>
<p>通过分层建设，把通用的业务逻辑加工好，后续的开发任务可以基于模型快速使用，数据需求的响应速度也会更快。</p>
<p><img data-action="zoom" class="aligncenter" src="https://image.woshipm.com/wp-files/2022/08/9HMlA1aDVJFJMnJGvIDC.png" alt width="631" height="115" referrerpolicy="no-referrer"></p>
<p><strong>2. 降低任务运维成本</strong></p>
<p>业务发展过程中，数据指标口径、统计逻辑变化是常态，任务失败也屡见不鲜。如果每一次调整都需要对所有的数据任务进行修改，再去回溯数据，那数据开发大部分时间都在填坑中度过了，而且还会经常出错。</p>
<p>我们知道，管理一棵大树，只要花时间聚焦把主干和重要分支维护好，树就可以正常生长，而管理一片稻田，则需要对每一棵禾苗进行保养。</p>
<p>数仓分层就是希望通过对最基础的、常用的数据进行抽象，找出数据的主干，对主干进行修复后，下游的叶子节点就可以最小变动。例如，当产品改版后，涉及流量统计指标口径需要调整，通过数据分层，只修改最底层的源表的逻辑就可以实现整个链路的数据更新。</p>
<p><strong>3. 方便共享复用，减少重复建设</strong></p>
<p>不同的开发人员、不同时期开发的模型，如果没有分层管理规范，往往导致后期使用时找不到，不是不想复用，而是数据找不到或者需要花费很长时间沟通、翻代码确认，最终耗时反而没有重新写一套逻辑来的快，长此以往，导致大家都不敢用别人的模型，数据复用度低，带来存储和计算资源的浪费。</p>
<p>通过数据分层，将数据有序的管理起来，就像图书馆的书架导航，可以快速帮助使用者找到所需要的书籍在那一层书架中，能找到现成的，相信都不愿意做冤大头重新做一份吧。</p>
<p><img data-action="zoom" class="aligncenter" src="https://image.woshipm.com/wp-files/2022/08/a6p5AmmQlJm11VyYCEYv.png" alt width="631" height="259" referrerpolicy="no-referrer"></p>
<p><strong>4. 统一数据口径</strong></p>
<p>同一个指标在数据加工处理时，复用的是同一个数据模型表，这样很大程度可以规避数据统计不统一的问题，毕竟本是同根生嘛。</p>
<h2 id="toc-2">二、数据仓库的分层方法</h2>
<p><img data-action="zoom" class="aligncenter" src="https://image.woshipm.com/wp-files/2022/08/7GSAyMDGIxctdH3YmaCf.png" alt width="631" height="319" referrerpolicy="no-referrer"></p>
<p><strong>ODS层：</strong>贴源数据层，一般是从各种业务系统、日志数据库将数据汇集到数据仓库中，作为原始数据存储和备份，一是数据仓库建设不会直接查业务的关系型数据库，而是通过数据同步的方式，将业务从库数据同步到HDFS（Hive）等，适合海量数据存储和加工处理的介质中。</p>
<p><strong>DWD层：</strong>数据明细层，对ODS层数据进行规范化处理，例如脏数据过滤、数据格式化等，但仍以数据明细方式存储，且将数据进行主题、层级划分。</p>
<p><strong>DIM层：</strong>维度表，在维度建模理论中，可以通过业务主题宽表关联维度表方式，快速输出直观的数据分析结果。</p>
<p><strong>DM层：</strong>数据集市层，基于对业务的需求的理解和抽象，建立通用的指标和分析维度模型，数据仍以明细为主，部分可以直接加和汇总的数据指标，可以采用聚合结果的方式呈现，但如DAU等涉及去重的指标，一般以明细存储。</p>
<p><strong>APP层：</strong>数据应用层，面向不同业务部门、不同产品需求提供具体业务场景的结果表，通过数据同步方式再从数仓同步到MySQL、Greenplum等查询引擎，供前端数据产品输出使用。定制化程度高。</p>
<h2 id="toc-3">三、数据仓库分层管理规范</h2>
<p>数据仓库分层管理中，通过不同层级的数据使用情况指标的构建，对数仓建设完善度和复用度进行指标化管理。</p>
<p><strong>1. 完善度</strong></p>
<p>数仓模型对业务的支撑和覆盖情况，完善度越高的数仓体系，业务获取和使用数据的成本就越低。即当业务需要数据时，已经相应的模型在哪里等着使用了，而不是再去对接业务沟通需求，排期开发。</p>
<p>例如当管理者问数仓负责人，你们天天搞数仓建设，现在到底建设到什么程度了呢?有了完善度评价标准，可以量化数仓建设成熟度。</p>
<p>通过数据血缘及查询日志，可以对数据加工任务以及Adhoc查询进行统计分析。例如，在数据查询中，直接查询ODS的任务占比，占比越高说明有大量任务基于原始数据加工，中间模型DWD、DWT、DWA复用性很差。</p>
<p>在技术上，直接查询底层表，查询扫描的数据量会越大，查询时间会越长，查询的资源消耗也越大，使用数据的人满意度会低。可以跨层引用率来衡量支持完善度，</p>
<p>DWD层：看ODS层有多少表被DWT/DWA/APP 层引用，占所有活跃的ODS 层表比例。</p>
<p>DWT/DWA/APP层完善度：主要看汇总数据能直接满足多少查询需求，也就是用汇总层数据的查询比例，如果汇总数据无法满足需求，使用数据的人就必须使用明细数据，甚至是原始数据。汇总数据查询比例：DWT/DWA/APP层的查询占所有查询的比例。</p>
<p>跨层引用率越低越好，在数据中台模型设计规范中，一般不允许出现跨层引用，例如ODS层数据只能被 DWD引用。</p>
<p><strong>2. 复用度</strong></p>
<p>复用度顾名思义，资产建设完成后，被不同业务或用户复用的情况，复用才会减少重复开发。可以用引用系数作为数据中台资产复用度评价指标。引用系数越高，说明复用性越好。</p>
<p>引用系数：数据表被读取，产出下游模型的平均数量。例如一张DWD 层表被8张 DWS层表引用，这个表的引用系数就是8，把拥有下游的DWD 层表(有下游表的)引用系数取平均值，则为DWD 层的平均引用系数。</p>
<h2 id="toc-4">四、小结</h2>
<p>数据仓库建设以及分层管理，回归到最初的目的，就是降本提效，通过各种规范、手段、流程，来保障数据输出效率最高，可以快速响应业务发展的数据需求，用数据来驱动决策或赋能业务。同时，也要从成本角度考虑，不断降低数据开发成本、存储成本、计算成本。用最少的人和资源，覆盖更多的业务数据需求。</p>
<div class="article--copyright"><p><b>专栏作家</b></p>
<p>数据干饭人，微信号公众号：数据干饭人，人人都是产品经理专栏作家。专注数据中台产品领域，覆盖开发套件，数据资产与数据治理，BI与数据可视化，精准营销平台等数据产品。擅长大数据解决方案规划与产品方案设计。</p>
<p>本文原创发布于人人都是产品经理，未经作者许可，禁止转载。</p>
<p>题图来自 Unsplash，基于CC0协议。</p>
<p>该文观点仅代表作者本人，人人都是产品经理平台仅提供信息存储空间服务。</p>
</div><div class="support-author"><div class="support-title">给作者打赏，鼓励TA抓紧创作！</div><button class="button--pay" data-post-id="5576683" data-author="850132" data-avatar="https://image.woshipm.com/wp-files/2021/09/cOGve0gK4PPmNSNMsXSG.jpg"><svg width="13" height="16" class="svgIcon--use" viewBox="0 0 13 16"><path d="M9.113,4.571 C9.951,3.771 10.895,2.742 10.685,2.057 C10.475,1.485 10.056,0.799 9.427,0.571 C8.903,0.342 8.379,0.456 7.750,0.799 C7.540,0.342 7.016,0.114 6.596,-0.001 C5.863,-0.001 5.234,0.228 4.814,0.914 C4.080,0.571 3.451,0.685 2.927,1.028 C2.613,1.256 2.298,1.713 2.298,2.628 C2.298,3.542 3.137,4.228 3.766,4.685 C2.508,5.599 -0.218,7.885 -0.008,12.228 C-0.218,15.656 2.613,15.999 2.613,15.999 L10.371,15.999 C11.314,15.885 12.991,14.971 12.991,12.571 L12.991,12.228 C13.201,7.771 10.371,5.371 9.113,4.571 L9.113,4.571 ZM8.932,11.835 L6.940,11.835 L6.940,13.207 C6.940,13.435 6.731,13.549 6.521,13.549 C6.311,13.549 6.102,13.435 6.102,13.207 L6.102,11.835 L4.110,11.835 C3.900,11.835 3.795,11.606 3.795,11.378 C3.795,11.149 3.900,10.921 4.110,10.921 L6.102,10.921 L6.102,10.121 L4.949,10.121 C4.739,10.121 4.634,9.892 4.634,9.664 C4.634,9.435 4.739,9.206 4.949,9.206 L5.892,9.206 L4.739,7.950 C4.634,7.835 4.739,7.606 4.949,7.492 C5.158,7.378 5.368,7.264 5.473,7.378 L6.521,8.635 L7.674,7.264 C7.779,7.149 7.989,7.264 8.198,7.378 C8.408,7.492 8.408,7.721 8.408,7.835 L7.150,9.321 L8.094,9.321 C8.303,9.321 8.408,9.549 8.408,9.778 C8.408,10.007 8.303,10.235 8.094,10.235 L6.940,10.235 L6.940,11.035 L8.932,11.035 C9.142,11.035 9.247,11.264 9.247,11.493 C9.247,11.606 9.037,11.835 8.932,11.835 L8.932,11.835 Z"/></svg>
赞赏</button></div>                      
</div>
            