
---
title: '屡次让拳头翻车的 ping：作者因车祸英年早逝，千行源码改变世界'
categories: 
 - 新媒体
 - IT 之家
 - 热榜
headimg: 'https://img.ithome.com/newsuploadfiles/2022/5/c8b7602f-ea90-4835-89d3-29e452667649.png'
author: IT 之家
comments: false
date: Thu, 19 May 2022 04:35:34 GMT
thumbnail: 'https://img.ithome.com/newsuploadfiles/2022/5/c8b7602f-ea90-4835-89d3-29e452667649.png'
---

<div>   
<p data-vmark="6fda">也是没想到，“ping”这么个计算机术语，竟然在英雄联盟 MSI 话题下被讨论上了热搜。无论在微博还是知乎，不少“ping”相关话题的热度已经过千万甚至上亿。</p><p style="text-align: center;" data-vmark="4476"><img src="https://img.ithome.com/newsuploadfiles/2022/5/c8b7602f-ea90-4835-89d3-29e452667649.png" w="1080" h="305" title="屡次让拳头翻车的 ping：作者因车祸英年早逝，千行源码改变世界" width="1080" height="232" referrerpolicy="no-referrer"></p><p data-vmark="bef6">从话题下的讨论来看，不少网友甚至产生了对 ping 的研究热情：</p><p style="text-align: center;" data-vmark="abca"><img src="https://img.ithome.com/newsuploadfiles/2022/5/8378238e-16fa-4134-9cda-117d14518f4d.png" w="1080" h="327" title="屡次让拳头翻车的 ping：作者因车祸英年早逝，千行源码改变世界" width="1080" height="248" referrerpolicy="no-referrer"></p><p data-vmark="3d1d">说起来，经常玩联机游戏的小伙伴，想必对 ping 都不陌生。谁还没感受过几次被 ping 值支配的恐惧呢？（手动狗头）</p><p style="text-align: center;" data-vmark="8638"><img src="https://img.ithome.com/newsuploadfiles/2022/5/82081bd4-4b91-4a25-9330-a4f71f6c1ae4.png" w="652" h="350" title="屡次让拳头翻车的 ping：作者因车祸英年早逝，千行源码改变世界" width="652" height="350" referrerpolicy="no-referrer"></p><p style="text-align: center;" data-vmark="b452">△ 高 ping 战士无所畏惧</p><p data-vmark="e6b6">ping 值越高，代表着打游戏时的网络延迟越高，表现到游戏中，就是延迟低的比延迟高的人更快做出各种（击杀、移动等）动作。</p><p style="text-align: center;" data-vmark="03b1"><img src="https://img.ithome.com/newsuploadfiles/2022/5/cb2fd8b6-f0aa-4b88-bed7-074855684a31.png" w="1080" h="375" title="屡次让拳头翻车的 ping：作者因车祸英年早逝，千行源码改变世界" width="1080" height="285" referrerpolicy="no-referrer"></p><blockquote><p data-vmark="0082">注意，这里的 ping 值并不代表你的网速。</p><p data-vmark="282d">这么说吧，如果你的数据包是一份快递的话，网速越高代表卡车吨量越大，而 ping 值则代表了这辆卡车能跑得多快、路上有多堵。</p><p data-vmark="a5d3">越低的 ping 值，意味着你的网络越畅通，但和它一次能搬运多少数据并没有什么关系。</p></blockquote><p data-vmark="be56">但你知道，ping 最初是如何被发明出来的吗？其实，这个如今在打游戏、开会和测延迟中“无处不在”的计算机技术，当年竟然是被“随手”写出来的。故事还要从 80 年代的时候说起。</p><h2 data-vmark="ebf4">来自 1983 年的千行代码</h2><p data-vmark="5b3e">这个名叫 ping 的工具，最初是由一位叫 Michael John Muuss 的老哥搞出来的。</p><p style="text-align: center;" data-vmark="affa"><img src="https://img.ithome.com/newsuploadfiles/2022/5/36538444-b19b-44be-af86-8430c7aa4bf1.png" w="418" h="450" title="屡次让拳头翻车的 ping：作者因车祸英年早逝，千行源码改变世界" width="418" height="450" referrerpolicy="no-referrer"></p><p data-vmark="59de">Muuss 出生于 1958 年，从约翰・霍普金斯大学毕业后，在美国陆军一个名叫“阿伯丁试验场”的兵器试验中心做研究，主要与计算机网络和几何建模等方向有关。</p><p data-vmark="2aea">例如，光线追踪在 80 年代刚火起来那会儿，Muuse 老哥就已经在潜心研究相应的技术了。期间他做了不少相关成果，<strong>但反而是“随手发明”出来的 ping，如今成了最著名的网络工具之一</strong>。</p><p data-vmark="7531">ping 应用广泛到什么程度？从最初的 Unix 系统，到如今的 Windows、macOS 和 Linux，<strong>ping 虽然历经好几个版本，但一直在各个操作系统上被广泛使用</strong>。</p><p data-vmark="e6e8">如今我们在 GitHub 上随手一搜，能看到不少实现 ping 的代码，但这些都不是最初的版本了。</p><p style="text-align: center;" data-vmark="f7a1"><img src="https://img.ithome.com/newsuploadfiles/2022/5/91d3d526-dbcd-4b2e-96ec-6fc1aa663f15.png" w="1080" h="335" title="屡次让拳头翻车的 ping：作者因车祸英年早逝，千行源码改变世界" width="1080" height="254" referrerpolicy="no-referrer"></p><p data-vmark="63d8">Muuss 在自己的主页上提供了 ping 最初的源代码，然而我们点进去后就会发现，网页跳转了好几次，最终似乎也无法下载：</p><p style="text-align: center;" data-vmark="be60"><img src="https://img.ithome.com/newsuploadfiles/2022/5/dc1fb882-c554-4b9d-b185-6afccf5a6dd2.gif" w="712" h="32" title="屡次让拳头翻车的 ping：作者因车祸英年早逝，千行源码改变世界" width="712" height="32" referrerpolicy="no-referrer"></p><p style="text-align: center;" data-vmark="130e"><img src="https://img.ithome.com/newsuploadfiles/2022/5/a1266d1c-cfae-4bce-9083-eeda63aab7a6.png" w="1080" h="301" title="屡次让拳头翻车的 ping：作者因车祸英年早逝，千行源码改变世界" width="1080" height="229" referrerpolicy="no-referrer"></p><p data-vmark="3002">事实上，我们还能看到 Muuss 的主页，本身就已经不寻常了 ——2000 年时，Muuss 不幸因车祸去世，当时他才刚过完自己的 42 岁生日：</p><p style="text-align: center;" data-vmark="430e"><img src="https://img.ithome.com/newsuploadfiles/2022/5/d0454812-1c0f-402e-8b16-4b53fea9dfc7.png" w="1080" h="452" title="屡次让拳头翻车的 ping：作者因车祸英年早逝，千行源码改变世界" width="1080" height="343" referrerpolicy="no-referrer"></p><p data-vmark="880e">还好在 Web Archive 上保存了那个时候的网页，我们得以看见 ping 的第一版源代码。</p><p data-vmark="86b9">这份代码文件名是 ping.shar，一个非常有年代感的后缀，如今已经基本没有人使用这个文件扩展名了。它是一个 41KB 大小的文件，从编辑器中来看，大约有 1600 行左右的代码：</p><p style="text-align: center;" data-vmark="cd08"><img src="https://img.ithome.com/newsuploadfiles/2022/5/5b26bc93-10e0-466b-9445-16b3c44e0868.png" w="1080" h="1321" title="屡次让拳头翻车的 ping：作者因车祸英年早逝，千行源码改变世界" width="1080" height="1003" referrerpolicy="no-referrer"></p><p data-vmark="c047">那么，ping 究竟是怎么诞生的，又是如何被普及开来的？</p><h2 data-vmark="0a91">ping 是如何被普及的？</h2><p data-vmark="056e">最初编写这份代码的时候，Muuss 完全没想过它后来会这么火。毕竟最初的 ping，只是一个用来排查实验室网络异常的测试工具。</p><p data-vmark="714a">事情源于 1983 年 12 月的一天，Muuss 在阿伯丁试验场的弹道研究实验室（BRL）中做实验时，突然发现实验室的 IP 网络出现了异常情况。</p><p data-vmark="b800">这时候，他回忆起几个月前，自己曾参与过一次 DARPA 在挪威举办的研讨会，会上一位名叫 Dave Mills 的博士，提到过用 ICMP 数据包测试延迟的方法。</p><p data-vmark="399c">Muuss 认为，这个工具的原理，就<strong>像是发射声波并接收它的回波以计算往返时间一样</strong>。</p><p style="text-align: center;" data-vmark="273f"><img src="https://img.ithome.com/newsuploadfiles/2022/5/76cf3b50-af2c-4d09-ba22-cc845f00dbee.png" w="820" h="442" title="屡次让拳头翻车的 ping：作者因车祸英年早逝，千行源码改变世界" width="820" height="442" referrerpolicy="no-referrer"></p><p style="text-align: center;" data-vmark="1e92">△ 声呐，图源维基百科</p><p data-vmark="98ac">刚好 Muuss 在大学的时候学过不少声呐和雷达系统的建模，他很快写了一个程序，并<strong>将之命名为 ping</strong>，<strong>在声呐中指代声音脉冲、也就是信号的意思</strong>。随后，Muuss 只用了一晚上，就将 ping 的程序写了出来。</p><p data-vmark="5e63">虽然写出来的时候，他所在的实验室已经将网络问题解决了，但 Muuss 还是将它作为一个公有领域软件（public domain software，使用时无需许可证）发布了出去。</p><p data-vmark="acea">很快加州大学伯克利分校的 Erick Engelke 发现了这份软件，将它改写了一版（遵循 GPL 开源协议），放入伯克利自己开发的 Unix 操作系统 BSD4.3 版本中。</p><p data-vmark="e7f1">随后，计算机工程师 Tim Crawford 又基于 MIT 开源协议，写了一个 ReactOS 版本的 ping 代码。再之后，ping 被各个计算机大牛写入各种操作系统如 macOS、Linux 和 Windows 中，又加入了更多的功能。</p><p style="text-align: center;" data-vmark="4130"><img src="https://img.ithome.com/newsuploadfiles/2022/5/71d1ec20-79bc-4ec0-b917-8392f3ad169c.png" w="1080" h="159" title="屡次让拳头翻车的 ping：作者因车祸英年早逝，千行源码改变世界" width="1080" height="121" referrerpolicy="no-referrer"></p><p style="text-align: center;" data-vmark="41d2">△ Linux 系统上的 ping.c</p><p data-vmark="4d1c">如今我们看到的各个系统中自带的 ping 工具，早已经不是最初那个 ping.shar 程序了，其功能和用法都要丰富得多。那么，如今的 ping 放到计算机上来说，究竟是一个怎样的工具呢？</p><h2 data-vmark="fa73">ping 的基本原理</h2><p data-vmark="0ee6">许多计算机发烧友可能会说，自己 ping 用得贼 6。不过，大伙儿知道 ping 是如何工作的吗？知其然，不妨也了解一下背后的所以然：ping，是网络结构里应用层的一个网络管理命令，是判断两台主机或路由节点之间网络是否畅通的重要手段。</p><p data-vmark="0918">简单来说：如果两台主机“ping”得通，说明它们之间可以建立连接。</p><p style="text-align: center;" data-vmark="3165"><img src="https://img.ithome.com/newsuploadfiles/2022/5/69ee2bd8-e916-4d28-8b81-dc9ceae1abef.png" w="962" h="498" title="屡次让拳头翻车的 ping：作者因车祸英年早逝，千行源码改变世界" width="962" height="424" referrerpolicy="no-referrer"></p><p data-vmark="d413">一个小知识：公网（因特网）IP 地址具有唯一性。这就像你在世界范围（公网）内的一栋楼（主机 or 路由节点等）里工作，这栋楼的地址（IP 地址）相对世界来说是唯一的，不过楼里面的其他门牌号（内网 IP 地址）则不一定是唯一的。</p><p data-vmark="7ff8">利用这一特性，我们就能用 ping 测试两台主机或路由节点中的网络连通性。具体来说，就是使用 ping 命令，先给目标 IP 地址发送一个遵循 ICMP 协议的数据包（echo request）。然后可以根据返回数据包的情况（丢包、速度等），检查主机或路由节点之间的网络状态。</p><p data-vmark="8fcb">Emm…ICMP 协议又是什么？它的全称是：Internet Control Message Protocol，即因特网控制报文协议，ICMP 报文封装在 IP 包里。所谓“控制”，即在 IP 主机、路由节点之间传递控制消息，来反映数据包是否成功到达目标端，以及反映网络状况等。</p><p data-vmark="4823">在 IP 通信中，当 IP 包成功到达目标地址并返回时，会收到 ping 应答；而当 IP 包因为某原因，未能成功到达目标地址、或未能成功从目标地址返回时，ICMP 返回的数据包中将含有具体原因，如：网络不可达、端口不可达等。</p><h2 data-vmark="a71d">怎样 ping 起来</h2><p data-vmark="36af">下面介绍一下 ping 的基本操作。ping 命令在各个常见的操作系统中通用，这里以 macOS 为例：从 Finder 中找到“终端”。</p><p style="text-align: center;" data-vmark="62e5"><img src="https://img.ithome.com/newsuploadfiles/2022/5/8bd3aeaf-d7de-4d78-a19b-11b5a60eda0d.png" w="774" h="666" title="屡次让拳头翻车的 ping：作者因车祸英年早逝，千行源码改变世界" width="774" height="666" referrerpolicy="no-referrer"></p><p data-vmark="9ecb">输入 ping+IP 地址（网址或域名也可以），这里先以百度为例。然后，即可查看每个数据包，从本电脑对百度的网络服务器发送数据，到接收到服务器反馈数据的延迟时间。</p><p style="text-align: center;" data-vmark="366e"><img src="https://img.ithome.com/newsuploadfiles/2022/5/5a1f4fa9-4e3c-4b5d-9c30-779db6ee701f.png" w="1080" h="517" title="屡次让拳头翻车的 ping：作者因车祸英年早逝，千行源码改变世界" width="1080" height="393" referrerpolicy="no-referrer"></p><p data-vmark="8e5d">由于 macOS 发送的每个 IP 数据包默认大小是 64 个字节，所以返回的数据包大小也是 64 个字节。</p><p data-vmark="1ed4">而这里的延迟时间，就是 ping 值。除了输入百度等网址，想要测两台主机之间的 ping 值也没问题，在一台上输入另一台的 IP 地址即可：</p><p style="text-align: center;" data-vmark="6214"><img src="https://img.ithome.com/newsuploadfiles/2022/5/69e6aa8a-4b99-4618-950c-26cc169a7d47.png" w="1080" h="384" title="屡次让拳头翻车的 ping：作者因车祸英年早逝，千行源码改变世界" width="1080" height="292" referrerpolicy="no-referrer"></p><p data-vmark="0ea2">所以，在玩网络游戏的时候，如果 ping 值过高就会感觉操作延迟。这个延迟的后果还挺严重的 —— 例如，在打王者排位的关键时刻，如果网络连接（可能是自己的无线网，也可能是附近的服务器）卡顿，明明自己已经操作了，但由于敌方的操作反馈时间更快，所以只能眼睁睁得看着自己的英雄挂掉。</p><p style="text-align: center;" data-vmark="b49e"><img src="https://img.ithome.com/newsuploadfiles/2022/5/9558cc8b-a60c-4fbc-a5dd-0d18eecef053.png" w="500" h="460" title="屡次让拳头翻车的 ping：作者因车祸英年早逝，千行源码改变世界" width="500" height="460" referrerpolicy="no-referrer"></p><p data-vmark="bb90">说到这里，量子位急忙上号诊断了一下自己的网络。</p><p style="text-align: center;" data-vmark="6e2e"><img src="https://img.ithome.com/newsuploadfiles/2022/5/5d1e73c9-a708-483a-9083-0370f323f7b7.png" w="1080" h="495" title="屡次让拳头翻车的 ping：作者因车祸英年早逝，千行源码改变世界" width="1080" height="376" referrerpolicy="no-referrer"></p><p data-vmark="2a5f">还好，王者荣耀的延迟低于 70ms 算正常。对于 LOL，玩家可打开设置菜单，点击“显示”标签，然后点击“切换 FPS 显示”按钮，查看自己的 ping 值。</p><p style="text-align: center;" data-vmark="5064"><img src="https://img.ithome.com/newsuploadfiles/2022/5/36cf7e49-f906-40f2-8420-0a1ab99f959c.png" w="1036" h="564" title="屡次让拳头翻车的 ping：作者因车祸英年早逝，千行源码改变世界" width="1036" height="446" referrerpolicy="no-referrer"></p><p data-vmark="ff21">至于锁 ping（人工延迟）技术要如何实现，目前拳头游戏官方给出了一份技术说明：</p><p style="text-align: center;" data-vmark="4d90"><img src="https://img.ithome.com/newsuploadfiles/2022/5/50beba93-8f61-4ca0-b84c-c72270cf360c.png" w="1080" h="841" title="屡次让拳头翻车的 ping：作者因车祸英年早逝，千行源码改变世界" width="1080" height="639" referrerpolicy="no-referrer"></p><p data-vmark="4214">从说明中来看，拳头表示在线下场馆比赛时<strong>加入了一个人工延迟工具调整 ping 值</strong>。由于人工延迟工具的代码运算出现错误，导致线下 ping 值过高，目前已通过调节配置修复，但<strong>游戏中显示的 ping 值会因为这一配置调节出现问题</strong>。</p><p style="text-align: center;" data-vmark="fd7d"><img src="https://img.ithome.com/newsuploadfiles/2022/5/405d9b4d-5ad7-4103-ad91-b05592c8de0d.jpg@s_2,w_820,h_605" w="1067" h="787" title="屡次让拳头翻车的 ping：作者因车祸英年早逝，千行源码改变世界" srcset="https://img.ithome.com/newsuploadfiles/2022/5/405d9b4d-5ad7-4103-ad91-b05592c8de0d.jpg 2x" width="1067" height="605" referrerpolicy="no-referrer"></p><p data-vmark="472c">具体人工延迟工具（锁 ping）的技术代码，目前拳头游戏并未公开。不过 GitHub 上也已经有人做过人工延迟工具，如下面这个 clumsy 开源模拟器，可以模拟延迟、丢包等 bug。感兴趣的小伙伴可以去看看：</p><p style="text-align: center;" data-vmark="af58"><img src="https://img.ithome.com/newsuploadfiles/2022/5/1711c6b5-af5f-4fda-9ddc-b678156d0935.png" w="1080" h="232" title="屡次让拳头翻车的 ping：作者因车祸英年早逝，千行源码改变世界" width="1080" height="176" referrerpolicy="no-referrer"></p><h2 data-vmark="0e49">One More Thing</h2><p data-vmark="2fd4">在自己的主页上，Muuse 还 po 出了另一个与“ping”相关的小趣事。早在 1933 年，美国儿童图画书作家 Marjorie Flack 就曾经出版过一个绘本：《ping 的故事》。</p><p style="text-align: center;" data-vmark="0873"><img src="https://img.ithome.com/newsuploadfiles/2022/5/9df264b5-ad8b-4ce1-a326-57bfce520f4f.png" w="628" h="634" title="屡次让拳头翻车的 ping：作者因车祸英年早逝，千行源码改变世界" width="628" height="634" referrerpolicy="no-referrer"></p><p data-vmark="1f7e">在这里，ping 是故事主角小鸭子的名字：小鸭子 ping 和伙伴还有主人一起生活在一条船上，每天最后一只回家的小鸭子要被打屁股。一天傍晚，ping 贪玩落在了最后，为了不挨打，它没有回家，由此在长江中开启了一段奇妙冒险，最终平安回到主人的船上。</p><p data-vmark="6fa9">这看似是一本寻常的儿童读物，但多年后，有读者发现，小鸭子 ping 的故事与计算机中的 ping 数据包竟有异曲同工之妙！一个 ping 数据包就像一只鸭子，它和其他数据包（更多鸭子）一起，在主机（小船）上度过了一段时期。</p><p data-vmark="6906">然后，这些数据包（鸭子）通过一个通道（桥）离开主机（船），进入互联网（长江）。数据包（鸭子）在另一个主机（另一艘船）上经过短暂的时间后，又回到了原来的主机（船）上。所以，今天你的 ping 值如何？</p><p style="text-align: center;" data-vmark="3ab5"><img src="https://img.ithome.com/newsuploadfiles/2022/5/cea9e219-b331-400e-b22b-570319f886bd.png" w="406" h="400" title="屡次让拳头翻车的 ping：作者因车祸英年早逝，千行源码改变世界" width="406" height="400" referrerpolicy="no-referrer"></p><p data-vmark="70f9">参考链接：</p><p data-vmark="1424">[1]<span class="link-text-start-with-http">https://blog.paessler.com/a-brief-history-of-ping</span></p><p data-vmark="77ec">[2]<span class="link-text-start-with-http">https://ftp.arl.army.mil/~mike/ping.html</span></p><p data-vmark="8275">[3]<span class="link-text-start-with-http">https://s.weibo.com/weibo?q=%23MSI%E7%8E%B0%E5%9C%BA%E5%AE%9E%E9%99%85ping%E5%80%BC%23</span></p><p data-vmark="0384">[4]<span class="link-text-start-with-http">https://github.com/iputils/iputils/blob/master/ping/ping.c</span></p><p data-vmark="440a">[5]<span class="link-text-start-with-http">https://en.wikipedia.org/wiki/Mike_Muuss</span></p><p data-vmark="a8ea">[6]<span class="link-text-start-with-http">https://ngabbs.com/read.php?tid=30095855&amp;rand=196</span></p><p data-vmark="c847">[7]<span class="link-text-start-with-http">https://github.com/jagt/clumsy</span></p><p data-vmark="156c">[8] 拳头技术博客公告：<span class="link-text-start-with-http">https://weibo.com/</span> ttarticle / p / show?id=2309404770219460790187</p>
          
</div>
            