
---
title: '我，爆肝 17 天用 600 行代码拍到 400 公里之外的国际空间站'
categories: 
 - 新媒体
 - IT 之家
 - 热榜
headimg: 'https://img.ithome.com/newsuploadfiles/2022/4/617ef0b0-2c4a-486b-8505-2d0e8ec07af1.gif'
author: IT 之家
comments: false
date: Sun, 10 Apr 2022 04:29:01 GMT
thumbnail: 'https://img.ithome.com/newsuploadfiles/2022/4/617ef0b0-2c4a-486b-8505-2d0e8ec07af1.gif'
---

<div>   
<p data-vmark="6c5a">如何在 400 公里开外，拍摄这样一张空间站照片？</p><p data-vmark="b8a9" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/4/617ef0b0-2c4a-486b-8505-2d0e8ec07af1.gif" w="444" h="444" title="我，爆肝 17 天用 600 行代码拍到 400 公里之外的国际空间站" width="444" height="444" referrerpolicy="no-referrer"></p><p data-vmark="daad">作为太空中最大人造物体，国际空间站一直是无数天文爱好者心中梦寐以求的拍摄对象。</p><p data-vmark="9fcb">而大多数人采用的方法，是根据自己所在的经纬度，算好空间站过境的时间（几秒到几分钟不等），然后配合手机或微单进行拍摄，然后啪 —— 得到这样一张小光点：</p><p data-vmark="6e6d" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/4/fb3a3d81-643c-426b-b3a8-34056674895c.png" w="646" h="340" title="我，爆肝 17 天用 600 行代码拍到 400 公里之外的国际空间站" width="646" height="340" referrerpolicy="no-referrer"></p><p data-vmark="7b59">稍微进阶一点的，则会采用“<span class="accentTextColor">凌日凌月</span>”拍摄法，即在空间站飞过太阳或者月亮之前，以这两个天体为背景源，确定一个范围更小的区域。</p><p data-vmark="0bda">然后等在中心线上，把持着几公斤到几十公斤重的大口径、长焦距望远镜进行长时间的稳定跟踪，直到空间站过月或过日的 1 秒之内，按下快门拍摄。</p><p data-vmark="8d7c" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/4/515736b5-b13d-424b-b000-8b84a9da8b9e.png" w="1080" h="1081" title="我，爆肝 17 天用 600 行代码拍到 400 公里之外的国际空间站" width="1080" height="821" referrerpolicy="no-referrer"></p><p data-vmark="93e8">这种拍摄效果会更加清晰，但致命的问题仍然存在：</p><p data-vmark="bf96"><span class="accentTextColor">空间站平均每 90 分钟就能绕地球一圈</span>。用知名的星空观测模拟工具 Stellarium 对比一下，相比空间站，金星和火星简直如同“静物”（实时模拟，没有加速）：</p><p data-vmark="810a" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/4/aee766a1-dcce-44d8-8fe0-b42fbe02d94b.gif" w="480" h="477" title="我，爆肝 17 天用 600 行代码拍到 400 公里之外的国际空间站" width="480" height="477" referrerpolicy="no-referrer"></p><p data-vmark="7fee">简言之，就是空间站跑得太快了。</p><p data-vmark="9c0b">因此，不仅 1 秒内拍摄的帧数有限（无法用多帧叠加克服大气抖动）、只能拍到轮廓剪影，甚至很可能因为计算错误而错过拍摄的机会。</p><p data-vmark="a148">要是还想拍出更高精度的照片，不仅得有非比寻常的耐心，还要有深厚老练的手动操控技术。</p><p data-vmark="8938" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/4/ee71de44-c4b2-489a-96ea-9e5aaa4792d8.png" w="294" h="172" title="我，爆肝 17 天用 600 行代码拍到 400 公里之外的国际空间站" width="294" height="172" referrerpolicy="no-referrer"></p><p data-vmark="f29c">例如一旦遇到大风，拍出来的效果就容易“糊成一团”：</p><p data-vmark="fe3b" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/4/890a53da-8424-4af5-8151-1d1e0d67e547.gif" w="640" h="380" alt="图源王卓骁，已授权" title="我，爆肝 17 天用 600 行代码拍到 400 公里之外的国际空间站" width="640" height="380" referrerpolicy="no-referrer"></p><p data-vmark="4170">▲ 图源王卓骁，已授权</p><p data-vmark="c044">于是这时，有人就灵光一动：</p><p data-vmark="340f">没有麒麟臂，用代码<strong>让望远镜自己动起来</strong>不就好了？</p><p data-vmark="5bfd">说干就干，这位“业余程序员”当即爆肝 17 天，搞出了一套<span class="accentTextColor">自动跟踪</span>系统。</p><p data-vmark="de7e">在这套自动跟踪系统的加持下，望远镜不再是只能在特定几秒钟拍摄几张静态图像，而是持续不断地跟了空间站 <span class="accentTextColor">2 分钟</span>。</p><p data-vmark="ef3d">最终，多张图像叠加和后期处理，便合成了一张高精度的立体 GIF 图像：</p><p data-vmark="8733">（也就是我们开头的那张图）</p><p data-vmark="30f0" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/4/430feb69-174e-44ad-a43f-78e803e3e094.gif" w="480" h="266" title="我，爆肝 17 天用 600 行代码拍到 400 公里之外的国际空间站" width="480" height="266" referrerpolicy="no-referrer"></p><p data-vmark="a714">就是这么一张图像，让网友发出了“直接开启人造天体跟踪摄影的时代”的感叹。</p><p data-vmark="ae32" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/4/145791d5-eb9c-4a83-8d54-093750481963.png" w="855" h="150" title="我，爆肝 17 天用 600 行代码拍到 400 公里之外的国际空间站" width="855" height="144" referrerpolicy="no-referrer"></p><p data-vmark="b704">于是，我们找到这位开发者本人，北大天文校友、天体物理博士刘博洋聊了聊。</p><h2 data-vmark="234c">拍摄高精度空间站，到底难在哪？</h2><p data-vmark="47e2">首先，需要简单了解一下拍摄空间站的“时机”。</p><p data-vmark="8e87">虽然空间站移动速度极快，平均每 90 分钟就能绕地球一圈，而且高度平均距离地球也就 400 公里左右，属于肉眼可见的范围，但我们并不能随时观测到它。</p><p data-vmark="446f">主要有两个限制条件：视野范围和观测时间。</p><blockquote><p data-vmark="65e0"><strong>视野范围</strong>指空间站飞到我们视野可见的范围内，也就是恰好“过境”这段时间；</p><p data-vmark="cf27"><strong>观测时间</strong>指我们能观测到空间站的时机。空间站自身不会发光，只有在每天日落后两小时、或日出前两小时以内，空间站反射的太阳光最亮，才最适合拍摄。</p></blockquote><p data-vmark="fa39">只有这两个条件同时满足，我们才有机会在地面观测并拍摄到空间站，但效果也还受天气等因素影响（如图中就是遇到了多云天气）：</p><p data-vmark="6c88" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/4/3b960925-e7aa-48f5-bccb-4751f0382ef3.gif" w="640" h="349" alt="图源朱一静 & 徐成城，已授权" title="我，爆肝 17 天用 600 行代码拍到 400 公里之外的国际空间站" width="640" height="349" referrerpolicy="no-referrer"></p><p data-vmark="11b0">▲ 图源朱一静 & 徐成城，已授权</p><p data-vmark="bea5">然而，目前已有的几种常见天体拍摄方法，对于拍摄<span class="accentTextColor">更高精度</span>的空间站照片，其实都不适合。</p><p data-vmark="10e4"><span class="accentTextColor">第一种方法</span>，是直接通过“手摇”望远镜拍摄，也就是推着望远镜跟踪天体。</p><p data-vmark="e2af">这种方法有一个缺陷，没办法拍摄非常高清的空间站。由于拍摄时必须靠人工跟踪，因此不能用长焦镜头直接找，否则就像是用显微镜去捕捉一只高速移动的蚂蚁，空间站一不留神就消失在镜头外了。</p><p data-vmark="d560" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/4/10e3a77d-5756-4fcc-b942-73a5e7aa6e79.gif" w="394" h="250" title="我，爆肝 17 天用 600 行代码拍到 400 公里之外的国际空间站" width="394" height="250" referrerpolicy="no-referrer"></p><p data-vmark="ecec"><span class="accentTextColor">第二种方法</span>，是像“守株待兔”一样，架好各种高清晰度的镜头和设备，在原地等待空间站“路过”。</p><p data-vmark="1f38">这种方法不需要移动镜头，而是反过来等空间站自己“经过”。但它又面临一些新的问题，例如空间站“路过”的时间很短，有时候往往只有几秒钟的时间，很可能抓拍不到；即使抓拍到的镜头，由于无法调整角度等原因，效果也无法保证。</p><p data-vmark="8484">所以，为什么不用<span class="accentTextColor">望远镜自带的追踪功能</span>拍摄？</p><p data-vmark="b865">这个功能通常只适用于用于追踪日月、行星、恒星等天体由于地球自转而产生的东升西落，毕竟它们移动的速度不快，基本与地球自转同步。但对于像空间站这种高速移动的天体，望远镜自己就追不上了。</p><p data-vmark="2a24">因此，最终还是得靠<span class="accentTextColor">程序</span>辅助，来实现高精度空间站的跟踪拍摄。</p><p data-vmark="39ce"><span class="accentTextColor">第三种方法</span>，是利用轨道根数（即轨道参数）跟踪，也就是利用在各种天文网站上（如 Heavens-Above 等）找到的天体信息，来调整望远镜的跟踪路径，并进行手动修正：</p><p data-vmark="eda7" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/4/34eeea51-ee9c-41a0-8243-25464a81f635.png" w="1080" h="624" title="我，爆肝 17 天用 600 行代码拍到 400 公里之外的国际空间站" width="1080" height="474" referrerpolicy="no-referrer"></p><p data-vmark="d85d">目前，大部分天文爱好者都是通过这种方法实现跟踪 + 微调，网上也已经有一些相对成熟的程序，例如这是用电动经纬仪根据轨道参数跟踪空间站的效果：</p><p data-vmark="8e12" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/4/b360b921-2fdb-476e-8091-0a1aea962cbb.gif" w="640" h="421" alt="图源王卓骁，已授权" title="我，爆肝 17 天用 600 行代码拍到 400 公里之外的国际空间站" width="640" height="421" referrerpolicy="no-referrer"></p><p data-vmark="6e59">▲ 图源王卓骁，已授权</p><p data-vmark="7911">BUT，你永远不知道这些天文网站更新到底及不及时。有时候空间站临时调整了轨道、但网站没有更新的话，你的程序也就失效了。</p><h2 data-vmark="d354">利用光学识别，误差控制在 4 像素以内</h2><p data-vmark="4737">上述的所有问题，作为老天文迷的刘博洋不可能不懂。</p><p data-vmark="b709">他一开始的想法，是通过现有的一些软件寻找镜头中的“光点”，基于<span class="accentTextColor">光学识别</span>方法对目标实施识别和跟踪。</p><p data-vmark="a5a8">然而他在查找合适的程序时却发现，这些程序不是没维护（连 Windows 版都太古早没法用）、就是更新不及时且系统复杂，或者干脆就是闭源收费。</p><p data-vmark="7b58">所以，刘博洋最终决定自己上手，写一个光学识别的自动跟踪脚本，手动找到空间站后基于 PID 控制跟踪。</p><p data-vmark="3db4">他的计划一共分为两步：</p><p data-vmark="11ee"><span class="accentTextColor">第一步，编写程序实现望远镜自动识别并跟踪空间站，耗时 5 天完成</span>。</p><p data-vmark="b828">值得一提的是，光学识别并不是刘博洋的“第一手选择”。</p><p data-vmark="d292">他确实想过用参数 + 手动微调的方式进行跟踪，包括用摇杆无级控制赤道仪转速，以及用轨道根数进行粗跟、结合游戏手柄无级微调等，但试拍效果并不理想（微调时手不够稳）。</p><p data-vmark="72c5">于是，他基于 PID 控制原理，编写了一种光学跟踪的方法。这是一种非常经典的控制算法，PID 分别指比例、积分和微分单元，像让 2 轮机器小车保持平衡，用的就是这种算法。</p><p data-vmark="7288">刘博洋之前并没有学过这一知识，但是为了建立一个稳定的自动控制系统，他自然地引入了比例单元（P）和积分单元（I），以使系统的误差减少。</p><p data-vmark="6f74" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/4/f106ec6f-f239-4830-9810-41228ba6728e.png" w="1080" h="497" title="我，爆肝 17 天用 600 行代码拍到 400 公里之外的国际空间站" width="1080" height="377" referrerpolicy="no-referrer"></p><p data-vmark="eebe">刘博洋的望远镜分为视野较大的寻星镜和视野较小的主镜两部分。这套算法的基本目标，就是根据当前空间站在寻星镜中的位置，计算出它偏离主镜视场的幅度，从而调整望远镜跟踪速度，以改正存在的偏离，使空间站落到主镜视场中。</p><p data-vmark="03b6">利用这个程序，就能让寻星镜快速跟随移动的空间站“光源”，使得空间站总是保持在视野中央。刘博洋试着用激光笔在自己家墙上造了一个匀速移动的亮点，模拟空间站的运动，效果还不错：</p><p data-vmark="abb5" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/4/8cbfff3b-a61b-450f-ab4b-d4982eeb9fb0.gif" w="678" h="332" title="我，爆肝 17 天用 600 行代码拍到 400 公里之外的国际空间站" width="678" height="332" referrerpolicy="no-referrer"></p><p data-vmark="4ed2">程序本身，基于一个叫做 <span class="accentTextColor">ASCOM</span> 的平台开发。</p><p data-vmark="c010">它能将天文设备的所有配置，比如控制望远镜的对焦器、滤光片的转动、相机的开合都集成在一个单独的软件上，是在天文领域运用非常广泛的软件接口标准：</p><p data-vmark="bc26" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/4/2966f098-284c-49c9-a7e6-a8e2816969f6.png" w="851" h="506" title="我，爆肝 17 天用 600 行代码拍到 400 公里之外的国际空间站" width="851" height="488" referrerpolicy="no-referrer"></p><p data-vmark="ff82">硬件准备上，除了笔记本电脑之外，还包括：</p><blockquote><p data-vmark="d2bc">11 英寸口径，焦比 f / 10，折反射式的星特朗 EdgeHD 望远镜，配套有 CGEM 赤道仪</p><p data-vmark="4f97">佳能 EOS R5 相机</p><p data-vmark="eccf">QHY5III462c 相机，作为导星相机</p><p data-vmark="5360">图马思特 T16000M 游戏手柄</p></blockquote><p data-vmark="c215">其中，望远镜大约 4 万元，佳能 EOS R5 相机租借了两周花费 2200 元（市价 2.5 万元），462c 相机不到 1000 元，手柄则是和朋友以物换物拿到的（市价 500 多元）。</p><p data-vmark="f110">整个成本算下来<span class="accentTextColor">不到 4.5 万元</span>，据刘博洋表示，对精度要求没那么高的话，整套不到 1 万元就能搞定。</p><p data-vmark="54c4"><span class="accentTextColor">接下来进入第二步，现场实拍并成功用设备拍摄到高精度的空间站照片</span>。</p><p data-vmark="adb7">但没想到的是，实际拍摄反而要比想象中更难，期间刘博洋“一直在反复试错修 bug”。</p><p data-vmark="30de">他一开始的目标，是捕捉<span class="accentTextColor">中国空间站</span>，然而接连两次出 bug，导致错过了两次观测的最佳时机。</p><p data-vmark="71cf">3 月 23 日，由于未能及时对焦，自动光学跟踪没能起到作用；3 月 27 日，由于寻星镜视场只有 3° 左右，过小的视野导致初步捕获失败，再次没能进入自动跟踪流程。</p><p data-vmark="2caf" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/4/6b1f02a4-44a8-4ee1-95a2-0543eb3b1978.png" w="1080" h="600" title="我，爆肝 17 天用 600 行代码拍到 400 公里之外的国际空间站" width="1080" height="456" referrerpolicy="no-referrer"></p><p data-vmark="9f69">此时距离中国空间站下次可见过境还有很久。因此，在修复操作问题后（将寻星镜视场增大到 15°），刘博洋决定，先用即将迎来几次绝佳过境的<span class="accentTextColor">国际空间站</span>“练练手”。</p><p data-vmark="2212">于是，在将自动跟踪程序中的“抓捕”改为手动触发后，刘博洋成功在 4 月 2 日抓拍到了国际空间站。</p><p data-vmark="5b12">虽然还是有不完美的地方，例如软件崩溃导致寻星镜和主镜的位置校准数据丢失，针对这个问题刘博洋又增加了校准数据记录功能。</p><p data-vmark="4fde">这个时候，代码已经从最初的 400 多行变成了 600 行。</p><p data-vmark="597f">终于，4 月 3 日晚上，在紧急修复 bug 后，刘博洋成功抓拍到了国际空间站。</p><p data-vmark="3d03">具体来说，望远镜对空间站的抓捕分为 x 和 y 两个轴，在按下 catch 后，y 轴很快就稳稳跟上了目标，x 轴则略慢了 10 秒。</p><p data-vmark="73b5">在 30 秒左右时，两个轴都保持在了一个稳定的误差范围内（四个像素左右），这种高精度跟踪持续了一共 120 秒，完整记录了国际空间站从接近到远离的全流程：</p><p data-vmark="7fe7" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/4/fdc2d525-cbef-4e40-85a0-8830804be384.png" w="1080" h="814" title="我，爆肝 17 天用 600 行代码拍到 400 公里之外的国际空间站" width="1080" height="618" referrerpolicy="no-referrer"></p><p data-vmark="353d">最初得到的原始画面大约是 100 多像素，最终，在经过多帧叠加的超采样处理后，图片的像素提高到了 200 多像素。</p><p data-vmark="aa6f">最后经过处理，成功输出了一系列 300×300 像素的图像（合成 GIF 图）：</p><p data-vmark="4008" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/4/e130e7b8-737b-4e45-a2e9-cb5b22f01952.gif" w="352" h="278" title="我，爆肝 17 天用 600 行代码拍到 400 公里之外的国际空间站" width="352" height="278" referrerpolicy="no-referrer"></p><p data-vmark="20d9">而这，是刘博洋开始做这一项目的<span class="accentTextColor">第 17 天</span>。</p><h2 data-vmark="2f71">之后还要发射小火箭</h2><p data-vmark="64f2">在谈到整个项目中最难的一个阶段时，刘博洋印象最深刻的，就是如何让望远镜被 Python 代码调用：</p><blockquote><p data-vmark="42fa">对于我这样一个编程很差的人，开发最初完全就是一个黑箱。</p></blockquote><p data-vmark="283d">刘博洋本科、博士分别就读于北京大学、西澳大学，都是<span class="accentTextColor">天体物理学</span>专业。</p><p data-vmark="ac3e" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/4/15729f59-d74e-4956-9d8a-2b01431b143d.png" w="480" h="480" title="我，爆肝 17 天用 600 行代码拍到 400 公里之外的国际空间站" width="480" height="480" referrerpolicy="no-referrer"></p><p data-vmark="5059">这个专业要求掌握基本的编程技能，但是刘博洋大学时的相关课程，比如计算机概论、数据结构都是低分飘过或者缓考的。</p><p data-vmark="00ad">到了博士阶段，多了大量需要用脚本完成的数据处理工作，他才开始深入地学习编程语言。</p><p data-vmark="cdf5">这次之所以选择自编代码操控望远镜，除了没有找到现成可用的软件之外，也是想要继续锻炼自己的编程能力。</p><p data-vmark="382a">那么这套代码会<span class="accentTextColor">开源</span>吗？在我们这样问时，刘博洋表示：</p><blockquote><p data-vmark="eb04">至少要在自己能调试的范围，将代码优化到一个自己满意的程度，才会考虑下一步。</p></blockquote><p data-vmark="e2a5">他目前最近期的一个目标，是两周后的中国空间站的再一次过境。</p><p data-vmark="f2eb">在成功拿国际空间站”练了手“后，刘博洋充满了信心，还在考虑是否要在接下来的捕捉中适当缩小视场，进而提高拍摄的精度。</p><p data-vmark="6b70">中国空间站的拍摄如果顺利，将在 4 月 21 号之前结束，之后，他就要立刻赶往青海，开展新项目：<span class="accentTextColor">发射一枚装着自己相机的小火箭</span>。</p><p data-vmark="57e7">再远一些，刘博洋还提到了今年下半年可能会有的神舟系列的火箭、以及实验舱的发射，他到时候会拿着自己的这套跟踪空间站的程序，再去跟拍大火箭。</p><p data-vmark="0927">如此硬核的“备战”计划，妥妥一位狂热的航天爱好者无疑了。</p><p data-vmark="b40a">刘博洋最后这样说：</p><blockquote><p data-vmark="b425">天文的兴趣从小就有，也因此本硕博都读的天体物理学。</p><p data-vmark="2b67">不过随着为国内的航天任务越来越多，我能接触到相关活动的机会也就越来越多，于是航天方面的兴趣也就逐渐发展了起来，到现在已经发展成主要的业余爱好了。</p></blockquote><p data-vmark="7617"><strong>参考链接：</strong></p><p data-vmark="d361">[1]<span class="link-text-start-with-http">https://weibo.com/1144755982/LmV8Cp72V</span></p><p data-vmark="d894">[2]<span class="link-text-start-with-http">https://zhuanlan.zhihu.com/p/493080686</span></p><p data-vmark="1f73">[3]<span class="link-text-start-with-http">https://www.heavens-above.com/orbit.aspx?satid=25544</span></p><p data-vmark="8bb0">[4]<span class="link-text-start-with-http">https://mp.weixin.qq.com/s/gNueq8lDQz_86Ifuw8n6Pg#rd</span></p>
          
</div>
            