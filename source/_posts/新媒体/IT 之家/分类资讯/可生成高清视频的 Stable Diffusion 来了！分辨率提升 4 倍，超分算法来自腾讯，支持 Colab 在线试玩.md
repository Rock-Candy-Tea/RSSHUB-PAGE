
---
title: '可生成高清视频的 Stable Diffusion 来了！分辨率提升 4 倍，超分算法来自腾讯，支持 Colab 在线试玩'
categories: 
 - 新媒体
 - IT 之家
 - 分类资讯
headimg: 'https://cors.zfour.workers.dev/?http://ss1.sinaimg.cn/large/95e190b7ly1h6bsal6shsg20hs0hsx6w.gif'
author: IT 之家
comments: false
date: Mon, 19 Sep 2022 04:14:05 GMT
thumbnail: 'https://cors.zfour.workers.dev/?http://ss1.sinaimg.cn/large/95e190b7ly1h6bsal6shsg20hs0hsx6w.gif'
---

<div>   
<p data-vmark="2c39" style="text-align: center;"><img src="https://cors.zfour.workers.dev/?http://ss1.sinaimg.cn/large/95e190b7ly1h6bsal6shsg20hs0hsx6w.gif" w="640" h="640" class="lazy" title="可生成高清视频的 Stable Diffusion 来了！分辨率提升 4 倍，超分算法来自腾讯，支持 Colab 在线试玩" referrerpolicy="no-referrer" width="640" height="640"></p><p data-vmark="656c">古典人像丝滑切换，还都是 4 倍超分辨率水平，细节也就多了亿点点吧，眉毛发丝都根根分明。</p><p data-vmark="c160" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/9/9483f75b-e194-4d56-b64a-25a1ea4abfb5.png" w="984" h="878" title="可生成高清视频的 Stable Diffusion 来了！分辨率提升 4 倍，超分算法来自腾讯，支持 Colab 在线试玩" width="984" height="732" referrerpolicy="no-referrer"></p><p data-vmark="2fa0">这就是最近在推特上火了 Stable Diffusion 视频版 2.0.</p><p data-vmark="fa9c">它能够通过 Real-ESRGAN 进行上采样，让生成画面达到 4 倍超分。</p><p data-vmark="a008" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/9/3566e2cc-ce9b-4627-a79e-985384bef3f0.png" w="1080" h="575" title="可生成高清视频的 Stable Diffusion 来了！分辨率提升 4 倍，超分算法来自腾讯，支持 Colab 在线试玩" width="1080" height="437" referrerpolicy="no-referrer"></p><p data-vmark="7f65">要知道，之前 Stable Diffusion 生成的图像如果想要高清，还得自己手动提升分辨率。</p><p data-vmark="1ba3">现在直接二合一，在谷歌 Colab 上就能跑！</p><h2 data-vmark="09df">食用指南</h2><p data-vmark="12cb">Colab 上的操作非常简单，基本上就是傻瓜式按照步骤运行即可。</p><p data-vmark="0f0c" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/9/c21323f0-ffaa-4d98-8735-3da36a96cea1.png" w="1080" h="463" title="可生成高清视频的 Stable Diffusion 来了！分辨率提升 4 倍，超分算法来自腾讯，支持 Colab 在线试玩" width="1080" height="352" referrerpolicy="no-referrer"></p><p data-vmark="9597">需要注意的是，过程中要从个人 Hugging Face 账户中复制 token 登入。</p><p data-vmark="bd6f">拉取模型前，记得在 Hugging Face 上授权，否则会出现 403 错误。</p><p data-vmark="60af">搞定以上问题后，就能来用 Stable Diffusion 来生成高清视频了。</p><p data-vmark="e0fe" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/9/9468af52-c751-4ae6-87a8-7d816067764f.png" w="1080" h="678" title="可生成高清视频的 Stable Diffusion 来了！分辨率提升 4 倍，超分算法来自腾讯，支持 Colab 在线试玩" width="1080" height="515" referrerpolicy="no-referrer"></p><p data-vmark="938f">生成一段视频需要给出 2 个提示词，然后设置中间的步数，以及是否需要上采样。</p><p data-vmark="8e0f" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/9/41dc08fb-7eee-4582-a4e4-d7bd68ed27fb.png" w="652" h="902" title="可生成高清视频的 Stable Diffusion 来了！分辨率提升 4 倍，超分算法来自腾讯，支持 Colab 在线试玩" width="652" height="902" referrerpolicy="no-referrer"></p><p data-vmark="f9ea">中间步骤越多，生成所需的时间越长；同样上采样也会一定程度上加长生成时间。</p><p data-vmark="a562">还能直接用代码来跑，修改几个简单的参数就能搞定。</p><p data-vmark="3fb3" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/9/65e9dc23-cb91-496f-a5ac-a6e24b4b927d.png" w="1080" h="147" title="可生成高清视频的 Stable Diffusion 来了！分辨率提升 4 倍，超分算法来自腾讯，支持 Colab 在线试玩" width="1080" height="112" referrerpolicy="no-referrer"></p><p data-vmark="f065">除了线上模式外，该模型还支持本地运行，项目已在 GitHub 上开源。</p><p data-vmark="c0af">注意需要额外安装 Real-ESRGAN。</p><p data-vmark="0ddc" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/9/16e5faaa-c277-4dc4-ab96-17e8e5552dfd.png" w="918" h="364" title="可生成高清视频的 Stable Diffusion 来了！分辨率提升 4 倍，超分算法来自腾讯，支持 Colab 在线试玩" width="918" height="325" referrerpolicy="no-referrer"></p><h2 data-vmark="2875">超分算法来自腾讯</h2><p data-vmark="abc2">简单来说，这次 Stable Diffusion 的变种版本就是把生成的图片，通过超分辨率方法变得高清。</p><p data-vmark="6c4a">Stable Diffusion 的原理，是扩散模型利用去噪自编码器的连续应用，逐步生成图像。</p><p data-vmark="4c9f" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/9/63a7a226-f172-4009-9fc4-05cd2d9a60fb.png" w="1080" h="309" title="可生成高清视频的 Stable Diffusion 来了！分辨率提升 4 倍，超分算法来自腾讯，支持 Colab 在线试玩" width="1080" height="235" referrerpolicy="no-referrer"></p><p data-vmark="487e">一般所言的扩散，是反复在图像中添加小的、随机的噪声。而扩散模型则与这个过程相反 —— 将噪声生成高清图像。训练的神经网络通常为 U-net。</p><p data-vmark="f427" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/9/6b3f9806-d6c6-4bb7-80d4-bbccf7ee2e4e.png" w="1080" h="659" title="可生成高清视频的 Stable Diffusion 来了！分辨率提升 4 倍，超分算法来自腾讯，支持 Colab 在线试玩" width="1080" height="500" referrerpolicy="no-referrer"></p><p data-vmark="89e1">不过因为模型是直接在像素空间运行，导致扩散模型的训练、计算成本十分昂贵。</p><p data-vmark="af4b">基于这样的背景下，Stable Diffusion 主要分两步进行。</p><p data-vmark="e8f1" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/9/7520075e-f09b-45c9-af5f-71014b7fb4d4.png" w="662" h="342" title="可生成高清视频的 Stable Diffusion 来了！分辨率提升 4 倍，超分算法来自腾讯，支持 Colab 在线试玩" width="662" height="342" referrerpolicy="no-referrer"></p><p data-vmark="cf77">首先，使用编码器将图像 x 压缩为较低维的潜在空间表示 z（x）。</p><p data-vmark="e7eb">其中上下文（Context）y，即输入的文本提示，用来指导 x 的去噪。</p><p data-vmark="7ace" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/9/b167320a-2baa-465d-a57d-461bc7ac14bf.jpg@s_2,w_820,h_434" w="1080" h="572" title="可生成高清视频的 Stable Diffusion 来了！分辨率提升 4 倍，超分算法来自腾讯，支持 Colab 在线试玩" srcset="https://img.ithome.com/newsuploadfiles/2022/9/b167320a-2baa-465d-a57d-461bc7ac14bf.jpg 2x" width="1080" height="434" referrerpolicy="no-referrer"></p><p data-vmark="b955">它与时间步长 t 一起，以简单连接和交叉两种方式，注入到潜在空间表示中去。</p><p data-vmark="9d61">随后在 z（x）基础上进行扩散与去噪。换言之，就是模型并不直接在图像上进行计算，从而减少了训练时间、效果更好。</p><p data-vmark="fdde">再来看超分辨率部分。</p><p data-vmark="6a97">用到的方法是腾讯 ARC 实验室此前开发的 <strong>Real-ESRGAN</strong>，被 ICCV 2021 接收。</p><p data-vmark="6a1e" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/9/86fe3f18-0ad8-46bc-bb9d-a757cda012c3.png" w="1080" h="197" title="可生成高清视频的 Stable Diffusion 来了！分辨率提升 4 倍，超分算法来自腾讯，支持 Colab 在线试玩" width="1080" height="150" referrerpolicy="no-referrer"></p><p data-vmark="2d47">它可以更有效地消除低分辩率图像中的<strong>振铃和 overshoot 伪影</strong>；</p><p data-vmark="7f57">面对真实风景图片，能更逼真地恢复细节，比如树枝、岩石、砖块等。</p><p data-vmark="b16f" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/9/41994c4c-053d-4191-a331-b60b21011cd1.png" w="1056" h="404" title="可生成高清视频的 Stable Diffusion 来了！分辨率提升 4 倍，超分算法来自腾讯，支持 Colab 在线试玩" width="1056" height="314" referrerpolicy="no-referrer"></p><p data-vmark="7ee3">原理方面，研究人员引出了<strong>高阶退化过程</strong>来模拟出更真实全面的退化，它包含多个重复的经典退化过程，每个又具有不同的退化超参：</p><p data-vmark="39fc" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/9/28497560-2a58-47a7-abda-b9ef2b353819.png" w="660" h="88" title="可生成高清视频的 Stable Diffusion 来了！分辨率提升 4 倍，超分算法来自腾讯，支持 Colab 在线试玩" width="660" height="88" referrerpolicy="no-referrer"></p><p data-vmark="dff0">下图为 Real-ESRGAN 进行退化模拟的示意图：</p><p data-vmark="af2b" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/9/36257117-424d-4698-9ef4-1c402218a5b2.png" w="1080" h="360" title="可生成高清视频的 Stable Diffusion 来了！分辨率提升 4 倍，超分算法来自腾讯，支持 Colab 在线试玩" width="1080" height="273" referrerpolicy="no-referrer"></p><p data-vmark="51d1">采用的是<strong>二阶退化</strong>，具体可分为在模糊（blur）、降噪（noise）、resize、JPGE 压缩几个方面。</p><p data-vmark="efb7">到训练环节，Real-ESRGAN 的生成器用的是 RRDBNet，还扩展了原始的 ×4 ESRGAN 架构，以执行 resize 比例因子为 ×2 和 ×1 的超分辨率放大。</p><p data-vmark="33ee" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/9/3e83c1ff-3c67-43a3-a950-f7c92901f719.png" w="1080" h="263" title="可生成高清视频的 Stable Diffusion 来了！分辨率提升 4 倍，超分算法来自腾讯，支持 Colab 在线试玩" width="1080" height="200" referrerpolicy="no-referrer"></p><p data-vmark="99bb">想要单独使用这种超分算法也不是问题。</p><p data-vmark="d7ae">在 GitHub 上下载该模型的可执行文件，Windows / Linux / MacOS 都可以，且不需要 CUDA 或 PyTorch 的支持。</p><p data-vmark="08a5" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/9/4b8f48fe-e620-4225-b4da-760ba57a3dab.png" w="1080" h="186" title="可生成高清视频的 Stable Diffusion 来了！分辨率提升 4 倍，超分算法来自腾讯，支持 Colab 在线试玩" width="1080" height="141" referrerpolicy="no-referrer"></p><p data-vmark="13eb">下好以后只需在终端执行以下命令即可使用：</p><p data-vmark="5af2">./realesrgan-ncnn-vulkan.exe -i input.jpg -o output.png</p><p data-vmark="c650">值得一提的是，Real-ESRGAN 的一作 <strong>Wang Xintao</strong> 是图像 / 视频超分辨率领域的知名学者。</p><p data-vmark="7c95">他本科毕业于浙江大学本科，香港中文大学博士（师从汤晓鸥），现在是腾讯 ARC 实验室（深圳应用研究中心）的研究员。</p><p data-vmark="4771">此前曾登顶 GitHub 热榜的项目 GFPGAN 也是他的代表作。</p><p data-vmark="8d5f" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/9/77066fcc-b2ba-4857-8a7d-094d666bc9df.png" w="384" h="376" title="可生成高清视频的 Stable Diffusion 来了！分辨率提升 4 倍，超分算法来自腾讯，支持 Colab 在线试玩" width="384" height="376" referrerpolicy="no-referrer"></p><h2 data-vmark="4b6e">One More Thing</h2><p data-vmark="b300">前两天，大谷老师也发布了用 Stable Diffusion 生成了一组少女人像，效果非常奈斯。</p><p data-vmark="7919" style="text-align: center;"><img src="https://cors.zfour.workers.dev/?http://ss1.sinaimg.cn/large/95e190b7ly1h6bscv7nnog20hs09su10.gif" w="640" h="352" class="lazy" title="可生成高清视频的 Stable Diffusion 来了！分辨率提升 4 倍，超分算法来自腾讯，支持 Colab 在线试玩" referrerpolicy="no-referrer" width="640" height="352"></p><p data-vmark="ec1d">顺带让我们都完成了一下“阅女无数”的成就（doge）。</p><p data-vmark="e2b3" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/9/e45d0853-98be-459e-8ab0-79fbb4e278d2.png" w="512" h="178" title="可生成高清视频的 Stable Diffusion 来了！分辨率提升 4 倍，超分算法来自腾讯，支持 Colab 在线试玩" width="512" height="178" referrerpolicy="no-referrer"></p><p data-vmark="98d6">Stable Diffusion 还能玩出哪些新花样？你不来试试吗？</p><p data-vmark="4b33">Colab 试玩：</p><p data-vmark="b1c7"><span class="link-text-start-with-http">https://colab.research.google.com/github/nateraw/stable-diffusion-videos/blob/main/stable_diffusion_videos.ipynb</span></p><p data-vmark="a1f9">GitHub 地址：</p><p data-vmark="eeae"><span class="link-text-start-with-http">https://github.com/nateraw/stable-diffusion-videos</span></p><p data-vmark="70bf">Hugging Face 授权：</p><p data-vmark="b91a"><span class="link-text-start-with-http">https://huggingface.co/CompVis/stable-diffusion-v1-4</span></p><p data-vmark="2e09">参考链接：</p><p data-vmark="cc7c">[1]<span class="link-text-start-with-http">https://twitter.com/_nateraw/status/1569315090314444802</span></p><p data-vmark="4d11">[2]<span class="link-text-start-with-http">https://www.bilibili.com/video/BV1yd4y1g7Wz?spm_id_from=333.999.0.0</span></p>
          
</div>
            