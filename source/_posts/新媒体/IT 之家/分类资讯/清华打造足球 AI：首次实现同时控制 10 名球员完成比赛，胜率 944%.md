
---
title: '清华打造足球 AI：首次实现同时控制 10 名球员完成比赛，胜率 94.4%'
categories: 
 - 新媒体
 - IT 之家
 - 分类资讯
headimg: 'https://img.ithome.com/newsuploadfiles/2021/11/5a34d1d7-c252-4597-9bf5-eb21c19728de.gif'
author: IT 之家
comments: false
date: Wed, 10 Nov 2021 05:40:35 GMT
thumbnail: 'https://img.ithome.com/newsuploadfiles/2021/11/5a34d1d7-c252-4597-9bf5-eb21c19728de.gif'
---

<div>   
<p data-vmark="7486">“只见 4 号球员在队友的配合下迅速攻破后防，单刀直入，一脚射门，球，进了！”</p><p data-vmark="428d"><img src="https://img.ithome.com/newsuploadfiles/2021/11/5a34d1d7-c252-4597-9bf5-eb21c19728de.gif" w="1079" h="629" title="清华打造足球 AI：首次实现同时控制 10 名球员完成比赛，胜率 94.4%" width="1079" height="478" referrerpolicy="no-referrer"></p><p data-vmark="bb29">观众朋友们大家好，您现在看到的是谷歌 AI 足球比赛的现场，场上身着黄色球衣的是来自清华大学的 AI 球员。</p><p data-vmark="b365">这届清华 AI 可不一般，他们在艰苦训练之下，不仅有个人能力突出的明星球员，也有世界上最强最紧密的团队合作。</p><p data-vmark="4769">在多项国际比赛中所向披靡，夺得冠军。</p><p data-vmark="1e1e">“Oh，现在 7 号接过队友传来的助攻，临门一脚，球又进了！”</p><p data-vmark="761a"><img src="https://img.ithome.com/newsuploadfiles/2021/11/9e0dbb69-c66c-4c6f-83b9-aff308d8f56f.gif" w="1079" h="575" title="清华打造足球 AI：首次实现同时控制 10 名球员完成比赛，胜率 94.4%" width="1079" height="437" referrerpolicy="no-referrer"></p><p data-vmark="bccf">言归正传，以上其实是清华大学在足球游戏中打造的一个强大的多智能体强化学习 AI——TiKick。</p><p data-vmark="6799">在多项国际赛事中夺得冠军则是指，TiKick 在单智能体控制和多智能体控制上均取得了 SOTA 性能，并且还是<span class="accentTextColor">首次实现同时操控十个球员完成整个足球游戏</span>。</p><p data-vmark="488e">这支强大的 AI 团队是如何训练出来的呢？</p><h2 data-vmark="afa5">从单智能体策略中进化出的多智能体足球 AI</h2><p data-vmark="6697">在此之前，先简单了解一下训练所用的强化学习环境，也就是这个足球游戏：Google Research Football（GRF）。</p><p data-vmark="1358">它由谷歌于 2019 年发布，提供基于物理的 3D 足球模拟，支持所有主要的比赛规则，由智能体操控其中的一名或多名足球运动员与另一方内置 AI 对战。</p><p data-vmark="f5be">在由三千步组成的上下半场比赛中，智能体需要不断决策出移动、传球、射门、盘球、铲球、冲刺等 19 个动作完成进球。</p><p data-vmark="5bd8">在这样的足球游戏环境中进行强化学习难度有二：</p><ul class=" list-paddingleft-2"><li><p data-vmark="797f">一是因为多智能体环境，也就是一共 10 名球员（不含守门员）可供操作，算法需要在如此巨大的动作空间中搜索出合适的动作组合；</p></li><li><p data-vmark="2a5a">二是大家都知道足球比赛中一场进球数极少，算法因此很难频繁获得来自环境的奖励，训练难度也就大幅增大。</p></li></ul><p data-vmark="e45f">而清华大学此次的目标是控制多名球员完成比赛。</p><p data-vmark="c1fd">他们先从 Kaggle 在 2020 年举办的 GRF 世界锦标赛中，观摩了最终夺得冠军的 WeKick 团队数万场的自我对弈数据，使用离线强化学习方法从中学习。</p><p data-vmark="32e2">这场锦标赛只需控制场中的一名球员进行对战。</p><p data-vmark="53e2"><img src="https://img.ithome.com/newsuploadfiles/2021/11/f1616120-1199-40ff-a0fe-225597ad7c0b.png" w="1080" h="677" title="清华打造足球 AI：首次实现同时控制 10 名球员完成比赛，胜率 94.4%" width="1080" height="514" referrerpolicy="no-referrer"></p><p data-vmark="ecf1">如何从单智能体数据集学习出多智能体策略呢？</p><p data-vmark="d53a">直接学习 WeKick 中的单智能体操作并复制到每个球员身上显然不可取，因为这样大家都只会自顾自地去抢球往球门冲，根本就不会有团队配合。</p><p data-vmark="0f3b">又没有后场非活跃球员动作的数据，那怎么办？</p><p data-vmark="8638"><span class="accentTextColor">他们在动作集内添加了第二十个动作：build-in</span>，并赋予所有非活跃球员此标签 (比赛中若选用 build-in 作为球员的动作，球员会根据内置规则采取行动)。</p><p data-vmark="43a1">接着采用多智能体行为克隆 (MABC) 算法训练模型。</p><p data-vmark="2206">对于离线强化学习来说，最核心的思想是找出数据中质量较高的动作，并加强对这些动作的学习。</p><p data-vmark="85f7">所以需在计算目标函数时赋予每个标签不同的权重，防止球员倾向于只采用某个动作作为行动。</p><p data-vmark="b20e">这里的权重分配有两点考虑：</p><ul class=" list-paddingleft-2"><li><p data-vmark="6758">一是从数据集中挑选出进球数较多的比赛、只利用这些高质量的数据来训练，由于奖励较为密集，模型能够加速收敛并提高性能。</p></li><li><p data-vmark="b7df">二是训练出 Critic 网络给所有动作打分，并利用其结果计算出优势函数，然后给予优势函数值大的动作较高的权重，反之给予较低的权重。</p></li></ul><p data-vmark="855f">此处为了避免梯度爆炸与消失，对优势函数做出了适当的裁剪。</p><p data-vmark="d81e">最终的分布式训练架构<span class="accentTextColor">由一个 Learner 与多个 Worker 构成</span>。</p><p data-vmark="63fe">其中 Learner 负责学习并更新策略，而 Worker 负责搜集数据，它们通过 gRPC 进行数据、网络参数的交换与共享。</p><p data-vmark="2606"><img src="https://img.ithome.com/newsuploadfiles/2021/11/3ca4b312-ca57-4273-975c-8bf72586ae3a.png" w="1080" h="320" title="清华打造足球 AI：首次实现同时控制 10 名球员完成比赛，胜率 94.4%" width="1080" height="243" referrerpolicy="no-referrer"></p><p data-vmark="de46">Worker 可以利用多进程的方式同时与多个游戏环境进行交互，或是通过 I/O 同步读取离线数据。</p><p data-vmark="9814">这种并行化的执行方式，也就大幅提升了数据搜集的速度，从而提升训练速度 （5 小时就能达到别的分布式训练算法两天才能达到的同等性能）。</p><p data-vmark="e8bb">另外，通过模块化设计，该框架还能在不修改任何代码的情况下，一键切换单节点调试模式和多节点分布式训练模式，大大降低算法实现和训练的难度。</p><h2 data-vmark="d99a">94.4% 的获胜率和场均 3 分的净胜分</h2><p data-vmark="9e51">在多智能体（GRF）游戏上的不同算法比较结果中，TiKick 的最终算法（+AW）以最高的获胜率（94.4%）和最大的目标差异达到了最佳性能。</p><p data-vmark="5b83">TrueSkill（机器学习中竞技类游戏的排名系统）得分也是第一。</p><p data-vmark="926c"><img src="https://img.ithome.com/newsuploadfiles/2021/11/bd785260-6091-4e36-b6a9-5b951bb29ebc.png" w="1080" h="170" title="清华打造足球 AI：首次实现同时控制 10 名球员完成比赛，胜率 94.4%" width="1080" height="129" referrerpolicy="no-referrer"></p><p data-vmark="466a"><span class="accentTextColor">TiKick 与内置 AI 的对战分别达到了 94.4% 的胜率和场均 3 分的净胜分</span>。</p><p data-vmark="1b77"><img src="https://img.ithome.com/newsuploadfiles/2021/11/b592bccf-fb74-4169-aba4-b9b2e67513e0.png" w="748" h="548" title="清华打造足球 AI：首次实现同时控制 10 名球员完成比赛，胜率 94.4%" width="748" height="548" referrerpolicy="no-referrer"></p><p data-vmark="05f4">将 TiKick 与 GRF 学术场景中的基线算法进行横向比较后发现，TiKick 在所有场景下都达到了最佳性能和最低的样本复杂度，且差距明显。</p><p data-vmark="4e2f"><img src="https://img.ithome.com/newsuploadfiles/2021/11/18c3490b-501d-4c9b-ab32-e4c6015cf08d.png" w="1080" h="207" title="清华打造足球 AI：首次实现同时控制 10 名球员完成比赛，胜率 94.4%" width="1080" height="157" referrerpolicy="no-referrer"></p><p data-vmark="e0dc">与其中的基线 MAPPO 相比还发现，在五个场景当中的四个场景都只需 100 万步就能达到最高分数。</p><p data-vmark="d2a5"><img src="https://img.ithome.com/newsuploadfiles/2021/11/f0adfb3a-72f7-4e2a-b9c4-18fae38ee5bc.png" w="1080" h="276" title="清华打造足球 AI：首次实现同时控制 10 名球员完成比赛，胜率 94.4%" width="1080" height="210" referrerpolicy="no-referrer"></p><h2 data-vmark="0f36">作者介绍</h2><p data-vmark="6844">一作黄世宇，清华大学博士生，研究方向为计算机视觉、强化学习和深度学习的交叉领域。曾在华为诺亚方舟实验室、腾讯 AI、卡内基梅隆大学和商汤工作。</p><p data-vmark="534a">共同一作也是来自清华大学的陈文泽。</p><p data-vmark="10ae">此外，作者还包括来自国防科技大学的 Longfei Zhang、腾讯 AI 实验室的 Li Ziyang 、Zhu Fengming 、Ye Deheng、以及清华大学的 Chen Ting。</p><p data-vmark="0f72">通讯作者为清华大学的朱军教授。</p><p data-vmark="cf62"><strong>论文地址：</strong></p><p data-vmark="dec5"><span class="link-text-start-with-http">https://arxiv.org/abs/2110.04507</span></p><p data-vmark="3d21"><strong>项目地址：</strong></p><p data-vmark="b8e6"><span class="link-text-start-with-http">https://github.com/TARTRL/TiKick</span></p><p data-vmark="d4ee"><strong>参考链接：</strong></p><p data-vmark="d09c"><span class="link-text-start-with-http">https://zhuanlan.zhihu.com/p/421572915</span></p>
          
</div>
            