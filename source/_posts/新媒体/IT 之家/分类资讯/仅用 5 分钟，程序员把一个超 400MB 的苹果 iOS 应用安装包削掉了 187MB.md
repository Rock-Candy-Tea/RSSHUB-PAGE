
---
title: '仅用 5 分钟，程序员把一个超 400MB 的苹果 iOS 应用安装包削掉了 187MB'
categories: 
 - 新媒体
 - IT 之家
 - 分类资讯
headimg: 'https://img.ithome.com/newsuploadfiles/2022/2/12fe674c-ae6a-4ee9-92da-c6f6d5f59366.png'
author: IT 之家
comments: false
date: Sat, 26 Feb 2022 04:23:52 GMT
thumbnail: 'https://img.ithome.com/newsuploadfiles/2022/2/12fe674c-ae6a-4ee9-92da-c6f6d5f59366.png'
---

<div>   
<p data-vmark="b5d8">前些日子，一个手机 QQ 安装包就要快 900MB 的事儿在网上吵得沸沸扬扬。</p><p data-vmark="4f66" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/2/12fe674c-ae6a-4ee9-92da-c6f6d5f59366.png" w="828" h="847" alt="最新安装包又大了，已经 924MB" title="仅用 5 分钟，程序员把一个超 400MB 的苹果 iOS 应用安装包削掉了 187MB" width="828" height="839" referrerpolicy="no-referrer"></p><p data-vmark="8e15" style="text-align: center;">△ 最新安装包又大了，已经 924MB</p><p data-vmark="e237">虽然最后大家发现它主要为了视频通话特效多了一个虚幻引擎，但网友还是感叹：</p><blockquote><p data-vmark="ffa1">现在的 App 真的是越来越大了。</p></blockquote><p data-vmark="e082" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/2/32541bad-eadf-4671-bc6f-3288e840ba1e.png" w="504" h="500" alt title="仅用 5 分钟，程序员把一个超 400MB 的苹果 iOS 应用安装包削掉了 187MB" width="504" height="500" referrerpolicy="no-referrer"></p><p data-vmark="c3ea">而就在最近，国外一位程序员也遇到了同样的困惑。他乘的一班飞机由于没有机上小电视，只能下载一个叫做“美联航”的 App 来看视频打发时间。</p><p data-vmark="4503">小哥一边感叹现在航空公司越来越鸡贼：把成本都加到顾客头上，一边打开了应用商店，结果就很诧异：不就用来看个电影啥的吗，<span class="accentTextColor">一个 Netflix 都只有 101.5MB，这 App 怎么是它的四倍</span>？</p><p data-vmark="b5ab" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/2/553fdec7-449b-4019-bde9-6c36ae8d8208.png" w="370" h="800" alt="美联航 App" title="仅用 5 分钟，程序员把一个超 400MB 的苹果 iOS 应用安装包削掉了 187MB" width="370" height="800" referrerpolicy="no-referrer"></p><p data-vmark="86be">作为一名 iOS / <a class="s_tag" href="https://android.ithome.com/" target="_blank">Android</a> 开发工程师，小哥决定不“坐以待毙”，看看它是否真的需要这么大的空间。</p><h2 data-vmark="4d8b">原来可以省掉 187MB</h2><p data-vmark="e49a">说干就干，还在飞机上的小哥立刻用 ipatool 下载了这个 App 的二进制文件。</p><p data-vmark="5eb6">ipatool 是 GitHub 上标星 1.4k 的开源项目，是一个命令行工具，<span class="accentTextColor">可以从 iOS 应用商店搜索和下载应用程序的 ipa 文件包</span>，用这个包可以进行开发内容的一些检查等功能。</p><p data-vmark="d7dc" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/2/465b1803-bae4-43b7-9b56-0e0260b7db43.png" w="1080" h="758" alt="ipatool" title="仅用 5 分钟，程序员把一个超 400MB 的苹果 iOS 应用安装包削掉了 187MB" width="1080" height="576" referrerpolicy="no-referrer"></p><p data-vmark="608d">下好以后需要把 ipa 扩展名改为 zip，解压之后可以看到下面这样的目录：</p><p data-vmark="4c92" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/2/ca96f2cd-b30d-44a5-bf9a-9c5fa62ad326.png" w="1080" h="768" alt="应用目录" title="仅用 5 分钟，程序员把一个超 400MB 的苹果 iOS 应用安装包削掉了 187MB" width="1080" height="583" referrerpolicy="no-referrer"></p><p data-vmark="b1f9"><span class="accentTextColor">可以发现 Frameworks 就占了 414.8MB</span>，小哥解释：应用程序的主要内存来源就是 Frameworks，现在的最佳实践都是把代码 push 到这里面，还是挺正常的。</p><p data-vmark="b9aa">接下来进入该目录：</p><p data-vmark="6b1b" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/2/a74ddc85-f0af-4e4f-9b6e-6beff8a44cb4.png" w="1080" h="824" alt="进入该目录" title="仅用 5 分钟，程序员把一个超 400MB 的苹果 iOS 应用安装包削掉了 187MB" width="1080" height="626" referrerpolicy="no-referrer"></p><p data-vmark="7cb4">以 UAL 开头的框架是核心架构、NodeMobile 框架跟 NodeJS 功能有关、LocusLabsSDK 和 Mapbox 是供应地图的，还有一些是负责身份验证、客户反馈的……</p><p data-vmark="e677">而视频播放相关的框架相反其实占内存并不多：</p><p data-vmark="84a6" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/2/9719dec3-9b01-49d5-b275-3b2242aed328.png" w="1080" h="693" alt="视频播放相关的框架相反其实占内存并不多" title="仅用 5 分钟，程序员把一个超 400MB 的苹果 iOS 应用安装包削掉了 187MB" width="1080" height="526" referrerpolicy="no-referrer"></p><p data-vmark="64d6">接着进入占空间最大的 UALAppCore.framework。</p><p data-vmark="d3eb">经过层层探索，小哥终于在这里<span class="accentTextColor">锁定了最大占存的 UALAppCore</span>。</p><p data-vmark="9677" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/2/1772491d-59a5-44d3-a4dc-432fc78c566d.png" w="1080" h="525" alt="最大占存的 UALAppCore" title="仅用 5 分钟，程序员把一个超 400MB 的苹果 iOS 应用安装包削掉了 187MB" width="1080" height="399" referrerpolicy="no-referrer"></p><p data-vmark="4bc8">按照他的工作经验，77MB 这个数字还是有点反常的，他打算用 nm 命令深入看看这个框架的符号表（symbol）文件（nm 用于显示二进制目标文件的符号表，格式如下）。</p><p data-vmark="a555" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/2/9feb9c86-84d8-4e44-bf0a-aee679fa9e90.png" w="1080" h="433" alt="用 nm 命令查看框架符号表（symbol）文件" title="仅用 5 分钟，程序员把一个超 400MB 的苹果 iOS 应用安装包削掉了 187MB" width="1080" height="329" referrerpolicy="no-referrer"></p><p data-vmark="52a4">很快他就想起来，Swift 的符号需要剥离（strip，iOS 框架中的术语），Objective-C 则不需要。那就查 Swift 的，结果还真就发现：<span class="accentTextColor">没有一个 Swift 框架的符号被剥离过</span>。而这些都没有用，白白耗内存：</p><p data-vmark="7229" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/2/04d0717c-be2b-4c01-84dc-07b4eb0c55da.png" w="1080" h="275" alt="没有一个 Swift 框架的符号被剥离过" title="仅用 5 分钟，程序员把一个超 400MB 的苹果 iOS 应用安装包削掉了 187MB" width="1080" height="209" referrerpolicy="no-referrer"></p><p data-vmark="a11d">那接下来就简单了，写一个 bash 脚本运行一下该框架就可以 OK：</p><p data-vmark="d712" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/2/ca8d1802-e226-41f7-aaa9-61850f3dbe35.png" w="1080" h="670" alt="通过 bash 脚本运行一下该框架" title="仅用 5 分钟，程序员把一个超 400MB 的苹果 iOS 应用安装包削掉了 187MB" width="1080" height="509" referrerpolicy="no-referrer"></p><p data-vmark="5e93">最后，可以看到原始框架从 350MB 减到了 163M！</p><p data-vmark="a7d1" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/2/0bd02f23-3005-4ecc-9904-d576c0d52fe5.png" w="978" h="198" alt="原始框架从 350MB 减到了 163M" title="仅用 5 分钟，程序员把一个超 400MB 的苹果 iOS 应用安装包削掉了 187MB" width="978" height="166" referrerpolicy="no-referrer"></p><p data-vmark="c234">小哥表示，<span class="accentTextColor">这一顿操作只花了不到 5 分钟</span>，没想到可削减空间这么大，整整省掉了 187MB。等于现在的安装包只有原来的不到 60% 了。他猜测该安装包仍有削减空间，不过这个结果他已经很满意了。你，学废了吗？</p><h2 data-vmark="f038">“开发商才不关心呢”</h2><p data-vmark="5226">就在小哥发出这个博客之后，有网友评论道，还有<span class="accentTextColor">很多安装包其实都可以再缩减 15% 到 30% 甚至更高的空间</span>，就比如 Gmail、Outlook 这些很常见的应用。</p><p data-vmark="af6a">但似乎现在很多开发商不是很关心这个问题，他们只想赶紧不停更新应用：给不给用户省掉这几百 M 的流量都一样赚钱，为啥还要费功夫呢？</p><p data-vmark="03eb" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/2/732efe85-017b-4835-b9b3-4fed32913ad0.png" w="1080" h="99" alt="网友评论" title="仅用 5 分钟，程序员把一个超 400MB 的苹果 iOS 应用安装包削掉了 187MB" width="1080" height="75" referrerpolicy="no-referrer"></p><p data-vmark="28d4">有一位嵌入式工程师就表示：当我跟同事提起要注意这方面的优化时，他们总是给我一个茫然的眼神。</p><p data-vmark="dd81">有网友认为：除非各应用商店开始管这事儿，开发商是不会做出改变的。就单说手机厂商就很乐意看到这一场面，内存不够就可以去他们那买新手机了。</p><p data-vmark="86fc" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/2/b6998071-8a79-4455-8bb3-428bc1d83d99.png" w="1080" h="111" alt="网友评论" title="仅用 5 分钟，程序员把一个超 400MB 的苹果 iOS 应用安装包削掉了 187MB" width="1080" height="84" referrerpolicy="no-referrer"></p><p data-vmark="cdb4">他还发现谷歌 Play Store 好像就不显示应用程序大小。而一些银行 App 在这个问题上尤其严重，因为他们知道你不会轻易换银行。你怎么看？</p><p data-vmark="1821">原博链接：</p><p data-vmark="b9dd"><span class="link-text-start-with-http">https://telkins.dev/posts/how-i-shaved-187mb-off-uniteds-airlines-439mb-ios-app/</span></p><p data-vmark="7d92">评论来自：</p><p data-vmark="6cfc"><span class="link-text-start-with-http">https://news.ycombinator.com/item?id=30442529&amp</span>;amp;amp;p=2</p>
          
</div>
            