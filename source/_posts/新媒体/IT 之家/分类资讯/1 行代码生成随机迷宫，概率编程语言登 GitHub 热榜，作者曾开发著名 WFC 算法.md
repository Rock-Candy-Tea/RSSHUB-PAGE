
---
title: '1 行代码生成随机迷宫，概率编程语言登 GitHub 热榜，作者曾开发著名 WFC 算法'
categories: 
 - 新媒体
 - IT 之家
 - 分类资讯
headimg: 'https://img.ithome.com/newsuploadfiles/2022/6/853ecd36-e04a-4f46-8be1-dc43bd325717.gif'
author: IT 之家
comments: false
date: Tue, 07 Jun 2022 00:08:34 GMT
thumbnail: 'https://img.ithome.com/newsuploadfiles/2022/6/853ecd36-e04a-4f46-8be1-dc43bd325717.gif'
---

<div>   
<p data-vmark="4ce1">探索游戏中的迷宫很有趣，然而玩多了就没啥“新鲜感”了？</p><p data-vmark="1af3">没错，如果游戏迷宫差别不大，时间一久就容易熟悉地图，降低了探索的乐趣。</p><p data-vmark="38cd">现在，一个“横空出现”的概率编程语言 <span class="accentTextColor">MarkovJunior</span> 解决了这一问题：</p><p data-vmark="c036">利用马尔科夫算法，<span class="accentTextColor">随机生成批量迷宫</span>，没有一个是重复的，你永远也不知道玩到的下一个迷宫长什么样子：</p><p data-vmark="79cb" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/6/853ecd36-e04a-4f46-8be1-dc43bd325717.gif" w="189" h="189" title="1 行代码生成随机迷宫，概率编程语言登 GitHub 热榜，作者曾开发著名 WFC 算法" width="189" height="189" referrerpolicy="no-referrer"></p><p data-vmark="2bc2">不仅是 2D 迷宫，就连需要搭建好几层地图的 3D 迷宫，也能随机生成：</p><p data-vmark="a3eb" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/6/ed4a2265-8178-4810-87c5-0185dd45f6b4.gif" w="480" h="393" title="1 行代码生成随机迷宫，概率编程语言登 GitHub 热榜，作者曾开发著名 WFC 算法" width="480" height="393" referrerpolicy="no-referrer"></p><p data-vmark="8993">这个项目一出，立刻上了 GitHub 热榜，<span class="accentTextColor">不到一周就已经收获 2.6k Star</span>。</p><p data-vmark="f3aa" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/6/4e4e2375-91d7-4d55-a673-68aae144af2b.png" w="1080" h="210" title="1 行代码生成随机迷宫，概率编程语言登 GitHub 热榜，作者曾开发著名 WFC 算法" width="1080" height="159" referrerpolicy="no-referrer"></p><p data-vmark="24d2">有网友感叹，用这个编程语言就能直接给 RPG 游戏或动作游戏生成建筑了。</p><p data-vmark="cbd7" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/6/19fe3e65-ccc9-4e6f-830e-d5372ef6d20e.png" w="1080" h="244" title="1 行代码生成随机迷宫，概率编程语言登 GitHub 热榜，作者曾开发著名 WFC 算法" width="1080" height="185" referrerpolicy="no-referrer"></p><p data-vmark="d8eb">Keras 的作者也对这个概率编程语言挺感兴趣：</p><p data-vmark="1dd8" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/6/e6750b32-0386-46ad-971e-18f04e7e0f81.png" w="1080" h="416" title="1 行代码生成随机迷宫，概率编程语言登 GitHub 热榜，作者曾开发著名 WFC 算法" width="1080" height="316" referrerpolicy="no-referrer"></p><p data-vmark="bf00">来看看它的原理究竟是什么、又是如何随机生成各种迷宫的。</p><h2 data-vmark="cb76">基于马尔科夫算法构造</h2><p data-vmark="6611">据作者介绍，这套概率编程语言借鉴了<span class="accentTextColor">马尔科夫算法</span>（Markov algorithms）。</p><p data-vmark="607d">（MarkovJunior 这个名字，也是以提出马尔科夫算法的数学家 Andrey Markov 命名）</p><p data-vmark="6961">具体来说，这套概率编程语言由一系列特定规则（Rewrite Rules，重写规则）组成，是一个有序列表。</p><p data-vmark="4ff3">它在生成一个（迷宫）模型的过程中，会利用马尔科夫算法实现“<span class="accentTextColor">随机生成</span>”，再通过制定一系列特定规则，决定生成模型的类别，例如是迷宫、地形图，还是电路图等。</p><blockquote><p data-vmark="1542">马尔科夫链具有“无记忆”性质，即下一状态的概率分布只能由当前状态决定，在时间序列中它前面的事件均与之无关。</p></blockquote><p data-vmark="551a">所以，这些特定规则究竟长啥样？</p><p data-vmark="ad55">例如，一个最简单的规则，就是将“黑色”色块重写为“白色”色块，直到最终填满整个模型：</p><p data-vmark="eeb9" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/6/267e2a5f-e576-4a91-8423-25c9a8850967.gif" w="189" h="189" title="1 行代码生成随机迷宫，概率编程语言登 GitHub 热榜，作者曾开发著名 WFC 算法" width="189" height="189" referrerpolicy="no-referrer"></p><p data-vmark="0ae9">又例如，执行将“白-黑”色块重写为“白-白”色块的规则，结合马尔科夫算法，就能得到一个概率生成模型：</p><p data-vmark="3fdf" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/6/cfd6a450-95a8-4fdf-afcc-bb79e0164cf8.gif" w="264" h="260" title="1 行代码生成随机迷宫，概率编程语言登 GitHub 热榜，作者曾开发著名 WFC 算法" width="264" height="260" referrerpolicy="no-referrer"></p><p data-vmark="490c">再例如，基于“推箱子游戏”的规则，</p><p data-vmark="b920" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/6/7e630614-83ee-473e-8e60-bc565d9d55a1.gif" w="294" h="189" title="1 行代码生成随机迷宫，概率编程语言登 GitHub 热榜，作者曾开发著名 WFC 算法" width="294" height="189" referrerpolicy="no-referrer"></p><p data-vmark="b062">△ 推箱子游戏</p><p data-vmark="2c8e">就能用这批小红点随机将白色方块“搬运”到指定地点：</p><p data-vmark="16db" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/6/e8bac1f2-a84d-4c87-9dcd-329e0676d994.gif" w="832" h="215" title="1 行代码生成随机迷宫，概率编程语言登 GitHub 热榜，作者曾开发著名 WFC 算法" width="832" height="212" referrerpolicy="no-referrer"></p><p data-vmark="8ffe">像这样的特定规则还有很多，都包含在 MarkovJunior 中。</p><p data-vmark="c92d">那么，我们究竟要怎么利用这些规则，来生成一个随机（迷宫、电路图等）模型呢？</p><h2 data-vmark="a06e">2D / 3D 迷宫、地形图和电路图都能画</h2><p data-vmark="92c5">先以随机生成一个 2D 迷宫为例：</p><p data-vmark="f8b3" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/6/e71bca29-32f2-4c75-bd62-5456977c4360.gif" w="644" h="394" title="1 行代码生成随机迷宫，概率编程语言登 GitHub 热榜，作者曾开发著名 WFC 算法" width="644" height="394" referrerpolicy="no-referrer"></p><p data-vmark="4bfc">从图片中来看，这个迷宫算法会自动生成一个“起始点”红点，在一块黑色地图中随机探索并重写路径，最终填满整个地图，完成一个有始有终、也有分岔口的“迷宫”。</p><p data-vmark="a930">这样的随机迷宫，MarkovJunior 随手就能做出一大把，只需要基于两个规则：</p><p data-vmark="6ebf"><span class="accentTextColor">第一个规则</span>，将“红-黑-黑”色块随机重写为“绿-绿-红”色块。</p><p data-vmark="0268" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/6/d8335fcf-8310-48c5-85e4-6a5c36e19c53.png" w="754" h="146" title="1 行代码生成随机迷宫，概率编程语言登 GitHub 热榜，作者曾开发著名 WFC 算法" width="754" height="146" referrerpolicy="no-referrer"></p><p data-vmark="5af0"><span class="accentTextColor">第二个规则</span>，在第一个规则被“卡住”，也就是没有符合条件的可选项时，自动执行将“红-绿-绿”色块随机重写为“白-白-红”色块。</p><p data-vmark="a7ff" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/6/8ff8a5ae-aba3-4e8b-82cd-bbf2496bdeb8.png" w="750" h="134" title="1 行代码生成随机迷宫，概率编程语言登 GitHub 热榜，作者曾开发著名 WFC 算法" width="750" height="134" referrerpolicy="no-referrer"></p><p data-vmark="9bd9">这样一来，算法就能通过第一个规则生成随机路径，并通过第二个规则回溯还没有经过的路径、生成岔路口，最终遍历整个黑色地图，生成一套“2D 迷宫”。</p><p data-vmark="46c2">还有更简单的思路，将所有“白-黑-黑”替换成“白-A-白”，其中 A 是一个中间态，不作为起点，在迷宫生成完成后被替换为白色。</p><p data-vmark="f94f" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/6/a76ae1bd-0b00-4a6c-9051-f7e586e50932.gif" w="538" h="536" title="1 行代码生成随机迷宫，概率编程语言登 GitHub 热榜，作者曾开发著名 WFC 算法" width="538" height="536" referrerpolicy="no-referrer"></p><p data-vmark="07b2">据作者表示，利用这个规则，<span class="accentTextColor">1 行代码</span>就能随机生成 2D 或 3D 迷宫。</p><p data-vmark="4911" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/6/ffa65256-5c8c-49f3-8fba-62f78c23e5a2.png" w="261" h="273" alt="3D 迷宫长这样" title="1 行代码生成随机迷宫，概率编程语言登 GitHub 热榜，作者曾开发著名 WFC 算法" width="261" height="273" referrerpolicy="no-referrer"></p><p data-vmark="3b56">▲ 3D 迷宫长这样</p><p data-vmark="08a8">基于这样的思路，换套规则组合方法，还能生成随机<span class="accentTextColor">地形图</span>。</p><p data-vmark="36f8">例如，试图生成一块河流地形图，就只需要利用上面的生成模型方法，再添加一些其他的重写规则，就能搞出一个随机河流图来：</p><p data-vmark="a8ad" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/6/cb3e31a9-2bd3-4579-981d-4fa1075f7c4a.gif" w="628" h="465" title="1 行代码生成随机迷宫，概率编程语言登 GitHub 热榜，作者曾开发著名 WFC 算法" width="628" height="465" referrerpolicy="no-referrer"></p><p data-vmark="f4cf">除了地形图、简单的 2D / 3D 迷宫，更复杂的 <span class="accentTextColor">3D 建筑</span>也能搞定，只需要在两层 2D“迷宫”之间的随机位置生成一批“楼梯”：</p><p data-vmark="07b5" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/6/877d39a7-f631-4f03-a9d7-ec8ba2242b70.gif" w="574" h="466" title="1 行代码生成随机迷宫，概率编程语言登 GitHub 热榜，作者曾开发著名 WFC 算法" width="574" height="466" referrerpolicy="no-referrer"></p><p data-vmark="ab00">嗯，连<span class="accentTextColor">电路图</span>都能画……</p><p data-vmark="421e" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/6/7aed91a7-931d-404a-9226-211b857d8231.gif" w="593" h="405" title="1 行代码生成随机迷宫，概率编程语言登 GitHub 热榜，作者曾开发著名 WFC 算法" width="593" height="405" referrerpolicy="no-referrer"></p><p data-vmark="00ae">据作者介绍，只要灵活运用这些规则，就能用 MarkovJunior 随机生成各种各样的建筑和图画。</p><p data-vmark="57bf" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/6/1afbc410-0dba-4331-8daf-a3654a94d3e1.png" w="626" h="698" title="1 行代码生成随机迷宫，概率编程语言登 GitHub 热榜，作者曾开发著名 WFC 算法" width="626" height="698" referrerpolicy="no-referrer"></p><p data-vmark="ed78">可以说是非常好用了。</p><h2 data-vmark="db2c">还是著名 WFC 算法的作者</h2><p data-vmark="562b">这个概率编程语言的作者 Maxim Gumin，是一名独立游戏开发者。</p><p data-vmark="e15b" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/6/1fcc374f-f645-4c26-818f-f375ceb2c4c3.png" w="324" h="332" title="1 行代码生成随机迷宫，概率编程语言登 GitHub 热榜，作者曾开发著名 WFC 算法" width="324" height="332" referrerpolicy="no-referrer"></p><p data-vmark="7e42">他搞过最有名的项目，应该是一套叫做“<span class="accentTextColor">波函数坍缩算法</span>”（WaveFunctionCollapse，WFC）的东西，目前在 GitHub 上已经有 <span class="accentTextColor">18.7k Stars</span>。</p><p data-vmark="6a43" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/6/e5f8af97-1da7-4eb3-aea7-d1981eae5efc.png" w="923" h="155" title="1 行代码生成随机迷宫，概率编程语言登 GitHub 热榜，作者曾开发著名 WFC 算法" width="923" height="138" referrerpolicy="no-referrer"></p><p data-vmark="8a87">这套 WFC 算法是他受量子力学中“波函数坍缩”概念的启发自创出来的，目前已经被应用到一些游戏中，如《城镇叠叠乐》（Townscaper）等。</p><p data-vmark="1bf1" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/6/af4bfdaa-ca13-47d9-9ebb-db411b414f19.png" w="908" h="505" title="1 行代码生成随机迷宫，概率编程语言登 GitHub 热榜，作者曾开发著名 WFC 算法" width="908" height="456" referrerpolicy="no-referrer"></p><p data-vmark="db3c">Maxim Gumin 并未透露更多自己的信息，但我们能在他的主页上看到，这位老哥自称“概率模型之王，程序化生成の弥赛亚，驯服马尔科夫链的人……”（手动狗头）</p><p data-vmark="980c" style="text-align: center;"><img src="https://img.ithome.com/newsuploadfiles/2022/6/05122469-e263-44e3-abba-5caf8050dc61.png" w="913" h="422" title="1 行代码生成随机迷宫，概率编程语言登 GitHub 热榜，作者曾开发著名 WFC 算法" width="913" height="379" referrerpolicy="no-referrer"></p><p data-vmark="26c2">从 GitHub 来看，这些年他一直专注于将各种数学算法应用于程序化生成中，做出各种有意思的模型。</p><p data-vmark="b6c1">说不定你玩过的游戏中，有一些已经用过他开发的算法了。</p><p data-vmark="ae80"><strong>项目地址：</strong></p><p data-vmark="2834"><a href="https://github.com/mxgmn/MarkovJunior" target="_blank"><span class="link-text-start-with-http">https://github.com/mxgmn/MarkovJunior</span></a></p>
          
</div>
            