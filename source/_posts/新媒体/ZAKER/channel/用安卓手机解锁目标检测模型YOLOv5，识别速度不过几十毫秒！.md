
---
title: '用安卓手机解锁目标检测模型YOLOv5，识别速度不过几十毫秒！'
categories: 
 - 新媒体
 - ZAKER
 - channel
headimg: 'https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202112/61af0237b15ec04671192683_1024.jpg'
author: ZAKER
comments: false
date: Tue, 07 Dec 2021 01:40:00 GMT
thumbnail: 'https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202112/61af0237b15ec04671192683_1024.jpg'
---

<div>   
<p>现在，目标检测界明星模型 YOLO，最新 v5 版本也可以在手机上玩儿了！</p><p>瞧～只需要<strong>区区几十毫秒</strong>，桌上的东西就全被检测出来了：</p><p></p><div class="img_box" id="id_imagebox_0" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_0" data-original="http://zkres2.myzaker.com/202112/61af0237b15ec04671192683_1024.jpg" data-height="2400" data-width="1080" src="https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202112/61af0237b15ec04671192683_1024.jpg" referrerpolicy="no-referrer"></div></div>这速度似乎不比电脑差？<p></p><p>想要亲手搭建一个？上教程。</p><p>更确切的说是<strong>YOLOv5s</strong>。</p><p>YOLOv5 于 2020 年 5 月发布，最大的特点就是<strong>模型小，速度快</strong>，所以能很好的应用在移动端。</p><p></p><div class="img_box" id="id_imagebox_1" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_1" data-original="http://zkres1.myzaker.com/202112/61af0237b15ec04671192684_1024.jpg" data-height="558" data-width="1080" src="https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202112/61af0237b15ec04671192684_1024.jpg" referrerpolicy="no-referrer"></div></div>而且其实最开始 YOLOv5 就是作为一款对图像进行检测、分类和定位的<strong>iOS 端 APP</strong>进入人们的视野，而且 APP 还是由 YOLOv5 的作者亲自开发。<p></p><p></p><div class="img_box" id="id_imagebox_2" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_2" data-original="http://zkres1.myzaker.com/202112/61af0237b15ec04671192685_1024.jpg" data-height="720" data-width="1080" src="https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202112/61af0237b15ec04671192685_1024.jpg" referrerpolicy="no-referrer"></div></div>现在，想要在安卓设备上部署它，你需配备的环境如下：<p></p><p>主机 Ubuntu18.04</p><p>Docker</p><p> Tensorflow 2.4.0</p><p> PyTorch 1.7.0</p><p> OpenVino 2021.3</p><p>安卓 APP</p><p> Android Studio 4.2.1</p><p> minSdkVersion 28</p><p> targetSdkVersion 29</p><p> TfLite 2.4.0</p><p>安卓设备</p><p> 小米 11 ( 内存 128GB/ RAM 8GB ) </p><p> 操作系统 MUI 12.5.8</p><p>然后直接下载作者在 GitHub 上的项目。</p><p>git clone — recursive https://github.com/lp6m/yolov5s_android</p><p></p><div class="img_box" id="id_imagebox_3" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_3" data-original="http://zkres1.myzaker.com/202112/61af0237b15ec04671192686_1024.jpg" data-height="657" data-width="1080" src="https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202112/61af0237b15ec04671192686_1024.jpg" referrerpolicy="no-referrer"></div></div>使用 Docke 容器进行主机评估（host evaluation）和模型转换。<p></p><p>cd yolov5s_android docker build ./ -f ./docker/Dockerfile -t yolov5s_android docker run -it — gpus all -v pwd:/workspace yolov5s_anrdoid bash</p><p>将 app 文件夹下的 ./tfliteu model/*.tflite 复制到 app/tfliteu yolov5u test/app/src/main/assets/ 目录下，就可在 Android Studio 上构建应用程序。</p><p>构建好的程序可以设置输入图像大小、推断精度和模型精度。</p><p></p><div class="img_box" id="id_imagebox_4" onclick><div class="content_img_div"><img class="lazy opacity_0 zaker_gif_cache" id="img_4" data-original="http://zkres1.myzaker.com/202112/61af0237b15ec04671192687_1024.jpg" data-gif-url="http://zkres1.myzaker.com/202112/61af0237b15ec04671192687_raw.gif" data-height="960" data-width="432" src="https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202112/61af0237b15ec04671192687_1024.jpg" referrerpolicy="no-referrer"></div></div>如果选择其中的 "Open Directory"，检测结果会被保存为 coco 格式的 json 文件。<p></p><p>从摄像头进行实时检测模式已将精度和输入图像大小固定为 int8/320，该模式在小米 11 达到的图像帧数为 15FPS。</p><p>由于本项目是作者参加的一个 "Yolov5s Export" 竞赛（并且最终得了奖，奖金还是 2000 美元），所以他也进行了性能评估。</p><p></p><div class="img_box" id="id_imagebox_5" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_5" data-original="http://zkres1.myzaker.com/202112/61af0237b15ec04671192688_1024.jpg" data-height="474" data-width="1080" src="https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202112/61af0237b15ec04671192688_1024.jpg" referrerpolicy="no-referrer"></div></div><div class="img_box" id="id_imagebox_6" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_6" data-original="http://zkres2.myzaker.com/202112/61af0237b15ec04671192689_1024.jpg" data-height="305" data-width="1080" src="https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202112/61af0237b15ec04671192689_1024.jpg" referrerpolicy="no-referrer"></div></div>评估包括延时和准确度。<p></p><p>延迟时间</p><p>在小米 11 上测得，不包含预处理 / 后处理和数据传输的耗时。</p><p>结果如下：</p><p>不管模型精度是 float32 还是 int8，时间都能控制在 250ms 以内，连半秒的时间都不到。</p><p></p><div class="img_box" id="id_imagebox_7" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_7" data-original="http://zkres2.myzaker.com/202112/61af0237b15ec0467119268a_1024.jpg" data-height="330" data-width="930" src="https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202112/61af0237b15ec0467119268a_1024.jpg" referrerpolicy="no-referrer"></div></div><strong>△</strong> float32<p></p><p></p><div class="img_box" id="id_imagebox_8" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_8" data-original="http://zkres2.myzaker.com/202112/61af0237b15ec0467119268b_1024.jpg" data-height="320" data-width="922" src="https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202112/61af0237b15ec0467119268b_1024.jpg" referrerpolicy="no-referrer"></div></div><strong>△</strong> int8<p></p><p>大家可以和 YOLOv5 在电脑上的性能对比：</p><p></p><div class="img_box" id="id_imagebox_9" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_9" data-original="http://zkres2.myzaker.com/202112/61af0237b15ec0467119268c_1024.jpg" data-height="709" data-width="1080" src="https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202112/61af0237b15ec0467119268c_1024.jpg" referrerpolicy="no-referrer"></div></div>准确度<p></p><p>各种模式下的 mAP ( mean Average Precision ) 值最高为 28.5，最低也有 25.5。</p><p></p><div class="img_box" id="id_imagebox_10" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_10" data-original="http://zkres1.myzaker.com/202112/61af0237b15ec0467119268d_1024.jpg" data-height="367" data-width="1080" src="https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202112/61af0237b15ec0467119268d_1024.jpg" referrerpolicy="no-referrer"></div></div><p></p><div id="recommend_bottom"></div><div id="article_bottom"></div>  
</div>
            