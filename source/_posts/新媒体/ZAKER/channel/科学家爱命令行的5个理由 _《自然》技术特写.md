
---
title: '科学家爱命令行的5个理由 _《自然》技术特写'
categories: 
 - 新媒体
 - ZAKER
 - channel
headimg: 'https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202108/612b1be1b15ec052ce2e059d_1024.jpg'
author: ZAKER
comments: false
date: Sat, 28 Aug 2021 22:06:59 GMT
thumbnail: 'https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202108/612b1be1b15ec052ce2e059d_1024.jpg'
---

<div>   
<p>原文作者：Jeffrey M. Perkel</p><p><strong>命令行界面看起来有点吓人，但能省下好多繁杂的计算任务。只要知道自己在做什么。</strong></p><p>Jennifer Johnson 的 PI 给了她一个简单的任务。2018 年起，他们的团队给 1300 只赤狐（Vulpes vulpes）的 DNA 进行了测序，实验室负责人想知道他们到底收集了多少碱基，以及这些碱基和参考基因组有多匹配。</p><p>Johnson 是伊利诺伊大学厄巴纳 - 香槟分校的生物信息学家，她手上有所需的数据，但是这些数据分散在她硬盘各处。最简单的解决方法也是最繁琐的：打开每个文件，找到所需信息，关掉文件，如此重复 1300 次。<strong>因此 Johnson 用了另外一个方法，那就是使用命令行。</strong></p><p></p><div class="img_box" id="id_imagebox_0" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_0" data-original="http://zkres2.myzaker.com/202108/612b1be1b15ec052ce2e059d_1024.jpg" data-height="725" data-width="1080" src="https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202108/612b1be1b15ec052ce2e059d_1024.jpg" referrerpolicy="no-referrer"></div></div>Illustration by The Project Twins<p></p><p>命令行也叫 shell，是一个基于文本界面的强大工具，用户可以通过简单的指令创造，查找，分类或操作文件，在这个过程中并不需要使用鼠标。macOS 和 Unix 系统自带命令行，Windows 系统的话，也可以通过一些免费工具，比如 Windows Subsystem for Linux 和 MobaXterm 调用。目前有好几个不同的 shell 系统（大多数是兼容的），其中最受欢迎的是 Bash，它是 Bourne again shell 的简称，也是对它在 1989 年替代的 Bourne shell 系统的致敬。</p><p>Bash 是由一系列小工具集构成的，它使用的编程语言已经很成熟，其中包括 grep（文本搜索工具），和 for loops（对多个文件进行重复操作）。Johnson 让计算机终端扫描硬盘，查找测序文件，从中提取所需的信息，然后把它们编译到一个整洁的表格里。她说：" 整个过程花了我 10 分钟不到。" 重计算这些数据原本会花去整整一天。</p><p>许多涉及计算的学科（比如生物信息）严重依赖命令行。不过，Jeroen Janssens 说，命令行能惠及所有研究者，他是荷兰 Data Science Workshops 的主要讲师，2014 年出版的 Data Science at the Command Line 一书的作者。" 鼠标无法进行批量操作 "，他说。比如，给一个文件改名称只需要点击就好，但是要给成千上万的文件改名称的话，这么做就太累人了。</p><p>在此我们给大家介绍 5 种命令行操作方式，它们可以让你的计算研究变得更简单。</p><p><strong>文件整理</strong></p><p>Shell 中最强大的功能，大概就是可以对多个文件执行重复的简单操作。比如，研究人员可以系统化地给文件重命名，在文件名中添加时间戳，或者把文件转成另一个格式。（你可以到 https://github.com/jperkel/nature_bash 看我们的代码例子）</p><p>在做博士后研究时，Casey Greene 的导师要求汇报中所有的图表都要用黑色背景。Greene 说自己挺擅长打开图像编辑器、修改背景颜色，然后重复再重复。</p><p>"<strong>但某一刻我意识到，就算用相对好用的免费软件，人生不是用来做这种事的：持续不断地输入图片、更改背景颜色。</strong>" Greene 说，他现在已经是科罗拉多大学医学院健康人工智能中心主任。因此，他开始使开源的图像处理工具 ImageMagick，用 for loop 对所有文件进行了同样的操作：</p><p><strong>for file in *.png; do convert $file -channel RGB -negate -modulate 100,100,200 out_$file; done;</strong></p><p><strong>处理大量数据</strong></p><p>有些数据集就是太大了。伊利诺伊大学厄巴纳 - 香槟分校的信息科学家 Elizabeth Wickes 在处理一个数字对象标识符（DOI）的研究项目时，她收集了数百万 XML 文件。但是把这些文件整合到一个版本控制库，让她的计算机系统过载了，"GitHub Desktop 客户端和我的系统索引当机了。" 但是，使用命令行的 "git" 工具后，她在一个半小时里就顺利解决了问题。</p><p>得克萨斯农工大学的演化生物学家 Lynette Strickland 也有相似经历。她记录了入侵物种狮子鱼（Pterois sp.）的数百万基因突变数据。微软的 Excel 只有大约一百万行，对于它来说这个数据量过于庞大。因此，Strickland 用 shell 来查找超出某个质量阈值的记录（电子表格行），导出所需的列，再把数据保存到一个新的文件中。她使用的指令类似于这样（假设质量分数在第 4 列，阈值是 50，所需的列数是 1-4）：</p><p><strong>awk -F, ‘ &#123; if ( $4 > 50 ) print $0 &#125; ’ datafile.csv | cut -d, -f1-4 > newdatafile.csv</strong></p><p>她说：" 通过使用 shell 来提取我需要的特定信息，我就可以把数据浓缩成能研究和可视化的东西。"</p><p><strong>操作数据表</strong></p><p>Shell 指令执行看似简单的操作。比如 cut 指令可以从数据表中提取一列或多列数据。wc 可以统计字数，行数或字符数。awk 可以过滤符合某个条件的行。sed 可以操作字符串。不过这些简单的指令可以通过 pipe（‘ | ’）联合起来，这是一种可以把某个 shell 工具的输出转为另一个工具的输入的功能，这样就可以创造强大的自定义工作流。Tom Ryder 说：" 这就是我们说的行云流水——让事情系统化地运行。" 他是 2018 年出版的 Bash Quick Start Guide 一书的作者，一位新西兰的系统管理员。</p><p>例如，下面这个命令可以把 5 个工具集组合起来，用于统计某个基因表达数据表中某个特定基因名字的数量：</p><p><strong>cut -f1 GEOdataset.csv | sed -E ‘ s/^>// ’ | sort | uniq | wc -l</strong></p><p>在这个命令中，包含名称的第一列的数据被提取出来（cut），去掉开头的某个大于符号 ( sed ) ，按照字母顺序排序，把表单转化为特征值（uniq），然后把行数（基因名字行）打印到屏幕（wc）。</p><p><strong>让工作并行化</strong></p><p>Christina Koch 是威斯康星大学麦迪逊分校的研究计算协调者，她所在的计算机中心提供超过 1. 4 万个节点和太字节储存器的远程连接。Koch 说，假设某个生物信息学家要分析基因表达数据表，而在他们自己的计算机上每个表要用一天的时间才能处理完，而研究者有 60 个这样的数据表，" 那么就要花整整两个月昼夜不停的计算才能处理完毕。" 但是，<strong>如果把工作流通过 secure shell 的 ssh 指令</strong>（打开远程系统的加密门户）<strong>发送给计算机集群，研究者就可以让 60 台计算机进行并行运算，</strong>" 只需要一天就能计算完毕，不需要两个月。"</p><p>即使没有这么强大的计算能力，利用 "ssh" 命令也可以远程工作，在疫情期间这个指令特别有用。在 2020 年封城期间，加拿大道格拉斯心理卫生大学研究所的系统管理员和程序员 Gabriel Devenyi 努力确保他所在机构的研究者能高效工作，无论他们被隔离在哪里。" 如果没有这个命令行，学生们什么也做不了。"</p><p><strong>自动化</strong></p><p>shell 的命令可以保存在名为脚本的文本文件中，脚本可以保存、分享和版本控制，以便提高可复制性。它们也可以自动化运行。使用 cron 命令，用户可以规定脚本运行的时间。</p><p>Wickes 说，一些网站会询问用户是否打算在非高峰访问时间段进行内容抓取，比如 PubMed 文献数据库的非高峰时间是东部标准时间晚上 9 点到凌晨 5 点之间，" 你可以让脚本只在设定时间运行。" 此外，用户也可以每天把数据下载到自己的电脑上，因为许多公用系统会定期清除旧的文件。</p><p><strong>警告：无法撤回操作</strong></p><p>shell 的弊端在于它的界面比较吓人，一般只有一个美元符号和一个指针。Janssens 说，" 有些人觉得望而生畏。"shell 本身也没提供什么帮助。她还提到，shell 还 " 不容许错误 "，错打了一次空格就可能会改变命令的含义，也没有什么命令会询问你是否知道自己在干什么，" 如果你有系统权限，shell 就会认为你希望它执行你所给的指令 "，Devenyi 说，" 于是你能做各种危险的事情。"</p><p>典型例子是 rm -rf * ——这个命令会删除当前目录下所有文件和子文件。如果你是在错误目录中执行这个命令，可能弄丢重要文件。Johnson 说，" 我们都干过这种事。" 所以务必小心。</p><p>有一个避免这个错误的窍门：使用 echo 命令来确保你是在对正确的文件执行操作。Greene 说：" 重要经验：在执行前先 echo。" 一些命令还带有 dry-run 模式，会报告它们将要干什么。还有一种叫做 interactive 模式，在执行任务前会先提示用户。用户还可以设置一些变量，避免计算机覆盖文件，或在出错时退出（分别是 noclobber 和 pipefail）。还有就是要避免在有管理员权限的情况下执行命令。</p><p>Wickes 说：" 生活猝不及防，科研有时也是。"shell 可以处理那些意料之外。Koch 说，除此之外，它还很好玩。" 它特别强大，我在用它的时候感觉自己就是个酷酷的科技宅，你会感觉自己很能干。"</p><p><strong></strong></p><div id="recommend_bottom"></div><div id="article_bottom"></div>  
</div>
            