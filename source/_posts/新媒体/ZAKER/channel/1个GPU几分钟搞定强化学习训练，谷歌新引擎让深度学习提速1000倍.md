
---
title: '1个GPU几分钟搞定强化学习训练，谷歌新引擎让深度学习提速1000倍'
categories: 
 - 新媒体
 - ZAKER
 - channel
headimg: 'https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202107/60f90a0d8e9f097f8660fa3b_1024.jpg'
author: ZAKER
comments: false
date: Thu, 22 Jul 2021 02:00:00 GMT
thumbnail: 'https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202107/60f90a0d8e9f097f8660fa3b_1024.jpg'
---

<div>   
<p>机器人要如何完成这样一个动作？</p><p></p><div class="img_box" id="id_imagebox_0" onclick><div class="content_img_div"><img class="lazy opacity_0 zaker_gif_cache" id="img_0" data-original="http://zkres1.myzaker.com/202107/60f90a0d8e9f097f8660fa3b_1024.jpg" data-gif-url="http://zkres1.myzaker.com/202107/60f90a0d8e9f097f8660fa3b_raw.gif" data-height="249" data-width="320" src="https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202107/60f90a0d8e9f097f8660fa3b_1024.jpg" referrerpolicy="no-referrer"></div></div>我们一般会基于<strong>强化学习</strong>，在仿真环境中进行模拟训练。<p></p><p>这时，如果在一台机器的 CPU 环境下进行模拟训练，那么需要<strong>几个小时到几天</strong>。</p><p>但现在，只需<strong>一个</strong>TPU/GPU，就能和<strong>数千个</strong>CPU 或 GPU 的计算集群的速度一样快，直接将所需时间缩短到<strong>几分钟</strong>！</p><p>相当于将强化学习的速度提升了<strong>1000 倍</strong>！</p><p>这就是来自谷歌的科学家们开发的物理模拟引擎<strong>Brax</strong>。</p><p></p><div class="img_box" id="id_imagebox_1" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_1" data-original="http://zkres2.myzaker.com/202107/60f90a0d8e9f097f8660fa3c_1024.jpg" data-height="201" data-width="1920" src="https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202107/60f90a0d8e9f097f8660fa3c_1024.jpg" referrerpolicy="no-referrer"></div></div>三种策略避免逻辑分支<p></p><p>现在大多数的物理模拟引擎都是怎么设计的呢？</p><p>将重力、电机驱动、关节约束、物体碰撞等任务都整合在一个模拟器中，<strong>并行</strong>地进行多个模拟，以此来逼近现实中的运动系统。</p><p><strong>△</strong>对于每个模拟时间步长，力和力矩被整合在一起</p><p>这种情况下，每个模拟器中的计算都不相同，且数据必须在数据中心内通过网络传输。</p><p>这种并行布局也就导致了较高的延迟时间——即学习者可能需要超过<strong>10000 纳秒</strong>的等待时间，才能从模拟器中获得经验。</p><p>那么怎样才能缩短这种延迟时间呢？</p><p>Brax 选择通过<strong>避免模拟中的分支</strong>来保证数千个并行环境中的计算完全统一，进而降低整个训练架构的复杂度。</p><p>直到复杂度降低到可以在单一的 TPU 或 GPU 上执行，跨机器通信的计算开销就随之降低，延迟也就能被有效消除。</p><p></p><div class="img_box" id="id_imagebox_2" onclick><div class="content_img_div"><img class="lazy opacity_0 zaker_gif_cache" id="img_2" data-original="http://zkres1.myzaker.com/202107/60f90a0d8e9f097f8660fa3e_1024.jpg" data-gif-url="http://zkres1.myzaker.com/202107/60f90a0d8e9f097f8660fa3e_raw.gif" data-height="326" data-width="638" src="https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202107/60f90a0d8e9f097f8660fa3e_1024.jpg" referrerpolicy="no-referrer"></div></div>主要分为以下三个方法：<p></p><p><strong>连续函数替换离散分支逻辑</strong></p><p>比如，在计算一个小球与墙壁之间的接触力时，就产生了一个分支：</p><p>如果球接触墙壁，就执行模拟球从墙壁反弹的独立代码；</p><p>否则，就执行其他代码；</p><p>这里就可以通过符号距离函数来避免这种 if/else 的离散分支逻辑的产生。</p><p><strong>使用 JAX 即时编译中评估分支</strong></p><p>在仿真时间之前评估基于环境静态属性的分支，例如两个物体是否有可能发生碰撞。</p><p></p><div class="img_box" id="id_imagebox_3" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_3" data-original="http://zkres2.myzaker.com/202107/60f90a0d8e9f097f8660fa3f_1024.jpg" data-height="398" data-width="1470" src="https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202107/60f90a0d8e9f097f8660fa3f_1024.jpg" referrerpolicy="no-referrer"></div></div><strong>在模拟中只选择需要的分支结果</strong><p></p><p>在使用了这三种策略之后，我们就得到了一个模拟由刚体、关节、执行器组成环境的物理引擎。</p><p>同时也是一种实现在这种环境中各类操作（如进化策略，直接轨迹优化等）的学习算法。</p><p>那么 Brax 的性能究竟如何呢？</p><p>速度最高提升 1000 倍</p><p>Brax 测试所用的基准是 OpenAI Gym 中 Ant、HalfCheetah、Humanoid、Reacher 四种。</p><p>同时也增加了三个新环境：包括对物理的灵巧操作、通用运动（例如前往周围任何一个放置了物体的地点）、以及工业机器人手臂的模拟：</p><p></p><div class="img_box" id="id_imagebox_4" onclick><div class="content_img_div"><img class="lazy opacity_0 zaker_gif_cache" id="img_4" data-original="http://zkres1.myzaker.com/202107/60f90a0d8e9f097f8660fa40_1024.jpg" data-gif-url="http://zkres1.myzaker.com/202107/60f90a0d8e9f097f8660fa40_raw.gif" data-height="115" data-width="160" src="https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202107/60f90a0d8e9f097f8660fa40_1024.jpg" referrerpolicy="no-referrer"></div></div>研究人员首先测试了 Brax 在并行模拟越来越多的环境时，可以产生多少次物理步骤（也即对环境状态的更新）。<p></p><p>测试结果中的 TPUv3 8x8 曲线显示，Brax 可以在多个设备之间进行无缝扩展，每秒可达到<strong>数亿</strong>个物理步骤：</p><p></p><div class="img_box" id="id_imagebox_5" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_5" data-original="http://zkres2.myzaker.com/202107/60f90a0d8e9f097f8660fa43_1024.jpg" data-height="548" data-width="664" src="https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202107/60f90a0d8e9f097f8660fa43_1024.jpg" referrerpolicy="no-referrer"></div></div>而不仅是在 TPU 上，从 V100 和 P100 曲线也能看出，Brax 在高端<strong>GPU</strong>上同样表现出色。<p></p><p>然后就是 Brax 在单个工作站（workstation）上运行一个强化学习实验所需要的时间。</p><p>在这里，研究人员将基于 Ant 基准环境训练的 Brax 引擎与 MuJoCo 物理引擎做了对比：</p><p></p><div class="img_box" id="id_imagebox_6" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_6" data-original="http://zkres1.myzaker.com/202107/60f90a0d8e9f097f8660fa44_1024.jpg" data-height="296" data-width="639" src="https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202107/60f90a0d8e9f097f8660fa44_1024.jpg" referrerpolicy="no-referrer"></div></div>可以看到，相对于 MuJoCo（蓝线）所需的将近 3 小时时间，使用了 Brax 的加速器硬件最快只需要<strong>10 秒</strong>。<p></p><p>使用 Brax，不仅能够提高单核训练的效率，还可以扩展到大规模的并行模拟训练。</p><div id="recommend_bottom"></div><div id="article_bottom"></div>  
</div>
            