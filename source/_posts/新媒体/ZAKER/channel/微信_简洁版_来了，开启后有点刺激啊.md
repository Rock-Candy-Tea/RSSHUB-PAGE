
---
title: '微信_简洁版_来了，开启后有点刺激啊'
categories: 
 - 新媒体
 - ZAKER
 - channel
headimg: 'https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202108/611e4a22622768ac53000014_1024.jpg'
author: ZAKER
comments: false
date: Thu, 19 Aug 2021 05:07:00 GMT
thumbnail: 'https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202108/611e4a22622768ac53000014_1024.jpg'
---

<div>   
<p>众所周知，小雷是微信野生产品经理，江湖人称微信挖掘机。</p><p>无论是微信推出的新功能，还是那些早被用户遗忘的隐藏功能，小雷基本都为小伙伴们详细解析过。</p><p>当然啦，做功能深挖这件事儿并非徒劳。</p><p>把微信难以发现的实用功能找出来，用户也能获得更好的使用体验。</p><p></p><div class="img_box" id="id_imagebox_0" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_0" data-original="http://zkres2.myzaker.com/202108/611e4a22622768ac53000014_1024.jpg" data-height="161" data-width="444" src="https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202108/611e4a22622768ac53000014_1024.jpg" referrerpolicy="no-referrer"></div></div>之前小雷找出来的隐藏功能都是浮于表面。<p></p><p>大多数情况下，只是对某个功能做个体验，并告诉大伙这能搞出什么新玩法。</p><p>而今天小雷打算来点硬货，整点深入的微信隐藏功能解析。</p><p>这个功能涉及到微信底层，也许不是每个人都愿意折腾。</p><p>但看完这篇文章，大家也会对微信有更深的了解。</p><p></p><div class="img_box" id="id_imagebox_1" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_1" data-original="http://zkres1.myzaker.com/202108/611e4a22622768ac53000015_1024.jpg" data-height="300" data-width="533" src="https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202108/611e4a22622768ac53000015_1024.jpg" referrerpolicy="no-referrer"></div></div>微信更新到现在，安装包早已突破 200MB，内存占用和性能消耗都在不断提高。<p></p><p>除了新功能的加入，更重要的原因是底层代码和框架也在不断增加。</p><p><strong>而对微信，甚至是系统流畅度影响最大的，还得看这个叫做 Hardcoder 的通信框架。</strong></p><p>估计大家用了那么多年微信，还是第一次见这玩意儿吧。</p><p></p><div class="img_box" id="id_imagebox_2" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_2" data-original="http://zkres2.myzaker.com/202108/611e4a22622768ac53000016_1024.jpg" data-height="397" data-width="1011" src="https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202108/611e4a22622768ac53000016_1024.jpg" referrerpolicy="no-referrer"></div></div>So，小雷先和大家聊聊，这个 Hardcoder 通信框架到底是啥玩意、是用来干嘛的。<p></p><p>Hardcoder 框架由腾讯开发，并在 2019 年全面开源。</p><p>实际上也是在几年前就被应用到微信底层了，只是日常使用中很难被发现。</p><p><strong>按开源文档的说法嘛，它是为了优化微信性能而诞生的。</strong></p><p></p><div class="img_box" id="id_imagebox_3" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_3" data-original="http://zkres2.myzaker.com/202108/611e4a22622768ac53000017_1024.jpg" data-height="249" data-width="940" src="https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202108/611e4a22622768ac53000017_1024.jpg" referrerpolicy="no-referrer"></div></div>其实很好理解，各大手机厂商都对系统有自己的一套性能调度。<p></p><p>比如 MIUI 是出了名的调度激进，玩游戏时发热明显，OV 则相对保守，限制帧率来控制温度。</p><p>而厂商对于微信的性能调度也很简单粗暴。</p><p>系统识别到微信启动或切换页面时，就会瞬间提高 CPU 频率，从而提高微信的流畅度。</p><p></p><div class="img_box" id="id_imagebox_4" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_4" data-original="http://zkres1.myzaker.com/202108/611e4a22622768ac53000018_1024.jpg" data-height="597" data-width="1076" src="https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202108/611e4a22622768ac53000018_1024.jpg" referrerpolicy="no-referrer"></div></div>在早期微信功能不多的时候，确实可以这么做嗷。<p></p><p>但随着微信不断迭代，功能也越来越复杂，小程序、聊天、公众号、相册等都是单独的界面。</p><p>腾讯觉得，只靠系统那一套调度，已经不能满足微信对流畅度的需求了。</p><p>于是就有了小雷正在讨论的 Hardcoder 框架。</p><p></p><div class="img_box" id="id_imagebox_5" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_5" data-original="http://zkres2.myzaker.com/202108/611e4a22622768ac53000019_1024.jpg" data-height="440" data-width="440" src="https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202108/611e4a22622768ac53000019_1024.jpg" referrerpolicy="no-referrer"></div></div>大家可以看下图，传统的系统调度方案是先由 App 发出获取性能的需求。<p></p><p>这个需求被安卓系统框架接收后，就会给予这个 App 合适的性能调度。</p><p><strong>但有了 Hardcoder 框架后，微信就不用再看系统调度的脸色了，它为所欲为，可以随意调用系统性能资源。</strong></p><p>比如从主界面进入聊天界面时，拉高 CPU 频率，甚至把微信某些线程挪到 CPU 超大核里面运行，</p><p>一切都为了让微信用起来更加流畅。</p><p></p><div class="img_box" id="id_imagebox_6" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_6" data-original="http://zkres2.myzaker.com/202108/611e4a22622768ac5300001a_1024.jpg" data-height="403" data-width="554" src="https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202108/611e4a22622768ac5300001a_1024.jpg" referrerpolicy="no-referrer"></div></div>既然能做到绕过系统调度，Hardcoder 肯定也需要手机厂商配合的。<p></p><p>喏，就是把服务端放进国内的系统定制 UI（MIUI、Flyme 等）。</p><p>再把客户端放进微信里，这样微信就可以绕过系统那套调度。</p><p>用 " 私人搭建 " 的 Hardcoder 框架来调用 CPU 和 GPU 的性能资源。</p><p></p><div class="img_box" id="id_imagebox_7" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_7" data-original="http://zkres1.myzaker.com/202108/611e4a22622768ac5300001b_1024.jpg" data-height="322" data-width="681" src="https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202108/611e4a22622768ac5300001b_1024.jpg" referrerpolicy="no-referrer"></div></div>说人话就是微信跟国内某些定制 ROM 搞了合作，让系统给微信开了调度白名单。<p></p><p>目前 Hadrcoder 框架已经接入了 OPPO、vivo、华为、小米、三星和魅族等主流手机厂商。</p><p>不得不说，鹅厂的影响力还是不容小觑。</p><p></p><div class="img_box" id="id_imagebox_8" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_8" data-original="http://zkres2.myzaker.com/202108/611e4a22622768ac5300001c_1024.jpg" data-height="328" data-width="756" src="https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202108/611e4a22622768ac5300001c_1024.jpg" referrerpolicy="no-referrer"></div></div>那么问题来了，Hardcoder 对我们，到底是好还是坏呢？<p></p><p>以开源文档来看，肯定是好处多多了，既能提高微信各种场景的流畅度，又不会导致功耗大幅提升。</p><p><strong>官方甚至表示，相当于只用 2% 的功耗换取平均 20% 的性能提升，效率高得离谱。</strong></p><p></p><div class="img_box" id="id_imagebox_9" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_9" data-original="http://zkres2.myzaker.com/202108/611e4a22622768ac5300001d_1024.jpg" data-height="215" data-width="925" src="https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202108/611e4a22622768ac5300001d_1024.jpg" referrerpolicy="no-referrer"></div></div>但说实话，大家平时也是 24 小时挂着微信的用户了。<p></p><p>微信流畅是流畅，但到底省不省电，相信各位心里都有数的，只能说中规中矩。</p><p>即使 Hardcoder 已经专门对不同的机型做调度适配，但总会有适配得不够到位的地方。</p><p>比如小雷明明用的是旗舰手机，几个中核就可以带起来微信，Hardcoder 硬是要把微信放在大核上运行，徒增功耗。</p><p></p><div class="img_box" id="id_imagebox_10" onclick><div class="content_img_div"><img class="lazy opacity_0 zaker_gif_cache" id="img_10" data-original="http://zkres1.myzaker.com/202108/611e4a22622768ac5300001e_1024.jpg" data-gif-url="http://zkres1.myzaker.com/202108/611e4a22622768ac5300001e_raw.gif" data-height="240" data-width="240" src="https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202108/611e4a22622768ac5300001e_1024.jpg" referrerpolicy="no-referrer"></div></div>Hardcoder 虽然可以让微信的流畅度得到保证，但毫无疑问是提升牺牲发热和功耗。<p></p><p>另一方面，<strong>Hardcoder 框架只能实现微信与系统之间的沟通。</strong></p><p>它不知道整个手机目前处于啥状态，在某些场景下会导致手机耗电更加严重。</p><p>比如手机电量不足时，基本上都会自动开启省电模式，此时手机 CPU 会以低功耗模式运行。</p><p>但由于微信不知道整个系统的情况，它只会不断给系统提要求：</p><p><strong>" 我要打开朋友圈了，给我提频！"</strong></p><p><strong>" 我要发送文件给好友了，再提一下 CPU 频率！"</strong></p><p>带来的问题就是省电模式一点都不省电，用户甚至会以为是系统出了问题。</p><p>好比小雷的手机 CPU 还在躺着睡觉，突然被 Hardcoder 半夜敲门，你说 CPU 气不气，累不累？</p><p>像骁龙 888 这种发热严重点的，一生气就得飙到四五十度，这谁顶得住啊。</p><p></p><div class="img_box" id="id_imagebox_11" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_11" data-original="http://zkres2.myzaker.com/202108/611e4a22622768ac5300001f_1024.jpg" data-height="501" data-width="869" src="https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202108/611e4a22622768ac5300001f_1024.jpg" referrerpolicy="no-referrer"></div></div>既然发现了问题，我们就得着手去解决。<p></p><p>Hardcoder 为每台配置了服务端的机子都进行了统一适配，但默认的配置并不一定适合自己的手机。</p><p>如果大家想让微信变得更省电流畅，不妨跟着小雷一起调教 Hardcoder。</p><p>支持的机型列表就放在这儿了，基本覆盖了主流厂商，大伙自己看着来。</p><p>首先，我们需要一个 App -- 创建快捷方式。</p><p>毕竟 Hardcoder 是底层框架，无法直接打开，我们得靠这个 App 来创建快捷方式使用。</p><p></p><div class="img_box" id="id_imagebox_12" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_12" data-original="http://zkres1.myzaker.com/202108/611e4a22622768ac53000020_1024.jpg" data-height="445" data-width="1049" src="https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202108/611e4a22622768ac53000020_1024.jpg" referrerpolicy="no-referrer"></div></div>在<strong>创建快捷方式 App</strong>里找到微信，进入微信的【活动列表】搜索 "hard"，就能看到 Hardcoder 框架的快捷方式。<p></p><p>此时我们点击右上角的【创建】按钮，Hardcoder 的快捷方式会在系统桌面上出现。</p><p></p><div class="img_box" id="id_imagebox_13" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_13" data-original="http://zkres2.myzaker.com/202108/611e4a22622768ac53000021_1024.jpg" data-height="2340" data-width="3239" src="https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202108/611e4a22622768ac53000021_1024.jpg" referrerpolicy="no-referrer"></div></div>注意喽，如果点击【创建】后没发现桌面有动静，很有可能是没有给【创建快捷方式】权限。<p></p><p>小雷建议大家在使用前先检查一波权限。</p><p></p><div class="img_box" id="id_imagebox_14" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_14" data-original="http://zkres2.myzaker.com/202108/611e4a22622768ac53000022_1024.jpg" data-height="767" data-width="869" src="https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202108/611e4a22622768ac53000022_1024.jpg" referrerpolicy="no-referrer"></div></div>创建好快捷方式后，我们就可以在桌面打开微信 Hardcoder 框架啦。<p></p><p>没有意外，Hardcoder 果然是一大串英文，让人看得头痛欲裂。</p><p>但大家无须担心，凡是能用上的选项，小雷都会帮大家做个注释。</p><p></p><div class="img_box" id="id_imagebox_15" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_15" data-original="http://zkres1.myzaker.com/202108/611e4a22622768ac53000023_1024.jpg" data-height="832" data-width="382" src="https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202108/611e4a22622768ac53000023_1024.jpg" referrerpolicy="no-referrer"></div></div>先看顶部部分，第一个选项是 Hardcoder 的总开关。<p></p><p>个人觉得，手机处理器性能不低于骁龙 855 的机型都可以关掉，让系统调度接管 Hardcoder 就好。</p><p>而 DEBUG_LOG 是日志功能，不关闭会经常产生日志，有可能影响系统流畅。</p><p>如果不是开发者，建议小伙伴们关闭。</p><p></p><div class="img_box" id="id_imagebox_16" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_16" data-original="http://zkres1.myzaker.com/202108/611e4a22622768ac5300024_1024.jpg" data-height="450" data-width="720" src="https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202108/611e4a22622768ac5300024_1024.jpg" referrerpolicy="no-referrer"></div></div>图源：酷安 @hana_shirosaki<p></p><p>OK，继续往下看。</p><p>开头打勾的是提频的触发条件，而 CPU 和 IO 则是提频的幅度。</p><p>CPU 提频有四个等级，分别是 0、1、2、3。</p><p>等级越高说明频率越小，0 表示提频幅度最大，3 表示提频幅度最小，与我们的认知刚好相反。</p><p>至于 Bind THR，如果勾选了，微信对应的线程就会优先以大核心运行以提高流畅度。</p><p>手握 888 机型的机友们，要是没特别需求，最好不要勾选 Bind THR。</p><p>毕竟骁龙 888 的 X1 超大核功耗很高，对性能提升还不大，能不用就不用。</p><p></p><div class="img_box" id="id_imagebox_17" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_17" data-original="http://zkres2.myzaker.com/202108/611e4a22622768ac53000025_1024.jpg" data-height="127" data-width="720" src="https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202108/611e4a22622768ac53000025_1024.jpg" referrerpolicy="no-referrer"></div></div>再往下看，就是每个选项对应的微信线程了。<p></p><p>比如小雷勾选了 BOOT，微信就会在启动时提高频，加快微信启动。</p><p>勾选了 SEND_PIC_MSG，微信就会在发送图片时提频，保证发送图片不卡顿。</p><p>其实在小雷看来，除了涉及解码 / 编码的线程，其他线程都可以按需调低提频幅度，甚至彻底关闭提频。</p><p></p><div class="img_box" id="id_imagebox_18" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_18" data-original="http://zkres2.myzaker.com/202108/611e4a22622768ac53000026_1024.jpg" data-height="1600" data-width="505" src="https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202108/611e4a22622768ac53000026_1024.jpg" referrerpolicy="no-referrer"></div></div>以上的图像注释都表达得很明确，懂点搞机知识的小伙伴可以自行调教。<p></p><p>要是实在懒得研究，又让手机省电一点，直接把 Hardcoder 关掉即可。</p><p><strong>让系统来接管微信调度，绝对不会出问题（前提是处理器性能够强）</strong></p><p>但手机性能实在太弱的，小雷不建议大家自行调整。</p><p>毕竟 Hardcoder 还是能让微信变得更流畅的。</p><p></p><div class="img_box" id="id_imagebox_19" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_19" data-original="http://zkres1.myzaker.com/202108/611e4a22622768ac53000027_1024.jpg" data-height="447" data-width="440" src="https://cors.zfour.workers.dev/?http://zkres1.myzaker.com/202108/611e4a22622768ac53000027_1024.jpg" referrerpolicy="no-referrer"></div></div>提醒一下小伙伴们，修改前最好截个图，不然你想改回去也没有备份作为参照了。<p></p><p>至于 Hardcoder 框架是好是坏，小雷作为普通用户不太好评价。</p><p>倒是很多开发者对 Hardcoder 并不看好。</p><p>原因很简单，万一 Hardcoder 被滥用了，后果将十分严重。</p><p>当所有 App 都接入 Hardcoder 并抢着占用 CPU 大核线程时，手机将会持续发热，长期处于高负载状态。</p><p></p><div class="img_box" id="id_imagebox_20" onclick><div class="content_img_div perview_img_div"><img class="lazy opacity_0 " id="img_20" data-original="http://zkres2.myzaker.com/202108/611e4a22622768ac53000028_1024.jpg" data-height="361" data-width="582" src="https://cors.zfour.workers.dev/?http://zkres2.myzaker.com/202108/611e4a22622768ac53000028_1024.jpg" referrerpolicy="no-referrer"></div></div>虽然它有自己的优势，可以直接根据 App 的需要进行资源调度，提高 App 流畅度。<p></p><p>但小雷依然不希望 Hardcoder 接入到其他 App，从目前的安卓生态来看，被滥用的可能性还是挺高的。</p><p>一旦被大规模滥用，就算把地表最强 A14 芯片挪到安卓上，也喂不饱那些流氓 App。</p><p>图片＆资料来源：酷安 @hana_shirosaki</p><p>《无需 Root，合理把控微信的鸡血——微信 Hardcoder 组件选项调教入门》</p><div id="recommend_bottom"></div><div id="article_bottom"></div>  
</div>
            